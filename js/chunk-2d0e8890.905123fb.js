(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e8890"],{"8a4e":function(e,t,n){"use strict";n.r(t);var r=n("7a23");function i(e,t,n,i,a,c){var u=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(u,{fields:e.fields,activeField:e.activeField,onFinishAction:e.onFinish,skipSummary:!0,onOnIndex:t[1]||(t[1]=function(t){return e.activeField=""}),cancelDestinationPath:e.cancelDestination},null,8,["fields","activeField","onFinishAction","cancelDestinationPath"])}n("a623"),n("4de4"),n("4160"),n("a15b"),n("d81d"),n("45fc"),n("d3b7"),n("159b"),n("ddb0"),n("96cf");var a=n("1da1"),c=n("d95e"),u=n("7920"),o=n("2706"),s=n("9283"),d=n("3d6c"),l=n("b5e4"),f=n("2ef0"),p=Object(r["defineComponent"])({components:{HisStandardForm:u["a"]},data:function(){return{activeField:"",fields:[],drugs:[],selectedDrugs:[],barcode:"",stockService:{}}},methods:{onFinish:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.prepDrugs(e),n.next=3,t.stockService.postItems(r);case 3:i=n.sent,i?(Object(l["d"])("Stock succesfully added"),t.$router.push("/")):Object(l["c"])("Could not save stock");case 5:case"end":return n.stop()}}),n)})))()},getFields:function(){var e=this;return[{id:"barcode",helpText:"Scan barcode",type:c["b"].TT_BARCODE,config:{hiddenFooterBtns:["Clear","Next"]},onValue:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.barcode=n,e.activeField="select drugs";case 2:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()},{id:"select drugs",helpText:"Select drugs",type:c["b"].TT_MULTIPLE_SELECT,requireNext:!0,validation:function(e){return o["a"].required(e)},options:function(){return e.drugs},unload:function(t){return e.selectedDrugs=t},config:{footerBtns:[{name:"Select all",slot:"end",onClick:function(){e.selectAll(e.drugs)}}]}},{id:"date",helpText:"Delivery Date",type:c["b"].TT_FULL_DATE,validation:function(e){return o["a"].required(e)}},{id:"enter_batches",helpText:"Batch entry",type:c["b"].TT_BATCH_ENTRY,options:function(){return e.selectedDrugs},beforeNext:function(e,t,n,r){var i=r.currentFieldContext,a=function(e){return e.map((function(e,t){return"".concat(e.label)})).join(" & ")},c=i.drugs.filter((function(e){return e.entries.map((function(e){return!e.tins&&!e.expiry&&!e.batchNumber})).every(Boolean)})),u=i.drugs.filter((function(e){return e.entries.map((function(e){var t=0;return e.tins&&(t+=1),e.expiry&&(t+=1),e.batchNumber&&(t+=1),t>=1&&t<=2})).some(Boolean)}));if(!Object(f["isEmpty"])(u)){var o=a(u);return Object(l["e"])("Please fix partial batch entries for drugs: ".concat(o)),!1}if(!Object(f["isEmpty"])(c)){var s=a(c);return Object(l["e"])("The following drug batches are empty: ".concat(s)),!1}return!0},validation:function(e){return o["a"].required(e)}},{id:"adherence_report",helpText:"Summary",type:c["b"].TT_TABLE_VIEWER,options:function(t){return e.buildResults(t.enter_batches)},config:{hiddenFooterBtns:["Clear"]}}]},buildResults:function(e){var t=["Drug","Amount per unit","Total units","Expiry date","Batch number"],n=e.map((function(e){var t=e.value;return[t.shortName,t.tabs,t.tins,s["a"].toStandardHisDisplayFormat(t.expiry),t.batchNumber]}));return[{label:"Confirm entry",value:"Table",other:{columns:t,rows:n}}]},prepDrugs:function(e){var t=[],n=this.barcode;return e.enter_batches.forEach((function(r){var i=r.value;t.push({batch_number:i.batchNumber,items:[{barcode:n,drug_id:i.drugID,expiry_date:i.expiry,quantity:parseInt(i.tabs)*parseInt(i.tins),delivery_date:e.date.value}]})})),t},selectAll:function(e){return e.map((function(e){return e.isChecked=!0,e}))},formatDrugs:function(){return this.stockService.drugList().map((function(e){return{label:e.shortName,value:e}}))}},created:function(){this.stockService=new d["a"],this.fields=this.getFields(),this.drugs=this.formatDrugs()}}),b=n("d959"),h=n.n(b);const m=h()(p,[["render",i]]);t["default"]=m}}]);
//# sourceMappingURL=chunk-2d0e8890.905123fb.js.map