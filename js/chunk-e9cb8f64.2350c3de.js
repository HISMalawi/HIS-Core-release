(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e9cb8f64"],{"313e":function(e,t,n){"use strict";n.r(t);var o=n("7a23");const c=Object(o["withScopeId"])("data-v-7217b18a");Object(o["pushScopeId"])("data-v-7217b18a");const r=Object(o["createVNode"])("label",{class:"his-title"}," Prescribe BP drugs ",-1),a={key:0,class:"view-port-content"},l={id:"main-table",style:{width:"100%"}},s=Object(o["createVNode"])("th",null," ",-1),i=Object(o["createVNode"])("td",{class:"td-remaining td-title"},[Object(o["createVNode"])("span",null,"New/Current")],-1),d=Object(o["createVNode"])("td",{class:"td-remaining td-title"},[Object(o["createVNode"])("span",null," ")],-1),u=Object(o["createTextVNode"])(" Add notes "),b=Object(o["createVNode"])("p",null,null,-1),p={id:"table-notes",style:{width:"100%"}},g=Object(o["createVNode"])("caption",{style:{"font-size":"1.2em"}}," Notes ",-1),O=Object(o["createVNode"])("p",null,null,-1),m={class:"table-inner-notes",id:"notes-HCZ"},j={class:"date-td today-td"},h={class:"date-td today-td"},k=Object(o["createTextVNode"])(" X "),N=Object(o["createTextVNode"])(" cancel "),f=Object(o["createTextVNode"])(" Clear Session Prescription "),C=Object(o["createTextVNode"])(" Continue ");Object(o["popScopeId"])();const V=c((function(e,t,n,V,D,y){const B=Object(o["resolveComponent"])("ion-col"),v=Object(o["resolveComponent"])("ion-row"),_=Object(o["resolveComponent"])("ion-toolbar"),I=Object(o["resolveComponent"])("ion-header"),w=Object(o["resolveComponent"])("ion-checkbox"),F=Object(o["resolveComponent"])("ion-button"),x=Object(o["resolveComponent"])("view-port"),T=Object(o["resolveComponent"])("ion-content"),S=Object(o["resolveComponent"])("ion-footer"),P=Object(o["resolveComponent"])("ion-page");return Object(o["openBlock"])(),Object(o["createBlock"])(P,null,{default:c(()=>[Object(o["createVNode"])(I,null,{default:c(()=>[Object(o["createVNode"])(_,null,{default:c(()=>[Object(o["createVNode"])(v,null,{default:c(()=>[Object(o["createVNode"])(B,null,{default:c(()=>[r]),_:1})]),_:1})]),_:1})]),_:1}),Object(o["createVNode"])(T,null,{default:c(()=>[Object(o["createVNode"])(x,null,{default:c(()=>[e.drugs?(Object(o["openBlock"])(),Object(o["createBlock"])("div",a,[Object(o["createVNode"])("table",l,[Object(o["createVNode"])("tr",null,[s,(Object(o["openBlock"])(!0),Object(o["createBlock"])(o["Fragment"],null,Object(o["renderList"])(e.drugs,(e,t)=>(Object(o["openBlock"])(),Object(o["createBlock"])("th",{key:t},[Object(o["createTextVNode"])(Object(o["toDisplayString"])(t)+" ",1),Object(o["createVNode"])(v,null,{default:c(()=>[(Object(o["openBlock"])(!0),Object(o["createBlock"])(o["Fragment"],null,Object(o["renderList"])(e.drugs,(e,t)=>(Object(o["openBlock"])(),Object(o["createBlock"])(B,{class:"col-borders",key:t},{default:c(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.amount||"0mg"),1)]),_:2},1024))),128))]),_:2},1024)]))),128))]),Object(o["createVNode"])("tr",null,[i,(Object(o["openBlock"])(!0),Object(o["createBlock"])(o["Fragment"],null,Object(o["renderList"])(e.drugs,(t,n)=>(Object(o["openBlock"])(),Object(o["createBlock"])("td",{key:n,class:"td-current td-value"},[Object(o["createVNode"])(v,null,{default:c(()=>[(Object(o["openBlock"])(!0),Object(o["createBlock"])(o["Fragment"],null,Object(o["renderList"])(t.drugs,(t,r)=>(Object(o["openBlock"])(),Object(o["createBlock"])(B,{key:r},{default:c(()=>[Object(o["createVNode"])(w,{checked:t.selected,onIonChange:t=>e.selectDrug(n,r,t)},null,8,["checked","onIonChange"])]),_:2},1024))),128))]),_:2},1024)]))),128))]),Object(o["createVNode"])("tr",null,[d,(Object(o["openBlock"])(!0),Object(o["createBlock"])(o["Fragment"],null,Object(o["renderList"])(Object.keys(e.drugs),(t,n)=>(Object(o["openBlock"])(),Object(o["createBlock"])("td",{class:"td-remaining td-value",key:n},[Object(o["createVNode"])(v,null,{default:c(()=>[Object(o["createVNode"])(B,null,{default:c(()=>[Object(o["createVNode"])(F,{onClick:n=>e.launchNotePad(t),color:"warning"},{default:c(()=>[u]),_:1},8,["onClick"])]),_:1})]),_:1})]))),128))])]),b,Object(o["createVNode"])("table",p,[g,O,Object(o["createVNode"])("tr",null,[(Object(o["openBlock"])(!0),Object(o["createBlock"])(o["Fragment"],null,Object(o["renderList"])(e.drugs,(e,t)=>(Object(o["openBlock"])(),Object(o["createBlock"])("th",{style:{width:"25%"},key:t},[Object(o["createVNode"])("span",null,Object(o["toDisplayString"])(t),1)]))),128))]),Object(o["createVNode"])("tr",null,[(Object(o["openBlock"])(!0),Object(o["createBlock"])(o["Fragment"],null,Object(o["renderList"])(Object.keys(e.drugs),(t,n)=>(Object(o["openBlock"])(),Object(o["createBlock"])("td",{id:"HCZ",style:{"padding-top":"2px !important"},valign:"top",key:n},[Object(o["createVNode"])("table",m,[(Object(o["openBlock"])(!0),Object(o["createBlock"])(o["Fragment"],null,Object(o["renderList"])(e.drugs[t].notes,(n,r)=>(Object(o["openBlock"])(),Object(o["createBlock"])("tr",{key:r},[Object(o["createVNode"])("td",j,Object(o["toDisplayString"])(n.date),1),Object(o["createVNode"])("td",h,Object(o["toDisplayString"])(n.description),1),Object(o["createVNode"])("td",null,[n.isNewNote?(Object(o["openBlock"])(),Object(o["createBlock"])(F,{key:0,color:"danger",onClick:n=>e.removeNote(t,r)},{default:c(()=>[k]),_:1},8,["onClick"])):Object(o["createCommentVNode"])("",!0)])]))),128))])]))),128))])])])):Object(o["createCommentVNode"])("",!0)]),_:1})]),_:1}),Object(o["createVNode"])(S,null,{default:c(()=>[Object(o["createVNode"])(_,{color:"dark"},{default:c(()=>[Object(o["createVNode"])(F,{size:"large",color:"danger",slot:"start",onClick:e.gotoPatientDashboard},{default:c(()=>[N]),_:1},8,["onClick"]),e.canClearHtnSessionPrescription?(Object(o["openBlock"])(),Object(o["createBlock"])(F,{key:0,size:"large",color:"warning",slot:"end",onClick:e.clearPrescriptionInSession},{default:c(()=>[f]),_:1},8,["onClick"])):Object(o["createCommentVNode"])("",!0),e.selectedDrugs&&e.selectedDrugs.length>0?(Object(o["openBlock"])(),Object(o["createBlock"])(F,{key:1,size:"large",color:"success",slot:"end",onClick:e.onFinish},{default:c(()=>[C]),_:1},8,["onClick"])):Object(o["createCommentVNode"])("",!0)]),_:1})]),_:1})]),_:1})}));n("13d5");var D=n("0a79"),y=n("d95e"),B=n("e6e9"),v=n("8a30"),_=n("7365"),I=n("32b3"),w=n("ad60"),F=n("b5e4"),x=n("2ef0"),T=Object(o["defineComponent"])({mixins:[_["a"]],components:{ViewPort:D["a"],IonToolbar:v["Q"],IonHeader:v["q"],IonContent:v["n"],IonRow:v["H"],IonButton:v["d"],IonCol:v["m"],IonFooter:v["o"],IonPage:v["D"],IonCheckbox:v["k"]},watch:{ready:{async handler(e){if(e){this.HTN=new I["a"](this.patientID,this.providerID),this.drugs=this.HTN.getDrugs();const{drugs:e,notes:t}=await this.HTN.getCurrentDrugs();this.setPreviousBpDrugs(e),this.setPreviousBpNotes(t),this.canClearHtnSessionPrescription=this.patientHasHtnSessionKey()}},immediate:!0}},data:()=>({HTN:{},drugs:null,canClearHtnSessionPrescription:!1}),methods:{clearPrescriptionInSession(){sessionStorage.removeItem(I["b"].Prescription),this.canClearHtnSessionPrescription=!1},patientHasHtnSessionKey(){try{const e=sessionStorage.getItem(I["b"].Prescription);if(e){const t=JSON.parse(e);return t[this.patientID]}}catch(e){console.warn(e)}return!1},removeNote(e,t,n){this.drugs[e].notes.splice(n,1)},launchNotePad(e){this.showModal({id:"note",helpText:"Add notes for "+e,type:y["b"].TT_TEXT},t=>{t&&this.drugs[e].notes.push({date:w["a"].getSessionDate(),description:t.value||"",drugID:this.drugs[e].drugs[0].drugID,isNewNote:!0})})},async onFinish(){const e=Object.values(this.drugs).filter(e=>!Object(x["isEmpty"])(e.notes)).map(e=>e.notes).reduce((e,t)=>e.concat(t),[]).filter(e=>e.isNewNote).map(e=>this.HTN.buildObs("Clinician notes",{value_text:e.description,value_drug:e.drugID}));if(!Object(x["isEmpty"])(e))try{await this.HTN.createEncounter(),await this.HTN.saveObservationList(await Promise.all(e))}catch(t){return Object(F["e"])("Unable to save notes "+t)}this.gotoTreatment()},gotoTreatment(){const e=this.selectedDrugs.map(e=>Object(x["find"])(I["a"].htnDrugReferences(),{drug_id:e.drugID})),t={};t[this.patientID]=e,sessionStorage.setItem(I["b"].Prescription,JSON.stringify(t)),this.$router.push("/art/encounters/prescriptions/"+this.patientID)},async showModal(e,t){const n=await v["X"].create({component:B["a"],backdropDismiss:!1,cssClass:"full-modal",componentProps:{dismissType:"modal",currentField:e,onFinish:t}});n.present()},setPreviousBpNotes(e){for(const t in e)this.drugs[t].notes=Object.keys(e[t]).map(n=>e[t][n].map(e=>({date:n,description:e,isNewNote:!1}))).reduce((e,t)=>e.concat(t),[])},setPreviousBpDrugs(e){e.forEach(e=>{for(const t in this.drugs)this.drugs[t].drugs.forEach((n,o)=>{e.drug_id===n.drugID&&(this.drugs[t].drugs[o].current=!0,this.drugs[t].drugs[o].selected=!0,this.drugs[t].selected=e.drug_id)})})},selectDrug(e,t,n){this.drugs[e].drugs.forEach((t,n)=>{this.drugs[e].drugs[n].selected=!1}),this.drugs[e].drugs[t].selected=n.detail.checked}},computed:{selectedDrugs(){return this.drugs?Object.values(this.drugs).map(e=>e.drugs).reduce((e,t)=>e.concat(t),[]).filter(e=>e.selected):[]}}}),S=(n("c2f2"),n("6b0d")),P=n.n(S);const H=P()(T,[["render",V],["__scopeId","data-v-7217b18a"]]);t["default"]=H},"32b3":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return a}));var o,c=n("cc6f"),r=n("7957");(function(e){e["Prescription"]="htnPrescription"})(o||(o={}));class a extends c["a"]{constructor(e,t){super(e,48,t)}static getBpGrade(e,t){return e<140&&t<90?"normal":e>=140&&e<160||t>=100&&t<110?"grade 1":e>=180&&t>110||e>=180?"grade 3":e>=160&&e<180||t>=110?"grade 2":"N/A"}static isBpNormotensive(e){const[t,n]=Object.values(e).sort((e,t)=>e.date<t.date?1:0).map(e=>this.getBpGrade(e.sbp,e.dbp));return"normal"===t&&"normal"===n}getSystolicBp(){return r["a"].getFirstValueNumber(this.patientID,"Systolic blood pressure")}getDiastolicBp(){return r["a"].getFirstValueNumber(this.patientID,"Diastolic blood pressure")}async onBpDrugs(){const e=await r["a"].getFirstValueCoded(this.patientID,"Treatment status");return!!e&&"Yes"===e}async getBPTrail(){return await c["a"].getJson(`/patients/${this.patientID}/bp_trail`)}async getCurrentDrugs(){return await c["a"].getJson(`/patients/${this.patientID}/current_bp_drugs`)}async getLastDrugs(){return await c["a"].getJson(`/patients/${this.patientID}/last_bp_drugs_dispensation`)}async getAdherence(e,t){return await c["a"].postJson(`/patients/${this.patientID}/remaining_bp_drugs`,{drug_id:e,pills:t})}async enrollPatient(e){return await c["a"].postJson(`/patients/${this.patientID}/update_or_create_htn_state`,e)}static htnDrugReferences(){return[{drug_id:275,drug_name:"HCZ (25mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:942,drug_name:"Enalapril (5mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:943,drug_name:"Enalapril (10mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:558,drug_name:"Amlodipine (5mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:559,drug_name:"Amlodipine (10mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:117,drug_name:"Atenolol (50mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:11,drug_name:"Atenolol(100mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"}]}getDrugs(){return{HCZ:{drugs:[{drugName:"HCZ (25mg tablet)",drugID:275,amount:"25mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null}],selected:null,notes:[]},Enalapril:{drugs:[{drugName:"Enalapril (5mg tablet)",drugID:942,amount:"5mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Enalapril (10mg tablet)",drugID:943,amount:"10mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]},Amlodipine:{drugs:[{drugName:"Amlodipine (5mg tablet)",drugID:558,amount:"5mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Amlodipine (10mg tablet)",drugID:559,amount:"10mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]},Atenolol:{drugs:[{drugName:"Atenolol (50mg tablet)",drugID:117,amount:"50mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Atenolol(100mg tablet)",drugID:11,amount:"100mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]}}}}},4582:function(e,t,n){},c2f2:function(e,t,n){"use strict";n("4582")},e6e9:function(e,t,n){"use strict";var o=n("7a23");const c=Object(o["createTextVNode"])(" Close "),r=Object(o["createTextVNode"])(" Clear "),a=Object(o["createTextVNode"])(" Done ");function l(e,t,n,l,s,i){const d=Object(o["resolveComponent"])("ion-title"),u=Object(o["resolveComponent"])("ion-toolbar"),b=Object(o["resolveComponent"])("ion-header"),p=Object(o["resolveComponent"])("ion-content"),g=Object(o["resolveComponent"])("ion-button"),O=Object(o["resolveComponent"])("ion-footer"),m=Object(o["resolveComponent"])("ion-page");return Object(o["openBlock"])(),Object(o["createBlock"])(m,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(b,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(u,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(d,{class:"his-lg-text ion-text-center"},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e.currentField.helpText),1)]),_:1})]),_:1})]),_:1}),Object(o["createVNode"])(p,null,{default:Object(o["withCtx"])(()=>[(Object(o["openBlock"])(),Object(o["createBlock"])(o["KeepAlive"],null,[(Object(o["openBlock"])(),Object(o["createBlock"])(Object(o["resolveDynamicComponent"])(e.currentField.type),{key:e.currentField.id,currentFieldig:e.currentField.currentFieldig,options:e.currentField.options,preset:e.currentField.preset,clear:e.valueClearIndex,fdata:e.formData,config:e.currentField.config,cdata:e.computedFormData,activationState:e.state,onValue:e.currentField.onValue,defaultValue:e.currentField.defaultValue,onValueUpdate:e.currentField.onValueUpdate,onOnValue:e.onFieldValue},null,8,["currentFieldig","options","preset","clear","fdata","config","cdata","activationState","onValue","defaultValue","onValueUpdate","onOnValue"]))],1024))]),_:1}),Object(o["createVNode"])(O,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(u,{color:"light"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(g,{disabled:e.disableBtn,onClick:e.onClose,slot:"start",color:"danger",size:"large"},{default:Object(o["withCtx"])(()=>[c]),_:1},8,["disabled","onClick"]),Object(o["createVNode"])(g,{disabled:e.disableBtn,onClick:e.onClear,slot:"end",color:"warning",size:"large"},{default:Object(o["withCtx"])(()=>[r]),_:1},8,["disabled","onClick"]),Object(o["createVNode"])(g,{disabled:e.disableBtn,onClick:e.onDone,slot:"end",color:"success",size:"large"},{default:Object(o["withCtx"])(()=>[a]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1})}var s=n("b5e4"),i=n("d95e"),d=n("8a30");function u(){const e={};return i["a"].forEach(t=>{e[t]=Object(o["defineAsyncComponent"])(()=>n("f159")(`./${t}.vue`))}),e}var b=Object(o["defineComponent"])({name:"SingleFieldTouchForm",components:{IonPage:d["D"],IonContent:d["n"],IonFooter:d["o"],IonToolbar:d["Q"],IonButton:d["d"],IonHeader:d["q"],IonTitle:d["P"],...u()},props:{dismissType:{type:String},onFinish:{type:Function,required:!0},currentField:{type:Object,required:!0}},data:()=>({valueClearIndex:0,formData:{},computedFormData:{},state:"",value:null,disableBtn:!1}),methods:{onClose(){"modal"===this.dismissType?d["X"].dismiss():this.$router.back()},onClear(){this.valueClearIndex+=1,this.value=null},onFieldValue(e){this.value=e},onDone(){if(this.disableBtn=!0,this.currentField.validation){const e=this.currentField.validation(this.value);if(this.disableBtn=!1,e)return Object(s["e"])(e.join(", "),6e4)}try{this.onFinish(this.value)}catch(e){Object(s["c"])(e),console.error(e)}this.onClose(),this.disableBtn=!1}}}),p=n("6b0d"),g=n.n(p);const O=g()(b,[["render",l]]);t["a"]=O}}]);
//# sourceMappingURL=chunk-e9cb8f64.2350c3de.js.map