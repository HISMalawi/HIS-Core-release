(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e2514"],{"7dd5":function(e,t,n){"use strict";n.r(t);var r=n("7a23");function a(e,t,n,a,i,o){var c=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(c,{fields:e.fields,activeField:e.activeField,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","activeField","onFinishAction","cancelDestinationPath"])}var i=n("1da1"),o=(n("d81d"),n("d3b7"),n("159b"),n("96cf"),n("d95e")),c=n("7920"),u=n("2706"),s=n("9283"),d=n("3d6c"),l=n("b5e4"),h=Object(r["defineComponent"])({components:{HisStandardForm:c["a"]},data:function(){return{activeField:"",fields:[],drugs:[],selectedDrugs:[],barcode:"",stockService:{}}},methods:{onFinish:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,a,i,o,c,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=e.enter_batches,a=[],i=0;case 3:if(!(i<r.length)){n.next=13;break}return o=r[i].value,c={current_quantity:o["current_quantity"],reason:e.reason.value},n.next=8,t.stockService.updateItem(o["pharmacy_batch_id"],c);case 8:u=n.sent,u||a.push("could not stock for "+r[i].shortName);case 10:i++,n.next=3;break;case 13:0===a.length?(Object(l["d"])("Stock succesfully updated"),t.$router.push("/")):Object(l["c"])("Could not save stock");case 14:case"end":return n.stop()}}),n)})))()},getFields:function(){var e=this;return[{id:"date",helpText:"Verfication Date",type:o["b"].TT_FULL_DATE,validation:function(e){return u["a"].required(e)}},{id:"enter_batches",helpText:"Batch entry",type:o["b"].TT_BATCH_VERIFICATION,options:function(){return e.drugs},validation:function(e){return u["a"].required(e)}},{id:"reason",helpText:"Select reason",type:o["b"].TT_SELECT,validation:function(e){return u["a"].required(e)},options:function(){return[{label:"Monthly stock take",value:"Monthly stock take"},{label:"Audit",value:"Audit"},{label:"Adhoc (due to stock imbalance)",value:"Adhoc (due to stock imbalance)"},{label:"Supervision",value:"Supervision"}]}},{id:"verification_summary",helpText:"Summary",type:o["b"].TT_TABLE_VIEWER,options:function(t){return e.buildResults(t.enter_batches)},config:{hiddenFooterBtns:["Clear"]}}]},buildResults:function(e){var t=["Drug","Total units","Expiry date"],n=e.map((function(e){var t=e.value;return[t.shortName,t["current_quantity"],s["a"].toStandardHisDisplayFormat(t.expiry_date)]}));return[{label:"Confirm entry",value:"Table",other:{columns:t,rows:n}}]},prepDrugs:function(e){var t=[],n=this.barcode;return e.enter_batches.value.forEach((function(r){t.push({batch_number:r.batchNumber,items:[{barcode:n,drug_id:r.drugID,expiry_date:r.expiry,quantity:parseInt(r.tabs)*parseInt(r.tins),delivery_date:e.date.value}]})})),t},selectAll:function(e){return e.map((function(e){return e.isChecked=!0,e}))},formatDrugs:function(){return this.stockService.drugList().map((function(e){return{label:e.shortName,value:e}}))}},created:function(){this.stockService=new d["a"],this.fields=this.getFields(),this.drugs=this.formatDrugs()}}),p=n("d959"),b=n.n(p);const f=b()(h,[["render",a]]);t["default"]=f}}]);
//# sourceMappingURL=chunk-2d0e2514.dadbfd2d.js.map