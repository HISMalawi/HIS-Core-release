(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6349c9bc"],{7920:function(e,t,i){"use strict";var a=i("7a23");function n(e,t,i,n,r,o){return Object(a["openBlock"])(),Object(a["createBlock"])(Object(a["resolveDynamicComponent"])(e.formType),{fields:e.fields,skipSummary:e.skipSummary,activeField:e.activeField,cancelDestinationPath:e.cancelDestinationPath,onOnFinish:e.onFinish,onFinish:e.onFinishAction,onOnIndex:e.onIndex},null,40,["fields","skipSummary","activeField","cancelDestinationPath","onOnFinish","onFinish","onOnIndex"])}var r=i("9441"),o=Object(a["defineComponent"])({name:"HisStandardForm",components:{TouchScreenForm:r["a"]},emits:["onFinish","onIndex"],data:()=>({formType:"touch-screen-form"}),props:{onFinishAction:{type:Function},skipSummary:{type:Boolean,default:!1},activeField:{type:String},fields:{type:Object,required:!0},cancelDestinationPath:{type:String,required:!1}},methods:{onFinish(e,t){this.$emit("onFinish",e,t)},onIndex(e){this.$emit("onIndex",e)}}}),s=i("6b0d"),l=i.n(s);const d=l()(o,[["render",n]]);t["a"]=d},"80b5":function(e,t,i){"use strict";i("13d5");var a=i("e86e"),n=i("d95e"),r=i("2706"),o=i("d10e"),s=i("b446"),l=i("9283"),d=i("23e6"),u=i("2ef0"),c=i("b5e4"),h=i("5713"),p=i("1c74");function m(e){return e.map(e=>({label:e,value:e}))}t["a"]={resolvePerson(e){let t={};for(const i in e){const a=e[i];Object(u["isPlainObject"])(a)&&"person"in a&&(Object(u["isPlainObject"])(a.person)?t={...t,...a.person}:t[i]=a["person"])}return t},getGivenNameField(){return{id:"given_name",helpText:"First name",type:n["b"].TT_TEXT,computedValue:e=>({person:e.value}),validation:e=>r["a"].isName(e),options:async e=>{if(e.given_name){const t=await o["a"].searchGivenName(e.given_name.value);return m(t)}return[]}}},getFamilyNameField(){return{id:"family_name",helpText:"Last name",type:n["b"].TT_TEXT,computedValue:e=>({person:e.value}),validation:e=>r["a"].isName(e),options:async e=>{if(e.family_name){const t=await o["a"].searchFamilyName(e.family_name.value);return m(t)}return[]}}},getGenderField(e){return{id:"gender",helpText:"Sex",type:n["b"].TT_SELECT,computedValue:e=>({person:e.value}),validation:e=>r["a"].required(e),options:()=>Object(u["isEmpty"])(e)?[{label:"Female",value:"F"},{label:"Male",value:"M"}]:e}},getDobConfig(e=!0){return{id:"birth_date",summaryLabel:"Date of Birth",helpText:e?"Birth":"",required:!0,minDate:()=>l["b"].estimateDateFromAge(100),maxDate:()=>o["a"].getSessionDate(),estimation:{allowUnknown:!0,allowUnknownMonthDay:!0,estimationFieldType:s["a"].AGE_ESTIMATE_FIELD},computeValue:(e,t)=>({date:e,isEstimate:t,person:{birthdate:e,birthdate_estimated:t}})}},getHomeRegionField(){return{id:"home_region",helpText:"Region of origin",type:n["b"].TT_SELECT,group:"person",requireNext:!1,computedValue:e=>({person:e.label}),validation:e=>r["a"].required(e),options:()=>Object(a["e"])()}},getHomeDistrictField(){return{id:"home_district",helpText:"District of origin",type:n["b"].TT_SELECT,requireNext:!1,summaryMapValue:(e,t)=>{var i;return{label:/foreign/i.test(""+(null===t||void 0===t||null===(i=t.home_region)||void 0===i?void 0:i.label))?"Home Country":"District of origin",value:e.label}},dynamicHelpText:e=>{var t;return/foreign/i.test(""+(null===e||void 0===e||null===(t=e.home_region)||void 0===t?void 0:t.label))?"Home Country":"District of origin"},computedValue:e=>({person:e.label}),options:e=>Object(a["a"])(e.home_region.value)}},addCustomLocationBtnForTAorVillage(e,t){return{name:"Add "+e,slot:"end",color:"success",onClick:async(i,a,n)=>{if("string"!=typeof n.filter||n.filter.length<3)return Object(c["e"])("Please enter a valid "+e);if(!Object(u["isEmpty"])(n.filtered))return Object(c["e"])("Can't add existing "+e);const r=await Object(c["a"])(`Do you want to add ${e} ${n.filter}?`);if(!r)return;const o=await h["a"].createAddress(e,n.filter,i[t].value);if(!o)return Object(c["e"])("Unable to add "+e);n.filter=n.filter.toUpperCase()}}},getHomeTaField(){return{id:"home_traditional_authority",helpText:"TA of origin",type:n["b"].TT_SELECT,requireNext:!1,config:{showKeyboard:!0,isFilterDataViaApi:!0,footerBtns:[this.addCustomLocationBtnForTAorVillage("TA","home_district")]},defaultOutput:()=>({label:"N/A",value:"N/A"}),computedValue:e=>({person:e.label}),validation:e=>r["a"].required(e),options:(e,t)=>Object(a["g"])(e.home_district.value,t)}},getHomeVillageField(){return{id:"home_village",helpText:"Village of origin",type:n["b"].TT_SELECT,config:{showKeyboard:!0,isFilterDataViaApi:!0,footerBtns:[this.addCustomLocationBtnForTAorVillage("Village","home_traditional_authority")]},requireNext:!1,defaultOutput:()=>({label:"N/A",value:"N/A"}),computedValue:e=>({person:e.label}),validation:e=>r["a"].required(e),options:(e,t)=>Object(a["h"])(e.home_traditional_authority.value,t)}},getCurrentRegionField(){return{id:"current_region",helpText:"Region of current residence",requireNext:!1,type:n["b"].TT_SELECT,computedValue:(e,t)=>/use home/i.test(""+e.value)?{person:{current_region:t.home_region.label,current_district:t.home_district.label,current_traditional_authority:t.home_traditional_authority.label,current_village:t.home_village.label}}:{person:e.label},validation:e=>r["a"].required(e),options:()=>Object(a["e"])(),config:{footerBtns:[{name:"Same as origin",slot:"end",onClickComponentEvents:{setValue:()=>"Use Home Address"},onClick:()=>"Use Home Address"}]}}},getCurrentDistrictField(){return{id:"current_district",helpText:"District",requireNext:!1,type:n["b"].TT_SELECT,summaryMapValue:(e,t)=>{var i;return{label:/foreign/i.test(""+(null===t||void 0===t||null===(i=t.home_region)||void 0===i?void 0:i.label))?"Current Country":"District of current residence",value:e.label}},dynamicHelpText:e=>e.current_region&&e.current_region.label.match(/foreign/i)?"Current Country":"District of current residence",computedValue:e=>({person:e.label}),validation:e=>r["a"].required(e),options:e=>Object(a["a"])(e.current_region.value)}},getCurrentTAfield(){return{id:"current_traditional_authority",helpText:"TA of current residence",requireNext:!1,type:n["b"].TT_SELECT,config:{showKeyboard:!0,isFilterDataViaApi:!0,footerBtns:[this.addCustomLocationBtnForTAorVillage("TA","current_district")]},defaultOutput:e=>{var t;if(!/use home/i.test(""+(null===(t=e.current_region)||void 0===t?void 0:t.label)))return{label:"N/A",value:"N/A"}},computedValue:e=>({person:e.label}),validation:e=>r["a"].required(e),options:(e,t)=>Object(a["g"])(e.current_district.value,t)}},getCurrentVillageField(){return{id:"current_village",helpText:"Village of current residence",requireNext:!1,type:n["b"].TT_SELECT,config:{showKeyboard:!0,isFilterDataViaApi:!0,footerBtns:[this.addCustomLocationBtnForTAorVillage("Village","current_traditional_authority")]},defaultOutput:e=>{var t;if(!/use home/i.test(""+(null===(t=e.current_region)||void 0===t?void 0:t.label)))return{label:"N/A",value:"N/A"}},computedValue:e=>({person:e.label}),validation:e=>r["a"].required(e),options:(e,t)=>Object(a["h"])(e.current_traditional_authority.value,t)}},getCellNumberField(){return{id:"cell_phone_number",helpText:"Cell phone number",group:"person",type:n["b"].TT_TEXT,computedValue:e=>({person:e.label}),validation:e=>{if(e){if(e.value.match(/Unknown|n\/a/i))return null;for(const t of(""+e.value).split("/"))if(r["a"].isMWPhoneNumber({label:t,value:t}))return[`"${t}" is not a valid phone number`];return null}return["Phone number cannot be empty"]},config:{customKeyboard:[[["1","2","3"],["4","5","6"],["7","8","9"],["","0",""]],[["+265","/"],["Unknown","N/A"],["Delete"]]]}}},getLandmarkFields(){return[{id:"default_landmarks",proxyID:"landmark",helpText:"Closest Landmark or Plot Number",type:n["b"].TT_SELECT,appearInSummary:e=>"Other"!=e.default_landmarks.value,computedValue:e=>({person:e.value}),validation:e=>r["a"].required(e),options:()=>m(["Catholic Church","CCAP","Seventh Day","Mosque","Primary School","Borehole","Secondary School","College","Market","Football Ground","Other"])},{id:"other_landmark",proxyID:"landmark",helpText:"Closest Landmark or Plot Number",type:n["b"].TT_NOTE,appearInSummary:e=>"Other"===e.default_landmarks.value,condition:e=>"Other"===e.default_landmarks.value,computedValue:e=>({person:e.value}),validation:e=>r["a"].required(e)}]},getFacilityLocationField(){return{id:"location",helpText:"Please select facility name",type:n["b"].TT_SELECT,computedValue:e=>({person:e.label}),validation:e=>r["a"].required(e),options:(e,t="")=>Object(a["b"])(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}}},getPersonNameFromPersonObj(e,t){return e.names.length?e.names[0][t]:""},getAttrFromPersonObj(e,t){return Array.isArray(e.person_attributes)&&e.person_attributes.length?e.person_attributes.reduce((e,i)=>i.type.name===t?i.value:e,""):""},getAddressFromPersonObj(e,t){if(Array.isArray(e.addresses)&&e.addresses.length){const i=e.addresses[0],a={home_district:"address2",home_village:"neighborhood_cell",home_traditional_authority:"county_district",current_village:"city_village",current_traditional_authority:"township_division",current_district:"state_province"};return i[a[t]]}return""},mapPersonData(e){const t=this.getPersonNameFromPersonObj(e,"given_name"),i=this.getPersonNameFromPersonObj(e,"family_name"),a=this.getAddressFromPersonObj(e,"home_district"),n=this.getAddressFromPersonObj(e,"home_village"),r=this.getAddressFromPersonObj(e,"home_traditional_authority");return{id:e.person_id,name:`${t} ${i}`,given_name:t,family_name:i,gender:e.gender,birth_date:e.birthdate,birthdate_estimated:e.birthdate_estimated,home_district:a,home_village:n,home_traditional_authority:r,home_address:`${a} ${n}`,current_district:this.getAddressFromPersonObj(e,"current_district"),current_traditional_authority:this.getAddressFromPersonObj(e,"current_traditional_authority"),cell_phone_number:this.getAttrFromPersonObj(e,"Cell Phone Number"),landmark:this.getAttrFromPersonObj(e,"Landmark Or Plot Number")}},getPersonAttributeOptions(e){const t=new d["a"](e),i=(e,t)=>t in e?e[t]():"-";return{label:t.getPatientInfoString(),value:t.getID()||t.getNationalID(),other:{patientID:t.getID(),npid:t.getNationalID(),person:e,options:[{label:"National ID",value:i(t,"getNationalID")},{label:"ARV Number",value:i(t,"getArvNumber"),other:{show:()=>"ART"===p["e"].getProgramName()}},{label:"Name",value:i(t,"getFullName")},{label:"Sex",value:i(t,"getGender")},{label:"Birthdate",value:i(t,"getBirthdate")},{label:"Home District",value:i(t,"getHomeDistrict")},{label:"Home Village",value:i(t,"getHomeVillage")},{label:"Current District",value:i(t,"getCurrentDistrict")},{label:"Current T/A",value:i(t,"getCurrentTA")},{label:"Cellphone",value:i(t,"getPhoneNumber")}]}}}}},"8d15":function(e,t,i){"use strict";i.r(t);var a=i("7a23");function n(e,t,i,n,r,o){const s=Object(a["resolveComponent"])("his-standard-form");return Object(a["openBlock"])(),Object(a["createBlock"])(s,{formLabel:e.formLabel,onOnIndex:t[0]||(t[0]=t=>e.fieldComponent=""),skipSummary:e.skipSummary,activeField:e.fieldComponent,fields:e.fields,onFinishAction:e.onFinish},null,8,["formLabel","skipSummary","activeField","fields","onFinishAction"])}i("14d9");var r=i("d95e"),o=i("7920"),s=i("b446"),l=i("2706"),d=i("23e6"),u=i("9283"),c=i("50e7"),h=i("2ef0"),p=i("80b5"),m=i("1f9a"),_=i("3e53"),g=i("0fa1"),b=i("0011"),v=i("fa73"),f=i("b5e4"),y=i("8df6"),T=i("7f35"),C=i("5a0c"),F=i.n(C),D=i("8734"),A=i("8e8b"),N=i("b432"),P=Object(a["defineComponent"])({components:{HisStandardForm:o["a"]},data:()=>({formLabel:"Find / Register",app:_["a"].getActiveApp(),ddeInstance:{},ddeDocID:"",ddeIsReassign:!1,skipSummary:!1,currentAddressAttributes:["current_region","current_district","current_village","current_traditional_authority"],homeAddressAttributes:["home_region","home_district","home_traditional_authority","home_village"],hasIncompleteData:!1,patient:{},editPersonData:{},editPerson:-1,personAttribute:"",activeField:"",fieldComponent:"",fields:[],isMilitarySite:!1,presets:{},registrationSummary:{},form:{},ddeEnabled:!1}),watch:{$route:{async handler({query:e}){this.ddeInstance=new v["a"],e.edit_person?(this.ddeIsReassign=e.dde_reassign,this.ddeDocID=e.doc_id,this.ddeInstance.setPatientID(e.edit_person),e.person_attribute&&(this.personAttribute=e.person_attribute),await this.initEditMode(e.edit_person)):this.presets=e,this.fields=this.getFields()},immediate:!0,deep:!0}},methods:{getFields(){let e=[];return e.push(this.personIndexField()),this.hasScannedNationalID()?e=e.concat(this.hiddenFieldsForScannedNationalID()):(e.push(this.givenNameField()),e.push(this.familyNameField()),e.push(this.genderField())),e.push(this.searchResultField()),e.push(this.hasNpidField()),e.push(this.scanNpid()),this.hasScannedNationalID()||(e=e.concat(this.dobFields())),e.push(this.homeRegionField()),e.push(this.homeDistrictField()),e.push(this.homeTAField()),e.push(this.homeVillageField()),e.push(this.currentRegionField()),e.push(this.currentDistrictField()),e.push(this.currentTAField()),e.push(this.currentVillage()),e=e.concat(this.landmarkFields()),e.push(this.cellPhoneField()),e.push(this.patientTypeField()),e.push(this.facilityLocationField()),e.push(this.occupationField()),e.push(this.relationshipField()),e.push(this.possibleDuplicatesField()),e},isEditMode(){return this.editPerson>=1},hasScannedNationalID(){return"true"===this.presets.nationalIDStatus},async initEditMode(e){this.editPerson=e,this.patient=await A["a"].get("ACTIVE_PATIENT",{patientID:parseInt(""+this.editPerson)});const{ancestryDistrict:t,ancestryTA:i,ancestryVillage:a,currentDistrict:n,currentVillage:r,currentTA:o}=this.patient.getAddresses();this.editPersonData={given_name:this.patient.getGivenName(),family_name:this.patient.getFamilyName(),gender:this.patient.getGender(),birthdate:this.patient.getBirthdate(),home_district:t,home_traditional_authority:i,home_village:a,current_district:n,current_village:r,current_traditional_authority:o,cell_phone_number:this.patient.getPhoneNumber(),landmark:this.patient.getClosestLandmark(),occupation:this.patient.getOccupation()},this.presets=this.editPersonData,this.skipSummary=!0,this.personAttribute&&(this.activeField=this.personAttribute,this.fieldComponent=this.activeField)},async onFinish(e,t){N["c"].value?(this.isEditMode()?this.update(t):this.create(e,t),N["b"].value=!1):this.createOffline(e,t)},createOffline(e,t){const{savePersonOffline:i}=Object(N["a"])(),a=p["a"].resolvePerson(t),n=this.resolvePersonAttributes(t),r=i("Client registration",a,n,null===e||void 0===e?void 0:e.npid);Object(g["b"])(r,this.$router)},async create(e,t){const i=p["a"].resolvePerson(t),a=this.resolvePersonAttributes(t),n=new m["a"],r=new d["a"](await n.registerPatient(i,a)),o=n.getPersonID();if(A["a"].set("ACTIVE_PATIENT",r),"true"==this.presets.nationalIDStatus&&(this.patient=r,await this.patient.updateMWNationalId(this.presets.malawiNationalID)),this.app.onRegisterPatient){const e=await this.app.onRegisterPatient(o,i,a,this.$router,this.$route,t);if(e)return}if("Yes"===i.relationship)return this.$router.push("/guardian/registration/"+o);await Object(g["b"])(o,this.$router)},async update(e){const t=p["a"].resolvePerson(e),i=new m["a"];i.setPersonID(this.editPerson),await i.updatePerson(t);for(const a in t)a in this.editPersonData&&(this.editPersonData[a]=t[a]);if(A["a"].invalidate("ACTIVE_PATIENT"),!this.personAttribute)return this.fieldComponent="edit_user";this.$router.back()},editConditionCheck(e=[]){return!(this.isEditMode()&&!e.includes(this.activeField))},async confirmPatient(){if(this.ddeEnabled&&(!this.patient.getDocID()||this.patient.getDocID()&&this.patient.getNationalID().match(/unknown/i)))try{await this.patient.assignNpid(),await this.patient.printNationalID(),await Object(D["a"])(300)}catch(e){Object(f["c"])("Failed to assign new NPID: "+e)}this.$router.push("/patients/confirm?person_id="+this.patient.getID())},resolvePersonAttributes(e){return Object.values(e).filter(e=>Object(h["isPlainObject"])(e)&&"personAttributes"in e).map(({personAttributes:e})=>e)},async resolveOnRegistrationCallbacks(e,t){for(const a of Object.values(t)){const t=a;if("function"===typeof t.onRegisterPatient)try{await t.onRegisterPatient(e)}catch(i){console.error(""+i),Object(f["c"])(""+i)}}},mapToOption(e){return e.map(e=>({label:e,value:e}))},hiddenFieldsForScannedNationalID(){const e=e=>({label:e,value:e});return[{id:"given_name",helpText:"First name",type:r["b"].TT_HIDDEN,defaultValue:()=>e(this.presets.given_name),computedValue:()=>({person:this.presets.given_name})},{id:"family_name",helpText:"Last name",type:r["b"].TT_HIDDEN,defaultValue:()=>e(this.presets.family_name),computedValue:()=>({person:this.presets.family_name})},{id:"gender",helpText:"Gender",type:r["b"].TT_HIDDEN,defaultValue:()=>({label:this.presets.gender,value:"male"===this.presets.gender.toLowerCase()?"M":"female"===this.presets.gender.toLowerCase()?"F":"N/A"}),computedValue:()=>({person:this.presets.gender})},{id:"scanned_birthdate",helpText:"Birth date",type:r["b"].TT_HIDDEN,defaultValue:()=>e(this.presets.birthdate),computedValue:()=>({person:{birthdate:this.presets.birthdate,birthdate_estimated:!1}})},{id:"scanned_national_id",helpText:"Scanned National ID",type:r["b"].TT_HIDDEN,defaultValue:()=>e(this.presets.malawiNationalID),computedValue:()=>({onRegisterPatient:async e=>{const t=await d["a"].findByID(e);this.patient=new d["a"](t),this.patient.updateMWNationalId(this.presets.malawiNationalID)}})}]},givenNameField(){const e=p["a"].getGivenNameField();return e.condition=()=>this.editConditionCheck(["given_name"]),e.defaultValue=()=>this.presets.given_name,e},familyNameField(){const e=p["a"].getFamilyNameField();return e.condition=()=>this.editConditionCheck(["family_name"]),e.defaultValue=()=>this.presets.family_name,e},genderField(){const e="ANC"===this.app.applicationName,t="CxCa"===this.app.applicationName,i=p["a"].getGenderField();return i.requireNext=this.isEditMode(),i.defaultValue=()=>this.presets.gender,i.condition=()=>!(!this.isEditMode()&&(e||t))&&this.editConditionCheck(["gender"]),!e&&!t||this.isEditMode()||(i.defaultOutput=()=>({label:"Female",value:"F"}),i.defaultComputedOutput=()=>({person:"F"})),i.beforeNext=async e=>{const t=e.value,i=this.presets.gender;if(this.isEditMode()&&t!=i){const e=await Object(T["a"])("Warning",`Changing gender from ${i} to ${t}`,"This change will cause data inconsistency and will affect alot of Reports.",[{name:"Cancel",slot:"start"},{name:"Change gender",slot:"end",color:"danger"}]);return"Change gender"===e}return!0},i},dobFields(){const e=p["a"].getDobConfig();if(e.defaultValue=()=>this.presets.birthdate,e.condition=()=>this.editConditionCheck(["year_birth_date","month_birth_date","day_birth_date"]),"ANC"===this.app.applicationName){const t=d["a"].getSessionDate(),i=12;e.maxDate=()=>F()(t).subtract(i,"years").format(u["a"])}return Object(s["b"])(e)},hasNpidField(){return{id:"has_npid",helpText:"National Patient Identifier (NPID) Barcode",type:r["b"].TT_YES_NO,isRequired:()=>!0,condition:()=>!this.isEditMode()&&N["b"].value||!N["c"].value,options:()=>[{label:"Has client brought NPID barcode?",value:"",values:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}]}]}},scanNpid(){return{id:"npid",helpText:"Scan National Patient Identifier (NPID)",type:r["b"].TT_BARCODE,requireNext:!1,condition:e=>/yes/i.test(""+e.has_npid),config:{hiddenFooterBtns:["Clear"]},isRequired:()=>!0}},homeRegionField(){return{...p["a"].getHomeRegionField(),condition:()=>this.editConditionCheck(this.homeAddressAttributes)}},homeDistrictField(){return{...p["a"].getHomeDistrictField(),condition:()=>this.editConditionCheck(this.homeAddressAttributes)}},homeTAField(){return{...p["a"].getHomeTaField(),condition:e=>this.editConditionCheck(this.homeAddressAttributes)&&!e.home_region.label.match(/foreign|use home/i)}},homeVillageField(){return{...p["a"].getHomeVillageField(),condition:e=>this.editConditionCheck(this.homeAddressAttributes)&&!e.home_region.label.match(/foreign|use home/i)}},currentRegionField(){const e=p["a"].getCurrentRegionField();return e.summaryMapValue=(e,t,i)=>{var a,n,r,o;return/use home/i.test(""+e.value)?[{label:"Current region",value:null===(a=i.person)||void 0===a?void 0:a.current_region},{label:"Current District/Country",value:null===(n=i.person)||void 0===n?void 0:n.current_district},{label:"Current Traditional Authority",value:null===(r=i.person)||void 0===r?void 0:r.current_traditional_authority},{label:"Current village",value:null===(o=i.person)||void 0===o?void 0:o.current_village}]:{label:"Current Region",value:e.label}},this.isEditMode()&&(e.computedValue=e=>{if(/use home/i.test(""+e.value))return{person:{current_district:this.editPersonData.home_district,current_traditional_authority:this.editPersonData.home_traditional_authority,current_village:this.editPersonData.home_village}}}),e.condition=()=>this.editConditionCheck(this.currentAddressAttributes),e},currentDistrictField(){const e=p["a"].getCurrentDistrictField();return e.condition=e=>!/use home/i.test(e.current_region.label)&&this.editConditionCheck(this.currentAddressAttributes),e},currentTAField(){const e=p["a"].getCurrentTAfield();return e.condition=e=>this.editConditionCheck(this.currentAddressAttributes)&&!e.current_region.label.match(/foreign|use home/i),e},currentVillage(){const e=p["a"].getCurrentVillageField();return e.condition=e=>this.editConditionCheck(this.currentAddressAttributes)&&!e.current_region.label.match(/foreign|use home/i),e},cellPhoneField(){const e=p["a"].getCellNumberField();return e.condition=()=>this.editConditionCheck(["cell_phone_number"]),e.defaultValue=()=>this.presets.cell_phone_number,e},facilityLocationField(){const e=p["a"].getFacilityLocationField();return e.condition=e=>["Drug Refill","External consultation"].includes(e.patient_type.value),e},landmarkFields(){const e=p["a"].getLandmarkFields();return e[0].condition=()=>this.editConditionCheck(["default_landmarks"]),e},patientTypeField(){return{id:"patient_type",helpText:"Type of patient",type:r["b"].TT_SELECT,computedValue:e=>({person:e.value}),condition:()=>this.editConditionCheck(["patient_type"])&&"ART"===this.app.applicationName,validation:e=>l["a"].required(e),options:()=>y["a"].getPatientTypes()}},occupationField(){return{id:"occupation",helpText:"Occupation",type:r["b"].TT_SELECT,init:async()=>(this.isMilitarySite=await A["a"].get("IS_MILITARY_SITE"),!0),computedValue:e=>({person:e.value}),condition:()=>this.editConditionCheck(["occupation"])&&this.isMilitarySite,validation:e=>l["a"].required(e),options:()=>this.mapToOption(["Military","Civilian"])}},regimentField(){return{id:"person_regiment_id",helpText:"Regiment ID",type:r["b"].TT_TEXT,computedValue:({value:e})=>({personAttributes:{person_attribute_type_id:35,value:e}}),condition:e=>this.editConditionCheck(["person_regiment_id","occupation"])&&e.occupation&&e.occupation.value.match(/Military/i),validation:e=>l["a"].required(e)}},rankField(){return{id:"rank",helpText:"Rank",type:r["b"].TT_SELECT,validation:e=>l["a"].required(e),computedValue:({value:e})=>({personAttributes:{person_attribute_type_id:36,value:e}}),condition:e=>this.editConditionCheck(["rank","occupation"])&&e.occupation&&e.occupation.value.match(/Military/i),options:()=>this.mapToOption(["First Lieutenant","Captain","Major","Lieutenant Colonel","Colonel","Brigadier General","Lieutenant General","General","Private","Corporal","Lance Corporal","Seargent","Staff Seargent","Warrant Officer class 1","Warrant Officer class 2"])}},dateJoinedMilitaryFields(){return Object(s["b"])({id:"person_date_joined_military",helpText:"Joined Military",required:!0,condition:e=>this.editConditionCheck(["year_person_date_joined_military","month_person_date_joined_military","day_person_date_joined_military","occupation"])&&e.occupation&&e.occupation.value.match(/Military/i),minDate:()=>u["b"].estimateDateFromAge(100),maxDate:()=>c["a"].getSessionDate(),estimation:{allowUnknown:!1},computeValue:e=>({date:e,personAttributes:{person_attribute_type_id:37,value:e}})})},relationshipField(){const e="ITS"===this.app.applicationName,t="CxCa"===this.app.applicationName,i="OPD"===this.app.applicationName,a="Registration"===this.app.applicationName;return{id:"relationship",helpText:"Register guardian?",type:r["b"].TT_SELECT,computedValue:e=>({person:e.value}),condition:()=>this.editConditionCheck(["relationship"])&&!t&&!i&&!a&&!e,validation:e=>l["a"].required(e),options:()=>this.mapToOption(["Yes","No"])}},searchResultField(){return{id:"results",helpText:"Search results",type:r["b"].TT_PERSON_RESULT_VIEW,init:async()=>(this.isEditMode()||(this.ddeEnabled=await A["a"].get("IS_DDE_ENABLED")),!0),dynamicHelpText:e=>`Search results for "${e.given_name.value} ${e.family_name.value} | ${e.gender.label}"`,appearInSummary:()=>!1,condition:()=>!this.isEditMode()&&!N["b"].value,options:async e=>{const t={given_name:e.given_name.value,family_name:e.family_name.value,gender:e.gender.value};if(this.ddeEnabled){const e=await this.ddeInstance.searchDemographics(t);return e.map(e=>{const t=p["a"].getPersonAttributeOptions(e);return t.other.options.push({label:"Patient Type",value:e.patient_type}),t.other.options.push({label:"Doc ID",value:e.doc_id}),t})}const i=await d["a"].search(t);return i.map(e=>p["a"].getPersonAttributeOptions(e))},config:{hiddenFooterBtns:["Clear","Next","Back"],footerBtns:[{name:"Edit Search",slot:"end",onClick:()=>{this.fieldComponent="given_name"},state:{disabled:{default:()=>this.hasScannedNationalID()}}},{name:"New Client",slot:"end",onClick:()=>{this.fieldComponent="_NEXT_FIELD_"}},{name:"Continue",color:"success",slot:"end",state:{disabled:{default:()=>!0,onValue(e,t){return Object(h["isEmpty"])(t.results)}}},onClick:e=>e.results.other.patientID?this.$router.push("/patients/confirm?person_id="+e.results.value):this.$router.push("/patients/confirm?patient_barcode="+e.results.value)}]}}},possibleDuplicatesField(){let e={},t={};return{id:"possible_duplicates",helpText:"Possible Duplicate(s)",type:r["b"].TT_PERSON_MATCH_VIEW,condition:async(i,a)=>!!(this.ddeEnabled&&this.editPerson<=0)&&(e=p["a"].resolvePerson(a),t=await this.ddeInstance.checkPotentialDuplicates(e),t.length>=1),options:async()=>{const i=e=>u["b"].toStandardHisDisplayFormat(e);return t.map(({score:t,person:a})=>{const n=`${a.given_name} ${a.family_name}`;return{label:n,value:a.patient_id,other:{score:100*t+"%",newPerson:e,foundPerson:a,docID:a.id,comparisons:[["Name",`${e.given_name} ${e.family_name}`,`${a.given_name} ${a.family_name}`],["Gender",e.gender,a.gender],["Birthdate",i(e.birthdate),i(a.birthdate)],["Home District",e.home_district,a.home_district],["Home TA",e.home_traditional_authority,a.home_traditional_authority]]}}})},config:{hiddenFooterBtns:["Clear","Next"],footerBtns:[{name:"Not Duplicate",slot:"start",state:{visible:{default:()=>!1,onValue:(e,t)=>!Object(h["isEmpty"])(t.possible_duplicates)}},onClick:()=>{this.fieldComponent="_NEXT_FIELD_"}},{name:"Select",slot:"end",color:"success",state:{visible:{default:()=>!1,onValue:(e,t)=>!Object(h["isEmpty"])(t.possible_duplicates)}},onClick:e=>{this.ddeInstance.importPatient(e.possible_duplicates.other.docID).then(e=>{this.$router.push("/patients/confirm?person_id="+e.patient_id)}).catch(()=>{this.$router.push("/patients/confirm?person_id="+e.possible_duplicates.value)})}}]}}},personIndexField(){return{id:"edit_user",helpText:"Edit Demographics",type:r["b"].TT_TABLE_VIEWER,init:async()=>(this.isEditMode()&&(this.formLabel="View / Edit",this.ddeEnabled=await A["a"].get("IS_DDE_ENABLED"),this.isMilitarySite=await A["a"].get("IS_MILITARY_SITE")),!0),condition:()=>this.isEditMode(),options:async()=>{const e=e=>({name:"Edit",type:"button",action:()=>{this.activeField=e,this.fieldComponent=this.activeField}}),t=["Attributes","Values","Edit"],i=[["Given Name",this.editPersonData.given_name,e("given_name")],["Family Name",this.editPersonData.family_name,e("family_name")],["Gender",this.editPersonData.gender,e("gender")],["Birthdate",u["b"].toStandardHisDisplayFormat(this.editPersonData.birthdate),e("year_birth_date")],["Cell Phone Number",this.editPersonData.cell_phone_number,e("cell_phone_number")],["Home District",this.editPersonData.home_district,e("home_region")],["Home TA",this.editPersonData.home_traditional_authority,e("home_region")],["Home Village",this.editPersonData.home_village,e("home_region")],["Current district",this.editPersonData.current_district,e("current_region")],["Current Village",this.editPersonData.current_village,e("current_region")],["Current T/A",this.editPersonData.current_traditional_authority,e("current_region")],["Landmark",this.editPersonData.landmark,e("default_landmarks")]];this.isMilitarySite&&i.push(["Occupation",this.editPersonData.occupation,e("occupation")]);const a={indexes:[],class:"his-empty-set-color"};return i.forEach((e,t)=>{Object(b["e"])(e[1])&&a.indexes.push(t)}),this.hasIncompleteData=a.indexes.length>=1,[{label:"",value:"",other:{rows:i,columns:t,rowColors:[a]}}]},config:{footerBtns:[{name:"Reassign",slot:"end",color:"success",state:{visible:{default:()=>!1,onload:()=>this.ddeEnabled&&this.ddeIsReassign&&!this.hasIncompleteData}},onClick:async()=>{try{await this.ddeInstance.reassignNpid(this.ddeDocID,this.editPerson),await this.ddeInstance.printNpid(),this.$router.push("/patients/confirm?person_id="+this.editPerson)}catch(e){Object(f["e"])(""+e)}}},{name:"Confirm",slot:"end",color:"warning",state:{visible:{onload:()=>!this.ddeIsReassign&&!this.hasIncompleteData}},onClick:async()=>this.confirmPatient()}],hiddenFooterBtns:["Clear","Next"]}}}}}),E=i("6b0d"),I=i.n(E);const O=I()(P,[["render",n]]);t["default"]=O},e86e:function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"d",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"f",(function(){return l})),i.d(t,"e",(function(){return d})),i.d(t,"a",(function(){return u})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return h}));var a=i("5713"),n=i("2ef0");async function r(e=""){const t=await a["a"].getFacilities({name:e});return t.filter(e=>!Object(n["isEmpty"])(e)&&""!=e.name.trim()).map(e=>({label:e.name,value:e.location_id,other:e}))}async function o(e=""){const t=await a["a"].getLabs({search_name:e});return t.map(e=>({label:e,value:e}))}async function s(e=""){const t=await a["a"].getFacilities({name:e,tag:"Facility adult sections"});return t.map(e=>({label:e.name,value:e.name,other:e}))}async function l(){const e=await a["a"].getSpecialistClinics();return e.map(e=>({label:e.name,value:e.name,other:e}))}async function d(){const e=await a["a"].getRegions();return e.map(e=>({label:e.name,value:e.region_id,other:e}))}async function u(e){const t=await a["a"].getDistricts(e);return t.map(e=>({label:e.name,value:e.district_id,other:e}))}async function c(e,t=""){const i=await a["a"].getTraditionalAuthorities(e,t);return i.map(e=>({label:e.name,value:e.traditional_authority_id,other:e}))}async function h(e,t=""){const i=await a["a"].getVillages(e,t);return i.map(e=>({label:e.name,value:e.village_id,other:e}))}}}]);
//# sourceMappingURL=chunk-6349c9bc.ce02d366.js.map