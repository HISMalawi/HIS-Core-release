(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-754cc41c"],{2230:function(e,t,o){},2929:function(e,t,o){"use strict";o("2230")},"857e":function(e,t,o){"use strict";o.r(t);var a=o("7a23");const i={class:"his-card"};function r(e,t,o,r,c,n){const l=Object(a["resolveComponent"])("ion-title"),s=Object(a["resolveComponent"])("ion-toolbar"),u=Object(a["resolveComponent"])("barcode-input"),b=Object(a["resolveComponent"])("ion-header"),p=Object(a["resolveComponent"])("ion-label"),d=Object(a["resolveComponent"])("ion-item"),O=Object(a["resolveComponent"])("ion-col"),j=Object(a["resolveComponent"])("ion-text"),v=Object(a["resolveComponent"])("ion-row"),N=Object(a["resolveComponent"])("ion-grid"),x=Object(a["resolveComponent"])("ion-content"),f=Object(a["resolveComponent"])("ion-button"),y=Object(a["resolveComponent"])("ion-footer"),h=Object(a["resolveComponent"])("ion-page");return Object(a["openBlock"])(),Object(a["createBlock"])(h,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(b,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{color:"light"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(l,{class:"ion-text-center his-md-text"},{default:Object(a["withCtx"])(()=>{var t;return[Object(a["createElementVNode"])("b",null,Object(a["toDisplayString"])((null===(t=e.kits[e.activeIndex])||void 0===t?void 0:t.kitName)||"-"),1)]}),_:1})]),_:1}),Object(a["createVNode"])(s,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(u,{style:{margin:"0px auto",width:"90%"},onOnScan:e.onScan},null,8,["onOnScan"])]),_:1})]),_:1}),Object(a["createVNode"])(x,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.kits,(t,o)=>(Object(a["openBlock"])(),Object(a["createBlock"])(v,{onClick:()=>e.activeIndex=o,class:Object(a["normalizeClass"])(e.activeIndex===o?"his-card active":""),key:o},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(O,{size:"4"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",i,[Object(a["createVNode"])(d,{lines:"none"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(p,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Kit name ")]),_:1}),Object(a["createVNode"])(p,{slot:"end"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("b",null,Object(a["toDisplayString"])(t.kitName),1)]),_:2},1024)]),_:2},1024)])]),_:2},1024),Object(a["createVNode"])(O,{size:"4"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["his-card",t.expiryDate&&!t.lotNo?"error":""])},[Object(a["createVNode"])(d,{onClick:t=>e.updateLot(o),lines:"none"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(p,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Lot No. ")]),_:1}),Object(a["createVNode"])(p,{slot:"end"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("b",null,Object(a["toDisplayString"])(t.lotNo),1)]),_:2},1024)]),_:2},1032,["onClick"])],2)]),_:2},1024),Object(a["createVNode"])(O,{size:"4"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["his-card",!t.expiryDate&&t.lotNo?"error":""])},[Object(a["createVNode"])(d,{onClick:t=>e.updateExpiryDate(o),lines:"none"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(p,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Expiry Date ")]),_:1}),Object(a["createVNode"])(p,{color:t.expiryDateError?"danger":"",slot:"end"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("b",null,Object(a["toDisplayString"])(t.expiryDate),1)]),_:2},1032,["color"])]),_:2},1032,["onClick"]),t.expiryDateError?(Object(a["openBlock"])(),Object(a["createBlock"])(j,{key:0,color:"danger",class:"ion-text-center"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(t.expiryDateError),1)]),_:2},1024)):Object(a["createCommentVNode"])("",!0)],2)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})]),_:1}),Object(a["createVNode"])(y,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{color:"light"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(f,{onClick:e.clear,slot:"end",color:"warning",size:"large"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Clear ")]),_:1},8,["onClick"]),Object(a["createVNode"])(f,{onClick:e.save,disabled:!e.canFinish||e.hasErrors,slot:"end",color:"success",size:"large"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Finish ")]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})}var c=o("d867"),n=o("efaf"),l=o("c731"),s=o("d95e"),u=o("b5e4"),b=o("afbc"),p=o("cd10"),d=o("1c74"),O=Object(a["defineComponent"])({components:{IonGrid:c["p"],IonCol:c["m"],IonRow:c["H"],IonPage:c["D"],IonTitle:c["R"],IonHeader:c["q"],IonToolbar:c["S"],IonContent:c["n"],IonFooter:c["o"],IonButton:c["d"],BarcodeInput:n["a"],IonItem:c["w"],IonLabel:c["x"],IonText:c["O"]},setup(){const{kits:e,initKits:t,saveKits:o}=Object(p["b"])(),i=Object(a["ref"])(0),r=Object(a["ref"])(!1),c=Object(a["computed"])(()=>e.value.some(t=>!t.lotNo&&t.expiryDate||!t.expiryDate&&t.lotNo||e.value.some(e=>e.expiryDateError))),n=()=>{e.value.forEach(e=>(e.expiryDate&&new Date(e.expiryDate)<=new Date(d["e"].getSessionDate())?e.expiryDateError="Kit has expired!!":e.expiryDateError="",e))};function O(t){Object(l["b"])({id:"lot",helpText:e.value[t].kitName+" Lot No.",type:s["b"].TT_TEXT,defaultValue:()=>e.value[t].lotNo},o=>{const a=(null===o||void 0===o?void 0:o.value)||"";if(0===i.value)return e.value.forEach(e=>{"profession_hiv_kit"===e.testGroup&&(e.lotNo=a)}),void(e.value[t].expiryDate&&(i.value=5));e.value[t].expiryDate&&v(),e.value[t].lotNo=a})}function j(t){Object(l["b"])({id:"expiry",helpText:e.value[t].kitName+" Expiry Date",type:s["b"].TT_FULL_DATE,defaultValue:()=>e.value[t].expiryDate},o=>{const a=(null===o||void 0===o?void 0:o.value)||"";if(/all/i.test(""+e.value[i.value].kitName))return e.value.forEach(e=>{"profession_hiv_kit"===e.testGroup&&(e.expiryDate=a)}),e.value[t].lotNo&&(i.value=5),void n();e.value[t].lotNo&&v(),e.value[t].expiryDate=a,n()})}function v(){i.value+1===e.value.length?i.value=0:++i.value}function N(t){/all/i.test(""+e.value[i.value].kitName)&&e.value.forEach(e=>{"profession_hiv_kit"===e.testGroup&&(e.lotNo=t)}),e.value[i.value].lotNo=t,e.value[i.value].expiryDate?v():j(i.value)}async function x(){await Object(u["a"])("Are you sure you want to clear everything?")&&(e.value.forEach(e=>{e.expiryDate="",e.lotNo="",e.expiryDateError=""}),i.value=0)}async function f(){if(n(),c.value)return Object(u["e"])("Some kits have errors! please fix them below");if(!e.value.every(e=>!(e.lotNo&&e.expiryDate))||await Object(u["a"])("Do you want to continue without updating test kits?")){r.value=!1;try{return await o(),Object(u["d"])("Testkits updated!"),b["a"].back()}catch(t){Object(u["c"])("General error has occured!")}r.value=!0}}return Object(a["onMounted"])(()=>t().then(()=>{n(),r.value=!0})),{kits:e,activeIndex:i,hasErrors:c,canFinish:r,save:f,switchIndex:v,onScan:N,updateLot:O,updateExpiryDate:j,clear:x}}}),j=(o("2929"),o("d959")),v=o.n(j);const N=v()(O,[["render",r],["__scopeId","data-v-f97b0918"]]);t["default"]=N},cd10:function(e,t,o){"use strict";o.d(t,"a",(function(){return a})),o.d(t,"b",(function(){return n}));var a,i=o("1c74"),r=o("2ef0"),c=o("7a23");function n(){const e=Object(c["ref"])([]),t=async()=>{try{const e=await i["e"].getJson("user_properties",{property:"HTS_PROGRAMS"});return e.property_value.split(",").map(e=>e.trim())}catch(e){console.error(""+e)}},o=async()=>{const o=[{kitName:"All (Determine, Unigold, Bioline)",lotNo:"",expiryDate:"",testGroup:"profession_hiv_kit",visible:!0,userProp:"HIV Test"},{kitName:a.UNIGOLD,lotNo:"",expiryDate:"",testGroup:"profession_hiv_kit",visible:!0,userProp:"HIV Test"},{kitName:a.DETERMINE,lotNo:"",expiryDate:"",testGroup:"profession_hiv_kit",visible:!0,userProp:"HIV Test"},{kitName:a.DETERMINE_REPEAT,lotNo:"",expiryDate:"",testGroup:"profession_hiv_kit",visible:!0,userProp:"HIV Test"},{kitName:a.BIOLINE,lotNo:"",expiryDate:"",testGroup:"profession_hiv_kit",visible:!0,userProp:"HIV Test"},{kitName:a.HIV_SELF_KIT,lotNo:"",expiryDate:"",visible:!0},{kitName:a.SYPHILIS,lotNo:"",expiryDate:"",visible:!0,userProp:"Syphilis Test"},{kitName:a.HEPATITIS,lotNo:"",expiryDate:"",visible:!0,userProp:"Hepatitis B Test"}];try{const c=await t(),n=await i["e"].getJson("user_properties",{property:a.TEST_KIT_USER_PROPERTY}),l=JSON.parse(n.property_value);o.forEach(e=>{e.userProp&&(e.visible=c.includes(e.userProp));const t=Object(r["find"])(l,{kitName:e.kitName});t&&(e.lotNo=t.lotNo,e.expiryDate=t.expiryDate)}),e.value=o.filter(e=>e.visible)}catch(c){e.value=o,console.error(""+c)}},n=t=>{const o=Object(r["find"])(e.value,{kitName:t});return o?new Date(o.expiryDate)<=new Date(i["e"].getSessionDate())?"":o.lotNo:""},l=t=>{const o=Object(r["find"])(e.value,{kitName:t});return o?new Date(o.expiryDate)<=new Date(i["e"].getSessionDate())?"":o.expiryDate:""},s=async()=>{const t=await i["e"].postJson("user_properties",{property:a.TEST_KIT_USER_PROPERTY,property_value:JSON.stringify(e.value)});return!!t};return{kits:e,initKits:o,saveKits:s,getLotNo:n,getExpiryDate:l}}(function(e){e["TEST_KIT_USER_PROPERTY"]="hts_user_assigned_kits",e["HIV_SELF_KIT"]="HIV self-kit",e["SYPHILIS"]="Syphilis",e["HEPATITIS"]="Hepatitis B",e["BIOLINE"]="Bioline",e["DETERMINE"]="Determine",e["DETERMINE_REPEAT"]="Determine (Repeat)",e["UNIGOLD"]="Unigold"})(a||(a={}))}}]);
//# sourceMappingURL=chunk-754cc41c.a931fcb4.js.map