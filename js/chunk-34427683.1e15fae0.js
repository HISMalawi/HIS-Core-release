(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-34427683"],{2171:function(e,t,o){},7101:function(e,t,o){"use strict";o.r(t);var n=o("7a23");const a=e=>(Object(n["pushScopeId"])("data-v-24215c3e"),e=e(),Object(n["popScopeId"])(),e),r=a(()=>Object(n["createElementVNode"])("b",{style:{color:"#8b4513"}},"National ",-1)),s=a(()=>Object(n["createElementVNode"])("b",{style:{color:"#cd853f"}},"EMR",-1)),c={slot:"start"},l=["src"],i=["src"];function d(e,t,o,a,d,u){const p=Object(n["resolveComponent"])("ion-label"),b=Object(n["resolveComponent"])("ion-title"),_=Object(n["resolveComponent"])("ion-toolbar"),O=Object(n["resolveComponent"])("ion-header"),m=Object(n["resolveComponent"])("inputs"),j=Object(n["resolveComponent"])("ion-content"),h=Object(n["resolveComponent"])("ion-select-option"),f=Object(n["resolveComponent"])("ion-select"),g=Object(n["resolveComponent"])("ion-button"),I=Object(n["resolveComponent"])("ion-item"),v=Object(n["resolveComponent"])("ion-footer"),w=Object(n["resolveComponent"])("ion-page");return Object(n["openBlock"])(),Object(n["createBlock"])(w,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(_,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:Object(n["withCtx"])(()=>[r,s]),_:1})]),_:1}),Object(n["createVNode"])(p,{class:"ion-padding",slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(" Version: "),Object(n["createElementVNode"])("b",null,Object(n["toDisplayString"])(e.version),1)]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(j,{fullscreen:"false",style:{}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{useVirtualInput:e.useVirtualInputOnly},null,8,["useVirtualInput"])]),_:1}),Object(n["createVNode"])(v,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(_,null,{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("span",c,[Object(n["createElementVNode"])("img",{id:"coat",src:e.coatImg,alt:"Malawi Coat of Arms logo"},null,8,l),Object(n["createElementVNode"])("img",{id:"pepfar",src:e.pepfarImg,alt:"PEPFAR logo"},null,8,i)]),Object(n["createVNode"])(I,{class:"his-sm-text",style:{width:"75%"},slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("Device Profile")]),_:1}),Object(n["createVNode"])(f,{modelValue:e.profile,"onUpdate:modelValue":t[0]||(t[0]=t=>e.profile=t),value:e.profile},{default:Object(n["withCtx"])(()=>[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.deviceProfiles,(e,t)=>(Object(n["openBlock"])(),Object(n["createBlock"])(h,{key:t,value:e.label},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","value"]),Object(n["createVNode"])(g,{color:"dark",fill:"outline",size:"large",slot:"end","router-link":"/settings/host"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(" Network ")]),_:1}),e.otherApps.length?(Object(n["openBlock"])(),Object(n["createBlock"])(g,{key:0,color:"dark",fill:"outline",size:"large",slot:"end",onClick:e.openSelect},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(" Other Applications ")]),_:1},8,["onClick"])):Object(n["createCommentVNode"])("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}const u={class:"main",ref:"main"},p={class:"rows"},b={class:"cells"},_=["readonly"],O={class:"rows input-rows"},m={class:"cells"},j=["readonly"],h={class:"rows"},f=["id"],g=["id"];function I(e,t,o,a,r,s){return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createElementVNode"])("div",u,[Object(n["createElementVNode"])("div",p,[Object(n["createElementVNode"])("div",b,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":t[0]||(t[0]=t=>e.userInput.username=t),onClick:t[1]||(t[1]=t=>e.renderKeyBoard(t)),class:"input-boxes",readonly:e.useVirtualInput},null,8,_),[[n["vModelText"],e.userInput.username]])])]),Object(n["createElementVNode"])("div",O,[Object(n["createElementVNode"])("div",m,[Object(n["withDirectives"])(Object(n["createElementVNode"])("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.userInput.password=t),type:"password",name:"password",ref:"password",id:"password",onClick:t[3]||(t[3]=t=>e.renderKeyBoard(t)),class:"input-boxes",placeholder:"Password",readonly:e.useVirtualInput},null,8,j),[[n["vModelText"],e.userInput.password]])])])],512),Object(n["createElementVNode"])("div",{id:"keyboard",style:Object(n["normalizeStyle"])(e.btnStyles),class:"keyboard"},[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.LOGIN_KEYBOARD,(o,a)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",{key:a},[Object(n["createElementVNode"])("div",h,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(o,o=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{class:"cells",key:o},["Next"===o||"Login"===o?(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:0,id:e.btnCaption,class:"keyboard-btn login-btn",onClick:t[4]||(t[4]=t=>e.keyPress(t))},Object(n["toDisplayString"])(e.btnCaption),9,f)):Object(n["createCommentVNode"])("",!0),"Login"!=o&&"Next"!=o?(Object(n["openBlock"])(),Object(n["createElementBlock"])("button",{key:1,id:e.Caps.on?o.toUpperCase():o.toLowerCase(),class:"keyboard-btn",onClick:t[5]||(t[5]=t=>e.keyPress(t))},Object(n["toDisplayString"])("Del."===o||"Caps"===o?o:e.Caps.on?o.toUpperCase():o.toLowerCase()),9,g)):Object(n["createCommentVNode"])("",!0)]))),128))])]))),128))],4)],64)}o("14d9");var v=o("b5e4"),w=o("89b4"),y=o("3800"),E=o("b432"),C=o("1c74"),k=o("8e3d");const N=Object(k["a"])("IndexedDBStorage"),S=[{key:"villages",endpoint:"villages"},{key:"traditional_authorities",endpoint:"traditional_authorities"},{key:"districts",endpoint:"districts"},{key:"regions",endpoint:"regions"},{key:"locations",endpoint:"locations"}];async function V(){for(const t of S)if(!await N.existsinStorage(t.key))try{const e=await C["e"].getJson(t.endpoint,{paginate:!1});N.saveToStorage(t.key,e)}catch(e){console.warn(`Issue loading/saving metadata ${t}: ${e}`)}}var D=o("d867"),P=Object(n["defineComponent"])({props:{useVirtualInput:{type:Boolean}},data:function(){return{LOGIN_KEYBOARD:y["g"],auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new w["a"]},methods:{renderKeyBoard(e){this.focusInput=e.currentTarget,"password"==this.focusInput.id?this.btnCaption="Login":this.btnCaption="Next";let t=e.currentTarget.getBoundingClientRect().top;t=parseInt(t),this.keyboardTop=t+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(e){const t=e.currentTarget.id;let o;try{t.match(/Del./i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):t.match(/Next/i)?(this.display="none",o=this.$refs.password,o.click()):t.match(/Login/i)?(this.display="none",this.doLogin()):t.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",o="username"===this.focusInput.id?this.$refs.username:this.$refs.password,o.click()):t.match(/Hide/i)?this.display="none":this.focusInput.value+=t,"username"==this.focusInput.id?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(n){console.warn("input error")}},doLogin:async function(){if(this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!await this.auth.checkTimeIntegrity())throw"Local date does not match API date. Please Update your device's date";await this.auth.login(this.userInput.password),this.auth.startSession(),E["b"].value=!1,(await D["Y"].create({message:"Loading metadata, this may take a while...",backdropDismiss:!1})).present(),await V(),D["Y"].getTop().then(e=>e&&D["Y"].dismiss()),this.$router.push("/select_hc_location")}catch(e){e instanceof w["c"]?Object(v["e"])("Invalid username or password"):Object(v["c"])("Unable to login. Please contact your local administrator for assistance",5e4)}}else Object(v["e"])("Complete form to log in")}},computed:{btnStyles(){return`display: ${this.display}; top: ${this.keyboardTop};`}}}),B=(o("7e29"),o("6b0d")),x=o.n(B);const T=x()(P,[["render",I],["__scopeId","data-v-7d6519b2"]]);var L=T,A=o("1718"),M=o("a1e9"),R=o("5c40"),U=o("2ed9"),K=o("2ef0"),$=o("7f35"),F=Object(n["defineComponent"])({name:"login",components:{IonItem:D["w"],Inputs:L,IonButton:D["d"],IonTitle:D["S"],IonLabel:D["x"],IonPage:D["D"],IonHeader:D["q"],IonToolbar:D["T"],IonContent:D["n"],IonFooter:D["o"],IonSelect:D["L"],IonSelectOption:D["M"]},setup(){const e=Object(M["u"])([]),t=async()=>{const t=await Object($["c"])("Application Selection","Please specify the application you wish to use",e.value.map(e=>e.name),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(t.selection&&"Cancel"!=t.action){const o=e.value.find(e=>e.name===t.selection);window.open(`${o.protocol||"http"}://${o.IP}:${o.port||80}`,"_blank")}},{activePlatformProfile:o,platformProfiles:a}=Object(U["e"])(),r=Object(M["u"])(""),s=Object(M["u"])(""),c=Object(n["computed"])(()=>o.value.keyboard===U["b"].HIS_KEYBOARD_ONLY),l=Object.keys(a.value).map(e=>({label:e,value:{profileName:e,...a.value[e]}}));return Object(n["watch"])(s,e=>{o.value=(Object(K["find"])(l,{label:e})||{}).value}),Object(R["Ab"])(async()=>{var t,n;const a=new w["a"];e.value=(null===(t=await a.loadConfig())||void 0===t?void 0:t.otherApps)||[];const c=a.getHeadVersion();a.setActiveVersion(c);const l=await a.getApiVersion();r.value=`${c} / ${l}`,s.value=(null===(n=o.value)||void 0===n?void 0:n.profileName)||""}),{version:r,profile:s,otherApps:e,deviceProfiles:l,useVirtualInputOnly:c,activePlatformProfile:o,coatImg:Object(A["a"])("login-logos/Malawi-Coat_of_arms_of_arms.png"),pepfarImg:Object(A["a"])("login-logos/PEPFAR.png"),showConfig:"true"===localStorage.getItem("useLocalStorage"),openSelect:t}}});o("9f07");const W=x()(F,[["render",d],["__scopeId","data-v-24215c3e"]]);t["default"]=W},"7e29":function(e,t,o){"use strict";o("92b8")},"8e3d":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return storageFactory}));var _home_andrew_dev_Projects_HIS_Core_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ade3"),lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("2ef0"),lodash__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);const INDEX_STORE="openmrs",DB_NAME="offline_db",storageFactory=(storageName="IndexedDBStorage")=>eval(`new ${storageName}()`);class LocalStorage{existsinStorage(e){const t=localStorage.getItem(e);return t?Promise.resolve(!0):Promise.resolve(!1)}getFromStorage(e){return new Promise((t,o)=>{const n=localStorage.getItem(e);if(n)return t(JSON.parse(n));t([])})}deleteFromStorage(e){return localStorage.removeItem(e),!0}saveToStorage(e,t){return localStorage.setItem(e,JSON.stringify(t)),!0}}class IndexedDBStorage{constructor(){Object(_home_andrew_dev_Projects_HIS_Core_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"db",void 0);const e=indexedDB.open(DB_NAME,1);e.onupgradeneeded=function(){e.result.createObjectStore(INDEX_STORE)},e.onsuccess=()=>{this.db=e.result}}existsinStorage(e){return new Promise((t,o)=>{const n=this.db.transaction(INDEX_STORE).objectStore(INDEX_STORE).get(e);n.onsuccess=()=>{t(n.result)},n.onerror=()=>{o(n.error)}})}getFromStorage(e,t){return new Promise((o,n)=>{const a=this.db.transaction(INDEX_STORE).objectStore(INDEX_STORE).openCursor();a.onsuccess=()=>{const n=a.result;n?(n.key===e&&o(t?filteredData(n,t):n.value.data),n.continue()):o([])},a.onerror=()=>{n("error")}})}saveToStorage(e,t){return this.db.transaction(INDEX_STORE,"readwrite").objectStore(INDEX_STORE).put(t,e),!0}deleteFromStorage(e){return this.db.transaction(INDEX_STORE,"readwrite").objectStore(INDEX_STORE).delete(e),!0}}function filteredData(e,t){return Object(lodash__WEBPACK_IMPORTED_MODULE_1__["filter"])(e.value,e=>Object.entries(t).every(([t,o])=>Object(lodash__WEBPACK_IMPORTED_MODULE_1__["isInteger"])(e[t])?!o||e[t]===o:!o||Object(lodash__WEBPACK_IMPORTED_MODULE_1__["toLower"])(e[t]).includes(Object(lodash__WEBPACK_IMPORTED_MODULE_1__["toLower"])(o))))}},"92b8":function(e,t,o){},"9f07":function(e,t,o){"use strict";o("2171")}}]);
//# sourceMappingURL=chunk-34427683.1e15fae0.js.map