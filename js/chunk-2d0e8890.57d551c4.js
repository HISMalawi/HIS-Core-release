(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e8890"],{"8a4e":function(e,t,n){"use strict";n.r(t);var r=n("7a23");function i(e,t,n,i,a,o){var c=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(c,{fields:e.fields,activeField:e.activeField,onFinishAction:e.onFinish,skipSummary:!0,onOnIndex:t[1]||(t[1]=function(t){return e.activeField=""}),cancelDestinationPath:e.cancelDestination},null,8,["fields","activeField","onFinishAction","cancelDestinationPath"])}var a=n("1da1"),o=(n("a15b"),n("d81d"),n("4de4"),n("d3b7"),n("ddb0"),n("159b"),n("96cf"),n("d95e")),c=n("7920"),u=n("2706"),s=n("9283"),l=n("e86e"),d=n("3d6c"),f=n("b5e4"),p=n("2ef0"),b=Object(r["defineComponent"])({components:{HisStandardForm:c["a"]},data:function(){return{activeField:"",fields:[],drugs:[],selectedDrugs:[],barcode:"",stockService:{}}},methods:{onFinish:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var r,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.prepDrugs(e),n.next=3,t.stockService.postItems(r);case 3:i=n.sent,i?(Object(f["d"])("Stock succesfully added"),t.$router.push("/")):Object(f["c"])("Could not save stock");case 5:case"end":return n.stop()}}),n)})))()},getFields:function(){var e=this;return[{id:"transfer_origination",helpText:"Select where stock came from",type:o["b"].TT_SELECT,validation:function(e){return u["a"].required(e)},options:function(){return[{label:"DHA",value:"DHA"},{label:"Other location",value:"Other location"}]}},{id:"transfer_location",helpText:"Location",type:o["b"].TT_SELECT,validation:function(e){return u["a"].required(e)},condition:function(e){return"Other location"===e.transfer_origination.value},options:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(l["b"])(t)},computedValue:function(e){return e.label},config:{showKeyboard:!0,isFilterDataViaApi:!0}},{id:"barcode",helpText:"Scan barcode",type:o["b"].TT_BARCODE,config:{hiddenFooterBtns:["Clear","Next"]},onValue:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.barcode=n,e.activeField="select drugs";case 2:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()},{id:"select drugs",helpText:"Select drugs",type:o["b"].TT_MULTIPLE_SELECT,requireNext:!0,validation:function(e){return u["a"].required(e)},options:function(){return e.drugs},unload:function(t){return e.selectedDrugs=t},config:{showKeyboard:!0,footerBtns:[{name:"Select all",slot:"end",onClick:function(){e.selectAll(e.drugs)}}]}},{id:"date",helpText:"Delivery Date",type:o["b"].TT_FULL_DATE,validation:function(e){return u["a"].required(e)}},{id:"enter_batches",helpText:"Batch entry",type:o["b"].TT_BATCH_ENTRY,options:function(){return e.selectedDrugs},beforeNext:function(e,t,n,r){var i=r.currentFieldContext,a=function(e){return e.map((function(e,t){return"".concat(e.label)})).join(" & ")},o=i.drugs.filter((function(e){return e.entries.map((function(e){return!e.tins&&!e.expiry&&!e.batchNumber})).every(Boolean)})),c=i.drugs.filter((function(e){return e.entries.map((function(e){var t=0;return e.tins&&(t+=1),e.expiry&&(t+=1),e.batchNumber&&(t+=1),t>=1&&t<=2})).some(Boolean)}));if(!Object(p["isEmpty"])(c)){var u=a(c);return Object(f["e"])("Please fix partial batch entries for drugs: ".concat(u)),!1}if(!Object(p["isEmpty"])(o)){var s=a(o);return Object(f["e"])("The following drug batches are empty: ".concat(s)),!1}return!0},validation:function(e){return u["a"].required(e)}},{id:"adherence_report",helpText:"Summary",type:o["b"].TT_TABLE_VIEWER,options:function(t){return e.buildResults(t.enter_batches)},config:{hiddenFooterBtns:["Clear"]}}]},buildResults:function(e){var t=["Drug","Amount per unit","Total units","Expiry date","Batch number"],n=e.map((function(e){var t=e.value;return[t.shortName,t.tabs,t.tins,s["b"].toStandardHisDisplayFormat(t.expiry),t.batchNumber]}));return[{label:"Confirm entry",value:"Table",other:{columns:t,rows:n}}]},prepDrugs:function(e){var t=[],n=this.barcode,r="DHA"===e.transfer_origination.value?null:e.transfer_location.value;return e.enter_batches.forEach((function(i){var a=i.value;t.push({batch_number:a.batchNumber,location_id:r,items:[{barcode:n,drug_id:a.drugID,expiry_date:a.expiry,quantity:parseInt(a.tabs)*parseInt(a.tins),delivery_date:e.date.value}]})})),t},selectAll:function(e){return e.map((function(e){return e.isChecked=!0,e}))},formatDrugs:function(){return this.stockService.drugList().map((function(e){return{label:e.shortName,value:e}}))}},created:function(){this.stockService=new d["a"],this.fields=this.getFields(),this.drugs=this.formatDrugs()}}),h=n("6b0d"),v=n.n(h);const m=v()(b,[["render",i]]);t["default"]=m}}]);
//# sourceMappingURL=chunk-2d0e8890.57d551c4.js.map