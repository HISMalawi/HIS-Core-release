(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-563767ba"],{7365:function(t,e,i){"use strict";i("14d9"),i("13d5");var n,a=i("7a23"),s=i("ad60"),o=i("2ef0"),r=i("0fa1"),c=i("7f35"),d=i("9283");(function(t){t["SET_PROVIDER"]="SET_PROVIDER",t["CHANGE_SESSION_DATE"]="change_session_date",t["GO_TO_PATIENT_DASHBOARD"]="go_to_patient_dashboard",t["CHANGE_PATIENT_OUTCOME"]="change_outcome",t["CONTINUE"]="continue",t["EXIT"]="exit"})(n||(n={}));const l=t=>d["b"].toStandardHisDisplayFormat(t),g={"Warn if attempting to create new encounters for a deceased patient":{priority:1,actions:{alert:async({outcomeStartDate:t})=>{const e=await Object(c["a"])("Data Integrity Issue Found","Patient died on "+l(t),"Proceeding with this outcome might affect accuracy of some reports",[{name:"Cancel",slot:"end",color:"primary"},{name:"Change outcome",slot:"end",color:"primary"},{name:"Continue Anyway",slot:"end",color:"danger"}]);return"Cancel"===e?n.GO_TO_PATIENT_DASHBOARD:"Change outcome"===e?n.CHANGE_PATIENT_OUTCOME:n.CONTINUE}},conditions:{outcome(t){return"Patient died"===t},outcomeStartDate(t,{sessionDate:e}){return e>=t}}},"A patient's date of birth must not be less than Session Date":{priority:2,actions:{alert:async({birthDate:t,sessionDate:e})=>{const i=await Object(c["a"])("Data integrity issue found","",`Session date ${l(e)} is less than birth date of ${l(t)}`,[{name:"Cancel",slot:"end",color:"danger"},{name:"Change session date",slot:"end",color:"success"}]);return"Change session date"===i?n.CHANGE_SESSION_DATE:n.GO_TO_PATIENT_DASHBOARD}},conditions:{birthDate(t,{sessionDate:e}){return e<t}}},"Select Encounter provider when in back data entry":{priority:3,actions:{selection:async({providers:t,encounterName:e,sessionDate:i,apiDate:a})=>{const s=await Object(c["c"])("Please select a provider for "+e,`BDE: ${l(i)} | Current: ${l(a)}`,t,[{name:"Cancel",color:"danger",slot:"start",role:"default"},{name:"Confirm",slot:"end",role:"action"}]);return"Cancel"===s.action?{value:-1,flowState:n.GO_TO_PATIENT_DASHBOARD}:{value:s.selection,flowState:n.SET_PROVIDER}}},conditions:{isBdeMode(t){return t}}}};var h=i("c21d"),u=i("7920"),p=i("b5e4"),m=i("8e8b"),_=i("b432"),b=i("5a0c"),f=i.n(b),T=i("cc6f"),y=i("2ed9"),S=Object(a["defineComponent"])({components:{HisStandardForm:u["a"]},data:()=>({offlineID:null,patient:{},fields:[],patientID:"",providerID:-1,providers:[],encounterStartTime:null,facts:{npid:"",givenName:"",familyName:"",age:-1,gender:"",birthDate:"",birthEstimated:!1,sessionDate:"",apiDate:"",isEnrolledInProgam:!1,encounterName:"N/A",providers:[],isBdeMode:!1,outcome:"",outcomeStartDate:"",village:"",district:"",currentTA:""},formLabel:"",ready:!1}),created(){this.$route.params.patient_id&&(this.offlineID=this.$route.params.patient_id,this.patientID=parseInt(""+this.$route.params.patient_id),this.goOffline()?this.initOfflineData():m["a"].get("ACTIVE_PATIENT",{patientID:this.patientID}).then(t=>{this.patient=t,Object(o["isEmpty"])(this.patient)||Object(_["a"])().cachePatient(this.patient),this.setEncounterFacts().then(()=>{this.checkEncounterGuidelines().then(()=>{this.ready=!0,this.setStartTime()}).catch(t=>console.log(t))}).catch(()=>{this.goOffline()&&this.initOfflineData()})}))},computed:{cancelDestination(){return this.patientDashboardUrl()}},methods:{setStartTime(){this.encounterStartTime=(new Date).getTime()},goOffline(){return!_["c"].value||_["b"].value},isOnline(){return _["c"].value},isOfflineMode(){return _["b"].value},initOfflineData(){var t,e,i;const n=Object(_["a"])().findByID(this.offlineID),a=null===n||void 0===n||null===(t=n.personParams)||void 0===t?void 0:t.person;a&&(this.facts.birthDate=a.birthdate,this.facts.age=f()(s["a"].getSessionDate()).diff(this.facts.birthDate,"years"),this.facts.birthEstimated=(null===n||void 0===n||null===(e=n.personParams)||void 0===e?void 0:e.person.birthdate_estimated)||!1,this.facts.npid=null===n||void 0===n||null===(i=n.personParams)||void 0===i?void 0:i.npid,this.facts.givenName=a.given_name,this.facts.familyName=a.family_name,this.facts.district=a.current_district,this.facts.village=a.current_village,this.facts.currentTA=a.current_traditional_authority,this.facts.gender=a.gender,this.ready=!0,this.setStartTime())},async saveFormEncounterAndProceed(t={}){let e="Pending",i=!1,n=null;const a=(new Date).getTime(),s=(a-this.encounterStartTime)/1e3,o=s/60;try{const a=await T["a"].buildValueText("Device",Object(y["f"])()),s=await T["a"].buildValueNumber("Review Time",o);n=[...await this.resolveObs(t.computedData),a,s],Object(_["a"])().saveObsOffline({observations:n,id:this.offlineID,uploadStatus:e,encounterName:this.$route.name,encounterTypeID:t.encounterTypeID,meta:t.formData,labOrders:t.labOrders,created:i},i),Object(_["a"])().synchronizeRecord(this.offlineID),t.skipNextTask||this.nextOfflineFlow()}catch(r){return console.error(""+r),Object(p["e"])("Unable to resolve observations")}},runflowState(t,e=null){const i={};if(i[n.SET_PROVIDER]=t=>{const[e]=t.split(" "),i=Object(o["find"])(this.providers,{username:e});return i&&(this.providerID=i.person_id),n.CONTINUE},i[n.CHANGE_SESSION_DATE]=()=>(this.$router.push("/session/date?patient_dashboard_redirection_id="+this.patientID),n.EXIT),i[n.CHANGE_PATIENT_OUTCOME]=()=>(this.$router.push("/patient/programs/"+this.patientID),n.EXIT),i[n.GO_TO_PATIENT_DASHBOARD]=()=>(this.gotoPatientDashboard(),n.EXIT),t in i)return i[t](e)},async checkEncounterGuidelines(){const t=Object(h["a"])(this.facts,g);for(const o in t){var e,i;const r=t[o];if(null!==r&&void 0!==r&&null!==(e=r.actions)&&void 0!==e&&e.alert){var a;const t=this.runflowState(await(null===r||void 0===r||null===(a=r.actions)||void 0===a?void 0:a.alert(this.facts)));if(t===n.EXIT)return}if(null!==r&&void 0!==r&&null!==(i=r.actions)&&void 0!==i&&i.selection){var s;const t=await(null===r||void 0===r||null===(s=r.actions)||void 0===s?void 0:s.selection(this.facts));this.runflowState(t.flowState,t.value)}}},async setEncounterFacts(){try{const t=await m["a"].get("PATIENT_PROGRAM",{patientID:this.patientID});this.facts.isEnrolledInProgam=t.programID===s["a"].getProgramID(),this.facts.outcome=t.outcome,this.facts.outcomeStartDate=t.startDate}catch(t){console.error(t),Object(p["c"])(""+t)}this.facts.npid=this.patient.getNationalID(),this.facts.givenName=this.patient.getGivenName(),this.facts.familyName=this.patient.getFamilyName(),this.facts.currentTA=this.patient.getCurrentTA(),this.facts.district=this.patient.getCurrentDistrict(),this.facts.village=this.patient.getCurrentVillage(),this.facts.sessionDate=s["a"].getSessionDate(),this.facts.apiDate=s["a"].getCachedApiDate(),this.facts.isBdeMode=s["a"].isBDE(),this.facts.birthDate=this.patient.getBirthdate(),this.facts.age=this.patient.getAge(),this.facts.encounterName=this.$route.name?this.$route.name.toString().toUpperCase():"N/A",s["a"].isBDE()&&(this.providers=await m["a"].get("PROVIDERS"),this.facts.providers=this.providers.sort((t,e)=>{const i=t.username.toUpperCase(),n=e.username.toUpperCase();return i<n?-1:i>n?1:0}).map(t=>{var e;let i=""+t.username;if(!Object(o["isEmpty"])(null===t||void 0===t||null===(e=t.person)||void 0===e?void 0:e.names)){var n;const[e]=(null===(n=t.person)||void 0===n?void 0:n.names)||[];i+=` (${e.given_name} ${e.family_name})`}return i}))},toOption(t,e={}){return{label:t,value:t,other:e}},mapStrToOptions(t){return t.map(t=>"string"===typeof t||"number"===typeof t?{label:t,value:t}:t)},patientDashboardUrl(){return"/patient/dashboard/"+this.$route.params.patient_id},gotoPatientDashboard(){return this.$router.push({path:this.patientDashboardUrl()})},nextOfflineFlow(){const t=Object(_["a"])().nextPatientWorkflowActivity(this.patientID);return t&&t.patientUrl?this.$router.push(`${t.patientUrl}/${this.patientID}`):this.$router.push("/patient/dashboard/"+this.patientID)},async nextTask(){try{const t=this.offlineID||this.patientID;await Object(r["b"])(t,this.$router,this.$route)}catch(t){console.error("Workflow error "+t),this.gotoPatientDashboard()}},yesNoOptions(){return[{label:"Yes",value:"Yes"},{label:"No",value:"No"}]},toYesNoOption(t,e={}){return{label:t,value:"",other:{...e,values:this.yesNoOptions()}}},mapOptions(t){return t.map(t=>({label:t,value:t}))},toConditionalOptions(t){const e=[];for(const i of t)("boolean"!==typeof i[1]||i[1])&&e.push(this.toOption(i[0]));return e},yesNoUnknownOptions(){return[{label:"Yes",value:"Yes"},{label:"No",value:"No"},{label:"Unknown",value:"Unknown"}]},resolveObs(t,e=""){const i=Object.values(t).filter(t=>t&&(t.tag===e||""===e)).reduce((t,e)=>{const i=e.obs?e.obs:e;return Array.isArray(i)?t=t.concat(i):"function"===typeof i?t.push(i()):t.push(i),t},[]);return Promise.all(i)},inArray(t,e){try{return t.filter(t=>e(t)).length>0}catch(i){return!1}},validateSeries(t){try{for(const e in t){const i=t[e]();if(i)return i}}catch(e){return[e]}}}});const D=S;e["a"]=D},7920:function(t,e,i){"use strict";var n=i("7a23");function a(t,e,i,a,s,o){return Object(n["openBlock"])(),Object(n["createBlock"])(Object(n["resolveDynamicComponent"])(t.formType),{fields:t.fields,skipSummary:t.skipSummary,activeField:t.activeField,cancelDestinationPath:t.cancelDestinationPath,onOnFinish:t.onFinish,onFinish:t.onFinishAction,onOnIndex:t.onIndex},null,40,["fields","skipSummary","activeField","cancelDestinationPath","onOnFinish","onFinish","onOnIndex"])}var s=i("9441"),o=Object(n["defineComponent"])({name:"HisStandardForm",components:{TouchScreenForm:s["a"]},emits:["onFinish","onIndex"],data:()=>({formType:"touch-screen-form"}),props:{onFinishAction:{type:Function},skipSummary:{type:Boolean,default:!1},activeField:{type:String},fields:{type:Object,required:!0},cancelDestinationPath:{type:String,required:!1}},methods:{onFinish(t,e){this.$emit("onFinish",t,e)},onIndex(t){this.$emit("onIndex",t)}}}),r=i("6b0d"),c=i.n(r);const d=c()(o,[["render",a]]);e["a"]=d},"8e3d":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return storageFactory}));var _home_andrew_dev_Projects_HIS_Core_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ade3"),lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("2ef0"),lodash__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);const INDEX_STORE="openmrs",DB_NAME="offline_db",storageFactory=(storageName="IndexedDBStorage")=>eval(`new ${storageName}()`);class LocalStorage{existsinStorage(t){const e=localStorage.getItem(t);return e?Promise.resolve(!0):Promise.resolve(!1)}getFromStorage(t){return new Promise((e,i)=>{const n=localStorage.getItem(t);if(n)return e(JSON.parse(n));e([])})}deleteFromStorage(t){return localStorage.removeItem(t),!0}saveToStorage(t,e){return localStorage.setItem(t,JSON.stringify(e)),!0}}class IndexedDBStorage{constructor(){Object(_home_andrew_dev_Projects_HIS_Core_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"db",void 0);const t=indexedDB.open(DB_NAME,1);t.onupgradeneeded=function(){t.result.createObjectStore(INDEX_STORE)},t.onsuccess=()=>{this.db=t.result}}existsinStorage(t){return new Promise((e,i)=>{const n=this.db.transaction(INDEX_STORE).objectStore(INDEX_STORE).get(t);n.onsuccess=()=>{e(n.result)},n.onerror=()=>{i(n.error)}})}getFromStorage(t,e){return new Promise((i,n)=>{const a=this.db.transaction(INDEX_STORE).objectStore(INDEX_STORE).openCursor();a.onsuccess=()=>{const n=a.result;n?(n.key===t&&i(e?filteredData(n,e):n.value.data),n.continue()):i([])},a.onerror=()=>{n("error")}})}saveToStorage(t,e){return this.db.transaction(INDEX_STORE,"readwrite").objectStore(INDEX_STORE).put(e,t),!0}deleteFromStorage(t){return this.db.transaction(INDEX_STORE,"readwrite").objectStore(INDEX_STORE).delete(t),!0}}function filteredData(t,e){return Object(lodash__WEBPACK_IMPORTED_MODULE_1__["filter"])(t.value,t=>Object.entries(e).every(([e,i])=>Object(lodash__WEBPACK_IMPORTED_MODULE_1__["isInteger"])(t[e])?!i||t[e]===i:!i||Object(lodash__WEBPACK_IMPORTED_MODULE_1__["toLower"])(t[e]).includes(Object(lodash__WEBPACK_IMPORTED_MODULE_1__["toLower"])(i))))}},c21d:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));i("14d9");function n(t,e){const i=[],n=[-1,"",null,void 0];for(const a in e){if(!(a in t))continue;const s=t[a];n.includes(s)?i.push(!1):i.push(e[a](s,t))}return i.every(Boolean)}function a(t){return t.sort((t,e)=>t.priority&&e.priority&&t.priority<e.priority?-1:1)}function s(t){return t.sort((t,e)=>t.weight&&e.weight&&t.weight>e.weight?-1:1)}function o(t,e,i="",o="",r="priority"){const c=[];for(const a in e){const s=e[a],r=[s.target&&i&&s.target!=i,s.targetEvent&&o&&s.targetEvent!=o];r.some(Boolean)||n(t,s.conditions)&&(s.title=a,s.description&&(s.description.text=s.description.info(t)),c.push(s))}return"priority"===r?a(c):s(c)}},daa6:function(t,e,i){"use strict";i("13d5"),i("14d9");var n=i("7a23"),a=i("d95e"),s=i("ade3"),o=i("cc6f"),r=i("5713"),c=i("8158"),d=i("b5e4");const l={"Adults with stage 4 conditions":{concept:"WHO STAGE IV ADULT",priority:1,conditions:{stage:t=>4===t}},"Classify as stage 4 when reason for ART is WHO STAGE 4":{concept:"WHO STAGE IV ADULT",priority:2,conditions:{reasonForArt:t=>"WHO STAGE IV ADULT"===t}},"Adults with stage 3 conditions":{concept:"WHO STAGE III ADULT",priority:3,conditions:{stage:t=>3===t}},"Adults with stage 2 conditions":{concept:"WHO STAGE II ADULT",priority:4,conditions:{stage:t=>2===t}},"Adults with stage 1 conditions":{concept:"WHO STAGE I ADULT",priority:5,conditions:{stage:t=>1===t}}},g={"Children with stage 4 conditions":{concept:"WHO STAGE IV PEDS",priority:1,conditions:{stage:t=>4===t}},"Classify as stage 4 when reason for ART is WHO STAGE 4":{concept:"WHO STAGE IV PEDS",priority:2,conditions:{reasonForArt:t=>"WHO STAGE IV PEDS"===t}},"For children with stage 3 conditions":{concept:"WHO STAGE III PEDS",priority:3,conditions:{stage:t=>3===t}},"Children with stage 2 conditions":{concept:"WHO STAGE II PEDS",priority:4,conditions:{stage:t=>2===t}},"Children with stage 1 conditions":{concept:"WHO STAGE I PEDS",priority:5,conditions:{stage:t=>1===t}}},h={"Warn if Severe weight loss is selected when actual patient BMI is acceptable":{priority:1,actions:{alert:async t=>await Object(d["a"])(`Patient's BMI of ${t.bmi} greater than 18.5, do you wish to proceed?`,{confirmBtnLabel:"Yes, keep severe weightloss",cancelBtnLabel:"No, cancel"})},conditions:{selectedCondition(t){return"Severe weight loss >10% and/or BMI <18.5kg/m^2, unexplained"===t},bmi:t=>t>18.5}},"Warn for contradicting stage defining conditions":{priority:1,actions:{alert:async t=>{const e=await Object(d["a"])("CONTRADICTING STAGE DEFINING CONDITIONS",{confirmBtnLabel:"Keep Asymptomatic",cancelBtnLabel:"Keep other(s)"});return!!e&&(t.stage=1,t.selectedConditions=[],t.stageThreeConditions=[],t.stageFourConditions=[],t.stageTwoConditions=[],!0)}},conditions:{selectedCondition(t){return"Asymptomatic HIV infection"===t},stage:t=>t>=2}}},u={"For children whose current weight percentile is less than 70":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:t=>"Child has a low weight percentile of "+t.weightPercentile},conditions:{selectedCondition(t){return"Severe unexplained wasting or malnutrition not responding to treatment (weight-for-height/ -age <70% or MUAC less than 11cm or oedema)"===t},weightPercentile(t){return t<70}}},"Enable Moderate unexplained malnutrition for children whose weight for height is 70-79%":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:t=>"Child has weight percentile of "+t.weightPercentile},conditions:{selectedCondition(t){return"Moderate unexplained wasting/malnutrition not responding to treatment (weight-for-height/ -age 70-79% or muac 11-12 cm)"===t},weightPercentile(t){return t>=70&&t<=79}}},"Disable moderate weight loss when Severe unexplained weight loss is chosen":{priority:2,actions:{isChecked:!1,disabled:!0},description:{color:"secondary",show:"always",info:()=>"Severe weight loss/manutrition was already selected"},conditions:{selectedCondition(t){return"Moderate unexplained wasting/malnutrition not responding to treatment (weight-for-height/ -age 70-79% or muac 11-12 cm)"===t},selectedConditions(t){return t.includes("Severe unexplained wasting or malnutrition not responding to treatment (weight-for-height/ -age <70% or MUAC less than 11cm or oedema)")}}}},p={"Adults with a BMI less than 16":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:t=>"Adult has a low BMI of "+t.bmi},conditions:{selectedCondition(t){return"Severe weight loss >10% and/or BMI <18.5kg/m^2, unexplained"===t},bmi:t=>t<16}},"Adults whose BMI is between 16 and 18":{priority:3,actions:{isChecked:!0},description:{color:"warning",show:"onChecked",info:t=>`BMI of ${t.bmi} is between 16 and 18`},conditions:{selectedCondition:t=>"Moderate weight loss less than or equal to 10 percent, unexplained"===t,bmi:t=>t>=16&&t<=18.5}},"Disable Moderate weight loss if severe weightloss is selected":{priority:2,actions:{isChecked:!1,disabled:!0},description:{color:"secondary",show:"always",info:()=>"Severe weight loss was already selected"},conditions:{selectedCondition(t){return"Moderate weight loss less than or equal to 10 percent, unexplained"===t},selectedConditions(t){return t.includes("Severe weight loss >10% and/or BMI <18.5kg/m^2, unexplained")}}}},m={"Has stage 4 conditions":{concept:"WHO STAGE IV PEDS",priority:1,conditions:{stage:t=>4===t}},"Has stage 3 conditions":{concept:"WHO STAGE III PEDS",priority:2,conditions:{stage:t=>3===t}},"Children under twelve months who tested positive on Rapid test and have presumed severe HIV":{concept:"PRESUMED SEVERE HIV",priority:3,conditions:{ageInMonths(t){return t<12},selectedConditions:t=>{const e=c["a"].getConceptsByCategory("pshd_condition");for(const i in e)if(t.includes(i))return!0;return!1},testType(t){return"HIV rapid test"===t}}},"Children under twelve who tested positive via HIV DNA Polymerase Chain Reaction test":{concept:"HIV DNA polymerase chain reaction",priority:4,conditions:{ageInMonths:t=>t<12,testType:t=>"HIV DNA polymerase chain reaction"===t}},"Children who are less than 24 months":{concept:"HIV infected",priority:5,conditions:{ageInMonths:t=>t<24}},"Children between 24 and 56 months who have stage 2 or 1 conditions":{concept:"CD4 COUNT LESS THAN OR EQUAL TO 750",priority:6,conditions:{ageInMonths(t){return t>=24&&t<=56},cd4Date:t=>new Date(t)<=new Date("2014-04-01"),cd4(t){return t<=750},cd4Modifier(t){return"<"===t||"="===t},stage(t){return t<=2}}},"Children with CD4 count less than 500 and have stage 1 and stage 2 conditions":{concept:"CD4 COUNT LESS THAN OR EQUAL TO 500",priority:7,conditions:{cd4(t){return t<=500},cd4Date:t=>new Date(t)<=new Date("2014-04-01"),cd4Modifier(t){return"<"===t||"="===t},stage(t){return t<=2}}},"Children over the date 2014-04-01 who are more than five years old and have cd4 count less than 500":{concept:"CD4 COUNT LESS THAN OR EQUAL TO 500",priority:9,conditions:{cd4Date:t=>new Date(t)<=new Date("2014-04-01"),age(t){return t>5},cd4(t){return t<=500},cd4Modifier(t){return"<"===t||"="===t}}},"Children over date 2014-04-01 and less than Five years old":{concept:"HIV infected",priority:10,conditions:{date(t){return t>="2014-04-01"},age(t){return t<=5}}},"Women who are breast feeding":{concept:"BREASTFEEDING",priority:11,conditions:{gender(t){return"F"===t},breastFeeding(t){return"Yes"===t},stage:t=>t<=2}},"Women who are pregnant":{concept:"PATIENT PREGNANT",priority:12,conditions:{gender(t){return"F"===t},pregnant(t){return"Yes"===t},stage(t){return t<=2}}},"Asymptomatic patient with either stage one or stage two conditions":{concept:"Asymptomatic",priority:13,conditions:{stage:t=>t<=2}}},_={"Has stage 4 conditions":{concept:"WHO STAGE IV ADULT",priority:1,conditions:{stage:t=>4===t}},"Has HIV wasting syndrome identified in stage 3":{concept:"WHO STAGE IV ADULT",priority:2,conditions:{selectedConditions:t=>{const e=c["a"].getConceptsByCategory("severe_hiv_wasting_syndrome"),i=e.reduce((e,i)=>t.includes(i.name)?e+1:0,0);return i>=2}}},"Has stage 3 conditions":{concept:"WHO STAGE III ADULT",priority:3,conditions:{stage:t=>3===t}},"CD4 less than 350 for adults before 2014":{concept:"cd4 less than or equal to 350",priority:4,conditions:{cd4Date:t=>new Date(t)<=new Date("2014-04-01"),cd4(t){return t<=350},cd4Modifier(t){return"<"===t||"="===t}}},"CD4 less than 250 for adults after 2014":{concept:"cd4 less than or equal to 250",priority:4,conditions:{cd4Date:t=>new Date(t)<=new Date("2014-04-01"),cd4(t){return t<=250},cd4Modifier(t){return"<"===t||"="===t}}},"CD4 less than 350 for adults after 2014":{concept:"cd4 less than or equal to 350",priority:5,conditions:{cd4Date:t=>new Date(t)<=new Date("2014-04-01"),cd4(t){return t<=350},cd4Modifier(t){return"<"===t||"="===t}}},"CD4 less than 500 for adults after 2014":{concept:"cd4 less than or equal to 500",priority:6,conditions:{cd4Date:t=>new Date(t)<=new Date("2014-04-01"),cd4(t){return t<=500},cd4Modifier(t){return"<"===t||"="===t}}},"Women who are breast feeding":{concept:"BREASTFEEDING",priority:8,conditions:{gender(t){return"F"===t},breastFeeding(t){return"Yes"===t},stage:t=>t<=2}},"Women who are pregnant":{concept:"PATIENT PREGNANT",priority:7,conditions:{gender(t){return"F"===t},pregnant(t){return"Yes"===t},stage(t){return t<=2}}},"Asymptomatic patient with either stage one or stage two conditions":{concept:"Asymptomatic",priority:9,conditions:{stage:t=>t<=2}}};var b;(function(t){t["ADULT_STAGE_4"]="stage_4_conditions_adults",t["ADULT_STAGE_3"]="stage_3_conditions_adults",t["ADULT_STAGE_2"]="stage_2_conditions_adults",t["ADULT_STAGE_1"]="stage_1_conditions_adults",t["PEDAID_STAGE_4"]="stage_4_conditions_pedaids",t["PEDAID_STAGE_3"]="stage_3_conditions_pedaids",t["PEDAID_STAGE_2"]="stage_2_conditions_pedaids",t["PEDAID_STAGE_1"]="stage_1_conditions_pedaids"})(b||(b={}));class f extends o["a"]{constructor(t,e,i){super(t,52,i),Object(s["a"])(this,"age",void 0),Object(s["a"])(this,"confirmatoryTest",void 0),this.age=e,this.confirmatoryTest=null}isAdult(){return this.age>=15}isPedaid(){return this.age<=14}setAge(t){this.age=t}getFacilities(t=""){return r["a"].getFacilities({name:t})}getConfirmatoryTestType(){return this.confirmatoryTest}cd4CountIsValid(t){try{return!!t.match(/^(=|<|>)([0-9]*)$/m)}catch(e){return!1}}getAlertGuidelines(){return h}getWhoStageGuidelines(){return this.isAdult()?l:g}getProgramEligibilityGuidelines(){return this.isAdult()?_:m}getRecommendedConditionGuidelines(){return this.isAdult()?p:u}getStagingConditions(t){const e=this.getStagingCategoryByNum(t);return o["a"].getConceptsByCategory(e)}buildWhoStageObs(t){return this.buildValueCoded("Who stage",t)}buildWhoCriteriaObs(t){return this.buildValueCoded("Who stages criteria present",t)}buildReasonForArtObs(t){return this.buildValueCoded("Reason for ART eligibility",t)}getStagingCategoryByNum(t){switch(t){case 1:return this.isAdult()?b.ADULT_STAGE_1:b.PEDAID_STAGE_1;case 2:return this.isAdult()?b.ADULT_STAGE_2:b.PEDAID_STAGE_2;case 3:return this.isAdult()?b.ADULT_STAGE_3:b.PEDAID_STAGE_3;case 4:return this.isAdult()?b.ADULT_STAGE_4:b.PEDAID_STAGE_4;default:return""}}async loadHivConfirmatoryTestType(){const t=await o["a"].getFirstValueCoded(this.patientID,"Confirmatory hiv test type");t&&(this.confirmatoryTest=t)}}var T=i("7365"),y=i("2706"),S=i("b446"),D=i("9283"),E=i("2ef0"),w=i("3800"),v=i("c21d"),O=i("e86e"),C=Object(n["defineComponent"])({mixins:[T["a"]],data:()=>({staging:{},showStagingWeightChart:!0,canShowStagingFields:!0,bmiObj:{},stagingFacts:{age:-1,bmi:-1,gender:"",stage:-1,cd4:-1,cd4Date:"",date:"",isChildBearing:!1,stageOneConditions:[],stageTwoConditions:[],stageThreeConditions:[],stageFourConditions:[],reasonForArt:"",testType:"",pregnant:"",breastFeeding:"",selectedCondition:"",selectedConditions:[],weightPercentile:-1,ageInMonths:-1,cd4Modifier:"",whoStage:""}}),watch:{ready:{handler(t){t&&(this.staging=new f(this.patient.getID(),this.patient.getAge(),this.providerID))},immediate:!0}},methods:{async initStaging(t){await this.staging.loadHivConfirmatoryTestType(),this.bmiObj=await t.getBMI(),this.stagingFacts.age=t.getAge(),this.stagingFacts.bmi=this.bmiObj["index"],this.stagingFacts.date=f.getSessionDate(),this.stagingFacts.gender=t.isMale()?"M":"F",this.stagingFacts.testType=this.staging.getConfirmatoryTestType(),this.stagingFacts.ageInMonths=t.getAgeInMonths(),this.stagingFacts.isChildBearing=t.isChildBearing(),this.staging.isPedaid()&&(this.stagingFacts.weightPercentile=await t.calculateWeightPercentile())},async submitStaging(t){const e=await this.staging.createEncounter();if(!e)throw"Unable to create staging encounter";const i=await this.resolveObs(t,"staging"),n=await Promise.all([this.buildReasonForArtObs(),this.buildWhoStageObs()]),a=await this.staging.saveObservationList([...i,...n]);if(!a)throw"Unable to save patient observations"},async onStagingCondition({label:t}){var e,i;this.stagingFacts.selectedCondition=t;const n=this.staging.getAlertGuidelines(),a=Object(v["a"])(this.stagingFacts,n);if(Object(E["isEmpty"])(a))return!0;if(null!==(e=a[0])&&void 0!==e&&e.actions&&null!==(i=a[0])&&void 0!==i&&i.actions.alert){var s;const t=await(null===(s=a[0])||void 0===s?void 0:s.actions.alert(this.stagingFacts));return!!t}return!0},getFacilities(t=""){return Object(O["b"])(t)},updateStagingFacts(){const t=[this.stagingFacts.stageOneConditions,this.stagingFacts.stageTwoConditions,this.stagingFacts.stageThreeConditions,this.stagingFacts.stageFourConditions];this.stagingFacts.stage=t.reduce((t,e,i)=>Object(E["isEmpty"])(e)?t:i+1,0),this.stagingFacts.selectedConditions=t.reduce((t,e)=>t.concat(e),[])},buildReasonForArtObs(){return this.staging.buildReasonForArtObs(this.stagingFacts.reasonForArt)},buildWhoStageObs(){return this.staging.buildWhoStageObs(this.stagingFacts.whoStage)},buildStagingOptions(t,e=[]){const i=this.staging.getRecommendedConditionGuidelines();return this.staging.getStagingConditions(t).map(t=>{let n,a=!1,s=e.includes(t.name);this.stagingFacts.selectedCondition=t.name;const o=Object(v["a"])(this.stagingFacts,i);if(!Object(E["isEmpty"])(o)){var r,c;const t=o[0];null!==t&&void 0!==t&&null!==(r=t.actions)&&void 0!==r&&r.isChecked&&(s=!0),null!==t&&void 0!==t&&null!==(c=t.actions)&&void 0!==c&&c.disabled&&(a=!0),n=t.description}return{label:t.name,value:t.concept_id,isChecked:s,disabled:a,description:n}})},setWhoStage(){var t;const e=this.staging.getWhoStageGuidelines(),i=Object(v["a"])(this.stagingFacts,e);this.stagingFacts.whoStage=(null===(t=i[0])||void 0===t?void 0:t.concept)||""},setReasonForArt(){var t;const e=this.staging.getProgramEligibilityGuidelines(),i=Object(v["a"])(this.stagingFacts,e);this.stagingFacts.reasonForArt=(null===(t=i[0])||void 0===t?void 0:t.concept)||""},notAsymptomatic(t){const e=t.stage_1_conditions;if(e){const t=e.filter(t=>t.label.match(/asymptomatic/i)&&t.isChecked);return Object(E["isEmpty"])(t)}return!0},hasTransferLater(t){return"has_transfer_letter"in t&&(t.has_transfer_letter&&"Yes"===t.has_transfer_letter.value)},hasStaging(t){return!!this.hasTransferLater(t)||this.canShowStagingFields},getStagingSummaryField(t="Summary"){return{id:"summary",helpText:t,type:a["b"].TT_ART_STAGING_SUMMARY,condition:t=>this.hasStaging(t),onload:()=>{this.setReasonForArt(),this.setWhoStage()},options:()=>[{label:"WHO Stage",value:this.stagingFacts.whoStage,other:{type:"title-section"}},{label:"Condition on starting ART",value:this.stagingFacts.reasonForArt,other:{type:"title-section"}},...this.stagingFacts.selectedConditions.map(t=>({label:t,value:t}))],config:{title:"Selected stage defining conditions",hiddenFooterBtns:["Clear"]}}},isANCclient(){return"ANC"===f.getSuspendedProgram()},getStagingFields(){return[{id:"pregnancy_status",helpText:"Pregnant / Breastfeeding",type:a["b"].TT_MULTIPLE_YES_NO,validation:t=>y["a"].anyEmpty(t),summaryMapValue:t=>({label:t.label,value:t.value}),computedValue:(t,e)=>{let i=[];return this.isANCclient()&&!this.hasTransferLater(e)&&(this.stagingFacts["pregnant"]="Yes",i.push(this.staging.buildValueCoded("Is patient pregnant","Yes"))),i=i.concat(t.map(t=>{const{value:e,other:i}=t,n=i.factID;return this.stagingFacts[n]=(""+e).match(/Yes/i)?"Yes":"No",this.staging.buildValueCoded(i.concept,e)})),{obs:i,tag:"staging"}},options:t=>{if(Object(E["isEmpty"])(t.pregnancy_status)){const e=[];return this.isANCclient()&&!this.hasTransferLater(t)||e.push({label:"Pregnant?",value:"",other:{values:this.yesNoOptions(),concept:"Is patient pregnant",factID:"pregnant"}}),e.push({label:"Breastfeeding?",value:"",other:{values:this.yesNoOptions(),concept:"Is patient breast feeding",factID:"breastFeeding"}}),e}return t.pregnancy_status},condition:t=>this.hasStaging(t)&&this.stagingFacts.isChildBearing},{id:"patient_weight_chart",helpText:"Weight history",type:a["b"].TT_WEIGHT_CHART,options:async()=>{let t=await this.patient.getWeightHistory();return t=t.map(t=>({x:D["b"].toStandardHisDisplayFormat(t.date),y:t.weight})),[{label:"Weight for patient",value:"Weight trail",other:{values:t,age:this.patient.getAge(),bmi:this.bmiObj}}]},config:{hiddenFooterBtns:["Clear"]},condition:t=>this.hasStaging(t)&&this.showStagingWeightChart},{id:"stage_4_conditions",helpText:"Stage 4 conditions",type:a["b"].TT_MULTIPLE_SELECT,options:()=>this.buildStagingOptions(4,this.stagingFacts.stageFourConditions),onValue:t=>this.onStagingCondition(t),computedValue:t=>({tag:"staging",obs:t.map(t=>this.staging.buildWhoCriteriaObs(t.label))}),unload:t=>{this.stagingFacts.stageFourConditions=t.map(t=>t.label),this.updateStagingFacts()},onConditionFalse:()=>{this.stagingFacts.stageFourConditions=[],this.updateStagingFacts()},condition:t=>this.hasStaging(t)&&this.notAsymptomatic(t)},{id:"stage_3_conditions",helpText:"Stage 3 conditions",type:a["b"].TT_MULTIPLE_SELECT,options:()=>this.buildStagingOptions(3,this.stagingFacts.stageThreeConditions),onValue:t=>this.onStagingCondition(t),computedValue:t=>({tag:"staging",obs:t.map(t=>this.staging.buildWhoCriteriaObs(t.label))}),unload:t=>{this.stagingFacts.stageThreeConditions=t.map(t=>t.label),this.updateStagingFacts()},onConditionFalse:()=>{this.stagingFacts.stageThreeConditions=[],this.updateStagingFacts()},condition:t=>this.hasStaging(t)&&this.notAsymptomatic(t)},{id:"stage_2_conditions",helpText:"Stage 2 conditions",type:a["b"].TT_MULTIPLE_SELECT,options:()=>this.buildStagingOptions(2,this.stagingFacts.stageTwoConditions),onValue:t=>this.onStagingCondition(t),computedValue:t=>({tag:"staging",obs:t.map(t=>this.staging.buildWhoCriteriaObs(t.label))}),unload:t=>{this.stagingFacts.stageTwoConditions=t.map(t=>t.label),this.updateStagingFacts()},onConditionFalse:()=>{this.stagingFacts.stageTwoConditions=[],this.updateStagingFacts()},condition:t=>this.hasStaging(t)&&this.notAsymptomatic(t)},{id:"stage_1_conditions",helpText:"Stage 1 conditions",type:a["b"].TT_MULTIPLE_SELECT,validation:t=>{if(Object(E["isEmpty"])(t)&&Object(E["isEmpty"])(this.stagingFacts.selectedConditions))return["Please provide atleast one staging condition"]},options:()=>this.buildStagingOptions(1,this.stagingFacts.stageOneConditions),onValue:t=>this.onStagingCondition(t),computedValue:t=>{const e=t.map(t=>t.label);return this.stagingFacts.stageOneConditions=e,this.updateStagingFacts(),{tag:"staging",obs:e.map(t=>this.staging.buildWhoCriteriaObs(t))}},condition:t=>this.hasStaging(t)},{id:"cd4_available",helpText:"Recent CD4 count results available?",type:a["b"].TT_SELECT,condition:t=>this.hasStaging(t),validation:t=>y["a"].required(t),options:()=>this.yesNoOptions()},{id:"cd4_count",helpText:"CD4 Count",type:a["b"].TT_TEXT,computedValue:t=>{const e=t.value.toString(),i=e.charAt(0),n=parseInt(e.substring(1));return{tag:"staging",modifier:i,count:n,obs:this.staging.buildValueNumber("CD4 count",n,i)}},unload:(t,e,i,n)=>{const{count:a,modifier:s}=n["cd4_count"];this.stagingFacts.cd4=a,this.stagingFacts.cd4Modifier=s},onConditionFalse:()=>{this.stagingFacts.cd4=-1,this.stagingFacts.cd4Modifier=""},validation:t=>{const e=()=>this.staging.cd4CountIsValid(t.value);return this.validateSeries([()=>y["a"].required(t),()=>e()?null:["Please start with either modifier first: >, <, or ="]])},config:{customKeyboard:[w["b"],[["Unknown","Delete"]]]},condition:t=>this.hasStaging(t)&&"Yes"===t.cd4_available.value},...Object(S["b"])({id:"cd4_result_date",helpText:"Cd4 Results",required:!0,minDate:()=>this.patient.getBirthdate(),maxDate:()=>this.staging.getDate(),condition:t=>this.hasStaging(t)&&"Yes"===t.cd4_available.value,estimation:{allowUnknown:!1},computeValue:(t,e)=>(this.stagingFacts.cd4Date=t,{date:t,tag:"staging",isEstimate:e,obs:this.staging.buildValueDate("Cd4 count datetime",t)})},this.staging.getDate()),{id:"location",helpText:"CD4 Location",type:a["b"].TT_SELECT,defaultValue:()=>f.getLocationName(),computedValue:({label:t})=>({tag:"staging",obs:this.staging.buildValueText("Cd4 count location",t)}),validation:t=>y["a"].required(t),options:(t,e="")=>this.getFacilities(e),config:{showKeyboard:!0,isFilterDataViaApi:!0},condition:t=>this.hasStaging(t)&&"Yes"===t.cd4_available.value}]}}});const A=C;e["a"]=A},e86e:function(t,e,i){"use strict";i.d(e,"b",(function(){return c})),i.d(e,"d",(function(){return d})),i.d(e,"c",(function(){return l})),i.d(e,"f",(function(){return g})),i.d(e,"e",(function(){return h})),i.d(e,"a",(function(){return u})),i.d(e,"g",(function(){return p})),i.d(e,"h",(function(){return m}));var n=i("5713"),a=i("8e3d"),s=i("13ea"),o=i.n(s);const r=Object(a["a"])();async function c(t=""){let e=await r.getFromStorage("locations",{name:t});return o()(e)&&(e=await n["a"].getFacilities({name:t})),e.filter(t=>!o()(t)&&""!=t.name.trim()).map(t=>({label:t.name,value:t.location_id,other:t}))}async function d(t=""){const e=await n["a"].getLabs({search_name:t});return e.map(t=>({label:t,value:t}))}async function l(t=""){const e=await n["a"].getFacilities({name:t,tag:"Facility adult sections"});return e.map(t=>({label:t.name,value:t.name,other:t}))}async function g(){const t=await n["a"].getSpecialistClinics();return t.map(t=>({label:t.name,value:t.name,other:t}))}async function h(){let t=await r.getFromStorage("regions",[]);return o()(t)&&(t=await n["a"].getRegions()),t.map(t=>({label:t.name,value:t.region_id,other:t}))}async function u(t){let e=await r.getFromStorage("districts",{region_id:t});return o()(e)&&(e=await n["a"].getDistricts(t)),e.map(t=>({label:t.name,value:t.district_id,other:t}))}async function p(t,e=""){let i=await r.getFromStorage("traditional_authorities",{district_id:t,name:e});return o()(i)&&(i=await n["a"].getTraditionalAuthorities(t,e)),i.map(t=>({label:t.name,value:t.traditional_authority_id,other:t}))}async function m(t,e=""){let i=await r.getFromStorage("villages",{traditional_authority_id:t,name:e});return o()(i)&&(i=await n["a"].getVillages(t,e)),i.map(t=>({label:t.name,value:t.village_id,other:t}))}}}]);
//# sourceMappingURL=chunk-563767ba.75f4243f.js.map