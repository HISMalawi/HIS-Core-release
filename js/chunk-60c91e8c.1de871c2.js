(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-60c91e8c"],{"308a":function(e,t,n){"use strict";n.r(t);var a=n("7a23");function r(e,t,n,r,i,o){var u=Object(a["resolveComponent"])("his-standard-form");return Object(a["openBlock"])(),Object(a["createBlock"])(u,{cancelDestinationPath:e.cancelDestination,fields:e.fields,onFinishAction:e.onSubmit},null,8,["cancelDestinationPath","fields","onFinishAction"])}var i=n("2909"),o=n("5530"),u=n("1da1"),s=(n("ac1f"),n("466d"),n("99af"),n("d3b7"),n("159b"),n("25f0"),n("96cf"),n("d95e")),c=n("2706"),l=n("daa6"),d=n("519d"),g=n("3800"),f=n("b5e4"),v=n("b515"),p=n("aee2"),b=n("b446"),h=n("7f35"),m=n("9283"),_=n("5a0c"),T=n.n(_),y=n("2ef0"),w=Object(a["defineComponent"])({mixins:[l["a"]],data:function(){return{registration:{},prescription:{},dispensation:{},regimens:[],customRegimens:[],vitals:{}}},watch:{ready:{handler:function(e){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:t.canShowStagingFields=!1,t.registration=new d["a"](t.patientID,t.providerID),t.vitals=new v["a"](t.patientID,t.providerID),t.showStagingWeightChart=!1,t.fields=t.getRegistrationFields();case 7:case"end":return n.stop()}}),n)})))()},immediate:!0}},methods:{onSubmit:function(e,t){var n=this;return Object(u["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=Object(o["a"])({},t),a.next=3,n.registration.createEncounter();case 3:if(!n.hasStaging(e)){a.next=14;break}return a.next=6,n.submitStaging(t);case 6:return a.next=8,n.vitals.createEncounter();case 8:return a.t0=n.vitals,a.next=11,n.resolveObs(r,"vitals");case 11:return a.t1=a.sent,a.next=14,a.t0.saveObservationList.call(a.t0,a.t1);case 14:return a.t2=n.registration,a.next=17,n.resolveObs(r,"reg");case 17:return a.t3=a.sent,a.next=20,a.t2.saveObservationList.call(a.t2,a.t3);case 20:Object(f["d"])("Clinic registration complete!"),n.nextTask();case 22:case"end":return a.stop()}}),a)})))()},buildDateObs:function(e,t,n){var a={};return a=t.match(/unknown/i)?this.registration.buildValueText(e,"Unknown"):n?this.registration.buildValueDateEstimated(e,t):this.registration.buildValueDate(e,t),a},getRegistrationFields:function(){var e=this;return[{id:"followup_agreement",helpText:"Agrees to follow-up",type:s["b"].TT_MULTIPLE_YES_NO,summaryMapValue:function(e){var t=e.value,n=e.label;return{value:t,label:"".concat(n," followup")}},validation:function(t){return e.validateSeries([function(){return c["a"].required(t)},function(){return c["a"].anyEmpty(t)}])},computedValue:function(t){var n=[];return t.forEach((function(t){var a=t.label,r=t.value;n.push(e.registration.buildValueCoded(a,r)),n.push(e.registration.buildValueCoded("Agrees to followup",a))})),{tag:"reg",obs:n}},options:function(t){return Object(y["isEmpty"])(t.followup_agreement)?[{label:"Phone",value:"",other:{values:e.yesNoOptions()}},{label:"Home visit",value:"",other:{values:e.yesNoOptions()}}]:t.followup_agreement}},{id:"received_arvs",helpText:"Ever received ARVs for treatment or prophylaxis?",type:s["b"].TT_SELECT,computedValue:function(t){var n=t.value;return{tag:"reg",obs:e.registration.buildValueCoded("Ever received ART",n)}},validation:function(e){return c["a"].required(e)},options:function(){return e.yesNoOptions()}}].concat(Object(i["a"])(Object(b["b"])({id:"date_last_taken_arvs",helpText:"Last taken ARVS",required:!0,minDate:function(){return e.patient.getBirthdate()},maxDate:function(){return e.staging.getDate()},condition:function(e){return"Yes"===e.received_arvs.value},estimation:{allowUnknown:!0},computeValue:function(t,n){return{date:t,tag:"reg",isEstimate:n,obs:e.buildDateObs("Date ART last taken",t,n)}}},this.registration.getDate())),[{id:"taken_art_in_last_two_months",helpText:"Taken ARVs in the last two months?",type:s["b"].TT_SELECT,validation:function(e){return c["a"].required(e)},computedValue:function(t){var n=t.value;return{tag:"reg",obs:[e.registration.buildValueCoded("Has the patient taken ART in the last two months",n)]}},options:function(){return e.yesNoUnknownOptions()},condition:function(e){return"Unknown"===e.year_date_last_taken_arvs.value}},{id:"taken_art_in_last_two_weeks",helpText:"Taken ARV's in the last two weeks?",type:s["b"].TT_SELECT,computedValue:function(t,n){var a=t.value,r="",i=[],o=-1;return"Yes"===a?o=14:"Yes"===n.taken_art_in_last_two_months.value&&(o=60),o>0&&(r=m["c"].getDateBeforeByDays(e.registration.getDate(),o),i.push(e.registration.buildValueDateEstimated("Date ART last taken",r))),{date:r,tag:"reg",obs:[].concat(i,[e.registration.buildValueCoded("Has the patient taken ART in the last two weeks",a)])}},validation:function(e){return c["a"].required(e)},condition:function(e){return"Yes"===e.taken_art_in_last_two_months.value},options:function(){return e.yesNoUnknownOptions()}},{id:"ever_registered_at_art_clinic",helpText:"Ever registered at an ART clinic?",type:s["b"].TT_SELECT,computedValue:function(t){var n=t.value;return{tag:"reg",obs:e.registration.buildValueCoded("Ever registered at ART clinic",n)}},validation:function(e){return c["a"].required(e)},condition:function(e){return"Yes"===e.received_arvs.value},options:function(){return e.yesNoOptions()}},{id:"location_of_art_initialization",helpText:"Location of ART initiation",type:s["b"].TT_SELECT,computedValue:function(t){var n=t.label;return{tag:"reg",obs:e.registration.buildValueText("Location of ART initiation",n)}},validation:function(e){return c["a"].required(e)},condition:function(e){return"Yes"===e.ever_registered_at_art_clinic.value},options:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.getFacilities(n)},config:{showKeyboard:!0,isFilterDataViaApi:!0}}],Object(i["a"])(Object(b["b"])({id:"date_started_art",helpText:"Started ART",required:!0,unload:function(t,n,a,r){if("next"===n){var i=T()(r.date_started_art.date).diff(e.patient.getBirthdate(),"years");e.staging.setAge(i),e.stagingFacts.age=i,e.stagingFacts.ageInMonths=12*i}else e.staging.setAge(e.patient.getAge()),e.stagingFacts.age=e.patient.getAge(),e.stagingFacts.ageInMonths=e.patient.getAgeInMonths()},condition:function(e){return"Yes"===e.ever_registered_at_art_clinic.value},minDate:function(){return e.patient.getBirthdate()},maxDate:function(){return e.staging.getDate()},estimation:{allowUnknown:!0,estimationFieldType:b["a"].MONTH_ESTIMATE_FIELD},computeValue:function(t,n){return e.staging.setDate(t),e.vitals.setDate(t),{date:t,tag:"reg",isEstimate:n,obs:e.buildDateObs("Date ART started",t,n)}}},this.registration.getDate())),[{id:"previous_art_number",helpText:"ART number at previous location",type:s["b"].TT_TEXT,condition:function(e){return"Yes"===e.ever_registered_at_art_clinic.value},computedValue:function(t){return{tag:"reg",obs:e.registration.buildValueText("ART number at previous location",t.value)}},validation:function(e){return c["a"].required(e)}},{id:"has_transfer_letter",helpText:"Has staging information?",type:s["b"].TT_SELECT,validation:function(e){return c["a"].required(e)},computedValue:function(t){var n=t.value;return{tag:"reg",obs:e.registration.buildValueCoded("Has transfer letter",n)}},options:function(){return e.yesNoOptions()},condition:function(e){return"Yes"===e.ever_registered_at_art_clinic.value}},{id:"height",helpText:"Height (CM)",type:s["b"].TT_NUMBER,init:function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.initStaging(e.patient);case 2:return t.abrupt("return",!0);case 3:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}(),condition:function(e){return"Yes"===e.has_transfer_letter.value},computedValue:function(t){var n=t.value;return{tag:"vitals",obs:e.vitals.buildValueNumber("Height",n)}},validation:function(t){return e.validateSeries([function(){return c["a"].required(t)},function(){return c["a"].isNumber(t)},function(){return c["a"].rangeOf(t,40,222)}])}},{id:"weight",helpText:"Weight (Kg)",type:s["b"].TT_TEXT,unload:function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(n,a,r){var i,o,u,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=r.weight.value,o=r.height.value,t.next=4,p["a"].getBMI(i,o,e.patient.getGender(),e.patient.getAge());case 4:if(u=t.sent,e.stagingFacts.bmi=u["index"],e.staging.isPedaid()){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,e.patient.getMedianWeightHeight();case 10:s=t.sent;try{e.stagingFacts.weightPercentile=parseFloat(i)/parseFloat(s["weight"])*100}catch(n){e.stagingFacts.weightPercentile=0}case 12:case"end":return t.stop()}}),t)})));function n(e,n,a){return t.apply(this,arguments)}return n}(),computedValue:function(t){var n=t.value;return{tag:"vitals",obs:e.vitals.buildValueNumber("weight",n)}},condition:function(e){return"Yes"===e.has_transfer_letter.value},validation:function(t){return e.validateSeries([function(){var n=Object(o["a"])(Object(o["a"])({},t),{},{other:{modifier:"."}});return e.vitals.isNotEmptyandFloat(n)},function(){return c["a"].rangeOf(t,1,300)}])},config:{customKeyboard:[[["1","2","3",""],["4","5","6",""],["7","8","9","."],["","0","",""]],[["Delete"]]]}}],Object(i["a"])(this.getStagingFields()),[{id:"new_cd4_percent_available",helpText:"CD4 percent available",type:s["b"].TT_SELECT,options:function(){return e.yesNoOptions()},condition:function(e){return"Yes"===e.has_transfer_letter.value},validation:function(e){return c["a"].required(e)}},{id:"cd4_percent",helpText:"CD4 Percent",type:s["b"].TT_TEXT,condition:function(e){return"Yes"===e.new_cd4_percent_available.value},computedValue:function(t){var n=t.value;return{tag:"staging",obs:e.registration.buildValueNumber("CD4 percent",parseInt(n.toString().substring(1)),"%")}},onValue:function(t){return!(t.value&&!e.staging.cd4CountIsValid(t.value))||(Object(f["e"])("Cd4 percentage invalid. Use one modifier or start with either of these symbols: >, < or ="),!1)},validation:function(e){return c["a"].required(e)},config:{customKeyboard:[g["b"],[["Delete"]]]}},{id:"type_of_confirmatory_hiv_test",helpText:"Confirmatory HIV test",type:s["b"].TT_SELECT,validation:function(e){return c["a"].required(e)},onValue:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("Not done"!==t.value){e.next=3;break}return e.next=3,Object(h["a"])("Reminder","UNKNOWN HIV CONFIRMATORY TEST","Please arrange for a confirmatory test",[{name:"Agreed",color:"success",slot:"start"}]);case 3:return e.abrupt("return",!0);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),computedValue:function(t){var n=t.value;return{tag:"reg",obs:e.registration.buildValueCoded("Confirmatory hiv test type",n)}},options:function(){return[{label:"Rapid antibody test",value:"HIV rapid test"},{label:"DNA PCR",value:"HIV DNA polymerase chain reaction"},{label:"Not done",value:"Not done"}]}},{id:"confirmatory_hiv_test_location",helpText:"Location of confirmatory HIV test",type:s["b"].TT_SELECT,defaultValue:function(e){return"Yes"===(e.ever_registered_at_art_clinic&&e.ever_registered_at_art_clinic.value)?"":d["a"].getLocationName()},computedValue:function(t){return{tag:"reg",obs:e.registration.buildValueText("Confirmatory HIV test location",t.label)}},validation:function(e){return c["a"].required(e)},condition:function(e){return"Not done"!=e.type_of_confirmatory_hiv_test.value},options:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.getFacilities(n)},config:{showKeyboard:!0,isFilterDataViaApi:!0}}],Object(i["a"])(Object(b["b"])({id:"date_of_confirmatory_hiv_test",helpText:"Confirmatory HIV test",beforeNext:function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(n,a){var r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("Yes"==a.received_arvs.value){t.next=7;break}if(r=T()(e.staging.getDate()).diff(n,"days"),!(r>=20)){t.next=7;break}return t.next=5,Object(h["a"])("Data inconsistency warning","Confirmatory Date for newly initiated ART patient is ".concat(r," days ago"),"Are you sure this is accurate?",[{name:"No, Re-enter date",slot:"start",color:"success"},{name:"Yes, its accurate",slot:"end",color:"danger"}]);case 5:return i=t.sent,t.abrupt("return","Yes, its accurate"===i);case 7:return t.abrupt("return",!0);case 8:case"end":return t.stop()}}),t)})));function n(e,n){return t.apply(this,arguments)}return n}(),condition:function(e){return e.confirmatory_hiv_test_location.value},required:!0,minDate:function(){return e.patient.getBirthdate()},maxDate:function(){return e.staging.getDate()},estimation:{allowUnknown:!0,estimationFieldType:b["a"].MONTH_ESTIMATE_FIELD},computeValue:function(t,n){return{date:t,tag:"reg",isEstimate:n,obs:e.buildDateObs("Confirmatory HIV test date",t,n)}}},this.registration.getDate())),[this.getStagingSummaryField("Staging summary")])}}}),x=n("d959"),E=n.n(x);const O=E()(w,[["render",r]]);t["default"]=O},"519d":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n("bee2"),r=n("d4ec"),i=n("262e"),o=n("2caf"),u=n("cc6f"),s=function(e){Object(i["a"])(n,e);var t=Object(o["a"])(n);function n(e,a){return Object(r["a"])(this,n),t.call(this,e,9,a)}return Object(a["a"])(n)}(u["a"])},b515:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n("d4ec"),r=n("bee2"),i=n("262e"),o=n("2caf"),u=(n("ac1f"),n("466d"),n("99af"),n("d81d"),n("d3b7"),n("159b"),n("1276"),n("4de4"),n("b0c0"),n("cc6f")),s=n("2ef0"),c=function(e){Object(i["a"])(n,e);var t=Object(o["a"])(n);function n(e,r){return Object(a["a"])(this,n),t.call(this,e,6,r)}return Object(r["a"])(n,[{key:"isNotEmptyandNumber",value:function(e){return"".concat(e.value).match(/^-?\d+\.?\d*$/)?null:["Invalid entry for ".concat(e.label)]}},{key:"isNotEmptyandFloat",value:function(e){var t;return"".concat(e.value).match(/^\d{1,3}\.\d{1,5}$/)?null:["Invalid entry for ".concat(e.label,". Don't forget to add a decimal. e.g. 56.2 ").concat((null===(t=e.other)||void 0===t?void 0:t.modifier)||"")]}},{key:"checkMinMax",value:function(e,t,n){var a,r,i=[];parseFloat("".concat(e.value))<t&&i.push(["".concat(e.label," entered is less than minimum ").concat(t," ").concat((null===e||void 0===e||null===(a=e.other)||void 0===a?void 0:a.modifier)||"")]);parseFloat("".concat(e.value))>n&&i.push(["".concat(e.label," entered is greater than maximum ").concat(n," ").concat((null===e||void 0===e||null===(r=e.other)||void 0===r?void 0:r.modifier)||"")]);return i.length>0?i:null}},{key:"validateAll",value:function(e){var t=this,n=[];return e.map((function(e){var a=t.validator(e);return Object(s["isArray"])(a)?n.push(a):null})),n.length>0?n:null}},{key:"mergeErrors",value:function(e){var t=[];return e.forEach((function(e){Object(s["isArray"])(e)&&t.push(e)})),t.length>0?t:null}},{key:"isValidBPReading",value:function(e){var t=[],n="".concat(e.value).match(/^\d{1,3}\/\d{1,3}$/g)?null:["Invalid BP reading"];if(t.push(n),null==n){var a="".concat(e.value).split("/"),r={label:"Systolic",value:a[0]},i={label:"Diastolic",value:a[1]};t.push(this.checkMinMax(i,30,200)),t.push(this.checkMinMax(r,40,250))}return this.mergeErrors(t)}},{key:"validator",value:function(e){var t=this,n=[{name:"Weight",validator:function(e){var n=t.isNotEmptyandFloat(e),a=t.checkMinMax(e,2,250);return t.mergeErrors([n,a])}},{name:"Height",validator:function(e){var n=[];return n.push(t.isNotEmptyandNumber(e)),n.push(t.checkMinMax(e,40,220)),t.mergeErrors(n)}},{name:"BP",validator:function(e){return t.isValidBPReading(e)}},{name:"Temp",validator:function(e){var n=t.isNotEmptyandNumber(e),a=t.checkMinMax(e,30,42);return t.mergeErrors([n,a])}},{name:"SP02",validator:function(e){var n=t.checkMinMax(e,40,100);return t.mergeErrors([n])}},{name:"Pulse",validator:function(e){var n=t.checkMinMax(e,50,120);return t.mergeErrors([n])}}],a=n.filter((function(t){return t.name===e.label}));return a.length>0?a[0].validator(e):null}}]),n}(u["a"])}}]);
//# sourceMappingURL=chunk-60c91e8c.1de871c2.js.map