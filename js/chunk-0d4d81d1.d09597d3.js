(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0d4d81d1"],{"2af3":function(e,t,o){},"5ee7":function(e,t,o){"use strict";o("2af3")},"857e":function(e,t,o){"use strict";o.r(t);var a=o("7a23");const c={class:"his-card"};function n(e,t,o,n,i,r){const l=Object(a["resolveComponent"])("ion-title"),s=Object(a["resolveComponent"])("ion-toolbar"),u=Object(a["resolveComponent"])("barcode-input"),d=Object(a["resolveComponent"])("ion-header"),b=Object(a["resolveComponent"])("ion-label"),p=Object(a["resolveComponent"])("ion-item"),O=Object(a["resolveComponent"])("ion-col"),j=Object(a["resolveComponent"])("ion-text"),v=Object(a["resolveComponent"])("ion-row"),N=Object(a["resolveComponent"])("ion-grid"),x=Object(a["resolveComponent"])("ion-content"),f=Object(a["resolveComponent"])("ion-button"),h=Object(a["resolveComponent"])("ion-footer"),_=Object(a["resolveComponent"])("ion-page");return Object(a["openBlock"])(),Object(a["createBlock"])(_,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(d,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{color:"light"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(l,{class:"ion-text-center his-md-text"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("b",null,Object(a["toDisplayString"])(e.kits[e.activeIndex].kitName),1)]),_:1})]),_:1}),Object(a["createVNode"])(s,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(u,{style:{margin:"0px auto",width:"90%"},onOnScan:e.onScan},null,8,["onOnScan"])]),_:1})]),_:1}),Object(a["createVNode"])(x,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.kits,(t,o)=>(Object(a["openBlock"])(),Object(a["createBlock"])(v,{onClick:()=>e.activeIndex=o,class:Object(a["normalizeClass"])(e.activeIndex===o?"his-card active":""),key:o},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(O,{size:"4"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",c,[Object(a["createVNode"])(p,{lines:"none"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(b,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Kit name ")]),_:1}),Object(a["createVNode"])(b,{slot:"end"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("b",null,Object(a["toDisplayString"])(t.kitName),1)]),_:2},1024)]),_:2},1024)])]),_:2},1024),Object(a["createVNode"])(O,{size:"4"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["his-card",t.expiryDate&&!t.lotNo?"error":""])},[Object(a["createVNode"])(p,{onClick:t=>e.updateLot(o),lines:"none"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(b,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Lot No. ")]),_:1}),Object(a["createVNode"])(b,{slot:"end"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("b",null,Object(a["toDisplayString"])(t.lotNo),1)]),_:2},1024)]),_:2},1032,["onClick"])],2)]),_:2},1024),Object(a["createVNode"])(O,{size:"4"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["his-card",!t.expiryDate&&t.lotNo?"error":""])},[Object(a["createVNode"])(p,{onClick:t=>e.updateExpiryDate(o),lines:"none"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(b,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Expiry Date ")]),_:1}),Object(a["createVNode"])(b,{color:t.expiryDateError?"danger":"",slot:"end"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("b",null,Object(a["toDisplayString"])(t.expiryDate),1)]),_:2},1032,["color"])]),_:2},1032,["onClick"]),t.expiryDateError?(Object(a["openBlock"])(),Object(a["createBlock"])(j,{key:0,color:"danger",class:"ion-text-center"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(t.expiryDateError),1)]),_:2},1024)):Object(a["createCommentVNode"])("",!0)],2)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})]),_:1}),Object(a["createVNode"])(h,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{color:"light"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(f,{onClick:e.clear,slot:"end",color:"warning",size:"large"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Clear ")]),_:1},8,["onClick"]),Object(a["createVNode"])(f,{onClick:e.save,disabled:!e.canFinish||e.hasErrors,slot:"end",color:"success",size:"large"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Finish ")]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})}var i=o("d867"),r=o("efaf"),l=o("c731"),s=o("d95e"),u=o("b5e4"),d=o("afbc"),b=o("cd10"),p=o("1c74"),O=Object(a["defineComponent"])({components:{IonGrid:i["p"],IonCol:i["m"],IonRow:i["H"],IonPage:i["D"],IonTitle:i["R"],IonHeader:i["q"],IonToolbar:i["S"],IonContent:i["n"],IonFooter:i["o"],IonButton:i["d"],BarcodeInput:r["a"],IonItem:i["w"],IonLabel:i["x"],IonText:i["O"]},setup(){const{kits:e,initKits:t,saveKits:o}=Object(b["b"])(),c=Object(a["ref"])(0),n=Object(a["ref"])(!1),i=Object(a["computed"])(()=>e.value.some(t=>!t.lotNo&&t.expiryDate||!t.expiryDate&&t.lotNo||e.value.some(e=>e.expiryDateError))),r=()=>{e.value.forEach(e=>(e.expiryDate&&new Date(e.expiryDate)<=new Date(p["e"].getSessionDate())?e.expiryDateError="Kit has expired!!":e.expiryDateError="",e))};function O(t){Object(l["b"])({id:"lot",helpText:e.value[t].kitName+" Lot No.",type:s["b"].TT_TEXT,defaultValue:()=>e.value[t].lotNo},o=>{const a=(null===o||void 0===o?void 0:o.value)||"";if(0===c.value)return e.value.forEach(e=>{"profession_hiv_kit"===e.testGroup&&(e.lotNo=a)}),void(e.value[t].expiryDate&&(c.value=5));e.value[t].expiryDate&&v(),e.value[t].lotNo=a})}function j(t){Object(l["b"])({id:"expiry",helpText:e.value[t].kitName+" Expiry Date",type:s["b"].TT_FULL_DATE,defaultValue:()=>e.value[t].expiryDate},o=>{const a=(null===o||void 0===o?void 0:o.value)||"";if(0===c.value)return e.value.forEach(e=>{"profession_hiv_kit"===e.testGroup&&(e.expiryDate=a)}),e.value[t].lotNo&&(c.value=5),void r();e.value[t].lotNo&&v(),e.value[t].expiryDate=a,r()})}function v(){c.value+1===e.value.length?c.value=0:++c.value}function N(t){0===c.value&&e.value.forEach(e=>{"profession_hiv_kit"===e.testGroup&&(e.lotNo=t)}),e.value[c.value].lotNo=t,e.value[c.value].expiryDate?v():j(c.value)}async function x(){await Object(u["a"])("Are you sure you want to clear everything?")&&(e.value.forEach(e=>{e.expiryDate="",e.lotNo="",e.expiryDateError=""}),c.value=0)}async function f(){if(r(),i.value)return Object(u["e"])("Some kits have errors! please fix them below");if(!e.value.every(e=>!(e.lotNo&&e.expiryDate))||await Object(u["a"])("Do you want to continue without updating test kits?")){n.value=!1;try{return await o(),Object(u["d"])("Testkits updated!"),d["a"].back()}catch(t){Object(u["c"])("General error has occured!")}n.value=!0}}return Object(a["onMounted"])(()=>t().then(()=>{r(),n.value=!0})),{kits:e,activeIndex:c,hasErrors:i,canFinish:n,save:f,switchIndex:v,onScan:N,updateLot:O,updateExpiryDate:j,clear:x}}}),j=(o("5ee7"),o("d959")),v=o.n(j);const N=v()(O,[["render",n],["__scopeId","data-v-7c39b777"]]);t["default"]=N},cd10:function(e,t,o){"use strict";o.d(t,"a",(function(){return a})),o.d(t,"b",(function(){return l}));var a,c=o("1c74"),n=o("2ef0"),i=o("7a23");(function(e){e["TEST_KIT_USER_PROPERTY"]="hts_user_assigned_kits",e["HIV_SELF_KIT"]="HIV self-kit",e["SYPHILIS"]="Syphilis",e["HEPATITIS"]="Hepatitis B",e["BIOLINE"]="Bioline",e["DETERMINE"]="Determine",e["DETERMINE_REPEAT"]="Determine (Repeat)",e["UNIGOLD"]="Unigold"})(a||(a={}));const r=Object(i["ref"])([{kitName:"All (Determine, Unigold, Bioline)",lotNo:"",expiryDate:"",testGroup:"profession_hiv_kit"},{kitName:a.UNIGOLD,lotNo:"",expiryDate:"",testGroup:"profession_hiv_kit"},{kitName:a.DETERMINE,lotNo:"",expiryDate:"",testGroup:"profession_hiv_kit"},{kitName:a.DETERMINE_REPEAT,lotNo:"",expiryDate:"",testGroup:"profession_hiv_kit"},{kitName:a.BIOLINE,lotNo:"",expiryDate:"",testGroup:"profession_hiv_kit"},{kitName:a.HIV_SELF_KIT,lotNo:"",expiryDate:""},{kitName:a.SYPHILIS,lotNo:"",expiryDate:""},{kitName:a.HEPATITIS,lotNo:"",expiryDate:""}]);function l(){const e=async()=>{try{const e=await c["e"].getJson("user_properties",{property:a.TEST_KIT_USER_PROPERTY});r.value=JSON.parse(e.property_value)}catch(e){console.error(""+e)}},t=e=>{const t=Object(n["find"])(r.value,{kitName:e});return t&&new Date(t.expiryDate)<=new Date(c["e"].getSessionDate())?"":t["lotNo"]||""},o=e=>{const t=Object(n["find"])(r.value,{kitName:e})["expiryDate"]||"";return t&&new Date(t)<=new Date(c["e"].getSessionDate())?"":t},i=async()=>{const e=await c["e"].postJson("user_properties",{property:a.TEST_KIT_USER_PROPERTY,property_value:JSON.stringify(r.value)});return!!e};return{kits:r,initKits:e,saveKits:i,getLotNo:t,getExpiryDate:o}}}}]);
//# sourceMappingURL=chunk-0d4d81d1.d09597d3.js.map