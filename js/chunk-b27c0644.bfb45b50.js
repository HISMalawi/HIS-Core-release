(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b27c0644"],{"44e3":function(t,e,r){"use strict";var n=r("2909"),a=r("4f96"),o=r("1da1"),i=r("5530"),u=r("3835"),c=(r("96cf"),r("4e82"),r("ac1f"),r("1276"),r("d81d"),r("fb6a"),r("99af"),r("d3b7"),r("25f0"),r("3ca3"),r("ddb0"),r("b0c0"),r("1c74")),s=r("7a23"),l=r("b446"),d=r("23e6"),p=r("9283"),h=r("8a30"),f=r("d6aa"),m=r("5969"),v=r("d95e"),g=r("2706"),b=r("9ceb"),w=r("2ef0"),D=r("0011"),y=Object(s["defineComponent"])({data:function(){return{fields:[],report:{},reportReady:!1,period:"",startDate:"",endDate:"",customFileName:"",drillDownCache:{}}},methods:{formatGender:function(t){return Object(D["f"])(t)},toDate:function(t){return p["c"].toStandardHisDisplayFormat(t)},sortByArvNumber:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"arv_number";try{return t.sort((function(t,n){return e.getArvInt(t[r])>e.getArvInt(n[r])?1:-1}))}catch(n){return console.error(n),t}},getArvInt:function(t){if("string"===typeof t){var e=t.split("-"),r=Object(u["a"])(e,3),n=(r[0],r[1],r[2]),a=parseInt(n);return"number"===typeof a?a:0}return 0},tdARV:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b["a"].td(t,Object(i["a"])({sortValue:this.getArvInt(t)},e))},confirmPatient:function(t){return this.$router.push("/patients/confirm?person_id=".concat(t))},drilldownAsyncRows:function(t,e,r){var n=arguments;return Object(o["a"])(regeneratorRuntime.mark((function a(){var o,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=!(n.length>3&&void 0!==n[3])||n[3],a.next=3,h["modalController"].create({component:f["a"],cssClass:"large-modal",componentProps:{title:t,columns:e,asyncRows:r,canExport:o,showFilters:!0,rowsPerPage:50,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:function(){return h["modalController"].dismiss()}}});case 3:i=a.sent,i.present();case 5:case"end":return a.stop()}}),a)})))()},drilldownData:function(t,e,r,n){return Object(o["a"])(regeneratorRuntime.mark((function a(){var o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,h["modalController"].create({component:f["a"],cssClass:"large-modal",componentProps:{title:t,columns:e,rows:r,rowParser:n,rowsPerPage:50,showFilters:!0,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:function(){return h["modalController"].dismiss()}}});case 2:o=a.sent,o.present();case 4:case"end":return a.stop()}}),a)})))()},getDefaultDrillDownTable:function(){var t=this,e=[[b["a"].thTxt("ARV number"),b["a"].thTxt("Gender"),b["a"].thTxt("Birth Date"),b["a"].thTxt("Actions")]],r=function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(r){var i,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=0,c=r.map(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(r){var c,s,l,p,f,m,v,g,D,y;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(c=null,s=null,!Object(w["isArray"])(r)){e.next=10;break}if(l=Object(u["a"])(r,2),p=l[0],f=l[1],s=p,!(f in t.drillDownCache)){e.next=8;break}return m=Object(a["a"])(t.drillDownCache[f]),m[0],v=m.slice(1),e.abrupt("return",[s].concat(Object(n["a"])(v)));case 8:e.next=13;break;case 10:if(c=r,!(c in t.drillDownCache)){e.next=13;break}return e.abrupt("return",t.drillDownCache[c]);case 13:return e.next=15,d["a"].findByID(c);case 15:return g=e.sent,D=new d["a"](g),y=[],s&&(i=1,y.push(s)),y.push(t.tdARV(D.getArvNumber())),y.push(b["a"].td(t.formatGender(D.getGender()))),y.push(b["a"].tdDate(D.getBirthdate().toString())),y.push(b["a"].tdBtn("Show",Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,h["modalController"].dismiss({});case 2:t.$router.push({path:"/patient/dashboard/".concat(c)});case 3:case"end":return e.stop()}}),e)}))))),t.drillDownCache[c]=y,e.abrupt("return",y);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(c);case 4:return s=e.sent,e.abrupt("return",s.sort((function(t,e){return t[i].sortValue>e[i].sortValue?1:-1})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{rowParser:r,columns:e}},runTableDrill:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Drilldown patients",r=this.getDefaultDrillDownTable(),n=r.columns,a=r.rowParser;this.drilldownData(e,n,t,a)},drill:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Drill table";return t&&t.length>0?b["a"].tdLink(t.length,(function(){return e.runTableDrill(t,r)})):b["a"].td(0)},getQuaterOptions:function(){var t=m["a"].getReportQuarters();return t.map((function(t){return{label:t.name,value:t.start,other:t}}))},getDateDurationFields:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c["e"].getSessionDate(),i="2000-01-01";return[{id:"quarter",helpText:"Select Quarter",type:v["b"].TT_SELECT,condition:function(){return e},validation:function(t){return g["a"].required(t)},options:function(){var t=m["a"].getReportQuarters(a),e=t.map((function(t){return{label:t.name,value:t.start,other:t}}));return r&&(e=[{label:"Set custom period",value:"custom_period",other:{}}].concat(Object(n["a"])(e))),e}}].concat(Object(n["a"])(Object(l["b"])({id:"start_date",helpText:"Start",required:!0,condition:function(t){return t.quarter&&"custom_period"===t.quarter.value||!e},minDate:function(){return i},maxDate:function(){return o},estimation:{allowUnknown:!1},computeValue:function(t){return t}})),Object(n["a"])(Object(l["b"])({id:"end_date",helpText:"End",required:!0,condition:function(t){return t.quarter&&"custom_period"===t.quarter.value||!e},unload:function(e,r,n,a){"next"===r&&(t.endDate=a.end_date)},minDate:function(t,e){return e.start_date},maxDate:function(){return o},estimation:{allowUnknown:!1},computeValue:function(t){return t}})))}}});const k=y;e["a"]=k},"4dbc":function(t,e,r){"use strict";r.r(e);var n=r("7a23");function a(t,e,r,a,o,i){var u=Object(n["resolveComponent"])("report-template");return Object(n["openBlock"])(),Object(n["createBlock"])(u,{title:t.title,rows:t.rows,paginated:!0,customBtns:[{name:"DATE",size:"large",slot:"end",color:"warning",visible:!0,onClick:t.setReport}],columns:t.columns},null,8,["title","rows","customBtns","columns"])}var o=r("1da1"),i=(r("96cf"),r("d3b7"),r("159b"),r("91e4")),u=r("44e3"),c=r("d6aa"),s=r("9ceb"),l=r("8a30"),d=(r("e6e9"),r("9441"));function p(t,e){return h.apply(this,arguments)}function h(){return h=Object(o["a"])(regeneratorRuntime.mark((function t(e,r){var n,a=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=a.length>2&&void 0!==a[2]?a[2]:null,t.next=3,l["modalController"].create({component:d["a"],backdropDismiss:!1,cssClass:"full-modal",componentProps:{onFinish:r,fields:e,skipSummary:!0,disableAutoModalDismiss:!0,cancelAction:function(){"function"===typeof n&&n(),l["modalController"].dismiss()}}});case 3:t.sent.present();case 4:case"end":return t.stop()}}),t)}))),h.apply(this,arguments)}var f=r("b5e4"),m=r("fe70"),v=Object(n["defineComponent"])({mixins:[u["a"]],components:{ReportTemplate:c["a"]},data:function(){return{title:"Audit trail",rows:[],columns:[[s["a"].thTxt("Product Code"),s["a"].thTxt("Medication"),s["a"].thTxt("Transaction date"),s["a"].thTxt("Transaction type"),s["a"].thTxt("Quantity"),s["a"].thTxt("Username"),s["a"].thTxt("reason")]]}},mounted:function(){this.setReport()},methods:{setReport:function(){var t=this;this.rows=[],p(this.getDateDurationFields(),function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(r,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,m["m"].dismiss();case 2:return e.next=4,m["j"].create({message:"Please wait",backdropDismiss:!1});case 4:e.sent.present(),t.report=new i["a"],t.report.setStartDate(n.start_date),t.report.setEndDate(n.end_date),t.title="Audit trail ".concat(t.report.getDateIntervalPeriod()),t.report.loadTrail().then((function(e){e.forEach((function(e){t.rows.push([s["a"].td(e.product_code||""),s["a"].td(e.drug_name),s["a"].tdDate(e.transaction_date),s["a"].td(e.transaction_type),s["a"].tdNum(e.amount_committed_to_stock),s["a"].td(e.username),s["a"].td(e.transaction_reason)])})),m["j"].dismiss()})).catch((function(t){m["j"].dismiss(),Object(f["c"])(t)}));case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())}}}),g=r("d959"),b=r.n(g);const w=b()(v,[["render",a]]);e["default"]=w},5969:function(t,e,r){"use strict";r.d(e,"a",(function(){return p}));var n=r("5530"),a=r("d4ec"),o=r("bee2"),i=r("262e"),u=r("2caf"),c=(r("99af"),r("1c74")),s=r("9283"),l=r("5a0c"),d=r.n(l),p=function(t){Object(i["a"])(r,t);var e=Object(u["a"])(r);function r(){var t;return Object(a["a"])(this,r),t=e.call(this),t.endDate="",t.startDate="",t.quarter="",t.date=c["e"].getSessionDate(),t.programID=c["e"].getProgramID(),t}return Object(o["a"])(r,[{key:"getDateIntervalPeriod",value:function(){return"".concat(s["c"].toStandardHisDisplayFormat(this.startDate)," - ").concat(s["c"].toStandardHisDisplayFormat(this.endDate))}},{key:"setStartDate",value:function(t){this.startDate=t}},{key:"setEndDate",value:function(t){this.endDate=t}},{key:"setQuarter",value:function(t){this.quarter=t}},{key:"getReport",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c["e"].getJson(t,this.buildRequest(e))}},{key:"buildRequest",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={date:this.date,program_id:this.programID};return this.startDate&&this.endDate&&(e["start_date"]=this.startDate,e["end_date"]=this.endDate),this.quarter&&(e["quarter"]=this.quarter),Object(n["a"])(Object(n["a"])({},e),t)}}],[{key:"getQuarterBounds",value:function(t){var e=function(e){return d()("".concat(t,"-").concat(e,"-01")).daysInMonth()},r=function(e){return"".concat(t,"-").concat(e,"-01 00:00")},n=function(r){return"".concat(t,"-").concat(r,"-").concat(e(r)," 00:00")};return{Q1:{qtr:1,start:r("01"),end:n("03")},Q2:{qtr:2,start:r("04"),end:n("06")},Q3:{qtr:3,start:r("07"),end:n("09")},Q4:{qtr:4,start:r("10"),end:n("12")}}}},{key:"getQtrByDate",value:function(t){var e=this.getQuarterBounds(t.getFullYear());for(var r in e){var n=e[r],a=n.start,o=n.end;if(t>=new Date(a)&&t<=new Date(o))return e[r]}return null}},{key:"buildQtrObj",value:function(t,e){var r=this.getQuarterBounds(e),n=r[t],a=n.start,o=n.end;return{start:a,end:o,name:"".concat(t," ").concat(e)}}},{key:"getReportQuarters",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,e=[],r=new Date,n=r.getFullYear(),a=n;r=new Date("".concat(a,"-").concat(r.getMonth()+1,"-").concat(r.getDate()," 00:00"));var o=this.getQtrByDate(r),i=o.qtr,u=0;4===i&&e.push(this.buildQtrObj("Q1",n+1));while(u<t)0===u&&i<4&&e.push(this.buildQtrObj("Q".concat(i+1),n)),e.push(this.buildQtrObj("Q".concat(i),n)),i=i>0?i-=1:i,n=0==i?n-1:n,i=0==i?i+=4:i,u++;return e}}]),r}(c["e"])},"91e4":function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var n=r("1da1"),a=r("d4ec"),o=r("bee2"),i=r("262e"),u=r("2caf"),c=(r("d81d"),r("07ac"),r("b65f"),r("4e82"),r("96cf"),r("5969")),s=function(t){Object(i["a"])(r,t);var e=Object(u["a"])(r);function r(){var t;return Object(a["a"])(this,r),t=e.call(this),t.stock=[],t}return Object(o["a"])(r,[{key:"loadStock",value:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c["a"].getJson("pharmacy/items",{paginate:!1});case 2:this.stock=t.sent;case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getStockReport",value:function(){return c["a"].getJson("pharmacy/stock_report",{paginate:!1})}},{key:"loadTrail",value:function(){return this.getReport("pharmacy/audit_trail")}},{key:"groupStock",value:function(){var t={};for(var e in this.stock){var r=this.stock[e],n=r["drug_id"];t[n]||(t[n]={current_quantity:0,expiry_dates:[],pack_size:r.pack_size,drug_name:null===r["drug_name"]?r["drug_legacy_name"]:r["drug_name"]}),0!==r.current_quantity&&(t[n]["current_quantity"]+=parseFloat(r.current_quantity),t[n]["expiry_dates"].push(r["expiry_date"]))}return Object.values(t).map((function(t){var e="0";e=null==t.pack_size?t.current_quantity+"(tabs)":Math.trunc(t.current_quantity/t.pack_size);var r=t.expiry_dates.sort((function(t,e){return+new Date(t)-+new Date(e)}))[0];return{drugName:t.drug_name,currentQuantity:e,quantityIsTabs:null===t.pack_size,expiryDate:r}}))}}]),r}(c["a"])},b65f:function(t,e,r){var n=r("23e7"),a=Math.ceil,o=Math.floor;n({target:"Math",stat:!0},{trunc:function(t){return(t>0?o:a)(t)}})}}]);
//# sourceMappingURL=chunk-b27c0644.bfb45b50.js.map