(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fa92f74c"],{"0690":function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));a("13d5");var n=a("cc6f"),o=a("9283"),i=a("2ef0"),r=a("32b3"),l=a("5a0c"),c=a.n(l);class s extends n["a"]{constructor(e,t){super(e,68,t),this.lastDrugs=[],this.lastReceiptDate=""}async loadPreviousDrugs(){const e=new Date(this.date);e.setDate(e.getDate()-1);const t=e=>o["c"].toStandardHisFormat(e),a=await n["a"].getJson(`patients/${this.patientID}/drugs_received`,{date:t(e)});if(a){this.lastReceiptDate=a.reduce((e,a)=>!e||new Date(t(a.order.start_date))>new Date(e)?t(a.order.start_date):e,null);const e=r["a"].htnDrugReferences().map(e=>e.drug_id);this.lastDrugs=a.filter(a=>!e.includes(a.drug["drug_id"])&&t(a.order.start_date)===this.lastReceiptDate)}}getReceiptDate(){return this.lastReceiptDate}getLastDrugs(){return this.lastDrugs}receivedDrugsBefore(){return!Object(i["isEmpty"])(this.lastDrugs)}buildPillCountObs(e,t){return this.buildValueNumber("Number of tablets brought to clinic",t,null,e)}async buildAdherenceObs(e,t,a){const o=await n["a"].getConceptID("Drug adherence",!0);return{concept_id:o,value_numeric:a,value_drug:t,value_modifier:"%",order_id:e,person_id:this.patientID,obs_datetime:n["a"].getSessionDate()}}isAdherenceGood(e){return e>=95&&e<=105}calculateAdherence(e,t,a){return Math.round(100*(e-t)/(e-a))}calculateExpected(e,t,a,n){const o="QW"===n?"week":"day",i=this.calcTimeElapsed(a,o);return e-i*parseFloat(t.toString())}calcTimeElapsed(e,t){return c()(this.date).diff(e,t)}calculateUnaccountedOrMissed(e,t){const a=parseFloat(e)-parseFloat(t);return a<0?-1*a+" missed":a+" unacc"}}},"0cb1":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("cc6f");class o extends n["a"]{constructor(e,t){super(e,57,t)}}},"102f":function(e,t,a){"use strict";a("b94b")},"141d":function(e,t,a){"use strict";a("9674")},"1f9a":function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a("1c74"),o=a("ad60"),i=a("d10e");class r extends n["e"]{constructor(){super()}static create(e){return super.postJson("/person_attributes",e)}}var l=a("4db7");class c extends n["e"]{constructor(){super(),this.personId=0}getPersonID(){return this.personId}setPersonID(e){this.personId=e}async registerPatient(e,t){await this.createPerson(e),await this.createPersonAttributes(t);const a=await this.createPatient();return await this.printPatient(),a}async registerGuardian(e){return this.createPerson(e)}updatePerson(e){return new i["a"](e).update(this.personId)}async createPerson(e){const t=await new i["a"](e).create();return this.personId=t.person_id,t}createPatient(){return o["a"].createPatient(this.personId)}async createPersonAttributes(e){for(const t in e)await r.create({...e[t],person_id:this.personId})}printPatient(){return new l["a"](this.personId).printNidLbl()}}},"2cef":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("1c74");class o extends n["e"]{constructor(){super()}static voidRelation(e,t,a){return n["e"].void(`people/${e}/relationships/${t}`,{reason:a})}static async amendRelation(e,t,a,n){return await o.voidRelation(e,a,"Updating guardian relationship"),o.createRelation(e,t,n)}static getRelations(){return super.getJson("types/relationships")}static createRelation(e,t,a){return super.postJson(`people/${e}/relationships`,{relationship_type_id:a,relation_id:t})}}},"32b3":function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return r}));var n,o=a("cc6f"),i=a("7957");(function(e){e["Prescription"]="htnPrescription"})(n||(n={}));class r extends o["a"]{constructor(e,t){super(e,48,t)}static getBpGrade(e,t){return e<140&&t<90?"normal":e>=140&&e<160||t>=100&&t<110?"grade 1":e>=180&&t>110||e>=180?"grade 3":e>=160&&e<180||t>=110?"grade 2":"N/A"}static isBpNormotensive(e){const[t,a]=Object.values(e).sort((e,t)=>e.date<t.date?1:0).map(e=>this.getBpGrade(e.sbp,e.dbp));return"normal"===t&&"normal"===a}getSystolicBp(){return i["a"].getFirstValueNumber(this.patientID,"Systolic blood pressure")}getDiastolicBp(){return i["a"].getFirstValueNumber(this.patientID,"Diastolic blood pressure")}async onBpDrugs(){const e=await i["a"].getFirstValueCoded(this.patientID,"Treatment status");return!!e&&"Yes"===e}async getBPTrail(){return await o["a"].getJson(`/patients/${this.patientID}/bp_trail`)}async getCurrentDrugs(){return await o["a"].getJson(`/patients/${this.patientID}/current_bp_drugs`)}async getLastDrugs(){return await o["a"].getJson(`/patients/${this.patientID}/last_bp_drugs_dispensation`)}async getAdherence(e,t){return await o["a"].postJson(`/patients/${this.patientID}/remaining_bp_drugs`,{drug_id:e,pills:t})}async enrollPatient(e){return await o["a"].postJson(`/patients/${this.patientID}/update_or_create_htn_state`,e)}static htnDrugReferences(){return[{drug_id:275,drug_name:"HCZ (25mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:942,drug_name:"Enalapril (5mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:943,drug_name:"Enalapril (10mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:558,drug_name:"Amlodipine (5mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:559,drug_name:"Amlodipine (10mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:117,drug_name:"Atenolol (50mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:11,drug_name:"Atenolol(100mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"}]}getDrugs(){return{HCZ:{drugs:[{drugName:"HCZ (25mg tablet)",drugID:275,amount:"25mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null}],selected:null,notes:[]},Enalapril:{drugs:[{drugName:"Enalapril (5mg tablet)",drugID:942,amount:"5mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Enalapril (10mg tablet)",drugID:943,amount:"10mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]},Amlodipine:{drugs:[{drugName:"Amlodipine (5mg tablet)",drugID:558,amount:"5mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Amlodipine (10mg tablet)",drugID:559,amount:"10mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]},Atenolol:{drugs:[{drugName:"Atenolol (50mg tablet)",drugID:117,amount:"50mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Atenolol(100mg tablet)",drugID:11,amount:"100mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]}}}}},"5b71":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a("9b7c"),o=a("cc6f");class i extends o["a"]{constructor(e){super(e,57),this.patientID=e,this.testTypeID=-1,this.resultDate="",this.testID=-1}createLabResult(e){return o["a"].postJson(`lab/tests/${this.testID}/results`,{encounter_id:this.encounterID,date:this.resultDate,measures:e})}getTestID(){return this.testID}getTestTypeID(){return this.testTypeID}setTestTypeID(e){this.testTypeID=e}setResultDate(e){this.resultDate=e}setTestID(e){this.testID=e}getTestsWithoutResults(){return n["a"].getOrders(this.patientID,{status:"drawn"})}getTestIndicators(){return n["a"].getJson("lab/test_result_indicators",{test_type_id:this.testTypeID})}}},"5f2c":function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a("cc6f"),o=a("71c3"),i=(a("13d5"),a("1c74"));class r extends i["e"]{constructor(){super()}static async fetchAvailableDrugStock(e){const t=await this.getJson("pharmacy/items",{drug_id:e});if(t&&t.length>0)return t.reduce((e,t)=>e+t.current_quantity,0)}}var l=a("d1ca");const c={11:[30],21:[25],22:[60],24:[30,60,90,100],30:[90],39:[60],73:[120],74:[60],76:[1e3],297:[30,60,90],576:[30,60,90],613:[60],731:[60],732:[60],733:[60],734:[30],735:[30],736:[60],738:[60],931:[12,30,60],932:[30],954:[60],963:[30,60,90],968:[60],969:[30],971:[30,60,90],976:[60],977:[30],982:[30],983:[30,90],1039:[30,60,90],1043:[60],1044:[30],1056:[24],1216:[3,6,12]};class s extends n["a"]{constructor(e,t){super(e,54,t),this.drugHistory=[],this.currentDrugOrder=[],this.useDrugManagement=!1}setIsDrugManagementEnabled(e){this.useDrugManagement=e}async loadDrugManagementEnabled(){this.useDrugManagement=await l["b"].drugManagementEnabled()}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}buildDispensations(e,t,a){const n=[];for(let o=0;o<a;o++)n.push({drug_order_id:e,date:this.date,quantity:t/a});return n}saveDispensations(e){return n["a"].postJson("/dispensations",{dispensations:e,program_id:n["a"].getProgramID()})}async voidOrder(e){return n["a"].void("/dispensations/"+e,{})}async loadDrugHistory(){try{const e=await o["a"].getDrugOrderHistory(this.patientID);e&&(this.drugHistory=e)}catch(e){console.warn(e)}}async loadCurrentDrugOrder(){const e=await o["a"].getDrugOrders(this.patientID);if(e){if(this.useDrugManagement){const t=e.map(async e=>(e["available_stock"]=await r.fetchAvailableDrugStock(e.drug.drug_id),e));return void(this.currentDrugOrder=await Promise.all(t))}this.currentDrugOrder=e}}getDrugPackSizes(e){return e in c?c[e]:[30,60,90]}calcCompletePack(e,t){const a=e.barcodes.sort((e,t)=>e.tabs-t.tabs);if(0==a.length||0==t)return t;for(const o in a){const{tabs:e}=a[o];if(parseInt(e)>=t)return e}const n=parseInt(a[a.length-1].tabs);return n}}},"66c5":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a("cc6f"),o=a("ad60"),i=a("cc74");class r extends n["a"]{constructor(e,t){super(e,51,t),this.sitePrefix=""}getSitePrefix(){return this.sitePrefix}async loadSitePrefix(){this.sitePrefix=await i["b"].sitePrefix()}createArvNumber(e){return o["a"].postJson("/patient_identifiers/",{patient_id:this.patientID,identifier_type:4,identifier:e})}buildArvNumber(e){return`${this.sitePrefix}-ARV-${e}`}}},"71c3":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("1c74");class o extends n["e"]{constructor(){super()}static create(e){return this.postJson("drug_orders",e)}static updateDispensationOrders(e){return this.postJson("dispensations",{program_id:this.getProgramID(),dispensations:e.map(e=>({date:this.getSessionDate(),drug_order_id:e["order_id"],quantity:e["quantity"]}))})}static getDrugOrderHistory(e){return this.getJson("drug_orders",{patient_id:e})}static getDrugOrders(e){return this.getJson("drug_orders",{patient_id:e,date:this.getSessionDate(),program_id:this.getProgramID()})}static getAllDrugOrders(e,t=1e3){return this.getJson("drug_orders",{patient_id:e,program_id:n["e"].getProgramID(),page_size:t})}static getLastDrugsReceived(e){return this.getJson(`patients/${e}/last_drugs_received`,{date:this.getSessionDate(),program_id:this.getProgramID()})}static getDrugDosages(e,t,a=this.getSessionDate()){const n={drug_id:t,date:a};return this.getJson(`programs/${this.getProgramID()}/patients/${e}/drug_doses`,n)}static getOrderByPatient(e,t){return this.getJson("/drug_orders",{patient_id:e,program_id:this.getProgramID(),...t})}}},"76df":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("7f35");async function o(e,t="action-sheet-modal"){const a=await Object(n["c"])("Are you sure you want to void record?","Please specify reason for voiding this record",["Mistake/ Wrong Entry","Duplicate","System Error"],[{name:"Cancel",slot:"start"},{name:"Void",color:"danger",slot:"end",role:"action"}],"",t);a.selection&&"Void"===a.action&&await e(a.selection)}},"7f12":function(e,t,a){"use strict";var n=a("7a23");const o={key:0},i={key:1},r=Object(n["createTextVNode"])(" Close ");function l(e,t,a,l,c,s){const d=Object(n["resolveComponent"])("ion-title"),u=Object(n["resolveComponent"])("ion-toolbar"),m=Object(n["resolveComponent"])("ion-header"),b=Object(n["resolveComponent"])("his-basic-table"),p=Object(n["resolveComponent"])("text-skeloton"),g=Object(n["resolveComponent"])("ion-content"),O=Object(n["resolveComponent"])("ion-button"),v=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(m,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,null,{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.title),1)]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(g,null,{default:Object(n["withCtx"])(()=>[e.ready?(Object(n["openBlock"])(),Object(n["createBlock"])("div",o,[Object(n["createVNode"])(b,{columns:e.columns,rows:e.rows},null,8,["columns","rows"])])):(Object(n["openBlock"])(),Object(n["createBlock"])("div",i,[Object(n["createVNode"])(p)]))]),_:1}),Object(n["createVNode"])(v,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,{color:"danger",onClick:e.closeModal,slot:"end"},{default:Object(n["withCtx"])(()=>[r]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}var c=a("a3a5"),s=a("8a30"),d=a("ded6"),u=Object(n["defineComponent"])({components:{HisBasicTable:c["a"],IonHeader:s["IonHeader"],IonToolbar:s["IonToolbar"],IonContent:s["IonContent"],IonFooter:s["IonFooter"],IonButton:s["IonButton"],TextSkeloton:d["a"]},props:{title:{type:String,required:!0},columns:{type:Object,required:!0},onRows:{type:Function,required:!0}},data:()=>({rows:[],ready:!1}),watch:{onRows:{async handler(e){e&&(this.rows=await e(),this.ready=!0)},immediate:!0,deep:!0}},methods:{async closeModal(){await s["modalController"].dismiss({})}}}),m=a("d959"),b=a.n(m);const p=b()(u,[["render",l]]);t["a"]=p},"83af":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("cc6f");class o extends n["a"]{constructor(e,t){super(e,7,t)}async getNextAppointment(){const e=n["a"].getProgramID();return n["a"].getJson(`/programs/${e}/patients/${this.patientID}/next_appointment_date`,{date:this.date})}static async getDailiyAppointments(e){const t=n["a"].getProgramID();return n["a"].getJson(`/programs/${t}/booked_appointments`,{date:e,paginate:!1})}}},9674:function(e,t,a){},"99e7":function(e,t,a){"use strict";a.r(t);var n=a("7a23");function o(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("information-header"),c=Object(n["resolveComponent"])("ion-col"),s=Object(n["resolveComponent"])("ion-row"),d=Object(n["resolveComponent"])("visits-summary"),u=Object(n["resolveComponent"])("ion-grid"),m=Object(n["resolveComponent"])("layout");return Object(n["openBlock"])(),Object(n["createBlock"])(m,null,{default:Object(n["withCtx"])(()=>[e.isReady?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:0,class:"ion-no-margin ion-no-padding"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{size:"12"},{default:Object(n["withCtx"])(()=>[e.patient?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,patient:e.patient,guardians:e.guardians,artStartDate:e.artStartDate,onUpdateARVNumber:e.updateARVNumber,onAddGuardian:e.addGuardian,onUpdatePatient:e.updateDemographics},null,8,["patient","guardians","artStartDate","onUpdateARVNumber","onAddGuardian","onUpdatePatient"])):Object(n["createCommentVNode"])("",!0)]),_:1})]),_:1}),Object(n["createVNode"])(s,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[e.patient?(Object(n["openBlock"])(),Object(n["createBlock"])(d,{key:0,patient:e.patient,startDate:e.artStartDate},null,8,["patient","startDate"])):Object(n["createCommentVNode"])("",!0)]),_:1})]),_:1})]),_:1})):Object(n["createCommentVNode"])("",!0)]),_:1})}var i=a("9283"),r=a("7def"),l=a("8d56");const c=Object(n["withScopeId"])("data-v-3645347c");Object(n["pushScopeId"])("data-v-3645347c");const s=Object(n["createVNode"])("span",{class:"title"},"Summary of Visits",-1),d={class:"ion-float-right ion-margin-end ion-margin-bottom"};Object(n["popScopeId"])();const u=c((function(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-icon"),u=Object(n["resolveComponent"])("ion-button"),m=Object(n["resolveComponent"])("ion-card-title"),b=Object(n["resolveComponent"])("ion-card-header"),p=Object(n["resolveComponent"])("report-table"),g=Object(n["resolveComponent"])("ion-card-content"),O=Object(n["resolveComponent"])("ion-card");return Object(n["openBlock"])(),Object(n["createBlock"])(O,{class:"his-card",style:{padding:"0 !important"}},{default:c(()=>[Object(n["createVNode"])(b,null,{default:c(()=>[Object(n["createVNode"])(m,null,{default:c(()=>[s,Object(n["createVNode"])("span",d,[(Object(n["openBlock"])(!0),Object(n["createBlock"])(n["Fragment"],null,Object(n["renderList"])(e.actionButtons,e=>(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:e.label,onClick:e.action,color:e.color||"primary"},{default:c(()=>[e.icon?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,icon:e.icon,class:"ion-margin-right"},null,8,["icon"])):Object(n["createCommentVNode"])("",!0),Object(n["createTextVNode"])(" "+Object(n["toDisplayString"])(e.label),1)]),_:2},1032,["onClick","color"]))),128))])]),_:1})]),_:1}),Object(n["createVNode"])(g,{class:"ion-no-padding",style:{"min-height":"45vh"}},{default:c(()=>[Object(n["createVNode"])(p,{rows:e.rows,columns:e.columns,config:e.tableConfig},null,8,["rows","columns","config"])]),_:1})]),_:1})}));var m=a("7f12"),b=a("9ceb"),p=a("80e3"),g=a("ec2a"),O=a("7957"),v=a("23e6"),f=a("ad60"),h=a("76df"),j=a("8a30"),V=a("5a0c"),C=a.n(V);const _=Object(n["createTextVNode"])("Viral Load Results"),N=Object(n["createTextVNode"])("Other Results Options: "),w=Object(n["createTextVNode"])("LDL"),I=Object(n["createTextVNode"])("Close"),y=Object(n["createTextVNode"])("Reset"),D=Object(n["createTextVNode"])("Save");function x(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-title"),c=Object(n["resolveComponent"])("ion-toolbar"),s=Object(n["resolveComponent"])("ion-header"),d=Object(n["resolveComponent"])("DateInput"),u=Object(n["resolveComponent"])("ion-col"),m=Object(n["resolveComponent"])("SelectInput"),b=Object(n["resolveComponent"])("NumberInput"),p=Object(n["resolveComponent"])("ion-row"),g=Object(n["resolveComponent"])("ion-label"),O=Object(n["resolveComponent"])("ion-checkbox"),v=Object(n["resolveComponent"])("ion-item"),f=Object(n["resolveComponent"])("ion-grid"),h=Object(n["resolveComponent"])("ion-content"),j=Object(n["resolveComponent"])("ion-button"),V=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(s,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,null,{default:Object(n["withCtx"])(()=>[_]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(h,{class:"ion-padding"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(f,{style:{width:"100%"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{size:"12",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,{modelValue:e.form.orderDate,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.orderDate=t),form:e.form},null,8,["modelValue","form"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.reason,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.reason=t),options:e.reasons},null,8,["modelValue","options"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.specimenConcept,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.specimenConcept=t),options:e.specimens},null,8,["modelValue","options"])]),_:1}),Object(n["createVNode"])(u,{size:"12",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,{modelValue:e.form.resultDate,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.resultDate=t),form:e.form},null,8,["modelValue","form"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,{modelValue:e.form.modifier,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.modifier=t),options:e.modifiers},null,8,["modelValue","options"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.form.result,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.result=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})]),_:1}),Object(n["createVNode"])(p,{class:"ion-margin-top"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{size:"12"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(g,{class:"ion-padding-vertical bold"},{default:Object(n["withCtx"])(()=>[N]),_:1}),Object(n["createVNode"])(v,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(g,null,{default:Object(n["withCtx"])(()=>[w]),_:1}),Object(n["createVNode"])(O,{slot:"start",modelValue:e.ldl,"onUpdate:modelValue":t[7]||(t[7]=t=>e.ldl=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(V,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(j,{color:"primary",onClick:t[8]||(t[8]=t=>e.modal.hide()),slot:"end"},{default:Object(n["withCtx"])(()=>[I]),_:1}),Object(n["createVNode"])(j,{color:"warning",onClick:e.resetResults,slot:"end"},{default:Object(n["withCtx"])(()=>[y]),_:1},8,["onClick"]),Object(n["createVNode"])(j,{color:"success",onClick:e.saveResults,slot:"end"},{default:Object(n["withCtx"])(()=>[D]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}var k,P=a("5ab5"),T=a("be95"),A=a("f27f"),S=a("403e"),R=a("9b7c"),B=a("0cb1"),E=a("5e76"),F=a("5b71"),H=a("8158"),G=a("0ba8");(function(e){e["RELOAD_PATIENT_DATA"]="reload_patient_data",e["RELOAD_PATIENT_VISIT_DATA"]="reload_patient_visit_data",e["RELOAD_GUARDIAN_DATA"]="reload_guardian_data"})(k||(k={}));var q=a("da44"),M=Object(n["defineComponent"])({components:{IonContent:j["IonContent"],IonFooter:j["IonFooter"],IonHeader:j["IonHeader"],IonTitle:j["IonTitle"],IonToolbar:j["IonToolbar"],IonButton:j["IonButton"],IonLabel:j["IonLabel"],IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],IonCheckbox:j["IonCheckbox"],IonItem:j["IonItem"],DateInput:P["a"],SelectInput:T["a"],NumberInput:A["a"]},props:{patient:{type:Object,required:!0}},setup(e){const t=Object(n["ref"])(!1),a=Object(S["d"])(["=",">","<",">=","<="]),o=Object(S["d"])(["Routine","Targeted","Confirmatory","Stat","Repeat / Missing"]),i=Object(n["ref"])([]),r=Object(n["reactive"])({orderDate:{value:"",label:"Order Date",required:!0,validation:async t=>C()(t.value).isValid()?C()(t.value).isAfter(C()())?["Order date cannot be in the future"]:C()(t.value).isBefore(C()(e.patient.getBirthdate()))?["Order date cannot be before patient's date of birth"]:null:["Invalid date"]},resultDate:{value:"",label:"Result Date",required:!0,validation:async(t,a)=>C()(t.value).isValid()?C()(t.value).isAfter(C()())?["Result date cannot be in the future"]:C()(t.value).isBefore(C()(a.orderDate.value))?["Result date cannot be before order date"]:C()(t.value).isBefore(C()(e.patient.getBirthdate()))?["Result date cannot be before patient's date of birth"]:null:["Invalid date"]},specimenConcept:{value:"",label:"Specimen",placeholder:"Select a specimen",required:!0},modifier:{value:"",label:"Modifier",placeholder:"Select a modifier",required:!0},reason:{value:"",label:"Reason",placeholder:"Select a reason",required:!0},result:{value:"",label:"Result Value",placeholder:"Enter a result value",required:!0}}),l=async()=>Object(E["e"])(r,async a=>{await B["a"].setSessionDate(a.orderDate);const n=new B["a"](e.patient.getID(),-1),o=await H["a"].getConceptID("HIV viral load"),i=await n.createEncounter();if(!i)throw new Error("Unable to create lab order encounter");const r=await R["a"].buildLabOrders(i,[{specimenConcept:a.specimenConcept.value,reason:a.reason.value,concept_id:o}]),l=await R["a"].saveOrdersArray(i.encounter_id,r);if(!l)throw new Error("Unable to save lab orders");await F["a"].setSessionDate(a.resultDate);const c=new F["a"](e.patient.getID());c.setTestID(l[0].tests[0].id),c.setResultDate(a.resultDate);const s=await c.createEncounter();if(!s)throw new Error("Unable to create lab result encounter");await c.createLabResult([{indicator:{concept_id:o},value:t.value?"LDL":parseInt(a.result),value_modifier:t.value?"=":a.modifier.value,value_type:t.value?"text":"numeric"}]),await F["a"].resetSessionDate(),await q["a"].hide(),G["b"].emit(k.RELOAD_PATIENT_VISIT_DATA)}),c=()=>{t.value=!1;for(const e in r)r[e].value="",r[e].error=""};return Object(n["watch"])(t,e=>{e&&(r.modifier.value="",r.result.value=void 0,r.modifier.error="",r.result.error=""),r.modifier.disabled=e,r.modifier.required=!e,r.result.disabled=e,r.result.required=!e}),Object(n["onMounted"])(async()=>{i.value=(await R["a"].getSpecimens("HIV viral load")).map(e=>({label:e.name,value:e["concept_id"]}))}),{form:r,modifiers:a,reasons:o,specimens:i,ldl:t,modal:q["a"],resetResults:c,saveResults:l}}}),L=a("d959"),U=a.n(L);const z=U()(M,[["render",x]]);var $=z;const J=Object(n["createTextVNode"])("Patient Outcomes"),Y=Object(n["createTextVNode"])("Close"),W=Object(n["createTextVNode"])("Void Program");function Q(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-title"),c=Object(n["resolveComponent"])("ion-toolbar"),s=Object(n["resolveComponent"])("ion-header"),d=Object(n["resolveComponent"])("ion-badge"),u=Object(n["resolveComponent"])("ion-col"),m=Object(n["resolveComponent"])("ion-row"),b=Object(n["resolveComponent"])("enrollment-form"),p=Object(n["resolveComponent"])("outcome-form"),g=Object(n["resolveComponent"])("outcomes-table"),O=Object(n["resolveComponent"])("ion-grid"),v=Object(n["resolveComponent"])("ion-content"),f=Object(n["resolveComponent"])("ion-button"),h=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(s,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,null,{default:Object(n["withCtx"])(()=>[J]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(v,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,{style:{width:"100%"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(m,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,{color:"lightblue",class:"ion-padding",style:{width:"100%"},disabled:""},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.enrollmentStatus),1)]),_:1})]),_:1})]),_:1}),e.isEnrolled?(Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],{key:1},[e.outcomes?(Object(n["openBlock"])(),Object(n["createBlock"])(m,{key:0,class:"his-card",style:{"margin-bottom":".4rem"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{"date-enrolled":e.enrollDate,birthdate:e.birthdate,outcomes:e.outcomes,onSaveOutcome:e.saveOutcome},null,8,["date-enrolled","birthdate","outcomes","onSaveOutcome"])]),_:1})):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(m,{class:"his-card",style:[{padding:"0 !important"},{minHeight:e.totalStates?"0":"30vh"}]},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{size:"12",class:"ion-no-padding"},{default:Object(n["withCtx"])(()=>{var t;return[Object(n["createVNode"])(g,{patientStates:null===(t=e.program)||void 0===t?void 0:t.patient_states,onVoidOutcome:e.voidOutcome},null,8,["patientStates","onVoidOutcome"])]}),_:1})]),_:1},8,["style"])],64)):(Object(n["openBlock"])(),Object(n["createBlock"])(m,{key:0,class:"his-card",style:{"margin-bottom":".4rem"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,{size:"12"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{patientProgram:e.patientProgram,birthdate:e.birthdate,onEnrollProgram:e.enrollProgram},null,8,["patientProgram","birthdate","onEnrollProgram"])]),_:1})]),_:1}))]),_:1})]),_:1}),Object(n["createVNode"])(h,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(f,{color:"primary",onClick:t[1]||(t[1]=t=>e.modal.hide()),slot:"end"},{default:Object(n["withCtx"])(()=>[Y]),_:1}),e.isEnrolled?(Object(n["openBlock"])(),Object(n["createBlock"])(f,{key:0,color:"danger",onClick:e.voidProgram,slot:"end"},{default:Object(n["withCtx"])(()=>[W]),_:1},8,["onClick"])):Object(n["createCommentVNode"])("",!0)]),_:1})]),_:1})],64)}var K=a("b5e4"),Z=a("74f4"),X=a("2ef0");const ee=Object(n["createVNode"])("p",{class:"ion-padding-horizontal ion-margin-vertical bold ion-margin-top"},"Previous Outcomes",-1);function te(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("data-table");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[ee,Object(n["createVNode"])(l,{rows:e.rows,columns:e.columns,config:e.tableConfig,"row-actions-buttons":e.TableRowActions,color:"custom"},null,8,["rows","columns","config","row-actions-buttons"])],64)}var ae=a("4971"),ne=Object(n["defineComponent"])({name:"OutcomesTable",props:{patientStates:{type:Array,required:!0}},components:{DataTable:ae["DataTable"]},emits:["voidOutcome"],setup(e,{emit:t}){const a=[{path:"name",label:"Outcome"},{path:"start_date",label:"Start Date",formatter:e=>C()(e).format(i["a"])},{path:"end_date",label:"End Date",formatter:e=>C()(e).format(i["a"])}],o={showSearchField:!1,showSubmitButton:!1},r=Object(n["computed"])(()=>e.patientStates.map((e,t)=>({...e,index:t}))),l=[{label:"void",color:"danger",action:async e=>{await Object(K["a"])("Are you sure you want to void this outcome?")&&t("voidOutcome",{stateId:e.patient_state_id,index:e.index})}}];return{rows:r,columns:a,tableConfig:o,TableRowActions:l}}});const oe=U()(ne,[["render",te]]);var ie=oe;const re=Object(n["createTextVNode"])("Reset"),le=Object(n["createTextVNode"])("Enroll");function ce(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("DateInput"),c=Object(n["resolveComponent"])("ion-col"),s=Object(n["resolveComponent"])("ion-button"),d=Object(n["resolveComponent"])("ion-row"),u=Object(n["resolveComponent"])("ion-grid");return Object(n["openBlock"])(),Object(n["createBlock"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{size:"12"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,{modelValue:e.form.date,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.date=t),form:e.form,"max-date":e.today},null,8,["modelValue","form","max-date"])]),_:1}),Object(n["createVNode"])(c,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{color:"warning",onClick:e.onReset},{default:Object(n["withCtx"])(()=>[re]),_:1},8,["onClick"]),Object(n["createVNode"])(s,{color:"success",onClick:e.enrollProgram},{default:Object(n["withCtx"])(()=>[le]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}var se=Object(n["defineComponent"])({name:"EnrollmentForm",components:{DateInput:P["a"],IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],IonButton:j["IonButton"]},props:["birthdate"],emits:["enrollProgram"],setup(e,{emit:t}){const a=C()().format("YYYY-MM-DD"),o=Object(n["reactive"])({date:{value:"",label:"Date of Enrollment",required:!0,validation:async t=>C()(t.value).isBefore(e.birthdate)?["Date of enrollment cannot be before date of birth"]:null}}),i=()=>{o.date.value="",o.date.error=""},r=async()=>Object(E["e"])(o,({date:e})=>t("enrollProgram",e));return{form:o,today:a,onReset:i,enrollProgram:r}}});const de=U()(se,[["render",ce]]);var ue=de;const me=Object(n["createVNode"])("p",null,"Add New Outcome",-1),be=Object(n["createTextVNode"])("Reset"),pe=Object(n["createTextVNode"])("Save");function ge(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-col"),c=Object(n["resolveComponent"])("SelectInput"),s=Object(n["resolveComponent"])("DateInput"),d=Object(n["resolveComponent"])("ion-button"),u=Object(n["resolveComponent"])("ion-row"),m=Object(n["resolveComponent"])("ion-grid");return Object(n["openBlock"])(),Object(n["createBlock"])(m,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,{size:"12"},{default:Object(n["withCtx"])(()=>[me]),_:1}),Object(n["createVNode"])(l,{size:"6",class:"ion-margin-top-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{modelValue:e.form.status,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.status=t),form:e.form,options:e.outcomes},null,8,["modelValue","form","options"])]),_:1}),Object(n["createVNode"])(l,{size:"6",class:"ion-margin-top-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{modelValue:e.form.date,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.date=t),form:e.form,"max-date":e.today},null,8,["modelValue","form","max-date"])]),_:1}),e.isTransferredOut?(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:0,size:"12",class:"ion-margin-top-vertical"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{modelValue:e.form.nextFacility,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.nextFacility=t),form:e.form,asyncOptions:e.getFacilities},null,8,["modelValue","form","asyncOptions"])]),_:1})):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(l,{size:"12",class:"ion-margin-top"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(d,{color:"warning",onClick:e.onReset},{default:Object(n["withCtx"])(()=>[be]),_:1},8,["onClick"]),Object(n["createVNode"])(d,{color:"success",onClick:e.onSave},{default:Object(n["withCtx"])(()=>[pe]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}var Oe=a("2706"),ve=a("e86e"),fe=Object(n["defineComponent"])({name:"OutcomeForm",props:{outcomes:{type:Array,required:!0},dateEnrolled:{type:String,required:!0},birthdate:{type:String,required:!0}},components:{DateInput:P["a"],IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],IonButton:j["IonButton"],SelectInput:T["a"]},emits:["saveOutcome"],setup(e,{emit:t}){const a=C()().format("YYYY-MM-DD"),o=Object(n["reactive"])({date:{value:"",label:"Outcome Date",required:!0,validation:async t=>C()(t.value).isBefore(e.birthdate)?["Outcome date cannot be before date of birth"]:C()(t.value).isBefore(e.dateEnrolled)?["Outcome date cannot be before enrollment date"]:null},status:{value:"",label:"Outcome",required:!0},nextFacility:{value:"",label:"Next Facility",validation:async(e,t)=>"Patient transferred out"===t.status.value.label&&Oe["a"].required(e)}}),i=Object(n["computed"])(()=>{var e;return"Patient transferred out"===(null===(e=o.status.value)||void 0===e?void 0:e.label)}),r=()=>{for(const e in o)o[e].value="",o[e].error=""},l=()=>Object(E["e"])(o,e=>t("saveOutcome",e));return{form:o,today:a,isTransferredOut:i,onSave:l,onReset:r,getFacilities:ve["b"]}}});const he=U()(fe,[["render",ge]]);var je=he,Ve=Object(n["defineComponent"])({components:{IonContent:j["IonContent"],IonFooter:j["IonFooter"],IonHeader:j["IonHeader"],IonTitle:j["IonTitle"],IonToolbar:j["IonToolbar"],IonButton:j["IonButton"],IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],IonBadge:j["IonBadge"],OutcomesTable:ie,EnrollmentForm:ue,OutcomeForm:je},props:{patient:{type:Object,required:!0}},setup(e){const{toStandardHisDisplayFormat:t,toStandardHisFormat:a}=i["c"],o=new Z["a"](e.patient.getID()),r=Object(n["computed"])(()=>a(e.patient.getBirthdate())),l=Object(n["ref"])(),c=Object(n["computed"])(()=>!Object(X["isEmpty"])(l.value)),s=Object(n["ref"])(""),d=Object(n["ref"])(),u=Object(n["computed"])(()=>{var e,t,a;return null!==(e=null===(t=l.value)||void 0===t||null===(a=t.patient_states)||void 0===a?void 0:a.length)&&void 0!==e?e:0}),m=Object(n["computed"])(()=>c.value&&s.value?"Patient enrolled in this porgram on "+t(s.value):"Patient is not enrolled in this program"),b=async({date:e,status:t,nextFacility:a})=>{o.setStateDate(e),o.setStateId(t.value),a&&await o.transferOutEncounter(a.other),await o.updateState(),await Object(K["d"])("Outcome saved successfully",1e3),await q["a"].hide(),G["b"].emit(k.RELOAD_PATIENT_VISIT_DATA)},p=async e=>{o.setProgramDate(e),await o.enrollProgram(),await Object(K["d"])("Program enrolled successfully",1e3),await q["a"].hide(),G["b"].emit(k.RELOAD_PATIENT_VISIT_DATA)},g=async()=>{var e;o.setPatientProgramId((null===(e=l.value)||void 0===e?void 0:e.patient_program_id)||-1),await o.voidProgram("duplicate / system error"),await Object(K["d"])("Patient voided from program successfully",1e3),await q["a"].hide(),G["b"].emit(k.RELOAD_PATIENT_VISIT_DATA)},O=async({stateId:e,index:t})=>{var a;o.setStateId(e),await o.voidState("duplicate / system error"),Object(K["d"])("Outcome voided successfully"),null===(a=l.value)||void 0===a||a.patient_states.splice(t,1),G["b"].emit(k.RELOAD_PATIENT_VISIT_DATA)};return Object(n["onMounted"])(async()=>{const e=await o.getPrograms();if(l.value=e.find(e=>"HIV PROGRAM"===e.program.name),l.value){s.value=l.value.date_enrolled;const e=await o.getProgramOutcomes();d.value=e.map(e=>({label:e.name,value:e.program_workflow_state_id,other:e}))}}),{modal:q["a"],patientProgram:o,isEnrolled:c,enrollDate:s,birthdate:r,enrollmentStatus:m,outcomes:d,program:l,totalStates:u,toStandardHisDisplayFormat:t,saveOutcome:b,enrollProgram:p,voidProgram:g,voidOutcome:O}}});const Ce=U()(Ve,[["render",Q]]);var _e=Ce;const Ne=Object(n["withScopeId"])("data-v-56a57ffb");Object(n["pushScopeId"])("data-v-56a57ffb");const we=Object(n["createTextVNode"])("Patient Visit"),Ie=Object(n["createTextVNode"])("Close"),ye=Object(n["createTextVNode"])("Reset"),De=Object(n["createTextVNode"])("Save");Object(n["popScopeId"])();const xe=Ne((function(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-title"),c=Object(n["resolveComponent"])("ion-toolbar"),s=Object(n["resolveComponent"])("ion-header"),d=Object(n["resolveComponent"])("DateInput"),u=Object(n["resolveComponent"])("ion-col"),m=Object(n["resolveComponent"])("NumberInput"),b=Object(n["resolveComponent"])("SelectInput"),p=Object(n["resolveComponent"])("yes-no-input"),g=Object(n["resolveComponent"])("ion-label"),O=Object(n["resolveComponent"])("ion-checkbox"),v=Object(n["resolveComponent"])("ion-item"),f=Object(n["resolveComponent"])("multi-column-view"),h=Object(n["resolveComponent"])("ion-row"),j=Object(n["resolveComponent"])("ion-grid"),V=Object(n["resolveComponent"])("ion-content"),C=Object(n["resolveComponent"])("ion-button"),_=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(s,null,{default:Ne(()=>[Object(n["createVNode"])(c,null,{default:Ne(()=>[Object(n["createVNode"])(l,null,{default:Ne(()=>[we]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(V,{class:" ion-padding"},{default:Ne(()=>[Object(n["createVNode"])(j,{style:{width:"100%"}},{default:Ne(()=>[Object(n["createVNode"])(h,null,{default:Ne(()=>[Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Ne(()=>[Object(n["createVNode"])(d,{modelValue:e.form.visitDate,"onUpdate:modelValue":t[1]||(t[1]=t=>e.form.visitDate=t),form:e.form},null,8,["modelValue","form"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Ne(()=>[Object(n["createVNode"])(m,{modelValue:e.form.weight,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.weight=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1}),e.showHeightField?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:0,size:"6",class:"ion-margin-vertical"},{default:Ne(()=>[Object(n["createVNode"])(m,{modelValue:e.form.height,"onUpdate:modelValue":t[3]||(t[3]=t=>e.form.height=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(u,{class:"ion-margin-vertical",size:e.showHeightField?6:12},{default:Ne(()=>[Object(n["createVNode"])(b,{modelValue:e.form.tbStatus,"onUpdate:modelValue":t[4]||(t[4]=t=>e.form.tbStatus=t),options:e.tbStatuses},null,8,["modelValue","options"])]),_:1},8,["size"]),e.isFemale?(Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],{key:1},[Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical ion-padding-vertical"},{default:Ne(()=>[Object(n["createVNode"])(p,{modelValue:e.form.isPregnant,"onUpdate:modelValue":t[5]||(t[5]=t=>e.form.isPregnant=t),inline:""},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical ion-padding-vertical"},{default:Ne(()=>[Object(n["createVNode"])(p,{modelValue:e.form.isBreastfeeding,"onUpdate:modelValue":t[6]||(t[6]=t=>e.form.isBreastfeeding=t),inline:""},null,8,["modelValue"])]),_:1})],64)):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Ne(()=>[Object(n["createVNode"])(p,{modelValue:e.form.hasContraindications,"onUpdate:modelValue":t[7]||(t[7]=t=>e.form.hasContraindications=t),inline:""},null,8,["modelValue"]),e.hasContraindications?(Object(n["openBlock"])(),Object(n["createBlock"])(f,{key:0,items:e.contraIndications,numberOfColumns:2},{default:Ne(({entries:e})=>[(Object(n["openBlock"])(!0),Object(n["createBlock"])(n["Fragment"],null,Object(n["renderList"])(e,e=>(Object(n["openBlock"])(),Object(n["createBlock"])(v,{lines:"none",key:e.value},{default:Ne(()=>[Object(n["createVNode"])(g,null,{default:Ne(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.label),1)]),_:2},1024),Object(n["createVNode"])(O,{slot:"start",modelValue:e.isChecked,"onUpdate:modelValue":t=>e.isChecked=t},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1},8,["items"])):Object(n["createCommentVNode"])("",!0)]),_:1}),Object(n["createVNode"])(u,{class:"ion-padding-start",size:"6"},{default:Ne(()=>[Object(n["createVNode"])(p,{modelValue:e.form.hasSideEffects,"onUpdate:modelValue":t[8]||(t[8]=t=>e.form.hasSideEffects=t),inline:""},null,8,["modelValue"]),e.hasSideEffects?(Object(n["openBlock"])(),Object(n["createBlock"])(f,{key:0,items:e.sideEffects,numberOfColumns:2},{default:Ne(({entries:e})=>[(Object(n["openBlock"])(!0),Object(n["createBlock"])(n["Fragment"],null,Object(n["renderList"])(e,e=>(Object(n["openBlock"])(),Object(n["createBlock"])(v,{lines:"none",key:e.value},{default:Ne(()=>[Object(n["createVNode"])(g,null,{default:Ne(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.label),1)]),_:2},1024),Object(n["createVNode"])(O,{slot:"start",modelValue:e.isChecked,"onUpdate:modelValue":t=>e.isChecked=t},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1},8,["items"])):Object(n["createCommentVNode"])("",!0)]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Ne(()=>[Object(n["createVNode"])(b,{modelValue:e.form.regimen,"onUpdate:modelValue":t[9]||(t[9]=t=>e.form.regimen=t),options:e.regimens},null,8,["modelValue","options"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Ne(()=>[Object(n["createVNode"])(m,{modelValue:e.form.totalArvsGiven,"onUpdate:modelValue":t[10]||(t[10]=t=>e.form.totalArvsGiven=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Ne(()=>[Object(n["createVNode"])(m,{modelValue:e.form.totalCPTGiven,"onUpdate:modelValue":t[11]||(t[11]=t=>e.form.totalCPTGiven=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Ne(()=>[Object(n["createVNode"])(b,{modelValue:e.form.tbMed,"onUpdate:modelValue":t[12]||(t[12]=t=>e.form.tbMed=t),options:e.tbMeds},null,8,["modelValue","options"])]),_:1}),e.hasGiven6H||e.hasGivenRFP?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:2,size:"6"},{default:Ne(()=>[Object(n["createVNode"])(m,{modelValue:e.form.totalIPTGiven,"onUpdate:modelValue":t[13]||(t[13]=t=>e.form.totalIPTGiven=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0),e.hasGivenRFP?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:3,size:"6"},{default:Ne(()=>[Object(n["createVNode"])(m,{modelValue:e.form.totalRFPGiven,"onUpdate:modelValue":t[14]||(t[14]=t=>e.form.totalRFPGiven=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0),e.hasGiven3HP?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:4,size:"6"},{default:Ne(()=>[Object(n["createVNode"])(m,{modelValue:e.form.total3HPGiven,"onUpdate:modelValue":t[15]||(t[15]=t=>e.form.total3HPGiven=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0),e.hasGiven3HP||e.hasGivenRFP||e.hasGiven6H?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:5,size:"6"},{default:Ne(()=>[Object(n["createVNode"])(m,{modelValue:e.form.totalPyridoxineGiven,"onUpdate:modelValue":t[16]||(t[16]=t=>e.form.totalPyridoxineGiven=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Ne(()=>[Object(n["createVNode"])(p,{modelValue:e.form.patientPresent,"onUpdate:modelValue":t[17]||(t[17]=t=>e.form.patientPresent=t),inline:"",disabled:e.form.patientPresent.disabled},null,8,["modelValue","disabled"])]),_:1}),Object(n["createVNode"])(u,{size:"6",class:"ion-margin-vertical"},{default:Ne(()=>[Object(n["createVNode"])(p,{modelValue:e.form.guardianPresent,"onUpdate:modelValue":t[18]||(t[18]=t=>e.form.guardianPresent=t),inline:""},null,8,["modelValue"])]),_:1}),e.prevDrugs.length>0?(Object(n["openBlock"])(),Object(n["createBlock"])(u,{key:6,size:"6",class:"ion-margin-vertical"},{default:Ne(()=>[Object(n["createVNode"])(m,{modelValue:e.form.pillCount,"onUpdate:modelValue":t[19]||(t[19]=t=>e.form.pillCount=t),form:e.form,min:1},null,8,["modelValue","form"])]),_:1})):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(u,{size:e.prevDrugs.length>0?6:12,class:"ion-margin-vertical"},{default:Ne(()=>[Object(n["createVNode"])(d,{modelValue:e.form.nextAppointmentDate,"onUpdate:modelValue":t[20]||(t[20]=t=>e.form.nextAppointmentDate=t),form:e.form},null,8,["modelValue","form"])]),_:1},8,["size"])]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(_,null,{default:Ne(()=>[Object(n["createVNode"])(c,null,{default:Ne(()=>[Object(n["createVNode"])(C,{color:"primary",onClick:t[21]||(t[21]=t=>e.modal.hide()),slot:"end"},{default:Ne(()=>[Ie]),_:1}),Object(n["createVNode"])(C,{color:"warning",onClick:e.onClear,slot:"end"},{default:Ne(()=>[ye]),_:1},8,["onClick"]),Object(n["createVNode"])(C,{color:"success",onClick:e.onSubmit,slot:"end"},{default:Ne(()=>[De]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}));var ke=a("13ea"),Pe=a.n(ke),Te=a("6b6c"),Ae=a("92c1"),Se=a("1c74"),Re=a("71c3");class Be extends v["a"]{constructor(e){super(e)}async isPregnant(){const e=await O["a"].getFirstObs(this.getID(),"Is patient pregnant");return e&&!!e.value_coded.match(/Yes/i)&&O["a"].obsInValidPeriod(e)}async hasPregnancyObsToday(){const e=await O["a"].getFirstObsDatetime(this.getID(),"Is patient pregnant");return e&&i["c"].toStandardHisFormat(e)===Se["e"].getSessionDate()&&this.isFemale()}async hasPregnancyAtARTInitiation(){const e=await O["a"].getLastValueCoded(this.getID(),"Is patient pregnant");return e&&await O["a"].getConceptName(e)}async breastFeedingAtARTInitiation(){const e=await O["a"].getLastValueCoded(this.getID(),"Is patient breast feeding");return e&&await O["a"].getConceptName(e)}async getInitialWeight(){return O["a"].getLastValueNumber(this.getID(),"weight")}async getRecentWeight(){return O["a"].getFirstValueNumber(this.getID(),"weight")||-1}async getInitialHeight(){return O["a"].getLastValueNumber(this.getID(),"Height")}async getInitialTBStatus(){const e=await O["a"].getLastValueCoded(this.getID(),"TB Status at Initiation");if(e)return O["a"].getConceptName(e)}async getRecentHeight(){return O["a"].getFirstValueNumber(this.getID(),"Height")||-1}async getWeightHistory(){try{const e=await O["a"].getAll(this.getID(),"weight");return e.map(e=>({weight:e.value_numeric,date:e.obs_datetime}))}catch(e){return console.warn(e),[]}}async getCompleteTBTherapyHistory(){const e=await O["a"].getAll(this.getID(),"TB treatment history");return e.filter(e=>e.value_text.match(/Complete/i))}async getInitialBMI(){return O["a"].getLastValueNumber(this.getID(),"BMI")}async everReceivedART(){return O["a"].getFirstValueCoded(this.getID(),"Ever received ART")}async agreesToFollowUp(){return O["a"].getFirstValueCoded(this.getID(),"Agrees to followup")}async getReasonForStartingART(){return O["a"].getFirstValueCoded(this.getID(),"Reason for ART eligibility")}async getHIVTestDate(){const e=await O["a"].getFirstObs(this.getID(),"Confirmatory HIV test date");return e&&e.value_datetime?e.value_datetime:e&&e.value_text?e.value_text:null}async getARTStartDate(){const e=await O["a"].getFirstObs(this.getID(),"Date ART started");if(e&&e.value_datetime)return e.value_datetime;if(e&&e.value_text)return e.value_text;const t=await Re["a"].getAllDrugOrders(this.getID(),Number.MAX_SAFE_INTEGER);return Object(X["isEmpty"])(t)?null:t[0].order["start_date"]}async getHIVTestLocation(){return O["a"].getFirstValueText(this.getID(),"Confirmatory HIV test location")}async getStagingCondition(){return O["a"].getFirstValueCoded(this.getID(),"Who stages criteria present")}}var Ee=a("6d32"),Fe=a("b515"),He=a("3b8c"),Ge=a("66c5"),qe=a("0690"),Me=a("83af"),Le=a("dac2"),Ue=a("aee2"),ze=a("5f2c");function $e(e,t){return[...new Map(e.filter(Boolean).map(e=>{const a=Array.isArray(t)?t.map(t=>e[t]).join("_"):e[t];return[a,e]})).values()]}var Je=Object(n["defineComponent"])({components:{IonContent:j["IonContent"],IonFooter:j["IonFooter"],IonHeader:j["IonHeader"],IonTitle:j["IonTitle"],IonToolbar:j["IonToolbar"],IonButton:j["IonButton"],IonItem:j["IonItem"],IonLabel:j["IonLabel"],IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],IonCheckbox:j["IonCheckbox"],SelectInput:T["a"],NumberInput:A["a"],DateInput:P["a"],YesNoInput:Te["a"],MultiColumnView:Ae["a"]},props:{patient:{type:Object,required:!0}},setup(e){const t=Object(n["computed"])(()=>e.patient.getID()),a=new Fe["a"](t.value,-1),o=new He["a"](t.value,-1),r=new Le["a"](t.value,-1),l=new ze["a"](t.value,-1),c=new Ge["a"](t.value,-1),s=new qe["a"](t.value,-1),d=new Me["a"](t.value,-1),u=Object(n["ref"])(),m=Object(n["ref"])([]),b=Object(n["ref"])([]),p=Object(n["ref"])([]),g=Object(n["ref"])([]),O=Object(n["computed"])(()=>!(u.value&&e.patient.getAge()>18)),v=Object(n["computed"])(()=>e.patient.isFemale()),f=Object(n["ref"])(""),h=Object(n["reactive"])({visitDate:{value:C()().format("YYYY-MM-DD"),label:"Visit Date",required:!0,validation:async t=>C()(t.value).isAfter(C()())?["Visit date cannot be after today's date"]:C()(t.value).isBefore(C()(e.patient.getBirthdate()))?["Visit date cannot be before patient's birth date"]:null},weight:{value:void 0,label:"Weight",required:!0,computedValue:e=>({tag:"vitals",obs:a.buildValueNumber("Weight",e)}),validation:e=>a.validator({...e,label:"Weight"})},height:{value:void 0,label:"Height",computedValue:e=>({tag:"vitals",obs:a.buildValueNumber("Height",e)}),validation:e=>O.value&&a.validator({...e,label:"Height"})},isPregnant:{value:void 0,label:"Is the patient pregnant?",computedValue:e=>({tag:"consultation",obs:o.buildValueCoded("Is patient pregnant",e)}),validation:async e=>v.value&&Oe["a"].required(e)},isBreastfeeding:{value:void 0,label:"Is the patient breastfeeding?",computedValue:e=>({tag:"consultation",obs:o.buildValueCoded("Is patient breast feeding",e)}),validation:async e=>v.value&&Oe["a"].required(e)},nextAppointmentDate:{value:void 0,label:"Next Appointment Date",required:!0,computedValue:e=>({tag:"appointment",obs:d.buildValueDate("Appointment date",e)}),validation:async(e,t)=>C()(e.value).isBefore(C()(t.visitDate.value))?["Appointment date cannot be before visit date"]:C()(e.value).isAfter(C()(f.value))?["Appointment date cannot be after drug run out date"]:null},patientPresent:{value:void 0,label:"Is the patient present?",required:!0,computedValue:e=>({tag:"reception",obs:c.buildValueCoded("Patient present",e)})},guardianPresent:{value:void 0,label:"Is the guardian present?",required:!0,computedValue:e=>({tag:"reception",obs:c.buildValueCoded("Guardian present",e)})},pillCount:{value:void 0,label:"Pill Count",required:g.value.length>0,validation:async e=>g.value.length>0&&Oe["a"].isNumber(e)},regimen:{value:void 0,label:"Regimen",placeholder:"Select a regimen",computedValue:()=>({tag:"consultation",obs:r.buildValueCoded("Medication orders","Antiretroviral drugs")})},totalCPTGiven:{value:void 0,label:"Total CPT Given",computedValue:()=>({tag:"consultation",obs:r.buildValueCoded("Medication orders","CPT")})},totalIPTGiven:{value:void 0,label:"Total IPT Given",computedValue:()=>({tag:"consultation",obs:r.buildValueCoded("Medication orders","INH")}),validation:async(e,t)=>{var a,n;return("6H"===(null===(a=t.tbMed.value)||void 0===a?void 0:a.label)||"3HP (RFP + INH)"===(null===(n=t.tbMed.value)||void 0===n?void 0:n.label))&&Oe["a"].isNumber(e)}},totalRFPGiven:{value:void 0,label:"Total RFP Given",computedValue:()=>({tag:"consultation",obs:r.buildValueCoded("Medication orders","3HP (RFP + INH)")}),validation:async(e,t)=>{var a;return"3HP (RFP + INH)"===(null===(a=t.tbMed.value)||void 0===a?void 0:a.label)&&Oe["a"].isNumber(e)}},total3HPGiven:{value:void 0,label:"Total 3HP Given",computedValue:()=>({tag:"consultation",obs:r.buildValueCoded("Medication orders","INH 300 / RFP 300 (3HP)")}),validation:async(e,t)=>{var a;return"3HP (INH 300 / RFP 300)"===(null===(a=t.tbMed.value)||void 0===a?void 0:a.label)&&Oe["a"].isNumber(e)}},totalArvsGiven:{value:void 0,label:"Total ARVs Given",validation:async(e,t)=>!Pe()(t.regimen.value)&&Oe["a"].isNumber(e)},totalPyridoxineGiven:{value:void 0,label:"Total Pyridoxine Given",validation:async(e,t)=>{var a;return(null===(a=t.tbMed.value)||void 0===a?void 0:a.label)&&Oe["a"].isNumber(e)}},tbMed:{value:void 0,label:"TB Medication",placeholder:"Select a TB medication"},hasContraindications:{value:void 0,label:"Has Side Effects / Contraindications ?",validation:async(e,t)=>Oe["a"].validateSeries([()=>Oe["a"].required(e),()=>"No"===e.value||p.value.some(e=>e.isChecked)?null:["Please select at least one side effect"]])},hasSideEffects:{value:void 0,label:"Has Other Side Effects ?",validation:async(e,t)=>Oe["a"].validateSeries([()=>Oe["a"].required(e),()=>"No"===e.value||p.value.some(e=>e.isChecked)?null:["Please select at least one side effect"]])},tbStatus:{value:void 0,label:"TB Status",computedValue:e=>({tag:"consultation",obs:o.buildValueCoded("TB Status",e.value)}),validation:async e=>Oe["a"].required(e)}});Object(n["watch"])(h.patientPresent,e=>{"No"===e.value&&(h.guardianPresent.value="Yes")}),Object(n["watch"])(h.guardianPresent,e=>{"No"===e.value&&(h.patientPresent.value="Yes")}),Object(n["watch"])([h.weight,h.tbStatus],async()=>{if(h.weight.value){const e=!Pe()(h.tbStatus.value)&&!h.tbStatus.value.label.match(/TB Not Suspected/i),t=await Ee["a"].getRegimensByWeight(h.weight.value,e);Pe()(t)||(m.value=Object.keys(t).map(e=>({label:e,value:e,other:t[e]}))),h.patientPresent.value="Yes",h.patientPresent.disabled=!0}}),Object(n["watch"])([()=>h.totalArvsGiven.value,()=>h.pillCount.value],()=>{const e=parseInt(h.totalArvsGiven.value)||0,t=parseInt(h.pillCount.value)||0;f.value=C()(h.visitDate.value).add(e+t,"days"),h.nextAppointmentDate.label=`Next Appointment Date (Drug run out date: ${f.value.format(i["a"])})`});const j=Object(n["computed"])(()=>{var e;return"3HP (INH 300 / RFP 300)"===(null===(e=h.tbMed.value)||void 0===e?void 0:e.label)}),V=Object(n["computed"])(()=>{var e;return"3HP (RFP + INH)"===(null===(e=h.tbMed.value)||void 0===e?void 0:e.label)}),_=Object(n["computed"])(()=>{var e;return"6H"===(null===(e=h.tbMed.value)||void 0===e?void 0:e.label)}),N=Object(n["computed"])(()=>"Yes"===h.hasContraindications.value),w=Object(n["computed"])(()=>"Yes"===h.hasSideEffects.value),I=Object(S["d"])(["Confirmed TB Not on treatment","Confirmed TB on treatment","TB Not Suspected","TB Suspected"]),y=Object(S["d"])(["6H","3HP (RFP + INH)","3HP (INH 300 / RFP 300)"]),D=e=>{h.patientPresent.value=e,"No"===e&&(h.guardianPresent.value="Yes")},x=e=>{h.guardianPresent.value=e,"No"===e&&(h.patientPresent.value="Yes")},P=async e=>{const t=e.height||u.value,n=Ue["a"].calculateBMI(e.weight,t);return a.buildValueNumber("BMI",n)},T=async()=>{const e=[await o.buildValueCoded("Patient using family planning","No")],t=o.getFamilyPlanningMethods();return t.forEach(async t=>{e.push(await o.buildValueCoded(t,"No"))}),e},A=async()=>Promise.all(H["a"].getConceptsByCategory("tb_symptom",!0).map(async e=>o.buildGroupValueCoded(e.name,e.name,"No"))),R=(e,t,a,n)=>({drug_inventory_id:e.drug_id,equivalent_daily_dose:r.calculateEquivalentDosage(e.am,e.pm),dose:r.calculateDosage(e.am,e.pm),start_date:n,auto_expire_date:C()(n).add(a,"days").format("YYYY-MM-DD"),units:e.units,qty:t,frequency:e.frequency,instructions:r.getInstructions(e.drug_name,e.am,e.pm,e.units)}),B=async()=>{await Be.setSessionDate(h.visitDate.value),a.setDate(h.visitDate.value),o.setDate(h.visitDate.value),r.setDate(h.visitDate.value),c.setDate(h.visitDate.value),s.setDate(h.visitDate.value),d.setDate(h.visitDate.value),l.setDate(h.visitDate.value),await Object(E["e"])(h,async(e,t)=>{var n;await a.createEncounter();const i=await Object(E["d"])(t,"vitals"),u=await P(e);await a.saveObservationList([...i,u]),await o.createEncounter();const m=await Object(E["d"])(t,"consultation");v.value&&m.concat(await T()),N.value&&m.concat(await Object(E["b"])("Malawi ART side effects",b.value)),w.value&&m.concat(await Object(E["b"])("Other side effect",p.value)),m.concat(await A()),await o.saveObservationList(m),await r.createEncounter();const O=[];let f=0;if(!Pe()(e.regimen)&&e.totalArvsGiven){const t=e.regimen.other;f=Math.min(...t.map(t=>e.totalArvsGiven/(t.am+t.pm)+2)),t.forEach(t=>O.push(R(t,e.totalArvsGiven,f,e.visitDate)))}if(e.totalCPTGiven&&$e(await Ee["a"].getRegimenExtras("Cotrimoxazole",e.weight),"concept_name").filter(e=>"Daily (QOD)"===e.frequency).forEach(t=>O.push(R(t,e.totalCPTGiven,f,e.visitDate))),null!==(n=e.tbMed)&&void 0!==n&&n.value){const t=$e(await Ee["a"].getRegimenExtras("INH",e.weight),["concept_name","frequency"]),a=t.find(e=>"Pyridoxine"===e["concept_name"]);if(a&&e.totalPyridoxineGiven&&O.push(R(a,e.totalPyridoxineGiven,f,e.visitDate)),e.totalIPTGiven){const a=t.find(e=>"Isoniazid"===e["concept_name"]&&(_.value&&"Daily (QOD)"===e.frequency||V.value&&"Weekly (QW)"===e.frequency));O.push(R(a,e.totalIPTGiven,f,e.visitDate))}if(e.totalRFPGiven&&V.value){const t=await Ee["a"].getRegimenExtras("Rifapentine",e.weight);t.length&&O.push(R(t[0],e.totalRFPGiven,f,e.visitDate))}if(e.total3HPGiven&&j.value){const t=await Ee["a"].getRegimenExtras("INH / RFP",e.weight);O.push(R(t[0],e.total3HPGiven,f,e.visitDate))}}const h=await r.createDrugOrder(O),C=h.map(e=>{const t=O.find(t=>t.drug_inventory_id===e.drug_inventory_id);return l.buildDispensations(e.order_id,t.qty,1)});await l.saveDispensations(C.flat(1)),await c.createEncounter();const I=await Object(E["d"])(t,"reception");if(await c.saveObservationList(I),g.value.length>0){await s.createEncounter();const t=await Promise.all(g.value.map(async t=>{const a=s.calculateExpected(t.quantity,t.equivalent_daily_dose,t.order.start_date,t.frequency),n=s.calculateAdherence(t.quantity,e.pillCount,a);return[await s.buildAdherenceObs(t.order_id,t.drug_inventory_id,n),await s.buildPillCountObs(t.order_id,e.pillCount)]}));await s.saveObservationList(t.flat(1))}await d.createEncounter();const y=await Object(E["d"])(t,"appointment");await d.saveObservationList(y),await Object(K["d"])("Patient visit saved successfully"),await Be.resetSessionDate(),await q["a"].hide(),G["b"].emit(k.RELOAD_PATIENT_VISIT_DATA)})},F=async()=>{const e=await Object(K["a"])("Are you sure you want to clear all fields?");if(e)for(const t in h)h[t].value="",h[t].error="",h[t].disabled=!1};return Object(n["onMounted"])(async()=>{u.value=await e.patient.getRecentHeight();const t=await e.patient.getRecentWeight();if(t){const e=await Ee["a"].getRegimensByWeight(t);Pe()(e)||(m.value=Object.keys(e).map(t=>({label:t,value:t,other:e[t]})))}g.value=await Re["a"].getLastDrugsReceived(e.patient.getID()),h.pillCount.required=g.value.length>0,b.value=H["a"].getConceptsByCategory("contraindication",!0).map(e=>({value:e.concept_id,label:e.name,other:e})),p.value=H["a"].getConceptsByCategory("side_effect",!0).map(e=>({value:e.concept_id,label:e.name,other:e}))}),{form:h,regimens:m,contraIndications:b,sideEffects:p,tbStatuses:I,tbMeds:y,hasGiven3HP:j,hasGivenRFP:V,hasGiven6H:_,showHeightField:O,isFemale:v,modal:q["a"],hasContraindications:N,hasSideEffects:w,prevDrugs:g,onSubmit:B,setPatientPresent:D,setGuardianPresent:x,onClear:F}}});a("cda3");const Ye=U()(Je,[["render",xe],["__scopeId","data-v-56a57ffb"]]);var We=Ye,Qe=Object(n["defineComponent"])({props:{patient:{type:Object,required:!0},startDate:{type:String,required:!0}},components:{ReportTable:p["a"],IonCard:j["IonCard"],IonCardHeader:j["IonCardHeader"],IonCardTitle:j["IonCardTitle"],IonCardContent:j["IonCardContent"],IonButton:j["IonButton"]},setup(e){const t=Object(n["ref"])([]),a=Object(n["computed"])(()=>e.patient.getID()),o=Object(n["reactive"])({showIndex:!1,tableCssTheme:"emc-datatable-theme"}),r=Object(n["ref"])([{label:"Add Visit",action:async()=>q["a"].show(We,{patient:e.patient})},{label:"Update Outcome",action:async()=>q["a"].show(_e,{patient:e.patient})},{label:"Enter VL Results",action:async()=>q["a"].show($,{patient:e.patient})}]),l=Object(n["ref"])([[b["a"].thTxt("Visit Date"),b["a"].thTxt("Given To"),b["a"].thTxt("Weight (Kg)"),b["a"].thTxt("Height (cm)"),b["a"].thTxt("BMI"),b["a"].thTxt("Preg"),b["a"].thTxt("B/F"),b["a"].thTxt("TB STATUS"),b["a"].thTxt("Side Effects"),b["a"].thTxt("ART Regimen"),b["a"].thTxt("Next Appointment"),b["a"].thTxt("Outcome"),b["a"].thTxt("Viral Load"),b["a"].thTxt("Void Visit")]]),c=t=>{const a="N/A"!==e.startDate?"("+C()(t).diff(e.startDate,"months")+"M)":"";return`${i["c"].toStandardHisDisplayFormat(t)} ${a}`},s=async(e=[],t)=>{(await j["modalController"].create({component:m["a"],cssClass:"custom-modal",componentProps:{title:"Drugs dispensed on "+i["c"].toStandardHisDisplayFormat(t),columns:["DRUG NAME","QUANTITY","UNITS"],onRows:()=>e.map(e=>[e[0],e[1],"tab(s)"])}})).present()},d=async(e,t,n)=>{Object(h["a"])(async o=>{const i=await g["a"].getEncounters(a.value,{date:e});i.forEach(async e=>{await g["a"].voidEncounter(e.encounter_id,o)}),n.splice(t,1)},"small-modal")},u=()=>{v["a"].getPatientVisits(a.value,!0).then(async e=>{t.value=[];for(const n of e){const e=await f["a"].getCurrentProgramInformation(a.value,n);let o="",r="",l="",u="";if("Defaulted"!==e.outcome){const t=await O["a"].getFirstValueDatetime(a.value,"appointment date",n);if(t&&(o=i["c"].toStandardHisDisplayFormat(t)),r=await O["a"].getFirstValueCoded(a.value,"Is patient pregnant",n),l=await O["a"].getFirstValueCoded(a.value,"Is patient breast feeding",n),"N/A"===e["viral_load"]){const e=await O["a"].getFirstObs(a.value,"HIV viral load",n);e&&e.value_text&&e.value_numeric&&(u=1===e.value_numeric?"LDL":e.value_text+e.value_numeric.toString())}else u=e["viral_load"]}e&&t.value.push([b["a"].td(c(n)),b["a"].td(e["visit_by"].match(/Unk/i)?"":e["visit_by"]),b["a"].td("Defaulted"===e.outcome?"":e.weight),b["a"].td("Defaulted"===e.outcome?"":e.height),b["a"].td("Defaulted"===e.outcome?"":e.bmi),b["a"].td(r||""),b["a"].td(l||""),b["a"].td(e["tb_status"].match(/Unknown/i)||"Defaulted"===e.outcome?"":e["tb_status"]),b["a"].td(e["side_effects"].length?"Yes":"Defaulted"!==e.outcome?"No":""),b["a"].tdLink("Defaulted"===e.outcome?"":e.regimen,()=>s(e.pills_dispensed,n)),b["a"].td(o||""),b["a"].td(e.outcome.match(/Unk/i)?"":e.outcome),b["a"].td(u),b["a"].tdBtn("X",(e,t)=>d(n,e,t),{},"danger")])}})};return G["b"].on(k.RELOAD_PATIENT_VISIT_DATA,()=>u()),Object(n["onMounted"])(()=>{u()}),{actionButtons:r,tableConfig:o,columns:l,rows:t}}});a("141d");const Ke=U()(Qe,[["render",u],["__scopeId","data-v-3645347c"]]);var Ze=Ke;const Xe=Object(n["withScopeId"])("data-v-00edd486");Object(n["pushScopeId"])("data-v-00edd486");const et={style:{width:"100%",display:"flex",justifyContent:"space-between"}},tt={key:0},at={key:1},nt={key:3};Object(n["popScopeId"])();const ot=Xe((function(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-item"),c=Object(n["resolveComponent"])("ion-list"),s=Object(n["resolveComponent"])("multi-column-view");return Object(n["openBlock"])(),Object(n["createBlock"])(s,{items:e.patientInfo,numberOfColumns:3},{default:Xe(({entries:e})=>[Object(n["createVNode"])(c,{class:"his-card ion-margin-end"},{default:Xe(()=>[(Object(n["openBlock"])(!0),Object(n["createBlock"])(n["Fragment"],null,Object(n["renderList"])(e,(t,a)=>(Object(n["openBlock"])(),Object(n["createBlock"])(l,{key:a,lines:a===e.length-1?"none":""},{default:Xe(()=>[Object(n["createVNode"])("div",et,[t.label?(Object(n["openBlock"])(),Object(n["createBlock"])("span",tt,Object(n["toDisplayString"])(t.label)+": ",1)):(Object(n["openBlock"])(),Object(n["createBlock"])("span",at)),t.other&&"function"===typeof t.other.onClickHandler?(Object(n["openBlock"])(),Object(n["createBlock"])("span",{key:2,onClick:t.other.onClickHandler},[Object(n["createVNode"])("a",null,[Object(n["createVNode"])("b",null,Object(n["toDisplayString"])(t.value||"N/A"),1)])],8,["onClick"])):(Object(n["openBlock"])(),Object(n["createBlock"])("span",nt,[Object(n["createVNode"])("b",null,Object(n["toDisplayString"])(t.value||"N/A"),1)]))])]),_:2},1032,["lines"]))),128))]),_:2},1024)]),_:1},8,["items"])}));a("13d5");var it=a("afbc"),rt=a("8e8b"),lt=Object(n["defineComponent"])({components:{MultiColumnView:Ae["a"]},props:{patient:{type:Object,required:!0},artStartDate:{type:String,required:!0},guardians:{type:String,default:""}},emits:["updatePatient","updateARVNumber","addGuardian"],setup(e,{emit:t}){const a=Object(n["ref"])(0),o=Object(n["ref"])(0),r=Object(n["ref"])(0),l=Object(n["ref"])(""),c=Object(n["ref"])(""),s=Object(n["ref"])(""),d=Object(n["ref"])(""),u=Object(n["ref"])(""),m=Object(n["ref"])(""),b=Object(n["ref"])(""),p=Object(n["ref"])(""),g=Object(n["ref"])(""),O=Object(n["ref"])(""),v=()=>{const t=e.patient.getBirthdate(),a="N/A"!==e.artStartDate?C()(e.artStartDate).diff(t,"years"):"";return`${i["c"].toStandardHisDisplayFormat(t)} (${a})`},f=async()=>{const t=await rt["a"].get("PATIENT_LAB_ORDERS",{patientID:e.patient.getID()}),a=t.reduce((e,t)=>{const a=t.tests.filter(e=>e.name.match(/hiv/i)&&!Object(X["isEmpty"])(e.result)).map(e=>e.result);return e.concat(a.reduce((e,t)=>e.concat(t),[]))},[]).sort((e,t)=>new Date(e.date)>new Date(t.date)?-1:1);return Object(X["isEmpty"])(a)?"":`${a[0].value_modifier}${a[0].value} (${i["c"].toStandardHisDisplayFormat(a[0].date)})`},h=Object(n["computed"])(()=>[{label:"ARV Number",value:e.patient.getArvNumber(),other:{onClickHandler:()=>{t("updateARVNumber")}}},{label:"National Patient ID",value:e.patient.getNationalID()},{label:"Given Name",value:e.patient.getGivenName(),other:{onClickHandler:()=>{t("updatePatient","given_name")}}},{label:"Family Name",value:e.patient.getFamilyName(),other:{onClickHandler:()=>{t("updatePatient","given_name")}}},{label:"DOB and Age at Initiation",value:v(),other:{onClickHandler:()=>{t("updatePatient","birthdate")}}},{label:"Sex",value:e.patient.getGender(),other:{onClickHandler:()=>{t("updatePatient","gender")}}},{label:"Location",value:e.patient.getCurrentVillage(),other:{onClickHandler:()=>{t("updatePatient","home_village")}}},{label:"Landmark",value:e.patient.getClosestLandmark(),other:{onClickHandler:()=>{t("updatePatient","landmarks")}}},{label:"Phone Number",value:e.patient.getPhoneNumber(),other:{onClickHandler:()=>{t("updatePatient","phone_number")}}},{label:"Guardian",value:e.guardians?e.guardians:"add",other:{...Object(X["isEmpty"])(e.guardians)?{onClickHandler:()=>{t("addGuardian")}}:{}}},{label:"Date of starting first line ARV Regimen",value:e.artStartDate},{label:"Initial Weight (KG)",value:a.value},{label:"Initial Height (CM)",value:o.value},{label:"Initial BMI",value:r.value},{label:"Initial TB Status",value:l.value},{label:"Pregnant at Initiation",value:s.value},{label:"Breastfeeding at Initiation",value:c.value},{label:"Latest VL Result and Result Date",value:O.value},{label:"TI",value:d.value},{label:"Agrees to follow up",value:u.value},{label:"Reason for starting ART",value:m.value},{label:"HIV test date",value:b.value},{label:"HIV test place",value:p.value},{label:"Staging codition",value:g.value,other:{onClickHandler:()=>it["a"].push(`/emc/registration/${e.patient.getID()}/false`)}}]),j=async()=>{const t=await e.patient.getHIVTestDate();t&&(b.value=i["c"].toStandardHisDisplayFormat(t))};return Object(n["onMounted"])(async()=>{a.value=await e.patient.getInitialWeight(),o.value=await e.patient.getInitialHeight(),r.value=await e.patient.getInitialBMI(),l.value=await e.patient.getInitialTBStatus(),s.value=await e.patient.hasPregnancyAtARTInitiation(),c.value=await e.patient.breastFeedingAtARTInitiation(),d.value=await e.patient.everReceivedART(),u.value=await e.patient.agreesToFollowUp(),m.value=await e.patient.getReasonForStartingART(),p.value=await e.patient.getHIVTestLocation(),g.value=await e.patient.getStagingCondition(),O.value=await f(),await j()}),{patientInfo:h}}});a("102f");const ct=U()(lt,[["render",ot],["__scopeId","data-v-00edd486"]]);var st=ct;const dt=Object(n["createTextVNode"])("Edit Patient Demographics"),ut=Object(n["createTextVNode"])("Close"),mt=Object(n["createTextVNode"])("Save");function bt(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-title"),c=Object(n["resolveComponent"])("ion-icon"),s=Object(n["resolveComponent"])("ion-button"),d=Object(n["resolveComponent"])("ion-buttons"),u=Object(n["resolveComponent"])("ion-toolbar"),m=Object(n["resolveComponent"])("ion-header"),b=Object(n["resolveComponent"])("TextInput"),p=Object(n["resolveComponent"])("ion-col"),g=Object(n["resolveComponent"])("DateInput"),O=Object(n["resolveComponent"])("SelectInput"),v=Object(n["resolveComponent"])("ion-row"),f=Object(n["resolveComponent"])("ion-grid"),h=Object(n["resolveComponent"])("ion-content"),j=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(m,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,null,{default:Object(n["withCtx"])(()=>[dt]),_:1}),Object(n["createVNode"])(d,{slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{onClick:t[1]||(t[1]=t=>e.modal.hide())},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{slot:"icon-only",name:"close"})]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(h,{class:"ion-padding"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(f,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(v,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.patient.givenName,"onUpdate:modelValue":t[2]||(t[2]=t=>e.patient.givenName=t)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.patient.middleName,"onUpdate:modelValue":t[3]||(t[3]=t=>e.patient.middleName=t)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"4",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.patient.familyName,"onUpdate:modelValue":t[4]||(t[4]=t=>e.patient.familyName=t)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(g,{modelValue:e.patient.birthdate,"onUpdate:modelValue":t[5]||(t[5]=t=>e.patient.birthdate=t),allowEstimation:!0,estimationLabel:"Estimate Age",minDate:"1900-01-01",onIsEstimated:t[6]||(t[6]=t=>e.isBirthdateEstimated=t)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,{modelValue:e.patient.gender,"onUpdate:modelValue":t[7]||(t[7]=t=>e.patient.gender=t),options:e.genderOptions},null,8,["modelValue","options"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.patient.cellPhoneNumber,"onUpdate:modelValue":t[8]||(t[8]=t=>e.patient.cellPhoneNumber=t),allowUnknown:""},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,{modelValue:e.patient.homeVillage,"onUpdate:modelValue":t[9]||(t[9]=t=>e.patient.homeVillage=t),asyncOptions:e.getVillagesByName,allowCustom:""},null,8,["modelValue","asyncOptions"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,{modelValue:e.patient.landmark,"onUpdate:modelValue":t[10]||(t[10]=t=>e.patient.landmark=t),asyncOptions:e.getLandmarks,allowCustom:""},null,8,["modelValue","asyncOptions"])]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(j,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{color:"primary",onClick:t[11]||(t[11]=t=>e.modal.hide()),slot:"end"},{default:Object(n["withCtx"])(()=>[ut]),_:1}),Object(n["createVNode"])(s,{class:"ion-margin-end",color:"success",onClick:e.onFinish,slot:"end"},{default:Object(n["withCtx"])(()=>[mt]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}var pt=a("5713"),gt=a("1f9a"),Ot=a("0db2"),vt=Object(n["defineComponent"])({components:{IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],TextInput:Ot["a"],DateInput:P["a"],SelectInput:T["a"]},props:{patientService:{type:Object,required:!0}},setup(e){const t=Object(n["ref"])(!1),a=Object(n["reactive"])({givenName:{label:"First Name",value:e.patientService.getGivenName(),placeholder:"First Name",required:!0,error:""},familyName:{label:"last Name",value:e.patientService.getFamilyName(),placeholder:"Last Name",required:!0},middleName:{label:"middle Name",value:e.patientService.getMiddleName(),placeholder:"middle Name"},gender:{value:e.patientService.getGender(),required:!0,label:"Gender",placeholder:"select gender"},birthdate:{value:e.patientService.getBirthdate(),label:"Date of Birth",placeholder:"Date of Birth",required:!0},cellPhoneNumber:{value:e.patientService.getPhoneNumber(),required:!0,label:"Cellphone Number",placeholder:"cellphone number e.g. 0991234567",validation:async e=>!("Unknown"===e.value||"N/A"===e.value)&&Oe["a"].isMWPhoneNumber(e)},homeVillage:{value:e.patientService.getCurrentVillage(),label:"Home Village",placeholder:"Home Village",required:!0},landmark:{value:e.patientService.getClosestLandmark(),label:"Landmark",placeholder:"Closest Landmark or Plot Number",required:!0}}),o=async e=>{const t={current_district:"N/A",current_traditional_authority:"N/A",current_village:e.label},a=await pt["a"].getTraditionalAuthorityById(e.other.traditional_authority_id);if(a.length>0){t["current_traditional_authority"]=a[0].name;const e=await pt["a"].getDistrictByID(a[0].district_id);Object(X["isEmpty"])(e)||(t["current_district"]=e[0].name)}return t},i=async()=>Object(E["e"])(a,async t=>{const a={};if(t.givenName!==e.patientService.getGivenName()&&(a["given_name"]=t.givenName),t.familyName!==e.patientService.getFamilyName()&&(a["family_name"]=t.familyName),t.middleName!==e.patientService.getMiddleName()&&(a["middle_name"]=t.middleName),t.birthdate!==e.patientService.getBirthdate()&&(a["birthdate"]=t.birthdate),t.cellPhoneNumber!==e.patientService.getPhoneNumber()&&(a["cell_phone_number"]=t.cellPhoneNumber),t.landmark.label!==e.patientService.getClosestLandmark()&&(a["landmark"]=t.landmark.label),t.homeVillage!==e.patientService.getCurrentVillage()&&Object.assign(a,{...a,...await o(t.homeVillage)}),!Object(X["isEmpty"])(a)){const t=new gt["a"];t.setPersonID(e.patientService.getID()),await t.updatePerson(a)}await q["a"].hide(),G["b"].emit(k.RELOAD_PATIENT_DATA)});return{patient:a,getLandmarks:ve["e"],genderOptions:S["b"],isBirthdateEstimated:t,modal:q["a"],onFinish:i,getVillagesByName:ve["j"]}}});const ft=U()(vt,[["render",bt]]);var ht=ft;const jt=Object(n["createTextVNode"])("Add Guadian Demographics"),Vt=Object(n["createTextVNode"])("Close"),Ct=Object(n["createTextVNode"])("Save");function _t(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-title"),c=Object(n["resolveComponent"])("ion-icon"),s=Object(n["resolveComponent"])("ion-button"),d=Object(n["resolveComponent"])("ion-buttons"),u=Object(n["resolveComponent"])("ion-toolbar"),m=Object(n["resolveComponent"])("ion-header"),b=Object(n["resolveComponent"])("TextInput"),p=Object(n["resolveComponent"])("ion-col"),g=Object(n["resolveComponent"])("ion-row"),O=Object(n["resolveComponent"])("ion-grid"),v=Object(n["resolveComponent"])("ion-content"),f=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(m,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,null,{default:Object(n["withCtx"])(()=>[jt]),_:1}),Object(n["createVNode"])(d,{slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{onClick:e.closeModal},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{slot:"icon-only",name:"close"})]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(v,{class:"ion-padding"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(g,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.guardian.givenName,"onUpdate:modelValue":t[1]||(t[1]=t=>e.guardian.givenName=t)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.guardian.familyName,"onUpdate:modelValue":t[2]||(t[2]=t=>e.guardian.familyName=t)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(p,{size:"12",class:"ion-margin-top ion-margin-bottom"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.guardian.cellPhoneNumber,"onUpdate:modelValue":t[3]||(t[3]=t=>e.guardian.cellPhoneNumber=t),allowUnknown:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(f,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{color:"primary",onClick:t[4]||(t[4]=t=>e.modal.hide()),slot:"end"},{default:Object(n["withCtx"])(()=>[Vt]),_:1}),Object(n["createVNode"])(s,{class:"ion-margin-end",color:"success",onClick:e.onFinish,slot:"end"},{default:Object(n["withCtx"])(()=>[Ct]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}var Nt=a("2cef"),wt=Object(n["defineComponent"])({components:{IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],TextInput:Ot["a"]},props:{patientId:{type:Number,required:!0}},setup(e){const t=Object(n["reactive"])({givenName:{label:"First Name",value:"",placeholder:"First Name",required:!0},familyName:{label:"Last Name",value:"",placeholder:"Last Name",required:!0},cellPhoneNumber:{value:"",required:!0,label:"Cellphone Number",validation:async e=>"Unknown"!==e.value&&Oe["a"].isMWPhoneNumber(e)}}),a=async()=>Object(E["e"])(t,async t=>{const a={home_district:"N/A",home_traditional_authority:"N/A",home_village:"N/A",current_district:"N/A",current_traditional_authority:"N/A",current_village:"N/A",middle_name:"",gender:"N/A",birthdate:"N/A",birthdate_estimated:"N/A",landmark:"N/A",relationship:"N/A",patient_type:"",isPatient:!1,patient_id:e.patientId,...t},n=new gt["a"];await n.registerGuardian(a);const o=n.getPersonID();await Nt["a"].createRelation(e.patientId,o,13),await q["a"].hide(),G["b"].emit(k.RELOAD_GUARDIAN_DATA)},{underscoreKeys:!0});return{guardian:t,modal:q["a"],onFinish:a}}});const It=U()(wt,[["render",_t]]);var yt=It;const Dt=Object(n["createTextVNode"])("ARV NUMBER"),xt=Object(n["createTextVNode"])("Close"),kt=Object(n["createTextVNode"])("Void ARV Number"),Pt=Object(n["createTextVNode"])("Save");function Tt(e,t,a,o,i,r){const l=Object(n["resolveComponent"])("ion-title"),c=Object(n["resolveComponent"])("ion-icon"),s=Object(n["resolveComponent"])("ion-button"),d=Object(n["resolveComponent"])("ion-buttons"),u=Object(n["resolveComponent"])("ion-toolbar"),m=Object(n["resolveComponent"])("ion-header"),b=Object(n["resolveComponent"])("text-input"),p=Object(n["resolveComponent"])("ion-col"),g=Object(n["resolveComponent"])("ion-row"),O=Object(n["resolveComponent"])("ion-grid"),v=Object(n["resolveComponent"])("ion-content"),f=Object(n["resolveComponent"])("ion-footer");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(m,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(l,null,{default:Object(n["withCtx"])(()=>[Dt]),_:1}),Object(n["createVNode"])(d,{slot:"end"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{onClick:t[1]||(t[1]=t=>e.modal.hide())},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(c,{slot:"icon-only",name:"close"})]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(v,{class:"ion-padding"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(O,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(g,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(p,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(b,{modelValue:e.form.arvNumber,"onUpdate:modelValue":t[2]||(t[2]=t=>e.form.arvNumber=t),form:e.form,prefix:e.sitePrefix+"-ARV-"},null,8,["modelValue","form","prefix"])]),_:1})]),_:1})]),_:1})]),_:1}),Object(n["createVNode"])(f,{class:"ion-padding-horizontal"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(u,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(s,{color:"primary",onClick:t[3]||(t[3]=t=>e.modal.hide()),slot:"end"},{default:Object(n["withCtx"])(()=>[xt]),_:1}),e.hasValidARVNumber?(Object(n["openBlock"])(),Object(n["createBlock"])(s,{key:0,color:"danger",onClick:e.voidARV,slot:"start"},{default:Object(n["withCtx"])(()=>[kt]),_:1},8,["onClick"])):Object(n["createCommentVNode"])("",!0),Object(n["createVNode"])(s,{color:"success",onClick:e.onFinish,slot:"end"},{default:Object(n["withCtx"])(()=>[Pt]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}var At=a("b211"),St=a("cc74"),Rt=Object(n["defineComponent"])({components:{IonGrid:j["IonGrid"],IonRow:j["IonRow"],IonCol:j["IonCol"],TextInput:Ot["a"]},props:{patient:{type:Object,required:!0}},setup(e){const t=Object(n["ref"])(""),a=Object(n["computed"])(()=>e.patient.getArvNumber()),o=Object(n["computed"])(()=>!Object(X["isEmpty"])(a.value)&&"Unknown"!==a.value),i=Object(n["reactive"])({arvNumber:{value:o.value?a.value.split("-")[2]:"",label:(o.value?"Edit":"Add New")+" ARV Number",placeholder:"Enter ARV Number",required:!0,validation:async e=>{if(e.value===a.value.split("-")[2])return null;const n=await v["a"].findByOtherID(4,`${t.value}-ARV-${e.value}`);return Object(X["isEmpty"])(n)?null:["ARV Number already exists"]}}}),r=async()=>Object(E["e"])(i,async n=>{n.arvNumber!==a.value.split("-")[2]&&(o.value?await e.patient.updateARVNumber(`${t.value}-ARV-${n.arvNumber}`):await e.patient.createArvNumber(`${t.value}-ARV-${n.arvNumber}`),await q["a"].hide(),G["b"].emit(k.RELOAD_PATIENT_DATA))}),l=async()=>{const e=await Object(K["a"])(`Are you sure you want to void this ARV Number ${a.value}?`);if(e){await At["a"].show("Voiding ARV Number...");try{await f["a"].voidARVNumber(a.value),await At["a"].hide(),await q["a"].hide(),G["b"].emit(k.RELOAD_PATIENT_DATA)}catch(t){await At["a"].hide(),console.log(t)}}};return Object(n["onMounted"])(async()=>{if(t.value=await St["b"].sitePrefix(),!o.value){const e=await f["a"].getNextSuggestedARVNumber();i.arvNumber.value=e.arv_number.replace(/^\D+|\s/g,"")}}),{form:i,modal:q["a"],sitePrefix:t,arvNumber:a,hasValidARVNumber:o,onFinish:r,voidARV:l}}});const Bt=U()(Rt,[["render",Tt]]);var Et=Bt,Ft=a("6c02"),Ht=Object(n["defineComponent"])({components:{Layout:l["a"],VisitsSummary:Ze,InformationHeader:st},setup(){const e=Object(Ft["e"])(),t=parseInt(e.params.patientId.toString())||0,a=Object(n["ref"])(),o=Object(n["ref"])(""),l=Object(n["ref"])(""),c=Object(n["computed"])(()=>!Object(X["isEmpty"])(a.value)),s=async()=>{if(t){const e=await Be.findByID(t);e&&(a.value=new Be(e))}},d=async()=>{const e=await r["a"].getGuardianDetails(t);l.value=e.map(e=>` ${e.name} (${e.relationshipType})`).join(", ")},u=async e=>{await q["a"].show(ht,{patientService:a.value,attribute:e})},m=async()=>{await q["a"].show(yt,{patientId:t})},b=async()=>{await q["a"].show(Et,{patient:a.value})};return G["b"].on(k.RELOAD_PATIENT_DATA,async()=>{await s()}),G["b"].on(k.RELOAD_GUARDIAN_DATA,async()=>{await d()}),Object(n["onMounted"])(async()=>{var e;await s();const t=await(null===(e=a.value)||void 0===e?void 0:e.getARTStartDate());o.value=t?i["c"].toStandardHisDisplayFormat(t):"N/A",await d()}),{patient:a,artStartDate:o,guardians:l,isReady:c,updateDemographics:u,addGuardian:m,updateARVNumber:b}}});const Gt=U()(Ht,[["render",o]]);t["default"]=Gt},a20a:function(e,t,a){},b94b:function(e,t,a){},cda3:function(e,t,a){"use strict";a("a20a")},d10e:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("1c74");class o extends n["e"]{constructor(e){super(),this.person=e}create(){return n["e"].postJson("/people",this.person)}update(e){return n["e"].putJson("people/"+e,{...this.person,program_id:n["e"].getProgramID()})}static searchFamilyName(e){return super.getJson("/search/family_name",{search_string:e})}static searchGivenName(e){return super.getJson("/search/given_name",{search_string:e})}static async getPersonFullName(e){const t=await super.getJson(`/people/${e}/names`);return t&&t.length?t[0].given_name+" "+t[0].family_name:""}}},da44:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("8a30");const o={async show(e,t,a="custom-modal",o=!0){const i=await n["modalController"].create({component:e,cssClass:a,backdropDismiss:o,componentProps:t});i.present();const{data:r}=await i.onWillDismiss();if(r)return r},async hide(e){await n["modalController"].dismiss(e)}}},dac2:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n,o=a("71c3"),i=a("9283"),r=a("6d32"),l=a("2ef0"),c=a("cc6f");(function(e){e["CONTRAINDICATION"]="contraindication",e["SIDE_EFFECT"]="side_effect"})(n||(n={}));class s extends c["a"]{constructor(e,t){super(e,25,t),this.nextVisitInterval=0,this.fastTrack=!1,this.regimenExtras=[],this.fastTrackMedications=[],this.hangingPills=[],this.medicationOrders=[],this.treatmentState="",this.contraindications={},this.sideEffects={},this.tptPrescriptionCount=0,this.lastSideEffectDate=""}setNextVisitInterval(e){this.nextVisitInterval=e}getHangingPills(){return this.hangingPills}getMedicationOrders(){return this.medicationOrders.map(e=>c["a"].getCachedConceptName(e))}getTptPrescriptionCount(){return this.tptPrescriptionCount}getLastSideEffectDate(){return this.lastSideEffectDate}getContraindications(){return this.contraindications}getSideEffects(){return this.sideEffects}getRegimenExtras(){return this.regimenExtras}getPatientRegimens(){return r["a"].getRegimens(this.patientID)}getARVs(){return r["a"].getJson("arv_drugs")}getCustomIngridients(){return r["a"].getCustomIngridients()}getFastTrackMedications(){return this.fastTrackMedications}getTreatmentState(){return this.treatmentState}isFastTrack(){return this.fastTrack}medicationOrdersAvailable(){return!Object(l["isEmpty"])(this.medicationOrders)}shouldPrescribeArvs(){const e=c["a"].getCachedConceptID("Antiretroviral drugs");return this.medicationOrders.includes(e)}shouldPrescribeExtras(){const e=c["a"].getConceptsByCategory("art_extra_medication_order"),t=e.map(e=>this.medicationOrders.includes(e.concept_id));return t.some(Boolean)}getRegimenStarterpack(e,t){const a={weight:t,regimen:e};return c["a"].getJson(`programs/${c["a"].getProgramID()}/regimen_starter_packs`,a)}async getLvpDrugsByType(e,t){return c["a"].getJson(`programs/${c["a"].getProgramID()}/regimens/${t}`,{patient_id:this.patientID,lpv_drug_type:e})}async loadContraindications(){const e=await c["a"].getConceptID("Contraindications"),t=await c["a"].getObs({concept_id:e,person_id:this.patientID});t.forEach(e=>{const t=i["c"].toStandardHisFormat(e.obs_datetime);this.contraindications[t]||(this.contraindications[t]=[]);const a=c["a"].getCachedConceptName(e.value_coded);this.contraindications[t].push(a)})}async loadDrugInduced(){const e=await c["a"].getConceptID("Drug induced"),t=await c["a"].getObs({concept_id:e,person_id:this.patientID});t&&t.forEach(e=>{const t=i["c"].toStandardHisFormat(e.obs_datetime);if(this.lastSideEffectDate||(this.lastSideEffectDate=t),!e.value_drug||!e.value_coded)return;this.sideEffects[t]||(this.sideEffects[t]={}),this.sideEffects[t][e.value_drug]||(this.sideEffects[t][e.value_drug]=[]);const a=c["a"].getCachedConceptName(e.value_coded);this.sideEffects[t][e.value_drug].push(a)})}async loadTptPrescriptionCount(){const e=await c["a"].getJson("tpt_prescription_count",{patient_id:this.patientID,date:this.date});if(e){const t=e.count+1;this.tptPrescriptionCount=t>3?3:t}}async loadFastTrackStatus(){const e=await c["a"].getFirstValueCoded(this.patientID,"Fast track"),t=await c["a"].getConceptID("yes");e&&(this.fastTrack=e===t)}async loadRegimenExtras(e=this.date){const t=await r["a"].getJson(`programs/${r["a"].getProgramID()}/patients/${this.patientID}/dosages`,{date:e});t&&(this.regimenExtras=Object.values(t))}async loadMedicationOrders(){const e=await c["a"].getConceptID("Medication orders"),t=await c["a"].getObs({concept_id:e,date:this.date,person_id:this.patientID,page_size:5});this.medicationOrders=t.map(e=>e.value_coded)}async loadHangingPills(){const e=await c["a"].getAll(this.patientID,"Pills brought");e&&(this.hangingPills=e.filter(e=>e.value_numeric>=1&&e.order).map(e=>e.order.drug_order.drug_inventory_id))}async loadFastTrackMedications(){const e=await o["a"].getLastDrugsReceived(this.patientID),t=e.map(async e=>{const{drug:t}=e,a=await o["a"].getDrugDosages(this.patientID,t.drug_id);return{drug_id:t.drug_id,drug_name:t.name,units:t.units,am:a.am,noon:a.noon,pm:a.pm,frequency:e.frequency}});this.fastTrackMedications=await Promise.all(t)}async loadTreatmentState(){const e={date:this.date},t=await c["a"].getJson(`programs/${c["a"].getProgramID()}/patients/${this.patientID}/status`,e);t&&(this.treatmentState=t["status"])}findAndGroupDrugSideEffects(e){const t={};for(const a in this.sideEffects){const n=this.sideEffects[a];for(const o in n)e.includes(parseInt(o))&&(t[a]||(t[a]=[]),t[a]=[...t[a],...n[o]])}return t}calculatePillsPerDay(e,t,a){return parseFloat(e.toString())+t+a}estimatePackSize(e,t=0){const a=e*this.nextVisitInterval/t;let n=Math.round(a);return n<=0&&(n+=1),n}calculateDosage(e,t){let a=0;return 0===t&&(a=e),0==e&&(a=t),e>0&&t>0&&(a=(e+t)/2),a}calculateEquivalentDosage(e,t){return e+t}calculateDateFromInterval(){const e=new Date(this.date);return e.setDate(e.getDate()+this.nextVisitInterval),i["c"].toStandardHisFormat(e)}getDrugPackSize(e){if(e.pack_size)return e.pack_size;try{return e.barcodes[0].tabs}catch(t){return 30}}getInstructions(e,t,a,n){return`${e} :- Morning: ${t} ${n}, Evening: ${a} ${n}`}toOrderObj(e,t,a,n=0,o=0,i=""){return{drug_inventory_id:e,equivalent_daily_dose:this.calculateEquivalentDosage(n,o),start_date:this.date,auto_expire_date:this.calculateDateFromInterval(),units:a,instructions:this.getInstructions(t,n,o,a),dose:this.calculateDosage(n,o),frequency:i}}async getReasonForRegimenSwitch(){const e=await c["a"].getFirstValueText(this.patientID,"Reason for ARV switch");return e||"N/A"}async createDrugOrder(e){return o["a"].create({encounter_id:this.encounterID,drug_orders:e})}async createHangingPillsObs(e){return this.saveValueTextObs("appointment type",e)}async createRegimenSwitchObs(e){return this.saveValueTextObs("Reason for ARV switch",e)}}}}]);
//# sourceMappingURL=chunk-fa92f74c.e54ecc05.js.map