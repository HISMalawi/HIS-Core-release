(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d20ebf7"],{b14f:function(e,t,i){"use strict";i.r(t);var a=i("7a23");function n(e,t,i,n,s,o){const r=Object(a["resolveComponent"])("his-standard-form"),l=Object(a["resolveComponent"])("ion-page");return Object(a["openBlock"])(),Object(a["createBlock"])(l,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(r,{fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])]),_:1})}var s=i("7365"),o=i("7920"),r=i("8a30"),l=i("d95e"),d=i("2706"),u=i("cc6f"),c=i("b89f");class p extends u["a"]{constructor(e,t){super(e,121,t)}static getListOfRadiologyTests(e){return super.getJson("radiology_set",{id:e})}createOrder(e){return u["a"].postJson("orders/radiology",e)}printExamination(e){const t=new c["a"];return t.printLbl("orders/radiology?accession_number="+e)}}var h=i("1c74");class m extends h["e"]{constructor(){super()}static getInternalSections(){return super.getJson("internal_sections")}static createInternalSection(e){return super.postJson("internal_sections",{name:e})}}var v=i("2ef0"),b=i("b5e4"),T=i("80b5"),f=Object(a["defineComponent"])({mixins:[s["a"]],components:{IonPage:r["D"],HisStandardForm:o["a"]},data:()=>({service:{},examinationOptions:[],detailedExaminationOptions:[]}),watch:{ready:{handler(e){e&&(this.service=new p(this.patientID,this.providerID),this.fields.push(this.listOfRadiologyTestsField()),this.fields.push(this.examinationField()),this.fields.push(this.detailedExaminationField()),this.fields.push(this.referralTypeField()),this.fields.push(this.internalReferralField()),this.fields.push(this.externalReferralField()),this.fields.push(this.payingField()),this.fields.push(this.paymentTypeField()),this.fields.push(this.receiptField()),this.fields.push(this.paymentAmountField()),this.fields.push(this.invoiceField()),this.fields.push(this.invoiceAmountField()))},immediate:!0}},methods:{async getTestsOptions(e){return(await p.getListOfRadiologyTests(e)).map(e=>({label:e.name,value:e.concept_id}))},validateAmount(e){return e.match(/([0-9]+\\.[0-9])|Unknown$/i)?["You must enter a decimal number"]:null},async onFinish(e,t){await this.service.createEncounter(),await this.service.saveObservationList(await this.resolveObs(t));for(const i of Object.values(t))if("function"===typeof i.order){const e=await this.service.createOrder(i.order(this.service.getEncounterID()));"object"===typeof e&&e.accession_number&&this.service.printExamination(e.accession_number)}this.gotoPatientDashboard()},listOfRadiologyTestsField(){let e=[],t=-1;return{id:"list_of_radiology_test",helpText:"Please select the type of examination",type:l["b"].TT_SELECT,validation:e=>d["a"].required(e),computedValue:e=>({obs:this.service.buildValueCoded("RADIOLOGY TEST",e.value),order:t=>{const i={encounter_id:t,concept_id:e.value};return-1!=this.providerID&&(i["provider_id"]=this.providerID),i}}),beforeNext:async e=>(t!=e.value&&(t=e.value,this.examinationOptions=await this.getTestsOptions(e.value)),!0),options:async()=>(Object(v["isEmpty"])(e)&&(e=await this.getTestsOptions("LIST OF RADIOLOGY TESTS")),e)}},examinationField(){let e=-1;return{id:"examination",helpText:"Please select the examination",type:l["b"].TT_SELECT,validation:e=>d["a"].required(e),computedValue:e=>({obs:this.service.buildValueCoded("Examination",e.value)}),condition:()=>!Object(v["isEmpty"])(this.examinationOptions),beforeNext:async(t,i)=>(e!=i.list_of_radiology_test.value&&(e=t.value,this.detailedExaminationOptions=await this.getTestsOptions(e)),!0),options:()=>this.examinationOptions}},detailedExaminationField(){return{id:"detailed_examination",helpText:"Please select the detailed examination",type:l["b"].TT_SELECT,condition:()=>!Object(v["isEmpty"])(this.detailedExaminationOptions),computedValue:e=>({obs:this.service.buildValueCoded("Detailed examination",e.value)}),validation:e=>d["a"].required(e),options:()=>this.detailedExaminationOptions}},referralTypeField(){return{id:"referral_type",helpText:"Please select the referral type",type:l["b"].TT_SELECT,validation:e=>d["a"].required(e),computedValue:e=>({obs:this.service.buildValueText("Source of referral",e.label)}),options:()=>this.mapStrToOptions(["External","Internal"])}},externalReferralField(){const e=T["a"].getFacilityLocationField();return e.id="external_referral",e.condition=e=>"External"===e.referral_type.value,e.computedValue=e=>({obs:this.service.buildValueText("REFERRED FROM",e.label)}),e},internalReferralField(){let e=[];return{id:"referred_by",helpText:"Referred from",type:l["b"].TT_SELECT,validation:e=>d["a"].required(e),condition:e=>"Internal"===e.referral_type.value,computedValue:e=>({obs:this.service.buildValueText("REFERRED FROM",e.label)}),options:async()=>(Object(v["isEmpty"])(e)&&(e=(await m.getInternalSections()).map(e=>({value:e.id,label:e.name}))),e),config:{showKeyboard:!0,footerBtns:[{name:"Add Referral",slot:"end",color:"success",onClick:async(e,t,i)=>{if("string"!=typeof i.filter||i.filter.length<3)return Object(b["e"])("Please enter a valid name");if(i.filtered.some(e=>e.label.toLowerCase()===i.filter.toLowerCase()))return Object(b["e"])("Can't add already existing referral location");if(await Object(b["a"])("Do you want to add referral location?")){const e=await m.createInternalSection(i.filter);e?(i.filter=e.name,i.listData=[{label:e.name,value:e.id},...i.listData]):Object(b["c"])("Unable to add "+i.filter)}}}]}}},payingField(){return{id:"paying",helpText:"Is this a paying patient?",type:l["b"].TT_SELECT,computedValue:e=>({obs:this.service.buildValueCoded("PAYING",e.value)}),validation:e=>d["a"].required(e),options:()=>this.yesNoOptions()}},paymentTypeField(){return{id:"payment_type",helpText:"Select payment method",type:l["b"].TT_SELECT,validation:e=>d["a"].required(e),condition:e=>"Yes"===e.paying.value,computedValue:e=>({obs:this.service.buildValueCoded("PAYMENT TYPE",e.value)}),options:()=>this.mapStrToOptions(["Cash","Invoice"])}},receiptField(){return{id:"receipt_number",helpText:"Enter receipt number",type:l["b"].TT_TEXT,condition:e=>"Cash"===e.payment_type.value,computedValue:e=>({obs:this.service.buildValueText("RECEIPT NUMBER",e.value)}),validation:e=>d["a"].validateSeries([()=>d["a"].required(e),()=>this.validateAmount(""+e.value)])}},invoiceField(){return{id:"invoice_number",helpText:"Enter invoice number",type:l["b"].TT_TEXT,computedValue:e=>({obs:this.service.buildValueText("INVOICE NUMBER",e.value)}),condition:e=>"Invoice"===e.payment_type.value,validation:e=>d["a"].required(e)}},paymentAmountField(){return{id:"payment_amount",helpText:"Enter payment amount",type:l["b"].TT_NUMBER,condition:e=>e.receipt_number.value,computedValue:e=>({obs:this.service.buildValueNumber("PAYMENT AMOUNT",e.value)}),validation:e=>d["a"].validateSeries([()=>d["a"].required(e),()=>this.validateAmount(""+e.value)])}},invoiceAmountField(){return{id:"invoice_amount",helpText:"Enter invoice amount",type:l["b"].TT_NUMBER,condition:e=>e.invoice_number.value,computedValue:e=>({obs:this.service.buildValueNumber("INVOICE AMOUNT",e.value)}),validation:e=>d["a"].validateSeries([()=>d["a"].required(e),()=>this.validateAmount(""+e.value)])}}}}),y=i("6b0d"),E=i.n(y);const O=E()(f,[["render",n]]);t["default"]=O}}]);
//# sourceMappingURL=chunk-2d20ebf7.e9c3c236.js.map