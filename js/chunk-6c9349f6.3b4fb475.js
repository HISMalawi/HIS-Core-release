(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6c9349f6"],{"13c2":function(e,t,a){"use strict";a.r(t);var r=a("7a23");function i(e,t,a,i,s,n){const o=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(o,{cancelDestinationPath:e.cancelDestination,fields:e.fields,activeField:e.activeField,onFinishAction:e.onSubmit,skipSummary:!0},null,8,["cancelDestinationPath","fields","activeField","onFinishAction"])}var s=a("9441"),n=a("7365"),o=a("2706"),d=a("d95e"),u=a("2ef0"),c=a("996c"),l=a("9283"),g=a("b5e4"),h=Object(r["defineComponent"])({components:{HisStandardForm:s["a"]},mixins:[n["a"]],data:()=>({activeField:"",prescriptionService:{},showMalariaDrugs:!1,hasMalaria:!1}),watch:{ready:{async handler(e){e&&(this.prescriptionService=new c["c"](this.patientID,this.providerID),this.hasMalaria=await this.prescriptionService.hasMalaria(),this.fields=this.getFields())},immediate:!0,deep:!0}},methods:{async onSubmit(e){const t=this.mapToOrders(e["drugs_details"]),a=await this.prescriptionService.createEncounter();if(!a)return Object(g["e"])("Unable to create treatment encounter");const r=await this.prescriptionService.createDrugOrder(t);if(!r)return Object(g["e"])("Unable to create drug orders!");Object(g["d"])("Drug order has been created"),this.nextTask()},calculateExpireDate(e,t){const a=new Date(e);return a.setDate(a.getDate()+t),l["b"].toStandardHisFormat(a)},mapToOrders(e){return e.map(e=>{const t=c["c"].getSessionDate(),a=c["b"].find(t=>t.label===e.other.frequency);return{drug_inventory_id:e.other.drug_id,equivalent_daily_dose:e.other.dosage*a.value,start_date:t,auto_expire_date:this.calculateExpireDate(t,e.other.duration),units:e.other.units,instructions:`${e.label}: ${a.value} ${a.code} for ${e.other.duration}`,dose:e.other.dosage,frequency:a.code}})},isOrderComplete(e){return e.every(e=>e.other.frequency&&e.other.duration&&e.other.dosage)},getFields(){return[{id:"malaria_drugs",helpText:"select Malaria Drugs",validation:e=>o["a"].required(e),type:d["b"].TT_SELECT,condition:()=>"malaria_drugs"===this.activeField&&this.showMalariaDrugs,unload:()=>{this.showMalariaDrugs=!1,this.activeField="drugs_details"},options:()=>c["a"].map(e=>({label:`${e.name}, ${e.frequency} time(s) a day, for ${e.duration} days`,value:e.name,other:e}))},{id:"drugs",helpText:"Select drugs",type:d["b"].TT_INFINITE_SCROLL_MULTIPLE_SELECT,validation:e=>o["a"].required(e),options:async(e,t="",a=1,r=10)=>await this.prescriptionService.loadDrugs(t,a,r),onload:()=>this.activeField="",config:{showKeyboard:!0,hiddenFooterBtns:["Back"],footerBtns:[{name:"Predefined Malaria Drugs",color:"primary",size:"large",visible:!1,slot:"end",onClick:async()=>{(this.hasMalaria||await Object(g["a"])("Patient has no malaria. Do you still want to prescribe anti malaria drugs?"))&&(this.activeField="malaria_drugs",this.showMalariaDrugs=!0)}}]}},{id:"drugs_details",helpText:"Complete prescribed drug details",type:d["b"].TT_PRESCRIPTION_INPUT,validation:e=>o["a"].required(e),options:e=>[...e.drugs,...e.malaria_drugs?[e.malaria_drugs]:[]],beforeNext:e=>!Object(u["isEmpty"])(e)&&(!!this.isOrderComplete(e)||(Object(g["e"])("Please complete all fields"),!1))},{id:"summary",helpText:"Summary",type:d["b"].TT_TABLE_VIEWER,options:e=>{const t=e["drugs_details"],a=["Drug Name","Frequency","Dosage","Duration"],r=t.map(e=>[e.other.name,e.other.frequency,`${e.other.dosage} ${e.other.units}`,e.other.duration+" days"]);return[{label:"",value:"",other:{columns:a,rows:r}}]}}]}}}),p=a("6b0d"),m=a.n(p);const D=m()(h,[["render",i]]);t["default"]=D},"71c3":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a("1c74");class i extends r["e"]{constructor(){super()}static create(e){return this.postJson("drug_orders",e)}static updateDispensationOrders(e){return this.postJson("dispensations",{program_id:this.getProgramID(),dispensations:e.map(e=>({date:this.getSessionDate(),drug_order_id:e["order_id"],quantity:e["quantity"]}))})}static getDrugOrderHistory(e){return this.getJson("drug_orders",{patient_id:e})}static getDrugOrders(e){return this.getJson("drug_orders",{patient_id:e,date:this.getSessionDate(),program_id:this.getProgramID()})}static getAllDrugOrders(e,t=1e3){return this.getJson("drug_orders",{patient_id:e,program_id:r["e"].getProgramID(),page_size:t})}static getLastDrugsReceived(e){return this.getJson(`patients/${e}/last_drugs_received`,{date:this.getSessionDate(),program_id:this.getProgramID()})}static getDrugDosages(e,t,a=this.getSessionDate()){const r={drug_id:t,date:a};return this.getJson(`programs/${this.getProgramID()}/patients/${e}/drug_doses`,r)}static getOrderByPatient(e,t){return this.getJson("/drug_orders",{patient_id:e,program_id:this.getProgramID(),...t})}}},"76f1":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a("1c74");class i extends r["e"]{constructor(){super()}static getDrugs(e={}){return super.getJson("/drugs",e)}}},"996c":function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return d})),a.d(t,"c",(function(){return u}));a("caad");var r=a("cc6f"),i=a("71c3"),s=a("9b7c"),n=a("76f1");const o=[{label:"ONCE A DAY (OD)",code:"OD",value:1},{label:"TWICE A DAY (BD)",code:"BD",value:2},{label:"THREE TIMES A DAY (TDS)",code:"TDS",value:3},{label:"FOUR TIMES A DAY (QID)",code:"QID",value:4},{label:"FIVE TIMES A DAY (5X/D)",code:"5X/D",value:5},{label:"SIX TIMES A DAY (Q4HRS)",code:"Q4HRS",value:6},{label:"IN THE MORNING (QAM)",code:"QAM",value:1},{label:"ONCE A DAY AT NOON (QNOON)",code:"QNOON",value:1},{label:"IN THE EVENING (QPM)",code:"QPM",value:1},{label:"ONCE A DAY AT NIGHT (QHS)",code:"QHS",value:1},{label:"EVERY OTHER DAY (QOD)",code:"QOD",value:.5},{label:"ONCE A WEEK (QWK)",code:"QWK",value:.14},{label:"ONCE A MONTH",code:"ONCE A MONTH",value:.03},{label:"TWICE A MONTH",code:"TWICE A MONTH",value:.071}],d=[{drug_id:236,duration:3,tabs:6,name:"Lumefantrine + Arthemether 1 x 6",dose_strength:1,units:"tabs",frequency:2},{drug_id:237,duration:3,tabs:12,name:"Lumefantrine + Arthemether 2 x 6",dose_strength:2,units:"tabs",frequency:2},{drug_id:238,duration:3,tabs:18,name:"Lumefantrine + Arthemether 3 x 6",dose_strength:3,units:"tabs",frequency:2},{drug_id:239,duration:3,tabs:24,name:"Lumefantrine + Arthemether 4 x 6",dose_strength:4,units:"tabs",frequency:2}];class u extends r["a"]{constructor(e,t){super(e,25,t)}async loadDrugs(e="",t=1,a=10){const r=await n["a"].getDrugs({name:e,page:t,page_size:a});return r.map(e=>({label:e.name,value:e.name,other:e}))}async hasMalaria(){const e=await s["a"].getLatestMalariaTestResult(this.patientID);if("No"===e){const e=await r["a"].getAllValueCoded(this.patientID,"Primary diagnosis");if(e.includes("Malaria"))return!0;const t=await r["a"].getAllValueCoded(this.patientID,"Secondary diagnosis");return!!t.includes("Malaria")}return"Positive"===e}createDrugOrder(e){return i["a"].create({encounter_id:this.encounterID,drug_orders:e})}}}}]);
//# sourceMappingURL=chunk-6c9349f6.3b4fb475.js.map