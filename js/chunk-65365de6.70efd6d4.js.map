{"version":3,"sources":["webpack:///./node_modules/vue-loader-v16/dist/templateLoader.js","webpack:///./node_modules/cache-loader/dist/cjs.js","webpack:///./src/apps/ART/views/reports/moh/MohTptInitiationsReport.vue","webpack:///./node_modules/eslint-loader/index.js"],"names":["render","_ctx","_cache","$props","$setup","$data","$options","_component_report_template","_resolveComponent","_component_ion_page","_openBlock","_createBlock","default","_withCtx","_createVNode","reportPrefix","title","period","rows","fields","columns","config","showIndex","validationErrors","errors","showValidationStatus","showStatus","headerInfoList","headerList","onReportConfiguration","onPeriod","_","defineComponent","mixins","ReportMixin","components","ReportTemplate","IonPage","data","cohort","canValidate","mohCohort","table","thTxt","thNum","totalIpt","total3hp","watch","doIt","this","validateReport","created","getDateDurationFields","methods","report","RegimenReportService","MohCohortReportService","setStartDate","start_date","setEndDate","end_date","getDateIntervalPeriod","getTptNewInitiations","setRows","drilldown","patients","context","asyncRows","sortByArvNumber","map","p","td","arv_number","tdDate","birthdate","dispensation_date","length","tdLink","drilldownAsyncRows","gender","fullGender","ageIndex","AGE_GROUPS","group","location","isEmpty","uniq","push","validations","param","check","i","error","s","validateIndicators","__exports__","PatientReportService","ArtReportService","constructor","getBookedAppointments","date","getJson","programID","getViralLoadResults","range","getReport","getOtherOutcome","outcome","getPatientVisitTypes","getClientsDueForVl","getClientRentention","getExternalConsultationClients","getMissedAppointments","getPregnantWomen","getArchivingCandidates","CohortVar","super","regenerate","cohortUrl","setRegenerate","getCohortDrillDown","resourceId","id","requestCohort","params","ajxGet","qaurterRequestParams","name","quarter","datePeriodRequestParams","startDate","endDate","getCachedCohortValues","cache","sessionStorage","getItem","MOH_CACHE","conf","JSON","parse","cacheCohort","values","setItem","stringify","callback","cachedValues","Object","keys","reduce","key","indicator","find","validation","indicatorValue","contents","condition","parseInt"],"mappings":"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","file":"js/chunk-65365de6.70efd6d4.js","sourcesContent":["import { resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock } from \"vue\"\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_report_template = _resolveComponent(\"report-template\")\n  const _component_ion_page = _resolveComponent(\"ion-page\")\n\n  return (_openBlock(), _createBlock(_component_ion_page, null, {\n    default: _withCtx(() => [\n      _createVNode(_component_report_template, {\n        reportPrefix: \"MoH\",\n        title: _ctx.title,\n        period: _ctx.period,\n        rows: _ctx.rows,\n        fields: _ctx.fields,\n        columns: _ctx.columns,\n        config: {\n                showIndex: true\n            },\n        validationErrors: _ctx.errors,\n        showValidationStatus: _ctx.showStatus,\n        headerInfoList: _ctx.headerList,\n        onReportConfiguration: _ctx.onPeriod\n      }, null, 8, [\"title\", \"period\", \"rows\", \"fields\", \"columns\", \"validationErrors\", \"showValidationStatus\", \"headerInfoList\", \"onReportConfiguration\"])\n    ]),\n    _: 1\n  }))\n}","\nimport { defineComponent } from 'vue'\nimport { AGE_GROUPS } from \"@/apps/ART/services/reports/patient_report_service\"\nimport { RegimenReportService } from \"@/apps/ART/services/reports/regimen_report_service\"\nimport ReportMixin from \"@/apps/ART/views/reports/ReportMixin.vue\"\nimport { isEmpty, uniq } from 'lodash'\nimport ReportTemplate from \"@/apps/ART/views/reports/TableReportTemplate.vue\"\nimport table from \"@/components/DataViews/tables/ReportDataTable\"\nimport { IonPage } from \"@ionic/vue\"\nimport { MohCohortReportService } from \"@/apps/ART/services/reports/moh_cohort_service\"\nimport { Option } from '@/components/Forms/FieldInterface'\n\nexport default defineComponent({\n    mixins: [ReportMixin],\n    components: { ReportTemplate, IonPage },\n    data: () => ({\n        title: 'TPT new initiations report',\n        rows: [] as Array<any>,\n        cohort: {} as any,\n        canValidate: false as boolean,\n        mohCohort: {} as any,\n        headerList: [] as Array<Option>,\n        errors: [] as string[],\n        showStatus: false as boolean,\n        columns: [\n            [\n                table.thTxt('District'),\n                table.thTxt('Age group'),\n                table.thTxt('Gender'),\n                table.thNum('3HP (Started New on ART)'),\n                table.thNum('6H (Started New on ART)'),\n                table.thNum('3HP (Started Previously on ART)'),\n                table.thNum('6H (Started Previously on ART)')\n            ]\n        ],\n        totalIpt: [] as number[],\n        total3hp: [] as number[]\n    }),\n    watch: {\n        async canValidate(doIt: boolean) {\n            if (doIt) await this.validateReport()\n        }\n    },\n    created() {\n        this.fields = this.getDateDurationFields()\n    },\n    methods: {\n        async onPeriod(_: any, config: any) {\n            this.canValidate = false\n            this.rows = []\n            this.errors = []\n            this.showStatus = false\n            this.totalIpt = []\n            this.total3hp = []\n            this.report = new RegimenReportService()\n            this.mohCohort = new MohCohortReportService()\n            this.mohCohort.setStartDate(config.start_date)\n            this.mohCohort.setEndDate(config.end_date)\n            this.report.setStartDate(config.start_date)\n            this.report.setEndDate(config.end_date)\n            this.period = this.report.getDateIntervalPeriod()\n            this.cohort = await this.report.getTptNewInitiations()\n            this.setRows('F')\n            this.setRows('M')\n            this.canValidate = true\n            this.showStatus = true\n        },\n        drilldown(patients: Array<any>, context: string) {\n            const columns = [\n                [\n                    table.thTxt('ARV #'),\n                    table.thTxt('DOB'),\n                    table.thTxt('Dispensed date')\n                ]\n            ]\n            const asyncRows = () => this.sortByArvNumber(patients).map(\n                (p: any) => ([\n                   table.td(p.arv_number),\n                   table.tdDate(p.birthdate),\n                   table.tdDate(p.dispensation_date)\n               ])\n            )\n            if (patients.length <= 0) return table.td(0)\n\n            return table.tdLink(patients.length, () => this.drilldownAsyncRows(context, columns, asyncRows))\n        },\n        setRows(gender: 'M' | 'F') {\n            const fullGender = gender === 'M' ? 'Males' : 'Females'\n            for(const ageIndex in AGE_GROUPS) {\n                const group = AGE_GROUPS[ageIndex]\n                const location = this.cohort['Location'];\n                if (!isEmpty(this.cohort) && group in this.cohort && ageIndex) {\n                    const data = this.cohort[group]\n                    this.total3hp = uniq([...this.total3hp, ...data['3HP_new'][gender], ...data['3HP_prev'][gender]])\n                    this.totalIpt = uniq([...this.totalIpt, ...data['6H_new'][gender], ...data['6H_prev'][gender]])\n                    this.rows.push([\n                        table.td(location),\n                        table.td(group),\n                        table.td(gender),\n                        this.drilldown(data['3HP_new'][gender], `${group} ${fullGender} New on 3HP`),\n                        this.drilldown(data['6H_new'][gender], `${group} ${fullGender} New on 6H`),\n                        this.drilldown(data['3HP_prev'][gender], `${group} ${fullGender} Previously on 3HP`),\n                        this.drilldown(data['6H_prev'][gender], `${group} ${fullGender} Previously on 6H`)\n                    ])\n                } else {\n                    this.rows.push([\n                        table.td(group),\n                        table.td(gender),\n                        table.td(0),\n                        table.td(0)\n                    ])\n                }\n            }\n        },\n        validateReport() {\n            const validations = {\n                'newly_initiated_on_3hp' : {\n                    param: this.total3hp.length,\n                    check: (i: number, p: number) => i != p,\n                    error: (i: number, p: number) => `\n                        Total newly initiated on <b>3HP(${p})</b> is not matching newly \n                        initiated on 3HP in Cohort report <b>(${i})</b>.\n                    `\n                },\n                'newly_initiated_on_ipt': {\n                    param: this.totalIpt.length,\n                    check: (i: number, p: number) => i != p,\n                    error: (i: number, p: number) => `\n                        Total newly initiated on IPT <b>(${p})</b> is not matching \n                        newly initiated on IPT in Cohort report <b>(${i})</b>.\n                    `\n                }\n            }\n            const s = this.mohCohort.validateIndicators(validations, (errors: string[]) => this.errors = errors)\n            if (s === -1) this.errors = ['Report not validated. Run the MoH cohort report for similar reporting period and then run this report']\n        }\n    }\n})\n","import { render } from \"./MohTptInitiationsReport.vue?vue&type=template&id=df1f66f2&ts=true\"\nimport script from \"./MohTptInitiationsReport.vue?vue&type=script&lang=ts\"\nexport * from \"./MohTptInitiationsReport.vue?vue&type=script&lang=ts\"\n\nimport exportComponent from \"/home/andrew-dev/Projects/HIS-Core/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { find } from \"lodash\";\nimport { ArtReportService } from \"./art_report_service\";\n\nexport enum CohortVar {\n    MOH_CACHE = 'mohCache'\n}\n\nexport interface CohortValidationInterface {\n    param: number | string;\n    error: (indicator: number, param: number) => string;\n    check: (indicator: number, param: number) => boolean;\n}\n\nexport class MohCohortReportService extends ArtReportService {\n    regenerate: boolean;\n    constructor() {\n        super()\n        this.regenerate = false\n    }\n\n    private cohortUrl() {\n        return `programs/${this.programID}/reports/cohort`\n    }\n\n    setRegenerate(regenerate: boolean) {\n        this.regenerate = regenerate\n    }\n\n    getCohortDrillDown(resourceId: string) {\n        return ArtReportService.getJson('cohort_report_drill_down', {\n            id: resourceId,\n            date: this.date,\n            'program_id': this.programID\n        })\n    }\n\n    requestCohort(params: any) {\n        return ArtReportService.ajxGet(\n            this.cohortUrl(), params\n        )\n    }\n\n    qaurterRequestParams() {\n        return { \n            name: this.quarter, \n            regenerate: this.regenerate \n        }\n    }\n\n    datePeriodRequestParams() {\n        return {\n            name: `Cohort-${this.startDate}-${this.endDate}`,\n            'start_date': this.startDate,\n            'end_date': this.endDate,\n            regenerate: this.regenerate\n        }\n    }\n\n    getCachedCohortValues() {\n        const cache = sessionStorage.getItem(CohortVar.MOH_CACHE)\n        if (cache) {\n            const conf = JSON.parse(cache)\n            if (conf.start_date === this.startDate \n                && conf.end_date === this.endDate\n                || conf.quarter === this.quarter) {\n                return conf.data\n            }\n        }\n    }\n\n    cacheCohort(values: any) {\n        sessionStorage.setItem(\n            CohortVar.MOH_CACHE, \n            JSON.stringify({\n                'start_date': this.startDate,\n                'end_date': this.endDate,\n                'quarter': this.quarter,\n                'data': values\n        }))\n    }\n\n    validateIndicators(validations: Record<string, CohortValidationInterface>, callback: Function) {\n        const cachedValues = this.getCachedCohortValues()\n        if (cachedValues) {\n            const errors = Object.keys(validations)\n                .reduce((errors: Array<any>, key: string) => {\n                    const indicator: any = find(cachedValues, { name: key })\n                    const validation: any = validations[key]\n                    const indicatorValue: any = indicator ? indicator.contents : null\n                    const param = validation.param as number\n                    const condition = validation.check(parseInt(indicatorValue), param)\n                    if (condition) errors.push(\n                        validation.error(indicatorValue, param)\n                    )\n                    return errors\n                }, [])\n            return callback(errors)\n        }\n        return -1\n    }\n}\n"],"sourceRoot":""}