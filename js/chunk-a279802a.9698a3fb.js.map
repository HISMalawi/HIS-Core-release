{"version":3,"sources":["webpack:///./src/views/MergeRollback.vue?3e33","webpack:///./src/views/MergeRollback.vue?ca2e","webpack:///./src/services/merging_service.ts","webpack:///./src/views/MergeRollback.vue","webpack:///./src/views/MergeRollback.vue?82e0"],"names":["_withId","_withScopeId","_pushScopeId","_hoisted_1","_createTextVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_popScopeId","render","_ctx","_cache","$props","$setup","$data","$options","_component_ion_text","_resolveComponent","_component_ion_title","_component_ion_toolbar","_component_ion_header","_component_ion_label","_component_ion_item","_component_ion_list","_component_report_table","_component_ion_content","_component_ion_button","_component_ion_footer","_component_ion_page","_openBlock","_createBlock","default","_createVNode","class","color","_toDisplayString","npid","_","lines","holderName","_Fragment","_renderList","patientInfo","item","index","key","label","value","config","tableCssTheme","columns","rows","onClick","cancel","size","slot","rollback","disabled","isReversible","MergingService","identifier","this","getJson","patientID","postJson","getProgramID","Service","defineComponent","components","IonText","IonPage","IonContent","IonToolbar","IonHeader","IonFooter","IonTitle","IonList","IonItem","IonLabel","IonButton","ReportTable","setup","route","useRoute","router","useRouter","ref","results","params","id","toUpperCase","table","thTxt","computed","length","back","alertConfirmation","toastDanger","onMounted","getMergeHistory","map","HisDate","toStandardHisDisplayFormat","td","tdDate","__exports__"],"mappings":"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","file":"js/chunk-a279802a.9698a3fb.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./MergeRollback.vue?vue&type=style&index=0&id=45cde8b0&scoped=true&lang=css\"","import { toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createBlock as _createBlock, withScopeId as _withScopeId, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\nconst _withId = /*#__PURE__*/_withScopeId(\"data-v-45cde8b0\")\n\n_pushScopeId(\"data-v-45cde8b0\")\nconst _hoisted_1 = /*#__PURE__*/_createTextVNode(\" Merge history \")\nconst _hoisted_2 = /*#__PURE__*/_createTextVNode(\"NPID Holder: \")\nconst _hoisted_3 = /*#__PURE__*/_createTextVNode(\" Person name \")\nconst _hoisted_4 = /*#__PURE__*/_createTextVNode(\"Transactions:\")\nconst _hoisted_5 = /*#__PURE__*/_createTextVNode(\" Cancel \")\nconst _hoisted_6 = /*#__PURE__*/_createTextVNode(\" Reverse \")\n_popScopeId()\n\nexport const render = /*#__PURE__*/_withId(function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_ion_text = _resolveComponent(\"ion-text\")\n  const _component_ion_title = _resolveComponent(\"ion-title\")\n  const _component_ion_toolbar = _resolveComponent(\"ion-toolbar\")\n  const _component_ion_header = _resolveComponent(\"ion-header\")\n  const _component_ion_label = _resolveComponent(\"ion-label\")\n  const _component_ion_item = _resolveComponent(\"ion-item\")\n  const _component_ion_list = _resolveComponent(\"ion-list\")\n  const _component_report_table = _resolveComponent(\"report-table\")\n  const _component_ion_content = _resolveComponent(\"ion-content\")\n  const _component_ion_button = _resolveComponent(\"ion-button\")\n  const _component_ion_footer = _resolveComponent(\"ion-footer\")\n  const _component_ion_page = _resolveComponent(\"ion-page\")\n\n  return (_openBlock(), _createBlock(_component_ion_page, null, {\n    default: _withId(() => [\n      _createVNode(_component_ion_header, null, {\n        default: _withId(() => [\n          _createVNode(_component_ion_toolbar, null, {\n            default: _withId(() => [\n              _createVNode(_component_ion_title, { class: \"his-lg-text\" }, {\n                default: _withId(() => [\n                  _createVNode(_component_ion_text, { color: \"danger\" }, {\n                    default: _withId(() => [\n                      _createTextVNode(_toDisplayString(_ctx.npid), 1 /* TEXT */)\n                    ]),\n                    _: 1\n                  }),\n                  _hoisted_1\n                ]),\n                _: 1\n              })\n            ]),\n            _: 1\n          })\n        ]),\n        _: 1\n      }),\n      _createVNode(_component_ion_content, null, {\n        default: _withId(() => [\n          _createVNode(_component_ion_title, { class: \"his-md-text his-card\" }, {\n            default: _withId(() => [\n              _hoisted_2\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_ion_list, null, {\n            default: _withId(() => [\n              _createVNode(_component_ion_item, {\n                lines: \"none\",\n                class: \"his-md-text\"\n              }, {\n                default: _withId(() => [\n                  _createVNode(_component_ion_label, null, {\n                    default: _withId(() => [\n                      _hoisted_3\n                    ]),\n                    _: 1\n                  }),\n                  _createVNode(\"b\", null, _toDisplayString(_ctx.holderName), 1)\n                ]),\n                _: 1\n              }),\n              (_openBlock(true), _createBlock(_Fragment, null, _renderList(_ctx.patientInfo, (item, index) => {\n                return (_openBlock(), _createBlock(_component_ion_item, {\n                  lines: \"none\",\n                  class: \"his-md-text\",\n                  key: index\n                }, {\n                  default: _withId(() => [\n                    _createVNode(_component_ion_label, null, {\n                      default: _withId(() => [\n                        _createTextVNode(_toDisplayString(item.label) + \": \", 1 /* TEXT */)\n                      ]),\n                      _: 2\n                    }, 1024),\n                    _createVNode(\"b\", null, _toDisplayString(item.value), 1)\n                  ]),\n                  _: 2\n                }, 1024))\n              }), 128 /* KEYED_FRAGMENT */))\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_ion_title, { class: \"his-md-text his-card\" }, {\n            default: _withId(() => [\n              _hoisted_4\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_report_table, {\n            config: { tableCssTheme: 'art-report-theme'},\n            columns: _ctx.columns,\n            rows: _ctx.rows\n          }, null, 8, [\"columns\", \"rows\"])\n        ]),\n        _: 1\n      }),\n      _createVNode(_component_ion_footer, null, {\n        default: _withId(() => [\n          _createVNode(_component_ion_toolbar, { color: \"dark\" }, {\n            default: _withId(() => [\n              _createVNode(_component_ion_button, {\n                onClick: _ctx.cancel,\n                color: \"danger\",\n                size: \"large\",\n                slot: \"start\"\n              }, {\n                default: _withId(() => [\n                  _hoisted_5\n                ]),\n                _: 1\n              }, 8, [\"onClick\"]),\n              _createVNode(_component_ion_button, {\n                onClick: _ctx.rollback,\n                disabled: !_ctx.isReversible,\n                color: \"success\",\n                size: \"large\",\n                slot: \"end\"\n              }, {\n                default: _withId(() => [\n                  _hoisted_6\n                ]),\n                _: 1\n              }, 8, [\"onClick\", \"disabled\"])\n            ]),\n            _: 1\n          })\n        ]),\n        _: 1\n      })\n    ]),\n    _: 1\n  }))\n})","import { Service } from \"./service\"\n\nexport interface MergeHistory {\n    id: number;\n    primary_id: number;\n    secondary_id: number;\n    merge_date: string;\n    merge_type: string;\n    primary_first_name: string;\n    primary_surname: string;\n    primary_gender: string;\n    primary_birthdate: string;\n    secondary_first_name: string;\n    secondary_surname: string;\n    secondary_gender: string;\n    secondary_birthdate: string;\n}\n\nexport class MergingService extends Service {\n    static getMergeHistory(identifier: string): Promise<MergeHistory[] | undefined> {\n        return this.getJson(`/rollback/merge_history`, {\n            identifier\n        })\n    }\n\n    static rollback(patientID: number) {\n        return this.postJson(`/rollback/rollback_patient`, {\n            'patient_id': patientID,\n            'program_id': this.getProgramID()\n        })\n    }\n}\n","\nimport { computed, defineComponent, onMounted, ref } from 'vue'\nimport {\n    IonPage,\n    IonContent,\n    IonToolbar,\n    IonHeader,\n    IonFooter,\n    IonTitle,\n    IonList,\n    IonItem,\n    IonText,\n    IonLabel,\n    IonButton\n} from \"@ionic/vue\"\nimport ReportTable from \"@/components/DataViews/tables/ReportDataTable.vue\"\nimport table from \"@/components/DataViews/tables/ReportDataTable\"\nimport { MergingService, MergeHistory } from \"@/services/merging_service\"\nimport { Option } from '@/components/Forms/FieldInterface'\nimport { useRoute, useRouter } from 'vue-router'\nimport { alertConfirmation, toastDanger } from '@/utils/Alerts'\nimport HisDate from \"@/utils/Date\"\n\nexport default defineComponent({\n    components: {\n        IonText,\n        IonPage,\n        IonContent,\n        IonToolbar,\n        IonHeader,\n        IonFooter,\n        IonTitle,\n        IonList,\n        IonItem,\n        IonLabel,\n        IonButton,\n        ReportTable\n    },\n    setup() {\n        const route = useRoute()\n        const router = useRouter()\n        const patientID = ref(-1)\n        const rows = ref([] as any)\n        const results = ref([] as MergeHistory[])\n        const npid = `${route.params.id}`.toUpperCase() as string\n        const holderName = ref('N/A' as string)\n        const patientInfo = ref([\n            { label: 'Birthdate', value: 'N/A'},\n            { label: 'Gender', value: 'N/A'},\n        ] as Option[])\n        const columns = [\n            [\n                table.thTxt('Merge type'),\n                table.thTxt('Merge date'),\n                table.thTxt('First Name'),\n                table.thTxt('Last name'),\n                table.thTxt('Birthdate'),\n                table.thTxt('Gender'),\n            ]\n        ]\n\n        const isReversible = computed(() => results.value.length > 0)\n\n        onMounted(async () => {\n            if (!npid) {\n                router.back()\n                return\n            }\n            try {\n                results.value = (await MergingService.getMergeHistory(npid) || [])\n            } catch (e) {\n                toastDanger(`Merge history not found for ${npid}`)\n            }\n            rows.value = results.value.map((item: MergeHistory) => {\n                if (patientID.value === -1) {\n                    patientID.value = item['secondary_id']\n                    holderName.value =`${item['secondary_first_name']} ${item['secondary_surname']}`\n                    patientInfo.value = [\n                        { label: 'Birthdate', value: HisDate.toStandardHisDisplayFormat(\n                            item['secondary_birthdate']\n                        )},\n                        { label: 'Gender', value: item['secondary_gender']},\n                    ]\n                }\n                return [\n                    table.td(item['merge_type']),\n                    table.tdDate(item['merge_date']),\n                    table.td(item['primary_first_name']),\n                    table.td(item['primary_surname']),\n                    table.tdDate(item['primary_birthdate']),\n                    table.td(item['primary_gender'])\n                ]\n            })\n        })\n\n        function cancel() {\n            router.back()\n        }\n\n        async function rollback() {\n            if ((await alertConfirmation('Are you sure you want to merge transactions'))) {\n                if ((await MergingService.rollback(patientID.value))) {\n                    router.back()\n                } else {\n                    toastDanger('Failed to rollback')\n                }\n            }\n        }\n\n        return {\n            cancel,\n            holderName,\n            isReversible,\n            patientInfo,\n            rollback,\n            columns,\n            rows,\n            npid\n        }\n    }\n})\n","import { render } from \"./MergeRollback.vue?vue&type=template&id=45cde8b0&scoped=true&ts=true\"\nimport script from \"./MergeRollback.vue?vue&type=script&lang=ts\"\nexport * from \"./MergeRollback.vue?vue&type=script&lang=ts\"\n\nimport \"./MergeRollback.vue?vue&type=style&index=0&id=45cde8b0&scoped=true&lang=css\"\n\nimport exportComponent from \"/home/daniel/local-repos/HIS-Core/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-45cde8b0\"]])\n\nexport default __exports__"],"sourceRoot":""}