(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5957b04e"],{"388f":function(e,t,o){},7101:function(e,t,o){"use strict";o.r(t);var a=o("7a23");const n=e=>(Object(a["pushScopeId"])("data-v-4fd660ab"),e=e(),Object(a["popScopeId"])(),e),c=n(()=>Object(a["createElementVNode"])("b",{style:{color:"#8b4513"}},"National ",-1)),s=n(()=>Object(a["createElementVNode"])("b",{style:{color:"#cd853f"}},"EMR",-1)),l={slot:"start"},i=["src"],r=["src"];function u(e,t,o,n,u,d){const p=Object(a["resolveComponent"])("ion-label"),b=Object(a["resolveComponent"])("ion-title"),O=Object(a["resolveComponent"])("ion-toolbar"),m=Object(a["resolveComponent"])("ion-header"),j=Object(a["resolveComponent"])("inputs"),f=Object(a["resolveComponent"])("ion-content"),h=Object(a["resolveComponent"])("ion-select-option"),g=Object(a["resolveComponent"])("ion-select"),v=Object(a["resolveComponent"])("ion-button"),y=Object(a["resolveComponent"])("ion-item"),w=Object(a["resolveComponent"])("ion-footer"),I=Object(a["resolveComponent"])("ion-page");return Object(a["openBlock"])(),Object(a["createBlock"])(I,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(m,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(O,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(b,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(p,{style:Object(a["normalizeStyle"])({fontWeight:"bolder",fontSize:"1.9em"})},{default:Object(a["withCtx"])(()=>[c,s]),_:1},8,["style"])]),_:1}),Object(a["createVNode"])(p,{class:"ion-padding",slot:"end"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Version: "),Object(a["createElementVNode"])("b",null,Object(a["toDisplayString"])(n.version),1)]),_:1})]),_:1})]),_:1}),Object(a["createVNode"])(f,{fullscreen:"false",style:{}},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(j,{useVirtualInput:n.useVirtualInputOnly},null,8,["useVirtualInput"])]),_:1}),Object(a["createVNode"])(w,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(O,null,{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("span",l,[Object(a["createElementVNode"])("img",{id:"coat",src:n.coatImg,alt:"Malawi Coat of Arms logo"},null,8,i),Object(a["createElementVNode"])("img",{id:"pepfar",src:n.pepfarImg,alt:"PEPFAR logo"},null,8,r)]),Object(a["createVNode"])(y,{class:"his-sm-text",style:{width:"45%"},slot:"end"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(p,null,{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])("Device Profile")]),_:1}),Object(a["createVNode"])(g,{modelValue:n.profile,"onUpdate:modelValue":t[0]||(t[0]=e=>n.profile=e),value:n.profile},{default:Object(a["withCtx"])(()=>[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(n.deviceProfiles,(e,t)=>(Object(a["openBlock"])(),Object(a["createBlock"])(h,{key:t,value:e.label},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","value"]),Object(a["createVNode"])(v,{color:"dark",fill:"outline",size:"large",slot:"end","router-link":"/settings/host"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(" Network ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const d={class:"main",ref:"main"},p={class:"rows"},b={class:"cells"},O=["readonly"],m={class:"rows input-rows"},j={class:"cells"},f=["readonly"],h={class:"rows"},g=["id"],v=["id"];function y(e,t,o,n,c,s){return Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],null,[Object(a["createElementVNode"])("div",d,[Object(a["createElementVNode"])("div",p,[Object(a["createElementVNode"])("div",b,[Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":t[0]||(t[0]=t=>e.userInput.username=t),onClick:t[1]||(t[1]=t=>e.renderKeyBoard(t)),class:"input-boxes",readonly:e.useVirtualInput},null,8,O),[[a["vModelText"],e.userInput.username]])])]),Object(a["createElementVNode"])("div",m,[Object(a["createElementVNode"])("div",j,[Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.userInput.password=t),type:"password",name:"password",ref:"password",id:"password",onClick:t[3]||(t[3]=t=>e.renderKeyBoard(t)),class:"input-boxes",placeholder:"Password",readonly:e.useVirtualInput},null,8,f),[[a["vModelText"],e.userInput.password]])])])],512),Object(a["createElementVNode"])("div",{id:"keyboard",style:Object(a["normalizeStyle"])(e.btnStyles),class:"keyboard"},[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.LOGIN_KEYBOARD,(o,n)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",{key:n},[Object(a["createElementVNode"])("div",h,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(o,o=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{class:"cells",key:o},["Next"===o||"Login"===o?(Object(a["openBlock"])(),Object(a["createElementBlock"])("button",{key:0,id:e.btnCaption,class:"keyboard-btn login-btn",onClick:t[4]||(t[4]=t=>e.keyPress(t))},Object(a["toDisplayString"])(e.btnCaption),9,g)):Object(a["createCommentVNode"])("",!0),"Login"!=o&&"Next"!=o?(Object(a["openBlock"])(),Object(a["createElementBlock"])("button",{key:1,id:e.Caps.on?o.toUpperCase():o.toLowerCase(),class:"keyboard-btn",onClick:t[5]||(t[5]=t=>e.keyPress(t))},Object(a["toDisplayString"])("Del."===o||"Caps"===o?o:e.Caps.on?o.toUpperCase():o.toLowerCase()),9,v)):Object(a["createCommentVNode"])("",!0)]))),128))])]))),128))],4)],64)}o("14d9");var w=o("b5e4"),I=o("89b4"),k=o("3800"),C=o("b432"),V=o("1c74"),N=o("8e3d"),x=o("b78f");const _=Object(N["a"])("IndexedDBStorage"),S=(Object(a["ref"])(0),[{key:"villages",endpoint:"villages"},{key:"traditional_authorities",endpoint:"traditional_authorities"},{key:"districts",endpoint:"districts"},{key:"regions",endpoint:"regions"},{key:"locations",endpoint:"locations"}]);async function B(){try{await Object(x["b"])()}catch(e){console.warn(e)}for(const t of S)if(!await _.existsinStorage(t.key))try{const e=await V["e"].getJson(t.endpoint,{paginate:!1});_.saveToStorage(t.key,e)}catch(e){console.warn(`Issue loading/saving metadata ${t}: ${e}`)}}var E=o("d867"),L=Object(a["defineComponent"])({props:{useVirtualInput:{type:Boolean}},data:function(){return{LOGIN_KEYBOARD:k["f"],auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new I["a"]},methods:{renderKeyBoard(e){this.focusInput=e.currentTarget,"password"==this.focusInput.id?this.btnCaption="Login":this.btnCaption="Next";let t=e.currentTarget.getBoundingClientRect().top;t=parseInt(t),this.keyboardTop=t+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(e){const t=e.currentTarget.id;let o;try{t.match(/Del./i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):t.match(/Next/i)?(this.display="none",o=this.$refs.password,o.click()):t.match(/Login/i)?(this.display="none",this.doLogin()):t.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",o="username"===this.focusInput.id?this.$refs.username:this.$refs.password,o.click()):t.match(/Hide/i)?this.display="none":this.focusInput.value+=t,"username"==this.focusInput.id?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(a){console.warn("input error")}},doLogin:async function(){if(this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!await this.auth.checkTimeIntegrity())throw"Local date does not match API date. Please Update your device's date";await this.auth.login(this.userInput.password),this.auth.startSession(),C["b"].value=!1,(await E["Y"].create({message:"Loading metadata, this may take a while...",backdropDismiss:!1})).present(),await B(),E["Y"].getTop().then(e=>e&&E["Y"].dismiss()),this.$router.push("/select_hc_location")}catch(e){e instanceof I["c"]?Object(w["e"])("Invalid username or password"):Object(w["c"])(""+e,5e4)}}else Object(w["e"])("Complete form to log in")}},computed:{btnStyles(){return`display: ${this.display}; top: ${this.keyboardTop};`}}}),P=(o("e91c"),o("d959")),T=o.n(P);const D=T()(L,[["render",y],["__scopeId","data-v-6b2d67e2"]]);var M=D,A=o("1718"),$=o("a1e9"),F=o("5c40"),U=o("2ed9"),R=o("2ef0"),Y={name:"login",components:{IonItem:E["w"],Inputs:M,IonButton:E["d"],IonTitle:E["S"],IonLabel:E["x"],IonPage:E["D"],IonHeader:E["q"],IonToolbar:E["T"],IonContent:E["n"],IonFooter:E["o"],IonSelect:E["L"],IonSelectOption:E["M"]},setup(){const{activePlatformProfile:e,platformProfiles:t}=Object(U["e"])(),o=Object($["s"])(""),n=Object($["s"])(""),c=Object(a["computed"])(()=>e.value.keyboard===U["b"].HIS_KEYBOARD_ONLY),s=Object.keys(t.value).map(e=>({label:e,value:{profileName:e,...t.value[e]}}));return Object(a["watch"])(n,t=>{e.value=(Object(R["find"])(s,{label:t})||{}).value}),Object(F["ob"])(async()=>{var t;const a=new I["a"];await a.loadConfig();const c=await a.getHeadVersion();a.setActiveVersion(c);const s=await a.getApiVersion();o.value=`${c} / ${s}`,n.value=(null===(t=e.value)||void 0===t?void 0:t.profileName)||""}),{version:o,profile:n,deviceProfiles:s,useVirtualInputOnly:c,activePlatformProfile:e,coatImg:Object(A["a"])("login-logos/Malawi-Coat_of_arms_of_arms.png"),pepfarImg:Object(A["a"])("login-logos/PEPFAR.png"),showConfig:"true"===localStorage.getItem("useLocalStorage")}}};o("fab2");const K=T()(Y,[["render",u],["__scopeId","data-v-4fd660ab"]]);t["default"]=K},"92f3":function(e,t,o){},b78f:function(e,t,o){"use strict";o.d(t,"b",(function(){return d})),o.d(t,"a",(function(){return p}));var a,n=o("1c74"),c=o("7a23"),s=o("cc74"),l=o("b5e4");(function(e){e["MinLinkageCode"]="min_linkage_code",e["MaxLinkageCode"]="max_linkage_code",e["SitePrefix"]="site_prefix"})(a||(a={}));const i=Object(c["ref"])(parseInt(localStorage.getItem(a.MinLinkageCode)||"0")),r=Object(c["ref"])(parseInt(localStorage.getItem(a.MaxLinkageCode)||"0")),u=Object(c["ref"])(localStorage.getItem(a.SitePrefix)||"FAC");async function d(){if(u.value=await s["b"].sitePrefix()||"FAC",localStorage.setItem(a.SitePrefix,u.value),r.value<=i.value){const e=await n["e"].getJson("next_hts_linkage_ids_batch");i.value=e.min_id,r.value=e.max_id,localStorage.setItem(a.MinLinkageCode,""+i.value),localStorage.setItem(a.MaxLinkageCode,""+r.value)}}async function p(){try{await d()}catch(e){console.warn(e)}return r.value>i.value?(--r.value,localStorage.setItem(a.MaxLinkageCode,""+r.value),`${u.value}-ITS-${r.value}`):(Object(l["e"])("Unable to generate linkage code"),"NaN")}},e91c:function(e,t,o){"use strict";o("388f")},fab2:function(e,t,o){"use strict";o("92f3")}}]);
//# sourceMappingURL=chunk-5957b04e.b151d9ab.js.map