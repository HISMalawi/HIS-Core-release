(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03e87f92"],{"72e3":function(e,t,n){"use strict";n.r(t);var r=n("7a23"),a={key:0,style:{color:"green"}},o={slot:"end"},c=Object(r["createTextVNode"])("add riskfactors"),i=Object(r["createVNode"])("h1",{style:{"text-align":"center"}},"Actions",-1),s=Object(r["createTextVNode"])(" cancel "),u=Object(r["createTextVNode"])(" Refer to clinician "),l=Object(r["createTextVNode"])(" Hypertension Diagnosis "),d=Object(r["createTextVNode"])(" Enroll in HTN "),b=Object(r["createTextVNode"])(" Finish ");function f(e,t,n,f,p,m){var h=Object(r["resolveComponent"])("ion-title"),v=Object(r["resolveComponent"])("ion-button"),g=Object(r["resolveComponent"])("ion-toolbar"),O=Object(r["resolveComponent"])("ion-header"),j=Object(r["resolveComponent"])("data-table"),k=Object(r["resolveComponent"])("ion-content"),x=Object(r["resolveComponent"])("ion-label"),w=Object(r["resolveComponent"])("ion-radio"),C=Object(r["resolveComponent"])("ion-item"),I=Object(r["resolveComponent"])("ion-col"),y=Object(r["resolveComponent"])("ion-row"),N=Object(r["resolveComponent"])("ion-grid"),T=Object(r["resolveComponent"])("ion-radio-group"),R=Object(r["resolveComponent"])("ion-footer"),D=Object(r["resolveComponent"])("ion-page");return Object(r["openBlock"])(),Object(r["createBlock"])(D,null,{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(O,null,{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(g,null,{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(h,null,{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])("span",null,"BP management screening on "+Object(r["toDisplayString"])(e.date),1),e.patientOnBPDrugs?(Object(r["openBlock"])(),Object(r["createBlock"])("small",a," (Patient already on BP drugs)")):Object(r["createCommentVNode"])("",!0)]})),_:1}),Object(r["createVNode"])("span",o,[e.totalRiskFactors>0?(Object(r["openBlock"])(),Object(r["createBlock"])(v,{key:0,color:"danger",onClick:e.showRiskFactors},{default:Object(r["withCtx"])((function(){return[Object(r["createTextVNode"])("View/Edit risk factors "+Object(r["toDisplayString"])(e.totalRiskFactors),1)]})),_:1},8,["onClick"])):Object(r["createCommentVNode"])("",!0),0===e.totalRiskFactors?(Object(r["openBlock"])(),Object(r["createBlock"])(v,{key:1,onClick:e.showRiskFactors},{default:Object(r["withCtx"])((function(){return[c]})),_:1},8,["onClick"])):Object(r["createCommentVNode"])("",!0)])]})),_:1})]})),_:1}),Object(r["createVNode"])(k,null,{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(j,{config:{showIndex:!1},columns:e.columns,rows:e.rows},null,8,["columns","rows"])]})),_:1}),Object(r["createVNode"])(R,null,{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(g,null,{default:Object(r["withCtx"])((function(){return[i,Object(r["createVNode"])(T,{modelValue:e.action,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.action=t})},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(N,null,{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(y,null,{default:Object(r["withCtx"])((function(){return[(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.items,(function(e,t){return Object(r["openBlock"])(),Object(r["createBlock"])(I,{size:"4",key:t},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(C,null,{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(x,{style:{"font-size":"1.0rem","font-weight":"bold"}},{default:Object(r["withCtx"])((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.label),1)]})),_:2},1024),Object(r["createVNode"])(w,{value:e},null,8,["value"])]})),_:2},1024)]})),_:2},1024)})),128))]})),_:1})]})),_:1})]})),_:1},8,["modelValue"])]})),_:1}),Object(r["createVNode"])(g,{color:"dark"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(v,{size:"large",color:"danger",slot:"start",onClick:e.gotoPatientDashboard},{default:Object(r["withCtx"])((function(){return[s]})),_:1},8,["onClick"]),e.showClinicianButton?(Object(r["openBlock"])(),Object(r["createBlock"])(v,{key:0,size:"large",color:"danger",slot:"start",onClick:e.referPatient},{default:Object(r["withCtx"])((function(){return[u]})),_:1},8,["onClick"])):Object(r["createCommentVNode"])("",!0),e.patientHasHyperTensionObs?Object(r["createCommentVNode"])("",!0):(Object(r["openBlock"])(),Object(r["createBlock"])(v,{key:1,size:"large",slot:"end",onClick:e.goToDiagnosis},{default:Object(r["withCtx"])((function(){return[l]})),_:1},8,["onClick"])),e.patientHasHyperTensionObs&&!e.isEnrolledInHTN?(Object(r["openBlock"])(),Object(r["createBlock"])(v,{key:2,size:"large",slot:"end",onClick:e.enrollInHTN},{default:Object(r["withCtx"])((function(){return[d]})),_:1},8,["onClick"])):Object(r["createCommentVNode"])("",!0),e.patientHasHyperTensionObs?(Object(r["openBlock"])(),Object(r["createBlock"])(v,{key:3,size:"large",color:"success",slot:"end",onClick:e.onFinish},{default:Object(r["withCtx"])((function(){return[b]})),_:1},8,["onClick"])):Object(r["createCommentVNode"])("",!0)]})),_:1})]})),_:1})]})),_:1})}var p=n("1da1"),m=(n("4de4"),n("d3b7"),n("ac1f"),n("466d"),n("b0c0"),n("d81d"),n("3ca3"),n("ddb0"),n("b64b"),n("99af"),n("a15b"),n("96cf"),n("8a30")),h=n("b5e4"),v=n("7365"),g=n("77fd"),O=n("7957"),j=n("8158"),k=n("1c74"),x=n("9283"),w=n("2ef0"),C=n("32b3"),I=n("c1e4"),y=n("ad60"),N=n("b515"),T=n("74f4"),R=n("80e3"),D=n("9ceb"),V=n("7f35"),P={background:"#444444"},B=Object(r["defineComponent"])({mixins:[v["a"]],components:{DataTable:R["a"],IonTitle:m["IonTitle"],IonToolbar:m["IonToolbar"],IonHeader:m["IonHeader"],IonContent:m["IonContent"],IonGrid:m["IonGrid"],IonRow:m["IonRow"],IonButton:m["IonButton"],IonRadioGroup:m["IonRadioGroup"],IonRadio:m["IonRadio"],IonCol:m["IonCol"],IonFooter:m["IonFooter"],IonPage:m["IonPage"],IonItem:m["IonItem"],IonLabel:m["IonLabel"]},data:function(){return{htn:{},hasARVNumber:!0,suggestedNumber:"",columns:[[D["a"].thTxt("Date",{style:P}),D["a"].thTxt("Systolic",{style:P}),D["a"].thTxt("Diastolic",{style:P}),D["a"].thTxt("BP Drugs",{style:P}),D["a"].thTxt("Action / Note",{style:P})]],bpGradeColorMap:{"N/A":"#ffffff",normal:"#ffffff","grade 1":"#FFC3CE","grade 2":"#F20056","grade 3":"#FF3333"},rows:[],riskFactors:[],action:null,trail:[],date:null,patientOnBPDrugs:!1,patientFirstVisit:!1,normatensive:!1,patientHasHyperTensionObs:!1,currentDrugs:[],items:[],isEnrolledInHTN:!1,isAliveOnHTN:!1,HTNProgramID:20,aliveState:160,refer:!1}},watch:{ready:{handler:function(e){var t=this;return Object(p["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,m["loadingController"].create({message:"Please wait...",backdropDismiss:!1});case 4:return r=n.sent,n.next=7,r.present();case 7:return t.htn=new C["a"](t.patientID,t.providerID),n.next=10,t.htn.getBPTrail();case 10:return t.trail=n.sent,t.rows=t.formatBpTrailRows(t.trail),t.normatensive=C["a"].isBpNormotensive(t.trail),n.next=15,t.getRiskFactors();case 15:return t.riskFactors=n.sent,t.date=x["c"].toStandardHisDisplayFormat(k["e"].getSessionDate()),n.next=19,t.isTransfered();case 19:return n.next=21,t.hasHyperTenstion();case 21:return n.next=23,t.getTreatmentStatus();case 23:return n.next=25,t.getProgramStatus();case 25:if(m["loadingController"].dismiss(),!t.patientFirstVisit||!t.patientOnBPDrugs){n.next=29;break}return n.next=29,t.alertTransferIn();case 29:t.getItems();case 30:case"end":return n.stop()}}),n)})))()},immediate:!0}},computed:{totalRiskFactors:function(){return this.riskFactors.filter((function(e){return"Yes"===e.value})).length},showClinicianButton:function(){return!(I["a"].isClinician()&&I["a"].isDoctor())}},methods:{onFinish:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){var n,r,a,o,c,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.action&&!e.refer){t.next=30;break}return t.next=3,e.htn.createEncounter();case 3:if(n=t.sent,n){t.next=6;break}return t.abrupt("return",Object(h["e"])("Unable to create encounter"));case 6:if(!e.refer){t.next=15;break}return t.next=9,e.htn.saveValueCodedObs("Refer patient to clinician","Yes");case 9:if(r=t.sent,r){t.next=12;break}return t.abrupt("return",Object(h["e"])("Unable to create Obs"));case 12:e.gotoPatientDashboard(),t.next=28;break;case 15:return t.next=17,e.htn.saveValueTextObs("Plan",e.action.label);case 17:if(c=t.sent,c){t.next=20;break}return t.abrupt("return",Object(h["e"])("Unable to create Obs"));case 20:return i={state:e.action.value},t.next=23,e.htn.enrollPatient(i);case 23:if("function"!==typeof(null===(a=e.action)||void 0===a||null===(o=a.other)||void 0===o?void 0:o.action)){t.next=27;break}return t.abrupt("return",e.action.other.action());case 27:e.nextTask();case 28:t.next=31;break;case 30:Object(h["e"])("Please select an action");case 31:case"end":return t.stop()}}),t)})))()},referPatient:function(){this.refer=!0,this.onFinish()},goToDiagnosis:function(){return this.$router.push({path:"/art/encounters/hypertension_diagnosis/".concat(this.patientID)})},hasHyperTenstion:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,O["a"].getFirstValueCoded(e.patientID,"Patient has hypertension");case 2:n=t.sent,e.patientHasHyperTensionObs=!!"".concat(n).match(/yes|no/i);case 4:case"end":return t.stop()}}),t)})))()},isTransfered:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,O["a"].getFirstValueCoded(e.patientID,"Transferred");case 2:n=t.sent,e.patientFirstVisit=!n;case 4:case"end":return t.stop()}}),t)})))()},getTreatmentStatus:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,O["a"].getFirstValueText(e.patientID,"Treatment status");case 2:n=t.sent,e.patientOnBPDrugs=!(!n||!n.match(/BP Drugs started/i));case 4:case"end":return t.stop()}}),t)})))()},getProgramStatus:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,y["a"].getPatientPrograms(e.patientID);case 2:if(n=t.sent,e.isEnrolledInHTN=n.filter((function(e){return"HYPERTENSION PROGRAM"===e.program.name})).length>0,!e.isEnrolledInHTN){t.next=7;break}return t.next=7,e.programState();case 7:case"end":return t.stop()}}),t)})))()},programState:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,y["a"].getPatientStates(e.patientID,e.HTNProgramID);case 2:n=t.sent,e.isAliveOnHTN=n.filter((function(e){return"Alive"===e.name})).length>0;case 4:case"end":return t.stop()}}),t)})))()},getRiskFactors:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=j["a"].getConceptsByCategory("risk factors"),r=n.map(function(){var t=Object(p["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,O["a"].getFirstValueCoded(e.patientID,n.name);case 2:return r=t.sent,t.abrupt("return",{concept:n.name,value:r});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.abrupt("return",Promise.all(r));case 3:case"end":return t.stop()}}),t)})))()},formatBpTrailRows:function(e){var t=this;return Object.keys(e).map((function(n){var r=x["c"].toStandardHisDisplayFormat(n);t.currentDrugs=t.currentDrugs.concat(e[n]["drugs"]);var a=function(){var r=C["a"].getBpGrade(parseInt(e[n].sbp),parseInt(e[n].dbp));return t.bpGradeColorMap[r]},o={background:a()};return[D["a"].tdDate(r,{style:o}),D["a"].td(e[n].sbp,{style:o}),D["a"].td(e[n].dbp,{style:o}),D["a"].td(e[n]["drugs"].join(", "),{style:o}),D["a"].td(e[n].note,{style:o})]}))},showRiskFactors:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,m["modalController"].create({component:g["a"],backdropDismiss:!1,cssClass:"large-modal",componentProps:{factors:e.riskFactors}});case 2:return n=t.sent,n.present(),t.next=6,n.onDidDismiss();case 6:r=t.sent,a=r.data,Object(w["isEmpty"])(a)||(e.riskFactors=a.map((function(e){var t=!0===e.isChecked?"Yes":"No";return{concept:e.concept,value:t}})));case 9:case"end":return t.stop()}}),t)})))()},alertTransferIn:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(V["a"])("Transfer in","Does the patient want to transfer in for HTN management?","",[{name:"Yes",slot:"end",color:"success"},{name:"No",slot:"start",color:"danger"}]);case 2:if(n=t.sent,"Yes"!==n){t.next=13;break}return t.next=6,e.enrollInHTN();case 6:return t.next=8,e.setHtnTransferred("Yes");case 8:return e.patientFirstVisit=!1,t.next=11,e.getItems();case 11:t.next=16;break;case 13:return t.next=15,e.setHtnTransferred("No");case 15:e.nextTask();case 16:case"end":return t.stop()}}),t)})))()},enrollInHTN:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n=new T["a"](e.patientID),n.setProgramId(e.HTNProgramID),n.setStateDate(y["a"].getSessionDate()),n.setStateId(e.aliveState),t.next=7,n.enrollProgram();case 7:return t.next=9,n.updateState();case 9:e.isEnrolledInHTN=!0,Object(h["d"])("Patient is now enrolled in HTN"),t.next=17;break;case 13:t.prev=13,t.t0=t["catch"](0),console.error(t.t0),Object(h["e"])(t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,13]])})))()},setHtnTransferred:function(e){var t=this;return Object(p["a"])(regeneratorRuntime.mark((function n(){var r,a,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=new N["a"](t.patientID,t.providerID),n.next=3,r.createEncounter();case 3:if(a=n.sent,a){n.next=8;break}Object(h["e"])("Unable to create patient transfer encounter"),n.next=12;break;case 8:return n.next=10,r.saveValueCodedObs("Transferred",e);case 10:o=n.sent,o||Object(h["e"])("Unable to create observation Transferred for patient");case 12:case"end":return n.stop()}}),n)})))()},getItems:function(){var e=this;return Object(p["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.currentDrugs.length>0?e.items=[{label:"Did not take prescribed drugs",value:"on treatment",other:{action:function(){return e.$router.push("/art/encounters/bp_adherence/".concat(e.patientID))}}},{label:"Continue drugs",value:"on treatment",other:{action:function(){return e.$router.push("/art/encounters/bp_adherence/".concat(e.patientID))}}},{label:"Review drugs",value:"on treatment",other:{action:function(){return e.$router.push("/art/encounters/bp_adherence/".concat(e.patientID,"?review=true"))}}}]:(e.items=[{label:"Lifestyle advice given",value:"Lifestyle changes only"},{label:"Not yet stable on ART",value:"Symptomatic but not in treatment"},{label:"Patient declining BP drugs ",value:"Symptomatic but not in treatment"}],e.normatensive&&e.items.push({label:"Return to annual screening",value:"Alive"}),e.items.push({label:"Start anti hypertensives",value:"On treatment",other:{action:function(){return e.$router.push("/art/encounters/bp_prescription/".concat(e.patientID))}}}));case 1:case"end":return t.stop()}}),t)})))()}}}),F=n("d959"),H=n.n(F);const E=H()(B,[["render",f]]);t["default"]=E},b515:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n("d4ec"),a=n("bee2"),o=n("262e"),c=n("2caf"),i=(n("ac1f"),n("466d"),n("99af"),n("d81d"),n("d3b7"),n("159b"),n("1276"),n("4de4"),n("b0c0"),n("cc6f")),s=n("2ef0"),u=function(e){Object(o["a"])(n,e);var t=Object(c["a"])(n);function n(e,a){return Object(r["a"])(this,n),t.call(this,e,6,a)}return Object(a["a"])(n,[{key:"isNotEmptyandNumber",value:function(e){return"".concat(e.value).match(/^-?\d+\.?\d*$/)?null:["Invalid entry for ".concat(e.label)]}},{key:"isNotEmptyandFloat",value:function(e){var t;return"".concat(e.value).match(/^\d{1,3}\.\d{1,5}$/)?null:["Invalid entry for ".concat(e.label,". Don't forget to add a decimal. e.g. 56.2 ").concat((null===(t=e.other)||void 0===t?void 0:t.modifier)||"")]}},{key:"checkMinMax",value:function(e,t,n){var r,a,o=[];parseFloat("".concat(e.value))<t&&o.push(["".concat(e.label," entered is less than minimum ").concat(t," ").concat((null===e||void 0===e||null===(r=e.other)||void 0===r?void 0:r.modifier)||"")]);parseFloat("".concat(e.value))>n&&o.push(["".concat(e.label," entered is greater than maximum ").concat(n," ").concat((null===e||void 0===e||null===(a=e.other)||void 0===a?void 0:a.modifier)||"")]);return o.length>0?o:null}},{key:"validateAll",value:function(e){var t=this,n=[];return e.map((function(e){var r=t.validator(e);return Object(s["isArray"])(r)?n.push(r):null})),n.length>0?n:null}},{key:"mergeErrors",value:function(e){var t=[];return e.forEach((function(e){Object(s["isArray"])(e)&&t.push(e)})),t.length>0?t:null}},{key:"isValidBPReading",value:function(e){var t=[],n="".concat(e.value).match(/^\d{1,3}\/\d{1,3}$/g)?null:["Invalid BP reading"];if(t.push(n),null==n){var r="".concat(e.value).split("/"),a={label:"Systolic",value:r[0]},o={label:"Diastolic",value:r[1]};t.push(this.checkMinMax(o,30,200)),t.push(this.checkMinMax(a,40,250))}return this.mergeErrors(t)}},{key:"validator",value:function(e){var t=this,n=[{name:"Weight",validator:function(e){var n=t.isNotEmptyandFloat(e),r=t.checkMinMax(e,2,250);return t.mergeErrors([n,r])}},{name:"Height",validator:function(e){var n=[];return n.push(t.isNotEmptyandNumber(e)),n.push(t.checkMinMax(e,40,220)),t.mergeErrors(n)}},{name:"BP",validator:function(e){return t.isValidBPReading(e)}},{name:"Temp",validator:function(e){var n=t.isNotEmptyandNumber(e),r=t.checkMinMax(e,30,42);return t.mergeErrors([n,r])}},{name:"SP02",validator:function(e){var n=t.checkMinMax(e,40,100);return t.mergeErrors([n])}},{name:"Pulse",validator:function(e){var n=t.checkMinMax(e,50,120);return t.mergeErrors([n])}}],r=n.filter((function(t){return t.name===e.label}));return r.length>0?r[0].validator(e):null}}]),n}(i["a"])}}]);
//# sourceMappingURL=chunk-03e87f92.c80d8908.js.map