(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-64c63d9f"],{"113a":function(e,t,a){},"1c3d":function(e,t,a){},"32b3":function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return r}));var i,n=a("cc6f"),s=a("7957");(function(e){e["Prescription"]="htnPrescription"})(i||(i={}));class r extends n["a"]{constructor(e,t){super(e,48,t)}static getBpGrade(e,t){return e<140&&t<90?"normal":e>=140&&e<160||t>=100&&t<110?"grade 1":e>=180&&t>110||e>=180?"grade 3":e>=160&&e<180||t>=110?"grade 2":"N/A"}static isBpNormotensive(e){const[t,a]=Object.values(e).sort((e,t)=>e.date<t.date?1:0).map(e=>this.getBpGrade(e.sbp,e.dbp));return"normal"===t&&"normal"===a}getSystolicBp(){return s["a"].getFirstValueNumber(this.patientID,"Systolic blood pressure")}getDiastolicBp(){return s["a"].getFirstValueNumber(this.patientID,"Diastolic blood pressure")}async onBpDrugs(){const e=await s["a"].getFirstValueCoded(this.patientID,"Treatment status");return!!e&&"Yes"===e}async getBPTrail(){return await n["a"].getJson(`/patients/${this.patientID}/bp_trail`)}async getCurrentDrugs(){return await n["a"].getJson(`/patients/${this.patientID}/current_bp_drugs`)}async getLastDrugs(){return await n["a"].getJson(`/patients/${this.patientID}/last_bp_drugs_dispensation`)}async getAdherence(e,t){return await n["a"].postJson(`/patients/${this.patientID}/remaining_bp_drugs`,{drug_id:e,pills:t})}async enrollPatient(e){return await n["a"].postJson(`/patients/${this.patientID}/update_or_create_htn_state`,e)}static htnDrugReferences(){return[{drug_id:275,drug_name:"HCZ (25mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:942,drug_name:"Enalapril (5mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:943,drug_name:"Enalapril (10mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:558,drug_name:"Amlodipine (5mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:559,drug_name:"Amlodipine (10mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:117,drug_name:"Atenolol (50mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"},{drug_id:11,drug_name:"Atenolol(100mg tablet)",units:"tab(s)",am:0,noon:0,pm:1,frequency:"Daily (QOD)"}]}getDrugs(){return{HCZ:{drugs:[{drugName:"HCZ (25mg tablet)",drugID:275,amount:"25mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null}],selected:null,notes:[]},Enalapril:{drugs:[{drugName:"Enalapril (5mg tablet)",drugID:942,amount:"5mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Enalapril (10mg tablet)",drugID:943,amount:"10mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]},Amlodipine:{drugs:[{drugName:"Amlodipine (5mg tablet)",drugID:558,amount:"5mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Amlodipine (10mg tablet)",drugID:559,amount:"10mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]},Atenolol:{drugs:[{drugName:"Atenolol (50mg tablet)",drugID:117,amount:"50mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null},{drugName:"Atenolol(100mg tablet)",drugID:11,amount:"100mg",current:!1,selected:!1,isChecked:!1,dispensed:null,expectedRemaining:null,adherence:null,remaining:null}],selected:null,notes:[]}}}}},3800:function(e,t,a){"use strict";a.d(t,"d",(function(){return i})),a.d(t,"l",(function(){return n})),a.d(t,"e",(function(){return s})),a.d(t,"b",(function(){return r})),a.d(t,"k",(function(){return o})),a.d(t,"i",(function(){return l})),a.d(t,"g",(function(){return c})),a.d(t,"a",(function(){return d})),a.d(t,"j",(function(){return u})),a.d(t,"c",(function(){return h})),a.d(t,"h",(function(){return p})),a.d(t,"f",(function(){return g}));const i=[["1","2","3"],["4","5","6"],["7","8","9"],[".","0","Del"],["","Done",""]],n=[["1","2","3"],["4","5","6"],["7","8","9"],[".","0","Del"],["Clear","%","/"]],s=[["1","2","3"],["4","5","6"],["7","8","9"],["Del.","0","Clear"]],r=[["1","2","3","<"],["4","5","6",">"],["7","8","9","="],["","0",""]],o=[["1","2","3","+","-","/","*"],["4","5","6","%","=","<",">","Qwerty"],["7","8","9",".",","],["","0",""]],l=[["1","2","3"],["4","5","6"],["7","8","9"],["","0",""]],c=[["1","2","3","4","5","6","7"],["8","9","10","11","12","13","14"],["15","16","17","18","19","20","21"],["22","23","24","25","26","27","28"],["29","30","31"]],d=[["a","b","c","d","e","f","g","h","."],["i","j","k","l","m","n","o","p","q"],["r","s","t","u","v","w","x","y","z"]],u=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l","'"],["z","x","c","v","b","n","m",",",".","A-Z"]],h=[["1","2","3","4","5","6","7","8","9","0"],["a","b","c","d","e","f","g","h","-","."],["i","j","k","l","m","n","o","p","q"],["r","s","t","u","v","w","x","y","z"]],p=[["1","2","3","4","5","6","7","8","9","0","Del"],["q","w","e","r","t","y","u","i","o","p","Clear"],["a","s","d","f","g","h","j","k","l",".","Caps"],["z","x","c","v","b","n","m","<",">","/","Enter"]],g=[["1","2","3","4","5","6","7","8","9","0"],["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l","Del."],["z","x","c","v","b","n","m","Caps","Login"]]},"3b8c":function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));a("13d5");var i=a("cc6f"),n=a("7957"),s=a("5a0c"),r=a.n(s),o=a("2ef0"),l=a("71c3");class c extends i["a"]{constructor(e,t){super(e,53,t)}getFamilyPlanningMethods(){return["ORAL CONTRACEPTIVE PILLS","DEPO-PROVERA","INTRAUTERINE CONTRACEPTION","CONTRACEPTIVE IMPLANT","MALE CONDOMS","FEMALE CONDOMS","TUBAL LIGATION","NONE"]}async hasCompleteTptDispensations(){try{const e=await l["a"].getAllDrugOrders(this.patientID),{rifapentine:t,isoniazid:a}=e.reduce((e,t)=>{const a=t.drug.name;return a.match(/Isoniazid/i)&&(e["isoniazid"]+=t.quantity),a.match(/Rifapentine/i)&&(e["rifapentine"]+=t.quantity),e},{rifapentine:0,isoniazid:0});return a>=168||a>=36&&t>=72}catch(e){return console.error(e),!1}}async patientHitMenopause(){const e=await n["a"].getFirstObs(this.patientID,"Why does the woman not use birth control");return!(!e||"string"!==typeof(null===e||void 0===e?void 0:e.value_text))&&(!!e.value_text.match(/menopause/i)&&i["a"].obsInValidPeriod(e))}async hasTreatmentHistoryObs(){const e=await n["a"].getFirstObs(this.patientID,"Previous TB treatment history");return e&&i["a"].obsInValidPeriod(e)}async patientCompleted3HP(){const e=await n["a"].getFirstObs(this.patientID,"Previous TB treatment history");return!!(e&&"string"===typeof e.value_text&&i["a"].obsInValidPeriod(e)&&e.value_text.match(/complete/i))}getDrugSideEffects(){return i["a"].getJson(`programs/${i["a"].getProgramID()}/patients/${this.patientID}/medication_side_effects`,{date:this.date})}getClient(){return i["a"].getFirstValueCoded(this.patientID,"Patient present")}async clientDueForCxCa(){const e=await i["a"].getJson("last_cxca_screening_details",{id:this.patientID,date:this.date});if(!Object(o["isEmpty"])(e)){const t=e["date_screened"],a=r()(this.date).diff(t,"years");return a>=1}return!0}async clientHasHadAHysterectomy(){const e=await i["a"].getFirstValueCoded(this.patientID,"Reason for NOT offering CxCa");if("Hysterectomy"===e)return!0;const t=await i["a"].getFirstValueText(this.patientID,"Treatment");return"Hysterectomy"===t}async getTLObs(){const e=e=>e&&"Tubal ligation"===e.value_coded&&i["a"].obsInValidPeriod(e),t=await i["a"].getFirstObs(this.patientID,"Family planning");if(e(t))return e(t);{const t=await i["a"].getFirstObs(this.patientID,"Method of family planning");return e(t)}}async getPreviousDrugs(){const e=await i["a"].getJson(`patients/${this.patientID}/drugs_received`);if(!e)return;const t={};return e.forEach(e=>{t[e.drug_inventory_id]=e}),t}familyPlanningMethods(e,t){const a={"ORAL CONTRACEPTIVE PILLS":{"DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","CONTRACEPTIVE IMPLANT":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"DEPO-PROVERA":{"ORAL CONTRACEPTIVE PILLS":"N","INTRAUTERINE CONTRACEPTION":"N","CONTRACEPTIVE IMPLANT":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"INTRAUTERINE CONTRACEPTION":{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","CONTRACEPTIVE IMPLANT":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"CONTRACEPTIVE IMPLANT":{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"MALE CONDOMS":{"ORAL CONTRACEPTIVE PILLS":"Y","DEPO-PROVERA":"Y","INTRAUTERINE CONTRACEPTION":"Y","CONTRACEPTIVE IMPLANT":"Y","FEMALE CONDOMS":"Y","RYTHM METHOD":"Y","TUBAL LIGATION":"N",VASECTOMY:"Y"},"FEMALE CONDOMS":{"ORAL CONTRACEPTIVE PILLS":"Y","DEPO-PROVERA":"Y","INTRAUTERINE CONTRACEPTION":"Y","CONTRACEPTIVE IMPLANT":"Y","MALE CONDOMS":"Y","RYTHM METHOD":"Y","TUBAL LIGATION":"N",VASECTOMY:"Y"},"RYTHM METHOD":{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"Y","CONTRACEPTIVE IMPLANT":"N","TUBAL LIGATION":"N",VASECTOMY:"N"},"TUBAL LIGATION":{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"N","FEMALE CONDOMS":"N","CONTRACEPTIVE IMPLANT":"N","RYTHM METHOD":"N",VASECTOMY:"N"},VASECTOMY:{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"Y","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"Y","FEMALE CONDOMS":"N","CONTRACEPTIVE IMPLANT":"Y","RYTHM METHOD":"N","TUBAL LIGATION":"N"},NONE:{"ORAL CONTRACEPTIVE PILLS":"N","DEPO-PROVERA":"N","INTRAUTERINE CONTRACEPTION":"N","MALE CONDOMS":"N","FEMALE CONDOMS":"N","CONTRACEPTIVE IMPLANT":"N","RYTHM METHOD":"N","TUBAL LIGATION":"N"}},i=a[e];return t.map(e=>"N"===i[e.label]?{label:e.label,value:e.value,isChecked:!1,disabled:!0}:{label:e.label,value:e.value,isChecked:e.isChecked,disabled:!1})}}},"5f2c":function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var i=a("cc6f"),n=a("71c3"),s=(a("13d5"),a("1c74"));class r extends s["e"]{constructor(){super()}static async fetchAvailableDrugStock(e){const t=await this.getJson("pharmacy/items",{drug_id:e});if(t&&t.length>0)return t.reduce((e,t)=>e+t.current_quantity,0)}}var o=a("d1ca");const l={11:[30],21:[25],22:[60],24:[30,60,90,100],30:[90],39:[60],73:[120],74:[60],76:[1e3],297:[30,60,90],576:[30,60,90],613:[60],731:[60],732:[60],733:[60],734:[30],735:[30],736:[60],738:[60],931:[30,60,90],932:[30],954:[60],963:[30,60,90],968:[60],969:[30],971:[30,60,90],976:[60],977:[30],982:[30],983:[30,90],1039:[30,60,90],1043:[60],1044:[30],1056:[24],1216:[3,6,12]};class c extends i["a"]{constructor(e,t){super(e,54,t),this.drugHistory=[],this.currentDrugOrder=[],this.useDrugManagement=!1}setIsDrugManagementEnabled(e){this.useDrugManagement=e}async loadDrugManagementEnabled(){this.useDrugManagement=await o["b"].drugManagementEnabled()}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}buildDispensations(e,t,a){const i=[];for(let n=0;n<a;n++)i.push({drug_order_id:e,date:this.date,quantity:t/a});return i}saveDispensations(e){return i["a"].postJson("/dispensations",{dispensations:e,program_id:i["a"].getProgramID()})}async voidOrder(e){return i["a"].void("/dispensations/"+e,{})}async loadDrugHistory(){try{const e=await n["a"].getDrugOrderHistory(this.patientID);e&&(this.drugHistory=e)}catch(e){console.warn(e)}}async loadCurrentDrugOrder(){const e=await n["a"].getDrugOrders(this.patientID);if(e){if(this.useDrugManagement){const t=e.map(async e=>(e["available_stock"]=await r.fetchAvailableDrugStock(e.drug.drug_id),e));return void(this.currentDrugOrder=await Promise.all(t))}this.currentDrugOrder=e}}getDrugPackSizes(e){return e in l?l[e]:[30,60,90]}calcCompletePack(e,t){const a=e.barcodes.sort((e,t)=>e.tabs-t.tabs);if(0==a.length||0==t)return t;for(const n in a){const{tabs:e}=a[n];if(parseInt(e)>=t)return e}const i=parseInt(a[a.length-1].tabs);return i}}},"6be2":function(e,t,a){"use strict";a.d(t,"d",(function(){return s})),a.d(t,"g",(function(){return r})),a.d(t,"f",(function(){return o})),a.d(t,"e",(function(){return l})),a.d(t,"c",(function(){return c})),a.d(t,"b",(function(){return d})),a.d(t,"h",(function(){return h})),a.d(t,"a",(function(){return p}));var i=a("3800");const n=[i["k"],[["","Delete"]]],s=[i["i"],[["Delete"]]],r=[i["i"],[["Delete","Unknown"]]],o=[i["i"],[["N/A"],["Delete","Unknown"]]],l=[i["i"],[["Delete"]]],c=[i["i"],[["Unknown","Delete"],["Qwerty","A-Z"]]],d=[i["g"],[["Unknown"]]],u=[i["a"],[["0-9","Delete"],["Qwerty","Unknown"],["","Space"]]],h=[i["j"],[["","Delete"],["?123","0-9"],["Space","Unknown"]]],p=[{btn:"0-9",keyboard:c},{btn:"?123",keyboard:n},{btn:"A-Z",keyboard:u},{btn:"Qwerty",keyboard:h}]},"6c3f":function(e,t,a){"use strict";a.r(t);var i=a("7a23");function n(e,t,a,n,s,r){const o=Object(i["resolveComponent"])("his-standard-form");return Object(i["openBlock"])(),Object(i["createBlock"])(o,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}a("caad"),a("13d5");var s=a("d95e"),r=a("7920"),o=a("2706"),l=a("b5e4"),c=a("9283"),d=a("2ef0"),u=a("3b8c"),h=a("c1e4"),p=a("9b7c"),g=a("8158"),m=a("fe96"),b=a("8a30");const f=Object(i["withScopeId"])("data-v-10a26cd2");Object(i["pushScopeId"])("data-v-10a26cd2");const O=Object(i["createTextVNode"])("VL milestone has been reached"),T=Object(i["createTextVNode"])(" Order VL"),v=Object(i["createTextVNode"])(" Wait till next milestone"),y=Object(i["createTextVNode"])(" Remind me later ");Object(i["popScopeId"])();const C=f((function(e,t,a,n,s,r){const o=Object(i["resolveComponent"])("ion-title"),l=Object(i["resolveComponent"])("ion-toolbar"),c=Object(i["resolveComponent"])("ion-header"),d=Object(i["resolveComponent"])("ion-content"),u=Object(i["resolveComponent"])("ion-button"),h=Object(i["resolveComponent"])("ion-footer");return Object(i["openBlock"])(),Object(i["createBlock"])(i["Fragment"],null,[Object(i["createVNode"])(c,null,{default:f(()=>[Object(i["createVNode"])(l,null,{default:f(()=>[Object(i["createVNode"])(o,null,{default:f(()=>[O]),_:1})]),_:1})]),_:1}),Object(i["createVNode"])(d,{style:{overflowY:"hidden",background:"grey"}},{default:f(()=>[Object(i["createVNode"])("p",null,"ART start date : "+Object(i["toDisplayString"])(e.artStartDate),1),Object(i["createVNode"])("p",null,"Months on ART: "+Object(i["toDisplayString"])(e.monthsOnART),1),Object(i["createVNode"])("p",null,"Last VL order date "+Object(i["toDisplayString"])(e.lastOrder),1),Object(i["createVNode"])("p",null,"Current regimen / start date: "+Object(i["toDisplayString"])(e.currentRegimen)+" - "+Object(i["toDisplayString"])(e.regimenStartDate),1)]),_:1}),Object(i["createVNode"])(h,null,{default:f(()=>[Object(i["createVNode"])(l,null,{default:f(()=>[Object(i["createVNode"])(u,{slot:"end",color:"success",size:"large",onClick:t[1]||(t[1]=t=>e.closeModal("order"))},{default:f(()=>[T]),_:1}),Object(i["createVNode"])(u,{slot:"end",size:"large",onClick:t[2]||(t[2]=t=>e.closeModal("wait"))},{default:f(()=>[v]),_:1}),Object(i["createVNode"])(u,{slot:"start",color:"danger",size:"large",onClick:t[3]||(t[3]=t=>e.closeModal("later"))},{default:f(()=>[y]),_:1})]),_:1})]),_:1})],64)}));var _=Object(i["defineComponent"])({name:"Modal",props:{VLData:{type:Object,required:!0}},async created(){this.artStartDate=c["b"].toStandardHisDisplayFormat(this.VLData.earliest_start_date),this.monthsOnART=this.VLData.period_on_art,this.lastOrder=this.VLData.last_order_date?c["b"].toStandardHisDisplayFormat(this.VLData.last_order_date):"N/A",this.currentRegimen=this.VLData.current_regimen.name?this.VLData.current_regimen.name:"Other",this.regimenStartDate=c["b"].toStandardHisDisplayFormat(this.VLData.current_regimen.date_started)},methods:{async closeModal(e){await b["X"].dismiss(e)}},data(){return{content:"Content",artStartDate:"",monthsOnART:"",lastOrder:"",currentRegimen:"",regimenStartDate:""}},components:{IonHeader:b["q"],IonToolbar:b["Q"],IonTitle:b["P"],IonContent:b["n"],IonFooter:b["o"],IonButton:b["d"]}}),D=(a("d42f"),a("6b0d")),E=a.n(D);const N=E()(_,[["render",C],["__scopeId","data-v-10a26cd2"]]);var I=N,P=a("ad60"),A=a("cc6f");class S extends A["a"]{constructor(e,t){super(e,13,t)}async buildDefferedOrder(e){const t=await A["a"].getConceptID("HIV viral load"),a=await A["a"].getConceptID("Delayed milestones");return[{concept_id:t,value_text:"Wait till next milestone",value_coded:a,value_numeric:e}]}}var w=a("7f35");const V=Object(i["withScopeId"])("data-v-546674a2");Object(i["pushScopeId"])("data-v-546674a2");const R=Object(i["createTextVNode"])("Side effects suspected causes"),x={style:{}},L=Object(i["createVNode"])("div",{class:"side-title"}," Select reason ",-1),M=Object(i["createVNode"])("p",null,"Current Medication",-1),k=Object(i["createVNode"])("p",null,"Previous Medication",-1),j=Object(i["createTextVNode"])("Other, not drug related"),F=Object(i["createTextVNode"])("Drug side effect"),H=Object(i["createVNode"])("p",null,null,-1),B=Object(i["createTextVNode"])(" Close "),Y=Object(i["createTextVNode"])(" Save ");Object(i["popScopeId"])();const U=V((function(e,t,a,n,s,r){const o=Object(i["resolveComponent"])("ion-title"),l=Object(i["resolveComponent"])("ion-toolbar"),c=Object(i["resolveComponent"])("ion-header"),d=Object(i["resolveComponent"])("ion-label"),u=Object(i["resolveComponent"])("ion-item"),h=Object(i["resolveComponent"])("ion-list"),p=Object(i["resolveComponent"])("ion-col"),g=Object(i["resolveComponent"])("ion-radio"),m=Object(i["resolveComponent"])("ion-radio-group"),b=Object(i["resolveComponent"])("ion-row"),f=Object(i["resolveComponent"])("ion-grid"),O=Object(i["resolveComponent"])("ion-content"),T=Object(i["resolveComponent"])("ion-button"),v=Object(i["resolveComponent"])("ion-footer");return Object(i["openBlock"])(),Object(i["createBlock"])(i["Fragment"],null,[Object(i["createVNode"])(c,null,{default:V(()=>[Object(i["createVNode"])(l,null,{default:V(()=>[Object(i["createVNode"])(o,null,{default:V(()=>[R]),_:1})]),_:1})]),_:1}),Object(i["createVNode"])(O,{style:{overflowY:"hidden",background:"grey"}},{default:V(()=>[Object(i["createVNode"])(f,null,{default:V(()=>[Object(i["createVNode"])(b,null,{default:V(()=>[Object(i["createVNode"])(p,{size:"4"},{default:V(()=>[Object(i["createVNode"])(h,{style:{overflowY:"auto",height:"78vh"}},{default:V(()=>[(Object(i["openBlock"])(!0),Object(i["createBlock"])(i["Fragment"],null,Object(i["renderList"])(e.sides,(t,a)=>(Object(i["openBlock"])(),Object(i["createBlock"])(u,{key:t,onClick:t=>e.selectSideEffect(a),detail:!0,style:e.activeIndex===a?"color: green":"color: black"},{default:V(()=>[Object(i["createVNode"])(d,null,{default:V(()=>[Object(i["createTextVNode"])(Object(i["toDisplayString"])(t.label),1)]),_:2},1024)]),_:2},1032,["onClick","style"]))),128))]),_:1})]),_:1}),Object(i["createVNode"])(p,{style:{overflowY:"auto",height:"78vh"}},{default:V(()=>[Object(i["createVNode"])("div",x,[Object(i["createVNode"])(h,null,{default:V(()=>[null!==e.activeIndex?(Object(i["openBlock"])(),Object(i["createBlock"])(m,{key:0,modelValue:e.sides[e.activeIndex]["reason"],"onUpdate:modelValue":t[1]||(t[1]=t=>e.sides[e.activeIndex]["reason"]=t)},{default:V(()=>[L,M,(Object(i["openBlock"])(!0),Object(i["createBlock"])(i["Fragment"],null,Object(i["renderList"])(e.drugs,(e,t)=>(Object(i["openBlock"])(),Object(i["createBlock"])(u,{key:t},{default:V(()=>[Object(i["createVNode"])(d,null,{default:V(()=>[Object(i["createTextVNode"])(Object(i["toDisplayString"])(e.drug.name),1)]),_:2},1024),Object(i["createVNode"])(g,{slot:"start",value:e.drug_inventory_id},null,8,["value"])]),_:2},1024))),128)),k,Object(i["createVNode"])(u,null,{default:V(()=>[Object(i["createVNode"])(d,null,{default:V(()=>[j]),_:1}),Object(i["createVNode"])(g,{slot:"start",value:"other"})]),_:1}),Object(i["createVNode"])(u,null,{default:V(()=>[Object(i["createVNode"])(d,null,{default:V(()=>[F]),_:1}),Object(i["createVNode"])(g,{slot:"start",value:"drug"})]),_:1})]),_:1},8,["modelValue"])):Object(i["createCommentVNode"])("",!0)]),_:1})]),H]),_:1})]),_:1})]),_:1})]),_:1}),Object(i["createVNode"])(v,null,{default:V(()=>[Object(i["createVNode"])(l,null,{default:V(()=>[Object(i["createVNode"])(T,{onClick:e.closeModal,slot:"end",color:"danger"},{default:V(()=>[B]),_:1},8,["onClick"]),Object(i["createVNode"])(T,{onClick:e.postSideEffects,slot:"end",disabled:!e.allSelected},{default:V(()=>[Y]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})],64)}));var q=Object(i["defineComponent"])({name:"Modal",props:{sideEffects:{type:Object,required:!0},drugs:{type:Array,default:[]}},methods:{closeModal(){b["X"].dismiss()},async postSideEffects(){await b["X"].dismiss(this.sides)},selectSideEffect(e){this.activeIndex=e}},computed:{allSelected(){return this.sides.filter(e=>e["reason"]).length===this.sides.length}},mounted(){this.sides=this.sideEffects},data(){return{content:"Content",extendedLabsEnabled:!1,appActivities:[],sides:[],specimens:[],reasons:["Routine","Targeted","Confirmatory","Stat","Repeat / Missing"],activeIndex:null}},components:{IonButton:b["d"],IonContent:b["n"],IonHeader:b["q"],IonTitle:b["P"],IonToolbar:b["Q"],IonLabel:b["x"],IonList:b["y"],IonItem:b["w"],IonRadioGroup:b["F"],IonRow:b["H"]}});a("e96c");const $=E()(q,[["render",U],["__scopeId","data-v-546674a2"]]);var J=$,W=a("d1ca"),G=a("b446"),z=a("9ceb"),Q=a("8df6"),X=a("dac2"),Z=a("5f2c"),K=a("4db7"),ee=a("8e8b"),te=Object(i["defineComponent"])({mixins:[m["a"]],components:{HisStandardForm:r["a"]},data:()=>({fields:[],currentWeight:-1,weightTrail:[],customRegimens:[],labOrders:[],weightLossPercentageNum:0,lostTenPercentBodyWeight:!1,CxCaEnabled:!1,CxCaStartAge:-1,CxCaMaxAge:-1,DueForCxCa:!1,currentlyPregnant:!1,patientHitMenopause:!1,hasPregnancyObsToday:!1,autoSelect3HP:!1,labOrderFieldContext:{},consultation:{},prescription:{},dispensation:{},completed3HP:!1,hasTbHistoryObs:!1,allergicToSulphur:!1,TBSuspected:!1,presentedTBSymptoms:!1,askAdherence:!1,lastDrugsReceived:[],sideEffectsHistory:{},onPermanentFPMethods:!1,reasonForDecliningTPTObs:{},malawiSideEffectReasonObs:[],otherSideEffectReasonObs:[],wasTransferredIn:!1,dateStartedArt:"",clientHadAHysterectomy:!1,isNoneClientPatient:!1}),watch:{ready:{handler(e){e&&(this.consultation=new u["a"](this.patientID,this.providerID),this.prescription=new X["a"](this.patientID,this.providerID),this.dispensation=new Z["a"](this.patientID,this.providerID),this.fields=this.getFields())},immediate:!0}},methods:{async onFinish(e,t){const a=await this.consultation.createEncounter();if(!a)return Object(l["e"])("Unable to create encounter");const i=await this.resolveObs(t,"consultation"),n=(await Promise.all([...this.malawiSideEffectReasonObs,...this.otherSideEffectReasonObs,this.reasonForDecliningTPTObs])).filter(e=>!Object(d["isEmpty"])(e)),s=await this.consultation.saveObservationList([...i,...n]);if(Object(d["isEmpty"])(this.drugObs)||this.isNoneClientPatient||await this.saveAdherence(),!s)return Object(l["e"])("Unable to save patient observations");Object(l["d"])("Observations and encounter created!"),e.refer_to_clinician&&"Yes"===e.refer_to_clinician.value?this.gotoPatientDashboard():this.nextTask()},async getTransferInStatus(){const e=await u["a"].getFirstValueCoded(this.patientID,"Ever received ART"),t=await u["a"].getFirstObs(this.patientID,"Has transfer letter"),a=t?c["b"].toStandardHisFormat(t.obs_datetime):"";return e&&e.match(/yes/i)&&t&&(""+t.value_coded).match(/yes/i)&&a===this.consultation.getDate()},async getDateStartedArt(){const e=await u["a"].getFirstValueDatetime(this.patientID,"Date ART started");return e?c["b"].toStandardHisFormat(e):""},async checkIfWeightLossIsControlled(e){if(this.lostTenPercentBodyWeight&&(""+e.label).match(/malnutrition/i)&&(""+e.value).match(/no/i)){const t=await Object(w["a"])("Recommendation",`Patient's weight has dropped by ${this.weightLossPercentageNum}% , is this controlled weight loss??`,"Please verify",[{name:"Confirm weight loss",slot:"start",color:"success"},{name:"Confirm controlled",slot:"end",color:"primary"}]);e.value="Confirm weight loss"===t?"Yes":"No"}},async checkVLReminder(){const e=await P["a"].getPatientVLInfo(this.patientID);if(!0===e.eligibile){const t=await b["X"].create({component:I,backdropDismiss:!1,cssClass:"large-modal",componentProps:{VLData:e}});t.present();const{data:a}=await t.onDidDismiss();switch(a){case"order":await this.labOrderFieldContext.launchOrderSelection();break;case"wait":await this.waitForVL();break;case"later":break;default:break}}},async waitForVL(e=null){const t=new S(this.patientID,this.providerID),a=await t.createEncounter(),i=await t.buildDefferedOrder(e);if(!a)return Object(l["e"])("Unable to create encounter");await t.saveObservationList(i)},canScreenCxCa(){const e=this.patient.getAge();return this.patient.isFemale()&&this.DueForCxCa&&this.CxCaEnabled&&e>=this.CxCaStartAge&&e<=this.CxCaMaxAge&&!this.clientHadAHysterectomy},pregnancyEligible(){return this.patient.isChildBearing()&&!this.onPermanentFPMethods},showCurrentContraceptionMethods(e){return this.pregnancyEligible()&&!this.patientHitMenopause&&!this.isPregnant(e)&&!this.isANCclient()},showNewContraceptionMethods(e){return this.pregnancyEligible()&&!this.patientHitMenopause&&!this.isPregnant(e)&&!this.isOnTubalLigation(e)&&!this.isANCclient()},isPregnant(e){return e.pregnant_breastfeeding?this.inArray(e.pregnant_breastfeeding,e=>"Pregnant"===e.label&&"Yes"===e.value):this.currentlyPregnant},isOnTubalLigation(e){return this.inArray(e.current_fp_methods,e=>"TUBAL LIGATION"===e.value)},async disableFPMethods(e,t){if(t.isChecked&&"NONE"===t.label)return e.map(e=>("NONE"!=e.label&&(e.isChecked=!1,e.disabled=!1),e));if("NONE"!=t.label&&t.isChecked){t.label.match(/condom/gi)&&Object(l["b"])("Combine with other modern methods of family planning");const a=Object(d["findIndex"])(e,{label:"NONE"});e[a].isChecked=!1;const i=this.consultation.familyPlanningMethods(t.label,e),n=Object(d["findIndex"])(i,{label:t.label});return i[n].isChecked=!0,i}return e.map(e=>(e.disabled=!1,e))},disablePrescriptions(e,t){if(t.isChecked&&"NONE OF THE ABOVE"===t.label)return e.map(e=>("NONE OF THE ABOVE"!=e.label&&(e.isChecked=!1),e));if("NONE OF THE ABOVE"!=t.label&&t.isChecked){const t=Object(d["findIndex"])(e,{label:"NONE OF THE ABOVE"});e[t].isChecked=!1}return e},buildMedicationOrders(e){if(this.inArray(e,e=>"NONE OF THE ABOVE"===e.label))return this.consultation.buildValueCoded("Prescribe drugs","No");const t=this.consultation.buildValueCoded("Prescribe drugs","Yes"),a=e.map(e=>this.consultation.buildValueCoded("Medication orders",e.label));return[t,...a]},declinedFPM(e){return this.inArray(e.fp_methods,e=>"NONE"===e.value)&&this.inArray(e.current_fp_methods,e=>"NONE"===e.value)},riskOfUnplannedPregnancy(e){return"At risk of unplanned pregnancy"===e.reason_for_no_fpm.value},showOtherSideEffects(e){return this.inArray(e.side_effects,e=>"Other"===e.label&&"Yes"===e.value)},hasTBSymptoms(e){return this.presentedTBSymptoms=this.inArray(e.tb_side_effects,e=>"Yes"===e.value),this.presentedTBSymptoms},async buildSideEffectObs(e,t){const a=await this.getSideEffectsReasons(e);if(this[t]=[],void 0===a)return!1;if(-1!=a){const e=g["a"].getCachedConceptID("Drug induced",!0),i=e=>!!(""+e).match(/other|drug/i);this[t]=a.map(t=>({concept_id:e,value_coded:g["a"].getCachedConceptID(t.label,!0),value_text:i(t.reason)?"Past medication history":null,value_drug:i(t.reason)?null:t.reason}))}return!0},async getSideEffectsReasons(e){const t=e.filter(e=>!(""+e.label).match(/other/i)&&"Yes"===e.value);if(t.length>0){const e=await b["X"].create({component:J,backdropDismiss:!1,cssClass:"large-modal",componentProps:{sideEffects:t,drugs:this.lastDrugsReceived}});e.present();const{data:a}=await e.onDidDismiss();return a}return-1},getFPMethods(e=[],t){const a=this.consultation.getFamilyPlanningMethods(),i=a.filter(t=>!e.includes(t));return i.map(e=>({label:e,value:e,isChecked:t.map(e=>e.label).includes(e)}))},getOptions(e,t){return e.map(e=>{const a=Object(d["find"])(t,{label:e});return{label:e,value:a?a.value:"",other:{values:this.yesNoOptions()}}})},getContraindications(e){const t=g["a"].getConceptsByCategory("contraindication",!0).map(e=>e.name);return this.getOptions([...t,"Other"],e)},getOtherContraindications(e){const t=g["a"].getConceptsByCategory("side_effect",!0).map(e=>e.name),a=t.pop();return this.getOptions([...t,"Other (Specify)",""+a],e)},getTBSymptoms(e){const t=g["a"].getConceptsByCategory("tb_symptom",!0).map(e=>e.name);return this.getOptions([...t],e)},getReasonsForNoCxcaOptions(){return g["a"].getConceptsByCategory("reason_for_no_cxca").map(e=>({label:e.name,value:e.name,other:{c:e}}))},runAppendOptionParams(e,t){const a=t.filter(e=>e.isChecked).map(e=>e.label);return e.map(e=>{var t;if("function"===typeof(null===e||void 0===e||null===(t=e.other)||void 0===t?void 0:t.appendOptionParams)){var i;const t=null===e||void 0===e||null===(i=e.other)||void 0===i?void 0:i.appendOptionParams();if("object"===typeof t){const i={label:e.label,value:e.value,other:e.other};return t.isChecked?(i.isChecked=t.isChecked,delete t.isChecked):i.isChecked=a.includes(e.label),{...i,...t}}}return e})},didCompleted3HP(e){return!!this.completed3HP||!(!e.routine_tb_therapy||!e.routine_tb_therapy.value.match(/complete/i))},tptAutoSelectionMode(e){return this.autoSelect3HP&&!this.didCompleted3HP(e)},async on3HPValueUpdate(e,t,a){const i=e=>!!e.label.match(/IPT|3HP/i),n=(()=>{const t=e.reduce((e,t)=>(i(t)&&!(t.label in e)&&t.isChecked&&e.push(t.label),e),[]);return t.includes("IPT")&&(t.includes("3HP (RFP + INH)")||t.includes("INH 300 / RFP 300 (3HP)"))})(),s=i(t)&&e.filter(e=>i(e)).map(e=>!e.isChecked).every(Boolean);if(s&&this.tptAutoSelectionMode(a)){const e=await Object(w["c"])("Reasons for declining TPT","",["Patient declined","Side-effects (previous or current)","Stock-out","Starting TB treatment","Other"],[{name:"Done",slot:"start",role:"action"}]);this.reasonForDecliningTPTObs=this.consultation.buildValueText("Other reason for not seeking services",e.selection)}else this.reasonForDecliningTPTObs={};if(n){const t=await Object(w["a"])("IPT / 3HP conflict","IPT and 3HP can NOT be prescribed together","Please pick either one",[{name:"Prescribe 3HP",slot:"start",color:"primary"},{name:"Prescribe IPT",slot:"end",color:"primary"}]);return e.map(e=>(i(e)&&(e.isChecked="Prescribe IPT"===t&&"IPT"===e.label||"Prescribe 3HP"===t&&"INH 300 / RFP 300 (3HP)"===e.label),e))}return e.map(e=>(("3HP (RFP + INH)"===t.label&&"INH 300 / RFP 300 (3HP)"===e.label&&t.isChecked||"INH 300 / RFP 300 (3HP)"===t.label&&"3HP (RFP + INH)"===e.label&&t.isChecked)&&(e.isChecked=!1),e))},medicationOrderOptions(e,t=[]){const a=this.didCompleted3HP(e),i=this.tptAutoSelectionMode(e),n=e=>({disabled:!0,isChecked:!1,description:{color:"danger",show:"always",text:e}});return this.runAppendOptionParams([this.toOption("ARVs",{appendOptionParams:()=>({isChecked:i&&!this.TBSuspected})}),this.toOption("CPT",{appendOptionParams:()=>!i||this.TBSuspected||this.allergicToSulphur?this.allergicToSulphur?n("Allergic to CPT"):{disabled:!1}:{isChecked:!0}}),this.toOption("3HP (RFP + INH)",{appendOptionParams:()=>a?n("Completed 3HP"):this.TBSuspected?n("TB Suspect"):this.currentWeight<20?n("Weight below regulation"):void 0}),this.toOption("INH 300 / RFP 300 (3HP)",{appendOptionParams:()=>a?n("Completed 3HP"):this.TBSuspected?n("TB Suspect"):this.currentWeight<30?n("Weight below regulation"):{isChecked:i}}),this.toOption("IPT",{appendOptionParams:()=>a?n("Completed 3HP"):this.TBSuspected?n("TB Suspect"):void 0}),this.toOption("NONE OF THE ABOVE")],t)},async getVlLabData(){return p["a"].formatLabs(await ee["a"].get("GET_LAB_ORDERS_WITH_GIVEN_RESULT_STATUS",{patientID:this.patientID}))},isANCclient(){return"ANC"===P["a"].getSuspendedProgram()},getFields(){return[{id:"other_patient_prescription",proxyID:"prescription",helpText:"Medication to prescribe during this visit",type:s["b"].TT_MULTIPLE_SELECT,init:async()=>{const e="No"===await this.consultation.getClient();return this.isNoneClientPatient=!!e||!!await Q["a"].isDrugRefillPatient(this.patientID),this.isNoneClientPatient&&(this.currentWeight=Number(await this.patient.getRecentWeight()),this.autoSelect3HP=await ee["a"].get("ART_AUTO_3HP_SELECTION")),!0},validation:e=>o["a"].required(e),computedValue:e=>({tag:"consultation",obs:this.buildMedicationOrders(e)}),onValueUpdate:(e,t,a)=>{const i=this.disablePrescriptions(e,t);return this.on3HPValueUpdate(i,t,a)},options:(e,t,a,i)=>Object(d["isEmpty"])(i)?this.medicationOrderOptions(e):i,condition:()=>this.isNoneClientPatient,exitsForm:()=>!0},...Object(G["b"])({id:"date_last_received_arvs",helpText:"Last ARV Dispensation",required:!0,init:async()=>(this.wasTransferredIn=await this.getTransferInStatus()||!1,this.dateStartedArt=await this.getDateStartedArt(),!0),condition:()=>this.wasTransferredIn,minDate:()=>this.dateStartedArt,maxDate:()=>this.consultation.getDate(),computeValue:e=>(this.prescription.setDate(e),{tag:"consultation",date:e,obs:this.consultation.buildValueDate("Date drug received from previous facility",e)}),estimation:{allowUnknown:!1}},this.consultation.getDate()),{id:"previous_arvs_received",helpText:"Last ARV drugs dispensed",type:s["b"].TT_MULTIPLE_SELECT,computedValue:e=>e.map(e=>e.other),validation:e=>o["a"].required(e),options:async()=>{if(!Object(d["isEmpty"])(this.customRegimens))return this.customRegimens;const e=new X["a"](this.patientID,this.providerID);return this.customRegimens=(await e.getCustomIngridients()).map(e=>({label:e.name,value:e.drug_id,other:{...e}})),this.customRegimens},config:{showKeyboard:!0},condition:()=>this.wasTransferredIn},{id:"drug_interval",helpText:"Duration period for last received ARVs",type:s["b"].TT_NEXT_VISIT_INTERVAL_SELECTION,condition:()=>this.wasTransferredIn,validation:e=>o["a"].required(e),computedValue:e=>e.other.nextAppointment,options:()=>{const e=[{label:"2 weeks",value:14},{label:"1 month",value:28},{label:"2 months",value:56},{label:"3 months",value:84},{label:"4 months",value:112},{label:"5 months",value:140},{label:"6 months",value:168},{label:"7 months",value:196},{label:"8 months",value:224},{label:"9 months",value:252},{label:"10 months",value:280},{label:"11 months",value:308},{label:"12 months",value:336}];return e.map(({label:e,value:t})=>{this.prescription.setNextVisitInterval(t);const a=this.prescription.calculateDateFromInterval();return{label:e,value:t,other:{label:"Medication run-out date:",value:c["b"].toStandardHisDisplayFormat(a),nextAppointment:a,other:{label:"",value:[]}}}})}},{id:"arv_quantities",helpText:"Amount of drugs dispensed (From last ART Facility)",type:s["b"].TT_DRUG_TRANSFER_IN,validation:e=>this.validateSeries([()=>o["a"].required(e),()=>e.map(e=>{var t;return""===e.value||""===(null===e||void 0===e||null===(t=e.other)||void 0===t?void 0:t.pillsBrought)}).some(Boolean)?["Some Drugs are missing values"]:null]),computedValue:(e,t,a)=>({tag:"consultation",obs:e.map(async e=>{var t,i,n,s;const r=(null===e||void 0===e||null===(t=e.other)||void 0===t||null===(i=t.drug)||void 0===i?void 0:i.drug_id)||0;return{...await this.consultation.buildObs("Drug received from previous facility",{value_drug:r,value_datetime:(null===a||void 0===a?void 0:a.drug_interval)||null,value_numeric:(null===e||void 0===e?void 0:e.value)||0}),child:await this.consultation.buildObs("Number of tablets brought to clinic",{value_drug:r,value_numeric:(null===e||void 0===e||null===(n=e.other)||void 0===n?void 0:n.pillsBrought)||-1,value_datetime:(null===a||void 0===a||null===(s=a.date_last_received_arvs)||void 0===s?void 0:s.date)||null})}})}),options:(e,t,a)=>t.previous_arvs_received.map(e=>{const t=e["alternative_drug_name"]||e["drug_name"]||e["name"],i=Object(d["find"])(a,{label:t});let n="",s="";var r;i&&(n=null===i||void 0===i?void 0:i.value,s=null===i||void 0===i||null===(r=i.other)||void 0===r?void 0:r.pillsBrought);return{label:t,value:n,other:{drug:e,pillsBrought:s}}}),condition:()=>this.wasTransferredIn},{id:"patient_lab_orders",helpText:"Lab orders",type:s["b"].TT_LAB_ORDERS,init:async()=>(this.labOrders=await this.getVlLabData(),!0),unload:async()=>{await this.checkVLReminder();const e=this.labOrders.filter(e=>"No"===e.result_given);if(e.length&&await Object(l["a"])("Result(s) Given to Client?")){const t=new A["a"](this.patientID,-1,this.providerID),a=e.reduce((e,a)=>[...e,...a.resultIds.map(async e=>(t.encounterID=a.encounter_id,t.saveObs(await t.buildObs("Result Given to Client",{value_coded:"Yes",obs_group_id:e}))))],[]);await Promise.all(a)}this.labOrders=await this.getVlLabData()},onload:e=>this.labOrderFieldContext=e,options:()=>[{label:"Lab orders",value:"order trail",other:{values:this.labOrders}}],config:{printOrder:e=>new K["a"](this.patientID).printLabOrderLbl(e),hiddenFooterBtns:["Clear"],footerBtns:[{name:"Order",size:"large",slot:"end",color:"primary",visible:!0,onClick:async()=>{Object(d["isEmpty"])(this.labOrderFieldContext)||await this.labOrderFieldContext.launchOrderSelection()}}]}},{id:"pregnant_breastfeeding",helpText:"Patient Pregnant or breastfeeding?",init:async()=>(this.patient.isFemale()&&(this.patient.isChildBearing()&&(this.hasPregnancyObsToday=await this.patient.hasPregnancyObsToday(),this.currentlyPregnant=await this.patient.isPregnant()),this.onPermanentFPMethods=await this.consultation.getTLObs()),!0),condition:()=>!this.hasPregnancyObsToday&&this.pregnancyEligible(),type:s["b"].TT_MULTIPLE_YES_NO,validation:e=>this.validateSeries([()=>o["a"].required(e),()=>o["a"].anyEmpty(e)]),computedValue:e=>{let t=[];return this.isANCclient()&&t.push(this.consultation.buildValueCoded("Is patient pregnant","Yes")),t=t.concat(e.map(e=>this.consultation.buildValueCoded(e.other.concept,e.value))),{obs:t,tag:"consultation"}},options:e=>{const t=[];return this.isANCclient()||t.push({label:"Pregnant",value:"",other:{values:this.yesNoOptions(),concept:"Is patient pregnant"}}),t.push({label:"Breastfeeding",value:"",other:{values:this.yesNoOptions(),concept:"Is patient breast feeding"}}),e.pregnant_breastfeeding||t}},{id:"patient_weight_chart",helpText:"Patient weight chart",type:s["b"].TT_WEIGHT_CHART,init:async()=>(this.weightTrail=await this.patient.getWeightHistory(),this.weightLossPercentageNum=this.patient.getWeightLossPercentageFromTrail(this.weightTrail),this.lostTenPercentBodyWeight=this.weightLossPercentageNum>=10,!0),options:async()=>{const e=await this.patient.getBMI(),t=this.weightTrail;return[{label:"Weight for patient",value:"Weight trail",other:{bmi:e,values:t.map(e=>({x:c["b"].toStandardHisDisplayFormat(e.date),y:e.weight})),age:this.patient.getAge()}}]},config:{hiddenFooterBtns:["Clear"]}},{id:"has_fp_methods",helpText:"",type:s["b"].TT_TEXT_BANNER,condition:()=>this.onPermanentFPMethods,options:()=>this.mapStrToOptions(["Patient is on Tubal ligation method"])},{id:"current_fp_methods",helpText:"What method are you currently on?",type:s["b"].TT_MULTIPLE_SELECT,init:async()=>(this.patient.isFemale()&&(this.patientHitMenopause=await this.consultation.patientHitMenopause()),!0),validation:e=>o["a"].required(e),onValueUpdate:(e,t)=>this.disableFPMethods(e,t),computedValue:e=>({tag:"consultation",obs:e.map(e=>this.consultation.buildValueCoded("Family planning method",e.value))}),condition:e=>this.showCurrentContraceptionMethods(e),options:(e,t)=>this.getFPMethods([],t)},{id:"fp_methods",helpText:"What method are you providing today?",type:s["b"].TT_MULTIPLE_SELECT,condition:e=>this.showNewContraceptionMethods(e),validation:e=>o["a"].required(e),onValueUpdate:(e,t)=>this.disableFPMethods(e,t),computedValue:e=>({tag:"consultation",obs:e.map(e=>this.consultation.buildValueCoded("Family planning, action to take",e.value))}),options:(e,t)=>this.getFPMethods([],t)},{id:"reason_for_no_fpm",helpText:"Main reason for not using family planning methods",type:s["b"].TT_SELECT,validation:e=>o["a"].required(e),condition:e=>this.declinedFPM(e),computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueText("Why does the woman not use birth control",e.value)}),options:()=>this.mapStrToOptions(["Not Sexually active","Patient want to get pregnant","Not needed for medical reasons","At risk of unplanned pregnancy","Menopause"])},{id:"specific_reason_for_no_fpm",helpText:"Specific reason for not using family planning methods",type:s["b"].TT_SELECT,validation:e=>o["a"].required(e),computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueText("Reason for not using contraceptives",e.value)}),condition:e=>this.riskOfUnplannedPregnancy(e),options:()=>this.mapStrToOptions(["Following wishes of spouse","Religious reasons","Afraid of side effects","Never though about it","Indifferent (does not mind getting pregnant)"])},{id:"offer_contraceptives",helpText:"Offer contraceptives",type:s["b"].TT_SELECT,validation:e=>o["a"].required(e),condition:e=>this.riskOfUnplannedPregnancy(e),computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueCoded("Family planning, action to take",e.value)}),options:()=>[{label:"Accepted",value:"Yes"},{label:"Declined",value:"No"},{label:"Discuss with spouse",value:"Discuss with spouse"}]},{id:"offered_intervention",helpText:"Offered intervention",type:s["b"].TT_MULTIPLE_SELECT,validation:e=>o["a"].required(e),condition:e=>"Accepted"===e.offer_contraceptives.value,computedValue:e=>({tag:"consultation",obs:e.map(e=>this.consultation.buildValueCoded(e.label,e.value))}),options:(e,t)=>this.getFPMethods(["NONE"],t)},{id:"offer_cxca",helpText:"Refer client for CxCa screening",type:s["b"].TT_SELECT,init:async()=>{if(this.patient.isFemale()&&(this.CxCaEnabled=await W["b"].cervicalCancerScreeningEnabled(),this.CxCaEnabled)){const{start:e,end:t}=await W["b"].cervicalCancerScreeningAgeBounds();this.CxCaMaxAge=t,this.CxCaStartAge=e,this.DueForCxCa=await this.consultation.clientDueForCxCa(),this.clientHadAHysterectomy=await this.consultation.clientHasHadAHysterectomy()}return!0},validation:e=>o["a"].required(e),condition:e=>this.canScreenCxCa()&&!this.isPregnant(e),computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueCoded("Offer CxCa",e.value)}),options:()=>this.yesNoOptions()},{id:"reason_for_no_cxca",helpText:"Reason for NOT offering CxCa",type:s["b"].TT_SELECT,validation:e=>o["a"].required(e),condition:e=>"No"===e.offer_cxca.value,computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueCoded("Reason for NOT offering CxCa",e.value)}),options:()=>this.getReasonsForNoCxcaOptions()},...Object(G["b"])({id:"previous_cxca_test_date",helpText:"Previous CxCa test",required:!0,minDate:()=>this.patient.getBirthdate(),maxDate:()=>u["a"].getSessionDate(),condition:e=>"Not due for screening"===e.reason_for_no_cxca.value,computeValue:(e,t)=>t?{tag:"consultation",obs:this.consultation.buildValueDateEstimated("CxCa test date",e)}:{tag:"consultation",obs:this.consultation.buildValueDate("CxCa test date",e)},estimation:{allowUnknown:!0,estimationFieldType:G["a"].MONTH_ESTIMATE_FIELD}}),{id:"previous_side_effects",helpText:"Side effects / Contraindications history",type:s["b"].TT_DATA_TABLE,init:async()=>(this.sideEffectsHistory=await this.consultation.getDrugSideEffects(),!0),config:{columns:()=>[[z["a"].thTxt("Date"),z["a"].thTxt("Condition"),z["a"].thTxt("Drug induced"),z["a"].thTxt("Drug")]],rows:()=>Object.keys(this.sideEffectsHistory).map(e=>Object.values(this.sideEffectsHistory[e]).filter(e=>!Object(d["isEmpty"])(e.name)).map(t=>[z["a"].tdDate(e),z["a"].td(t.name),z["a"].td(t.drug_induced?"Yes":"No"),z["a"].td(t.drug)])).reduce((e,t)=>e.concat(t),[])}},{id:"side_effects",helpText:"Contraindications / Side effects (select either 'Yes' or 'No')",type:s["b"].TT_MULTIPLE_YES_NO,init:async()=>(this.lastDrugsReceived=await this.consultation.getPreviousDrugs(),!0),validation:e=>this.validateSeries([()=>o["a"].required(e),()=>o["a"].anyEmpty(e)]),computedValue:e=>({tag:"consultation",obs:e.map(async e=>({...await this.consultation.buildValueCoded("Malawi ART side effects",e.label),child:await this.consultation.buildValueCoded(e.label,e.value)}))}),beforeNext:e=>this.buildSideEffectObs(e,"malawiSideEffectReasonObs"),options:(e,t)=>this.getContraindications(t)},{id:"other_side_effects",helpText:"Other Contraindications / Side effects (select either 'Yes' or 'No')",type:s["b"].TT_MULTIPLE_YES_NO,onValue:async e=>(await this.checkIfWeightLossIsControlled(e),!0),condition:e=>this.showOtherSideEffects(e),onConditionFalse:()=>this.otherSideEffectReasonObs=[],validation:e=>this.validateSeries([()=>o["a"].required(e),()=>o["a"].anyEmpty(e)]),computedValue:e=>({tag:"consultation",obs:e.filter(e=>"Other (Specify)"!=e.label).map(async e=>({...await this.consultation.buildValueCoded("Other side effect",e.label),child:await this.consultation.buildValueCoded(e.label,e.value)}))}),beforeNext:e=>this.buildSideEffectObs(e,"otherSideEffectReasonObs"),options:(e,t)=>this.getOtherContraindications(t)},{id:"other_side_effect_specify",helpText:"Other Contraindications / Side effects (specify)",type:s["b"].TT_NOTE,computedValue:async e=>({tag:"consultation",obs:{...await this.consultation.buildValueCoded("Other side effect","Other (Specify)"),child:await this.consultation.buildValueText("Other (Specify)",e.value)}}),condition:e=>this.inArray(e.other_side_effects,e=>"Other (Specify)"===e.label&&"Yes"===e.value),validation:e=>o["a"].required(e)},{id:"on_tb_treatment",helpText:"On TB Treatment?",type:s["b"].TT_SELECT,validation:e=>o["a"].required(e),computedValue:e=>{this.TBSuspected="Yes"===e.value;const t=[this.consultation.buildValueCoded("TB treatment",e.value)];return this.TBSuspected&&t.push(this.consultation.buildValueCoded("TB Status","Confirmed TB on treatment")),{tag:"consultation",obs:t}},options:()=>this.yesNoOptions()},{id:"tb_side_effects",helpText:"TB Associated symptoms",type:s["b"].TT_MULTIPLE_YES_NO,onValue:async e=>(await this.checkIfWeightLossIsControlled(e),!0),validation:e=>this.validateSeries([()=>o["a"].required(e),()=>o["a"].anyEmpty(e)]),condition:e=>e.on_tb_treatment.value.match(/no/i),options:(e,t)=>this.getTBSymptoms(t),computedValue:e=>(this.presentedTBSymptoms=this.inArray(e,e=>"Yes"===e.value),{tag:"consultation",obs:e.map(async e=>({...await this.consultation.buildValueCoded("Routine TB Screening",e.label),child:await this.consultation.buildValueCoded(e.label,e.value)}))})},{id:"tb_status",helpText:"TB Status",type:s["b"].TT_SELECT,validation:e=>o["a"].required(e),condition:e=>this.hasTBSymptoms(e),onConditionFalse:()=>this.TBSuspected=!1,defaultValue:()=>"TB Suspected",computedValue:e=>(this.TBSuspected="TB Suspected"===e.value,{tag:"consultation",obs:this.consultation.buildValueCoded("TB Status",e.value)}),beforeNext:async e=>{if("TB Suspected"===e.value){const e=await Object(w["a"])("Lab Order","The patient is a TB suspect. Do you want to take lab orders?","",[{name:"Order now",slot:"start",color:"success"},{name:"NOT now",slot:"end",color:"danger"}]);"Order now"===e&&this.labOrderFieldContext.launchOrderSelection(["TB Microscopic Exam","GeneXpert","Culture & Sensitivity","TB Tests"])}return!0},options:()=>this.mapStrToOptions(["TB NOT suspected","TB Suspected","Confirmed TB Not on treatment"])},{id:"routine_tb_therapy",helpText:"TB preventive therapy (TPT) history",type:s["b"].TT_SELECT,init:async()=>(this.hasTbHistoryObs=await this.consultation.hasTreatmentHistoryObs(),this.hasTbHistoryObs&&(this.completed3HP=await this.consultation.patientCompleted3HP()),this.completed3HP||(this.completed3HP=await this.consultation.hasCompleteTptDispensations()),!0),validation:e=>o["a"].required(e),condition:()=>!this.hasTbHistoryObs,computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueText("Previous TB treatment history",e.value)}),options:()=>this.mapStrToOptions(["Currently on IPT","Currently on 3HP","Complete course of 3HP in the past (3 months RFP+INH)","Complete course of IPT in the past (min. 6 months of INH)","Aborted course of 3HP or IPT in the past","Never taken IPT or 3HP"])},{id:"allergic_to_sulphur",helpText:"Allergic to Cotrimoxazole",type:s["b"].TT_SELECT,validation:e=>o["a"].required(e),computedValue:e=>(this.allergicToSulphur=e.value.match(/unknown/i)?null:!!e.value.match(/yes/i),{tag:"consultation",obs:()=>this.consultation.buildValueCoded("Allergic to sulphur",null===this.allergicToSulphur?e.value:this.allergicToSulphur?"Yes":"No")}),options:()=>this.yesNoUnknownOptions()},...this.getAdherenceFields(!0),{id:"refer_to_clinician",helpText:"Refer to clinician",type:s["b"].TT_SELECT,condition:()=>h["a"].isNurse(),validation:e=>o["a"].required(e),computedValue:e=>({tag:"consultation",obs:this.consultation.buildValueCoded("Refer to clinician",e.value)}),options:()=>this.yesNoOptions()},{id:"medication_to_prescribe",proxyID:"prescription",helpText:"Medication to prescribe during this visit",type:s["b"].TT_MULTIPLE_SELECT,init:async()=>(this.isNoneClientPatient||(this.currentWeight=Number(await this.patient.getRecentWeight()),this.autoSelect3HP=await ee["a"].get("ART_AUTO_3HP_SELECTION")),!0),condition:e=>!e.refer_to_clinician||(""+e.refer_to_clinician.value).match(/no/i),validation:e=>o["a"].required(e),computedValue:e=>({tag:"consultation",obs:this.buildMedicationOrders(e)}),onValueUpdate:(e,t,a)=>{const i=this.disablePrescriptions(e,t);return this.on3HPValueUpdate(i,t,a)},options:(e,t,a,i)=>this.medicationOrderOptions(e,i),config:{footerBtns:[{name:"Update allergic to CPT",onClickComponentEvents:{refreshOptions:(e,t,a)=>(this.allergicToSulphur="Allergic"===e.btnOutput,this.medicationOrderOptions(a,t))},onClick:()=>Object(w["a"])("Allergic to Cotrimoxazole update","Is the patient allergic to cotrimoxazole.","",[{name:"Allergic",slot:"start",color:"success"},{name:"NOT Allergic",slot:"end"}])}]}}]}}});const ae=E()(te,[["render",n]]);t["default"]=ae},"71c3":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var i=a("1c74");class n extends i["e"]{constructor(){super()}static create(e){return this.postJson("drug_orders",e)}static updateDispensationOrders(e){return this.postJson("dispensations",{program_id:this.getProgramID(),dispensations:e.map(e=>({date:this.getSessionDate(),drug_order_id:e["order_id"],quantity:e["quantity"]}))})}static getDrugOrderHistory(e){return this.getJson("drug_orders",{patient_id:e})}static getDrugOrders(e){return this.getJson("drug_orders",{patient_id:e,date:this.getSessionDate(),program_id:this.getProgramID()})}static getAllDrugOrders(e,t=1e3){return this.getJson("drug_orders",{patient_id:e,program_id:i["e"].getProgramID(),page_size:t})}static getLastDrugsReceived(e){return this.getJson(`patients/${e}/last_drugs_received`,{date:this.getSessionDate(),program_id:this.getProgramID()})}static getDrugDosages(e,t,a=this.getSessionDate()){const i={drug_id:t,date:a};return this.getJson(`programs/${this.getProgramID()}/patients/${e}/drug_doses`,i)}static getOrderByPatient(e,t){return this.getJson("/drug_orders",{patient_id:e,program_id:this.getProgramID(),...t})}}},b446:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return C}));a("caad"),a("13d5");var i,n=a("d95e"),s=[{label:"Jan",value:1},{label:"Feb",value:2},{label:"Mar",value:3},{label:"Apr",value:4},{label:"May",value:5},{label:"Jun",value:6},{label:"Jul",value:7},{label:"Aug",value:8},{label:"Sep",value:9},{label:"Oct",value:10},{label:"Nov",value:11},{label:"Dec",value:12}],r=a("9283"),o=a("2706"),l=a("3800"),c=a("6be2"),d=a("5a0c"),u=a.n(d),h=a("1c74");function p(e,t,a=!0){const i=[];return a&&i.push("UNKNOWN"),{id:e,helpText:t+" Year",appearInSummary:()=>!1,type:n["b"].TT_TEXT,config:{customKeyboard:[l["i"],[i,["DELETE"]]]}}}function g(e,t){return{id:e,helpText:t+" Month",appearInSummary:()=>!1,type:n["b"].TT_SELECT,options:()=>s}}function m(e,t){return{id:e,helpText:t+" Day",type:n["b"].TT_MONTHLY_DAYS,appearInSummary:()=>!1}}function b(e,t){return{id:e,helpText:t+" Estimated period",type:n["b"].TT_SELECT,appearInSummary:()=>!1,options:()=>[{label:"6 months ago",value:180},{label:"12 months ago",value:365},{label:"18 months ago",value:540},{label:"24 months ago",value:730},{label:"Over 2 years ago",value:730}]}}function f(e,t){return{id:e,helpText:t+" Age Estimate",type:n["b"].TT_NUMBER,appearInSummary:()=>!1,config:{keypad:c["e"]}}}function O(e){return parseInt(e)<10?"0"+e:e}async function T(e,t,a){if(t.defaultValue){const i=await t.defaultValue(e);if(i){const[e,t,n]=i.split("-");switch(a){case"Year":return e||"";case"Month":return parseInt(t)||"";case"Day":return parseInt(n)||""}}}return""}function v(e){return r["b"].toStandardHisDisplayFormat(e)}function y(e,t,a,i){if(t.minDate){const n=t.minDate(a,i);if(new Date(e)<new Date(n))return[`${v(e)} is less than minimum date of ${v(n)}`]}if(t.maxDate){const n=t.maxDate(a,i);if(n&&new Date(e)>new Date(n))return[`${v(e)} is greater than max date of  ${v(n)}`]}}function C(e,t=""){let a="",n="",l="",c="";const d="year_"+e.id,C="month_"+e.id,_="day_"+e.id,D="age_estimate_"+e.id,E="duration_estimate_"+e.id,N=p(d,e.helpText,e.estimation.allowUnknown),I=g(C,e.helpText),P=m(_,e.helpText),A=f(D,e.helpText),S=b(E,e.helpText),w="boolean"===typeof e.estimation.allowUnknownMonthDay&&e.estimation.allowUnknownMonthDay,V=t=>!(t[d]&&t[d].value&&["Unknown"].includes(t[d].value))&&(!e.condition||e.condition(t)),R=(e,t)=>{const a=[{type:"year",value:n,default:"YYYY"},{type:"month",value:l,default:"MM"},{type:"day",value:c,default:"DD"}];return a.reduce((a,i)=>{const n=[null,void 0,"Unknown",""];return t===i.type?n.includes(e)?a.push(i.default):a.push(e):n.includes(i.value)?a.push(i.default):a.push(i.value),a},[]).join("-")};"function"===typeof e.init&&(N.init=e.init),N.updateHelpTextOnValue=e=>`${N.helpText} (${R(null===e||void 0===e?void 0:e.label,"year")})`,N.proxyID=e.id,N.unload=e=>n=e.value.toString(),N.config={...N.config,...e.config},N.defaultValue=t=>T(t,e,"Year"),N.condition=t=>!e.condition||e.condition(t),N.validation=(t,a,i)=>{if(e.required&&o["a"].required(t))return["Year cannot be empty"];const n=t?t.value:"";if(!e.estimation.allowUnknown&&n.toString().match(/unknown/i))return["Value unknown is not permitted"];if(n&&!["Unknown"].includes(n)&&isNaN(n)||n<1900)return["Invalid Year"];if(n&&"function"===typeof e.minDate){const t=r["b"].getYear(e.minDate(a,i));if(parseInt(n)<t)return[`Year of ${n} is less than Minimum year of ${t}`]}if(n&&"function"===typeof e.maxDate){const t=e.maxDate(a,i);if(t&&n>r["b"].getYear(t))return[`Year of ${n} exceeds Maximum year of ${r["b"].getYear(t)}`]}return null},N.summaryMapValue=()=>({label:e.summaryLabel||e.helpText,value:a?v(a):"Unknown"}),N.appearInSummary=(t,a)=>a===e.id,N.computedValue=t=>{if(a){const[i,n,s]=a.split("-");return a=`${t.value}-${n}-${s}`,e.computeValue(a,!1)}if(t&&"Unknown"===t.value)return a="",e.computeValue("Unknown",!1)},I.updateHelpTextOnValue=e=>`${I.helpText} (${R(null===e||void 0===e?void 0:e.label,"month")})`,I.proxyID=e.id,I.unload=e=>l=O(e.value.toString()),I.condition=e=>V(e),I.validation=e=>o["a"].required(e),I.defaultValue=t=>T(t,e,"Month"),w&&(I.options=()=>[...s,{label:"Unknown",value:"Unknown"}]),I.computedValue=(t,i)=>{if((""+t.value).match(/unknown/i))return a=i[d].value+"-07-15",e.computeValue(a,!0);if(a){const[i,n,s]=a.split("-"),r=O(""+t.value);return a=`${i}-${r}-${s}`,e.computeValue(a,!1)}},P.proxyID=e.id,P.updateHelpTextOnValue=e=>`${P.helpText} (${R(null===e||void 0===e?void 0:e.label,"day")})`,P.condition=e=>!(""+e[C].value).match(/unknown/i)&&V(e),P.validation=(t,i,n)=>o["a"].required(t)?["Day is required for date"]:y(a,e,i,n),P.defaultValue=t=>T(t,e,"Day"),P.computedValue=t=>{const i=!!(""+t.value).match(/unknown/i);return c=i?"15":O(""+t.value),a=`${n}-${l}-${c}`,e.computeValue(a,i)},P.unload=(t,a,i,n)=>{e.unload&&e.unload(t,a,i,n)},P.beforeNext=(t,i)=>!e.beforeNext||e.beforeNext(a,i),P.config={year:e=>e[d].value,month:e=>e[C].value},w||(P.config.keyboardActions=[]);const x=(t,a)=>{const i=["Unknown"===t[d].value,!e.condition||e.condition(t),e.estimation.estimationFieldType===a];return i.every(Boolean)};return A.proxyID=e.id,A.validation=(t,i,n)=>{if(t&&t.value>300)return["Age estimate is too high and exceeding hard limit of 300"];if(isNaN(parseInt(t.value.toString())))return["Please enter a valid number"];const s=/^(12[0-7]|1[01][0-9]|[1-9]?[0-9])$/;return t.value.toString().match(s)?y(a,e,i,n):["Not a valid age estimate"]},A.condition=e=>x(e,i.AGE_ESTIMATE_FIELD),A.computedValue=t=>{const i=u()(h["e"].getSessionDate()).subtract(t.value,"years").year();return a=i+"-07-15",e.computeValue(a,!0)},A.beforeNext=(t,i)=>!e.beforeNext||e.beforeNext(a,i),S.proxyID=e.id,S.validation=(t,i,n)=>o["a"].required(t)?["Please select an estimate"]:y(a,e,i,n),S.condition=e=>x(e,i.MONTH_ESTIMATE_FIELD),S.computedValue=t=>(a=u()(h["e"].getSessionDate()).subtract(t.value,"day").format(r["a"]),e.computeValue(a,!0)),S.beforeNext=(t,i)=>!e.beforeNext||e.beforeNext(a,i),[N,I,P,A,S]}(function(e){e["AGE_ESTIMATE_FIELD"]="age-estimate-field",e["MONTH_ESTIMATE_FIELD"]="month-period-estimate-field"})(i||(i={}))},d42f:function(e,t,a){"use strict";a("1c3d")},dac2:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));a("caad");var i=a("71c3"),n=a("9283"),s=a("1c74");class r extends s["e"]{constructor(){super()}static getAllArvRegimens(){return this.getJson(`programs/${this.getProgramID()}/all_arv_regimens`)}static getRegimens(e){return this.getJson(`programs/${this.getProgramID()}/regimens`,{patient_id:e})}static getCustomIngridients(){return this.getJson(`programs/${this.getProgramID()}/custom_regimen_ingredients`)}static getCurrentRegimen(e,t=this.getSessionDate()){return this.getJson(`programs/${this.getProgramID()}/${e}`,{date:t})}}var o,l=a("2ef0"),c=a("cc6f");(function(e){e["CONTRAINDICATION"]="contraindication",e["SIDE_EFFECT"]="side_effect"})(o||(o={}));class d extends c["a"]{constructor(e,t){super(e,25,t),this.nextVisitInterval=0,this.fastTrack=!1,this.regimenExtras=[],this.fastTrackMedications=[],this.hangingPills=[],this.medicationOrders=[],this.treatmentState="",this.contraindications={},this.sideEffects={},this.tptPrescriptionCount=0,this.lastSideEffectDate=""}setNextVisitInterval(e){this.nextVisitInterval=e}getHangingPills(){return this.hangingPills}getMedicationOrders(){return this.medicationOrders.map(e=>c["a"].getCachedConceptName(e))}getTptPrescriptionCount(){return this.tptPrescriptionCount}getLastSideEffectDate(){return this.lastSideEffectDate}getContraindications(){return this.contraindications}getSideEffects(){return this.sideEffects}getRegimenExtras(){return this.regimenExtras}getPatientRegimens(){return r.getRegimens(this.patientID)}getCustomIngridients(){return r.getCustomIngridients()}getFastTrackMedications(){return this.fastTrackMedications}getTreatmentState(){return this.treatmentState}isFastTrack(){return this.fastTrack}medicationOrdersAvailable(){return!Object(l["isEmpty"])(this.medicationOrders)}shouldPrescribeArvs(){const e=c["a"].getCachedConceptID("Antiretroviral drugs");return this.medicationOrders.includes(e)}shouldPrescribeExtras(){const e=c["a"].getConceptsByCategory("art_extra_medication_order"),t=e.map(e=>this.medicationOrders.includes(e.concept_id));return t.some(Boolean)}getRegimenStarterpack(e,t){const a={weight:t,regimen:e};return c["a"].getJson(`programs/${c["a"].getProgramID()}/regimen_starter_packs`,a)}async getLvpDrugsByType(e,t){return c["a"].getJson(`programs/${c["a"].getProgramID()}/regimens/${t}`,{patient_id:this.patientID,lpv_drug_type:e})}async loadContraindications(){const e=await c["a"].getConceptID("Contraindications"),t=await c["a"].getObs({concept_id:e,person_id:this.patientID});t.forEach(e=>{const t=n["b"].toStandardHisFormat(e.obs_datetime);this.contraindications[t]||(this.contraindications[t]=[]);const a=c["a"].getCachedConceptName(e.value_coded);this.contraindications[t].push(a)})}async loadDrugInduced(){const e=await c["a"].getConceptID("Drug induced"),t=await c["a"].getObs({concept_id:e,person_id:this.patientID});t&&t.forEach(e=>{const t=n["b"].toStandardHisFormat(e.obs_datetime);if(this.lastSideEffectDate||(this.lastSideEffectDate=t),!e.value_drug||!e.value_coded)return;this.sideEffects[t]||(this.sideEffects[t]={}),this.sideEffects[t][e.value_drug]||(this.sideEffects[t][e.value_drug]=[]);const a=c["a"].getCachedConceptName(e.value_coded);this.sideEffects[t][e.value_drug].push(a)})}async loadTptPrescriptionCount(){const e=await c["a"].getJson("tpt_prescription_count",{patient_id:this.patientID,date:this.date});if(e){const t=e.count+1;this.tptPrescriptionCount=t>3?3:t}}async loadFastTrackStatus(){const e=await c["a"].getFirstValueCoded(this.patientID,"Fast track"),t=await c["a"].getConceptID("yes");e&&(this.fastTrack=e===t)}async loadRegimenExtras(e=this.date){const t=await r.getJson(`programs/${r.getProgramID()}/patients/${this.patientID}/dosages`,{date:e});t&&(this.regimenExtras=Object.values(t))}async loadMedicationOrders(){const e=await c["a"].getConceptID("Medication orders"),t=await c["a"].getObs({concept_id:e,date:this.date,person_id:this.patientID,page_size:5});this.medicationOrders=t.map(e=>e.value_coded)}async loadHangingPills(){const e=await c["a"].getAll(this.patientID,"Pills brought");e&&(this.hangingPills=e.filter(e=>e.value_numeric>=1&&e.order).map(e=>e.order.drug_order.drug_inventory_id))}async loadFastTrackMedications(){const e=await i["a"].getLastDrugsReceived(this.patientID),t=e.map(async e=>{const{drug:t}=e,a=await i["a"].getDrugDosages(this.patientID,t.drug_id);return{drug_id:t.drug_id,drug_name:t.name,units:t.units,am:a.am,noon:a.noon,pm:a.pm,frequency:e.frequency}});this.fastTrackMedications=await Promise.all(t)}async loadTreatmentState(){const e={date:this.date},t=await c["a"].getJson(`programs/${c["a"].getProgramID()}/patients/${this.patientID}/status`,e);t&&(this.treatmentState=t["status"])}findAndGroupDrugSideEffects(e){const t={};for(const a in this.sideEffects){const i=this.sideEffects[a];for(const n in i)e.includes(parseInt(n))&&(t[a]||(t[a]=[]),t[a]=[...t[a],...i[n]])}return t}calculatePillsPerDay(e,t,a){return parseFloat(e.toString())+t+a}estimatePackSize(e,t=0){const a=e*this.nextVisitInterval/t;let i=Math.round(a);return i<=0&&(i+=1),i}calculateDosage(e,t){let a=0;return 0===t&&(a=e),0==e&&(a=t),e>0&&t>0&&(a=(e+t)/2),a}calculateEquivalentDosage(e,t){return e+t}calculateDateFromInterval(){const e=new Date(this.date);return e.setDate(e.getDate()+this.nextVisitInterval),n["b"].toStandardHisFormat(e)}getDrugPackSize(e){if(e.pack_size)return e.pack_size;try{return e.barcodes[0].tabs}catch(t){return 30}}getInstructions(e,t,a,i){return`${e} :- Morning: ${t} ${i}, Evening: ${a} ${i}`}toOrderObj(e,t,a,i=0,n=0,s=""){return{drug_inventory_id:e,equivalent_daily_dose:this.calculateEquivalentDosage(i,n),start_date:this.date,auto_expire_date:this.calculateDateFromInterval(),units:a,instructions:this.getInstructions(t,i,n,a),dose:this.calculateDosage(i,n),frequency:s}}async getReasonForRegimenSwitch(){const e=await c["a"].getFirstValueText(this.patientID,"Reason for ARV switch");return e||"N/A"}async createDrugOrder(e){return i["a"].create({encounter_id:this.encounterID,drug_orders:e})}async createHangingPillsObs(e){return this.saveValueTextObs("appointment type",e)}async createRegimenSwitchObs(e){return this.saveValueTextObs("Reason for ARV switch",e)}}},e96c:function(e,t,a){"use strict";a("113a")},fe96:function(e,t,a){"use strict";var i=a("7a23"),n=a("d95e"),s=a("b5e4"),r=(a("13d5"),a("caad"),a("cc6f")),o=a("9283"),l=a("2ef0"),c=a("32b3"),d=a("5a0c"),u=a.n(d);class h extends r["a"]{constructor(e,t){super(e,68,t),this.lastDrugs=[],this.lastReceiptDate=""}async loadPreviousDrugs(){const e=new Date(this.date);e.setDate(e.getDate()-1);const t=e=>o["b"].toStandardHisFormat(e),a=await r["a"].getJson(`patients/${this.patientID}/drugs_received`,{date:t(e)});if(a){this.lastReceiptDate=a.reduce((e,a)=>!e||new Date(t(a.order.start_date))>new Date(e)?t(a.order.start_date):e,null);const e=c["a"].htnDrugReferences().map(e=>e.drug_id);this.lastDrugs=a.filter(a=>!e.includes(a.drug["drug_id"])&&t(a.order.start_date)===this.lastReceiptDate)}}getReceiptDate(){return this.lastReceiptDate}getLastDrugs(){return this.lastDrugs}receivedDrugsBefore(){return!Object(l["isEmpty"])(this.lastDrugs)}buildPillCountObs(e,t){return this.buildValueNumber("Number of tablets brought to clinic",t,null,e)}async buildAdherenceObs(e,t,a){const i=await r["a"].getConceptID("Drug adherence",!0);return{concept_id:i,value_numeric:a,value_drug:t,value_modifier:"%",order_id:e,person_id:this.patientID,obs_datetime:r["a"].getSessionDate()}}isAdherenceGood(e){return e>=95&&e<=105}calculateAdherence(e,t,a){return Math.round(100*(e-t)/(e-a))}calculateExpected(e,t,a,i){const n="QW"===i?"week":"day",s=this.calcTimeElapsed(a,n);return e-s*parseFloat(t.toString())}calcTimeElapsed(e,t){return u()(this.date).diff(e,t)}calculateUnaccountedOrMissed(e,t){const a=parseFloat(e)-parseFloat(t);return a<0?-1*a+" missed":a+" unacc"}}var p=a("7365"),g=a("2706"),m=Object(i["defineComponent"])({mixins:[p["a"]],data:()=>({adherence:{},drugObs:[],askReasonForPoorAdherence:!1,calculationAgreementObs:[]}),methods:{async saveAdherence(){await this.adherence.createEncounter();const e=await Promise.all([...this.drugObs,...this.calculationAgreementObs]),t=await this.adherence.saveObservationList(e);if(!t)return Object(s["e"])("Unable to save patient observations")},buildAdherenceReport(e){const t=this.adherence.getReceiptDate(),a=this.adherence.calcTimeElapsed(t,"day"),i=` Last visit: ${o["b"].toStandardHisDisplayFormat(t)} \n                (${a} Days Elapsed)`,n=[{indexes:[0,3,6],class:"adherence-col-bg"}],s=[],r=[i],l=[["Prescription"],["Tabs given"],["Tabs per"],["Tabs remaining"],["Expected"],["Actual (counted)"],["Adherence"],["Doses missed/ Unaccounted for"],["Doses consumed"],["Art Adherence"]];return e.forEach((e,t)=>{const a=this.formatFrequency(e.frequency),i=this.calcPillsExpected(e),n=this.adherence.calculateAdherence(e.quantity,e.pillsBrought,i),o=this.adherence.isAdherenceGood(n)?"Good adherence":"Explore problem",c=this.adherence.calculateUnaccountedOrMissed(i,e.pillsBrought);r.push(e.drug.name),l[0].push(""),l[1].push(e.quantity),l[2].push(`${e.equivalent_daily_dose} <b>${a}</b>`),l[3].push(""),l[4].push(i<0?0:i),l[5].push(e.pillsBrought),l[6].push(""),l[7].push(c),l[8].push(n+"%"),l[9].push(o),s.push({index:t+1,row:9,class:o.match(/good/i)?"adherence-txt-good":"adherence-txt-bad"})}),[{label:"Selected Medication",value:"Table",other:{columns:r,rows:l,rowColors:n,cellColors:s}}]},formatFrequency(e){return(""+e).match(/qod/i)?"QOD":(""+e).match(/weekly/i)?"QW":e},calcPillsExpected(e){return this.adherence.calculateExpected(e.quantity,e.equivalent_daily_dose,e.order.start_date,this.formatFrequency(e.frequency))},getAdherenceFields(e=!1){return[{id:"pills_brought",helpText:"Pills remaining (brought to clinic)",type:n["b"].TT_ADHERENCE_INPUT,init:async()=>(this.adherence=new h(this.patientID,this.providerID),await this.adherence.loadPreviousDrugs(),!0),condition:()=>!e||this.adherence.receivedDrugsBefore(),validation:e=>{if(g["a"].required(e))return["No drugs available"];const t=e.map(e=>""===e.value);return t.some(Boolean)?["Some values are missing"]:null},unload:async e=>{this.drugObs=[],e.forEach(async e=>{const{drug:t,order:a}=e.other,i={...e.other,pillsBrought:e.value},n=this.adherence.calculateAdherence(i.quantity,i.pillsBrought,this.calcPillsExpected(i));this.drugObs.push(this.adherence.buildAdherenceObs(a.order_id,t.drug_id,n)),this.drugObs.push(this.adherence.buildPillCountObs(a.order_id,e.value)),this.askReasonForPoorAdherence||(this.askReasonForPoorAdherence=!this.adherence.isAdherenceGood(i))})},options:e=>Object(l["isEmpty"])(e.pills_brought)?this.adherence.getLastDrugs().map(e=>({label:e.drug.name,value:"",other:{...e}})):e.pills_brought},{id:"adherence_report",helpText:"ART adherence",type:n["b"].TT_TABLE_VIEWER,condition:()=>!e||this.adherence.receivedDrugsBefore(),options:e=>this.buildAdherenceReport(e.pills_brought.map(e=>({...e.other,pillsBrought:e.value}))),config:{hiddenFooterBtns:["Clear"]}},{id:"agree_with_calculation",helpText:"Agree with adherence calculation",type:n["b"].TT_SELECT,condition:()=>this.askReasonForPoorAdherence,validation:e=>g["a"].required(e),unload:({value:e})=>{this.calculationAgreementObs=[this.adherence.buildValueCoded("Reason for poor treatment adherence",e)]},options:()=>[{label:"Yes",value:"Yes"},{label:"No",value:"No"}]}]}}});const b=m;t["a"]=b}}]);
//# sourceMappingURL=chunk-64c63d9f.e652b6a1.js.map