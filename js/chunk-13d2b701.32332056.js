(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-13d2b701"],{"30f4":function(t,e,o){"use strict";o.r(e);var r=o("7a23");function a(t,e,o,a,i,s){const n=Object(r["resolveComponent"])("report-template"),h=Object(r["resolveComponent"])("ion-page");return Object(r["openBlock"])(),Object(r["createBlock"])(h,null,{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(n,{reportPrefix:"MoH",title:t.title,period:t.period,rows:t.rows,fields:t.fields,columns:t.columns,config:{showIndex:!0},validationErrors:t.errors,showValidationStatus:t.showStatus,headerInfoList:t.headerList,onReportConfiguration:t.onPeriod},null,8,["title","period","rows","fields","columns","validationErrors","showValidationStatus","headerInfoList","onReportConfiguration"])]),_:1})}o("14d9");var i=o("ad8d"),s=o("87e7"),n=o("44e3"),h=o("2ef0"),d=o("4ba2"),c=o("9ceb"),l=o("d867"),p=o("b31c"),u=Object(r["defineComponent"])({mixins:[n["a"]],components:{ReportTemplate:d["a"],IonPage:l["D"]},data:()=>({title:"TPT new initiations report",rows:[],cohort:{},canValidate:!1,mohCohort:{},headerList:[],errors:[],showStatus:!1,columns:[[c["a"].thTxt("District"),c["a"].thTxt("Age group"),c["a"].thTxt("Gender"),c["a"].thNum("3HP (Started New on ART)"),c["a"].thNum("6H (Started New on ART)"),c["a"].thNum("3HP (Started Previously on ART)"),c["a"].thNum("6H (Started Previously on ART)")]],totalIpt:[],total3hp:[]}),watch:{async canValidate(t){t&&await this.validateReport()}},created(){this.fields=this.getDateDurationFields()},methods:{async onPeriod(t,e){this.canValidate=!1,this.rows=[],this.errors=[],this.showStatus=!1,this.totalIpt=[],this.total3hp=[],this.report=new s["d"],this.mohCohort=new p["a"],this.mohCohort.setStartDate(e.start_date),this.mohCohort.setEndDate(e.end_date),this.mohCohort.setOccupation(e.occupation),this.report.setOccupation(e.occupation),this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period=this.report.getDateIntervalPeriod(),this.cohort=await this.report.getTptNewInitiations(),this.setRows("F"),this.setRows("M"),this.canValidate=!0,this.showStatus=!0},drilldown(t,e){const o=[[c["a"].thTxt("ARV #"),c["a"].thTxt("DOB"),c["a"].thTxt("Dispensed date")]],r=()=>this.sortByArvNumber(t).map(t=>[c["a"].td(t.arv_number),c["a"].tdDate(t.birthdate),c["a"].tdDate(t.dispensation_date)]);return t.length<=0?c["a"].td(0):c["a"].tdLink(t.length,()=>this.drilldownAsyncRows(e,o,r))},setRows(t){const e=this.formatGender(t);for(const o in i["a"]){const r=i["a"][o],a=this.cohort["Location"];if(!Object(h["isEmpty"])(this.cohort)&&r in this.cohort&&o){const o=this.cohort[r];this.total3hp=Object(h["uniq"])([...this.total3hp,...o["3HP_new"][t],...o["3HP_prev"][t]]),this.totalIpt=Object(h["uniq"])([...this.totalIpt,...o["6H_new"][t],...o["6H_prev"][t]]),this.rows.push([c["a"].td(a),c["a"].td(r),c["a"].td(e),this.drilldown(o["3HP_new"][t],`${r} ${e}s New on 3HP`),this.drilldown(o["6H_new"][t],`${r} ${e}s New on 6H`),this.drilldown(o["3HP_prev"][t],`${r} ${e}s Previously on 3HP`),this.drilldown(o["6H_prev"][t],`${r} ${e}s Previously on 6H`)])}else this.rows.push([c["a"].td(r),c["a"].td(e),c["a"].td(0),c["a"].td(0)])}},validateReport(){const t={newly_initiated_on_3hp:{param:this.total3hp.length,check:(t,e)=>t!=e,error:(t,e)=>`\n                        Total newly initiated on <b>3HP(${e})</b> is not matching newly \n                        initiated on 3HP in Cohort report <b>(${t})</b>.\n                    `},newly_initiated_on_ipt:{param:this.totalIpt.length,check:(t,e)=>t!=e,error:(t,e)=>`\n                        Total newly initiated on IPT <b>(${e})</b> is not matching \n                        newly initiated on IPT in Cohort report <b>(${t})</b>.\n                    `}},e=this.mohCohort.validateIndicators(t,t=>this.errors=t);-1===e&&(this.errors=["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])}}}),w=o("6b0d"),m=o.n(w);const g=m()(u,[["render",a]]);e["default"]=g},b31c:function(t,e,o){"use strict";o.d(e,"a",(function(){return n}));var r,a=o("ade3"),i=(o("13d5"),o("14d9"),o("2ef0")),s=o("5969");(function(t){t["MOH_CACHE"]="mohCache"})(r||(r={}));class n extends s["a"]{constructor(){super(),Object(a["a"])(this,"regenerate",void 0),this.regenerate=!1}cohortUrl(){return`programs/${this.programID}/reports/cohort`}setRegenerate(t){this.regenerate=t}getCohortDrillDown(t){return s["a"].getJson("cohort_report_drill_down",{id:t,date:this.date,program_id:this.programID})}requestCohort(t){return s["a"].ajxGet(this.cohortUrl(),t)}qaurterRequestParams(){const t={name:this.quarter,regenerate:this.regenerate};return this.occupation&&(t["occupation"]=this.occupation),t}datePeriodRequestParams(){const t={name:`Cohort-${this.startDate}-${this.endDate}`,start_date:this.startDate,end_date:this.endDate,regenerate:this.regenerate};return this.occupation&&(t["occupation"]=this.occupation),t}getCachedCohortValues(){const t=sessionStorage.getItem(r.MOH_CACHE);if(t){const e=JSON.parse(t);if(e.start_date===this.startDate&&e.end_date===this.endDate||e.quarter===this.quarter)return e.data}}cacheCohort(t){sessionStorage.setItem(r.MOH_CACHE,JSON.stringify({start_date:this.startDate,end_date:this.endDate,quarter:this.quarter,data:t}))}validateIndicators(t,e){const o=this.getCachedCohortValues();if(o){const r=Object.keys(t).reduce((e,r)=>{const a=Object(i["find"])(o,{name:r}),s=t[r],n=a?a.contents:null,h=s.param,d=s.check(parseInt(n),h);return d&&e.push(s.error(n,h)),e},[]);return e(r)}return-1}}}}]);
//# sourceMappingURL=chunk-13d2b701.32332056.js.map