(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a7bd0066"],{"25eb":function(e,t,n){var r=n("23e7"),a=n("c20d");r({target:"Number",stat:!0,forced:Number.parseInt!=a},{parseInt:a})},3800:function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"l",(function(){return a})),n.d(t,"e",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"k",(function(){return o})),n.d(t,"i",(function(){return c})),n.d(t,"g",(function(){return s})),n.d(t,"a",(function(){return l})),n.d(t,"j",(function(){return d})),n.d(t,"c",(function(){return p})),n.d(t,"h",(function(){return f})),n.d(t,"f",(function(){return h}));var r=[["1","2","3"],["4","5","6"],["7","8","9"],[".","0","Del"],["","Done",""]],a=[["1","2","3"],["4","5","6"],["7","8","9"],[".","0","Del"],["Clear","%","/"]],i=[["1","2","3"],["4","5","6"],["7","8","9"],["Del.","0","Clear"]],u=[["1","2","3","<"],["4","5","6",">"],["7","8","9","="],["","0",""]],o=[["1","2","3","+","-","/","*"],["4","5","6","%","=","<",">","Qwerty"],["7","8","9",".",","],["","0",""]],c=[["1","2","3"],["4","5","6"],["7","8","9"],["","0",""]],s=[["1","2","3","4","5","6","7"],["8","9","10","11","12","13","14"],["15","16","17","18","19","20","21"],["22","23","24","25","26","27","28"],["29","30","31"]],l=[["a","b","c","d","e","f","g","h","."],["i","j","k","l","m","n","o","p","q"],["r","s","t","u","v","w","x","y","z"]],d=[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l","'"],["z","x","c","v","b","n","m",",",".","A-Z"]],p=[["1","2","3","4","5","6","7","8","9","0"],["a","b","c","d","e","f","g","h","-","."],["i","j","k","l","m","n","o","p","q"],["r","s","t","u","v","w","x","y","z"]],f=[["1","2","3","4","5","6","7","8","9","0","Del"],["q","w","e","r","t","y","u","i","o","p","Clear"],["a","s","d","f","g","h","j","k","l",".","Caps"],["z","x","c","v","b","n","m","<",">","/","Enter"]],h=[["1","2","3","4","5","6","7","8","9","0"],["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l","Del."],["z","x","c","v","b","n","m","Caps","Login"]]},7052:function(e,t,n){"use strict";n.r(t);var r=n("7a23");function a(e,t,n,a,i,u){var o=Object(r["resolveComponent"])("his-standard-form");return Object(r["openBlock"])(),Object(r["createBlock"])(o,{fields:e.fields,activeField:e.activeField,onFinishAction:e.onFinish,skipSummary:!0},null,8,["fields","activeField","onFinishAction"])}var i=n("5530"),u=n("1da1"),o=(n("96cf"),n("99af"),n("a15b"),n("d81d"),n("4de4"),n("d3b7"),n("ddb0"),n("159b"),n("d95e")),c=n("7920"),s=n("3800"),l=n("2706"),d=n("d4ec"),p=n("bee2"),f=(n("ac1f"),n("1276"),n("25f0"),n("25eb"),n("a9e3"),n("fb6a"),function(){function e(){var t=this;Object(d["a"])(this,e),this.BASE30_DIGITS_INDEX={},this.BASE30_DIGITS="0123456789ABCDEFGHJKLMNPRTVWXY".split(""),this.BASE30_DIGITS.forEach((function(e,n){return t.BASE30_DIGITS_INDEX[e]=n}))}return Object(p["a"])(e,[{key:"convertFromDecimal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;if(t<2||t>30)throw"Invalid base ${toBase}";var n="";while(e>0)n=this.BASE30_DIGITS[e%t]+n,e=Math.floor(e/t);return n}},{key:"isValidDHACode",value:function(t){try{var n=this.convertToDecimal(t).toString(),r=(Number.parseInt(n[0],10),e.calculateLuhnCheckDigit(10*Number.parseInt(n,10)));return 0===r}catch(a){return console.error(a),!1}}},{key:"convertToDecimal",value:function(e){if(0==e.length)return 0;var t=this.BASE30_DIGITS_INDEX[e[0]];if(void 0===t||null===t)throw"Invalid base ${fromBase} number: ${number}";return t*Math.pow(30,e.length-1)+this.convertToDecimal(e.slice(1))}}],[{key:"calculateLuhnCheckDigit",value:function(e){var t=e.toString().split("").map((function(e){return Number.parseInt(e,10)})),n=t.length%2,r=0;t.forEach((function(e,t){t%2===n&&(e*=2),e>9&&(e-=9),r+=e}));var a=r%10;return 0===a?0:10-a}}]),e}()),h=n("9283"),m=n("3d6c"),v=n("b5e4"),b=n("e86e"),g=n("1c74"),y=n("2ef0"),x=Object(r["defineComponent"])({components:{HisStandardForm:c["a"]},data:function(){return{activeField:"",fields:[],drugs:[],selectedDrugs:[],barcode:"",stockService:{}}},methods:{onFinish:function(e){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function n(){var r,a,u,o,c,s,l,d,p,f;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=e.enter_batches,a=[],u=0;case 3:if(!(u<r.length)){n.next=31;break}if(o=r[u].value,c=m["a"].getPackSize(o.drug_id),s=c*o.tins,l={},d={reallocation_code:e.authorization.value,quantity:s,reason:e.reasons.value},n.prev=9,"Relocations"!==e.task.value){n.next=18;break}return l["location_id"]=e.relocation_location.value,n.next=14,t.stockService.relocateItems(o.id,Object(i["a"])(Object(i["a"])({},d),l));case 14:p=n.sent,p||a.push("Could not save record for"+m["a"].getShortName(o.drug_id)),n.next=22;break;case 18:return n.next=20,t.stockService.disposeItems(o.id,Object(i["a"])(Object(i["a"])({},d),l));case 20:f=n.sent,f||a.push("Could not save record for"+m["a"].getShortName(o.drug_id));case 22:n.next=28;break;case 24:n.prev=24,n.t0=n["catch"](9),n.t0 instanceof g["a"]&&!Object(y["isEmpty"])(n.t0.errors)?a=a.concat(n.t0.errors):a.push(n.t0),console.log(n.t0);case 28:u++,n.next=3;break;case 31:0===a.length?(Object(v["d"])("Stock succesfully moved"),t.$router.push("/")):Object(v["c"])("".concat(a.join(",")));case 32:case"end":return n.stop()}}),n,null,[[9,24]])})))()},getFields:function(){var e=this;return[{id:"task",helpText:"Select task",type:o["b"].TT_SELECT,validation:function(e){return l["a"].required(e)},options:function(){return[{label:"Relocations",value:"Relocations"},{label:"Disposal",value:"Disposal"}]}},{id:"relocation_location",helpText:"Destination",type:o["b"].TT_SELECT,validation:function(e){return l["a"].required(e)||l["a"].notTheSame(e.label,"".concat(m["a"].getLocationName()))},condition:function(e){return"Relocations"===e.task.value},options:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(b["b"])(t)},computedValue:function(e){return e.label},config:{showKeyboard:!0,isFilterDataViaApi:!0}},{id:"date",dynamicHelpText:function(e){return"Date of ".concat(e.task.label)},helpText:"Set date",type:o["b"].TT_FULL_DATE,validation:function(e){return l["a"].required(e)}},{id:"select drugs",helpText:"Select drugs",type:o["b"].TT_MULTIPLE_SELECT,requireNext:!0,validation:function(e){return l["a"].required(e)},options:function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(n,r){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getItems();case 2:return a=t.sent,t.abrupt("return",a.map((function(e){return e.isChecked=r.filter((function(t){return t.label===e.label})).length>=1,e})));case 4:case"end":return t.stop()}}),t)})));function n(e,n){return t.apply(this,arguments)}return n}(),unload:function(t){return e.selectedDrugs=t}},{id:"enter_batches",helpText:"Batch entry",type:o["b"].TT_BATCH_MOVEMENT,beforeNext:function(e,t,n,r){var a=r.currentFieldContext,i=function(e){return e.map((function(e,t){return"".concat(e.label)})).join(" & ")},u=a.drugs.filter((function(e){return e.entries.map((function(e){return!e.tins})).every(Boolean)}));if(!Object(y["isEmpty"])(u)){var o=i(u);return Object(v["e"])("Please fix partial batch entries for drugs: ".concat(o)),!1}return!0},options:function(){return e.selectedDrugs},validation:function(e){return l["a"].required(e)}},{id:"authorization",helpText:"Enter authorization code",type:o["b"].TT_TEXT,config:{customKeyboard:[s["c"],[["Delete"]]]},validation:function(e){return l["a"].validateSeries([function(){return l["a"].required(e)},function(){var t=e.value,n=new f;return n.isValidDHACode(t.toUpperCase())?null:["Invalid authorization code"]}])}},{id:"reasons",helpText:"Select reason",type:o["b"].TT_SELECT,validation:function(e){return l["a"].required(e)},options:function(t){return e.getReasons(t)}},{id:"summary",helpText:"Summary",type:o["b"].TT_TABLE_VIEWER,options:function(t){return e.buildResults(t)},config:{hiddenFooterBtns:["Clear"]}}]},buildResults:function(e){var t="Relocations"===e.task.value,n=["Drug","Total Tins","Expiry date","Authorization code"];t&&n.push("Relocation");var r=e.enter_batches.map((function(n){var r=n.value,a=[m["a"].getShortName(r.drug_id),r.tins,h["c"].toStandardHisDisplayFormat(r.expiry_date),e.authorization.value.toUpperCase()];return t&&a.push(e.relocation_location.label),a}));return[{label:"Confirm entry",value:"Table",other:{columns:n,rows:r}}]},prepDrugs:function(e){var t=[],n=this.barcode;return e.enter_batches.value.forEach((function(r){t.push({batch_number:r.batchNumber,items:[{barcode:n,drug_id:r.drugID,expiry_date:r.expiry,quantity:parseInt(r.tabs)*parseInt(r.tins),delivery_date:e.date.value}]})})),t},selectAll:function(e){return e.map((function(e){return e.isChecked=!0,e}))},getItems:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.stockService.getItems();case 2:return n=t.sent,t.abrupt("return",e.formatDrugs(n));case 4:case"end":return t.stop()}}),t)})))()},mapVal:function(e){return e.map((function(e){return{label:e,value:e}}))},getReasons:function(e){return"Relocations"===e.task.value?this.mapVal(["Transfer to another facility/relocation","For trainings"]):this.mapVal(["Expired","Damaged","Phased out","Banned","Missing"])},formatDrugs:function(e){return e.map((function(e){return{label:"".concat(m["a"].getShortName(e.drug_id)," (").concat(m["a"].getPackSize(e.drug_id),") Expiry date: ").concat(h["c"].toStandardHisDisplayFormat(e.expiry_date)," \n          Batch (").concat(e.batch_number,")\n          "),value:e}}))}},created:function(){this.stockService=new m["a"],this.fields=this.getFields()}}),k=n("d959"),w=n.n(k);const S=w()(x,[["render",a]]);t["default"]=S},7920:function(e,t,n){"use strict";var r=n("7a23");function a(e,t,n,a,i,u){return Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["resolveDynamicComponent"])(e.formType),{fields:e.fields,skipSummary:e.skipSummary,activeField:e.activeField,cancelDestinationPath:e.cancelDestinationPath,onOnFinish:e.onFinish,onFinish:e.onFinishAction,onOnIndex:e.onIndex},null,8,["fields","skipSummary","activeField","cancelDestinationPath","onOnFinish","onFinish","onOnIndex"])}var i=n("9441"),u=Object(r["defineComponent"])({name:"HisStandardForm",components:{TouchScreenForm:i["a"]},emits:["onFinish","onIndex"],data:function(){return{formType:"touch-screen-form"}},props:{onFinishAction:{type:Function},skipSummary:{type:Boolean,default:!1},activeField:{type:String},fields:{type:Object,required:!0},cancelDestinationPath:{type:String,required:!1}},methods:{onFinish:function(e,t){this.$emit("onFinish",e,t)},onIndex:function(e){this.$emit("onIndex",e)}}}),o=n("d959"),c=n.n(o);const s=c()(u,[["render",a]]);t["a"]=s},c20d:function(e,t,n){var r=n("da84"),a=n("58a8").trim,i=n("5899"),u=r.parseInt,o=/^[+-]?0[Xx]/,c=8!==u(i+"08")||22!==u(i+"0x16");e.exports=c?function(e,t){var n=a(String(e));return u(n,t>>>0||(o.test(n)?16:10))}:u},e86e:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"d",(function(){return c})),n.d(t,"c",(function(){return l})),n.d(t,"g",(function(){return p})),n.d(t,"f",(function(){return h})),n.d(t,"a",(function(){return v})),n.d(t,"h",(function(){return g})),n.d(t,"i",(function(){return x})),n.d(t,"j",(function(){return w})),n.d(t,"e",(function(){return T}));var r=n("1da1"),a=(n("96cf"),n("d81d"),n("4de4"),n("d3b7"),n("498a"),n("b0c0"),n("5713")),i=n("2ef0");function u(){return o.apply(this,arguments)}function o(){return o=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,n,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"",e.next=3,a["a"].getFacilities({name:t});case 3:return n=e.sent,e.abrupt("return",n.filter((function(e){return!Object(i["isEmpty"])(e)&&""!=e.name.trim()})).map((function(e){return{label:e.name,value:e.location_id,other:e}})));case 5:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function c(){return s.apply(this,arguments)}function s(){return s=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,n,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"",e.next=3,a["a"].getLabs({search_name:t});case 3:return n=e.sent,e.abrupt("return",n.map((function(e){return{label:e,value:e}})));case 5:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}function l(){return d.apply(this,arguments)}function d(){return d=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,n,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"",e.next=3,a["a"].getFacilities({name:t,tag:"Facility adult sections"});case 3:return n=e.sent,e.abrupt("return",n.map((function(e){return{label:e.name,value:e.name,other:e}})));case 5:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function p(){return f.apply(this,arguments)}function f(){return f=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a["a"].getSpecialistClinics();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return{label:e.name,value:e.name,other:e}})));case 4:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function h(){return m.apply(this,arguments)}function m(){return m=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a["a"].getRegions();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return{label:e.name,value:e.region_id,other:e}})));case 4:case"end":return e.stop()}}),e)}))),m.apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return b=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a["a"].getDistricts(t);case 2:return n=e.sent,e.abrupt("return",n.map((function(e){return{label:e.name,value:e.district_id,other:e}})));case 4:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}function g(e){return y.apply(this,arguments)}function y(){return y=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,r,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"",e.next=3,a["a"].getTraditionalAuthorities(t,n);case 3:return r=e.sent,e.abrupt("return",r.map((function(e){return{label:e.name,value:e.traditional_authority_id,other:e}})));case 5:case"end":return e.stop()}}),e)}))),y.apply(this,arguments)}function x(e){return k.apply(this,arguments)}function k(){return k=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,r,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"",e.next=3,a["a"].getVillages(t,n);case 3:return r=e.sent,e.abrupt("return",r.map((function(e){return{label:e.name,value:e.village_id,other:e}})));case 5:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function w(){return S.apply(this,arguments)}function S(){return S=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,n,r,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"a",n=i.length>1&&void 0!==i[1]?i[1]:1,e.next=4,a["a"].getVillagesByName(t,n);case 4:return r=e.sent,e.abrupt("return",r.map((function(e){return{label:e.name,value:e.village_id,other:e}})));case 6:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function T(){var e=["Catholic Church","CCAP","Seventh Day","Mosque","Primary School","Borehole","Secondary School","College","Market","Football Ground","Other"];return e.map((function(e){return{label:e,value:e,other:{code:e}}}))}}}]);
//# sourceMappingURL=chunk-a7bd0066.a0a72613.js.map