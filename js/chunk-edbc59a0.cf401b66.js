(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-edbc59a0"],{7920:function(e,t,n){"use strict";var a=n("7a23");function o(e,t,n,o,i,r){return Object(a["openBlock"])(),Object(a["createBlock"])(Object(a["resolveDynamicComponent"])(e.formType),{fields:e.fields,skipSummary:e.skipSummary,activeField:e.activeField,cancelDestinationPath:e.cancelDestinationPath,onOnFinish:e.onFinish,onFinish:e.onFinishAction,onOnIndex:e.onIndex},null,40,["fields","skipSummary","activeField","cancelDestinationPath","onOnFinish","onFinish","onOnIndex"])}var i=n("9441"),r=Object(a["defineComponent"])({name:"HisStandardForm",components:{TouchScreenForm:i["a"]},emits:["onFinish","onIndex"],data:()=>({formType:"touch-screen-form"}),props:{onFinishAction:{type:Function},skipSummary:{type:Boolean,default:!1},activeField:{type:String},fields:{type:Object,required:!0},cancelDestinationPath:{type:String,required:!1}},methods:{onFinish(e,t){this.$emit("onFinish",e,t)},onIndex(e){this.$emit("onIndex",e)}}}),s=n("6b0d"),l=n.n(s);const c=l()(r,[["render",o]]);t["a"]=c},"8dd5":function(e,t,n){"use strict";n.r(t);var a=n("7a23");function o(e,t,n,o,i,r){const s=Object(a["resolveComponent"])("his-standard-form"),l=Object(a["resolveComponent"])("ion-page");return Object(a["openBlock"])(),Object(a["createBlock"])(l,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{formLabel:"Appointment",fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:e.patientDashboardUrl()},null,8,["fields","onFinishAction","cancelDestinationPath"])]),_:1})}n("13d5");var i=n("d95e"),r=n("d867"),s=n("cc6f");class l extends s["a"]{constructor(e,t=-1){super(e,7,t)}nextAppointment(){return s["a"].getJson(`/programs/${this.programID}/patients/${this.patientID}/next_appointment_date`,{date:this.date})}}var c=n("e86e"),u=n("5a0c"),d=n.n(u),_=n("0011"),m=n("b432"),f=n("7920"),g=n("e9be"),p=n("9283"),b=Object(a["defineComponent"])({components:{IonPage:r["D"],HisStandardForm:f["a"]},setup(){const e=Object(a["ref"])([]),t=new l(-1),n=Object(a["ref"])(!1),{visitID:o,htsClient:r,getEncounter:s,patientDashboardUrl:u,saveEncounter:f,toOption:b}=Object(g["a"])({onInitVisit:()=>{e.value=[O(),h(),D()]}});function h(){return{id:"referral_location",helpText:"Intended site for retesting",type:i["b"].TT_SELECT,isRequired:()=>!0,finalComputedValue:({label:e})=>({obs:t.buildValueText("Referral location",e)}),defaultValue:()=>l.getLocationName(),condition:e=>"Not done"!=e.re_test.value,options:(e,t="")=>Object(c["b"])(t),config:{footerBtns:[{name:"Here",slot:"end",onClickComponentEvents:{setValue:()=>l.getLocationName()},onClick:()=>null}],showKeyboard:!0,isFilterDataViaApi:!0}}}function v(){const e=s("Testing");if(!e)return t.date;const n={14:["Positive Initial Professional"===e["HIV status"],"Inconclusive"===e["HIV status"]],28:[/negative/i.test(e["HIV status"])&&/High risk event in last 3 months|not done/i.test(e["client risk category"])],365:[/negative/i.test(e["HIV status"])&&/On-going risk/i.test(e["client risk category"])]};return Object.keys(n).reduce((e,a)=>!e&&n[a].some(Boolean)?d()(t.date).add(a,"days").format(p["a"]):e,"")}function O(){let e=null;return{id:"re_test",helpText:"Referral for Re-Testing",type:i["b"].TT_TEXT_BANNER,init:async()=>{let t="",a="",i="";const c=new l(o.value),u=s("Testing");if(u?(t=u["HIV status"]||"N/A",a=u["client risk category"]||"N/A"):Object(m["a"])().isOfflineMode.value||(a=await c.getFirstValueCoded("client risk category")||"N/A",t=await c.getFirstValueCoded("HIV Status")||"N/A"),"F"===r.gender){const e=s("PREGNANCY STATUS");e?i=e["Pregnancy status"]:Object(m["a"])().isOfflineMode.value||(i=await c.getFirstValueCoded("Pregnancy status")||"N/A")}return/Negative/i.test(t)&&"BREASTFEEDING"===i?(n.value=!0,e={label:"Book a Re-Test for Female Breastfeeding Client",value:"Re-test"}):/Negative/i.test(t)&&"Pregnant woman"==i?(n.value=!0,e={label:"Book a Re-Test for Female Pregnant Client",value:"Re-test"}):e=/Positive Initial Professional/i.test(t)?{label:"Confirmatory test is needed for Positive result",value:"Confirmatory HIV test"}:/high risk|High risk event|on-going/i.test(""+a)?{label:`Retesting is required due to "${a}"`,value:"Re-test"}:{label:"No re-test required",value:"Not done"},!0},defaultValue:()=>(console.log(e.value),b(e.value)),condition:()=>null!=e,finalComputedValue:e=>({obs:t.buildValueCoded("Referral for Re-Testing",e.value)}),options:()=>[b(e.label)]}}function D(){let e="",a="";return{id:"set_appointment",helpText:"Select Appointment Date for Re-testing",type:i["b"].TT_DATE_PICKER,init:async()=>{if(a=t.date,n.value)e=d()(a).add(365,"day").format("YYYY-MM-DD");else try{a=v(),e=d()(a).add(15,"day").format("YYYY-MM-DD")}catch(o){}return!0},isRequired:()=>!0,condition:e=>e.referral_location.value,defaultValue:()=>a,finalComputedValue:e=>({obs:t.buildValueDate("Appointment date",""+e.value)}),config:{minDate:()=>a,maxDate:()=>e,infoItems:e=>[{label:"System set appointment",value:Object(_["h"])(a)},{label:"User set appointment",value:Object(_["h"])(e)}],hiddenFooterBtns:["Clear"]}}}function E(e,n){f({encounterName:"APPOINTMENT",encounterTypeID:t.encounterTypeID,computedData:n})}return{patientDashboardUrl:u,onFinish:E,fields:e}}}),h=n("6b0d"),v=n.n(h);const O=v()(b,[["render",o]]);t["default"]=O},"8e3d":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return storageFactory}));var _home_andrew_dev_Projects_HIS_Core_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ade3"),lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("2ef0"),lodash__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);const INDEX_STORE="openmrs",DB_NAME="offline_db",storageFactory=(storageName="IndexedDBStorage")=>eval(`new ${storageName}()`);class LocalStorage{existsinStorage(e){const t=localStorage.getItem(e);return t?Promise.resolve(!0):Promise.resolve(!1)}getFromStorage(e){return new Promise((t,n)=>{const a=localStorage.getItem(e);if(a)return t(JSON.parse(a));t([])})}deleteFromStorage(e){return localStorage.removeItem(e),!0}saveToStorage(e,t){return localStorage.setItem(e,JSON.stringify(t)),!0}}class IndexedDBStorage{constructor(){Object(_home_andrew_dev_Projects_HIS_Core_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"db",void 0);const e=indexedDB.open(DB_NAME,1);e.onupgradeneeded=function(){e.result.createObjectStore(INDEX_STORE)},e.onsuccess=()=>{this.db=e.result}}existsinStorage(e){return new Promise((t,n)=>{const a=this.db.transaction(INDEX_STORE).objectStore(INDEX_STORE).get(e);a.onsuccess=()=>{t(a.result)},a.onerror=()=>{n(a.error)}})}getFromStorage(e,t){return new Promise((n,a)=>{const o=this.db.transaction(INDEX_STORE).objectStore(INDEX_STORE).openCursor();o.onsuccess=()=>{const a=o.result;a?(a.key===e&&n(t?filteredData(a,t):a.value.data),a.continue()):n([])},o.onerror=()=>{a("error")}})}saveToStorage(e,t){return this.db.transaction(INDEX_STORE,"readwrite").objectStore(INDEX_STORE).put(t,e),!0}deleteFromStorage(e){return this.db.transaction(INDEX_STORE,"readwrite").objectStore(INDEX_STORE).delete(e),!0}}function filteredData(e,t){return Object(lodash__WEBPACK_IMPORTED_MODULE_1__["filter"])(e.value,e=>Object.entries(t).every(([t,n])=>Object(lodash__WEBPACK_IMPORTED_MODULE_1__["isInteger"])(e[t])?!n||e[t]===n:!n||Object(lodash__WEBPACK_IMPORTED_MODULE_1__["toLower"])(e[t]).includes(Object(lodash__WEBPACK_IMPORTED_MODULE_1__["toLower"])(n))))}},e86e:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return c})),n.d(t,"c",(function(){return u})),n.d(t,"f",(function(){return d})),n.d(t,"e",(function(){return _})),n.d(t,"a",(function(){return m})),n.d(t,"g",(function(){return f})),n.d(t,"h",(function(){return g}));var a=n("5713"),o=n("8e3d"),i=n("13ea"),r=n.n(i);const s=Object(o["a"])();async function l(e=""){let t=await s.getFromStorage("locations",{name:e});return r()(t)&&(t=await a["a"].getFacilities({name:e})),t.filter(e=>!r()(e)&&""!=e.name.trim()).map(e=>({label:e.name,value:e.location_id,other:e}))}async function c(e=""){const t=await a["a"].getLabs({search_name:e});return t.map(e=>({label:e,value:e}))}async function u(e=""){const t=await a["a"].getFacilities({name:e,tag:"Facility adult sections"});return t.map(e=>({label:e.name,value:e.name,other:e}))}async function d(){const e=await a["a"].getSpecialistClinics();return e.map(e=>({label:e.name,value:e.name,other:e}))}async function _(){let e=await s.getFromStorage("regions",[]);return r()(e)&&(e=await a["a"].getRegions()),e.map(e=>({label:e.name,value:e.region_id,other:e}))}async function m(e){let t=await s.getFromStorage("districts",{region_id:e});return r()(t)&&(t=await a["a"].getDistricts(e)),t.map(e=>({label:e.name,value:e.district_id,other:e}))}async function f(e,t=""){let n=await s.getFromStorage("traditional_authorities",{district_id:e,name:t});return r()(n)&&(n=await a["a"].getTraditionalAuthorities(e,t)),n.map(e=>({label:e.name,value:e.traditional_authority_id,other:e}))}async function g(e,t=""){let n=await s.getFromStorage("villages",{traditional_authority_id:e,name:t});return r()(n)&&(n=await a["a"].getVillages(e,t)),n.map(e=>({label:e.name,value:e.village_id,other:e}))}}}]);
//# sourceMappingURL=chunk-edbc59a0.cf401b66.js.map