(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03bca019"],{"0a4b":function(t,e,i){"use strict";i.r(e);var a=i("7a23");function n(t,e,i,n,r,s){const o=Object(a["resolveComponent"])("his-standard-form");return Object(a["openBlock"])(),Object(a["createBlock"])(o,{onOnIndex:e[1]||(e[1]=e=>t.fieldComponent=""),skipSummary:!0,activeField:t.fieldComponent,fields:t.fields,onFinishAction:t.onFinish,cancelDestinationPath:"/patient/dashboard/"+t.patientData.id},null,8,["activeField","fields","onFinishAction","cancelDestinationPath"])}var r=i("d95e"),s=i("7920"),o=i("b446"),d=i("2706"),l=i("23e6"),c=i("9283"),h=i("1c74");class u extends h["e"]{constructor(){super()}static voidRelation(t,e,i){return h["e"].void(`people/${t}/relationships/${e}`,{reason:i})}static async amendRelation(t,e,i,a){return await u.voidRelation(t,i,"Updating guardian relationship"),u.createRelation(t,e,a)}static getRelations(){return super.getJson("types/relationships")}static createRelation(t,e,i){return super.postJson(`people/${t}/relationships`,{relationship_type_id:i,relation_id:e})}}var g=i("2ef0"),p=i("80b5"),m=i("1f9a"),_=i("0fa1"),f=i("b5e4"),b=i("7def"),D=i("7f35"),y=i("8734"),F=i("76df"),v=Object(a["defineComponent"])({components:{HisStandardForm:s["a"]},data:()=>({patientData:{},guardianData:{},fieldAction:"",fieldComponent:"",fields:[],form:{},redirectURL:"",activeField:"",currentAddressAttributes:["current_region","current_district","current_village","current_traditional_authority"],homeAddressAttributes:["home_region","home_district","home_traditional_authority","home_village"]}),watch:{$route:{async handler({params:t,query:e}){if(t.patient_id){const i=await l["a"].findByID(t.patient_id);i&&(this.patientData=p["a"].mapPersonData(i.person),e.edit_guardian&&(this.fieldAction="edit"),this.fields=this.getFields())}e.source&&(this.redirectURL=e.source)},immediate:!0,deep:!0}},methods:{getFields(){let t=[];return t.push(this.guardianSelection()),t.push(this.guardianIndex()),t.push(this.scanGuardian()),t.push(this.givenNameField()),t.push(this.familyNameField()),t.push(this.genderField()),t.push(this.searchResultField()),t=t.concat(this.dobFields()),t.push(this.homeRegionField()),t.push(this.homeDistrictField()),t.push(this.homeTAField()),t.push(this.homeVillageField()),t.push(this.currentRegionField()),t.push(this.currentDistrictField()),t.push(this.currentTAField()),t.push(this.currentVillage()),t=t.concat(this.landmarkFields()),t.push(this.cellPhoneField()),t.push(this.relationsField()),t},async onFinish(t,e){if(this.isEditMode()){if("relations"!=this.activeField){const t=new m["a"];t.setPersonID(this.guardianData.id),await t.updatePerson(p["a"].resolvePerson(e)),Object.keys(e).forEach(t=>{var i;t in this.guardianData&&(this.guardianData[t]=(null===(i=e[t])||void 0===i?void 0:i.date)||e[t].person)})}else{var i;if(null!==(i=this.guardianData)&&void 0!==i&&i.relation){const e=await u.amendRelation(this.patientData.id,this.guardianData.id,this.guardianData.relation.relationship_id,t.relations.other.relationship_type_id);e&&(this.guardianData.relation=e)}}this.fieldComponent="guardian_index"}else if(this.isSameAsPatient(e))Object(f["e"])("Guardian cannot be the same patient");else{let i=-1;if(this.isRegistrationMode()){const t=new m["a"];await t.registerGuardian(p["a"].resolvePerson(e)),i=t.getPersonID()}else i=this.guardianData.id;await u.createRelation(this.patientData.id,i,t.relations.other.relationship_type_id),this.redirectURL?this.$router.push({name:this.redirectURL}):this.$route.query.edit_guardian?this.fieldComponent="select_guardian":await Object(_["b"])(this.patientData.id,this.$router,this.$route)}},isEditMode(){return"edit"===this.fieldAction},isSearchMode(){return["Search","Registration"].includes(this.fieldAction)},isRegistrationMode(){return"Registration"===this.fieldAction},canEdit(t,e=!0,i=!0){return this.isEditMode()?t.includes(this.activeField)&&i:e},isSameAsPatient(t){let e="",i="",a="";return this.isRegistrationMode()?(e=c["b"].toStandardHisDisplayFormat(t.birth_date.date),i=t.given_name.person&&t.family_name.person,a=t.gender.person):(e=this.guardianData.birth_date,i=this.guardianData.name,a=this.guardianData.gender),i.toLowerCase()===this.patientData.name.toLowerCase()&&e===this.patientData.birth_date&&a===this.patientData.gender},guardianSelection(){return{id:"select_guardian",helpText:"Select guardian to edit/view",type:r["b"].TT_SELECT,condition:()=>this.isEditMode(),validation:t=>d["a"].required(t),options:async()=>{const t=await b["a"].getRelationships(this.patientData.id);if(!Object(g["isEmpty"])(t))return t.map(t=>{const e=p["a"].mapPersonData(t.relation);return{label:`${e.name} (${t.type.b_is_to_a})`,value:t.relation.person_id,other:{relations:t,details:e}}});{await Object(y["a"])(450);const t=await Object(D["a"])("Patient has no guardians","","Select option to proceed",[{name:"Cancel",slot:"start",color:"danger"},{name:"Register new",slot:"start",color:"success"}]);"Register new"===t?(this.guardianData={},this.fieldAction="Registration",this.fieldComponent="scan"):this.$router.back()}return[]},config:{footerBtns:[{name:"New Guardian",slot:"end",color:"primary",onClick:()=>{this.guardianData={},this.fieldAction="Registration",this.fieldComponent="scan"}}]}}},getDefaultVal(t){try{return this.guardianData[t]}catch(e){return""}},guardianIndex(){return{id:"guardian_index",helpText:"Guardian details",type:r["b"].TT_TABLE_VIEWER,condition:t=>t.select_guardian.value,options:t=>{this.guardianData&&this.guardianData.id!=t.select_guardian.value&&(this.guardianData={...t.select_guardian.other.details,relation:t.select_guardian.other.relations});const e=t=>({name:"Edit",type:"button",action:()=>{this.activeField=t,this.fieldComponent=this.activeField}}),i=[["Given Name",this.guardianData.given_name,e("given_name")],["Family Name",this.guardianData.family_name,e("family_name")],["Gender",this.guardianData.gender,e("gender")],["Birthdate",c["b"].toStandardHisDisplayFormat(this.guardianData.birth_date),e("year_birth_date")],["Cell Phone Number",this.guardianData.cell_phone_number,e("cell_phone_number")],["Home District",this.guardianData.home_district,e("home_region")],["Home TA",this.guardianData.home_traditional_authority,e("home_region")],["Home Village",this.guardianData.home_village,e("home_region")],["Current district",this.guardianData.current_district,e("current_region")],["Current T/A",this.guardianData.current_traditional_authority,e("current_region")],["Landmark",this.guardianData.landmark,e("default_landmarks")],["Relation",this.guardianData.relation.type.b_is_to_a,e("relations")]];return[{label:"",value:"",other:{rows:i}}]},config:{overrideDefaultFooterBtns:{nextBtn:{name:"Finish",slot:"end",color:"success",onClick:()=>this.fieldComponent="select_guardian"}},footerBtns:[{name:"Void Relation",slot:"start",color:"danger",onClick:async()=>{Object(F["a"])(async t=>{await u.voidRelation(this.patientData.id,this.guardianData.relation.relationship_id,t),this.fieldComponent="select_guardian"})}}],hiddenFooterBtns:["Clear","Back"]}}},givenNameField(){const t=p["a"].getGivenNameField();return t.helpText="Guardian First name",t.defaultValue=()=>this.getDefaultVal(t.id),t.condition=()=>this.canEdit([t.id],this.isSearchMode()),t},familyNameField(){const t=p["a"].getFamilyNameField();return t.helpText="Guardian Last name",t.defaultValue=()=>this.getDefaultVal(t.id),t.condition=()=>this.canEdit([t.id],this.isSearchMode()),t},genderField(){const t=p["a"].getGenderField();return t.defaultValue=()=>this.getDefaultVal(t.id),t.condition=()=>this.canEdit([t.id],this.isSearchMode()),t},dobFields(){const t=p["a"].getDobConfig();return t.defaultValue=()=>this.getDefaultVal("birth_date"),t.condition=()=>this.canEdit(["year_birth_date","month_birth_date","day_birth_date"],this.isRegistrationMode()),Object(o["b"])(t)},homeRegionField(){const t=p["a"].getHomeRegionField();return t.condition=()=>this.canEdit(this.homeAddressAttributes,this.isRegistrationMode()),t},homeDistrictField(){const t=p["a"].getHomeDistrictField();return t.condition=()=>this.canEdit(this.homeAddressAttributes,this.isRegistrationMode()),t},homeTAField(){const t=p["a"].getHomeTaField();return t.condition=t=>this.canEdit(this.homeAddressAttributes,this.isRegistrationMode()&&!t.home_region.label.match(/foreign/i),!t.home_region.label.match(/foreign/i)),t},homeVillageField(){const t=p["a"].getHomeVillageField();return t.condition=t=>this.canEdit(this.homeAddressAttributes,this.isRegistrationMode()&&!t.home_region.label.match(/foreign/i),!t.home_region.label.match(/foreign/i)),t},currentRegionField(){const t=p["a"].getCurrentRegionField();return t.condition=()=>this.canEdit(this.currentAddressAttributes,this.isRegistrationMode()),t},currentDistrictField(){const t=p["a"].getCurrentDistrictField();return t.condition=()=>this.canEdit(this.currentAddressAttributes,this.isRegistrationMode()),t},currentTAField(){const t=p["a"].getCurrentTAfield();return t.condition=t=>this.canEdit(this.currentAddressAttributes,this.isRegistrationMode()&&!t.current_region.label.match(/foreign/i),!t.current_region.label.match(/foreign/i)),t},currentVillage(){const t=p["a"].getCurrentVillageField();return t.condition=t=>this.canEdit(this.currentAddressAttributes,this.isRegistrationMode()&&!t.current_region.label.match(/foreign/i),!t.current_region.label.match(/foreign/i)),t},cellPhoneField(){const t=p["a"].getCellNumberField();return t.condition=()=>this.canEdit([t.id],this.isRegistrationMode()),t},landmarkFields(){const t=p["a"].getLandmarkFields(),e=t[0].proxyID||t[0].id;return t[0].defaultValue=()=>this.getDefaultVal(e),t[0].condition=()=>this.canEdit([e],this.isRegistrationMode()),t},relationsField(){return{id:"relations",helpText:"Select relationship type",type:r["b"].TT_RELATION_SELECTION,defaultValue:()=>this.getDefaultVal("relations"),validation:t=>d["a"].required(t),condition:()=>this.canEdit(["relations"]),onload:t=>{if(t.patient=this.patientData,this.isRegistrationMode()){const e=p["a"].resolvePerson(t.cdata);t.guardian={name:`${e.given_name} ${e.family_name}`,birth_date:c["b"].toStandardHisDisplayFormat(e.birthdate),home_address:`${e.home_district} ${e.home_traditional_authority}`}}else t.guardian=this.guardianData},options:async()=>{const t=await u.getRelations();return t.map(t=>({label:t.b_is_to_a,value:t.description,other:t}))},config:{hiddenFooterBtns:["Clear"]}}},scanGuardian(){return{id:"scan",helpText:"Scan or Register Guardian",type:r["b"].TT_BARCODE,requireNext:!1,condition:()=>!this.isEditMode(),onValue:async t=>{const e=await l["a"].findByNpid(t);return Object(g["isEmpty"])(e)||(this.guardianData=p["a"].mapPersonData(e[0].person),this.fieldComponent="relations",this.fieldAction="Scan"),!1},config:{hiddenFooterBtns:["Clear","Next","Back"],footerBtns:[{name:"Find or Register Guardian",color:"success",slot:"end",onClick:()=>{this.fieldAction="Search",this.fieldComponent="given_name"}}]}}},searchResultField(){return{id:"results",helpText:"Search results",type:r["b"].TT_PERSON_RESULT_VIEW,dynamicHelpText:t=>`Search results for \n                "${t.given_name.value} ${t.family_name.value} | ${t.gender.label}"\n                `,appearInSummary:()=>!1,condition:()=>this.isSearchMode(),validation:t=>d["a"].required(t),options:async t=>{const e=await l["a"].search({given_name:t.given_name.value,family_name:t.family_name.value,gender:t.gender.value});return e.map(t=>p["a"].getPersonAttributeOptions(t))},config:{hiddenFooterBtns:["Clear","Next","Back"],footerBtns:[{name:"Edit Search",slot:"end",onClick:()=>{this.fieldAction="Search",this.fieldComponent="given_name"}},{name:"New Guardian",slot:"end",onClick:()=>{this.fieldAction="Registration",this.fieldComponent="year_birth_date"}},{name:"Continue Guardian",color:"success",slot:"end",state:{disabled:{default:()=>!0,onValue(t,e){return Object(g["isEmpty"])(e.results)}}},onClick:t=>{this.guardianData=p["a"].mapPersonData(t.results.other.person.person),this.fieldComponent="relations",this.fieldAction="Search"}}]}}}}}),R=i("d959"),A=i.n(R);const C=A()(v,[["render",n]]);e["default"]=C},"1f9a":function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var a=i("1c74"),n=i("ad60"),r=i("d10e");class s extends a["e"]{constructor(){super()}static create(t){return super.postJson("/person_attributes",t)}}var o=i("4db7");class d extends a["e"]{constructor(){super(),this.personId=0}getPersonID(){return this.personId}setPersonID(t){this.personId=t}async registerPatient(t,e){await this.createPerson(t),await this.createPersonAttributes(e);const i=await this.createPatient();return await this.printPatient(),i}async registerGuardian(t){return this.createPerson(t)}updatePerson(t){return new r["a"](t).update(this.personId)}async createPerson(t){const e=await new r["a"](t).create();return this.personId=e.person_id,e}createPatient(){return n["a"].createPatient(this.personId)}async createPersonAttributes(t){for(const e in t)await s.create({...t[e],person_id:this.personId})}printPatient(){return new o["a"](this.personId).printNidLbl()}}},"76df":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var a=i("7f35");async function n(t,e="action-sheet-modal"){const i=await Object(a["c"])("Are you sure you want to void record?","Please specify reason for voiding this record",["Mistake/ Wrong Entry","Duplicate","System Error"],[{name:"Cancel",slot:"start"},{name:"Void",color:"danger",slot:"end",role:"action"}],"",e);i.selection&&"Void"===i.action&&await t(i.selection)}}}]);
//# sourceMappingURL=chunk-03bca019.50ab1640.js.map