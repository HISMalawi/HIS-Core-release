(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b5ad90c"],{7920:function(e,t,n){"use strict";var a=n("7a23");function o(e,t,n,o,r,i){return Object(a["openBlock"])(),Object(a["createBlock"])(Object(a["resolveDynamicComponent"])(e.formType),{fields:e.fields,skipSummary:e.skipSummary,activeField:e.activeField,cancelDestinationPath:e.cancelDestinationPath,onOnFinish:e.onFinish,onFinish:e.onFinishAction,onOnIndex:e.onIndex},null,40,["fields","skipSummary","activeField","cancelDestinationPath","onOnFinish","onFinish","onOnIndex"])}var r=n("9441"),i=Object(a["defineComponent"])({name:"HisStandardForm",components:{TouchScreenForm:r["a"]},emits:["onFinish","onIndex"],data:()=>({formType:"touch-screen-form"}),props:{onFinishAction:{type:Function},skipSummary:{type:Boolean,default:!1},activeField:{type:String},fields:{type:Object,required:!0},cancelDestinationPath:{type:String,required:!1}},methods:{onFinish(e,t){this.$emit("onFinish",e,t)},onIndex(e){this.$emit("onIndex",e)}}}),s=n("6b0d"),c=n.n(s);const u=c()(i,[["render",o]]);t["a"]=u},"8e3d":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return storageFactory}));var _home_andrew_dev_Projects_HIS_Core_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ade3"),lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("2ef0"),lodash__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);const INDEX_STORE="openmrs",DB_NAME="offline_db",storageFactory=(storageName="IndexedDBStorage")=>eval(`new ${storageName}()`);class LocalStorage{existsinStorage(e){const t=localStorage.getItem(e);return t?Promise.resolve(!0):Promise.resolve(!1)}getFromStorage(e){return new Promise((t,n)=>{const a=localStorage.getItem(e);if(a)return t(JSON.parse(a));t([])})}deleteFromStorage(e){return localStorage.removeItem(e),!0}saveToStorage(e,t){return localStorage.setItem(e,JSON.stringify(t)),!0}}class IndexedDBStorage{constructor(){Object(_home_andrew_dev_Projects_HIS_Core_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"db",void 0);const e=indexedDB.open(DB_NAME,1);e.onupgradeneeded=function(){e.result.createObjectStore(INDEX_STORE)},e.onsuccess=()=>{this.db=e.result}}existsinStorage(e){return new Promise((t,n)=>{const a=this.db.transaction(INDEX_STORE).objectStore(INDEX_STORE).get(e);a.onsuccess=()=>{t(a.result)},a.onerror=()=>{n(a.error)}})}getFromStorage(e,t){return new Promise((n,a)=>{const o=this.db.transaction(INDEX_STORE).objectStore(INDEX_STORE).openCursor();o.onsuccess=()=>{const a=o.result;a?(a.key===e&&n(t?filteredData(a,t):a.value.data),a.continue()):n([])},o.onerror=()=>{a("error")}})}saveToStorage(e,t){return this.db.transaction(INDEX_STORE,"readwrite").objectStore(INDEX_STORE).put(t,e),!0}deleteFromStorage(e){return this.db.transaction(INDEX_STORE,"readwrite").objectStore(INDEX_STORE).delete(e),!0}}function filteredData(e,t){return Object(lodash__WEBPACK_IMPORTED_MODULE_1__["filter"])(e.value,e=>Object.entries(t).every(([t,n])=>Object(lodash__WEBPACK_IMPORTED_MODULE_1__["isInteger"])(e[t])?!n||e[t]===n:!n||Object(lodash__WEBPACK_IMPORTED_MODULE_1__["toLower"])(e[t]).includes(Object(lodash__WEBPACK_IMPORTED_MODULE_1__["toLower"])(n))))}},dac9:function(e,t,n){"use strict";n.r(t);var a=n("7a23");function o(e,t,n,o,r,i){const s=Object(a["resolveComponent"])("his-standard-form"),c=Object(a["resolveComponent"])("ion-page");return Object(a["openBlock"])(),Object(a["createBlock"])(c,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{formLabel:"ART Referral outcome",fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:e.patientDashboardUrl()},null,8,["fields","onFinishAction","cancelDestinationPath"])]),_:1})}var r=n("d95e"),i=n("d867"),s=n("cc6f");class c extends s["a"]{constructor(e,t=-1){super(e,10,t)}}var u=n("e86e"),l=n("b446"),d=n("ad60"),_=n("7920"),m=n("e9be"),b=Object(a["defineComponent"])({components:{IonPage:i["D"],HisStandardForm:_["a"]},setup(){const e=Object(a["ref"])([]),t=new c(-1),{visitID:n,htsClient:o,yesNoOptions:i,saveEncounter:s,mapStrToOptions:_,patientDashboardUrl:b}=Object(m["a"])({onInitVisit:()=>{e.value=[f(),h(),...g(),O(),v(),D()]}});function p(e,n){s({encounterName:"ART Referral Outcome",encounterTypeID:t.encounterTypeID,computedData:n})}function f(){let e=!1,a=[],o=!1;return{id:"on_art",helpText:"ART Summary",type:r["b"].TT_HIDDEN,init:async()=>{try{const r=await d["a"].getProgramInformation(n.value);o=r&&/Linked|art/i.test(r.art_outcome);const i=await d["a"].getProgramSummary(n.value,1);if(e=[!/unknown/.test(i.current_outcome),!/n\/a/i.test(i.art_start_date)].every(Boolean),!e)return!0;a=[{label:"Outcome",value:i.current_outcome,other:{obs:()=>t.buildValueCoded("Antiretroviral status or outcome","Linked")}},{label:"Outcome date",value:i.art_start_date,other:{obs:()=>t.buildValueDate("Outcome date",i.art_start_date)}},{label:"Facility",value:d["a"].getLocationName(),other:{obs:()=>t.buildValueText("ART clinic location",""+d["a"].getLocationName())}},{label:"ARV Number",value:i.arv_number,other:{obs:()=>t.buildValueText("Art number",i.arv_number)}}]}catch(r){console.error(r)}return!0},summaryMapValue:e=>e,condition:()=>e,defaultValue(){return a},finalComputedValue:e=>{if(!o)return{obs:e.filter(e=>"function"===typeof e.other.obs).map(e=>e.other.obs())}},options:()=>a}}function h(){return{id:"outcome",helpText:"ART Outcome Referral",type:r["b"].TT_SELECT,isRequired:()=>!0,condition:e=>null===e.on_art,finalComputedValue:e=>({obs:t.buildValueCoded("Antiretroviral status or outcome",e.value)}),options:()=>_(["Linked","Refused","Died","Already on ART","Unknown"])}}function O(){return{id:"art_site",helpText:"Visited Clinic Name",type:r["b"].TT_SELECT,isRequired:()=>!0,condition:e=>/Linked|Already on art/i.test(e.outcome.value),finalComputedValue:e=>({obs:t.buildValueText("ART clinic location",e.label)}),options:(e,t="")=>Object(u["b"])(t),config:{footerBtns:[{name:"Here",slot:"end",onClickComponentEvents:{setValue:()=>c.getLocationName()},onClick:()=>null}],showKeyboard:!0,isFilterDataViaApi:!0}}}function g(){return Object(l["b"])({id:"outcome_date",helpText:"Outcome",required:!0,minDate:()=>o.birthDate,maxDate:()=>t.date,condition:e=>!/unknown/i.test(e.outcome.value),computeValue:e=>({date:e,obs:t.buildValueDate("Outcome date",e)}),estimation:{allowUnknown:!1}})}function v(){return{id:"has_arv_number",helpText:"ARV Number available",type:r["b"].TT_YES_NO,isRequired:()=>!0,condition:e=>/linked|already on art/i.test(e.outcome.value),options:()=>[{label:"ARV number available?",values:i()}]}}function D(){return{id:"arv_number",helpText:"ARV Number",type:r["b"].TT_TEXT,isRequired:()=>!0,condition:e=>"Yes"===e.has_arv_number,finalComputedValue:e=>({obs:t.buildValueText("Art number",""+e.value)})}}return{patientDashboardUrl:b,onFinish:p,fields:e}}}),p=n("6b0d"),f=n.n(p);const h=f()(b,[["render",o]]);t["default"]=h},e86e:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"f",(function(){return d})),n.d(t,"e",(function(){return _})),n.d(t,"a",(function(){return m})),n.d(t,"g",(function(){return b})),n.d(t,"h",(function(){return p}));var a=n("5713"),o=n("8e3d"),r=n("13ea"),i=n.n(r);const s=Object(o["a"])();async function c(e=""){let t=await s.getFromStorage("locations",{name:e});return i()(t)&&(t=await a["a"].getFacilities({name:e})),t.filter(e=>!i()(e)&&""!=e.name.trim()).map(e=>({label:e.name,value:e.location_id,other:e}))}async function u(e=""){const t=await a["a"].getLabs({search_name:e});return t.map(e=>({label:e,value:e}))}async function l(e=""){const t=await a["a"].getFacilities({name:e,tag:"Facility adult sections"});return t.map(e=>({label:e.name,value:e.name,other:e}))}async function d(){const e=await a["a"].getSpecialistClinics();return e.map(e=>({label:e.name,value:e.name,other:e}))}async function _(){let e=await s.getFromStorage("regions",[]);return i()(e)&&(e=await a["a"].getRegions()),e.map(e=>({label:e.name,value:e.region_id,other:e}))}async function m(e){let t=await s.getFromStorage("districts",{region_id:e});return i()(t)&&(t=await a["a"].getDistricts(e)),t.map(e=>({label:e.name,value:e.district_id,other:e}))}async function b(e,t=""){let n=await s.getFromStorage("traditional_authorities",{district_id:e,name:t});return i()(n)&&(n=await a["a"].getTraditionalAuthorities(e,t)),n.map(e=>({label:e.name,value:e.traditional_authority_id,other:e}))}async function p(e,t=""){let n=await s.getFromStorage("villages",{traditional_authority_id:e,name:t});return i()(n)&&(n=await a["a"].getVillages(e,t)),n.map(e=>({label:e.name,value:e.village_id,other:e}))}}}]);
//# sourceMappingURL=chunk-6b5ad90c.8dbdc44d.js.map