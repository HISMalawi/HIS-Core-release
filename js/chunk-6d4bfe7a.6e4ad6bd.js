(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6d4bfe7a"],{"13d8":function(e,t,n){"use strict";n("bf0a")},"46d3":function(e,t,n){"use strict";n.r(t);n("a434");var r=n("7a23"),a=Object(r["withScopeId"])("data-v-257a2a3f");Object(r["pushScopeId"])("data-v-257a2a3f");var u=Object(r["createTextVNode"])("Treatment"),c=Object(r["createVNode"])("thead",null,[Object(r["createVNode"])("tr",{class:"his-sm-text"},[Object(r["createVNode"])("th",null,"Drug"),Object(r["createVNode"])("th",null,"Frequency"),Object(r["createVNode"])("th",null,"Duration (Days)"),Object(r["createVNode"])("th")])],-1),o=Object(r["createTextVNode"])(" Add "),i=Object(r["createTextVNode"])(" Cancel "),s=Object(r["createTextVNode"])(" Clear "),d=Object(r["createTextVNode"])(" Finish ");Object(r["popScopeId"])();var l=a((function(e,t,n,l,f,b){var p=Object(r["resolveComponent"])("ion-title"),g=Object(r["resolveComponent"])("ion-toolbar"),h=Object(r["resolveComponent"])("ion-header"),O=Object(r["resolveComponent"])("ion-input"),v=Object(r["resolveComponent"])("ion-icon"),m=Object(r["resolveComponent"])("ion-button"),j=Object(r["resolveComponent"])("ion-col"),y=Object(r["resolveComponent"])("ion-row"),D=Object(r["resolveComponent"])("ion-grid"),k=Object(r["resolveComponent"])("ion-label"),_=Object(r["resolveComponent"])("ion-item"),x=Object(r["resolveComponent"])("ion-list"),V=Object(r["resolveComponent"])("ion-content"),w=Object(r["resolveComponent"])("ion-footer"),N=Object(r["resolveComponent"])("ion-page");return Object(r["openBlock"])(),Object(r["createBlock"])(N,null,{default:a((function(){return[Object(r["createVNode"])(h,null,{default:a((function(){return[Object(r["createVNode"])(g,null,{default:a((function(){return[Object(r["createVNode"])(p,{class:"his-lg-text"},{default:a((function(){return[u]})),_:1})]})),_:1})]})),_:1}),Object(r["createVNode"])(V,null,{default:a((function(){return[Object(r["createVNode"])(D,null,{default:a((function(){return[Object(r["createVNode"])(y,{style:{height:"50vh"},class:"his-card section drug-section-style"},{default:a((function(){return[Object(r["createVNode"])(j,null,{default:a((function(){return[Object(r["createVNode"])("table",null,[c,Object(r["createVNode"])("tbody",null,[(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.activeDrugs,(function(n,u){return Object(r["openBlock"])(),Object(r["createBlock"])("tr",{key:u},[Object(r["createVNode"])("td",null,[Object(r["createVNode"])(O,{readonly:"",onClick:function(t){return e.editDrugName(n)},value:n.drug_name,placeholder:"Add drug",class:"his-sm-text dosage-input"},null,8,["onClick","value"])]),Object(r["createVNode"])("td",null,[Object(r["createVNode"])(O,{readonly:"",onClick:function(t){return e.editDrugFrequency(n)},value:n.frequency,class:"his-sm-text dosage-input",placeholder:"Add frequency.."},null,8,["onClick","value"])]),Object(r["createVNode"])("td",null,[Object(r["createVNode"])(O,{readonly:"",onClick:function(t){return e.editDrugDuration(n)},value:n.duration,placeholder:"Add duration..",class:"dosage-input his-sm-text"},null,8,["onClick","value"])]),Object(r["createVNode"])("td",null,[Object(r["createVNode"])(y,null,{default:a((function(){return[u+1>=e.activeDrugs.length?(Object(r["openBlock"])(),Object(r["createBlock"])(j,{key:0,size:"6"},{default:a((function(){return[Object(r["createVNode"])(m,{disabled:!(n.id&&n.frequency&&n.duration),onClick:t[1]||(t[1]=function(t){return e.activeDrugs.push(e.defaultDrugObj())}),class:"his-md-text",style:{width:"100%"},color:"success"},{default:a((function(){return[Object(r["createVNode"])(v,{icon:e.add},null,8,["icon"]),o]})),_:2},1032,["disabled"])]})),_:2},1024)):Object(r["createCommentVNode"])("",!0),u+1<e.activeDrugs.length||0!=u&&u+1>=e.activeDrugs.length?(Object(r["openBlock"])(),Object(r["createBlock"])(j,{key:1,size:"6"},{default:a((function(){return[Object(r["createVNode"])(m,{onClick:function(t){return e.activeDrugs.splice(u,1)},class:"his-lg-text",style:{width:"100%"},color:"danger"},{default:a((function(){return[Object(r["createVNode"])(v,{icon:e.trashBin},null,8,["icon"])]})),_:1},8,["onClick"])]})),_:1})):Object(r["createCommentVNode"])("",!0)]})),_:2},1024)])])})),128))])])]})),_:1})]})),_:1})]})),_:1}),Object(r["createVNode"])(x,{style:{height:"29vh"},class:"his-card section"},{default:a((function(){return[(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.drugSets,(function(t,n){return Object(r["openBlock"])(),Object(r["createBlock"])(_,{class:"his-md-text",detail:"",onClick:function(n){return e.appendDrugSetValues(t)},button:"",key:n},{default:a((function(){return[Object(r["createVNode"])(k,null,{default:a((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(t.label)+" ("+Object(r["toDisplayString"])(t.value)+")",1)]})),_:2},1024)]})),_:2},1032,["onClick"])})),128))]})),_:1})]})),_:1}),Object(r["createVNode"])(w,null,{default:a((function(){return[Object(r["createVNode"])(g,{color:"dark"},{default:a((function(){return[Object(r["createVNode"])(m,{"router-link":e.cancelDestination,slot:"start",size:"large",color:"danger"},{default:a((function(){return[i]})),_:1},8,["router-link"]),Object(r["createVNode"])(m,{onClick:e.clear,slot:"end",size:"large",color:"warning"},{default:a((function(){return[s]})),_:1},8,["onClick"]),Object(r["createVNode"])(m,{disabled:e.isSubmitting,onClick:e.onFinish,slot:"end",size:"large",color:"success"},{default:a((function(){return[d]})),_:1},8,["disabled","onClick"])]})),_:1})]})),_:1})]})),_:1})})),f=n("1da1"),b=(n("96cf"),n("d81d"),n("b0c0"),n("a4d3"),n("e01a"),n("d3b7"),n("99af"),n("4de4"),n("caad"),n("2532"),n("b64b"),n("8a30")),p=n("e6e9"),g=n("7365"),h=n("8ee8"),O=n("d95e"),v=n("2706"),m=n("76f1"),j=n("b5e4"),y=n("ff79"),D=n("4db7"),k=n("c84b"),_=Object(r["defineComponent"])({components:{IonHeader:b["q"],IonIcon:b["r"],IonRow:b["H"],IonLabel:b["x"],IonGrid:b["p"],IonCol:b["m"],IonPage:b["D"],IonContent:b["n"],IonTitle:b["P"],IonInput:b["v"],IonButton:b["d"],IonFooter:b["o"],IonToolbar:b["Q"]},mixins:[g["a"]],setup:function(){return{add:y["a"],trashBin:y["Q"]}},data:function(){return{activeDrugs:[],drugSets:[],defaultDrugs:[],isSubmitting:!1,service:{}}},computed:{selectedDrugNames:function(){return this.activeDrugs.map((function(e){return e.drug_name||""}))}},watch:{ready:{handler:function(e){var t=this;return Object(f["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.activeDrugs=[t.defaultDrugObj()],!e){n.next=9;break}return t.service=new h["a"](t.patientID,t.providerID),n.next=5,k["a"].getDrugSets();case 5:return t.drugSets=n.sent.map((function(e){return{label:e.name,value:e.description,other:{drugs:e.drugs}}})),n.next=8,m["a"].getDrugs({page_size:50});case 8:t.defaultDrugs=n.sent;case 9:case"end":return n.stop()}}),n)})))()},immediate:!0}},methods:{onFinish:function(){var e=this;return Object(f["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.formIsEmpty()){t.next=10;break}return t.next=3,Object(j["a"])("Do you want to proceed without prescribing drugs?");case 3:if(!t.sent){t.next=9;break}return t.next=6,e.service.createEncounter();case 6:return t.next=8,e.service.saveValueCodedObs("Medication received at vist","No");case 8:e.nextTask();case 9:return t.abrupt("return");case 10:if(e.formIsComplete()){t.next=12;break}return t.abrupt("return",Object(j["e"])("Please complete the form"));case 12:return e.isSubmitting=!0,t.prev=13,t.next=16,e.service.submitTreatment(e.activeDrugs);case 16:return t.next=18,new D["a"](e.patientID).printVisitSummaryLbl();case 18:return t.abrupt("return",e.nextTask());case 21:t.prev=21,t.t0=t["catch"](13),Object(j["e"])("".concat(t.t0)),console.error(t.t0);case 25:e.isSubmitting=!1;case 26:case"end":return t.stop()}}),t,null,[[13,21]])})))()},defaultDrugObj:function(){return{id:0,drug_name:"",dose:"",duration:0,frequency:"",units:""}},formIsComplete:function(){return this.activeDrugs.every((function(e){return e.id&&e.duration&&e.frequency}))},formIsEmpty:function(){return 1===this.activeDrugs.length&&""===this.activeDrugs[0].drug_name&&0===this.activeDrugs[0].duration&&""===this.activeDrugs[0].frequency},appendDrugSetValues:function(e){var t=this,n=e.other.drugs.reduce((function(e,t){return e.concat(t)}),[]);1!==this.activeDrugs.length||this.activeDrugs[0].id?this.activeDrugs=this.activeDrugs.concat(n.filter((function(e){return!t.selectedDrugNames.includes(e.drug_name)}))):this.activeDrugs=n},editDrugName:function(e){var t=this;this.launchEditor({id:"new_drug",helpText:"Add drug to prescribe",type:O["b"].TT_SELECT,defaultValue:function(){return e.drug_name},validation:function(e){return t.validateSeries([function(){return v["a"].required(e)},function(){return t.selectedDrugNames.includes(e.label)?["Drug already added"]:null}])},options:function(){var e=Object(f["a"])(regeneratorRuntime.mark((function e(n,r){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=[],!r){e.next=7;break}return e.next=4,m["a"].getDrugs({page_size:50,name:r});case 4:a=e.sent,e.next=8;break;case 7:a=t.defaultDrugs;case 8:return e.abrupt("return",a.map((function(e){return{label:e.name,value:e.drug_id,other:{dose:e.dose,units:e.units}}})));case 9:case"end":return e.stop()}}),e)})));function n(t,n){return e.apply(this,arguments)}return n}(),config:{showKeyboard:!0,isFilterDataViaApi:!0}},(function(t){e["id"]=t.value,e["drug_name"]=t.label,e["dose"]=t.other.dose,e["units"]=t.other.units}))},editDrugFrequency:function(e){var t=this;this.launchEditor({id:"frequency",helpText:"Edit drug frequency for ".concat(e.drug_name),type:O["b"].TT_SELECT,defaultValue:function(){return e.frequency},validation:function(e){return v["a"].required(e)},options:function(){return t.mapStrToOptions(Object.keys(h["b"]))}},(function(t){e.frequency=t.label}))},editDrugDuration:function(e){this.launchEditor({id:"duration",helpText:"Edit duration of ".concat(e.drug_name," in days"),type:O["b"].TT_NUMBER,defaultValue:function(){return e.duration},validation:function(e){return v["a"].required(e)}},(function(t){e.duration=t.value}))},clear:function(){var e=this;return Object(f["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(j["a"])("Are you sure you want to clear all drugs?");case 2:n=t.sent,n&&(e.activeDrugs=[e.defaultDrugObj()]);case 4:case"end":return t.stop()}}),t)})))()},launchEditor:function(e,t){return Object(f["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,b["X"].create({component:p["a"],backdropDismiss:!1,cssClass:"full-modal",componentProps:{dismissType:"modal",currentField:e,onFinish:t}});case 2:r=n.sent,r.present();case 4:case"end":return n.stop()}}),n)})))()}}}),x=(n("13d8"),n("6b0d")),V=n.n(x);const w=V()(_,[["render",l],["__scopeId","data-v-257a2a3f"]]);t["default"]=w},"8ee8":function(e,t,n){"use strict";n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return b}));var r=n("1da1"),a=n("d4ec"),u=n("bee2"),c=n("262e"),o=n("2caf"),i=(n("d81d"),n("d3b7"),n("159b"),n("96cf"),n("cc6f")),s=n("71c3"),d=n("2ef0"),l=n("9283"),f={"Once a day (OD)":1,"Twice a day (BD)":2,"Three a day (TDS)":3,"Four times a day (QID)":4,"Five times a day (5X/D)":5,"Six times a day (Q4HRS)":6,"In the morning (QAM)":.5,"Once a week (QWK)":.14,"Once a month":.03,"Twice a month":.071},b=function(e){Object(c["a"])(n,e);var t=Object(o["a"])(n);function n(e,r){return Object(a["a"])(this,n),t.call(this,e,25,r)}return Object(u["a"])(n,[{key:"ttvDrugObj",value:function(){return{drug_inventory_id:609,dose:.5,equivalent_daily_dose:.5,frequency:"Once a day (od)",start_date:this.date,auto_expire_date:this.date,instructions:"Once a day",units:"ml"}}},{key:"updateTTvOrder",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.dispenseTTV();case 2:if(t=e.sent,Object(d["isEmpty"])(t)){e.next=6;break}return n=t[0].order_id,e.abrupt("return",s["a"].updateDispensationOrders([{order_id:n,quantity:1}]));case 6:throw"Unable to dispense";case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"dispenseTTV",value:function(){return this.createOrders([this.ttvDrugObj()])}},{key:"createOrders",value:function(e){return s["a"].create({drug_orders:e,encounter_id:this.getEncounterID()})}},{key:"submitTreatment",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,r,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.createEncounter();case 2:return e.next=4,this.createOrders(t.map((function(e){return a.buildDrugOrderObj(e)})));case 4:return n=e.sent,r=new i["a"](this.patientID,54,this.providerID),e.next=8,r.createEncounter();case 8:return t.forEach((function(e){var t=f[e.frequency]*e.duration;n.forEach((function(n){n.drug_inventory_id===e.id&&(n.quantity=t)}))})),e.next=11,s["a"].updateDispensationOrders(n);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildDrugOrderObj",value:function(e){var t=new Date(this.date),n=t.setDate(t.getDate()+parseInt("".concat(e.duration))),r=e.dose||f[e.frequency],a=parseFloat(r)*f[e.frequency];return{drug_inventory_id:e.id,dose:r,equivalent_daily_dose:a,frequency:e.frequency,start_date:this.date,auto_expire_date:l["b"].toStandardHisFormat(new Date(n)),instructions:e.drug_name+":"+e.dose+" "+e.units+" "+e.frequency+"days",units:e.units}}}]),n}(i["a"])},bf0a:function(e,t,n){},c84b:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n("2909"),a=n("1da1"),u=n("5530"),c=n("d4ec"),o=n("bee2"),i=n("262e"),s=n("2caf"),d=(n("96cf"),n("d3b7"),n("b64b"),n("99af"),n("1c74")),l=function(e){Object(i["a"])(n,e);var t=Object(s["a"])(n);function n(){return Object(c["a"])(this,n),t.apply(this,arguments)}return Object(o["a"])(n,null,[{key:"saveDrugSet",value:function(e){var t=Object(u["a"])({},e);return t["datetime"]=d["e"].getSessionDate(),this.postJson("/drug_sets",e)}},{key:"voidDrugSet",value:function(e){return this.void("/drug_sets/".concat(e),{date:this.getSessionDate()})}},{key:"getDrugSets",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getJson("drug_sets");case 2:if(t=e.sent,!t){e.next=5;break}return e.abrupt("return",Object.keys(t["set_names"]).reduce((function(e,n){var a=t["set_names"][n],c=t["set_descriptions"][n],o=t["drug_sets"][n];return e.push({id:parseInt(n),name:a,description:c,drugs:Object.keys(o).reduce((function(e,t){return[].concat(Object(r["a"])(e),[Object(u["a"])(Object(u["a"])({id:parseInt(t)},o[t]),{},{drug_name:o[t].drug_name,duration:parseInt(o[t].duration),frequency:o[t].frequency,units:o[t].units})])}),[])}),e}),[]));case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),n}(d["e"])}}]);
//# sourceMappingURL=chunk-6d4bfe7a.6e4ad6bd.js.map