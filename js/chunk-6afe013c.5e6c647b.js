(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6afe013c"],{3822:function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var n=o("fcd5");class r extends n["d"]{constructor(){super(),this.regenerate=!1}setRegenerate(e){this.regenerate=e}requestHMIS15(){return this.getReport("generate_hmis_15_report",{request:"true"})}requestHMIS17(){return this.getReport("generate_hmis_17_report",{request:"true"})}renderResults(e){const t=[];let o=1;for(const[n,r]of Object.entries(e)){const e=[],s=r,a={id:0,name:"",total:0,totalPatientIds:""};a.name=n;let i=0;a.id=o,o+=1;for(const[t,o]of Object.entries(s)){const t=o;null!=t&&(i+=t.length,a.total=i,t.length&&(e.push(...t),a.totalPatientIds=e))}t.push(a)}return t}getCSVString(e){let t="Diseases/Events/Conditions, #,\n";for(const o of e){const e=`${o.name},${o.total},\n`;t+=e}return{CSVString:t}}}},8410:function(e,t,o){"use strict";o.r(t);var n=o("7a23");const r={id:"report-content"},s=Object(n["createVNode"])("div",{id:"print"},null,-1);function a(e,t,o,a,i,c){const l=Object(n["resolveComponent"])("ion-loading"),d=Object(n["resolveComponent"])("his-standard-form"),m=Object(n["resolveComponent"])("hmis-header"),p=Object(n["resolveComponent"])("hmis-template"),h=Object(n["resolveComponent"])("ion-content"),u=Object(n["resolveComponent"])("his-footer"),b=Object(n["resolveComponent"])("ion-page");return Object(n["openBlock"])(),Object(n["createBlock"])(n["Fragment"],null,[Object(n["createVNode"])(l,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),e.reportReady?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createBlock"])(d,{key:0,onOnFinish:e.onPeriod,skipSummary:!0,fields:e.fields},null,8,["onOnFinish","fields"])),e.reportReady?(Object(n["openBlock"])(),Object(n["createBlock"])(b,{key:1},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(h,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])("div",r,[Object(n["createVNode"])(m,{key:e.componentKey,reportName:e.reportName,ref:"header",periodLabel:e.periodLabel,periodDates:e.periodDates,clinicName:e.clinicName,totalOPDVisits:e.TotalOPDVisits},null,8,["reportName","periodLabel","periodDates","clinicName","totalOPDVisits"]),Object(n["createVNode"])(p,{key:e.componentKey,reportName:e.reportName,onDrillDown:e.onDrillDown,params:e.hmis15Data,periodDates:e.periodDates,ref:"rep"},null,8,["reportName","onDrillDown","params","periodDates"])])]),_:1}),Object(n["createVNode"])(u,{btns:e.btns},null,8,["btns"])]),_:1})):Object(n["createCommentVNode"])("",!0),s],64)}var i=o("0f25"),c=o("8a30"),l=o("7920"),d=o("c2b0"),m=o("3822"),p=o("cb01"),h=o("9d7f"),u=o("9283"),b=Object(n["defineComponent"])({mixins:[d["a"]],components:{IonLoading:c["z"],HmisHeader:p["a"],HmisTemplate:h["a"],HisStandardForm:l["a"],HisFooter:i["a"],IonPage:c["D"],IonContent:c["n"]},data:()=>({formData:{},componentKey:0,computedFormData:{},hmis15Data:{},btns:[],isLoading:!1,fields:[],reportID:-1,periodLabel:"Period",periodDates:"",reportName:"HMIS 17",TotalOPDVisits:0,clinicName:m["a"].getLocationName(),reportReady:!1}),created(){this.btns=this.getBtns(),this.fields=this.getDateDurationFields()},methods:{async onPeriod(e,t,o=!1){this.componentKey+=1,this.formData=e,this.computedFormData=t,this.reportReady=!0,this.isLoading=!0,this.report=new m["a"],this.report.setRegenerate(o),this.report.setStartDate(u["b"].toStandardHisFormat(t.start_date)),this.report.setEndDate(u["b"].toStandardHisFormat(t.end_date)),this.periodDates=this.report.getReportPeriod();try{const e=await this.report.requestHMIS17(),t=await this.report.getClinicRegistrations();e&&t&&(this.reportID="data",this.TotalOPDVisits=t.length,this.hmis15Data=e)}catch(n){console.log(n)}finally{this.isLoading=!1}},getBtns(){return[{name:"CSV",size:"large",slot:"start",color:"primary",visible:!0,onClick:async()=>{const e=this.$refs.rep;e.onDownload()}},{name:"PDF",size:"large",slot:"start",color:"primary",visible:!0,onClick:()=>this.exportToCustomPDF(this.reportName)},{name:"Back",size:"large",slot:"end",color:"warning",visible:!0,onClick:()=>this.reportReady=!1},{name:"Refresh",size:"large",slot:"end",color:"warning",visible:!0,onClick:async()=>await this.onPeriod(this.formData,this.computedFormData,!0)},{name:"Finish",size:"large",slot:"end",color:"success",visible:!0,onClick:()=>this.$router.push({path:"/"})}]}}}),g=o("6b0d"),D=o.n(g);const f=D()(b,[["render",a]]);t["default"]=f},"9d7f":function(e,t,o){"use strict";var n=o("7a23");const r={class:"my-table",style:{margin:"auto",width:"95%","margin-top":"3%","margin-bottom":"3%"}};function s(e,t,o,s,a,i){const c=Object(n["resolveComponent"])("report-table");return Object(n["openBlock"])(),Object(n["createBlock"])("div",r,[Object(n["createVNode"])(c,{columns:e.columns,rows:e.rows,config:{tableCssTheme:e.tableCssTheme}},null,8,["columns","rows","config"])])}var a=o("3822"),i=o("1c74"),c=o("5a0c"),l=o.n(c),d=o("80e3"),m=o("9ceb"),p=Object(n["defineComponent"])({components:{ReportTable:d["a"]},data:function(){return{conditions:[],tableCssTheme:"opd-report-theme",total:" Total ",rows:[],columns:[[m["a"].thTxt(""),m["a"].thTxt("Diseases/Events/Conditions"),m["a"].thTxt("UNVERIFIED"),m["a"].thTxt("VERIFIED")]]}},props:["params","periodDates","quarter","onDrillDown","reportName"],methods:{renderResults(){const e=new a["a"],t=e.renderResults(this.params);t.length&&(this.conditions=t,this.rows=this.buildRows(t))},onDownload(){const e=new a["a"];let{CSVString:t}=e.getCSVString(this.conditions);t+=`\n          Date Created: ${l()().format("DD/MMM/YYYY HH:MM:ss")}\n          His-Core Version: ${i["e"].getCoreVersion()}\n          API Version: ${i["e"].getApiVersion()}\n          Report Period: ${this.periodDates}\n          Site: ${i["e"].getLocationName()}\n          Site UUID: ${i["e"].getSiteUUID()}`;const o=new Blob([t],{type:"text/csv;charset=utf-8;"}),n=`${i["e"].getLocationName()} ${this.reportName} ${this.quarter}`;if(navigator.msSaveBlob)navigator.msSaveBlob(o,"exportFilename");else{const e=document.createElement("a");e.href=window.URL.createObjectURL(o),e.setAttribute("download",n+".csv"),document.body.appendChild(e),e.click(),document.body.removeChild(e)}},buildRows(e){const t=[];return e.forEach(e=>{t.push([m["a"].td(e.id,{style:{textAlign:"left"}}),m["a"].td(e.name,{style:{textAlign:"left"}}),this.buildRow(this.total+"("+e.name+")",e.total,e.totalPatientIds),m["a"].td("")])}),t},buildRow(e,t,o){return t>0?m["a"].tdLink(t,async()=>this.onDrillDown(e,o)):m["a"].td(0)}},watch:{params:{immediate:!0,handler(){this.renderResults()}}}}),h=o("6b0d"),u=o.n(h);const b=u()(p,[["render",s]]);t["a"]=b}}]);
//# sourceMappingURL=chunk-6afe013c.5e6c647b.js.map