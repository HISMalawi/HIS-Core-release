(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3fba66f4"],{"44e3":function(t,e,r){"use strict";r("14d9");var a=r("1c74"),s=r("7a23"),n=r("b446"),o=r("23e6"),i=r("9283"),u=r("d867"),d=r("d6aa"),l=r("5969"),c=r("d95e"),p=r("2706"),h=r("9ceb"),m=r("2ef0"),g=Object(s["defineComponent"])({data:()=>({fields:[],report:{},reportReady:!1,period:"",startDate:"",endDate:"",customFileName:"",drillDownCache:{}}),methods:{formatGender(t){const e=(""+t).toUpperCase();return"M"===e||"MALE"===e?"Male":"F"===e||"FEMALE"===e?"Female":/fbf|fnp|fp/i.test(t)?e:t},toDate(t){return i["b"].toStandardHisDisplayFormat(t)},sortByArvNumber(t,e="arv_number"){try{return t.sort((t,r)=>this.getArvInt(t[e])>this.getArvInt(r[e])?1:-1)}catch(r){return console.error(r),t}},getArvInt(t){if("string"===typeof t){const[e,r,a]=t.split("-"),s=parseInt(a);return"number"===typeof s?s:0}return 0},tdARV(t,e={}){return h["a"].td(t,{sortValue:this.getArvInt(t),...e})},confirmPatient(t){return this.$router.push("/patients/confirm?person_id="+t)},async drilldownAsyncRows(t,e,r,a=!0){const s=await u["ab"].create({component:d["a"],cssClass:"large-modal",componentProps:{title:t,columns:e,asyncRows:r,canExport:a,showFilters:!0,rowsPerPage:50,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>u["ab"].dismiss()}});s.present()},async drilldownData(t,e,r,a){const s=await u["ab"].create({component:d["a"],cssClass:"large-modal",componentProps:{title:t,columns:e,rows:r,rowParser:a,rowsPerPage:50,showFilters:!0,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>u["ab"].dismiss()}});s.present()},getDefaultDrillDownTable(){const t=[[h["a"].thTxt("ARV number"),h["a"].thTxt("Gender"),h["a"].thTxt("Birth Date"),h["a"].thTxt("Actions")]],e=async t=>{let e=0;const r=t.map(async t=>{let r=null,a=null;if(Object(m["isArray"])(t)){const[e,r]=t;if(a=e,r in this.drillDownCache){const[t,...e]=this.drillDownCache[r];return[a,...e]}}else if(r=t,r in this.drillDownCache)return this.drillDownCache[r];const s=await o["a"].findByID(r),n=new o["a"](s),i=[];return a&&(e=1,i.push(a)),i.push(this.tdARV(n.getArvNumber())),i.push(h["a"].td(this.formatGender(n.getGender()))),i.push(h["a"].tdDate(n.getBirthdate().toString())),i.push(h["a"].tdBtn("Show",async()=>{await u["ab"].dismiss({}),this.$router.push({path:"/patient/dashboard/"+r})})),this.drillDownCache[r]=i,i}),a=await Promise.all(r);return a.sort((t,r)=>t[e].sortValue>r[e].sortValue?1:-1)};return{rowParser:e,columns:t}},runTableDrill(t,e="Drilldown patients"){const{columns:r,rowParser:a}=this.getDefaultDrillDownTable();this.drilldownData(e,r,t,a)},drill(t,e="Drill table"){return t&&t.length>0?h["a"].tdLink(t.length,()=>this.runTableDrill(t,e)):h["a"].td(0)},getQuaterOptions(){const t=l["a"].getReportQuarters();return t.map(t=>({label:t.name,value:t.start,other:t}))},getDateDurationFields(t=!1,e=!1,r=5,s=a["e"].getSessionDate()){const o="2000-01-01";return[{id:"quarter",helpText:"Select Quarter",type:c["b"].TT_SELECT,condition:()=>t,validation:t=>p["a"].required(t),options:()=>{const t=l["a"].getReportQuarters(r);let a=t.map(t=>({label:t.name,value:t.start,other:t}));return e&&(a=[{label:"Set custom period",value:"custom_period",other:{}},...a]),a}},...Object(n["b"])({id:"start_date",helpText:"Start",required:!0,condition:e=>e.quarter&&"custom_period"===e.quarter.value||!t,minDate:()=>o,maxDate:()=>s,estimation:{allowUnknown:!1},computeValue:t=>t}),...Object(n["b"])({id:"end_date",helpText:"End",required:!0,condition:e=>e.quarter&&"custom_period"===e.quarter.value||!t,unload:(t,e,r,a)=>{"next"===e&&(this.endDate=a.end_date)},minDate:(t,e)=>e.start_date,maxDate:()=>s,estimation:{allowUnknown:!1},computeValue:t=>t})]}}});const D=g;e["a"]=D},5969:function(t,e,r){"use strict";r.d(e,"a",(function(){return u}));var a=r("ade3"),s=(r("14d9"),r("1c74")),n=r("9283"),o=r("5a0c"),i=r.n(o);class u extends s["e"]{constructor(){super(),Object(a["a"])(this,"programID",void 0),Object(a["a"])(this,"startDate",void 0),Object(a["a"])(this,"endDate",void 0),Object(a["a"])(this,"date",void 0),Object(a["a"])(this,"quarter",void 0),this.endDate="",this.startDate="",this.quarter="",this.date=s["e"].getSessionDate(),this.programID=s["e"].getProgramID()}getDateIntervalPeriod(){return`${n["b"].toStandardHisDisplayFormat(this.startDate)} - ${n["b"].toStandardHisDisplayFormat(this.endDate)}`}setStartDate(t){this.startDate=t}setEndDate(t){this.endDate=t}setQuarter(t){this.quarter=t}getReport(t,e={}){return s["e"].getJson(t,this.buildRequest(e))}buildRequest(t={}){const e={date:this.date,program_id:this.programID};return this.startDate&&this.endDate&&(e["start_date"]=this.startDate,e["end_date"]=this.endDate),this.quarter&&(e["quarter"]=this.quarter),{...e,...t}}static getQuarterBounds(t){const e=e=>i()(`${t}-${e}-01`).daysInMonth(),r=e=>`${t}-${e}-01 00:00`,a=r=>`${t}-${r}-${e(r)} 00:00`;return{Q1:{qtr:1,start:r("01"),end:a("03")},Q2:{qtr:2,start:r("04"),end:a("06")},Q3:{qtr:3,start:r("07"),end:a("09")},Q4:{qtr:4,start:r("10"),end:a("12")}}}static getQtrByDate(t){const e=this.getQuarterBounds(t.getFullYear());for(const r in e){const{start:a,end:s}=e[r];if(t>=new Date(a)&&t<=new Date(s))return e[r]}return null}static buildQtrObj(t,e){const r=this.getQuarterBounds(e),{start:a,end:s}=r[t];return{start:a,end:s,name:`${t} ${e}`}}static getReportQuarters(t=5){const e=[];let r=new Date,a=r.getFullYear();const s=a;r=new Date(`${s}-${r.getMonth()+1}-${r.getDate()} 00:00`);const n=this.getQtrByDate(r);let o=n.qtr,i=0;4===o&&e.push(this.buildQtrObj("Q1",a+1));while(i<t)0===i&&o<4&&e.push(this.buildQtrObj("Q"+(o+1),a)),e.push(this.buildQtrObj("Q"+o,a)),o=o>0?o-=1:o,a=0==o?a-1:a,o=0==o?o+=4:o,i++;return e}}},6955:function(t,e,r){"use strict";r.r(e);var a=r("7a23");function s(t,e,r,s,n,o){const i=Object(a["resolveComponent"])("report-template"),u=Object(a["resolveComponent"])("ion-page");return Object(a["openBlock"])(),Object(a["createBlock"])(u,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{title:t.title,rows:t.rows,columns:t.columns},null,8,["title","rows","columns"])]),_:1})}r("14d9");var n=r("44e3"),o=r("d6aa"),i=r("9ceb"),u=r("ad8d"),d=r("d867"),l=Object(a["defineComponent"])({mixins:[n["a"]],components:{ReportTemplate:o["a"],IonPage:d["D"]},data:()=>({title:"Active clients with adverse outcomes",rows:[],columns:[[i["a"].thTxt("Filing#"),i["a"].thTxt("Outcome"),i["a"].thTxt("Outcome date")]]}),async created(){const t=new u["b"],e=await t.getArchivingCandidates();e.forEach(t=>{this.rows.push([i["a"].td(t.filing_number),i["a"].td(t.outcome),i["a"].tdDate(t.outcome_date)])})}}),c=r("d959"),p=r.n(c);const h=p()(l,[["render",s]]);e["default"]=h},ad8d:function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return n}));var a=r("5969");const s=["<1 year","1-4 years","5-9 years","10-14 years","15-19 years","20-24 years","25-29 years","30-34 years","35-39 years","40-44 years","45-49 years","50-54 years","55-59 years","60-64 years","65-69 years","70-74 years","75-79 years","80-84 years","85-89 years","90 plus years"];class n extends a["a"]{constructor(){super()}getBookedAppointments(t){return a["a"].getJson(`programs/${this.programID}/scheduled_appointments`,{date:t})}getViralLoadResults(t){return this.getReport(`/programs/${this.programID}/reports/high_vl_patients`,{range:t})}getOtherOutcome(t){return this.getReport("patient_outcome_list",{outcome:t})}getPatientVisitTypes(){return this.getReport("patient_visit_types")}getClientsDueForVl(){return this.getReport("clients_due_vl")}getClientRentention(){return this.getReport(`/programs/${this.programID}/reports/retention`)}getExternalConsultationClients(){return this.getReport(this.programID+"/external_consultation_clients")}getMissedAppointments(){return this.getReport("missed_appointments")}getPregnantWomen(){return this.getReport(`/programs/${this.programID}/reports/pregnant_patients`)}getArchivingCandidates(){return a["a"].getJson(`programs/${this.programID}/reports/archiving_candidates`,{start_date:this.date})}}}}]);
//# sourceMappingURL=chunk-3fba66f4.2a0ff1cc.js.map