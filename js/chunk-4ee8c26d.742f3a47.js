(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4ee8c26d"],{"204c":function(e,t,a){"use strict";a.r(t);var n=a("7a23"),r=a("d867"),i=a("99ae"),o=a("b5e4"),u=a("0011"),l=a("91e4"),d=a("775a"),c=Object(n["defineComponent"])({__name:"ClinicDiscrepancyReport",setup(e){const t=Object(n["ref"])([]),a=Object(n["ref"])(""),c=Object(n["ref"])(!1),s=new l["a"],p=[[{label:"Drug Count Date",ref:"verification_date",value:e=>Object(u["f"])(e.verification_date)},{label:"Drug Name",ref:"short_name"},{label:"Expected Count",ref:"expected_quantity",value:e=>Object(u["g"])(e.expected_quantity)},{label:"Verified Count",ref:"current_quantity",value:e=>Object(u["g"])(e.current_quantity)},{label:"Difference",ref:"difference",value:e=>Object(u["g"])(e.difference)},{label:"Reason",ref:"variance_reason"}]],f=async()=>{if(!s.startDate||!s.endDate)return Object(o["e"])("Start date and end date required!");c.value=!0,t.value=[];try{t.value=await s.getDiscrepancyReport()}catch(e){Object(o["c"])("Unable to generate report!")}c.value=!1},m=()=>Object(d["a"])({onFinish:(e,t,n)=>{a.value=`Period (${n})`,s.startDate=e,s.endDate=t,f()}});return Object(n["onMounted"])(()=>!t.value.length&&m()),(e,o)=>(Object(n["openBlock"])(),Object(n["createBlock"])(Object(n["unref"])(r["D"]),null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Object(n["unref"])(r["z"]),{"is-open":c.value,message:"Please wait..."},null,8,["is-open"]),Object(n["createVNode"])(i["a"],{title:"Clinic Discrepancy Report",subtitle:a.value,columns:p,columnData:t.value,rowsPerPage:20,onConfigure:m,onRefresh:()=>f()},null,8,["subtitle","columnData","onRefresh"])]),_:1}))}});const s=c;t["default"]=s},"6be2":function(e,t,a){"use strict";a.d(t,"d",(function(){return i})),a.d(t,"g",(function(){return o})),a.d(t,"f",(function(){return u})),a.d(t,"e",(function(){return l})),a.d(t,"c",(function(){return d})),a.d(t,"b",(function(){return c})),a.d(t,"h",(function(){return p})),a.d(t,"a",(function(){return f}));var n=a("3800");const r=[n["m"],[["","Delete"]]],i=[n["j"],[["Delete"]]],o=[n["j"],[["Delete","Unknown"]]],u=[n["j"],[["N/A"],["Delete","Unknown"]]],l=[n["j"],[["Delete"]]],d=[n["j"],[["Unknown","Delete"],["Qwerty","A-Z"]]],c=[n["h"],[["Unknown"]]],s=[n["a"],[["0-9","Delete"],["Qwerty","Unknown"],["","Space"]]],p=[n["l"],[["","Delete"],["?123","0-9"],["Space","Unknown"]]],f=[{btn:"0-9",keyboard:d},{btn:"?123",keyboard:r},{btn:"A-Z",keyboard:s},{btn:"Qwerty",keyboard:p}]},"775a":function(e,t,a){"use strict";a.d(t,"a",(function(){return D}));var n,r,i=a("d95e"),o=a("1c74"),u=a("b446"),l=a("0011"),d=a("c731"),c=a("b5e4"),s=a("d867"),p=a("7a23"),f=a("2706");(function(e){e["MULTI_FIELD_DATE"]="Multipage date fields",e["CALENDAR_FIELD"]="Calendar",e["SINGLE_DATE_INPUT_FIELD"]="Single page date"})(n||(n={})),function(e){e["PERIOD_INPUT_TYPE"]="hts_report_date_period_type"}(r||(r={}));const m=Object(p["reactive"])({datePeriodInputType:localStorage.getItem(r.PERIOD_INPUT_TYPE)||n.MULTI_FIELD_DATE});function D(e){Object(d["a"])([...Object(u["b"])({id:"start_date",helpText:"Start",required:!0,minDate:()=>(null===e||void 0===e?void 0:e.minDate)||"",maxDate:()=>(null===e||void 0===e?void 0:e.maxDate)||o["e"].getSessionDate(),condition:()=>m.datePeriodInputType===n.MULTI_FIELD_DATE,estimation:{allowUnknown:!1},computeValue:e=>e}),...Object(u["b"])({id:"end_date",helpText:"End",required:!0,minDate:(e,t)=>t.start_date,maxDate:()=>(null===e||void 0===e?void 0:e.maxDate)||o["e"].getSessionDate(),condition:()=>m.datePeriodInputType===n.MULTI_FIELD_DATE,estimation:{allowUnknown:!1},computeValue:e=>e}),{id:"alt_start_date",proxyID:"start_date",helpText:"Start Date",type:i["b"].TT_FULL_DATE,validation:t=>{if(!t)return["Date is required"];const a=e.maxDate||o["e"].getSessionDate();return e.minDate&&new Date(t.value)<new Date(e.minDate)?[`${Object(l["f"])(""+t.value)} is less than minimum date of ${Object(l["f"])(e.minDate)}`]:a&&new Date(t.value)>new Date(a)?[`${Object(l["f"])(""+t.value)} is greater than max date of ${Object(l["f"])(a)}`]:null},computedValue:e=>e.value,condition:()=>m.datePeriodInputType===n.SINGLE_DATE_INPUT_FIELD},{id:"alt_end_date",proxyID:"end_date",helpText:"End Date",type:i["b"].TT_FULL_DATE,defaultValue:e=>e.start_date.value,validation:(t,a)=>{if(!t)return["Date is required"];const n=e.maxDate||o["e"].getSessionDate();return a.start_date.value&&new Date(t.value)<new Date(a.start_date.value)?[`${Object(l["f"])(""+t.value)} is less than minimum date of ${Object(l["f"])(a.start_date.value)}`]:n&&new Date(t.value)>new Date(n)?[`${Object(l["f"])(""+t.value)} is greater than max date of ${Object(l["f"])(n)}`]:null},computedValue:e=>e.label,condition:()=>m.datePeriodInputType===n.SINGLE_DATE_INPUT_FIELD},{id:"calendar_start_date",proxyID:"start_date",helpText:"Start Date",type:i["b"].TT_DATE_PICKER,computedValue:e=>e,condition:()=>m.datePeriodInputType===n.CALENDAR_FIELD,validation:e=>f["a"].required(e),config:{minDate:()=>e.minDate||null,maxDate:()=>e.maxDate||o["e"].getSessionDate(),infoItems:(e,t)=>[{label:"Start Date",value:Object(l["f"])(e)||"-"},{label:"End Date",value:Object(l["f"])(t.end_date)||"-"}],persistInfoItems:!1}},{id:"calendar_end_date",proxyID:"end_date",helpText:"End Date",type:i["b"].TT_DATE_PICKER,validation:e=>f["a"].required(e),defaultValue:e=>e.start_date.value,computedValue:e=>e,condition:()=>m.datePeriodInputType===n.CALENDAR_FIELD,config:{minDate:e=>e.start_date.value,maxDate:()=>e.maxDate||o["e"].getSessionDate(),infoItems:(e,t)=>[{label:"Start Date",value:Object(l["f"])(t.start_date)||"-"},{label:"End Date",value:Object(l["f"])(e)}],persistInfoItems:!1}}],async(t,a)=>{console.log(a),s["Z"].dismiss();try{const t=`${Object(l["f"])(a.start_date)} to ${Object(l["f"])(a.end_date)}`;e.onFinish(a.start_date,a.end_date,t)}catch(n){Object(c["c"])("An error has occurred")}})}},"91e4":function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a("ade3"),r=a("5969");class i extends r["a"]{constructor(){super(),Object(n["a"])(this,"stock",void 0),this.stock=[]}async loadStock(){this.stock=await this.getReport("pharmacy/items",{paginate:!1})}getStockReport(){return r["a"].getJson("pharmacy/stock_report",{paginate:!1})}getStockCardReport(){return this.getReport(`programs/${this.programID}/reports/stock_card`)}loadTrail(){return this.getReport("pharmacy/audit_trail/grouped")}getTrailDetails(e,t,a){return this.getReport("pharmacy/audit_trail",{transaction_date:e,drug_id:t,transaction_reason:a})}getScCurrReport(){return this.getReport("programs/1/reports/sc_curr")}getDiscrepancyReport(){return this.getReport(`programs/${this.programID}/reports/discrepancy_report`)}groupStock(){const e={};for(const t in this.stock){const a=this.stock[t],n=a["drug_id"];e[n]||(e[n]={current_quantity:0,dispensed_quantity:0,pack_size:a.pack_size,drug_name:null===a["drug_name"]?a["drug_legacy_name"]:a["drug_name"]}),0!==a.current_quantity&&(e[n]["current_quantity"]+=parseFloat(a.current_quantity),a.dispensed_quantity&&(e[n]["dispensed_quantity"]+=parseFloat(a.dispensed_quantity)))}return Object.values(e).map(e=>{let t="0";return t=null==e.pack_size?e.current_quantity+"(tabs)":Math.trunc(e.current_quantity/e.pack_size),{drugName:e.drug_name,quantintyDispensed:e.dispensed_quantity,currentQuantity:t,quantityIsTabs:null===e.pack_size}})}}},b446:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return h}));a("14d9"),a("13d5");var n,r=a("d95e"),i=[{label:"Jan",value:1},{label:"Feb",value:2},{label:"Mar",value:3},{label:"Apr",value:4},{label:"May",value:5},{label:"Jun",value:6},{label:"Jul",value:7},{label:"Aug",value:8},{label:"Sep",value:9},{label:"Oct",value:10},{label:"Nov",value:11},{label:"Dec",value:12}],o=a("9283"),u=a("2706"),l=a("3800"),d=a("6be2"),c=a("5a0c"),s=a.n(c),p=a("1c74");function f(e,t,a=!0){const n=[];return a&&n.push("UNKNOWN"),{id:e,helpText:t+" Year",appearInSummary:()=>!1,type:r["b"].TT_TEXT,config:{customKeyboard:[l["j"],[n,["DELETE"]]]}}}function m(e,t){return{id:e,helpText:t+" Month",appearInSummary:()=>!1,type:r["b"].TT_SELECT,options:()=>i}}function D(e,t){return{id:e,helpText:t+" Day",type:r["b"].TT_MONTHLY_DAYS,appearInSummary:()=>!1}}function b(e,t){return{id:e,helpText:t+" Estimated period",type:r["b"].TT_SELECT,appearInSummary:()=>!1,options:()=>[{label:"6 months ago",value:180},{label:"12 months ago",value:365},{label:"18 months ago",value:540},{label:"24 months ago",value:730},{label:"Over 2 years ago",value:730}]}}function _(e,t){return{id:e,helpText:t+" Age Estimate",type:r["b"].TT_NUMBER,appearInSummary:()=>!1,config:{keypad:d["e"]}}}function v(e){return parseInt(e)<10?"0"+e:e}async function y(e,t,a){if(t.defaultValue){const n=await t.defaultValue(e);if(n){const[e,t,r]=n.split("-");switch(a){case"Year":return e||"";case"Month":return parseInt(t)||"";case"Day":return parseInt(r)||""}}}return""}function T(e){return o["b"].toStandardHisDisplayFormat(e)}function g(e,t,a,n){if(t.minDate){const r=t.minDate(a,n);if(new Date(e)<new Date(r))return[`${T(e)} is less than minimum date of ${T(r)}`]}if(t.maxDate){const r=t.maxDate(a,n);if(r&&new Date(e)>new Date(r))return[`${T(e)} is greater than max date of  ${T(r)}`]}}function h(e,t=""){let a="",r="",l="",d="",c=!1;const h="year_"+e.id,I="month_"+e.id,x="day_"+e.id,E="age_estimate_"+e.id,w="duration_estimate_"+e.id,k=f(h,e.helpText,e.estimation.allowUnknown),O=m(I,e.helpText),j=D(x,e.helpText),S=_(E,e.helpText),N=b(w,e.helpText),$="boolean"===typeof e.estimation.allowUnknownMonthDay&&e.estimation.allowUnknownMonthDay,U=t=>!(t[h]&&t[h].value&&["Unknown"].includes(t[h].value))&&(!e.condition||e.condition(t)),A=(e,t)=>{const a=[{type:"year",value:r,default:"YYYY"},{type:"month",value:l,default:"MM"},{type:"day",value:d,default:"DD"}];return a.reduce((a,n)=>{const r=[null,void 0,"Unknown",""];return t===n.type?r.includes(e)?a.push(n.default):a.push(e):r.includes(n.value)?a.push(n.default):a.push(n.value),a},[]).join("-")};"function"===typeof e.init&&(k.init=e.init),k.updateHelpTextOnValue=e=>`${k.helpText} (${A(null===e||void 0===e?void 0:e.label,"year")})`,k.proxyID=e.id,k.unload=e=>r=e.value.toString(),k.config={...k.config,...e.config},k.defaultValue=t=>y(t,e,"Year"),k.condition=t=>!e.condition||e.condition(t),k.validation=(t,a,n)=>{if(e.required&&u["a"].required(t))return["Year cannot be empty"];const r=t?t.value:"";if(!e.estimation.allowUnknown&&r.toString().match(/unknown/i))return["Value unknown is not permitted"];if(r&&!["Unknown"].includes(r)&&isNaN(r)||r<1900)return["Invalid Year"];if(r&&"function"===typeof e.minDate){const t=o["b"].getYear(e.minDate(a,n));if(parseInt(r)<t)return[`Year of ${r} is less than Minimum year of ${t}`]}if(r&&"function"===typeof e.maxDate){const t=e.maxDate(a,n);if(t&&r>o["b"].getYear(t))return[`Year of ${r} exceeds Maximum year of ${o["b"].getYear(t)}`]}return null},k.summaryMapValue=()=>({label:e.summaryLabel||e.helpText,value:a?T(a):"Unknown"}),k.appearInSummary=(t,a)=>a===e.id,k.computedValue=t=>{if(a){const[n,r,i]=a.split("-");return a=`${t.value}-${r}-${i}`,e.computeValue(a,!1)}if(t&&"Unknown"===t.value)return a="",e.computeValue("Unknown",!1)},O.updateHelpTextOnValue=e=>`${O.helpText} (${A(null===e||void 0===e?void 0:e.label,"month")})`,O.proxyID=e.id,O.unload=e=>l=v(e.value.toString()),O.condition=e=>U(e),O.validation=e=>u["a"].required(e),O.defaultValue=t=>y(t,e,"Month"),$&&(O.options=()=>[...i,{label:"Unknown",value:"Unknown"}]),O.computedValue=(t,n)=>{if((""+t.value).match(/unknown/i))return a=n[h].value+"-07-15",e.computeValue(a,!0);if(a){const[n,r,i]=a.split("-"),o=v(""+t.value);return a=`${n}-${o}-${i}`,e.computeValue(a,!1)}},j.proxyID=e.id,j.updateHelpTextOnValue=e=>`${j.helpText} (${A(null===e||void 0===e?void 0:e.label,"day")})`,j.condition=e=>!(""+e[I].value).match(/unknown/i)&&U(e),j.validation=(t,n,i)=>u["a"].required(t)?["Day is required for date"]:(c=!!(""+t.value).match(/unknown/i),d=c?"15":v(""+t.value),a=`${r}-${l}-${d}`,g(a,e,n,i)),j.defaultValue=t=>y(t,e,"Day"),j.computedValue=()=>e.computeValue(a,c),j.unload=(t,a,n,r)=>{e.unload&&e.unload(t,a,n,r)},j.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),j.config={year:e=>e[h].value,month:e=>e[I].value},$||(j.config.keyboardActions=[]);const L=(t,a)=>{const n=["Unknown"===t[h].value,!e.condition||e.condition(t),e.estimation.estimationFieldType===a];return n.every(Boolean)};return S.proxyID=e.id,S.validation=(t,n,r)=>{if(t&&t.value>300)return["Age estimate is too high and exceeding hard limit of 300"];if(isNaN(parseInt(t.value.toString())))return["Please enter a valid number"];const i=/^(12[0-7]|1[01][0-9]|[1-9]?[0-9])$/;if(!t.value.toString().match(i))return["Not a valid age estimate"];const o=s()(p["e"].getSessionDate()).subtract(t.value,"years").year();return a=o+"-07-15",g(a,e,n,r)},S.condition=e=>L(e,n.AGE_ESTIMATE_FIELD),S.computedValue=()=>e.computeValue(a,!0),S.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),N.proxyID=e.id,N.validation=(t,n,r)=>u["a"].required(t)?["Please select an estimate"]:(a=s()(p["e"].getSessionDate()).subtract(t.value,"day").format(o["a"]),g(a,e,n,r)),N.condition=e=>L(e,n.MONTH_ESTIMATE_FIELD),N.computedValue=()=>e.computeValue(a,!0),N.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),[k,O,j,S,N]}(function(e){e["AGE_ESTIMATE_FIELD"]="age-estimate-field",e["MONTH_ESTIMATE_FIELD"]="month-period-estimate-field"})(n||(n={}))}}]);
//# sourceMappingURL=chunk-4ee8c26d.742f3a47.js.map