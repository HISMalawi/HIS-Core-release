(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5ae9a034"],{"0a4b":function(e,t,i){"use strict";i.r(t);var a=i("7a23");function r(e,t,i,r,n,o){const s=Object(a["resolveComponent"])("his-standard-form");return Object(a["openBlock"])(),Object(a["createBlock"])(s,{onOnIndex:t[0]||(t[0]=t=>e.fieldComponent=""),skipSummary:!0,activeField:e.fieldComponent,fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:"/patient/dashboard/"+e.patientData.id},null,8,["activeField","fields","onFinishAction","cancelDestinationPath"])}i("14d9");var n=i("d95e"),o=i("7920"),s=i("b446"),l=i("2706"),d=i("23e6"),u=i("9283"),c=i("1c74");class h extends c["e"]{constructor(){super()}static voidRelation(e,t,i){return c["e"].void(`people/${e}/relationships/${t}`,{reason:i})}static async amendRelation(e,t,i,a){return await h.voidRelation(e,i,"Updating guardian relationship"),h.createRelation(e,t,a)}static getRelations(){return super.getJson("types/relationships")}static createRelation(e,t,i){return super.postJson(`people/${e}/relationships`,{relationship_type_id:i,relation_id:t})}}var m=i("2ef0"),_=i("80b5"),g=i("1f9a"),p=i("0fa1"),b=i("b5e4"),f=i("7def"),v=i("7f35"),y=i("8734"),D=i("76df"),F=Object(a["defineComponent"])({components:{HisStandardForm:o["a"]},data:()=>({patientData:{},guardianData:{},fieldAction:"",fieldComponent:"",fields:[],form:{},redirectURL:"",activeField:"",currentAddressAttributes:["current_region","current_district","current_village","current_traditional_authority"],homeAddressAttributes:["home_region","home_district","home_traditional_authority","home_village"]}),watch:{$route:{async handler({params:e,query:t}){if(e.patient_id){const i=await d["a"].findByID(e.patient_id);i&&(this.patientData=_["a"].mapPersonData(i.person),t.edit_guardian&&(this.fieldAction="edit"),this.fields=this.getFields())}t.source&&(this.redirectURL=t.source)},immediate:!0,deep:!0}},methods:{getFields(){let e=[];return e.push(this.guardianSelection()),e.push(this.guardianIndex()),e.push(this.scanGuardian()),e.push(this.givenNameField()),e.push(this.familyNameField()),e.push(this.genderField()),e.push(this.searchResultField()),e=e.concat(this.dobFields()),e.push(this.homeRegionField()),e.push(this.homeDistrictField()),e.push(this.homeTAField()),e.push(this.homeVillageField()),e.push(this.currentRegionField()),e.push(this.currentDistrictField()),e.push(this.currentTAField()),e.push(this.currentVillage()),e=e.concat(this.landmarkFields()),e.push(this.cellPhoneField()),e.push(this.relationsField()),e},async onFinish(e,t){if(this.isEditMode()){if("relations"!=this.activeField){const e=new g["a"];e.setPersonID(this.guardianData.id),await e.updatePerson(_["a"].resolvePerson(t)),Object.keys(t).forEach(e=>{var i;e in this.guardianData&&(this.guardianData[e]=(null===(i=t[e])||void 0===i?void 0:i.date)||t[e].person)})}else{var i;if(null!==(i=this.guardianData)&&void 0!==i&&i.relation){const t=await h.amendRelation(this.patientData.id,this.guardianData.id,this.guardianData.relation.relationship_id,e.relations.other.relationship_type_id);t&&(this.guardianData.relation=t)}}this.fieldComponent="guardian_index"}else if(this.isSameAsPatient(t))Object(b["e"])("Guardian cannot be the same patient");else{let i=-1;if(this.isRegistrationMode()){const e=new g["a"];await e.registerGuardian(_["a"].resolvePerson(t)),i=e.getPersonID()}else i=this.guardianData.id;await h.createRelation(this.patientData.id,i,e.relations.other.relationship_type_id),this.redirectURL?this.$router.push({name:this.redirectURL}):this.$route.query.edit_guardian?this.fieldComponent="select_guardian":await Object(p["b"])(this.patientData.id,this.$router,this.$route)}},isEditMode(){return"edit"===this.fieldAction},isSearchMode(){return["Search","Registration"].includes(this.fieldAction)},isRegistrationMode(){return"Registration"===this.fieldAction},canEdit(e,t=!0,i=!0){return this.isEditMode()?e.includes(this.activeField)&&i:t},isSameAsPatient(e){let t="",i="",a="";return this.isRegistrationMode()?(t=u["b"].toStandardHisDisplayFormat(e.birth_date.date),i=e.given_name.person&&e.family_name.person,a=e.gender.person):(t=this.guardianData.birth_date,i=this.guardianData.name,a=this.guardianData.gender),i.toLowerCase()===this.patientData.name.toLowerCase()&&t===this.patientData.birth_date&&a===this.patientData.gender},guardianSelection(){return{id:"select_guardian",helpText:"Select guardian to edit/view",type:n["b"].TT_SELECT,condition:()=>this.isEditMode(),validation:e=>l["a"].required(e),options:async()=>{const e=await f["a"].getRelationships(this.patientData.id);if(!Object(m["isEmpty"])(e))return e.map(e=>{const t=_["a"].mapPersonData(e.relation);return{label:`${t.name} (${e.type.b_is_to_a})`,value:e.relation.person_id,other:{relations:e,details:t}}});{await Object(y["a"])(450);const e=await Object(v["a"])("Patient has no guardians","","Select option to proceed",[{name:"Cancel",slot:"start",color:"danger"},{name:"Register new",slot:"start",color:"success"}]);"Register new"===e?(this.guardianData={},this.fieldAction="Registration",this.fieldComponent="scan"):this.$router.back()}return[]},config:{footerBtns:[{name:"New Guardian",slot:"end",color:"primary",onClick:()=>{this.guardianData={},this.fieldAction="Registration",this.fieldComponent="scan"}}]}}},getDefaultVal(e){try{return this.guardianData[e]}catch(t){return""}},guardianIndex(){return{id:"guardian_index",helpText:"Guardian details",type:n["b"].TT_TABLE_VIEWER,condition:e=>e.select_guardian.value,options:e=>{this.guardianData&&this.guardianData.id!=e.select_guardian.value&&(this.guardianData={...e.select_guardian.other.details,relation:e.select_guardian.other.relations});const t=e=>({name:"Edit",type:"button",action:()=>{this.activeField=e,this.fieldComponent=this.activeField}}),i=[["Given Name",this.guardianData.given_name,t("given_name")],["Family Name",this.guardianData.family_name,t("family_name")],["Gender",this.guardianData.gender,t("gender")],["Birthdate",u["b"].toStandardHisDisplayFormat(this.guardianData.birth_date),t("year_birth_date")],["Cell Phone Number",this.guardianData.cell_phone_number,t("cell_phone_number")],["Home District",this.guardianData.home_district,t("home_region")],["Home TA",this.guardianData.home_traditional_authority,t("home_region")],["Home Village",this.guardianData.home_village,t("home_region")],["Current district",this.guardianData.current_district,t("current_region")],["Current T/A",this.guardianData.current_traditional_authority,t("current_region")],["Landmark",this.guardianData.landmark,t("default_landmarks")],["Relation",this.guardianData.relation.type.b_is_to_a,t("relations")]];return[{label:"",value:"",other:{rows:i}}]},config:{overrideDefaultFooterBtns:{nextBtn:{name:"Finish",slot:"end",color:"success",onClick:()=>this.fieldComponent="select_guardian"}},footerBtns:[{name:"Void Relation",slot:"start",color:"danger",onClick:async()=>{Object(D["a"])(async e=>{await h.voidRelation(this.patientData.id,this.guardianData.relation.relationship_id,e),this.fieldComponent="select_guardian"})}}],hiddenFooterBtns:["Clear","Back"]}}},givenNameField(){const e=_["a"].getGivenNameField();return e.helpText="Guardian First name",e.defaultValue=()=>this.getDefaultVal(e.id),e.condition=()=>this.canEdit([e.id],this.isSearchMode()),e},familyNameField(){const e=_["a"].getFamilyNameField();return e.helpText="Guardian Last name",e.defaultValue=()=>this.getDefaultVal(e.id),e.condition=()=>this.canEdit([e.id],this.isSearchMode()),e},genderField(){const e=_["a"].getGenderField();return e.defaultValue=()=>this.getDefaultVal(e.id),e.condition=()=>this.canEdit([e.id],this.isSearchMode()),e},dobFields(){const e=_["a"].getDobConfig();return e.defaultValue=()=>this.getDefaultVal("birth_date"),e.condition=()=>this.canEdit(["year_birth_date","month_birth_date","day_birth_date"],this.isRegistrationMode()),Object(s["b"])(e)},homeRegionField(){const e=_["a"].getHomeRegionField();return e.condition=()=>this.canEdit(this.homeAddressAttributes,this.isRegistrationMode()),e},homeDistrictField(){const e=_["a"].getHomeDistrictField();return e.condition=()=>this.canEdit(this.homeAddressAttributes,this.isRegistrationMode()),e},homeTAField(){const e=_["a"].getHomeTaField();return e.condition=e=>this.canEdit(this.homeAddressAttributes,this.isRegistrationMode()&&!e.home_region.label.match(/foreign/i),!e.home_region.label.match(/foreign/i)),e},homeVillageField(){const e=_["a"].getHomeVillageField();return e.condition=e=>this.canEdit(this.homeAddressAttributes,this.isRegistrationMode()&&!e.home_region.label.match(/foreign/i),!e.home_region.label.match(/foreign/i)),e},currentRegionField(){const e=_["a"].getCurrentRegionField();return e.condition=()=>this.canEdit(this.currentAddressAttributes,this.isRegistrationMode()),e},currentDistrictField(){const e=_["a"].getCurrentDistrictField();return e.condition=()=>this.canEdit(this.currentAddressAttributes,this.isRegistrationMode()),e},currentTAField(){const e=_["a"].getCurrentTAfield();return e.condition=e=>this.canEdit(this.currentAddressAttributes,this.isRegistrationMode()&&!e.current_region.label.match(/foreign/i),!e.current_region.label.match(/foreign/i)),e},currentVillage(){const e=_["a"].getCurrentVillageField();return e.condition=e=>this.canEdit(this.currentAddressAttributes,this.isRegistrationMode()&&!e.current_region.label.match(/foreign/i),!e.current_region.label.match(/foreign/i)),e},cellPhoneField(){const e=_["a"].getCellNumberField();return e.condition=()=>this.canEdit([e.id],this.isRegistrationMode()),e},landmarkFields(){const e=_["a"].getLandmarkFields(),t=e[0].proxyID||e[0].id;return e[0].defaultValue=()=>this.getDefaultVal(t),e[0].condition=()=>this.canEdit([t],this.isRegistrationMode()),e},relationsField(){return{id:"relations",helpText:"Select relationship type",type:n["b"].TT_RELATION_SELECTION,defaultValue:()=>this.getDefaultVal("relations"),validation:e=>l["a"].required(e),condition:()=>this.canEdit(["relations"]),onload:e=>{if(e.patient=this.patientData,this.isRegistrationMode()){const t=_["a"].resolvePerson(e.cdata);e.guardian={name:`${t.given_name} ${t.family_name}`,birth_date:u["b"].toStandardHisDisplayFormat(t.birthdate),home_address:`${t.home_district} ${t.home_traditional_authority}`}}else e.guardian=this.guardianData},options:async()=>{const e=await h.getRelations();return e.map(e=>({label:e.b_is_to_a,value:e.description,other:e}))},config:{hiddenFooterBtns:["Clear"]}}},scanGuardian(){return{id:"scan",helpText:"Scan or Register Guardian",type:n["b"].TT_BARCODE,requireNext:!1,condition:()=>!this.isEditMode(),onValue:async e=>{const t=await d["a"].findByNpid(e);return Object(m["isEmpty"])(t)||(this.guardianData=_["a"].mapPersonData(t[0].person),this.fieldComponent="relations",this.fieldAction="Scan"),!1},config:{hiddenFooterBtns:["Clear","Next","Back"],footerBtns:[{name:"Find or Register Guardian",color:"success",slot:"end",onClick:()=>{this.fieldAction="Search",this.fieldComponent="given_name"}}]}}},searchResultField(){return{id:"results",helpText:"Search results",type:n["b"].TT_PERSON_RESULT_VIEW,dynamicHelpText:e=>`Search results for \n                "${e.given_name.value} ${e.family_name.value} | ${e.gender.label}"\n                `,appearInSummary:()=>!1,condition:()=>this.isSearchMode(),validation:e=>l["a"].required(e),options:async e=>{const t=await d["a"].search({given_name:e.given_name.value,family_name:e.family_name.value,gender:e.gender.value});return t.map(e=>_["a"].getPersonAttributeOptions(e))},config:{hiddenFooterBtns:["Clear","Next","Back"],footerBtns:[{name:"Edit Search",slot:"end",onClick:()=>{this.fieldAction="Search",this.fieldComponent="given_name"}},{name:"New Guardian",slot:"end",onClick:()=>{this.fieldAction="Registration",this.fieldComponent="year_birth_date"}},{name:"Continue Guardian",color:"success",slot:"end",state:{disabled:{default:()=>!0,onValue(e,t){return Object(m["isEmpty"])(t.results)}}},onClick:e=>{this.guardianData=_["a"].mapPersonData(e.results.other.person.person),this.fieldComponent="relations",this.fieldAction="Search"}}]}}}}}),T=i("6b0d"),E=i.n(T);const A=E()(F,[["render",r]]);t["default"]=A},"76df":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var a=i("7f35");async function r(e,t="action-sheet-modal"){const i=await Object(a["c"])("Are you sure you want to void record?","Please specify reason for voiding this record",["Mistake/ Wrong Entry","Duplicate","System Error"],[{name:"Cancel",slot:"start"},{name:"Void",color:"danger",slot:"end",role:"action"}],"",t);i.selection&&"Void"===i.action&&await e(i.selection)}},7920:function(e,t,i){"use strict";var a=i("7a23");function r(e,t,i,r,n,o){return Object(a["openBlock"])(),Object(a["createBlock"])(Object(a["resolveDynamicComponent"])(e.formType),{fields:e.fields,skipSummary:e.skipSummary,activeField:e.activeField,cancelDestinationPath:e.cancelDestinationPath,onOnFinish:e.onFinish,onFinish:e.onFinishAction,onOnIndex:e.onIndex},null,40,["fields","skipSummary","activeField","cancelDestinationPath","onOnFinish","onFinish","onOnIndex"])}var n=i("9441"),o=Object(a["defineComponent"])({name:"HisStandardForm",components:{TouchScreenForm:n["a"]},emits:["onFinish","onIndex"],data:()=>({formType:"touch-screen-form"}),props:{onFinishAction:{type:Function},skipSummary:{type:Boolean,default:!1},activeField:{type:String},fields:{type:Object,required:!0},cancelDestinationPath:{type:String,required:!1}},methods:{onFinish(e,t){this.$emit("onFinish",e,t)},onIndex(e){this.$emit("onIndex",e)}}}),s=i("6b0d"),l=i.n(s);const d=l()(o,[["render",r]]);t["a"]=d},"80b5":function(e,t,i){"use strict";i("13d5");var a=i("e86e"),r=i("d95e"),n=i("2706"),o=i("d10e"),s=i("b446"),l=i("9283"),d=i("23e6"),u=i("2ef0"),c=i("b5e4"),h=i("5713"),m=i("1c74");function _(e){return e.map(e=>({label:e,value:e}))}t["a"]={resolvePerson(e){let t={};for(const i in e){const a=e[i];Object(u["isPlainObject"])(a)&&"person"in a&&(Object(u["isPlainObject"])(a.person)?t={...t,...a.person}:t[i]=a["person"])}return t},getGivenNameField(){return{id:"given_name",helpText:"First name",type:r["b"].TT_TEXT,computedValue:e=>({person:e.value}),validation:e=>n["a"].isName(e),options:async e=>{if(e.given_name){const t=await o["a"].searchGivenName(e.given_name.value);return _(t)}return[]}}},getFamilyNameField(){return{id:"family_name",helpText:"Last name",type:r["b"].TT_TEXT,computedValue:e=>({person:e.value}),validation:e=>n["a"].isName(e),options:async e=>{if(e.family_name){const t=await o["a"].searchFamilyName(e.family_name.value);return _(t)}return[]}}},getGenderField(e){return{id:"gender",helpText:"Sex",type:r["b"].TT_SELECT,computedValue:e=>({person:e.value}),validation:e=>n["a"].required(e),options:()=>Object(u["isEmpty"])(e)?[{label:"Female",value:"F"},{label:"Male",value:"M"}]:e}},getDobConfig(e=!0){return{id:"birth_date",summaryLabel:"Date of Birth",helpText:e?"Birth":"",required:!0,minDate:()=>l["b"].estimateDateFromAge(100),maxDate:()=>o["a"].getSessionDate(),estimation:{allowUnknown:!0,allowUnknownMonthDay:!0,estimationFieldType:s["a"].AGE_ESTIMATE_FIELD},computeValue:(e,t)=>({date:e,isEstimate:t,person:{birthdate:e,birthdate_estimated:t}})}},getHomeRegionField(){return{id:"home_region",helpText:"Region of origin",type:r["b"].TT_SELECT,group:"person",requireNext:!1,computedValue:e=>({person:e.label}),validation:e=>n["a"].required(e),options:()=>Object(a["e"])()}},getHomeDistrictField(){return{id:"home_district",helpText:"District of origin",type:r["b"].TT_SELECT,requireNext:!1,summaryMapValue:(e,t)=>{var i;return{label:/foreign/i.test(""+(null===t||void 0===t||null===(i=t.home_region)||void 0===i?void 0:i.label))?"Home Country":"District of origin",value:e.label}},dynamicHelpText:e=>{var t;return/foreign/i.test(""+(null===e||void 0===e||null===(t=e.home_region)||void 0===t?void 0:t.label))?"Home Country":"District of origin"},computedValue:e=>({person:e.label}),options:e=>Object(a["a"])(e.home_region.value)}},addCustomLocationBtnForTAorVillage(e,t){return{name:"Add "+e,slot:"end",color:"success",onClick:async(i,a,r)=>{if("string"!=typeof r.filter||r.filter.length<3)return Object(c["e"])("Please enter a valid "+e);if(!Object(u["isEmpty"])(r.filtered))return Object(c["e"])("Can't add existing "+e);const n=await Object(c["a"])(`Do you want to add ${e} ${r.filter}?`);if(!n)return;const o=await h["a"].createAddress(e,r.filter,i[t].value);if(!o)return Object(c["e"])("Unable to add "+e);r.filter=r.filter.toUpperCase()}}},getHomeTaField(){return{id:"home_traditional_authority",helpText:"TA of origin",type:r["b"].TT_SELECT,requireNext:!1,config:{showKeyboard:!0,isFilterDataViaApi:!0,footerBtns:[this.addCustomLocationBtnForTAorVillage("TA","home_district")]},defaultOutput:()=>({label:"N/A",value:"N/A"}),computedValue:e=>({person:e.label}),validation:e=>n["a"].required(e),options:(e,t)=>Object(a["g"])(e.home_district.value,t)}},getHomeVillageField(){return{id:"home_village",helpText:"Village of origin",type:r["b"].TT_SELECT,config:{showKeyboard:!0,isFilterDataViaApi:!0,footerBtns:[this.addCustomLocationBtnForTAorVillage("Village","home_traditional_authority")]},requireNext:!1,defaultOutput:()=>({label:"N/A",value:"N/A"}),computedValue:e=>({person:e.label}),validation:e=>n["a"].required(e),options:(e,t)=>Object(a["h"])(e.home_traditional_authority.value,t)}},getCurrentRegionField(){return{id:"current_region",helpText:"Region of current residence",requireNext:!1,type:r["b"].TT_SELECT,computedValue:(e,t)=>/use home/i.test(""+e.value)?{person:{current_region:t.home_region.label,current_district:t.home_district.label,current_traditional_authority:t.home_traditional_authority.label,current_village:t.home_village.label}}:{person:e.label},validation:e=>n["a"].required(e),options:()=>Object(a["e"])(),config:{footerBtns:[{name:"Same as origin",slot:"end",onClickComponentEvents:{setValue:()=>"Use Home Address"},onClick:()=>"Use Home Address"}]}}},getCurrentDistrictField(){return{id:"current_district",helpText:"District",requireNext:!1,type:r["b"].TT_SELECT,summaryMapValue:(e,t)=>{var i;return{label:/foreign/i.test(""+(null===t||void 0===t||null===(i=t.home_region)||void 0===i?void 0:i.label))?"Current Country":"District of current residence",value:e.label}},dynamicHelpText:e=>e.current_region&&e.current_region.label.match(/foreign/i)?"Current Country":"District of current residence",computedValue:e=>({person:e.label}),validation:e=>n["a"].required(e),options:e=>Object(a["a"])(e.current_region.value)}},getCurrentTAfield(){return{id:"current_traditional_authority",helpText:"TA of current residence",requireNext:!1,type:r["b"].TT_SELECT,config:{showKeyboard:!0,isFilterDataViaApi:!0,footerBtns:[this.addCustomLocationBtnForTAorVillage("TA","current_district")]},defaultOutput:e=>{var t;if(!/use home/i.test(""+(null===(t=e.current_region)||void 0===t?void 0:t.label)))return{label:"N/A",value:"N/A"}},computedValue:e=>({person:e.label}),validation:e=>n["a"].required(e),options:(e,t)=>Object(a["g"])(e.current_district.value,t)}},getCurrentVillageField(){return{id:"current_village",helpText:"Village of current residence",requireNext:!1,type:r["b"].TT_SELECT,config:{showKeyboard:!0,isFilterDataViaApi:!0,footerBtns:[this.addCustomLocationBtnForTAorVillage("Village","current_traditional_authority")]},defaultOutput:e=>{var t;if(!/use home/i.test(""+(null===(t=e.current_region)||void 0===t?void 0:t.label)))return{label:"N/A",value:"N/A"}},computedValue:e=>({person:e.label}),validation:e=>n["a"].required(e),options:(e,t)=>Object(a["h"])(e.current_traditional_authority.value,t)}},getCellNumberField(){return{id:"cell_phone_number",helpText:"Cell phone number",group:"person",type:r["b"].TT_TEXT,computedValue:e=>({person:e.label}),validation:e=>{if(e){if(e.value.match(/Unknown|n\/a/i))return null;for(const t of(""+e.value).split("/"))if(n["a"].isMWPhoneNumber({label:t,value:t}))return[`"${t}" is not a valid phone number`];return null}return["Phone number cannot be empty"]},config:{customKeyboard:[[["1","2","3"],["4","5","6"],["7","8","9"],["","0",""]],[["+265","/"],["Unknown","N/A"],["Delete"]]]}}},getLandmarkFields(){return[{id:"default_landmarks",proxyID:"landmark",helpText:"Closest Landmark or Plot Number",type:r["b"].TT_SELECT,appearInSummary:e=>"Other"!=e.default_landmarks.value,computedValue:e=>({person:e.value}),validation:e=>n["a"].required(e),options:()=>_(["Catholic Church","CCAP","Seventh Day","Mosque","Primary School","Borehole","Secondary School","College","Market","Football Ground","Other"])},{id:"other_landmark",proxyID:"landmark",helpText:"Closest Landmark or Plot Number",type:r["b"].TT_NOTE,appearInSummary:e=>"Other"===e.default_landmarks.value,condition:e=>"Other"===e.default_landmarks.value,computedValue:e=>({person:e.value}),validation:e=>n["a"].required(e)}]},getFacilityLocationField(){return{id:"location",helpText:"Please select facility name",type:r["b"].TT_SELECT,computedValue:e=>({person:e.label}),validation:e=>n["a"].required(e),options:(e,t="")=>Object(a["b"])(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}}},getPersonNameFromPersonObj(e,t){return e.names.length?e.names[0][t]:""},getAttrFromPersonObj(e,t){return Array.isArray(e.person_attributes)&&e.person_attributes.length?e.person_attributes.reduce((e,i)=>i.type.name===t?i.value:e,""):""},getAddressFromPersonObj(e,t){if(Array.isArray(e.addresses)&&e.addresses.length){const i=e.addresses[0],a={home_district:"address2",home_village:"neighborhood_cell",home_traditional_authority:"county_district",current_village:"city_village",current_traditional_authority:"township_division",current_district:"state_province"};return i[a[t]]}return""},mapPersonData(e){const t=this.getPersonNameFromPersonObj(e,"given_name"),i=this.getPersonNameFromPersonObj(e,"family_name"),a=this.getAddressFromPersonObj(e,"home_district"),r=this.getAddressFromPersonObj(e,"home_village"),n=this.getAddressFromPersonObj(e,"home_traditional_authority");return{id:e.person_id,name:`${t} ${i}`,given_name:t,family_name:i,gender:e.gender,birth_date:e.birthdate,birthdate_estimated:e.birthdate_estimated,home_district:a,home_village:r,home_traditional_authority:n,home_address:`${a} ${r}`,current_district:this.getAddressFromPersonObj(e,"current_district"),current_traditional_authority:this.getAddressFromPersonObj(e,"current_traditional_authority"),cell_phone_number:this.getAttrFromPersonObj(e,"Cell Phone Number"),landmark:this.getAttrFromPersonObj(e,"Landmark Or Plot Number")}},getPersonAttributeOptions(e){const t=new d["a"](e),i=(e,t)=>t in e?e[t]():"-";return{label:t.getPatientInfoString(),value:t.getID()||t.getNationalID(),other:{patientID:t.getID(),npid:t.getNationalID(),person:e,options:[{label:"National ID",value:i(t,"getNationalID")},{label:"ARV Number",value:i(t,"getArvNumber"),other:{show:()=>"ART"===m["e"].getProgramName()}},{label:"Name",value:i(t,"getFullName")},{label:"Sex",value:i(t,"getGender")},{label:"Birthdate",value:i(t,"getBirthdate")},{label:"Home District",value:i(t,"getHomeDistrict")},{label:"Home Village",value:i(t,"getHomeVillage")},{label:"Current District",value:i(t,"getCurrentDistrict")},{label:"Current T/A",value:i(t,"getCurrentTA")},{label:"Cellphone",value:i(t,"getPhoneNumber")}]}}}}},"8e3d":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return storageFactory}));var _home_andrew_dev_Projects_HIS_Core_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ade3"),lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("2ef0"),lodash__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);const INDEX_STORE="openmrs",DB_NAME="offline_db",storageFactory=(storageName="IndexedDBStorage")=>eval(`new ${storageName}()`);class LocalStorage{existsinStorage(e){const t=localStorage.getItem(e);return t?Promise.resolve(!0):Promise.resolve(!1)}getFromStorage(e){return new Promise((t,i)=>{const a=localStorage.getItem(e);if(a)return t(JSON.parse(a));t([])})}deleteFromStorage(e){return localStorage.removeItem(e),!0}saveToStorage(e,t){return localStorage.setItem(e,JSON.stringify(t)),!0}}class IndexedDBStorage{constructor(){Object(_home_andrew_dev_Projects_HIS_Core_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"db",void 0);const e=indexedDB.open(DB_NAME,1);e.onupgradeneeded=function(){e.result.createObjectStore(INDEX_STORE)},e.onsuccess=()=>{this.db=e.result}}existsinStorage(e){return new Promise((t,i)=>{const a=this.db.transaction(INDEX_STORE).objectStore(INDEX_STORE).get(e);a.onsuccess=()=>{t(a.result)},a.onerror=()=>{i(a.error)}})}getFromStorage(e,t){return new Promise((i,a)=>{const r=this.db.transaction(INDEX_STORE).objectStore(INDEX_STORE).openCursor();r.onsuccess=()=>{const a=r.result;a?(a.key===e&&i(t?filteredData(a,t):a.value.data),a.continue()):i([])},r.onerror=()=>{a("error")}})}saveToStorage(e,t){return this.db.transaction(INDEX_STORE,"readwrite").objectStore(INDEX_STORE).put(t,e),!0}deleteFromStorage(e){return this.db.transaction(INDEX_STORE,"readwrite").objectStore(INDEX_STORE).delete(e),!0}}function filteredData(e,t){return Object(lodash__WEBPACK_IMPORTED_MODULE_1__["filter"])(e.value,e=>Object.entries(t).every(([t,i])=>Object(lodash__WEBPACK_IMPORTED_MODULE_1__["isInteger"])(e[t])?!i||e[t]===i:!i||Object(lodash__WEBPACK_IMPORTED_MODULE_1__["toLower"])(e[t]).includes(Object(lodash__WEBPACK_IMPORTED_MODULE_1__["toLower"])(i))))}},e86e:function(e,t,i){"use strict";i.d(t,"b",(function(){return l})),i.d(t,"d",(function(){return d})),i.d(t,"c",(function(){return u})),i.d(t,"f",(function(){return c})),i.d(t,"e",(function(){return h})),i.d(t,"a",(function(){return m})),i.d(t,"g",(function(){return _})),i.d(t,"h",(function(){return g}));var a=i("5713"),r=i("8e3d"),n=i("13ea"),o=i.n(n);const s=Object(r["a"])();async function l(e=""){let t=await s.getFromStorage("locations",{name:e});return o()(t)&&(t=await a["a"].getFacilities({name:e})),t.filter(e=>!o()(e)&&""!=e.name.trim()).map(e=>({label:e.name,value:e.location_id,other:e}))}async function d(e=""){const t=await a["a"].getLabs({search_name:e});return t.map(e=>({label:e,value:e}))}async function u(e=""){const t=await a["a"].getFacilities({name:e,tag:"Facility adult sections"});return t.map(e=>({label:e.name,value:e.name,other:e}))}async function c(){const e=await a["a"].getSpecialistClinics();return e.map(e=>({label:e.name,value:e.name,other:e}))}async function h(){let e=await s.getFromStorage("regions",[]);return o()(e)&&(e=await a["a"].getRegions()),e.map(e=>({label:e.name,value:e.region_id,other:e}))}async function m(e){let t=await s.getFromStorage("districts",{region_id:e});return o()(t)&&(t=await a["a"].getDistricts(e)),t.map(e=>({label:e.name,value:e.district_id,other:e}))}async function _(e,t=""){let i=await s.getFromStorage("traditional_authorities",{district_id:e,name:t});return o()(i)&&(i=await a["a"].getTraditionalAuthorities(e,t)),i.map(e=>({label:e.name,value:e.traditional_authority_id,other:e}))}async function g(e,t=""){let i=await s.getFromStorage("villages",{traditional_authority_id:e,name:t});return o()(i)&&(i=await a["a"].getVillages(e,t)),i.map(e=>({label:e.name,value:e.village_id,other:e}))}}}]);
//# sourceMappingURL=chunk-5ae9a034.76661a20.js.map