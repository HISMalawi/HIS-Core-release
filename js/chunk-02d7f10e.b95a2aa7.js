(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-02d7f10e"],{3383:function(e,t,n){"use strict";n.r(t);var a=n("7a23");function o(e,t,n,o,i,r){const s=Object(a["resolveComponent"])("his-standard-form"),l=Object(a["resolveComponent"])("ion-page");return Object(a["openBlock"])(),Object(a["createBlock"])(l,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(s,{formLabel:"ART (Re-) Initiation",fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:e.patientDashboardUrl()},null,8,["fields","onFinishAction","cancelDestinationPath"])]),_:1})}var i=n("d95e"),r=n("d867"),s=n("c39b"),l=n("e86e"),c=n("0011"),u=n("2ef0"),d=n("7920"),_=n("e9be"),m=Object(a["defineComponent"])({components:{IonPage:r["D"],HisStandardForm:d["a"]},setup(){const e=Object(a["ref"])([]),t=new s["a"](-1),{toOption:n,yesNoOptions:o,saveEncounter:r,patientDashboardUrl:d}=Object(_["a"])({onInitVisit:()=>{e.value=[p(),b(),f(),h(),g()]}});function m(e,n){r({encounterName:"ART Enrollment",encounterTypeID:t.encounterTypeID,computedData:n})}function p(){return{id:"is_referral",helpText:"Referral for ART (Re-)Initiation",type:i["b"].TT_YES_NO,isRequired:()=>!0,finalComputedValue:e=>({obs:t.buildValueText("ART referral",e)}),options:()=>[{label:"Do you want to refer client?",value:"",values:o()}]}}function b(){return{id:"art_site",helpText:"Intended Site for ART",type:i["b"].TT_SELECT,isRequired:()=>!0,finalComputedValue:({label:e})=>({obs:t.buildValueText("Referral location",e)}),options:(e,t="")=>Object(l["b"])(t),condition:e=>"Yes"===e.is_referral,defaultValue:()=>s["a"].getLocationName(),config:{footerBtns:[{name:"Here",slot:"end",onClickComponentEvents:{setValue:()=>s["a"].getLocationName()},onClick:()=>null}],showKeyboard:!0,isFilterDataViaApi:!0}}}function f(){return{id:"art_appointment_date",helpText:"Appointment Date for ART Referral",type:i["b"].TT_DATE_PICKER,isRequired:()=>!0,defaultValue:()=>t.date,condition:e=>"Yes"===e.is_referral,finalComputedValue:e=>({obs:t.buildValueDate("Appointment date",""+e.value)}),config:{minDate:()=>t.date,infoItems:e=>[{label:"Set appointment date",value:Object(c["g"])(e)}],hiddenFooterBtns:["Clear"]}}}function h(){let e=[];return{id:"linkage_code",helpText:"LINKAGE CODE",type:i["b"].TT_LINKAGE_CODE,isRequired:()=>!0,validation:t=>{var n;return null!==t&&void 0!==t&&null!==(n=t.other)&&void 0!==n&&n.isValidLinkageCode?null:(e=Object(u["uniq"])(e.concat(""+t.value)),["Invalid Scanform linkage code"])},condition:e=>"Yes"===e.is_referral,finalComputedValue:n=>({obs:[t.buildValueText("HTC Serial number",""+n.value),...e.map(e=>t.buildValueText("Invalid",e))]})}}function g(){return{id:"art_outcome_field",helpText:"Art outcome",type:i["b"].TT_HIDDEN,defaultValue:()=>n("Unknown"),finalComputedValue:e=>({obs:t.buildValueCoded("Antiretroviral status or outcome",e.value)})}}return{patientDashboardUrl:d,onFinish:m,fields:e}}}),p=n("6b0d"),b=n.n(p);const f=b()(m,[["render",o]]);t["default"]=f},7920:function(e,t,n){"use strict";var a=n("7a23");function o(e,t,n,o,i,r){return Object(a["openBlock"])(),Object(a["createBlock"])(Object(a["resolveDynamicComponent"])(e.formType),{fields:e.fields,skipSummary:e.skipSummary,activeField:e.activeField,cancelDestinationPath:e.cancelDestinationPath,onOnFinish:e.onFinish,onFinish:e.onFinishAction,onOnIndex:e.onIndex},null,40,["fields","skipSummary","activeField","cancelDestinationPath","onOnFinish","onFinish","onOnIndex"])}var i=n("9441"),r=Object(a["defineComponent"])({name:"HisStandardForm",components:{TouchScreenForm:i["a"]},emits:["onFinish","onIndex"],data:()=>({formType:"touch-screen-form"}),props:{onFinishAction:{type:Function},skipSummary:{type:Boolean,default:!1},activeField:{type:String},fields:{type:Object,required:!0},cancelDestinationPath:{type:String,required:!1}},methods:{onFinish(e,t){this.$emit("onFinish",e,t)},onIndex(e){this.$emit("onIndex",e)}}}),s=n("6b0d"),l=n.n(s);const c=l()(r,[["render",o]]);t["a"]=c},"8e3d":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return storageFactory}));var _home_andrew_dev_Projects_HIS_Core_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("ade3"),lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("2ef0"),lodash__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);const INDEX_STORE="openmrs",DB_NAME="offline_db",storageFactory=(storageName="IndexedDBStorage")=>eval(`new ${storageName}()`);class LocalStorage{existsinStorage(e){const t=localStorage.getItem(e);return t?Promise.resolve(!0):Promise.resolve(!1)}getFromStorage(e){return new Promise((t,n)=>{const a=localStorage.getItem(e);if(a)return t(JSON.parse(a));t([])})}deleteFromStorage(e){return localStorage.removeItem(e),!0}saveToStorage(e,t){return localStorage.setItem(e,JSON.stringify(t)),!0}}class IndexedDBStorage{constructor(){Object(_home_andrew_dev_Projects_HIS_Core_node_modules_babel_runtime_helpers_esm_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__["a"])(this,"db",void 0);const e=indexedDB.open(DB_NAME,1);e.onupgradeneeded=function(){e.result.createObjectStore(INDEX_STORE)},e.onsuccess=()=>{this.db=e.result}}existsinStorage(e){return new Promise((t,n)=>{const a=this.db.transaction(INDEX_STORE).objectStore(INDEX_STORE).get(e);a.onsuccess=()=>{t(a.result)},a.onerror=()=>{n(a.error)}})}getFromStorage(e,t){return new Promise((n,a)=>{const o=this.db.transaction(INDEX_STORE).objectStore(INDEX_STORE).openCursor();o.onsuccess=()=>{const a=o.result;a?(a.key===e&&n(t?filteredData(a,t):a.value.data),a.continue()):n([])},o.onerror=()=>{a("error")}})}saveToStorage(e,t){return this.db.transaction(INDEX_STORE,"readwrite").objectStore(INDEX_STORE).put(t,e),!0}deleteFromStorage(e){return this.db.transaction(INDEX_STORE,"readwrite").objectStore(INDEX_STORE).delete(e),!0}}function filteredData(e,t){return Object(lodash__WEBPACK_IMPORTED_MODULE_1__["filter"])(e.value,e=>Object.entries(t).every(([t,n])=>Object(lodash__WEBPACK_IMPORTED_MODULE_1__["isInteger"])(e[t])?!n||e[t]===n:!n||Object(lodash__WEBPACK_IMPORTED_MODULE_1__["toLower"])(e[t]).includes(Object(lodash__WEBPACK_IMPORTED_MODULE_1__["toLower"])(n))))}},c39b:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("ade3"),o=n("cc6f"),i=n("b89f");class r extends o["a"]{constructor(e,t=-1){super(e,79,t),Object(a["a"])(this,"patientID",void 0),Object(a["a"])(this,"printoutService",new i["a"]),this.patientID=e}async printHtsLinkageId(e){await this.printoutService.printLbl(`/patients/${this.patientID}/labels/print_hts_linkage_code/${e}`)}async getHtsCode(){return await this.getFirstValueText("HTC serial number")||"Un-assigned"}validLinkID(e){const t={A:0,C:1,H:2,K:3,L:4,N:5,P:6,W:7,X:8,Y:9},n=/^(\d{1,4})-(\d{1,3})-(\d{1,2})-([A-CE-HK-NP-Y])$/,a=n.exec(e);if(!a)return["Invalid LinkID format"];const o=parseInt(a[1],10),i=parseInt(a[2],10),r=parseInt(a[3],10),s=a[4];return a[1].length!==o.toString().length||a[3].length!==r.toString().length||a[2].length!==i.toString().length?["Invalid LinkID, book number and row number should not have leading zeros"]:isNaN(o)||isNaN(i)||isNaN(r)||o<1||o>9999||i<1||i>999||r<1||r>99?["Invalid LinkID format on book, page, or row number"]:t.hasOwnProperty(s)?null:["Invalid check digit"]}}},e86e:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return c})),n.d(t,"c",(function(){return u})),n.d(t,"f",(function(){return d})),n.d(t,"e",(function(){return _})),n.d(t,"a",(function(){return m})),n.d(t,"g",(function(){return p})),n.d(t,"h",(function(){return b}));var a=n("5713"),o=n("8e3d"),i=n("13ea"),r=n.n(i);const s=Object(o["a"])();async function l(e=""){let t=await s.getFromStorage("locations",{name:e});return r()(t)&&(t=await a["a"].getFacilities({name:e})),t.filter(e=>!r()(e)&&""!=e.name.trim()).map(e=>({label:e.name,value:e.location_id,other:e}))}async function c(e=""){const t=await a["a"].getLabs({search_name:e});return t.map(e=>({label:e,value:e}))}async function u(e=""){const t=await a["a"].getFacilities({name:e,tag:"Facility adult sections"});return t.map(e=>({label:e.name,value:e.name,other:e}))}async function d(){const e=await a["a"].getSpecialistClinics();return e.map(e=>({label:e.name,value:e.name,other:e}))}async function _(){let e=await s.getFromStorage("regions",[]);return r()(e)&&(e=await a["a"].getRegions()),e.map(e=>({label:e.name,value:e.region_id,other:e}))}async function m(e){let t=await s.getFromStorage("districts",{region_id:e});return r()(t)&&(t=await a["a"].getDistricts(e)),t.map(e=>({label:e.name,value:e.district_id,other:e}))}async function p(e,t=""){let n=await s.getFromStorage("traditional_authorities",{district_id:e,name:t});return r()(n)&&(n=await a["a"].getTraditionalAuthorities(e,t)),n.map(e=>({label:e.name,value:e.traditional_authority_id,other:e}))}async function b(e,t=""){let n=await s.getFromStorage("villages",{traditional_authority_id:e,name:t});return r()(n)&&(n=await a["a"].getVillages(e,t)),n.map(e=>({label:e.name,value:e.village_id,other:e}))}}}]);
//# sourceMappingURL=chunk-02d7f10e.b95a2aa7.js.map