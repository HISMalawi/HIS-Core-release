(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0ccf55"],{"4fc0":function(e,t,r){"use strict";r.r(t);var n=r("7a23");function a(e,t,r,a,i,s){var u=Object(n["resolveComponent"])("his-standard-form");return Object(n["openBlock"])(),Object(n["createBlock"])(u,{skipSummary:!0,cancelDestinationPath:e.cancelDestination,fields:e.fields},null,8,["cancelDestinationPath","fields"])}var i=r("1da1"),s=(r("d81d"),r("4e82"),r("b0c0"),r("d3b7"),r("25f0"),r("96cf"),r("d95e")),u=r("b5e4"),o=r("d4ec"),c=r("bee2"),d=r("262e"),p=r("2caf"),l=(r("3ca3"),r("ddb0"),r("cc6f")),f=r("71c3"),h=function(e){Object(d["a"])(r,e);var t=Object(p["a"])(r);function r(e,n){var a;return Object(o["a"])(this,r),a=t.call(this,e,54,n),a.drugHistory=[],a.currentDrugOrder=[],a}return Object(c["a"])(r,[{key:"getDrugHistory",value:function(){return this.drugHistory}},{key:"getCurrentOrder",value:function(){return this.currentDrugOrder}},{key:"buildDispensations",value:function(e,t){return[{drug_order_id:e,date:this.date,quantity:t}]}},{key:"saveDispensations",value:function(e){return l["a"].postJson("/dispensations",{dispensations:e,program_id:l["a"].getProgramID()})}},{key:"voidOrder",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",l["a"].void("/dispensations/".concat(t),{}));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"loadDrugHistory",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f["a"].getDrugOrderHistory(this.patientID);case 2:t=e.sent,t&&(this.drugHistory=t);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadCurrentDrugOrder",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f["a"].getDrugOrders(this.patientID);case 2:if(t=e.sent,!t){e.next=7;break}return e.next=6,Promise.all(t);case 6:this.currentDrugOrder=e.sent;case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"calcCompletePack",value:function(e,t){var r=e.barcodes.sort((function(e,t){return e.tabs-t.tabs}));if(0==r.length||0==t)return t;for(var n=0;n<=r.length-1;n++)if(parseInt(r[n].tabs)>=t)return r[n].tabs;var a=parseInt(r[0].tabs),i=parseInt(r[r.length-1].tabs);while(i<t)i+=a;return i}}]),r}(l["a"]),b=r("7365"),g=r("9283"),v=Object(n["defineComponent"])({mixins:[b["a"]],data:function(){return{dispensation:{}}},watch:{patient:{handler:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.dispensation=new h(e.getID(),t.providerID),r.next=3,t.dispensation.loadCurrentDrugOrder();case 3:return r.next=5,t.dispensation.loadDrugHistory();case 5:t.fields=t.getFields();case 6:case"end":return r.stop()}}),r)})))()},deep:!0}},methods:{saveDispensations:function(e){var t=this.buildDispensations(e);return this.dispensation.saveDispensations(t)},buildDispensations:function(e){return this.dispensation.buildDispensations(e.other.order_id,e.value)},buildMedicationHistory:function(){return this.dispensation.getDrugHistory().sort((function(e,t){var r=new Date(e.order.start_date),n=new Date(t.order.start_date);return n-r})).map((function(e){return{medication:e.drug.name,date:g["a"].toStandardHisDisplayFormat(e.order.start_date),amount:e.quantity}}))},buildOrderOptions:function(){var e=this;return this.dispensation.getCurrentOrder().map((function(t){return{label:t.drug.name,value:t.quantity||0,other:{drug_id:t.drug.drug_id,order_id:t.order.order_id,amount_needed:e.calculateCompletePack(t)}}}))},getPackSizesRows:function(e,t){var r=this.dispensation.getDrugPackSizes(e);return r.map((function(e){var r=t>0?t/e:"-";return[e,r,0,0]}))},calculateCompletePack:function(e){var t=parseFloat(e.amount_needed)-(e.quantity||0),r=this.dispensation.calcCompletePack(e,t);return r<0?0:r},isDoneDispensing:function(e){return e.map((function(e){return 0!=e.value})).every(Boolean)},isValidDispensation:function(e){return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,n,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=!0,n=parseInt(e.value.toString()),a=e.other["amount_needed"],i=n/a*100,!(i>110)){t.next=8;break}return t.next=7,Object(u["a"])("Are you sure you want to dispense over 110% of the prescribed pill count?");case 7:r=t.sent;case 8:if(!(i<100)){t.next=12;break}return t.next=11,Object(u["a"])("Are you sure you want to dispense less than 100% of the prescribe amount?");case 11:r=t.sent;case 12:return t.abrupt("return",r);case 13:case"end":return t.stop()}}),t)})))()},getFields:function(){var e=this;return[{id:"dispenses",helpText:"Dispensation",type:s["b"].TT_DRUG_DISPENSER,onValueUpdate:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(r,n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(-1==r.value||!e.isDoneDispensing(n)){t.next=2;break}return t.abrupt("return",e.gotoPatientDashboard());case 2:return r.other["amount_needed"]=0,t.next=5,e.dispensation.loadCurrentDrugOrder();case 5:return t.abrupt("return",e.buildOrderOptions());case 6:case"end":return t.stop()}}),t)})));function r(e,r){return t.apply(this,arguments)}return r}(),onValue:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(r,n){var a,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(-1!==r.value){t.next=5;break}return t.next=3,e.dispensation.voidOrder(r.other.order_id);case 3:return a=t.sent,t.abrupt("return",!!a);case 5:if(n){t.next=11;break}return t.next=8,e.isValidDispensation(r);case 8:if(i=t.sent,i){t.next=11;break}return t.abrupt("return",!1);case 11:return t.next=13,e.saveDispensations(r);case 13:if(s=t.sent,!s){t.next=16;break}return t.abrupt("return",!0);case 16:return Object(u["e"])("Unable to save dispensation"),t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t)})));function r(e,r){return t.apply(this,arguments)}return r}(),config:{medicationHistory:this.buildMedicationHistory(),toolbarInfo:[{label:"Name",value:this.patient.getFullName()},{label:"Gender",value:this.patient.getGender()},{label:"Date Of Birth",value:g["a"].toStandardHisDisplayFormat(this.patient.getBirthdate())}],hiddenFooterBtns:["Clear","Finish"]},options:function(){return e.buildOrderOptions()}}]}}}),m=r("d959"),D=r.n(m);const y=D()(v,[["render",a]]);t["default"]=y}}]);
//# sourceMappingURL=chunk-2d0ccf55.b4169e75.js.map