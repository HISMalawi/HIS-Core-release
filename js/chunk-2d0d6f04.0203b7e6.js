(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d6f04"],{"754d":function(e,t,i){"use strict";i.r(t);var a=i("7a23");function n(e,t,i,n,r,s){const o=Object(a["resolveComponent"])("his-standard-form");return Object(a["openBlock"])(),Object(a["createBlock"])(o,{fields:e.fields,activeField:e.activeField,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","activeField","onFinishAction","cancelDestinationPath"])}var r=i("d95e"),s=i("7920"),o=i("2706"),p=i("cc6f"),c=i("ad60"),u=i("cc74");class d extends p["a"]{constructor(e,t){super(e,51,t),this.sitePrefix=""}getSitePrefix(){return this.sitePrefix}async loadSitePrefix(){this.sitePrefix=await u["b"].sitePrefix()}createArvNumber(e){return c["a"].postJson("/patient_identifiers/",{patient_id:this.patientID,identifier_type:4,identifier:e})}buildArvNumber(e){return`${this.sitePrefix}-ARV-${e}`}}var l=i("8df6"),h=i("b5e4"),b=i("7365"),v=i("3e53"),f=i("2ef0"),m=i("8e8b"),_=Object(a["defineComponent"])({mixins:[b["a"]],components:{HisStandardForm:s["a"]},data:()=>({reception:{},activeField:"",hasARVNumber:!0,suggestedNumber:"",patientType:{}}),watch:{ready:{handler(e){e&&(this.reception=new d(this.patientID,this.providerID),this.fields=this.getFields())},immediate:!0}},methods:{async onFinish(e,t){const i=await this.reception.createEncounter();if(!i)return Object(h["e"])("Unable to create encounter");const a=await this.resolveObs(t,"obs"),n=await this.reception.saveObservationList(a);if(!n)return Object(h["e"])("Unable to create Obs");if(e.capture_arv&&"Yes"===e.capture_arv.value){const e=await this.reception.createArvNumber(t.arv_number);if(!e)return Object(h["e"])("Unable to save Arv number");m["a"].invalidate("ACTIVE_PATIENT")}Object(h["d"])("Encounter created");const r=Object(f["find"])(e.who_is_present,{value:"Yes",label:"Guardian present?"});if(r&&Object(f["isEmpty"])(await this.patient.getGuardian()))return this.$router.push("/guardian/registration/"+this.patientID);this.nextTask()},getFields(){return[{id:"who_is_present",helpText:"HIV reception",type:r["b"].TT_MULTIPLE_YES_NO,validation:e=>o["a"].required(e)||o["a"].neitherOr(e)||o["a"].anyEmpty(e),computedValue:e=>({tag:"obs",obs:e.map(({other:e,value:t})=>this.reception.buildValueCoded(e.concept,t))}),onValueUpdate:async(e,t)=>e.map(e=>(t.label!=e.label&&"No"===t.value&&(e.value="Yes"),e)),options:e=>e.who_is_present?e.who_is_present:[{label:"Patient present?",value:"",other:{concept:"Patient Present",property:"patient_present",values:this.yesNoOptions()}},{label:"Guardian present?",value:"",other:{concept:"Guardian Present",property:"guardian_present",values:this.yesNoOptions()}}]},{id:"capture_arv",helpText:"Capture ARV Number?",type:r["b"].TT_SELECT,requireNext:!0,init:async()=>{const e=this.patient.getPatientIdentifier(4);return""===e&&(this.hasARVNumber=!1),this.patientType=new l["a"](this.patientID,this.providerID),await this.patientType.loadPatientType(),!0},condition:()=>!this.hasARVNumber&&"New patient"===this.patientType.getType(),validation:e=>o["a"].required(e),options:()=>this.yesNoOptions()},{id:"arv_number",helpText:"ART number",type:r["b"].TT_TEXT,init:async()=>{if(await this.reception.loadSitePrefix(),!this.hasARVNumber){const e=await c["a"].getNextSuggestedARVNumber();this.suggestedNumber=e.arv_number.replace(/^\D+|\s/g,"")}return!0},computedValue:({value:e})=>e,validation:e=>o["a"].required(e),condition:e=>!this.hasARVNumber&&"Yes"===e.capture_arv.value,defaultValue:()=>this.suggestedNumber,config:{prependValue:()=>{const e=v["a"].getActiveApp();if(e&&e.programPatientIdentifiers){const t=e.programPatientIdentifiers["ARV Number"];return t.prefix()}return""}}}]}}}),y=i("6b0d"),g=i.n(y);const T=g()(_,[["render",n]]);t["default"]=T}}]);
//# sourceMappingURL=chunk-2d0d6f04.0203b7e6.js.map