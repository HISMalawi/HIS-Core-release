System.register(["./index-legacy-DLdqxVnr.js","./HisStandardForm-legacy-D9LtBbE8.js","./useEncounter-legacy-BWIHzFlJ.js","./commons-legacy-Bc6uhvf5.js","./identifier_service-legacy-CDoyf5iP.js","./isEmpty-legacy-0aF-DGmx.js","./encounter_guidelines-legacy-Cn5GVi4r.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var i,a,n,r,u,l,s,c,o,d,p,y,m,T,v,b,I,f,g,_,$,B,N,x,D,E,w,P,R;return{setters:[e=>{i=e.d,a=e.bg,n=e.r,r=e.bH,u=e.bM,l=e.am,s=e.dV,c=e.a9,o=e.bf,d=e.bL,p=e.aM,y=e.cZ,m=e.aJ,T=e.O,v=e.dQ,b=e.aa,I=e.u,f=e.v,g=e.w,_=e.x,$=e.y,B=e.dW,N=e.as,x=e.a5},e=>{D=e.H},e=>{E=e.u},e=>{w=e.m,P=e.r},e=>{R=e.I},null,null,null],execute:function(){e("default",i({__name:"Registration",setup(e){const t=a.getActiveApp(),i=n([]),M=new r(-1,u.TB_REGISTRATION),q=new R,A=n(),j=n(""),U=l();function h(e){const[t,i]=`${e}`.split("/");if(i)return`${j.value}${t}/${i}`;const[a]=`${M.date}`.split("-");return`${j.value}${t}/${a.trim()}`}const O={"Multi drug resistance treatment":{type:s.MDR,label:"Patient DR TB Number",indexID:"DR TB Number",concept:"MDR_NUMBER"},"Tuberculosis Preventive Treatment (TPT)":{type:s.IPT,label:"Patient IPT Number",indexID:"IPT Number",concept:"TB_NUMBER"},"Currently in treatment":{type:s.TB,label:"Patient TB Number",indexID:"TB Number",concept:"TB_NUMBER"},DEFAULT:{type:s.TB,label:"Patient TB Number",indexID:"TB Number",concept:"TB_NUMBER"}},{goToNextTask:C,patientDashboardUrl:S,patientId:F}=E(((e,a,n,r)=>{M.patientID=a,M.providerID=e,i.value=[(()=>{let e={};const t=Object.values(O).find((e=>e.indexID===U.query.type));return{id:"reassign",helpText:`Reassign ${U.query.type}: ${U.query.id}`,proxyID:"patientIdentifier",type:c.TT_NUMBER,init:async()=>{e=await o.getProgramInformation(a),!U.query.id&&d.isOnTreatment(e.current_outcome)&&`${e.tb_number}`.split("/").length>0&&await p("Caution!",`Client is currently using program number ${e.tb_number}`,`Current outcome is ${e.current_outcome} updated on ${y(e.current_outcome_date)}`,[{name:"Ok",color:"primary",slot:"start"}]);const[i,n]=`${U.query.id}`.split("/");return q.setIdentifierType(t?.type),j.value=`${i}/${n}/`,!0},beforeNext:async e=>{const t=h(`${e.value}`),i=await q.getPatientsByIdentifier(t);return!!m.isEmpty(i)||(T(`${t} is already in use!!`),!1)},computedValue:e=>({obs_datetime:M.date,value_text:h(`${e.value}`),concept_id:v(t?.concept)}),condition:()=>U.query.reassign,validation:e=>b.required(e)}})(),{id:"new",helpText:"Identifier:",proxyID:"patientIdentifier",type:c.TT_NUMBER,init:async()=>(O[r.outcome]?A.value=O[r.outcome]:A.value=O.DEFAULT,q.setIdentifierType(A.value?.type),j.value=await(t.programPatientIdentifiers[A.value?.indexID]?.prefix()),!0),beforeNext:async e=>{const t=h(`${e.value}`),i=await q.getPatientsByIdentifier(t);return!!m.isEmpty(i)||(T(`${t} is already in use!!`),!1)},computedValue:e=>({obs_datetime:M.date,value_text:h(`${e.value}`),concept_id:v(A.value?.concept)}),condition:e=>!e.reassign?.value,validation:e=>b.required(e),dynamicHelpText:()=>A.value?.label},{id:"idSummary",helpText:"Identifier",type:c.TT_TEXT_BANNER,options:e=>w([`${A.value?.label}: <br/> <b>${h(e.patientIdentifier.value)}</b>`])}]}));async function H(e,t){await M.createEncounter(),await M.saveObservationList(await P(t)),e.new?await B.create(F.value,q.identifierType,h(e.patientIdentifier.value)):await B.update(parseInt(`${U.query.reassign}`),h(e.patientIdentifier.value)),await d.printTBNumber(M.patientID),N.invalidate("ACTIVE_PATIENT"),C()}return(e,t)=>(I(),f($(x),null,{default:g((()=>[_(D,{cancelDestinationPath:$(S),onFinishAction:H,fields:i.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
