import{d as M,ai as R,ak as z,aj as E,ao as L,g as S,h as U,C as O,bb as P,dh as j,cm as H,V as g,_ as G,r as s,o as c,c as b,w as i,b as n,x as C,F as k,y as V,u as h,v,A as K}from"./index-BCTN_bnC.js";import{V as J}from"./ViewPort-BCxYiILf.js";import{_ as Q}from"./FieldMixin.vue_vue_type_script_lang-BcY4Dt1h.js";import{F as N}from"./dynamic-import-helper-BkBZiFw5.js";import W from"./BaseTextInput-BVEuzlyj.js";import{j as X}from"./isEmpty-OXtHK5dz.js";import{P as w}from"./PopupKeyboard-DWLNjJL8.js";import"./_Set-VKtKUQAI.js";import"./SIngleTouchField-DeaPtOu6.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./HisKeypad-iWtx_mcq.js";import"./BaseKeyboard-BdU8h7Jm.js";import"./KbLayouts-VRA-vjeH.js";import"./KbHandler-BuQ4TFU6.js";const Y=M({components:{ViewPort:J,HisTextInput:W,IonGrid:R,IonCol:z,IonRow:E,IonIcon:L,IonList:S,IonItem:U,IonLabel:O,IonInput:P},mixins:[Q],data:()=>({drugs:[],selectedDrug:null,chevronDown:j,previousTinCount:0,newTinCount:0}),mounted(){this.init()},activated(){this.init()},methods:{async init(){this.$emit("onFieldActivated",this),X(this.drugs)&&(this.drugs=await this.options())},disableReasonsOptions(e,o){const t=["Theft","Took out for training","Accidents","Flooding","Natural disaster"];return o.map(r=>({...r,disabled:e?r.disabled||t.includes(r.label):!t.includes(r.label)}))},fmtNumber(e){return H(e)},getModalTitle(e){return"".concat(e," (").concat(this.drugs[this.selectedDrug].label,")")},getDrugValue(e,o){return this.drugs[this.selectedDrug].other[e][o]},setDrugValue(e,o,t){this.drugs[this.selectedDrug].other[e][o]=t?t.value:""},async enterAmount(e){const o=this.getDrugValue(e,"batch_number");w({id:"tins",helpText:this.getModalTitle("Enter number of tins for Batch ".concat(o)),type:N.TT_NUMBER,defaultValue:()=>(this.previousTinCount=this.getDrugValue(e,"current_quantity"),this.previousTinCount),validation:t=>!t||t&&!t.value?null:g.validateSeries([()=>g.isNumber(t),()=>t.value<0?["Number of tins must be greater than 1"]:null])},t=>(this.newTinCount=t.value,this.setDrugValue(e,"current_quantity",t)))},async selectReason(e){const o=this.getDrugValue(e,"batch_number");w({id:"reason",helpText:this.getModalTitle("Select reason for Batch ".concat(o," modification")),type:N.TT_SELECT,defaultValue:()=>this.getDrugValue(e,"reason"),validation:t=>g.required(t),options:()=>{const t=[{label:"Theft",value:"Theft"},{label:"Took out for training",value:"Took out for training"},{label:"Accidents",value:"Accidents"},{label:"Flooding",value:"Flooding"},{label:"Natural disaster",value:"Natural disaster"},{label:"Misplaced stock",value:"Misplaced stock"},{label:"Incorrect entry",value:"Incorrect entry"}];return this.disableReasonsOptions(this.newTinCount>this.previousTinCount,t)}},t=>{this.setDrugValue(e,"reason",t)})},async selectDrug(e){this.selectedDrug=e},isBatchUpdated(e){return e.current_quantity!==e.original_quantity&&!!e.reason},isModificationComplete(){return this.drugs.every(e=>{var o;return(o=e.other)==null?void 0:o.every(t=>t.current_quantity===t.original_quantity?!0:!!t.reason)})},getUpdatedDrugs(){const e=[];return this.drugs.forEach(o=>{var r;const t=(r=o.other)==null?void 0:r.filter(y=>this.isBatchUpdated(y));e.push(...t)}),e}},watch:{clear(){this.drugs=this.drugs.map(e=>(e.other&&(e.other=e.other.map(o=>(o.current_quantity=o.original_quantity,o))),e))},drugs:{async handler(){if(this.isModificationComplete())return this.$emit("onValue",this.getUpdatedDrugs());this.$emit("onValue",null)},immediate:!0,deep:!0}}});function Z(e,o,t,r,y,x){const I=s("his-text-input"),d=s("ion-item"),$=s("ion-list"),l=s("ion-col"),m=s("ion-label"),_=s("ion-input"),q=s("ion-icon"),T=s("ion-row"),B=s("ion-grid"),A=s("view-port");return c(),b(A,null,{default:i(()=>{var D;return[n(I,{readonly:"",value:((D=e.drugs[e.selectedDrug])==null?void 0:D.label)||""},null,8,["value"]),n(B,{style:{background:"white"}},{default:i(()=>[n(T,null,{default:i(()=>[n(l,{size:"4",class:"border-right scroll-list"},{default:i(()=>[(c(!0),C(k,null,V(e.drugs,(p,a)=>(c(),b($,{key:a},{default:i(()=>[n(d,{detail:"",color:a===e.selectedDrug?"lightblue":"",onClick:u=>e.selectDrug(a)},{default:i(()=>[h(v(p.label),1)]),_:2},1032,["color","onClick"])]),_:2},1024))),128))]),_:1}),n(l,{size:"8",class:"scroll-list"},{default:i(()=>{var p;return[(c(!0),C(k,null,V(((p=e.drugs[e.selectedDrug])==null?void 0:p.other)||[],(a,u)=>(c(),b(T,{key:u},{default:i(()=>[n(l,{size:"12"},{default:i(()=>[K("h4",null,"Batch Number: "+v(a.batch_number)+" ("+v(a.pack_size)+"/tin) ",1)]),_:2},1024),n(l,{"size-md":"4"},{default:i(()=>[n(d,null,{default:i(()=>[n(m,{position:"floating"},{default:i(()=>[h("Available Tins")]),_:1}),n(_,{readonly:"",placeholder:"0",value:e.fmtNumber(a.original_quantity)},null,8,["value"])]),_:2},1024)]),_:2},1024),n(l,{"size-md":"4"},{default:i(()=>[n(d,null,{default:i(()=>[n(m,{position:"floating"},{default:i(()=>[h("Verified Tins")]),_:1}),n(_,{readonly:"",placeholder:"0",value:e.fmtNumber(a.current_quantity),color:a.current_quantity!=a.original_quantity?"danger":"success",onClick:f=>e.enterAmount(u)},null,8,["value","color","onClick"])]),_:2},1024)]),_:2},1024),n(l,{"size-md":"4"},{default:i(()=>[n(d,null,{default:i(()=>{var f;return[n(m,{position:"floating"},{default:i(()=>[h("Reason")]),_:1}),n(_,{disabled:a.current_quantity==a.original_quantity,placeholder:"0",value:(f=a.reason)!=null?f:"N/A",onClick:F=>e.selectReason(u)},null,8,["disabled","value","onClick"]),n(q,{icon:e.chevronDown,slot:"end",class:"ion-padding-top",onClick:F=>e.selectReason(u)},null,8,["icon","onClick"])]}),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]}),_:1})]),_:1})]),_:1})]}),_:1})}const fe=G(Y,[["render",Z],["__scopeId","data-v-ff503579"]]);export{fe as default};
