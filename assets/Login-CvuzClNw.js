import{d as E,W as O,X as j,t as C,V as y,Y as q,Z as W,q as X,$ as G,_ as D,o as p,x as c,A as a,v as m,a0 as L,a1 as N,F as k,y as P,z as S,a2 as Q,a3 as U,a4 as F,h as Z,f as J,k as x,C as ee,I as te,j as oe,i as se,l as ae,m as ne,a5 as ie,a6 as le,K as $,a7 as re,M as ue,a8 as pe,N as de,a9 as A,aa as ce,ab as he,ac as me,r as u,c as T,w as i,b as r,u as w}from"./index-BCTN_bnC.js";import{L as fe}from"./KbLayouts-VRA-vjeH.js";import{M as _e}from"./PopupKeyboard-DWLNjJL8.js";import{F as B}from"./dynamic-import-helper-BkBZiFw5.js";import"./SIngleTouchField-DeaPtOu6.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./HisKeypad-iWtx_mcq.js";import"./BaseKeyboard-BdU8h7Jm.js";import"./KbHandler-BuQ4TFU6.js";const ye=E({props:{useVirtualInput:{type:Boolean}},data:function(){return{LOGIN_KEYBOARD:fe,auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new O,j.clearScreenTimeout()},setup(){const{facilityName:e,district:t}=G();return{facilityName:e,district:t}},methods:{renderKeyBoard(e){this.focusInput=e.currentTarget,this.focusInput.id=="password"?this.btnCaption="Login":this.btnCaption="Next";let t=e.currentTarget.getBoundingClientRect().top;t=parseInt(t),this.keyboardTop=t+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(e){const t=e.currentTarget.id;let s;try{t.match(/Del./i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):t.match(/Next/i)?(this.display="none",s=this.$refs.password,s.click()):t.match(/Login/i)?(this.display="none",this.doLogin()):t.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",this.focusInput.id==="username"?s=this.$refs.username:s=this.$refs.password,s.click()):t.match(/Hide/i)?this.display="none":this.focusInput.value+=t,this.focusInput.id=="username"?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(d){console.warn("input error")}},doLogin:async function(){if(this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!await this.auth.checkTimeIntegrity())throw"Local date does not match API date. Please Update your device's date";if(await this.auth.login(this.userInput.password),this.auth.startSession(),(await Promise.all([this.auth.passwordPolicyEnabled(),this.auth.passwordExpired()])).every(Boolean)){const t=s=>"".concat(s.value).toLowerCase();return _e([{id:"new_password",proxyID:"password",helpText:"Change your password",type:B.TT_TEXT,init:()=>(setTimeout(()=>{C("Your password has expired! please change it now!",8e3)},500),!0),computedValue:s=>t(s),validation:s=>y.validateSeries([()=>y.required(s),()=>y.hasLengthRangeOf(s,4,15),()=>{if("".concat(this.userInput.password).toLowerCase()===t(s))return["New password should not match old password"]}]),config:{inputType:"password"}},{id:"verify_password",proxyID:"password",helpText:"Confirm Password",type:B.TT_TEXT,computedValue:s=>t(s),validation:(s,d)=>y.validateSeries([()=>y.required(s),()=>{if(t(d.verify_password)!=t(d.new_password))return["New password does not match current password"]}]),config:{inputType:"password"}}],async(s,d)=>{await q.updateUser(this.auth.userID,d)?(await this.auth.resetUserPasswordChangeCheck(),this.$router.push("/select_hc_location")):C("Unable to update user")})}this.$router.push("/select_hc_location")}catch(e){e instanceof W?C("Invalid username or password"):X("".concat(e),5e4)}}else C("Complete form to log in")}},computed:{btnStyles(){return"display: ".concat(this.display,"; top: ").concat(this.keyboardTop,";")}}}),we=e=>(U("data-v-b43bdec5"),e=e(),F(),e),Ie={class:"main",ref:"main"},ge={class:"cells ion-padding-bottom"},ve=we(()=>a("b",{style:{color:"#8b4513"}},"Facility: ",-1)),be={style:{color:"#cd853f"}},Ce={class:"rows"},ke={class:"cells"},$e=["readonly"],Te={class:"rows input-rows"},Pe={class:"cells"},Se=["readonly"],Ve={class:"rows"},Le=["id"],Ne=["id"];function Ae(e,t,s,d,I,f){return p(),c(k,null,[a("div",Ie,[a("div",ge,[a("h3",null,[ve,a("b",be,m(e.facilityName)+" ("+m(e.district)+")",1)])]),a("div",Ce,[a("div",ke,[L(a("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":t[0]||(t[0]=n=>e.userInput.username=n),onClick:t[1]||(t[1]=n=>e.renderKeyBoard(n)),class:"input-boxes",readonly:e.useVirtualInput},null,8,$e),[[N,e.userInput.username]])])]),a("div",Te,[a("div",Pe,[L(a("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>e.userInput.password=n),type:"password",name:"password",ref:"password",id:"password",onClick:t[3]||(t[3]=n=>e.renderKeyBoard(n)),class:"input-boxes",placeholder:"Password",readonly:e.useVirtualInput},null,8,Se),[[N,e.userInput.password]])])])],512),a("div",{id:"keyboard",style:Q(e.btnStyles),class:"keyboard"},[(p(!0),c(k,null,P(e.LOGIN_KEYBOARD,(n,h)=>(p(),c("span",{key:h},[a("div",Ve,[(p(!0),c(k,null,P(n,o=>(p(),c("div",{class:"cells",key:o},[o==="Next"||o==="Login"?(p(),c("button",{key:0,id:e.btnCaption,class:"keyboard-btn login-btn",onClick:t[4]||(t[4]=l=>e.keyPress(l))},m(e.btnCaption),9,Le)):S("",!0),o!="Login"&&o!="Next"?(p(),c("button",{key:1,id:e.Caps.on?o.toUpperCase():o.toLowerCase(),class:"keyboard-btn",onClick:t[5]||(t[5]=l=>e.keyPress(l))},m(o==="Del."||o==="Caps"?o:e.Caps.on?o.toUpperCase():o.toLowerCase()),9,Ne)):S("",!0)]))),128))])]))),128))],4)],64)}const Be=D(ye,[["render",Ae],["__scopeId","data-v-b43bdec5"]]),Ee=E({name:"login",components:{IonItem:Z,Inputs:Be,IonButton:J,IonTitle:x,IonLabel:ee,IonPage:te,IonHeader:oe,IonToolbar:se,IonContent:ae,IonFooter:ne,IonSelect:ie,IonSelectOption:le},setup(){const e=$([]),t=async()=>{const o=await ce("Application Selection","Please specify the application you wish to use",e.value.map(l=>l.name),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(o.selection&&o.action!="Cancel"){const l=e.value.find(_=>_.name===o.selection);window.open("".concat(l.protocol||"http","://").concat(l.IP,":").concat(l.port||80),"_blank")}},{activePlatformProfile:s,platformProfiles:d}=re(),I=$(""),f=$(""),n=ue(()=>s.value.keyboard===me.HIS_KEYBOARD_ONLY),h=Object.keys(d.value).map(o=>({label:o,value:{profileName:o,...d.value[o]}}));return pe(f,o=>{s.value=(he.find(h,{label:o})||{}).value}),de(async()=>{var g,v;const o=new O;e.value=((g=await o.loadConfig())==null?void 0:g.otherApps)||[];const l=o.getHeadVersion();o.setActiveVersion(l);const _=await o.getApiVersion();I.value="".concat(l," / ").concat(_),f.value=((v=s.value)==null?void 0:v.profileName)||""}),{version:I,profile:f,otherApps:e,deviceProfiles:h,useVirtualInputOnly:n,activePlatformProfile:s,coatImg:A("login-logos/Malawi-Coat_of_arms_of_arms.png"),pepfarImg:A("login-logos/PEPFAR.png"),showConfig:localStorage.getItem("useLocalStorage")==="true",openSelect:t}}}),K=e=>(U("data-v-5c9fa721"),e=e(),F(),e),Oe=K(()=>a("b",{style:{color:"#8b4513"}},"National ",-1)),De=K(()=>a("b",{style:{color:"#cd853f"}},"EMR",-1)),Ue={slot:"start"},Fe=["src"],Ke=["src"];function Me(e,t,s,d,I,f){const n=u("ion-label"),h=u("ion-title"),o=u("ion-toolbar"),l=u("ion-header"),_=u("inputs"),g=u("ion-content"),v=u("ion-select-option"),M=u("ion-select"),V=u("ion-button"),R=u("ion-item"),Y=u("ion-footer"),z=u("ion-page");return p(),T(z,null,{default:i(()=>[r(l,null,{default:i(()=>[r(o,null,{default:i(()=>[r(h,null,{default:i(()=>[r(n,{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:i(()=>[Oe,De]),_:1})]),_:1}),r(n,{class:"ion-padding",slot:"end"},{default:i(()=>[w(" Version: "),a("b",null,m(e.version),1)]),_:1})]),_:1})]),_:1}),r(g,{fullscreen:"false",style:{}},{default:i(()=>[r(_,{useVirtualInput:e.useVirtualInputOnly},null,8,["useVirtualInput"])]),_:1}),r(Y,null,{default:i(()=>[r(o,null,{default:i(()=>[a("span",Ue,[a("img",{id:"coat",src:e.coatImg,alt:"Malawi Coat of Arms logo"},null,8,Fe),a("img",{id:"pepfar",src:e.pepfarImg,alt:"PEPFAR logo"},null,8,Ke)]),r(R,{class:"his-sm-text",style:{width:"75%"},slot:"end"},{default:i(()=>[r(n,null,{default:i(()=>[w("Device Profile")]),_:1}),r(M,{modelValue:e.profile,"onUpdate:modelValue":t[0]||(t[0]=b=>e.profile=b),value:e.profile},{default:i(()=>[(p(!0),c(k,null,P(e.deviceProfiles,(b,H)=>(p(),T(v,{key:H,value:b.label},{default:i(()=>[w(m(b.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","value"]),r(V,{color:"dark",fill:"outline",size:"large",slot:"end","router-link":"/settings/host"},{default:i(()=>[w(" Network ")]),_:1}),e.otherApps.length?(p(),T(V,{key:0,color:"dark",fill:"outline",size:"large",slot:"end",onClick:e.openSelect},{default:i(()=>[w(" Other Applications ")]),_:1},8,["onClick"])):S("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}const xe=D(Ee,[["render",Me],["__scopeId","data-v-5c9fa721"]]);export{xe as default};
