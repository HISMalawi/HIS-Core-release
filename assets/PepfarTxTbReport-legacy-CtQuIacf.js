System.register(["./index-legacy-Dx_PXhkv.js","./ReportDateSelectionPrompt-legacy-Ch8H51Nu.js","./tb_report_service-legacy-ryYwsjHV.js","./TableView-legacy-BlS6nANK.js","./ArtDrilldown-legacy-DqBgrlw_.js","./fuse-legacy-CQoBB3MK.js","./Export-legacy-CSZpFAtY.js","./HisKeyboard-legacy-BFoifhRH.js"],(function(e,r){"use strict";var a,t,n,o,s,l,c,g,i,u,p,d,f,m,y,b,w,_,R,v,D;return{setters:[e=>{a=e.d,t=e.I,n=e.ch,o=e.K,s=e.N,l=e.ac,c=e.O,g=e.n,i=e.t,u=e.ae,p=e.q,d=e._,f=e.r,m=e.o,y=e.c,b=e.w,w=e.b},e=>{_=e.D},e=>{R=e.T},e=>{v=e.v},e=>{D=e.A},null,null,null],execute:function(){const r=a({components:{IonPage:t,IonLoading:n,v2Datatable:v},setup(){const e=o([]),r=o(""),a=o(!1),t=new R,n=(e,a)=>({ref:a,label:e,toValue:e=>e.length,tdClick:async e=>{e.refData.length&&(await c.create({component:D,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:r,patientIdentifiers:e.refData,title:`${e.data.ageGroup} ${e.data.gender} ${e.column.label}`,onFinish:()=>c.getTop().then((e=>e&&c.dismiss()))}})).present()}}),d=[[{label:"#",ref:"index"},{label:"Age group",ref:"ageGroup"},{label:"Gender",ref:"gender"},n("TX_CURR","tx_curr"),n("Symptom Screen (alone)","symptom_screen_alone"),n("CXR screen","cxr_screen"),n("mWRD screen","mwrd_screen"),n("New on ART/Screen Positive","sceen_pos_new"),n("New on ART/Screen Negative","sceen_neg_new"),n("Already on ART/Screen Positive","sceen_pos_prev"),n("Already on ART/Screen Negative","sceen_neg_prev"),n("TB RX_New on ART","started_tb_new"),n("TB RX_Prev on ART","started_tb_prev")]],f=async(r=!1)=>{if(!t.startDate||!t.endDate)return i("Start date and end date required!");a.value=!0,e.value=[];try{const a=await t.getTxTbReport(r,"pepfar"),n={F:"Female",M:"Male"},o=Object.keys(a).reduce(((e,r)=>{if("Unknown"===r)return e;const t=a[r];return Object.keys(t).forEach((a=>{e[a].rows.push({ageGroup:r,gender:n[a],...t[a]}),e[a].aggregate=Object.keys(t[a]).reduce(((e,r)=>Array.isArray(t[a][r])?{...e,[r]:[...e[r]||[],...t[a][r]]}:e),e[a].aggregate)})),e}),{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...o.F.rows,...o.M.rows,{ageGroup:"All",gender:"Male",...o.M.aggregate}];const s=Object.values(o.F.aggregate).reduce(((e,r)=>e.concat(r)),[]),l=await t.getMaternalStatus(u.uniq(s)),c=l.FBf.concat(l.FP);["FP","FNP","FBf"].forEach((r=>{e.value.push(Object.keys(o.F.aggregate).reduce(((e,a)=>({...e,[a]:o.F.aggregate[a].filter((e=>"FNP"===r?!c.includes(e):l[r].includes(e)))})),{ageGroup:"All",gender:r}))})),e.value=e.value.map(((e,r)=>({index:r+1,...e})))}catch(n){console.error(n),p("Unable to generate report!")}a.value=!1},m=()=>_({onFinish:(e,a,n,o)=>{r.value=`Period: ${n}`,t.startDate=e,t.endDate=a,o&&t.setOccupation(o),f()}});return s((()=>m())),{Img:l,reportData:e,isLoading:a,onRefreshReport:async()=>f(await g("Do you want to rebuild report?")),configure:m,generate:f,columns:d,period:r}}});e("default",d(r,[["render",function(e,r,a,t,n,o){const s=f("ion-loading"),l=f("v2Datatable"),c=f("ion-page");return m(),y(c,null,{default:b((()=>[w(s,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),w(l,{title:"Tx TB Report","icon-url":e.Img("login-logos/PEPFAR.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRefreshReport,"report-prefix":"Pepfar"},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh"])])),_:1})}]]))}}}));
