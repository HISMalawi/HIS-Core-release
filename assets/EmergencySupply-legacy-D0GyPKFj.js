System.register(["./index-legacy-DJZIfc2x.js","./HisStandardForm-legacy-F3CBTdXZ.js","./useEncounter-legacy-Dc7CDNal.js","./commons-legacy-BRSAHAIS.js","./adherence_service-legacy-BMafgWK0.js","./isEmpty-legacy-CrfQJRPm.js","./encounter_guidelines-legacy-B61hy_df.js","./GuidelineEngine-legacy-KsvQuFdF.js","./htn_service-legacy-B-46vcao.js"],(function(e,t){"use strict";var a,i,r,n,l,u,d,o,s,c,g,m,p,y,h,f;return{setters:[e=>{a=e.d,i=e.bI,r=e.r,n=e.a9,l=e.bu,u=e.ad,d=e.cO,o=e.aa,s=e.bQ,c=e.u,g=e.v,m=e.y},e=>{p=e.H},e=>{y=e.u},e=>{h=e.r},e=>{f=e.A},null,null,null,null],execute:function(){e("default",a({__name:"EmergencySupply",setup(e){const t=new i(-1,25),a=r([]),{patientDashboardUrl:v,goToNextTask:_}=y(((e,i)=>{t.patientID=i,t.providerID=e;const r=new f(t.patientID,t.providerID);a.value=[{id:"date_of_emergency_refill",helpText:"Date of emergency refill",type:n.TT_FULL_DATE,init:async()=>(await r.loadPreviousDrugs(),!0),beforeNext:async e=>{const t=r.getLastDrugs()?.[0]?.order?.start_date;return!t||!l(e.value).isBefore(t)||u(`Date entered is less than last known dispensation of ${d(t)}`)},validation:e=>o.validateSeries([()=>o.required(e),()=>{if(l(e.value).isAfter(t.date))return[`Date entered is after current date of ${d(t.date)}`]}]),computed:e=>t.buildValueDate("Prescription refill date",e)},{id:"facility",type:n.TT_SELECT,helpText:"Facility where emergency refill was collected",validation:e=>o.required(e),options:(e,t="")=>s(t),computedValue:e=>t.buildValueText("Health facility name",e.label),config:{showKeyboard:!0,isFilterDataViaApi:!0}},{id:"drug",helpText:"Emmergency Supply Drugs",type:n.TT_DRUG_RETROSPECTIVE_INPUT,init:async()=>(await r.loadPreviousDrugs(),!0),options:e=>e.drug.length?e.drug:r.getLastDrugs().map((e=>({label:e.drug.name,value:e.drug.concept_id,other:{givenAmount:"",remainingAmount:"",drug:e}}))),computedValue:(e,t)=>e.map((async e=>{const a=r.calculateAdherence(e.other.drug.quantity,e.other.remainingAmount,(i=e.other.drug,r.calculateExpected(i.quantity,i.equivalent_daily_dose,i.order.start_date,`${n=i.frequency}`.match(/qod/i)?"QOD":`${n}`.match(/weekly/i)?"QW":n)));var i,n;return{...await r.buildValueCoded("Medications dispensed",e.value),child:[await r.buildPillCountObs(e.other.drug.order_id,e.other.remainingAmount),await r.buildAdherenceObs(e.other.drug.order_id,e.other.drug.drug_id,a,t.date_of_emergency_refill.value),await r.buildValueNumber("Amount of drug dispensed",e.other.givenAmount)]}})),validation:e=>{if(e.every((e=>""===e.other.givenAmount||""===e.other.remainingAmount)))return["Please enter drug details for all drugs"]}},{id:"next_appointment",helpText:"Appointment date",type:n.TT_DATE_PICKER,computedValue:e=>t.buildValueDate("Appointment date",e),validation:e=>o.required(e)}]}));async function D(e,a){await t.createEncounter(),await t.saveObservationList(await h(a)),_()}return(e,t)=>(c(),g(p,{fields:a.value,onFinishAction:D,skipSummary:!0,cancelDestinationPath:m(v)},null,8,["fields","cancelDestinationPath"]))}}))}}}));
