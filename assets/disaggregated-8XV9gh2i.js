import{d as N,I as T,c2 as S,K as m,N as U,a9 as j,n as L,t as C,cx as h,q,c5 as R,O as w,ab as V,c3 as k,_ as K,r as y,o as Q,c as W,w as X,b as E}from"./index-hoLU9YgK.js";import{D as Y}from"./ReportDateSelectionPrompt-Zbhw9Lhz.js";import{D as z}from"./disaggregated_service-5unU95qa.js";import{v as H}from"./TableView-B9cOa_Ik.js";import{A as J}from"./ArtDrilldown-dWjAjPyt.js";import{R as O}from"./regimen_report_service-eKoNUL6-.js";import"./dynamic-import-helper-9HnG3Mif.js";import"./MultiFieldDateHelper-PDSV6pPV.js";import"./KbLayouts-9dqmDWmG.js";import"./HisKbConfigurations-a7K7dizM.js";import"./PopupKeyboard-Ap666HVv.js";import"./SIngleTouchField-iKsJUYy8.js";import"./TouchScreenForm-3AdFBAzj.js";import"./ToolbarMediumCard-8sJVQ55x.js";import"./Transformers-XlEF3tgP.js";import"./ViewPort-kkmofE00.js";import"./HisKeypad-i5maK9vi.js";import"./BaseKeyboard-Atx0WGaP.js";import"./KbHandler-oqPdZ1-Q.js";import"./overlays-3311e70e-kWORyLwR.js";import"./fuse-lCMBsAWg.js";import"./Export-g1vHKjsV.js";import"./HisKeyboard-9a4WjXaD.js";import"./person_service-2N0-NHxg.js";const Z=N({components:{IonPage:T,IonLoading:S,v2Datatable:H},setup(){const r=m([]),f=m(""),b=m(""),A=m(!1),a=new z,u=m([]),D=async i=>{(await w.create({component:J,backdropDismiss:!1,cssClass:"large-modal",componentProps:{...i,subtitle:f.value,onFinish:()=>w.getTop().then(t=>t&&w.dismiss())}})).present()},d=(i,t)=>({ref:t,label:i,defaultValue:"0",toValue:e=>e.length,tdClick:async e=>{e.refData.length&&D({patientIdentifiers:e.refData,title:"".concat(e.data.age_group," ").concat(e.data.gender," ").concat(e.column.label)})}}),_=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},d("TX curr (receiving ART)","tx_curr"),...O.reduce((i,t)=>[...i,d(t,t)],[]),d("Unknown","N/A"),d("Total (regimen)","regimen_total")]],$=[...O,"N/A"].reduce((i,t)=>({...i,[t]:[]}),{}),M=async()=>P(await L("Do you want to rebuild report?")),P=async(i=!1)=>{var v,x,B;if(!(a.startDate&&a.endDate))return C("Start date and end date required!");A.value=!0;const t=["Pregnant","Breastfeeding"],e={F:{label:"Female",rows:[],aggregate:{},excludedAgeGroups:t},M:{label:"Male",rows:[],aggregate:{},excludedAgeGroups:t},FP:{label:"Pregnant",rows:[],aggregate:{},gender:"F",ageGroup:"All",genderDisplay:"FP",excludedAgeGroups:[...h,"Breastfeeding"]},FBF:{label:"Breastfeeding",rows:[],aggregate:{},gender:"F",ageGroup:"All",genderDisplay:"FBF",excludedAgeGroups:[...h,"Pregnant"]}},F=(n=!1)=>{const l=Object.keys(e.FP.aggregate).reduce((g,o)=>({...g,[o]:[...e.FP.aggregate[o]||[],...e.FBF.aggregate[o]||[]]}),{}),s=Object.keys(e.F.aggregate).reduce((g,o)=>({...g,[o]:g[o].filter(I=>Array.isArray(l[o])?!l[o].includes(I):!0)}),e.F.aggregate);r.value=[...e.F.rows,...e.M.rows,{age_group:"All",gender:"Male",...e.M.aggregate},...e.FP.rows,{age_group:"All",gender:"FNP",...s},...e.FBF.rows];const p=V.uniq([...e.M.aggregate.tx_curr||[],...e.F.aggregate.tx_curr||[]]),c={text:"Total alive and on ART: <b>".concat(p.length,"</b>"),icon:k,color:"primary",action:()=>D({patientIdentifiers:p,title:"Total alive and on ART: ".concat(p.length)})};n?u.value=[c]:u.value=[c,{text:b.value,icon:R,color:"dark"}]};try{if(a.setRebuildOutcome(i),!await a.init())return C("Unable to initialise report");for(const n of[...h,...t]){b.value="Processing <b>".concat(n,"</b>"),a.setAgeGroup(n);const l=await a.getCohort();a.setRebuildOutcome(!1);for(const s of Object.keys(e)){if((e[s].excludedAgeGroups||[]).includes(n))continue;a.setGender(s);const p=await a.getRegimenDistribution(),c={age_group:((v=e[s])==null?void 0:v.ageGroup)||n,gender:((x=e[s])==null?void 0:x.genderDisplay)||e[s].label,...l[n]?l[n][((B=e[s])==null?void 0:B.gender)||s]:{},...$,...p,regimen_total:Object.values(p).flat(1)};e[s].rows.push(c),e[s].aggregate=Object.keys(c).reduce((g,o)=>Array.isArray(c[o])?{...g,[o]:[...g[o]||[],...c[o]]}:g,e[s].aggregate),F(!1)}}F(!0),r.value=r.value.map((n,l)=>({index:l+1,...n}))}catch(n){const l="Unable to generate report!";q(l),u.value=[{text:l,color:"danger",icon:R,action:function(){u.value=[{text:"Exception occured: <b>".concat(n,"</b>"),color:"danger",icon:R}]}}]}A.value=!1,b.value=""},G=(i=!1)=>Y({onFinish:(t,e,F,v)=>{f.value=F,a.startDate=t,a.endDate=e,a.setOccupation(v.occupation),a.setQuarter("pepfar"),P(i)}});return U(()=>G(!0)),{Img:j,onRegenerate:M,headerBadge:u,reportData:r,isLoading:A,configure:G,generate:P,columns:_,period:f}}});function ee(r,f,b,A,a,u){const D=y("ion-loading"),d=y("v2Datatable"),_=y("ion-page");return Q(),W(_,null,{default:X(()=>[E(D,{"is-open":r.isLoading,message:"Please wait.."},null,8,["is-open"]),E(d,{"icon-url":r.Img("login-logos/PEPFAR.png"),title:"PEPFAR Disaggregated Report","report-prefix":"Pepfar",subtitle:r.period,columns:r.columns,columnData:r.reportData,rowsPerPage:100,onConfigure:r.configure,onRefresh:r.onRegenerate,headerBadge:r.headerBadge},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh","headerBadge"])]),_:1})}const we=K(Z,[["render",ee]]);export{we as default};
