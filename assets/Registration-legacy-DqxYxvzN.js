System.register(["./HisStandardForm-legacy-Cd-xGvNm.js","./index-legacy-2OuOZQ1w.js","./useEncounter-legacy-CmWPg-MA.js","./commons-legacy-tpV43DUS.js","./isEmpty-legacy-C2nv7YqI.js","./encounter_guidelines-legacy-w17rLgkK.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,a){"use strict";var t,i,n,l,o,r,s,u,d,c,p,v,T,y,b,f,g,_,E;return{setters:[e=>{t=e.H},e=>{i=e.bW,n=e.d,l=e.r,o=e.an,r=e.ao,s=e.c3,u=e.cw,d=e.c0,c=e.q,p=e.a,v=e.f,T=e.av,y=e.dH,b=e.b,f=e.aD},e=>{g=e.u},e=>{_=e.b,E=e.r},null,null,null],execute:function(){class a extends i{constructor(e,a){super(e,104,a)}}e("default",n({__name:"Registration",setup(e){let i,n;const m=l([]),{goToNextTask:N,patientDashboardUrl:w}=g(((e,t,l)=>{n=l,i=new a(t,e),m.value=[{id:"visit_type",helpText:"Type of visit",type:r.TT_SELECT,validation:e=>o.required(e),computedValue:e=>({obs:i.buildValueCoded("Type of visit",e.value)}),options:()=>[{label:"New",value:"New patient"},{label:"Referral",value:"Referral"},{label:"Re-visiting",value:"Re-visiting"}]},{id:"referring_facility_name",helpText:"Referred from",type:r.TT_SELECT,validation:e=>o.required(e),computedValue:({label:e})=>({obs:i.buildValueText("Referred from",e)}),condition:e=>"Referral"===e.visit_type.value,options:(e,a="")=>s(a),config:{showKeyboard:!0,isFilterDataViaApi:!0}},{id:"national_id_available",helpText:"National ID Available",type:r.TT_SELECT,validation:e=>o.required(e),condition:()=>u(n?.patient?.date_created)!=u(i.date)&&"Unknown"===n.getMWNationalID(),options:()=>_(),appearInSummary:()=>!1},{id:"national_id",helpText:"Enter National ID",type:r.TT_TEXT,validation:e=>o.isMWNationalID(e),condition:e=>"Yes"===e.national_id_available.value,beforeNext:async e=>!e.value||!(await async function(e){return!!e&&(await T.findByOtherID(y,e)).length>0}(e.value.toString()))||(c("National ID already exists"),!1),summaryMapValue:({value:e})=>({value:e,label:"National ID"}),config:{casing:"uppercase",customKeyboard:[d,[["Delete"]]]}},{id:"patient_pregnant",helpText:"Patient pregnant",type:r.TT_SELECT,validation:e=>o.required(e),computedValue:({value:e})=>({obs:i.buildValueCoded("PATIENT PREGNANT",e)}),condition:()=>n.isChildBearing(),options:()=>_()}]}));async function h(e,a){if(await async function(e){const a=e.national_id_available,t=e.national_id;a&&"Yes"===a.value&&(await n.updateMWNationalId(t.value),f.invalidate("ACTIVE_PATIENT"))}(e),!(await i.createEncounter()))return c("Unable to create registration encounter");const t=await E({...a});if(!(await i.saveObservationList(t)))return c("Unable to save observations");N()}return(e,a)=>(b(),p(t,{cancelDestinationPath:v(w),fields:m.value,onFinishAction:h},null,8,["cancelDestinationPath","fields"]))}}))}}}));
