import{d as A,a5 as y,r,t as D,aI as N,bm as p,M as F,aA as M,as as u,ab as v,ac as f,aS as S,a8 as V,v as $,w as E,ad as T,u as I,x as q}from"./index-CG6KEPsv.js";import{v as x}from"./TableView-QLAT3IiF.js";import{T as R}from"./tb_report_service-CaMDoPOh.js";import{T as H}from"./TBDrilldown-DHFwF_IH.js";import"./Export-ngX2Az_3.js";import"./index-bO2fy8Iw.js";const L=A({components:{IonPage:y,v2Datatable:x},setup(){const o=r("-"),c=r([]),l=r(""),i=r(1),m=r([]),s=r("Select All"),d=(e,a)=>({label:e,ref:a,toValue:t=>t.length,tdClick:t=>_(t)}),_=async e=>{(console.log(e),await u.create({component:H,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e.column.label,patientIdentifiers:e.refData,subtitle:"Period: ".concat(l.value," Q").concat(i.value),onFinish:()=>u.getTop().then(a=>a&&u.dismiss())}})).present()},n=r([{label:"Number of TB Cases Among Current Miners",value:"number_of_tb_cases_among_current_miners"},{label:"Number of TB Cases Among Ex Miners",value:"number_of_tb_cases_among_ex_miners"},{label:"Number of TB Cases Among Household Members of Current Miners",value:"number_of_tb_cases_among_household_members_of_current_miners"},{label:"Number of TB Cases Among Mining Communities",value:"number_of_tb_cases_among_mining_communities"},{label:"Number of TB Cases Among Health Care Workers",value:"number_of_tb_cases_among_health_care_workers"},{label:"Number of TB Cases Among Prisoners",value:"number_of_tb_cases_among_prisoners"},{label:"Children Between Zero and Four",value:"children_between_zero_and_four"},{label:"Children Between Five and Fourteen",value:"children_between_five_and_fourteen"},{label:"HIV Positive TB Cases",value:"hiv_positive_tb_cases"}]),C=[[{label:"Indicator",ref:"indicator",value:e=>{var a;return"".concat((a=n.value.find(t=>t.value===e.indicator))==null?void 0:a.label)}},d("Total","total")]],b=async()=>{(await p.create({backdropDismiss:!1,message:"Generating report, Please wait..."})).present();try{const a=await new R().getTBHighRiskPatients(l.value,i.value,m.value);c.value=a.map(t=>({indicator:t.indicator,total:t.total}))}catch(e){console.error(e),F("Unable to generate report")}p.getTop().then(e=>e&&p.dismiss())},g=()=>M([{id:"year",helpText:"Year",type:v.TT_NUMBER,validation:e=>f.required(e),computedValue:e=>e.value},{id:"quater",helpText:"Quater",type:v.TT_SELECT,requireNext:!1,options:()=>[{label:"First",value:1},{label:"Second",value:2},{label:"Third",value:3},{label:"Fourth",value:4}],validation:e=>f.required(e),computedValue:e=>e.value},{id:"indicators",helpText:"Indicators",type:v.TT_MULTIPLE_SELECT,options:()=>n.value,validation:e=>f.required(e),computedValue:e=>e.map(a=>a.value),config:{footerBtns:[{name:s,slot:"end",onClickComponentEvents:{refreshOptions:()=>s.value==="Select All"?(n.value=k(),n):(n.value=w(),n)},onClick:()=>"None"}]}}],async(e,a)=>{const{year:t,quater:h,indicators:P}=a;l.value=t,i.value=h,m.value=P,o.value="Period: ".concat(t," Q").concat(h),u.dismiss(),b()},()=>{});D(()=>{g()}),N(n,e=>{e.every(a=>a.isChecked)?s.value="Deselect All":s.value="Select All"});const B=()=>S.push("/"),w=()=>n.value.map(a=>({...a,isChecked:!1})),k=()=>n.value.map(a=>({...a,isChecked:!0}));return{data:c,columns:C,subtitle:o,configure:g,generate:b,onFinish:B}}});function Q(o,c,l,i,m,s){const d=T("v2Datatable"),_=T("ion-page");return I(),$(_,null,{default:E(()=>[q(d,{title:"TB High Risk Patients Report",subtitle:o.subtitle,columnData:o.data,columns:o.columns,"on-finish":o.onFinish,"on-refresh":o.generate,"on-configure":o.configure,rowsPerPage:20,"report-prefix":"NTP"},null,8,["subtitle","columnData","columns","on-finish","on-refresh","on-configure"])]),_:1})}const Z=V(L,[["render",Q]]);export{Z as default};
