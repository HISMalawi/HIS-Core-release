System.register(["./index-legacy-B-IGLekl.js","./HisStandardForm-legacy-zrsmj5en.js"],(function(e,t){"use strict";var o,s,i,a,r,n,c,l,u,h,d,p,g;return{setters:[e=>{o=e.d,s=e.aA,i=e.c2,a=e.O,r=e.a9,n=e.aa,c=e.c3,l=e.aP,u=e.a6,h=e.v,d=e.ab,p=e.u},e=>{g=e.H}],execute:function(){const t="network_presets",m=o({components:{HisStandardForm:g},methods:{onFinish(){this.$router.back()},usingCustomIp:e=>!e.presets?.value||/custom/i.test(`${e.presets?.value}`),uniqueNetworkPresets(e){const t=e.reduce(((e,t)=>({...e,[`${t.site}`.trim().toUpperCase()]:t})),{});return Object.keys(t).map((e=>t[e]))},async runHealthCheck(e,t,o){const r=await s.create({message:"Please wait...",backdropDismiss:!1});await r.present(),i.setLocalStorage(e,t,o);const n=await i.healthCheck();if(s.dismiss(),!n||200!==n.status||!n){try{const e=await i.expandPath("_health");a(`Unable to connect to: ${e}`)}catch(c){console.warn(c)}return this.clearLocalStorage(),!1}return!0},getFields(){this.fields=[{id:"presets",helpText:"Network sites",type:r.TT_SELECT,init:async()=>{this.networkSites=JSON.parse(localStorage.getItem(t)||"[]");try{const e=await fetch("/config.json");if(e.ok){const t=await e.json();this.networkSites=this.uniqueNetworkPresets((t?.networkSites||[]).concat(this.networkSites))}}catch(e){console.error(e)}return!0},beforeNext:async e=>{if("custom"!=e.value){const{protocol:t,ip:o,port:s}=e.other;return await this.runHealthCheck(t,o,s)}return!0},isRequired:()=>!0,condition:()=>this.networkSites.length,options:()=>[...this.networkSites.map((e=>({label:e.site,value:e.ip,other:e}))),{label:"Custom Configuration",value:"custom"}]},{id:"protocol",helpText:"Select Protocol",type:r.TT_SELECT,requireNext:!1,validation:e=>n.required(e),condition:e=>this.usingCustomIp(e),options:()=>[{label:"HTTP",value:"http"},{label:"HTTPS",value:"https"}]},{id:"ip_address",helpText:"Enter IP Address",type:r.TT_IP_ADDRESS,condition:e=>this.usingCustomIp(e),validation:e=>n.required(e)||n.isIPAddress(e)},{id:"port",helpText:"Enter Port",beforeNext:async(e,t)=>{const o=t.protocol.value,s=t.ip_address.value,i=t.port.value;return await this.runHealthCheck(o,s,i)},condition:e=>this.usingCustomIp(e),validation:e=>n.required(e),type:r.TT_TEXT,config:{customKeyboard:[c,[["Delete"]]]}},{id:"to_save_host",helpText:"Host preset",type:r.TT_YES_NO,isRequired:()=>!0,condition:e=>this.usingCustomIp(e),options:()=>[{label:"Do you want to save this configuration preset?",values:[{label:"Yes",value:"Yes"},{label:"No",value:"No"}]}]},{id:"configuration_name",helpText:"Configuration name",type:r.TT_TEXT,condition:e=>"Yes"===e.to_save_host,isRequired:()=>!0,beforeNext:(e,o)=>{const s=this.networkSites.concat([{site:e.label,ip:o.ip_address.value,protocol:o.protocol.value,port:o.port.value}]);return localStorage.setItem(t,JSON.stringify(this.uniqueNetworkPresets(s))),!0}}]},async showConfigNotice(){this.isUsingLocalStorage()&&"Reset configurations"===await l("Config notice","The system is currently using user specified configurations.                 Do you wish to reset back to server configurations?","",[{name:"Reset configurations",slot:"start",color:"success"},{name:"New configurations",slot:"end"}])&&(this.clearLocalStorage(),this.$router.back())},isUsingLocalStorage:()=>"true"===localStorage.getItem("useLocalStorage"),clearLocalStorage(){i.removeOnly(["useLocalStorage","apiURL","apiPort","apiProtocol"])}},data:()=>({networkSites:[],fields:[]}),async mounted(){await this.showConfigNotice(),this.getFields()}});e("default",u(m,[["render",function(e,t,o,s,i,a){const r=d("his-standard-form");return p(),h(r,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!0},null,8,["fields","onFinishAction"])}]]))}}}));
