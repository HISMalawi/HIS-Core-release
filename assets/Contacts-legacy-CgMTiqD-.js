System.register(["./index-legacy-CA6M7ipO.js","./HisStandardForm-legacy-a9YJRGaH.js","./useEncounter-legacy-CgHUO1ZL.js","./relations_service-legacy-CISSH-pH.js","./VoidReason-legacy-BRRDDujz.js","./isEmpty-legacy-cRrH0Hs5.js","./encounter_guidelines-legacy-Bcz_Mw7r.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,n,i,o,r,s,l,d,c,u,p,h,y,g,m,_,v,f,b,w,T;return{setters:[e=>{a=e.d,n=e.r,i=e.ad,o=e.ak,r=e.a_,s=e.bE,l=e.aV,d=e.ae,c=e.a,u=e.c,p=e.w,h=e.b,y=e.u,g=e.bC,m=e.bD,_=e.e8,v=e.I},e=>{f=e.H},e=>{b=e.u},e=>{w=e.R},e=>{T=e.p},null,null,null],execute:function(){e("default",a({__name:"Contacts",setup(e){const t=n([]),a=n();function F(e){const t=g(),a=g(e),n=t.diff(a,"year"),i=t.diff(a.add(n,"year"),"month"),o=t.diff(a.add(n,"year").add(i,"month"),"day");return n>0?`${n} year${n>1?"s":""} old`:i>0?`${i} month${i>1?"s":""} old`:`${o} day${o>1?"s":""} old`}const{patientDashboardUrl:C,patientId:E}=b(((e,n,c)=>{a.value=c,t.value=[(()=>{let e={},t=[];return{id:"contacts",helpText:"Contacts",type:i.TT_TABLE_VIEWER,onload:t=>e=t,init:async()=>(t=await c.getGuardian(),!0),options:()=>[{label:"",value:"",other:{columns:["Name","Gender","Age","Screen","Void"],rows:t.map((t=>[`${t.relation.names[0].given_name} ${t.relation.names[0].family_name}`,"M"===t.relation.gender?"Male":"Female",F(t.relation.birthdate),{name:"Screen",type:"button",action:()=>o(t.relation.person_id,r)},{id:t.relationship_id,name:"Void",type:"button",color:"danger",action:()=>T((async a=>{await w.voidRelation(n,t.relationship_id,a),e.rows=e.rows.filter((e=>e[e.length-1].id!=t.relationship_id))}))}]))}}],config:{overrideDefaultFooterBtns:{nextBtn:{name:"Add contact"}}}}})(),s.getGivenNameField(),s.getFamilyNameField(),s.getGenderField(),...l(s.getDobConfig()),s.getCellNumberField(),{id:"action",helpText:"Next step:",type:i.TT_SELECT,requireNext:!1,validation:e=>d.required(e),options:()=>[{label:"Add another contact",value:1,other:{action:()=>location.reload()}},{label:"Proceed to diagnosis",value:2,other:{action:e=>o(e,r)}},{label:"Go to dashboard",value:3,other:{action:()=>r.push(C.value)}}]}]}));function j(){const e=a.value.patient;return{home_district:e.person.addresses[0].address2,current_district:e.person.addresses[0].state_province,current_village:e.person.addresses[0].city_village,current_traditional_authority:e.person.addresses[0].township_division,home_village:e.person.addresses[0].neighborhood_cell,home_traditional_authority:e.person.addresses[0].county_district}}async function $(e,t){const a=new m,n={...j(),...s.resolvePerson(t)};await a.createPerson(n),await a.createPatient(),await w.createRelation(E.value,a.personId,_.TB_CONTACT),"function"==typeof e.action?.other?.action&&e.action.other.action(a.personId)}return(e,a)=>(c(),u(y(v),null,{default:p((()=>[h(f,{cancelDestinationPath:y(C),onFinishAction:$,fields:t.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
