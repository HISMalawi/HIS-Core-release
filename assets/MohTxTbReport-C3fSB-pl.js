import{d as y,I as P,cg as C,K as R,N as M,ac as S,O as D,n as N,t as B,ae as O,q as $,_ as x,r as w,o as I,c as j,w as k,b as T}from"./index-Bb5e7Gwm.js";import{D as E}from"./ReportDateSelectionPrompt-ffedhOig.js";import{T as G}from"./tb_report_service-Dfq76T9Q.js";import{v as X}from"./TableView-DzumhIf4.js";import{A as q}from"./ArtDrilldown-jvYXsr1R.js";import"./Export-DHk-begf.js";const L=y({components:{IonPage:P,IonLoading:C,v2Datatable:X},setup(){const e=R([]),g=R(""),m=R(!1),l=new G,a=(p,c)=>({ref:c,label:p,toValue:o=>o.length,tdClick:async o=>{o.refData.length&&(await D.create({component:q,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:g,patientIdentifiers:o.refData,title:"".concat(o.data.ageGroup," ").concat(o.data.gender," ").concat(o.column.label),onFinish:()=>D.getTop().then(n=>n&&D.dismiss())}})).present()}}),h=[[{label:"#",ref:"index"},{label:"Age group",ref:"ageGroup"},{label:"Gender",ref:"gender"},a("TX_CURR","tx_curr"),a("Symptom Screen (alone)","symptom_screen_alone"),a("CXR screen","cxr_screen"),a("mWRD screen","mwrd_screen"),a("New on ART/Screen Positive","sceen_pos_new"),a("New on ART/Screen Negative","sceen_neg_new"),a("Already on ART/Screen Positive","sceen_pos_prev"),a("Already on ART/Screen Negative","sceen_neg_prev"),a("TB RX_New on ART","started_tb_new"),a("TB RX_Prev on ART","started_tb_prev")]],_=async()=>u(await N("Do you want to rebuild report?")),u=async(p=!1)=>{if(!(l.startDate&&l.endDate))return B("Start date and end date required!");m.value=!0,e.value=[];try{const c=await l.getTxTbReport(p,"moh"),o={F:"Female",M:"Male"},n=Object.keys(c).reduce((t,s)=>{if(s==="Unknown")return t;const i=c[s];return Object.keys(i).forEach(r=>{t[r].rows.push({ageGroup:s,gender:o[r],...i[r]}),t[r].aggregate=Object.keys(i[r]).reduce((v,f)=>Array.isArray(i[r][f])?{...v,[f]:[...v[f]||[],...i[r][f]]}:v,t[r].aggregate)}),t},{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...n.F.rows,...n.M.rows,{ageGroup:"All",gender:"Male",...n.M.aggregate}];const F=Object.values(n.F.aggregate).reduce((t,s)=>t.concat(s),[]),b=await l.getMaternalStatus(O.uniq(F)),A=b.FBf.concat(b.FP);["FP","FNP","FBf"].forEach(t=>{e.value.push(Object.keys(n.F.aggregate).reduce((s,i)=>({...s,[i]:n.F.aggregate[i].filter(r=>t==="FNP"?!A.includes(r):b[t].includes(r))}),{ageGroup:"All",gender:t}))}),e.value=e.value.map((t,s)=>({index:s+1,...t}))}catch(c){console.error(c),$("Unable to generate report!")}m.value=!1},d=()=>E({onFinish:(p,c,o,n)=>{g.value="Period: ".concat(o),l.startDate=p,l.endDate=c,n&&l.setOccupation(n),u()}});return M(()=>d()),{Img:S,reportData:e,isLoading:m,onRefreshReport:_,configure:d,generate:u,columns:h,period:g}}});function U(e,g,m,l,a,h){const _=w("ion-loading"),u=w("v2Datatable"),d=w("ion-page");return I(),j(d,null,{default:k(()=>[T(_,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),T(u,{title:"Tx TB Report","icon-url":e.Img("login-logos/Malawi-Coat_of_arms_of_arms.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRefreshReport,"report-prefix":"MOH"},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh"])]),_:1})}const Q=x(L,[["render",U]]);export{Q as default};
