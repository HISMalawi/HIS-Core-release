import{bD as T,cl as y,d as S,I as C,c7 as M,K as D,N,a9 as x,O as v,n as $,t as B,ab as O,q as I,_ as j,r as h,o as E,c as k,w as G,b as A}from"./index-DTBWhHAq.js";import{D as U}from"./ReportDateSelectionPrompt-D3zFVZCm.js";import{v as X}from"./TableView-BllKSVel.js";import{A as q}from"./ArtDrilldown-CtVT4It-.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./MultiFieldDateHelper-BWKgkEkB.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./PopupKeyboard-C_Gld6ml.js";import"./SIngleTouchField-0q-gpRlN.js";import"./TouchScreenForm-BeJsJnwt.js";import"./ToolbarMediumCard-wr9sTFDK.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-DbAo6hHM.js";import"./HisKeypad-BxyyAkla.js";import"./BaseKeyboard-Ck5oXEIk.js";import"./KbHandler-BuQ4TFU6.js";import"./fuse-YdZE3OCN.js";import"./Export-CLFPyxXu.js";import"./HisKeyboard-DQi-3Zd4.js";class L extends T{constructor(){super()}getTxTbReport(c){return this.getReport("programs/1/reports/tx_tb",{rebuild_outcome:c})}getMaternalStatus(c){const u={start_date:this.startDate,end_date:this.endDate,date:this.date,program_id:this.programID,report_definition:"pepfar"};this.occupation&&(u.occupation=this.occupation);const s=y.parameterizeObjToString(u);return T.postJson("vl_maternal_status?".concat(s),{patient_ids:c})}}const V=S({components:{IonPage:C,IonLoading:M,v2Datatable:X},setup(){const e=D([]),c=D(""),u=D(!1),s=new L,a=(m,l)=>({ref:l,label:m,toValue:r=>r.length,tdClick:async r=>{r.refData.length&&(await v.create({component:q,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:c,patientIdentifiers:r.refData,title:"".concat(r.data.ageGroup," ").concat(r.data.gender," ").concat(r.column.label),onFinish:()=>v.getTop().then(o=>o&&v.dismiss())}})).present()}}),w=[[{label:"#",ref:"index"},{label:"Age group",ref:"ageGroup"},{label:"Gender",ref:"gender"},a("TX_CURR","tx_curr"),a("Symptom Screen (alone)","symptom_screen_alone"),a("CXR screen","cxr_screen"),a("mWRD screen","mwrd_screen"),a("New on ART/Screen Positive","sceen_pos_new"),a("New on ART/Screen Negative","sceen_neg_new"),a("Already on ART/Screen Positive","sceen_pos_prev"),a("Already on ART/Screen Negative","sceen_neg_prev"),a("TB RX_New on ART","started_tb_new"),a("TB RX_Prev on ART","started_tb_prev")]],_=async()=>g(await $("Do you want to rebuild report?")),g=async(m=!1)=>{if(!(s.startDate&&s.endDate))return B("Start date and end date required!");u.value=!0,e.value=[];try{const l=await s.getTxTbReport(m),r={F:"Female",M:"Male"},o=Object.keys(l).reduce((t,i)=>{if(i==="Unknown")return t;const p=l[i];return Object.keys(p).forEach(n=>{t[n].rows.push({ageGroup:i,gender:r[n],...p[n]}),t[n].aggregate=Object.keys(p[n]).reduce((R,f)=>Array.isArray(p[n][f])?{...R,[f]:[...R[f]||[],...p[n][f]]}:R,t[n].aggregate)}),t},{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...o.F.rows,...o.M.rows,{ageGroup:"All",gender:"Male",...o.M.aggregate}];const F=Object.values(o.F.aggregate).reduce((t,i)=>t.concat(i),[]),b=await s.getMaternalStatus(O.uniq(F)),P=b.FBf.concat(b.FP);["FP","FNP","FBf"].forEach(t=>{e.value.push(Object.keys(o.F.aggregate).reduce((i,p)=>({...i,[p]:o.F.aggregate[p].filter(n=>t==="FNP"?!P.includes(n):b[t].includes(n))}),{ageGroup:"All",gender:t}))}),e.value=e.value.map((t,i)=>({index:i+1,...t}))}catch(l){console.error(l),I("Unable to generate report!")}u.value=!1},d=()=>U({onFinish:(m,l,r,o)=>{c.value="Period: ".concat(r),s.startDate=m,s.endDate=l,o&&s.setOccupation(o),g()}});return N(()=>d()),{Img:x,reportData:e,isLoading:u,onRefreshReport:_,configure:d,generate:g,columns:w,period:c}}});function W(e,c,u,s,a,w){const _=h("ion-loading"),g=h("v2Datatable"),d=h("ion-page");return E(),k(d,null,{default:G(()=>[A(_,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),A(g,{title:"Tx TB Report","icon-url":e.Img("login-logos/PEPFAR.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRefreshReport,"report-prefix":"Pepfar"},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh"])]),_:1})}const me=j(V,[["render",W]]);export{me as default};
