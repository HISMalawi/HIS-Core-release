System.register(["./index-legacy-CG62t_LC.js","./TableView-legacy-blk0L5Qu.js"],(function(e,t){"use strict";var n,a,r,i,s,o,l,c,u,d,p,f,m,b,g,h,v,w,y,D;return{setters:[e=>{n=e.d,a=e.f,r=e.r,i=e.aN,s=e.aP,o=e.by,l=e.cq,c=e.cr,u=e.bH,d=e.af,p=e.ak,f=e.a,m=e.c,b=e.w,g=e.b,h=e.b0,v=e.m,w=e.bu,y=e.e},e=>{D=e.v}],execute:function(){e({a:async function(e){e.patientIdentifiers.length&&(await v.create({component:P,backdropDismiss:!1,cssClass:"large-modal",componentProps:{onFinish:()=>v.getTop().then((e=>e&&v.dismiss())),...e}})).present()},b:_,c:A,d:function(e){return e.map(((e,t)=>({...e,index:t+1})))},s:async function(e){(e.columnData??[]).length&&(await v.create({component:D,backdropDismiss:!1,cssClass:"large-modal",componentProps:{onFinish:()=>v.getTop().then((e=>e&&v.dismiss())),...e}})).present()},w:async function(e,t=!0){t&&(await w.create({message:"Please wait...",backdropDismiss:!1})).present();try{const t=await e();return w.getTop().then((e=>e?w.dismiss():null)),t}catch(n){console.error(n),y("Unable to generate report")}w.getTop().then((e=>e?w.dismiss():null))}});const t=n({props:{title:{type:String,default:"Drilldown"},patientIdentifiers:{type:Object},onFinish:{type:Function},viewRef:{type:String,default:"person_id"}},components:{IonPage:a,v2Datatable:D},setup(e){const t=r(!0),n=r("-"),a=r([]),d=[[_("identifier","ARV Number"),{label:"Gender",ref:"gender"},{label:"Birthdate",ref:"birthdate"},{label:"Art start date",ref:"art_start_date"},A(e.viewRef)]];return i((()=>e.patientIdentifiers),(async e=>{if(a.value=[],n.value="Total: 0",!e||!e.length)return;const r=s.chunk(e,1e3);for(const s of r){try{if(!t.value)break;const e=(await o.getPersons(s)).map((e=>({...e,birthdate:l(e.birthdate),art_start_date:l(e.art_start_date),gender:c(e.gender)})));a.value=[...a.value,...e]}catch(i){console.error(i)}n.value=`Total: ${a.value.length} of ${(e||[]).length}`,await u(100)}}),{immediate:!0}),{columns:d,subtitle:n,reportData:a,canLoadData:t,ITEMS_PER_PAGE:25,runFinishAction:function(){t.value=!1,"function"==typeof e.onFinish&&e.onFinish()}}}}),P=e("A",d(t,[["render",function(e,t,n,a,r,i){const s=p("v2Datatable"),o=p("ion-page");return f(),m(o,null,{default:b((()=>[g(s,{title:e.title,subtitle:e.subtitle,columnData:e.reportData,columns:e.columns,"default-sort-order":"asc","default-sorted-column":"identifier","on-finish":e.runFinishAction,rowsPerPage:e.ITEMS_PER_PAGE},null,8,["title","subtitle","columnData","columns","on-finish","rowsPerPage"])])),_:1})}]]));function _(e="arv_number",t="ARV#"){return{ref:e,label:t,sortValue:e=>{const t=`${e}`.match(/\w{2,5}-arv-(?<arvDigit>\d*)/i);return parseInt(t?.groups?.arvDigit||"-1")}}}function A(e="patient_id",t="/patient/dashboard/"){return{ref:e,label:"Actions",exportable:!1,toValue:()=>"View",tdClick:({refData:e})=>h.push(`${t}${e}`)}}}}}));
