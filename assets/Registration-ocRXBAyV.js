import{H as I}from"./HisStandardForm-BuN2ARUl.js";import{bW as A,d as D,r as w,an as n,ao as o,c3 as S,cw as u,c0 as h,q as l,a as R,f as x,av as V,dH as C,b as F,aD as P}from"./index-DrAzzURJ.js";import{u as L}from"./useEncounter-DkJDyHxN.js";import{b as c,r as O}from"./commons-C0KTHr4m.js";import"./isEmpty-DpsHgz2w.js";import"./encounter_guidelines-wbooCIhg.js";import"./GuidelineEngine-D6V1_Znr.js";class M extends A{constructor(t,i){super(t,104,i)}}const G=D({__name:"Registration",setup(d){let t,i;const s=w([]),{goToNextTask:p,patientDashboardUrl:f}=L((e,a,r)=>{i=r,t=new M(a,e),s.value=[b(),g(),m(),y(),N()]});async function v(e,a){if(await T(e),!await t.createEncounter())return l("Unable to create registration encounter");const E=await O({...a});if(!await t.saveObservationList(E))return l("Unable to save observations");p()}async function T(e){const a=e.national_id_available,r=e.national_id;a&&a.value==="Yes"&&(await i.updateMWNationalId(r.value),P.invalidate("ACTIVE_PATIENT"))}async function _(e){return e?(await V.findByOtherID(C,e)).length>0:!1}function b(){return{id:"visit_type",helpText:"Type of visit",type:o.TT_SELECT,validation:e=>n.required(e),computedValue:e=>({obs:t.buildValueCoded("Type of visit",e.value)}),options:()=>[{label:"New",value:"New patient"},{label:"Referral",value:"Referral"},{label:"Re-visiting",value:"Re-visiting"}]}}function g(){return{id:"referring_facility_name",helpText:"Referred from",type:o.TT_SELECT,validation:e=>n.required(e),computedValue:({label:e})=>({obs:t.buildValueText("Referred from",e)}),condition:e=>e.visit_type.value==="Referral",options:(e,a="")=>S(a),config:{showKeyboard:!0,isFilterDataViaApi:!0}}}function m(){return{id:"national_id_available",helpText:"National ID Available",type:o.TT_SELECT,validation:e=>n.required(e),condition:()=>{var e;return u((e=i==null?void 0:i.patient)==null?void 0:e.date_created)!=u(t.date)&&i.getMWNationalID()==="Unknown"},options:()=>c(),appearInSummary:()=>!1}}function y(){return{id:"national_id",helpText:"Enter National ID",type:o.TT_TEXT,validation:e=>n.isMWNationalID(e),condition:e=>e.national_id_available.value==="Yes",beforeNext:async e=>e.value&&await _(e.value.toString())?(l("National ID already exists"),!1):!0,summaryMapValue:({value:e})=>({value:e,label:"National ID"}),config:{casing:"uppercase",customKeyboard:[h,[["Delete"]]]}}}function N(){return{id:"patient_pregnant",helpText:"Patient pregnant",type:o.TT_SELECT,validation:e=>n.required(e),computedValue:({value:e})=>({obs:t.buildValueCoded("PATIENT PREGNANT",e)}),condition:()=>i.isChildBearing(),options:()=>c()}}return(e,a)=>(F(),R(I,{cancelDestinationPath:x(f),fields:s.value,onFinishAction:v},null,8,["cancelDestinationPath","fields"]))}});export{G as default};
