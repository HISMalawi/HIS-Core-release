import{d as y,I as N,K as n,N as A,a8 as D,O as u,aN as _,t as F,V as f,ag as V,_ as M,r as T,o as S,c as $,w as E,b as I}from"./index-BCTN_bnC.js";import{v as q}from"./TableView-Dtifi8zd.js";import{M as x}from"./PopupKeyboard-DWLNjJL8.js";import{F as v}from"./dynamic-import-helper-BkBZiFw5.js";import{T as R}from"./tb_report_service-9cn-NYpY.js";import{T as H}from"./TBDrilldown-DUdE2mjU.js";import"./fuse-YdZE3OCN.js";import"./Export-nPQsqN2_.js";import"./HisKeyboard-COmBOOo8.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./KbLayouts-VRA-vjeH.js";import"./BaseKeyboard-BdU8h7Jm.js";import"./KbHandler-BuQ4TFU6.js";import"./SIngleTouchField-DeaPtOu6.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./HisKeypad-iWtx_mcq.js";const L=y({components:{IonPage:N,v2Datatable:q},setup(){const a=n("-"),c=n([]),l=n(""),i=n(1),m=n([]),s=n("Select All"),p=(e,t)=>({label:e,ref:t,toValue:o=>o.length,tdClick:o=>d(o)}),d=async e=>{(console.log(e),await u.create({component:H,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e.column.label,patientIdentifiers:e.refData,subtitle:"Period: ".concat(l.value," Q").concat(i.value),onFinish:()=>u.getTop().then(t=>t&&u.dismiss())}})).present()},r=n([{label:"Number of TB Cases Among Current Miners",value:"number_of_tb_cases_among_current_miners"},{label:"Number of TB Cases Among Ex Miners",value:"number_of_tb_cases_among_ex_miners"},{label:"Number of TB Cases Among Household Members of Current Miners",value:"number_of_tb_cases_among_household_members_of_current_miners"},{label:"Number of TB Cases Among Mining Communities",value:"number_of_tb_cases_among_mining_communities"},{label:"Number of TB Cases Among Health Care Workers",value:"number_of_tb_cases_among_health_care_workers"},{label:"Number of TB Cases Among Prisoners",value:"number_of_tb_cases_among_prisoners"},{label:"Children Between Zero and Four",value:"children_between_zero_and_four"},{label:"Children Between Five and Fourteen",value:"children_between_five_and_fourteen"},{label:"HIV Positive TB Cases",value:"hiv_positive_tb_cases"}]),C=[[{label:"Indicator",ref:"indicator",value:e=>{var t;return"".concat((t=r.value.find(o=>o.value===e.indicator))==null?void 0:t.label)}},p("Total","total")]],b=async()=>{(await _.create({backdropDismiss:!1,message:"Generating report, Please wait..."})).present();try{const t=await new R().getTBHighRiskPatients(l.value,i.value,m.value);c.value=t.map(o=>({indicator:o.indicator,total:o.total}))}catch(e){console.error(e),F("Unable to generate report")}_.getTop().then(e=>e&&_.dismiss())},g=()=>x([{id:"year",helpText:"Year",type:v.TT_NUMBER,validation:e=>f.required(e),computedValue:e=>e.value},{id:"quater",helpText:"Quater",type:v.TT_SELECT,requireNext:!1,options:()=>[{label:"First",value:1},{label:"Second",value:2},{label:"Third",value:3},{label:"Fourth",value:4}],validation:e=>f.required(e),computedValue:e=>e.value},{id:"indicators",helpText:"Indicators",type:v.TT_MULTIPLE_SELECT,options:()=>r.value,validation:e=>f.required(e),computedValue:e=>e.map(t=>t.value),config:{footerBtns:[{name:s,slot:"end",onClickComponentEvents:{refreshOptions:()=>s.value==="Select All"?(r.value=k(),r):(r.value=w(),r)},onClick:()=>"None"}]}}],async(e,t)=>{const{year:o,quater:h,indicators:P}=t;l.value=o,i.value=h,m.value=P,a.value="Period: ".concat(o," Q").concat(h),u.dismiss(),b()},()=>{});A(()=>{g()}),D(r,e=>{e.every(t=>t.isChecked)?s.value="Deselect All":s.value="Select All"});const B=()=>V.push("/"),w=()=>r.value.map(t=>({...t,isChecked:!1})),k=()=>r.value.map(t=>({...t,isChecked:!0}));return{data:c,columns:C,subtitle:a,configure:g,generate:b,onFinish:B}}});function Q(a,c,l,i,m,s){const p=T("v2Datatable"),d=T("ion-page");return S(),$(d,null,{default:E(()=>[I(p,{title:"TB Quaterly Treatment Outcomes Report",subtitle:a.subtitle,columnData:a.data,columns:a.columns,"on-finish":a.onFinish,"on-refresh":a.generate,"on-configure":a.configure,rowsPerPage:20,"report-prefix":"NTP"},null,8,["subtitle","columnData","columns","on-finish","on-refresh","on-configure"])]),_:1})}const ie=M(L,[["render",Q]]);export{ie as default};
