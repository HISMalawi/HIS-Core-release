import{R as P}from"./ReportErrors-CoJcPm2D.js";import{d as B,a5 as k,cn as E,r as m,t as O,aJ as S,af as V,M as j,aL as L,d0 as H,d3 as N,aj as q,d2 as x,cP as U,as as b,d4 as X,a8 as J,v as Q,w as W,ad as C,u as z,x as T}from"./index-DLUr6P7m.js";import{v as G}from"./TableView-XOn8ca8Y.js";import{A as K}from"./v2utils-C1GxVxnv.js";import{T as Y}from"./tx_report_service-DaMKbYU7.js";import{M as Z}from"./moh_cohort_service-BV0q1pBp.js";import"./Export-CkPEf1jI.js";import"./index-DjieabqU.js";const ee=B({components:{IonPage:k,IonLoading:E,v2Datatable:G},setup(){const o=m([]),f=m(""),R=m(""),h=m(!1),l=new Y,d=new Z,r=m([]),v=async n=>{(await b.create({component:K,backdropDismiss:!1,cssClass:"large-modal",componentProps:{...n,subtitle:f.value,onFinish:()=>b.getTop().then(a=>a&&b.dismiss())}})).present()},g=(n,a)=>({ref:a,label:n,defaultValue:"0",toValue:e=>e.length,tdClick:async e=>{e.refData.length&&v({patientIdentifiers:e.refData,title:"".concat(e.data.age_group," ").concat(e.data.gender," ").concat(e.column.label)})}}),$=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},g("# of clients on <3 months of ARVs","less_than_three_months"),g("# of clients on 3 - 5 months of ARVs","three_to_five_months"),g("# of clients on >= 6 months of ARVs","greater_than_six_months")]],y=async()=>M(await V("Do you want to rebuild report?")),F=function(n){const a=r.value.findIndex(e=>e.id===n.id);a!==-1?r.value[a]=n:r.value.push(n)},D=async function(n){const a="validation";(await b.create({id:a,component:P,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:n}})).present(),F({id:a,text:"<b>".concat(n.length,"</b> validation errors detected"),icon:X,color:"danger",action:()=>D(n)})},M=async(n=!1)=>{if(!(l.startDate&&l.endDate))return j("Start date and end date required!");h.value=!0;try{r.value=[],o.value=[];const a=await l.getTxCurrMMDReport(n,"moh"),e=Object.keys(a).reduce((t,s)=>{const p=a[s];return["Male","Female"].forEach(i=>{const _={gender:i,age_group:s};Object.keys(p[i]).forEach(u=>{_[u]=p[i][u],t.totalAlive=[...t.totalAlive,..._[u]],t.aggregate[i][u]=[...t.aggregate[i][u]||[],..._[u]]}),t[i].push(_)}),t},{Male:[],Female:[],totalAlive:[],aggregate:{Male:{},Female:{}}});o.value=[...e.Female,...e.Male,{age_group:"All",gender:"Male",...e.aggregate.Male}];const A=Object.values(e.aggregate.Female).reduce((t,s)=>t.concat(s),[]),c=await l.getMaternalStatus(L.uniq(A)),I=c.FBf.concat(c.FP);["FP","FNP","FBf"].forEach(t=>{o.value.push(Object.keys(e.aggregate.Female).reduce((s,p)=>({...s,[p]:e.aggregate.Female[p].filter(i=>t==="FNP"?!I.includes(i):c[t].includes(i))}),{age_group:"All",gender:t}))}),o.value=o.value.map((t,s)=>({index:s+1,...t})),r.value=[{text:"Total alive and on ART: <b>".concat(e.totalAlive.length,"</b>"),icon:H,color:"primary",action:()=>v({patientIdentifiers:e.totalAlive,title:"Total alive and on ART: ".concat(e.totalAlive.length)})}],d.validateIndicators({total_alive_and_on_art:{param:e.totalAlive.length,check:(t,s)=>s>t,error:(t,s)=>"\n                            MoH cohort Alive and on ART clients <b>(".concat(t,")</b> is not\n                            matching with total TX MMD clients <b>(").concat(s,")</b>.\n                        ")}},t=>{t.length?D(t):F({id:"validation",text:"<b>Report is consistent</b>",icon:N,color:"success"})})===-1&&D(["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])}catch(a){const e="Unable to generate report!";q(e),r.value=[{text:e,color:"danger",icon:x,action:function(){console.log(a),r.value=[{text:"Exception occured: <b>".concat(a,"</b>"),color:"danger",icon:x}]}}]}h.value=!1,R.value=""},w=(n=!1)=>U({onFinish:(a,e,A,c)=>{f.value=A,l.startDate=a,l.endDate=e,l.setQuarter("moh"),d.setStartDate(a),d.setEndDate(e),c&&(d.setOccupation(c),l.setOccupation(c)),M(n)}});return O(()=>w()),{Img:S,onRegenerate:y,headerBadge:r,reportData:o,isLoading:h,configure:w,generate:M,columns:$,period:f}}});function te(o,f,R,h,l,d){const r=C("ion-loading"),v=C("v2Datatable"),g=C("ion-page");return z(),Q(g,null,{default:W(()=>[T(r,{"is-open":o.isLoading,message:"Please wait.."},null,8,["is-open"]),T(v,{"icon-url":o.Img("login-logos/Malawi-Coat_of_arms_of_arms.png"),title:"TX Curr MMD Report","report-prefix":"MOH",subtitle:o.period,columns:o.columns,columnData:o.reportData,rowsPerPage:100,onConfigure:o.configure,onRefresh:o.onRegenerate,headerBadge:o.headerBadge},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh","headerBadge"])]),_:1})}const de=J(ee,[["render",te]]);export{de as default};
