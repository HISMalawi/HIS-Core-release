System.register(["./HisStandardForm-legacy-a9YJRGaH.js","./index-legacy-CA6M7ipO.js","./useEncounter-legacy-CgHUO1ZL.js","./commons-legacy-BqS3TQTP.js","./isEmpty-legacy-cRrH0Hs5.js","./encounter_guidelines-legacy-Bcz_Mw7r.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,n,o,i,s,l,u,r,c,d,m,y,p,T,g,b,v,h,f,_;return{setters:[e=>{a=e.H},e=>{n=e.d,o=e.r,i=e.bQ,s=e.ad,l=e.ae,u=e.a,r=e.c,c=e.w,d=e.b,m=e.u,y=e.I,p=e.W,T=e.aW,g=e.bx},e=>{b=e.u},e=>{v=e.y,h=e.m,f=e.r,_=e.a},null,null,null],execute:function(){e("default",n({__name:"GeneralConsultation",setup(e){const t=o(0),n=o(!1);let C;const w=o([]),{patientDashboardUrl:B,goToNextTask:S}=b(((e,a,o)=>{C=new i(a,168,e),w.value=function(e){return[{id:"on_tb_treatment",helpText:"On TB Treatment?",type:s.TT_SELECT,validation:e=>l.required(e),computedValue:e=>{const t={tag:"consultation",obs:[C.buildValueCoded("TB treatment",e.value)]};return/yes/i.test(e.value)&&t.obs.push(C.buildValueCoded("TB Status","Confirmed TB on treatment")),t},options:v},{id:"tb_side_effects",helpText:"TB Associated symptoms",type:s.TT_MULTIPLE_YES_NO,init:async()=>{const a=await e.getWeightHistory();return t.value=e.getWeightLossPercentageFromTrail(a),n.value=Number(t.value)>=10,!0},onValue:async e=>(await async function(e){if(n.value&&`${e.label}`.match(/malnutrition/i)&&`${e.value}`.match(/no/i)){const a=await T("Recommendation",`Patient's weight has dropped by ${t.value}% , is this controlled weight loss??`,"Please verify",[{name:"Confirm weight loss",slot:"start",color:"success"},{name:"Confirm controlled",slot:"end",color:"primary"}]);e.value="Confirm weight loss"===a?"Yes":"No"}}(e),!0),validation:e=>l.validateSeries([()=>l.required(e),()=>l.anyEmpty(e)]),condition:e=>e.on_tb_treatment.value.match(/no/i),options:(e,t)=>function(e){const t=g.getConceptsByCategory("tb_symptom",!0).map((({name:e})=>e));return _([...t],e)}(t),computedValue:e=>({tag:"consultation",obs:e.map((async e=>({...await C.buildValueCoded("Routine TB Screening",e.label),child:[await C.buildValueCoded(e.label,e.value)]})))})},{id:"tb_status",helpText:"TB Status",type:s.TT_SELECT,validation:e=>l.required(e),condition:e=>e.tb_side_effects.value.some((e=>/yes/i.test(e.value))),options:()=>h(["TB NOT suspected","TB Suspected","Confirmed TB Not on treatment"]),computedValue:e=>({tag:"consultation",obs:C.buildValueCoded("TB Status",e.value)})}]}(o)}));async function E(e,t){try{const e=await f(t,"consultation");await C.createEncounter(),await C.saveObservationList(e),S()}catch(a){console.error(a),p("An error occurred while saving the complaints")}}return(e,t)=>(u(),r(m(y),null,{default:c((()=>[d(a,{cancelDestinationPath:m(B),fields:w.value,onFinishAction:E,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
