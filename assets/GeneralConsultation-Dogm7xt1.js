import{H as b}from"./HisStandardForm-BCjM4-bc.js";import{d as y,r as i,bQ as g,ad as r,ae as n,a as _,c as v,w as C,b as w,u as c,I as S,W as B,aW as V,bx as E}from"./index-CMZASHAR.js";import{u as N}from"./useEncounter-CsCeua2V.js";import{y as P,m as x,r as L,a as O}from"./commons-Bp7XBfaW.js";import"./isEmpty-DjKeGqZh.js";import"./encounter_guidelines-CJXpBOk4.js";import"./GuidelineEngine-D6V1_Znr.js";const Y=y({__name:"GeneralConsultation",setup(W){const s=i(0),l=i(!1);let a;const u=i([]),{patientDashboardUrl:d,goToNextTask:m}=N((o,e,t)=>{a=new g(e,168,o),u.value=h(t)});async function p(o,e){try{const t=await L(e,"consultation");await a.createEncounter(),await a.saveObservationList(t),m()}catch(t){console.error(t),B("An error occurred while saving the complaints")}}async function T(o){if(l.value&&"".concat(o.label).match(/malnutrition/i)&&"".concat(o.value).match(/no/i)){const e=await V("Recommendation","Patient's weight has dropped by ".concat(s.value,"% , is this controlled weight loss??"),"Please verify",[{name:"Confirm weight loss",slot:"start",color:"success"},{name:"Confirm controlled",slot:"end",color:"primary"}]);o.value=e==="Confirm weight loss"?"Yes":"No"}}function f(o){const e=E.getConceptsByCategory("tb_symptom",!0).map(({name:t})=>t);return O([...e],o)}function h(o){return[{id:"on_tb_treatment",helpText:"On TB Treatment?",type:r.TT_SELECT,validation:e=>n.required(e),computedValue:e=>{const t={tag:"consultation",obs:[a.buildValueCoded("TB treatment",e.value)]};return/yes/i.test(e.value)&&t.obs.push(a.buildValueCoded("TB Status","Confirmed TB on treatment")),t},options:P},{id:"tb_side_effects",helpText:"TB Associated symptoms",type:r.TT_MULTIPLE_YES_NO,init:async()=>{const e=await o.getWeightHistory();return s.value=o.getWeightLossPercentageFromTrail(e),l.value=Number(s.value)>=10,!0},onValue:async e=>(await T(e),!0),validation:e=>n.validateSeries([()=>n.required(e),()=>n.anyEmpty(e)]),condition:e=>e.on_tb_treatment.value.match(/no/i),options:(e,t)=>f(t),computedValue:e=>({tag:"consultation",obs:e.map(async t=>({...await a.buildValueCoded("Routine TB Screening",t.label),child:[await a.buildValueCoded(t.label,t.value)]}))})},{id:"tb_status",helpText:"TB Status",type:r.TT_SELECT,validation:e=>n.required(e),condition:e=>e.tb_side_effects.value.some(t=>/yes/i.test(t.value)),options:()=>x(["TB NOT suspected","TB Suspected","Confirmed TB Not on treatment"]),computedValue:e=>({tag:"consultation",obs:a.buildValueCoded("TB Status",e.value)})}]}return(o,e)=>(_(),v(c(S),null,{default:C(()=>[w(b,{cancelDestinationPath:c(d),fields:u.value,onFinishAction:p,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{Y as default};
