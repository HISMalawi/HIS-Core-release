import{d as ne,S as re,X as se,aY as le,a1 as ie,U as ue,R as ce,a3 as de,a4 as fe,W as pe,cG as ye,aX as he,aP as ve,bY as ge,bZ as ke,ap as Ce,r as F,ar as H,aH as be,cL as Pe,cM as me,cN as we,cO as Se,cP as De,cQ as Ve,cR as Ie,cS as Te,aN as _e,al as $,bv as Fe,aS as $e,cT as Re,cU as ze,aK as Z,b_ as Ee,cV as Ne,a8 as Ue,ad as f,u as r,B as C,x as s,w as a,v as y,H as h,z as b,E as R,K as z,G as E,C as K,a$ as Be}from"./index-DrPQ21-i.js";import{a as He,t as Ke}from"./Export-CWTuI3QV.js";const Oe=ne({components:{IonToolbar:re,IonItem:se,IonIcon:le,IonLabel:ie,IonTitle:ue,IonHeader:ce,IonButton:de,IonFooter:fe,IonContent:pe,IonButtons:ye,IonChip:he,HisKeyboard:ve,IonThumbnail:ge,IonImg:ke},props:{title:{type:String,default:"Report"},headerBadge:{type:Object},iconUrl:{type:String},subtitle:{type:String},columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},enablePagination:{type:Boolean,default:!0},rowsPerPage:{type:Number,default:10},onFinish:{type:Function},onRefresh:{type:Function},onConfigure:{type:Function},csvQuarter:{type:String},reportPrefix:{type:String,default:""},defaultSortedColumn:{type:String},defaultSortOrder:{type:Object,default:"desc"}},setup(e){const d=Ce(),I=F([]),v=F(0),S=F(""),T=F(""),w=F("desc"),A=F(!1),O=H(()=>{let t=I.value;return w.value&&T.value&&(t=Re(I.value)[w.value](o=>o.sortData[T.value])),S.value?new ze(t,{threshold:.3,keys:["searchIndex"],useExtendedSearch:!0}).search(S.value,{limit:e.rowsPerPage}).map(c=>c.item):t}),k=H(()=>Z.chunk(O.value,e.rowsPerPage).length),p=H(()=>v.value+2<=k.value),N=H(()=>v.value>0),L=H(()=>Z.chunk(O.value,e.rowsPerPage)[v.value]),Q=t=>{T.value=t,w.value=w.value==="asc"?"desc":"asc"},U=()=>Te(t=>{const o=parseInt(t);parseInt(t)<=k.value&&(v.value=o)},{title:"Select page"}),j=()=>v.value=0,G=()=>v.value=k.value-1||0,W=()=>v.value+=1,q=()=>v.value-=1,X=()=>{typeof e.onFinish=="function"?e.onFinish():d.push("/")},l=t=>{var o,c;try{typeof((o=t.column)==null?void 0:o.tdClick)=="function"&&((c=t.column)==null||c.tdClick(t));return}catch(m){console.error(m)}},P=()=>e.columns.reduce((t,o)=>t.concat(o),[]).filter(t=>t.value||t.ref),u=()=>P().some(t=>t==null?void 0:t.encrypted),_=(t,o=!1)=>{var Y,ee,te;const c=P().filter(n=>[t==="pdf"&&typeof n.encrypted=="boolean"?(n==null?void 0:n.encrypted)&&!o:!0,t==="csv"?!(n!=null&&n.encrypted):!0,n.canExport?n==null?void 0:n.canExport[t]:!0,typeof n.exportable=="boolean"?n.exportable:!0].every(Boolean)),m=c.map(n=>n.exportedValue&&n.exportedValue.column?n.exportedValue.column(n):n.secondaryLabel||n.label),i=c.map(n=>n.ref),g=I.value.reduce((n,oe)=>{const ae=oe.row.filter(({column:V})=>i.includes(V.ref)).map(V=>V.column.exportedValue&&V.column.exportedValue.dataValue?V.column.exportedValue.dataValue(V):V.value);return[...n,ae]},[]),B="".concat(e.reportPrefix," ").concat((Y=$.getLocationName())!=null?Y:""," ").concat(Ee(e.title).replace(e.reportPrefix,"")," ").concat(Ne((te=(ee=e.csvQuarter)!=null?ee:e.subtitle)!=null?te:""));return{headers:m,rows:g,filename:B}},D=async()=>{let t;if(u()&&await _e("Security warning","PDF may contain private data that will require a password to unlock","To access private data choose Secure PDF over Regular PDF",[{name:"Secure PDF",slot:"start",color:"success"},{name:"Regular PDF",slot:"start",color:"success"}],"his-danger-color")==="Secure PDF"){const g=$.getUserName();t={encryption:{userPassword:g,ownerPassword:g,userPermissions:["print"]}}}const{headers:o,rows:c,filename:m}=_("pdf",!t);He([o],c,m,!0,t)},M=()=>{const{headers:t,rows:o,filename:c}=_("csv");Ke([t],[...o,["Date Created: ".concat(Fe().format("DD/MMM/YYYY HH:MM:ss"))],["Quarter: ".concat(e.csvQuarter||e.subtitle)],["HIS-Core Version: ".concat($.getCoreVersion())],["API Version: ".concat($.getApiVersion())],["Site UUID: ".concat($.getSiteUUID())],["Generated by: ".concat($.getUserName())]],c)},J=t=>{S.value=$e(t,S.value),v.value=0},x=t=>{t.forEach(o=>{const c={...o},m=P().map(i=>{let g="";const B=o[i.ref];try{Z.isEmpty(o)?g="...":typeof i.toValue=="function"?g="".concat(i.toValue(B)):typeof i.value=="function"?g=i.value(o):g=o[i.ref]||""}catch(Y){g=(i==null?void 0:i.defaultValue)||"_ERROR_",console.error(Y)}return c[i.ref]=g,typeof i.sortValue=="function"&&(c[i.ref]=i.sortValue(B)),{column:i,refData:B,value:g,data:o}});I.value.push({row:m,data:o,sortData:c,searchIndex:[...m,m.map(i=>i.value).join(" ")]})})};return be(()=>e.columnData,t=>{var o;if(I.value=[],!Array.isArray(t)||!t.length){v.value=0,S.value="",T.value=(o=e.defaultSortedColumn)!=null?o:"",w.value=e.defaultSortOrder,x(Array.from({length:e.rowsPerPage}).map(()=>({})));return}x(t)},{immediate:!0,deep:!0}),{first:j,last:G,next:W,prev:q,selectPage:U,sortColumn:Q,onClickTablecell:l,toPDF:D,toCSV:M,finish:X,filterTable:J,sync:Pe,search:me,close:we,arrowUp:Se,arrowDown:De,funnelOutline:Ve,page:L,canNext:p,searchTerm:S,totalPages:k,sortOrder:w,canPrev:N,currentPage:v,columnSorted:T,QWERTY:Ie,showSearchKeyboard:A}}}),Le={key:0},Me={class:"his-sm-text"},Ye={class:"art-report-theme"},Ae={class:"stick-report-header"},Qe=["colspan","rowspan","onClick"],je=["onClick"],Ge=["innerHTML"];function We(e,d,I,v,S,T){const w=f("ion-img"),A=f("ion-thumbnail"),O=f("ion-title"),k=f("ion-icon"),p=f("ion-button"),N=f("ion-label"),L=f("ion-chip"),Q=f("ion-buttons"),U=f("ion-toolbar"),j=f("ion-header"),G=f("ion-item"),W=f("ion-content"),q=f("his-keyboard"),X=f("ion-footer");return r(),C(E,null,[s(j,null,{default:a(()=>[s(U,null,{default:a(()=>[e.iconUrl?(r(),y(A,{key:0,slot:"start"},{default:a(()=>[s(w,{src:e.iconUrl},null,8,["src"])]),_:1})):h("",!0),s(O,{slot:"start",class:"his-md-text"},{default:a(()=>[b(R(e.title)+" ",1),e.subtitle?(r(),C("br",Le)):h("",!0),z("span",Me,R(e.subtitle),1)]),_:1}),s(Q,{slot:"end"},{default:a(()=>[typeof e.onConfigure=="function"?(r(),y(p,{key:0,onClick:d[0]||(d[0]=()=>e.onConfigure?e.onConfigure():null)},{default:a(()=>[s(k,{size:"large",icon:e.funnelOutline},null,8,["icon"])]),_:1})):h("",!0),e.searchTerm?(r(),y(L,{key:1,onClick:d[1]||(d[1]=()=>{e.searchTerm="",e.showSearchKeyboard=!1}),class:"his-md-text",color:"primary"},{default:a(()=>[s(N,null,{default:a(()=>[b(R(e.searchTerm?"Search: ".concat(e.searchTerm):""),1)]),_:1}),s(k,{icon:e.close},null,8,["icon"])]),_:1})):h("",!0),s(p,{color:e.showSearchKeyboard?"primary":"dark",onClick:d[2]||(d[2]=()=>e.showSearchKeyboard=!e.showSearchKeyboard),size:"large"},{default:a(()=>[s(k,{size:"large",icon:e.search},null,8,["icon"])]),_:1},8,["color"]),typeof e.onRefresh=="function"?(r(),y(p,{key:2,onClick:d[3]||(d[3]=()=>e.onRefresh?e.onRefresh():null),color:"success",size:"large"},{default:a(()=>[s(k,{size:"large",icon:e.sync},null,8,["icon"])]),_:1})):h("",!0)]),_:1})]),_:1}),(e.headerBadge||[]).length?(r(),y(U,{key:0,color:"light"},{default:a(()=>[(r(!0),C(E,null,K(e.headerBadge,(l,P)=>(r(),y(L,{onClick:u=>typeof l.action=="function"?l.action():null,key:P,color:(l==null?void 0:l.color)||"dark"},{default:a(()=>[s(k,{icon:(l==null?void 0:l.icon)||e.search},null,8,["icon"]),s(N,{innerHTML:l==null?void 0:l.text},null,8,["innerHTML"])]),_:2},1032,["onClick","color"]))),128))]),_:1})):h("",!0)]),_:1}),s(W,{"scroll-y":"","scroll-x":""},{default:a(()=>[z("table",Ye,[z("thead",Ae,[(r(!0),C(E,null,K(e.columns,(l,P)=>(r(),C("tr",{key:P},[(r(!0),C(E,null,K(l,(u,_)=>{var D,M;return r(),C("th",{key:_,colspan:((D=u==null?void 0:u.span)==null?void 0:D.thColspan)||1,rowspan:((M=u==null?void 0:u.span)==null?void 0:M.thRowspan)||1,onClick:J=>e.sortColumn(u.ref)},[s(G,{lines:"none"},{default:a(()=>[e.columnSorted&&e.columnSorted===u.ref?(r(),y(k,{key:0,icon:e.sortOrder==="asc"?e.arrowUp:e.arrowDown},null,8,["icon"])):h("",!0),s(N,{class:"ion-text-center"},{default:a(()=>[z("b",null,R(u.label),1)]),_:2},1024)]),_:2},1024)],8,Qe)}),128))]))),128))]),z("tbody",null,[(r(!0),C(E,null,K(e.page,(l,P)=>(r(),C("tr",{key:P},[(r(!0),C(E,null,K(l.row,(u,_)=>{var D;return r(),C("td",{key:_,onClick:()=>e.onClickTablecell(u),class:Be({"clickable-cell":(D=u==null?void 0:u.column)==null?void 0:D.tdClick})},[z("span",{innerHTML:u.value,class:"his-sm-text"},null,8,Ge)],10,je)}),128))]))),128))])])]),_:1}),s(X,null,{default:a(()=>[e.showSearchKeyboard?(r(),y(q,{key:0,kbConfig:e.QWERTY,onKeyPress:e.filterTable},null,8,["kbConfig","onKeyPress"])):h("",!0),s(U,{color:"dark"},{default:a(()=>[s(p,{onClick:d[4]||(d[4]=l=>e.toCSV()),size:"large"},{default:a(()=>[b(" CSV ")]),_:1}),s(p,{onClick:d[5]||(d[5]=l=>e.toPDF()),size:"large"},{default:a(()=>[b(" PDF ")]),_:1}),e.totalPages>1?(r(),y(p,{key:0,onClick:e.first,disabled:e.currentPage===0||e.totalPages<=2,size:"large",slot:"end"},{default:a(()=>[b(" First ")]),_:1},8,["onClick","disabled"])):h("",!0),e.totalPages>1?(r(),y(p,{key:1,onClick:e.prev,disabled:!e.canPrev,color:"light",size:"large",slot:"end"},{default:a(()=>[b(" Prev ")]),_:1},8,["onClick","disabled"])):h("",!0),e.totalPages>1?(r(),y(p,{key:2,onClick:e.selectPage,size:"large",slot:"end",color:"light"},{default:a(()=>[b(R(e.currentPage)+" / "+R(e.totalPages-1),1)]),_:1},8,["onClick"])):h("",!0),e.totalPages>1?(r(),y(p,{key:3,onClick:e.next,disabled:!e.canNext,color:"light",size:"large",slot:"end"},{default:a(()=>[b(" Next ")]),_:1},8,["onClick","disabled"])):h("",!0),e.totalPages>1?(r(),y(p,{key:4,onClick:e.last,disabled:e.currentPage+1>=e.totalPages||e.totalPages<=2,size:"large",slot:"end"},{default:a(()=>[b(" Last ")]),_:1},8,["onClick","disabled"])):h("",!0),s(p,{onClick:e.finish,color:"success",size:"large",slot:"end"},{default:a(()=>[b(" Finish ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const Ze=Ue(Oe,[["render",We],["__scopeId","data-v-33ef3337"]]);export{Ze as v};
