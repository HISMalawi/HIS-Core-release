import{H as I}from"./HisStandardForm-BCjM4-bc.js";import{bQ as y,d as H,r as C,ad as o,ae as s,bY as d,aV as r,bZ as u,a as R,c as L,w as k,b as O,u as c,I as U,W as T}from"./index-CMZASHAR.js";import{u as N}from"./useEncounter-CsCeua2V.js";import{b as v,m as _,r as q}from"./commons-Bp7XBfaW.js";import"./isEmpty-DjKeGqZh.js";import"./encounter_guidelines-CJXpBOk4.js";import"./GuidelineEngine-D6V1_Znr.js";class l extends y{constructor(a,n){super(a,39,n)}}const Z=H({__name:"HIVStatus",setup(m){let a;const n=C([]),{patientDashboardUrl:p,goToNextTask:b}=N((e,t,i)=>{a=new l(t,e),n.value=[g(),...F(i),x(),A(),E(),...h(i),...S(i),V(),D()]});async function f(e,t){if(!await a.createEncounter())return T("Unable to create encounter");const w=await q({...t});if(!await a.saveObservationList(w))return T("Unable to save observations");b()}function D(){return{id:"advised_to_visit_art",helpText:"Advised to visit ART",type:o.TT_SELECT,options:v,condition:e=>e.received_arvs.value!=="Yes",computedValue:e=>({obs:a.buildValueCoded("Advised to visit ART",e.value)})}}function V(){return{id:"art_clinic_location",helpText:"ART clinic location",type:o.TT_SELECT,computedValue:e=>({obs:a.buildValueText("ART clinic location",e.label)}),validation:e=>s.required(e),condition:e=>/Yes|Defaulter/i.test(e.received_arvs.value),options:(e,t="")=>d(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}}}function h(e){return r({id:"date_started_art",helpText:"Started ART",required:!0,condition:t=>t.received_arvs.value==="Yes",minDate:()=>{var t;return"".concat((t=e==null?void 0:e.getBirthdate())!=null?t:"")},maxDate:()=>a.getDate(),estimation:{allowUnknown:!0,estimationFieldType:u.MONTH_ESTIMATE_FIELD},computeValue:(t,i)=>a.buildDateObs("Date ART started",t,i)})}function S(e){return r({id:"date_defualted_art",helpText:"ART Default",required:!0,condition:t=>t.received_arvs.value==="Defaulter",minDate:()=>{var t;return"".concat((t=e==null?void 0:e.getBirthdate())!=null?t:"")},maxDate:()=>a.getDate(),estimation:{allowUnknown:!0,estimationFieldType:u.MONTH_ESTIMATE_FIELD},computeValue:(t,i)=>a.buildDateObs("ART default date",t,i)})}function A(){return{id:"cpt_started",helpText:"CPT Started",type:o.TT_SELECT,options:v,condition:e=>e.hiv_status.value==="Reactive",computedValue:e=>({obs:a.buildValueCoded("CPT Started",e.value)})}}function E(){return{id:"received_arvs",helpText:"Started ART?",type:o.TT_SELECT,computedValue:({value:e})=>({obs:a.buildValueCoded("ART Started",e)}),validation:e=>s.required(e),options:()=>_(["Yes","No","Defaulter","Unknown"]),condition:e=>e.hiv_status.value==="Reactive"}}function g(){return{id:"hiv_status",helpText:"HIV status",type:o.TT_SELECT,validation:e=>s.required(e),computedValue:e=>({obs:a.buildValueText("HIV status",e.label)}),options:()=>_(["Reactive","Non-reactive","Unknown"])}}function F(e){return r({id:"hiv_test_date",helpText:"HIV Test",required:!0,minDate:()=>{var t;return"".concat((t=e==null?void 0:e.getBirthdate())!=null?t:"")},maxDate:()=>l.getSessionDate(),condition:t=>t.hiv_status.value!=="Unknown",summaryLabel:"HIV test date",estimation:{allowUnknown:!0,estimationFieldType:u.MONTH_ESTIMATE_FIELD},computeValue:(t,i)=>a.buildDateObs("HIV test date",t,i)})}function x(){return{id:"test_location",helpText:"HIV test location",type:o.TT_SELECT,validation:e=>s.required(e),defaultValue:()=>l.getLocationName(),computedValue:({label:e})=>({obs:a.buildValueText("HIV test location",e)}),condition:e=>e.hiv_status.value!=="Unknown",options:(e,t="")=>d(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}}}return(e,t)=>(R(),L(c(U),null,{default:k(()=>[O(I,{cancelDestinationPath:c(p),fields:n.value,onFinishAction:f,skipSummary:""},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{Z as default};
