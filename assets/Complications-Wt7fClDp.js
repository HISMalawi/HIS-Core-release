import{d as $,K as C,M as J,N as K,o as p,x as y,b as o,w as s,cu as e,u as f,B as b,y as V,c as S,v as k,A as q,z as L,O as H,i as w,k as z,j as Q,ap as X,aq as Z,ar as j,g as Y,cK as G,h as m,cO as x,D as E,e as ee,l as te,f as B,m as ae,_ as oe,bg as P,dj as se,F as M,ct as le,ae as ne,V as F,I as ue}from"./index-C-Wf7IuL.js";import{H as ie}from"./HisStandardForm-zCup__or.js";import{u as re}from"./useEncounter-Cdg-ySH1.js";import{g as _}from"./util-CyjuS_4X.js";import{r as ce}from"./commons-B-xNtGcO.js";import"./isEmpty-CAuO0MZq.js";import"./encounter_guidelines-p4GeYGc_.js";import"./GuidelineEngine-D6V1_Znr.js";const de={key:0,class:"side-title"},fe=$({__name:"SideEffects",props:{prevSideEffectState:{type:Object},sideEffects:{type:Object,required:!0},drugs:{type:Array,default:()=>[]}},setup(U){const n=C(""),t=C({}),v=U,O=J(()=>Object.keys(t.value).every(u=>{const l=t.value[u];return Object.keys(l.drugReason).some(d=>l.drugReason[d].isChecked)||"".concat(l.otherReason).length>0}));function h(){H.dismiss()}function T(){const u=[];Object.keys(t.value).forEach(l=>{Object.keys(t.value[l].drugReason).forEach(a=>{t.value[l].drugReason[a].isChecked&&u.push({concept:t.value[l].concept,drug:t.value[l].drugReason[a].detail})}),t.value[l].otherReason&&u.push({concept:t.value[l].concept,other:t.value[l].otherReason})}),H.dismiss({values:u,state:t.value})}function A(u){u.detail.checked&&(t.value[n.value].otherReason="")}function N(){Object.keys(t.value[n.value].drugReason).forEach(u=>{t.value[n.value].drugReason[u].isChecked=!1})}return K(()=>{v.prevSideEffectState?t.value=v.prevSideEffectState:v.sideEffects.forEach(u=>{n.value||(n.value=u.label),t.value[u.label]={concept:u.other.concept,drugReason:v.drugs.reduce((l,a)=>(l[a.drug.name]={isChecked:!1,detail:a},l),{}),otherReason:""}})}),(u,l)=>(p(),y(b,null,[o(e(Q),null,{default:s(()=>[o(e(w),null,{default:s(()=>[o(e(z),{class:"his-lg-text"},{default:s(()=>[f("Suspected causes")]),_:1})]),_:1})]),_:1}),o(e(te),{style:{overflowY:"hidden",background:"grey"}},{default:s(()=>[o(e(X),null,{default:s(()=>[o(e(Z),null,{default:s(()=>[o(e(j),null,{default:s(()=>[o(e(Y),{style:{overflowY:"auto",height:"78vh"}},{default:s(()=>[o(e(G),{modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=a=>n.value=a)},{default:s(()=>[(p(!0),y(b,null,V(t.value,(a,d)=>(p(),S(e(m),{class:"his-md-text",key:d},{default:s(()=>[o(e(x),{slot:"start",value:d},null,8,["value"]),o(e(E),null,{default:s(()=>[f(k(d),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(e(j),{style:{overflowY:"auto",height:"78vh"}},{default:s(()=>[n.value?(p(),y("div",de,[q("b",null,k(n.value),1),f(" causes ")])):L("",!0),n.value?(p(),S(e(Y),{key:1},{default:s(()=>[o(e(m),{class:"his-lg-text"},{default:s(()=>[o(e(E),null,{default:s(()=>[f("Current Medication(s)")]),_:1})]),_:1}),(p(!0),y(b,null,V(t.value[n.value].drugReason,(a,d)=>(p(),S(e(m),{class:"his-md-text",key:d},{default:s(()=>[o(e(E),null,{default:s(()=>[f(k(d),1)]),_:2},1024),o(e(ee),{onIonChange:A,slot:"start",modelValue:a.isChecked,"onUpdate:modelValue":D=>a.isChecked=D},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1})):L("",!0),n.value?(p(),S(e(G),{key:2,onIonChange:N,modelValue:t.value[n.value].otherReason,"onUpdate:modelValue":l[1]||(l[1]=a=>t.value[n.value].otherReason=a)},{default:s(()=>[o(e(m),{class:"his-lg-text"},{default:s(()=>[o(e(E),null,{default:s(()=>[f("Previous Medication")]),_:1})]),_:1}),o(e(m),{class:"his-md-text"},{default:s(()=>[o(e(E),null,{default:s(()=>[f("Other, not drug related")]),_:1}),o(e(x),{slot:"start",value:"Other"})]),_:1}),o(e(m),{class:"his-md-text"},{default:s(()=>[o(e(E),null,{default:s(()=>[f("Drug side effect")]),_:1}),o(e(x),{slot:"start",value:"Drug side effect"})]),_:1})]),_:1},8,["modelValue"])):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),o(e(ae),null,{default:s(()=>[o(e(w),null,{default:s(()=>[o(e(B),{onClick:h,slot:"start",size:"large",color:"danger"},{default:s(()=>[f(" Close ")]),_:1}),o(e(B),{onClick:T,size:"large",slot:"end",disabled:!O.value},{default:s(()=>[f(" Save ")]),_:1},8,["disabled"])]),_:1})]),_:1})],64))}}),_e=oe(fe,[["__scopeId","data-v-feb7a6c4"]]),Ce=$({__name:"Complications",setup(U){const n=C([]),t=new P(-1,se.COMPLICATIONS),v=C([]),O=C({}),h={pageOne:{"Abnominal pain":"ABNOMINAL_PAIN",Athralgia:"ATHRALGIA","Colour body fluids":"COLOUR_BODY_FLUIDS",Depression:"DEPRESSION",Fatigue:"FATIGUE",Gastrointestinal:"GASTROINTESTINAL",Headache:"HEADACHE","Hearing Difficulties":"HEARING_DIFFICULTIES",Hematological:"HEMATOLOGICAL",Hepatoxicity:"HEPATOXICITY",Hypothyroidism:"HYPOTHYROIDISM",Itching:"SKIN_ITCHING"},pageTwo:{Jaundice:"JAUNDICE","Lactic Acidosis":"LACTIC_ACIDOSIS",Numbness:"NUMBNESS_IN_HANDS_FEET_LEGS","Optic Neuritis":"OPTIC_NEURITIS",Pancreatitis:"PANCREATITIS","Periferal Neuropathy":"PERIFERAL_NEUROPATHY",Psychosis:"PSYCHOSIS","QT Prolongation":"QT_PROLONGATION","Renal failure":"RENAL_FAILURE","Skin Rash":"SKIN_RASH",Toxicity:"TOXICITY"}},{goToNextTask:T,patientDashboardUrl:A}=re((l,a)=>{t.patientID=a,t.providerID=l;function d(){let c=[];return{id:"history",helpText:"Side effects / Contraindications history",type:M.TT_TABLE_VIEWER,init:async()=>{const R=await P.getJson("programs/".concat(t.programID,"/patients/").concat(a,"/medication_side_effects"),{date:t.date});return Object.keys(R).forEach(i=>{c.push([le(i),Object.values(R[i]).flat(1).map(r=>"<b>".concat(r.name,"</b> ").concat(r.drug_induced?"(Drug-induced)":""," : ").concat(r.drug||"Unknown"," ")).join("<p/>")])}),!0},condition:()=>c.length,options:()=>[{label:"",value:"",other:{columns:["Date","Condition"],rows:c}}]}}function D(){return Object.keys(h).map((c,R)=>({id:c,helpText:"Page ".concat(R+1,": Contraindications / Side effects"),type:M.TT_MULTIPLE_YES_NO,init:async()=>(ne.isEmpty(v.value)&&(v.value=await P.getJson("patients/".concat(a,"/last_drugs_received"),{program_id:t.programID})),!0),beforeNext:async i=>{const r=i.filter(I=>I.value==="YES_ANSWER");if(r.length){const I=await H.create({component:_e,backdropDismiss:!1,cssClass:"large-modal",componentProps:{sideEffects:r,drugs:v.value}});I.present();const{data:g}=await I.onDidDismiss();if(!g)return!1;O.value[c]=g.values}return!0},validation:i=>F.validateSeries([()=>F.required(i),()=>F.anyEmpty(i)]),computedValue:i=>i.map(r=>({concept_id:_("MALAWI_TB_SIDE_EFFECTS"),value_coded:_("".concat(r.other.concept)),child:[{concept_id:_("".concat(r.other.concept)),value_coded:_("".concat(r.value)),obs_datetime:t.date}],obs_datetime:t.date})),options:i=>Object.keys(h[c]).map(r=>{var I,g;return{label:r,value:((g=(I=i[c])==null?void 0:I.find(W=>W.label===r))==null?void 0:g.value)||"",other:{concept:h[c][r],values:[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]}}}),config:{footerBtns:[{name:"None",slot:"end",onClickComponentEvents:{refreshOptions:()=>Object.keys(h[c]).map(i=>({label:i,value:"NO_ANSWER",other:{concept:h[c][i],values:[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]}}))},onClick:()=>"None"}]}}))}n.value=[d(),...D()]});function N(){return Object.values(O.value).flat(1).map(a=>a.other&&/drug/i.test(a.other)?{concept_id:_("DRUG_INDUCED"),value_coded:_(a.concept),value_text:"Past medication history"}:a.drug?{concept_id:_("DRUG_INDUCED"),value_coded:_(a.concept),value_drug:a.drug.drug.drug_id}:{concept_id:_("CONTRAINDICATIONS"),value_coded:_(a.concept)})}async function u(l,a){await t.createEncounter(),await t.saveObservationList([...await ce(a),...N()]),T()}return(l,a)=>(p(),S(e(ue),null,{default:s(()=>[o(ie,{cancelDestinationPath:e(A),onFinishAction:u,fields:n.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{Ce as default};
