import{H as I}from"./HisStandardForm-CXnAooxi.js";import{bU as A,d as D,r as S,al as n,am as o,c1 as h,cs as u,b_ as w,s,a as R,f as x,at as F,dF as V,b as C,aB as P}from"./index-y6JY22M4.js";import{u as L}from"./useEncounter-A_jZetx1.js";import{b as d,r as O}from"./commons-_2FCEwgG.js";import"./isEmpty-Dx6_cSDk.js";import"./encounter_guidelines-nb8Q8sEZ.js";import"./GuidelineEngine-D6V1_Znr.js";class U extends A{constructor(t,i){super(t,104,i)}}const G=D({__name:"Registration",setup(c){let t,i;const l=S([]),{goToNextTask:p,patientDashboardUrl:f}=L((e,a,r)=>{i=r,t=new U(a,e),l.value=[b(),g(),m(),y(),N()]});async function v(e,a){if(await T(e),!await t.createEncounter())return s("Unable to create registration encounter");const E=await O({...a});if(!await t.saveObservationList(E))return s("Unable to save observations");p()}async function T(e){const a=e.national_id_available,r=e.national_id;a&&a.value==="Yes"&&(await i.updateMWNationalId(r.value),P.invalidate("ACTIVE_PATIENT"))}async function _(e){return e?(await F.findByOtherID(V,e)).length>0:!1}function b(){return{id:"visit_type",helpText:"Type of visit",type:o.TT_SELECT,validation:e=>n.required(e),computedValue:e=>({obs:t.buildValueCoded("Type of visit",e.value)}),options:()=>[{label:"New",value:"New patient"},{label:"Referral",value:"Referral"},{label:"Re-visiting",value:"Re-visiting"}]}}function g(){return{id:"referring_facility_name",helpText:"Referred from",type:o.TT_SELECT,validation:e=>n.required(e),computedValue:({label:e})=>({obs:t.buildValueText("Referred from",e)}),condition:e=>e.visit_type.value==="Referral",options:(e,a="")=>h(a),config:{showKeyboard:!0,isFilterDataViaApi:!0}}}function m(){return{id:"national_id_available",helpText:"National ID Available",type:o.TT_SELECT,validation:e=>n.required(e),condition:()=>{var e;return u((e=i==null?void 0:i.patient)==null?void 0:e.date_created)!=u(t.date)&&i.getMWNationalID()==="Unknown"},options:()=>d(),appearInSummary:()=>!1}}function y(){return{id:"national_id",helpText:"Enter National ID",type:o.TT_TEXT,validation:e=>n.isMWNationalID(e),condition:e=>e.national_id_available.value==="Yes",beforeNext:async e=>e.value&&await _(e.value.toString())?(s("National ID already exists"),!1):!0,summaryMapValue:({value:e})=>({value:e,label:"National ID"}),config:{casing:"uppercase",customKeyboard:[w,[["Delete"]]]}}}function N(){return{id:"patient_pregnant",helpText:"Patient pregnant",type:o.TT_SELECT,validation:e=>n.required(e),computedValue:({value:e})=>({obs:t.buildValueCoded("PATIENT PREGNANT",e)}),condition:()=>i.isChildBearing(),options:()=>d()}}return(e,a)=>(C(),R(I,{cancelDestinationPath:x(f),fields:l.value,onFinishAction:v},null,8,["cancelDestinationPath","fields"]))}});export{G as default};
