import{dM as R,dN as L,dO as k,dP as X,dQ as H,dR as O,dS as V,dT as q,dU as S,dV as Q,dW as W,dX as Y,dY as Z,dZ as z,d_ as J,d$ as K,cn as j,am as rr,a as D,r as y,an as ar,t as er,as as $,ae as nr,bl as E,c4 as tr,e0 as sr}from"./index-CyYd6aWW.js";import{E as ir,F as p}from"./encounter_guidelines-Cq7m6ibV.js";import{m as or}from"./GuidelineEngine-D6V1_Znr.js";var B=R,ur=L,cr=k,F=B?B.isConcatSpreadable:void 0;function vr(a){return cr(a)||ur(a)||!!(F&&a&&a[F])}var lr=vr,fr=X,dr=lr;function x(a,r,e,t,n){var s=-1,i=a.length;for(e||(e=dr),n||(n=[]);++s<i;){var o=a[s];r>0&&e(o)?r>1?x(o,r-1,e,t,n):fr(n,o):t||(n[n.length]=o)}return n}var pr=x;function _r(a){return function(r,e,t){for(var n=-1,s=Object(r),i=t(r),o=i.length;o--;){var c=i[a?o:++n];if(e(s[c],c,s)===!1)break}return r}}var br=_r,gr=br,mr=gr(),yr=mr,Er=yr,hr=H;function $r(a,r){return a&&Er(a,r,hr)}var Tr=$r,Or=O;function Sr(a,r){return function(e,t){if(e==null)return e;if(!Or(e))return a(e,t);for(var n=e.length,s=r?n:-1,i=Object(e);(r?s--:++s<n)&&t(i[s],s,i)!==!1;);return e}}var Ar=Sr,wr=Tr,Dr=Ar,Br=Dr(wr),Fr=Br,Nr=Fr,Pr=O;function Cr(a,r){var e=-1,t=Pr(a)?Array(a.length):[];return Nr(a,function(n,s,i){t[++e]=r(n,s,i)}),t}var Mr=Cr;function kr(a,r){var e=a.length;for(a.sort(r);e--;)a[e]=a[e].value;return a}var xr=kr,N=V;function Ir(a,r){if(a!==r){var e=a!==void 0,t=a===null,n=a===a,s=N(a),i=r!==void 0,o=r===null,c=r===r,f=N(r);if(!o&&!f&&!s&&a>r||s&&i&&c&&!o&&!f||t&&i&&c||!e&&c||!n)return 1;if(!t&&!s&&!f&&a<r||f&&e&&n&&!t&&!s||o&&e&&n||!i&&n||!c)return-1}return 0}var Ur=Ir,Gr=Ur;function Rr(a,r,e){for(var t=-1,n=a.criteria,s=r.criteria,i=n.length,o=e.length;++t<i;){var c=Gr(n[t],s[t]);if(c){if(t>=o)return c;var f=e[t];return c*(f=="desc"?-1:1)}}return a.index-r.index}var Lr=Rr,T=q,Xr=Q,Hr=W,Vr=Mr,qr=xr,Qr=Y,Wr=Lr,Yr=S,Zr=k;function zr(a,r,e){r.length?r=T(r,function(s){return Zr(s)?function(i){return Xr(i,s.length===1?s[0]:s)}:s}):r=[Yr];var t=-1;r=T(r,Qr(Hr));var n=Vr(a,function(s,i,o){var c=T(r,function(f){return f(s)});return{criteria:c,index:++t,value:s}});return qr(n,function(s,i){return Wr(s,i,e)})}var Jr=zr;function Kr(a,r,e){switch(e.length){case 0:return a.call(r);case 1:return a.call(r,e[0]);case 2:return a.call(r,e[0],e[1]);case 3:return a.call(r,e[0],e[1],e[2])}return a.apply(r,e)}var jr=Kr,ra=jr,P=Math.max;function aa(a,r,e){return r=P(r===void 0?a.length-1:r,0),function(){for(var t=arguments,n=-1,s=P(t.length-r,0),i=Array(s);++n<s;)i[n]=t[r+n];n=-1;for(var o=Array(r+1);++n<r;)o[n]=t[n];return o[r]=e(i),ra(a,this,o)}}var ea=aa;function na(a){return function(){return a}}var ta=na,sa=Z,ia=function(){try{var a=sa(Object,"defineProperty");return a({},"",{}),a}catch(r){}}(),oa=ia,ua=ta,C=oa,ca=S,va=C?function(a,r){return C(a,"toString",{configurable:!0,enumerable:!1,value:ua(r),writable:!0})}:ca,la=va,fa=800,da=16,pa=Date.now;function _a(a){var r=0,e=0;return function(){var t=pa(),n=da-(t-e);if(e=t,n>0){if(++r>=fa)return arguments[0]}else r=0;return a.apply(void 0,arguments)}}var ba=_a,ga=la,ma=ba,ya=ma(ga),Ea=ya,ha=S,$a=ea,Ta=Ea;function Oa(a,r){return Ta($a(a,r,ha),a+"")}var Sa=Oa,Aa=z,wa=O,Da=J,Ba=K;function Fa(a,r,e){if(!Ba(e))return!1;var t=typeof r;return(t=="number"?wa(e)&&Da(r,e.length):t=="string"&&r in e)?Aa(e[r],a):!1}var Na=Fa,Pa=pr,Ca=Jr,Ma=Sa,M=Na,ka=Ma(function(a,r){if(a==null)return[];var e=r.length;return e>1&&M(a,r[0],r[1])?r=[]:e>2&&M(r[0],r[1],r[2])&&(r=[r[0]]),Ca(a,Pa(r,1),[])}),xa=ka;const Ia=j(xa);function La(a){const r=rr();let e=D({});const t=y(-1),n=D({}),s=y(-1),i=y([]),o=ar(),c=y(""),f=()=>nr(e.getID(),o),A=()=>o.push(c.value),I=()=>Ia(i.value,({username:u})=>u).map(u=>{var v,_;let d="".concat(u.username);if(!tr((v=u==null?void 0:u.person)==null?void 0:v.names)){const[b]=((_=u.person)==null?void 0:_.names)||[];d+=" (".concat(b.given_name," ").concat(b.family_name,")")}return d}),U=async(u="N/A")=>{const d=await $.get("PATIENT_PROGRAM",{patientID:e.getID()});n.outcome=d.outcome,n.outcomeStartDate=d.startDate,n.sessionDate=E.getSessionDate(),n.apiDate=E.getCachedApiDate(),n.isBdeMode=E.isBDE(),n.birthDate=e.getBirthdate(),n.encounterName=u.toUpperCase(),E.isBDE()&&(i.value=await $.get("PROVIDERS"),n.providers=I())},w=(u,d=null)=>{const v={};if(v[p.SET_PROVIDER]=_=>{var g,m;const[b]=_.split(" ");return s.value=(m=(g=sr(i.value,{username:b}))==null?void 0:g.person_id)!=null?m:-1,p.CONTINUE},v[p.CHANGE_SESSION_DATE]=()=>(o.push("/session/date?patient_dashboard_redirection_id=".concat(e.getID())),p.EXIT),v[p.CHANGE_PATIENT_OUTCOME]=()=>(o.push("/patient/programs/".concat(e.getID())),p.EXIT),v[p.GO_TO_PATIENT_DASHBOARD]=()=>(A(),p.EXIT),u in v)return v[u](d)},G=async u=>{var v,_,b,g;const d=or(u,ir);for(const m in d){const l=d[m];if((v=l==null?void 0:l.actions)!=null&&v.alert&&w(await((_=l==null?void 0:l.actions)==null?void 0:_.alert(u)))===p.EXIT)return;if((b=l==null?void 0:l.actions)!=null&&b.selection){const h=await((g=l==null?void 0:l.actions)==null?void 0:g.selection(u));w(h.flowState,h.value)}}};return er(async()=>{try{t.value=parseInt(r.params.patient_id),c.value="/patient/dashboard/".concat(t.value),e=await $.get("ACTIVE_PATIENT",{patientID:t.value}),await U(r.name),await G(n),typeof a=="function"&&a(s.value,t.value,e,n)}catch(u){console.error("Error in useEncounter hook:",u)}}),{patient:e,patientId:t,provider:s,providers:i,facts:n,patientDashboardUrl:c,goToPatientDashboard:A,goToNextTask:f}}export{La as u};
