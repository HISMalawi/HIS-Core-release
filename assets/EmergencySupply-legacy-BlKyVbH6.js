System.register(["./index-legacy-DhfIpXPN.js","./HisStandardForm-legacy-BZtV4cgX.js","./useEncounter-legacy-DE3W1zUJ.js","./commons-legacy-v6iZChIm.js","./adherence_service-legacy-DNTnv77W.js","./isEmpty-legacy-Ci9NoEmG.js","./encounter_guidelines-legacy-BQLXKL9R.js","./GuidelineEngine-legacy-KsvQuFdF.js","./htn_service-legacy-CoDkVSgJ.js"],(function(e,t){"use strict";var a,i,n,r,l,u,d,o,s,c,g,m,p,y,h,f;return{setters:[e=>{a=e.d,i=e.bV,n=e.r,r=e.al,l=e.am,u=e.B,d=e.ct,o=e.au,s=e.c2,c=e.a,g=e.f,m=e.b},e=>{p=e.H},e=>{y=e.u},e=>{h=e.r},e=>{f=e.A},null,null,null,null],execute:function(){e("default",a({__name:"EmergencySupply",setup(e){const t=new i(-1,25),a=n([]),{patientDashboardUrl:v,goToPatientDashboard:_}=y(((e,i)=>{t.patientID=i,t.providerID=e;const n=new f(t.patientID,t.providerID);a.value=[{id:"date_of_emergency_refill",helpText:"Date of emergency refill",type:l.TT_FULL_DATE,init:async()=>(await n.loadPreviousDrugs(),!0),beforeNext:async e=>{const t=n.getLastDrugs()?.[0]?.order?.start_date;return!t||!u(e.value).isBefore(t)||o(`Date entered is less than last known dispensation of ${d(t)}`)},validation:e=>r.validateSeries([()=>r.required(e),()=>{if(u(e.value).isAfter(t.date))return[`Date entered is after current date of ${d(t.date)}`]}]),computedValue:e=>t.buildValueDate("Prescription refill date",e.value)},{id:"facility",type:l.TT_SELECT,helpText:"Facility where emergency refill was collected",validation:e=>r.required(e),options:(e,t="")=>s(t),computedValue:e=>t.buildValueText("Health facility name",e.label),config:{showKeyboard:!0,isFilterDataViaApi:!0}},{id:"drug",helpText:"Emmergency Supply Drugs",type:l.TT_DRUG_RETROSPECTIVE_INPUT,init:async()=>(await n.loadPreviousDrugs(),!0),options:e=>e.drug.length?e.drug:n.getLastDrugs().map((e=>({label:e.drug.name,value:e.drug.concept_id,other:{givenAmount:"",remainingAmount:"",drug:e}}))),computedValue:(e,t)=>e.map((async e=>{const a=n.calculateAdherence(e.other.drug.quantity,e.other.remainingAmount,(i=e.other.drug,n.calculateExpected(i.quantity,i.equivalent_daily_dose,i.order.start_date,`${r=i.frequency}`.match(/qod/i)?"QOD":`${r}`.match(/weekly/i)?"QW":r)));var i,r;return{...await n.buildValueCoded("Medications dispensed",e.value),child:[await n.buildPillCountObs(e.other.drug.order_id,e.other.remainingAmount),await n.buildAdherenceObs(e.other.drug.order_id,e.other.drug.drug_id,a,t.date_of_emergency_refill.value),await n.buildValueNumber("Amount of drug dispensed",e.other.givenAmount)]}})),validation:e=>{if(e.every((e=>""===e.other.givenAmount||""===e.other.remainingAmount)))return["Please enter drug details for all drugs"]}},{id:"next_appointment",helpText:"Appointment date",type:l.TT_DATE_PICKER,computedValue:e=>t.buildValueDate("Appointment date",e),validation:e=>r.required(e)}]}));async function D(e,a){await t.createEncounter(),await t.saveObservationList(await h(a)),_()}return(e,t)=>(m(),c(p,{fields:a.value,onFinishAction:D,skipSummary:!0,cancelDestinationPath:g(v)},null,8,["fields","cancelDestinationPath"]))}}))}}}));
