System.register(["./dynamic-import-helper-legacy-DYK5bIOV.js","./HisStandardForm-legacy-C7VqHmr3.js","./index-legacy--hxN_V8z.js","./EncounterMixin.vue_vue_type_script_lang-legacy-BYNMg0KB.js","./identifier_service-legacy-L8O08E38.js","./TouchScreenForm-legacy-DxIQwsU4.js","./ToolbarMediumCard-legacy-CzmL2SiF.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-TUlObaz7.js","./encounter_guidelines-legacy-BZk5BWg2.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var r,i,n,a,s,u,l,c,o,d,m,p,h,g;return{setters:[e=>{r=e.F},e=>{i=e.H},e=>{n=e.d,a=e.aI,s=e.t,u=e.R,l=e.V,c=e.aJ,o=e._,d=e.r,m=e.o,p=e.c},e=>{h=e._},e=>{g=e.I},null,null,null,null,null,null],execute:function(){const t=n({mixins:[h],components:{HisStandardForm:i},data:()=>({patientHasARVNumber:!1,currentArvNumber:"",prependValue:""}),watch:{ready:{async handler(e){if(!e)return;const t=this.patient.getArvNumber();if("Unknown"!==t){const e=t.split("-");this.currentArvNumber=e[2].replace(/^\D+|\s/g,""),this.prependValue=`${e[0]}-${e[1]}-`,this.patientHasARVNumber=!0}else{const e=await a.getNextSuggestedARVNumber();this.currentArvNumber=e.arv_number.replace(/^\D+|\s/g,"")}this.fields=this.getFields()},immediate:!0}},methods:{async onFinish(e){const t=e.arv_number.value;if(t===this.patient.getArvNumber())return this.$router.back();if(await g.arvNumberExists(t))s("ARV number already exists",5e3);else try{this.patientHasARVNumber?await this.patient.updateARVNumber(t):await this.patient.createArvNumber(t),u.invalidate("ACTIVE_PATIENT"),this.$router.back()}catch(r){s(`${r}`)}},getFields(){return[{id:"arv_number",helpText:"Update ARV Number",type:r.TT_TEXT,validation:e=>l.required(e),defaultValue:()=>this.currentArvNumber,config:{initialKb:"0-9",prependValue:()=>{if(this.prependValue)return this.prependValue;const e=c.getActiveApp();return e&&e.programPatientIdentifiers?e.programPatientIdentifiers["ARV Number"].prefix():""},footerBtns:[{name:"Void ARV Number",slot:"end",color:"danger",onClick:async()=>{await this.patient.updateARVNumber("Unknown"),u.invalidate("ACTIVE_PATIENT"),this.$router.back()}}]}}]}}});e("default",o(t,[["render",function(e,t,r,i,n,a){const s=d("his-standard-form");return m(),p(s,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}]]))}}}));
