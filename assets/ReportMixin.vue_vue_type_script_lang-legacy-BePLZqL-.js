System.register(["./index-legacy-CBR8jcof.js","./BasicReportTemplate-legacy-B2QdRyQU.js"],(function(t,e){"use strict";var a,r,i,s,l,n,o,u,d,p,c,h,m,D,w;return{setters:[t=>{a=t.d,r=t.br,i=t.cm,s=t.ag,l=t.ao,n=t.aq,o=t.a9,u=t.aa,d=t.cn,p=t.av,c=t.aj,h=t.aU,m=t.af,D=t.bD},t=>{w=t.D}],execute:function(){t("_",a({data:()=>({app:r.getActiveApp(),fields:[],report:{},reportReady:!1,period:"",startDate:"",endDate:"",customFileName:"",isMilitarySite:!1,drillDownCache:{}}),methods:{formatGender:t=>i(t),toDate:t=>s.toStandardHisDisplayFormat(t),sortByArvNumber(t,e="arv_number"){try{return t.sort(((t,a)=>this.getArvInt(t[e])>this.getArvInt(a[e])?1:-1))}catch(a){return console.error(a),t}},getArvInt(t){if("string"==typeof t){const e=t.split("-")[2],a=parseInt(e);return"number"==typeof a?a:0}return 0},parseAgeGroup:t=>"<1 year"===t?[0,0]:"90 plus years"===t?[90,1e3]:t.split("-").map((t=>parseInt(t,10))),tdARV(t,e={}){return l.td(t,{sortValue:this.getArvInt(t),...e})},confirmPatient(t){return this.$router.push(`/patients/confirm?person_id=${t}`)},async drilldownAsyncRows(t,e,a,r=!0){(await n.create({component:w,cssClass:"large-modal",componentProps:{title:t,columns:e,asyncRows:a,canExport:r,showFilters:!0,rowsPerPage:50,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>n.dismiss()}})).present()},async drilldownData(t,e,a,r){(await n.create({component:w,cssClass:"large-modal",componentProps:{title:t,columns:e,rows:a,rowParser:r,rowsPerPage:50,showFilters:!0,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>n.dismiss()}})).present()},getDefaultDrillDownTable(){return{rowParser:async t=>{let e=0;const a=t.map((async t=>{let a=null,r=null;if(h.isArray(t)){const[e,a]=t;if(r=e,a in this.drillDownCache)return[r,...this.drillDownCache[a].slice(1)]}else if(a=t,a in this.drillDownCache)return this.drillDownCache[a];const i=await m.findByID(a),s=await new D(a).getProgram(),o=new m(i),u=[];return r&&(e=1,u.push(r)),u.push(this.tdARV(o.getArvNumber())),u.push(l.td(this.formatGender(o.getGender()))),u.push(l.tdDate(o.getBirthdate().toString())),u.push(l.tdDate(s.startDate)),u.push(l.tdBtn("Show",(async()=>{await n.dismiss({}),this.$router.push({path:`/patient/dashboard/${a}`})}))),this.drillDownCache[a]=u,u}));return(await Promise.all(a)).sort(((t,a)=>t[e].sortValue>a[e].sortValue?1:-1))},columns:[[l.thTxt("ARV number"),l.thTxt("Gender"),l.thTxt("Birth Date"),l.thTxt("Art start date"),l.thTxt("Actions")]]}},runTableDrill(t,e="Drilldown patients"){const{columns:a,rowParser:r}=this.getDefaultDrillDownTable();this.drilldownData(e,a,t,r)},drill(t,e="Drill table"){return t&&t.length>0?l.tdLink(t.length,(()=>this.runTableDrill(t,e))):l.td(0)},getQuaterOptions:()=>s.getQuarters().map((t=>({label:t.name,value:t.start,other:t}))),getDateDurationFields(t=!1,e=!1,a=5,r=c.getSessionDate()){const i="2000-01-01";return[{id:"quarter",helpText:"Select Quarter",type:o.TT_SELECT,condition:()=>t,validation:t=>u.required(t),options:()=>{let t=s.getQuarters(a,!0).map((t=>({label:t.name,value:t.start,other:t})));return e&&(t=[{label:"Set custom period",value:"custom_period",other:{}},...t]),t}},{id:"start_date",helpText:"Start Date",type:o.TT_FULL_DATE,validation:t=>t?new Date(t.value)<new Date(i)?[`${d(`${t.value}`)} is less than minimum date of ${d(i)}`]:r&&new Date(t.value)>new Date(r)?[`${d(`${t.value}`)} is greater than max date of ${d(r)}`]:null:["Date is required"],computedValue:t=>t.value,condition:e=>e.quarter&&"custom_period"===e.quarter.value||!t},{id:"end_date",helpText:"End Date",type:o.TT_FULL_DATE,defaultValue:t=>t.start_date.value,validation:(t,e)=>t?e.start_date.value&&new Date(t.value)<new Date(e.start_date.value)?[`${d(`${t.value}`)} is less than minimum date of ${d(e.start_date.value)}`]:r&&new Date(t.value)>new Date(r)?[`${d(`${t.value}`)} is greater than max date of ${d(r)}`]:null:["Date is required"],computedValue:t=>t.label,condition:e=>e.quarter&&"custom_period"===e.quarter.value||!t},{id:"occupation",helpText:"Report Group",type:o.TT_SELECT,init:async()=>(this.isMilitarySite=await p.get("IS_MILITARY_SITE"),!0),computedValue:t=>t.value,condition:()=>"ART"===this.app?.applicationName&&this.isMilitarySite,validation:t=>u.required(t),options:()=>[{label:"All",value:"All"},{label:"Military",value:"Military"},{label:"Civilian",value:"Civilian"}]}]}}}))}}}));
