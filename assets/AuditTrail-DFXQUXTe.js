import{S as u}from"./stock_report_service-CPmNhWKA.js";import{_}from"./ReportMixin.vue_vue_type_script_lang-kdNyBZie.js";import{d as h,av as t,ai as s,aj as d,df as T,H as f,e as g,af as y,c as D,w,ak as p,a as x,b as k}from"./index-4ZhJu3VE.js";import{R as v}from"./TableReportTemplate-eWqURQFa.js";import"./BasicReportTemplate-jpe-tfW1.js";import"./Export--AC_4hfU.js";import"./index-CoZ4oawq.js";import"./Pagination-BcBM_ePe.js";import"./HisStandardForm-K1lIrz3_.js";import"./ReportErrors-COHlHjQG.js";const l={textAlign:"right",paddingRight:".5rem"},S=h({mixins:[_],components:{ReportTemplate:v},data:()=>({title:"Audit Trail",rows:[],columns:[[t.thTxt("Medication"),t.thTxt("Transaction type"),t.thTxt("Transaction date"),t.thTxt("Net Quantity",{style:l})]],fields:[{id:"start_date",helpText:"Start Date",type:s.TT_FULL_DATE,validation:e=>d.required(e),computedValue:e=>e.value},{id:"end_date",helpText:"End Date",type:s.TT_FULL_DATE,validation:e=>d.required(e),computedValue:e=>e.value}]}),methods:{async onPeriod(e,i){this.rows=[],this.report=new u,this.report.setStartDate(i.start_date),this.report.setEndDate(i.end_date),this.period=this.report.getDateIntervalPeriod(),this.report.loadTrail().then(r=>{r.forEach(a=>{this.rows.push([t.td(a.drug_name),t.td(a.transaction_type),t.tdDate(a.transaction_date),t.tdLink(T(Math.trunc(Math.abs(a.cum_per_day_stock_commited))),async()=>{const n=await this.report.getTrailDetails(a.transaction_date,a.drug_id,a.transaction_type);this.drilldownData("".concat(a.drug_name," ").concat(a.transaction_type.toLowerCase()," on ").concat(f.toStandardHisDisplayFormat(a.transaction_date)),[[t.thTxt("Product Code"),t.thTxt("Batch Number"),t.thTxt("Medication"),t.thTxt("Amount Per Unit"),t.thTxt("Total Tins/Pallets",{style:l})]],n.map(o=>[t.td(o.product_code),t.td(o.batch_number),t.td(o.drug_name),t.td(o.pack_size),t.tdNum(Math.abs(Math.trunc(o.amount_committed_to_stock/o.pack_size||1)))]),!1)},{style:{textAlign:"right",paddingRight:".5rem"}})])})}).catch(r=>{g(r)})}}});function $(e,i,r,a,n,o){const c=p("report-template"),m=p("ion-page");return x(),D(m,null,{default:w(()=>[k(c,{title:e.title,rows:e.rows,paginated:!0,period:e.period,fields:e.fields,columns:e.columns,onReportConfiguration:e.onPeriod},null,8,["title","rows","period","fields","columns","onReportConfiguration"])]),_:1})}const V=y(S,[["render",$]]);export{V as default};
