import{d as S,H as d,es as $,et as C,eu as T,aC as F,k as B,c0 as H,dF as z,q as A,y as L,s as g,z as P,aZ as V,ct as c,S as v,au as E,ak as I,ap as f,a as N,b as l,w as u,g as r,h as m,a9 as w,aa as b,t as i,j as R,aO as x,e as a}from"./index-DO7Erl4-.js";import{L as j}from"./LabOrderModal-DlqHkExb.js";import{_ as q}from"./FieldMixin.vue_vue_type_script_lang-BJNbvSBv.js";import{p as G}from"./VoidReason-Dobso7h4.js";import"./lab_order_service-B7R7GZUt.js";const M=S({components:{ViewPort:H,IonButton:B,IonIcon:F},mixins:[q],data:()=>({trash:T,print:C,pencil:$,HisDate:d,rows:[],fetchingOrders:!1,ordersToday:{}}),methods:{async init(){this.$emit("onFieldActivated",this),this.fetchingOrders=!0;let e=[];try{e=await this.options(this.fdata)}catch(t){console.error("".concat(t))}this.fetchingOrders=!1;const s=e[0].other.values;this.ordersToday=s.reduce((t,o)=>(c(o.ordered)===c(v.getSessionDate())&&!o.result.length&&(t[o.test_name]=!0),t),{}),this.rows=s.map(t=>(t.id=t.order_id,t.ordered&&(t.ordered=d.toStandardHisDisplayFormat(t.ordered)),t.released&&(t.released=d.toStandardHisDisplayFormat(t.released)),t))},async printOrder(e){var s;if(c(e.ordered)!=c(v.getSessionDate()))return g("Printing order #".concat(e.accession_number," is restricted to today. Consider using BDE mode/set session date to the order date"));typeof((s=this.config)==null?void 0:s.printOrder)=="function"&&await E("Do you want to print order with accession number ".concat(e.accession_number,"?"))&&this.config.printOrder(e.id)},formatOrders(e){return e.map(s=>({id:s.order_id,encounter_id:s.encounter_id,result_given:s.result_given,accession_number:s.accession_number,test_name:s.tests[0].name,specimen:s.specimen.name,ordered:d.toStandardHisDisplayFormat(s.order_date),result:[],release:""}))},async launchOrderSelection(e=null){if(this.fetchingOrders)return g("Please wait....");const s=await P.create({component:j,backdropDismiss:!1,cssClass:"full-modal",componentProps:{testFilters:e,ordersToday:this.ordersToday,onOrderAdded:o=>this.ordersToday[o]=!0}});s.present();const{data:t}=await s.onDidDismiss();V.isEmpty(t)||(this.rows=[...this.formatOrders(t),...this.rows])},voidOrder(e){G(async s=>{var t;new z(-1).voidOrder((t=e.id)!=null?t:e.order_id,s).then(()=>{this.rows=this.rows.filter(o=>o.order_id!=e.order_id),this.ordersToday[e.test_name]&&delete this.ordersToday[e.test_name],A("Record has been voided successfully!")}).catch(o=>{L("An error has occured while deleting order: ".concat(o))})})}},mounted(){this.init()},activated(){this.init()}}),W={class:"view-port-content"},Y={class:"his-sm-text"};function Z(e,s,t,o,J,K){const p=f("ion-icon"),_=f("ion-button"),O=f("view-port");return l(),N(O,null,{default:u(()=>[r("div",W,[r("table",Y,[s[1]||(s[1]=r("tr",null,[r("th",null,"Accession #"),r("th",null,"Test Name"),r("th",null,"Specimen"),r("th",null,"Ordered"),r("th",null,"Result"),r("th",null,"Released"),r("th",null,"Given"),r("th",null,"Action")],-1)),(l(!0),m(w,null,b(e.rows,(n,k)=>{var y;return l(),m("tr",{key:k},[r("td",null,i(n.accession_number),1),r("td",null,i(n.test_name),1),r("td",null,i(n.specimen),1),r("td",null,i(n.ordered),1),r("td",null,[(l(!0),m(w,null,b(n.result,(h,D)=>(l(),m("span",{key:D},[R(i(h)+" ",1),s[0]||(s[0]=r("br",null,null,-1))]))),128))]),r("td",null,i(n.released),1),r("td",null,[r("span",{style:x("color: ".concat(n.result_given==="Yes"?"green;":"black;"))},i(n.result_given),5)]),r("td",null,[a(_,{onClick:h=>e.printOrder(n)},{default:u(()=>[a(p,{size:"large",icon:e.print},null,8,["icon"])]),_:1},8,["onClick"]),a(_,{disabled:n.delivery_mode?n.delivery_mode!="test_results_delivered_to_site_manually":!1,color:"success"},{default:u(()=>[a(p,{size:"large",icon:e.pencil},null,8,["icon"])]),_:1},8,["disabled"]),a(_,{disabled:n.delivery_mode!="test_results_delivered_to_site_manually"&&((y=n.result)!=null?y:[]).length>=1,onClick:h=>e.voidOrder(n),color:"danger"},{default:u(()=>[a(p,{size:"large",icon:e.trash},null,8,["icon"])]),_:1},8,["disabled","onClick"])])])}),128))])])]),_:1})}const te=I(M,[["render",Z],["__scopeId","data-v-088bf15a"]]);export{te as default};
