System.register(["./index-legacy-DJWxguzi.js","./HisStandardForm-legacy-D7rv7-DX.js","./EncounterMixin.vue_vue_type_script_lang-legacy-DGEq_8IY.js","./appointment_service-legacy-zLThFTOs.js","./encounter_guidelines-legacy-DE28aNqS.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(t,e){"use strict";var a,i,n,o,s,l,d,p,r,c,u,m,y,h,w,g;return{setters:[t=>{a=t.d,i=t.bo,n=t.t,o=t.ad,s=t.ak,l=t.dj,d=t.H,p=t.bC,r=t.ae,c=t.aa,u=t.c,m=t.af,y=t.a},t=>{h=t.H},t=>{w=t._},t=>{g=t.A},null,null],execute:function(){const e=a({mixins:[w],components:{HisStandardForm:h},data:()=>({appointment:{}}),watch:{ready:{handler(t){t&&(this.appointment=new g(this.patientID,this.providerID),this.fields=[this.getAppointmentField()])},immediate:!0}},methods:{async onFinish(t,e){await this.appointment.createEncounter(),await this.appointment.saveObservationList(await this.resolveObs(e)),["CxCa","ANC"].includes(`${i.getActiveApp()?.applicationName}`)||await n(this.patientID),this.nextTask()},getAppointmentField(){const t=(t,e)=>new RegExp(t,"i").test(`${e}`);let e="",a="",n=-1,c=this.appointment.date,u=null;const m={},y=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return{id:"set_appointment",helpText:"Appointments booking",type:o.TT_DATE_PICKER,init:async()=>{try{const t=await this.appointment.getNextAppointment();c=t.appointment_date,u=t.drugs_run_out_date}catch(i){if(console.error(i),!(await s("Next appointment/drug-runout date is not available, do you want to proceed anyway?")))return this.gotoPatientDashboard(),!0}const t=await l.appointmentLimit();return a=await l.clinicHolidays(),e=this.patient.getAge()>=18?await l.adultClinicDays():await l.peadsClinicDays(),n=t?parseInt(t):0,!0},onValue:async i=>{const o=d.toStandardHisDisplayFormat(i),l=p(u).diff(i,"days");if(u&&l>7&&!(await s(`\n              The selected appointment date ${o} is ${l} days earlier than the drug run-out date \n              ${d.toStandardHisDisplayFormat(u)}. \n              The client will have excess medication. \n              Do you want to proceed?\n            `)))return!1;if(m[i]??=(await g.getDailiyAppointments(i)).length,c!==i){if(n>=1&&m[i]>=n&&await s(`${m[i]} clients were booked on ${o}`,{header:`APPOINTMENT LIMIT (${n}) REACHED`,cancelBtnLabel:"Proceed",confirmBtnLabel:"New date"}))return!1;if(t(i,a)&&!(await s(`${o} is a clinic holiday, do you want to set an appointment?`)))return!1;if(!t(y[p(i).day()],e)&&!(await s(`${o} is not a clinic day. Do you want to proceed with this date?`)))return!1}return!0},validation:t=>r.required(t),defaultValue:()=>c,computedValue:t=>[this.appointment.buildValueDate("Appointment date",t),this.appointment.buildValueDate("Estimated date",c)],config:{hiddenFooterBtns:["Clear"],minDate:()=>this.appointment.date,maxDate:()=>u,supValue:t=>`${m[t]}`,infoItems:t=>"CxCa"===i.getActiveApp()?.applicationName?[{label:"User set appointment date",value:d.toStandardHisDisplayFormat(t)},{label:"Appointments",value:m[t]},{label:"Appointment limit (per/day)",value:n}]:[{label:"Medication Run out Date",value:u?d.toStandardHisDisplayFormat(u):"Not available"},{label:"User set appointment date",value:d.toStandardHisDisplayFormat(t)},{label:"Appointments",value:m[t]},{label:"Appointment limit (per/day)",value:n}]}}}}});t("default",c(e,[["render",function(t,e,a,i,n,o){const s=m("his-standard-form");return y(),u(s,{fields:t.fields,onFinishAction:t.onFinish,skipSummary:!0,cancelDestinationPath:t.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}]]))}}}));
