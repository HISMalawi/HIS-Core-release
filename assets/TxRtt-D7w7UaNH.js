import{d as T,I as y,c4 as A,K as h,N as $,a9 as B,t as x,ab as C,c5 as E,O as c,q as I,c6 as k,c7 as q,_ as N,r as v,o as O,c as S,w as j,b as w}from"./index-BCfs_J-V.js";import{D as U}from"./ReportDateSelectionPrompt-zopuG9Jo.js";import{T as L}from"./tx_report_service-Chxgcnmu.js";import{v as G}from"./TableView-X9MYPuEw.js";import{A as P}from"./ArtDrilldown-C5dit571.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./MultiFieldDateHelper-CW6lfYIk.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./PopupKeyboard-Bx5PomGA.js";import"./SIngleTouchField-UCxZk0Bs.js";import"./TouchScreenForm-BEQyavf9.js";import"./ToolbarMediumCard-DFqt8bLl.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-CUJ1kut7.js";import"./HisKeypad-CauGNmga.js";import"./BaseKeyboard-CkKhN4kf.js";import"./KbHandler-BuQ4TFU6.js";import"./fuse-YdZE3OCN.js";import"./Export-Ckt7Z8Mq.js";import"./HisKeyboard-B8ZXu_Kp.js";const V=T({components:{IonPage:y,IonLoading:A,v2Datatable:G},setup(){const t=h([]),d=h(""),m=h(!1),p=h([]),r=new L;function n(s,u){return{ref:u,label:s,toValue:e=>e.length,tdClick:async e=>{e.refData.length&&(await c.create({component:P,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"".concat(e.data.age_group," ").concat(e.data.gender," ").concat(e.column.label),patientIdentifiers:e.refData,onFinish:()=>c.getTop().then(l=>l&&c.dismiss())}})).present()}}}const b=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},n("CD4 <200","cd4_less_than_200"),n("CD4 >=200","cd4_greater_than_or_equal_to_200"),n("Unknown CD4","unknown_cd4_count"),n("Not Eligible for CD4","not_eligible_for_cd4"),n("Returned <3 mo","returned_less_than_3_months"),n("Returned 3-5 mo","returned_greater_than_3_months_and_less_than_6_months"),n("Returned 6+ mo","returned_greater_than_or_equal_to_6_months")]],_=async()=>{r.startDate&&r.endDate||x("Start date and end date required!"),m.value=!0;try{const s=await r.getTxRttReport(),u={F:"Female",M:"Male"},e=s.reduce((o,a)=>(a.age_group!="Unknown"&&(o[a.gender].rows.push({...a,gender:u[a.gender]}),o[a.gender].aggregate=Object.keys(a).reduce((g,i)=>Array.isArray(a[i])?{...g,[i]:[...g[i]||[],...a[i]]}:g,o[a.gender].aggregate)),o),{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});t.value=[...e.F.rows,...e.M.rows,{age_group:"All",gender:"Male",...e.M.aggregate}];const l=Object.values(e.F.aggregate).flat(1),D=await r.getMaternalStatus(C.uniq(l)),R=D.FBf.concat(D.FP);["FP","FNP","FBf"].forEach(o=>{t.value.push(Object.keys(e.F.aggregate).reduce((a,g)=>({...a,[g]:e.F.aggregate[g].filter(i=>o==="FNP"?!R.includes(i):D[o].includes(i))}),{age_group:"All",gender:o}))}),t.value=t.value.map((o,a)=>({index:a+1,...o}));const M=Object.values(e.M.aggregate).flat(1),F=C.uniq([...l,...M]);p.value=[{id:"stats",text:"Total <b>".concat(F.length,"</b>"),icon:E,color:"primary",action:async()=>{(await c.create({component:P,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"Total Clients",subtitle:d.value,patientIdentifiers:F,onFinish:()=>c.getTop().then(o=>o&&c.dismiss())}})).present()}}]}catch(s){console.error(s),I("Unable to generate report!"),p.value=[{text:"Unable to generate report!",color:"danger",icon:k,action:function(){p.value=[{text:"Exception occured: <b>".concat(s,"</b>"),color:"danger",icon:q}]}}]}m.value=!1},f=()=>U({onFinish:(s,u,e,l)=>{d.value=e,r.startDate=s,r.endDate=u,l&&r.setOccupation(l),_()}});return $(()=>f()),{headerBadge:p,reportData:t,isLoading:m,Img:B,configure:f,generate:_,columns:b,period:d}}});function K(t,d,m,p,r,n){const b=v("ion-loading"),_=v("v2Datatable"),f=v("ion-page");return O(),S(f,null,{default:j(()=>[w(b,{"is-open":t.isLoading,message:"Please wait..."},null,8,["is-open"]),w(_,{title:"TX RTT Report","report-prefix":"Pepfar","icon-url":t.Img("login-logos/PEPFAR.png"),subtitle:t.period,columns:t.columns,columnData:t.reportData,rowsPerPage:100,headerBadge:t.headerBadge,onConfigure:t.configure,onRefresh:()=>t.generate()},null,8,["icon-url","subtitle","columns","columnData","headerBadge","onConfigure","onRefresh"])]),_:1})}const de=N(V,[["render",K]]);export{de as default};
