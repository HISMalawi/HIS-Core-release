System.register(["./index-legacy-BdKNvy0b.js","./FieldMixin.vue_vue_type_script_lang-legacy-PfGcm8wg.js","./BaseTextInput-legacy-an1E8-0Y.js"],(function(e,t){"use strict";var l,a,i,s,u,n,r,d,o,c,h,g,p,f,y,b,m,_,D,v,k,x,T,E,S,z,C,V,w,N,I,B,P,$,M,A;return{setters:[e=>{l=e.d,a=e.bm,i=e.bl,s=e.D,u=e.g,n=e.h,r=e.ap,d=e.ar,o=e.aq,c=e.f,h=e.S,g=e.cB,p=e.ct,f=e.ae,y=e.$,b=e.O,m=e.F,_=e.V,D=e.dd,v=e.H,k=e.b3,x=e.cH,T=e._,E=e.r,S=e.o,z=e.c,C=e.w,V=e.b,w=e.x,N=e.B,I=e.y,B=e.u,P=e.v,$=e.z},e=>{M=e._},e=>{A=e.default}],execute:function(){var t=document.createElement("style");t.textContent="ion-label[data-v-e9c2b14d]{font-weight:700}.border-right[data-v-e9c2b14d]{border-right:solid 1px #ccc}.scroll-list[data-v-e9c2b14d]{height:70vh;overflow:auto}.input_display[data-v-e9c2b14d]{font-size:1.3em}\n",document.head.appendChild(t);const F=l({components:{HisTextInput:A,ViewPort:a,IonInput:i,IonLabel:s,IonList:u,IonItem:n,IonGrid:r,IonCol:d,IonRow:o,IonButton:c},mixins:[M],data:()=>({drugs:[],allDrugsByName:[],selectedDrug:null,entryDate:h.getSessionDate()}),mounted(){this.init()},async activated(){this.init()},methods:{fmtNumber:e=>g(e),fmtDate:e=>p(e),async init(){this.$emit("onFieldActivated",this),await this.setDefaultValue()},async setDefaultValue(){const e=await this.options();this.drugs=this.drugs.filter((t=>e.map((e=>e.label)).includes(t.label))),e.forEach((e=>{const t={tabs:null,tins:null,expiry:null,batchNumber:null},l={label:e.label,entries:[{...t},{...t},{...t}],...e.value};f.find(this.drugs,{label:e.label})||this.drugs.push(l)})),this.drugs.length>=1&&this.selectDrug(0),"function"==typeof this.config.entryDate&&(this.entryDate=this.config.entryDate(this.fdata,this.cdata))},getModalTitle(e){return`${e} (${this.drugs[this.selectedDrug].short_name})`},getDrugValue(e,t){return this.drugs[this.selectedDrug].entries[e][t]},setDrugValue(e,t,l){this.drugs[this.selectedDrug].entries[e][t]=l?l.value:""},useCustomPackSize(e){return f.isEmpty(this.packSizes)||e.standard_pack_size.label.includes("Other")},async selectPackSize(e){await y([{id:"standard_pack_size",helpText:"Select Pack Size",type:m.TT_SELECT,condition:()=>!f.isEmpty(this.packSizes),defaultValue:()=>this.getDrugValue(e,"tabs"),options:()=>[...this.packSizes.map((e=>({label:`${e}`,value:e}))),{label:"Other (specify)",value:"Other"}]},{id:"custom_pack_size",helpText:"Input quantity",type:m.TT_NUMBER,defaultValue:()=>this.getDrugValue(e,"tabs"),validation:e=>_.required(e),condition:e=>this.useCustomPackSize(e),config:{showKeyboard:!0}}],(async t=>{this.setDrugValue(e,"tabs",this.useCustomPackSize(t)?t.custom_pack_size:t.standard_pack_size),await b.dismiss()}))},enterTins(e){D({id:"tins",helpText:this.getModalTitle("Enter number of tins/pallets"),type:m.TT_NUMBER,defaultValue:()=>this.getDrugValue(e,"tins"),validation:e=>!e||e&&!e.value?null:_.validateSeries([()=>_.isNumber(e),()=>e.value<=0?["Number of tins must be greater than 1"]:null])},(t=>this.setDrugValue(e,"tins",t)))},enterBatch(e){D({id:"batch",helpText:this.getModalTitle("Enter batch number"),type:m.TT_TEXT,config:{initialkb:"qwerty"},defaultValue:()=>this.getDrugValue(e,"batchNumber")},(t=>{const l={...t},a=`${l.value}`.toUpperCase();l.label=a,l.value=a,this.setDrugValue(e,"batchNumber",l)}))},enterExpiry(e){D({id:"expiry",helpText:this.getModalTitle("Enter expiry date")+` (Delivery Date: ${v.toStandardHisDisplayFormat(this.entryDate)})`,type:m.TT_FULL_DATE,defaultValue:()=>this.getDrugValue(e,"expiry"),validation:e=>{if(e&&e.value)return k(e.value).isBefore(k(this.entryDate).add(30,"day"))?["You are not allowed to enter drugs that are expiring within the next 30 days from the delivery date"]:null}},(t=>this.setDrugValue(e,"expiry",t)))},addRow(){this.drugs[this.selectedDrug].entries.push({tabs:null,tins:null,expiry:null,batchNumber:null})},selectDrug(e){this.selectedDrug=e},validateEntry:e=>!(f.isEmpty(e.tins)||f.isEmpty(e.expiry)||f.isEmpty(e.batchNumber)||f.isEmpty(e.tabs.toString()))},computed:{packSizes(){return null===this.selectedDrug?[]:x.getPackSizes(this.drugs[this.selectedDrug].drug_inventory_id)},fullSelectedDrugName(){try{return this.drugs[this.selectedDrug].fullName}catch(e){return"N/A"}},enteredDrugs(){const e=[];return this.drugs.forEach((t=>{t.entries.filter((e=>this.validateEntry(e))).forEach((l=>{e.push({label:t.short_name,value:{...t,...l,tabs:l.tabs}})}))})),e}},watch:{clear(){this.drugs=this.drugs.map((e=>(e.entries=e.entries.map((e=>(e.tins=null,e.expiry=null,e.batchNumber=null,e))),e)))},drugs:{handler(){this.$emit("onValue",this.enteredDrugs)},immediate:!0,deep:!0}}});e("default",T(F,[["render",function(e,t,l,a,i,s){const u=E("his-text-input"),n=E("ion-item"),r=E("ion-list"),d=E("ion-col"),o=E("ion-label"),c=E("ion-input"),h=E("ion-row"),g=E("ion-button"),p=E("ion-grid"),f=E("view-port");return S(),z(f,null,{default:C((()=>[V(u,{readonly:"",value:e.fullSelectedDrugName},null,8,["value"]),V(p,{style:{background:"white"}},{default:C((()=>[V(h,null,{default:C((()=>[V(d,{size:"4",class:"border-right scroll-list"},{default:C((()=>[(S(!0),w(N,null,I(e.drugs,((t,l)=>(S(),z(r,{key:l},{default:C((()=>[V(n,{detail:"",color:l===e.selectedDrug?"secondary":"",onClick:t=>e.selectDrug(l)},{default:C((()=>[B(P(`${t.short_name} (${t.code})`),1)])),_:2},1032,["color","onClick"])])),_:2},1024)))),128))])),_:1}),V(d,null,{default:C((()=>[null!==e.selectedDrug?(S(),z(p,{key:0,class:"scroll-list"},{default:C((()=>[(S(!0),w(N,null,I(e.drugs[e.selectedDrug].entries,((t,l)=>(S(),z(h,{key:l},{default:C((()=>[V(d,null,{default:C((()=>[V(n,null,{default:C((()=>[V(o,{position:"floating"},{default:C((()=>[B("Pack Size")])),_:1}),V(c,{readonly:"",placeholder:"0",value:e.fmtNumber(t.tabs),onClick:t=>e.selectPackSize(l)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024),V(d,null,{default:C((()=>[V(n,null,{default:C((()=>[V(o,{position:"floating"},{default:C((()=>[B("Tins/Pallets")])),_:1}),V(c,{readonly:"",placeholder:"0",value:e.fmtNumber(t.tins),onClick:t=>e.enterTins(l)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024),V(d,null,{default:C((()=>[V(n,null,{default:C((()=>[V(o,{position:"floating"},{default:C((()=>[B("Expiry Date")])),_:1}),V(c,{readonly:"",placeholder:"DD/MM/YYYY",value:e.fmtDate(t.expiry),onClick:t=>e.enterExpiry(l)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024),V(d,null,{default:C((()=>[V(n,null,{default:C((()=>[V(o,{position:"floating"},{default:C((()=>[B("Batch Number")])),_:1}),V(c,{readonly:"",placeholder:"e.g. 'ABC-123'",value:t.batchNumber,onClick:t=>e.enterBatch(l)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),V(h,null,{default:C((()=>[V(d,null,{default:C((()=>[V(g,{onClick:e.addRow,siz:"large"},{default:C((()=>[B("Add row")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):$("",!0)])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-e9c2b14d"]]))}}}));
