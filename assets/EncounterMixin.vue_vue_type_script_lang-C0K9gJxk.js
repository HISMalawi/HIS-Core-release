import{d as c,T as l,ae as u,q as d,aP as p,p as m}from"./index-DsVZSn5I.js";import{F as o,E as D}from"./encounter_guidelines-CYP5Ifi5.js";import{m as f}from"./GuidelineEngine-D6V1_Znr.js";import{H as E}from"./HisStandardForm-CBASeHGe.js";const _=c({components:{HisStandardForm:E},data:()=>({patient:{},fields:[],patientID:"",providerID:-1,providers:[],facts:{sessionDate:"",apiDate:"",encounterName:"N/A",providers:[],isBdeMode:!1,birthDate:"",outcome:"",outcomeStartDate:""},ready:!1}),watch:{$route:{handler(t){t.params.patient_id&&this.patientID!=t.params.patient_id&&(this.patientID=parseInt(t.params.patient_id),l.get("ACTIVE_PATIENT",{patientID:this.patientID}).then(e=>{this.patient=e,this.setEncounterFacts().then(()=>{this.checkEncounterGuidelines().then(()=>{this.ready=!0})})}))},immediate:!0,deep:!0}},computed:{cancelDestination(){return this.patientDashboardUrl()}},methods:{runflowState(t,e=null){const s={};if(s[o.SET_PROVIDER]=r=>{const[a]=r.split(" "),i=u.find(this.providers,{username:a});return i&&(this.providerID=i.person_id),o.CONTINUE},s[o.CHANGE_SESSION_DATE]=()=>(this.$router.push("/session/date?patient_dashboard_redirection_id=".concat(this.patientID)),o.EXIT),s[o.CHANGE_PATIENT_OUTCOME]=()=>(this.$router.push("/patient/programs/".concat(this.patientID)),o.EXIT),s[o.GO_TO_PATIENT_DASHBOARD]=()=>(this.gotoPatientDashboard(),o.EXIT),t in s)return s[t](e)},async checkEncounterGuidelines(){var e,s,r,a;const t=f(this.facts,D);for(const i in t){const n=t[i];if((e=n==null?void 0:n.actions)!=null&&e.alert&&this.runflowState(await((s=n==null?void 0:n.actions)==null?void 0:s.alert(this.facts)))===o.EXIT)return;if((r=n==null?void 0:n.actions)!=null&&r.selection){const h=await((a=n==null?void 0:n.actions)==null?void 0:a.selection(this.facts));this.runflowState(h.flowState,h.value)}}},async setEncounterFacts(){try{const t=await l.get("PATIENT_PROGRAM",{patientID:this.patientID});this.facts.outcome=t.outcome,this.facts.outcomeStartDate=t.startDate}catch(t){console.error(t),d("".concat(t))}if(this.facts.sessionDate=p.getSessionDate(),this.facts.apiDate=p.getCachedApiDate(),this.facts.isBdeMode=p.isBDE(),this.facts.birthDate=this.patient.getBirthdate(),this.facts.encounterName=this.$route.name?this.$route.name.toString().toUpperCase():"N/A",p.isBDE()){this.providers=await l.get("PROVIDERS");const t=u.find(this.providers,s=>s.user_id==p.getUserID());this.providers=this.providers.sort((s,r)=>{const a=s.username.toUpperCase(),i=r.username.toUpperCase();return a<i?-1:a>i?1:0});const e=t?[t,...this.providers]:this.providers;this.facts.providers=u.uniq(e.map(s=>{var a,i;let r="".concat(s.username);if(!u.isEmpty((a=s==null?void 0:s.person)==null?void 0:a.names)){const[n]=((i=s.person)==null?void 0:i.names)||[];r+=" (".concat(n.given_name," ").concat(n.family_name,")")}return r}))}},toOption(t,e={}){return{label:t,value:t,other:e}},mapStrToOptions(t){return t.map(e=>({label:e,value:e}))},patientDashboardUrl(){return"/patient/dashboard/".concat(this.patientID)},gotoPatientDashboard(){return this.$router.push({path:this.patientDashboardUrl()})},nextTask(){return m(this.patientID,this.$router)},yesNoOptions(){return[{label:"Yes",value:"Yes"},{label:"No",value:"No"}]},toYesNoOption(t,e={}){return{label:t,value:"",other:{...e,values:this.yesNoOptions()}}},mapOptions(t){return t.map(e=>({label:e,value:e}))},yesNoUnknownOptions(){return[{label:"Yes",value:"Yes"},{label:"No",value:"No"},{label:"Unknown",value:"Unknown"}]},resolveData(t,e){return Object.keys(t).reduce((s,r)=>{var a;return u.isPlainObject(t[r])&&((a=t[r])!=null&&a[e])?Array.isArray(t[r][e])?[...t[r][e],...s]:[...s,t[r][e]]:s},[])},resolveObs(t,e=""){const s=Object.values(t).filter(r=>r&&(r.tag===e||e==="")).reduce((r,a)=>{const i=a.obs?a.obs:a;return Array.isArray(i)?r=r.concat(i):typeof i=="function"?r.push(i()):r.push(i),r},[]);return Promise.all(s)},inArray(t,e){try{return t.filter(s=>e(s)).length>0}catch(s){return!1}},validateSeries(t){try{for(const e in t){const s=t[e]();if(s)return s}}catch(e){return[e]}},buildDateObs(t,e,s,r){return s?r.buildValueDateEstimated(t,e):r.buildValueDate(t,e)}}});export{_};
