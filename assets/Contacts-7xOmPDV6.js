import{d as C,K as h,p as f,ag as l,V as P,o as $,c as A,w as D,b as N,cl as _,a$ as g,aX as R,d0 as S,I}from"./index-BCTN_bnC.js";import{F as y}from"./dynamic-import-helper-BkBZiFw5.js";import{H as V}from"./HisStandardForm-CaDwl-hA.js";import{u as B}from"./useEncounter-CDUT-p5Y.js";import{P as s}from"./PersonFieldHelper-D6pvbapr.js";import{g as E}from"./MultiFieldDateHelper-CQ4seieZ.js";import{R as v}from"./relations_service-N5x4pwko.js";import{p as G}from"./VoidReason-BtkcYhr4.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./isEmpty-OXtHK5dz.js";import"./_Set-VKtKUQAI.js";import"./_setToArray-BLmuRUHx.js";import"./encounter_guidelines-DZpIPlYY.js";import"./GuidelineEngine-D6V1_Znr.js";import"./LocationFieldOptions-CfAZbPnk.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";const ie=C({__name:"Contacts",setup(k){const c=h([]),p=h();function b(t){const n=g(),a=g(t),o=n.diff(a,"year"),e=n.diff(a.add(o,"year"),"month"),i=n.diff(a.add(o,"year").add(e,"month"),"day");return o>0?"".concat(o," year").concat(o>1?"s":""," old"):e>0?"".concat(e," month").concat(e>1?"s":""," old"):"".concat(i," day").concat(i>1?"s":""," old")}const{patientDashboardUrl:m,patientId:F}=B((t,n,a)=>{p.value=a;const o=()=>{let e={},i=[];return{id:"contacts",helpText:"Contacts",type:y.TT_TABLE_VIEWER,onload:d=>e=d,init:async()=>(i=await a.getGuardian(),!0),options:()=>{const d=i.map(r=>["".concat(r.relation.names[0].given_name," ").concat(r.relation.names[0].family_name),r.relation.gender==="M"?"Male":"Female",b(r.relation.birthdate),{name:"Screen",type:"button",action:()=>f(r.relation.person_id,l)},{id:r.relationship_id,name:"Void",type:"button",color:"danger",action:()=>G(async x=>{await v.voidRelation(n,r.relationship_id,x),e.rows=e.rows.filter(u=>u[u.length-1].id!=r.relationship_id)})}]);return[{label:"",value:"",other:{columns:["Name","Gender","Age","Screen","Void"],rows:d}}]},config:{overrideDefaultFooterBtns:{nextBtn:{name:"Add contact"}}}}};c.value=[o(),s.getGivenNameField(),s.getFamilyNameField(),s.getGenderField(),...E(s.getDobConfig()),s.getCellNumberField(),{id:"action",helpText:"Next step:",type:y.TT_SELECT,requireNext:!1,validation:e=>P.required(e),options:()=>[{label:"Add another contact",value:1,other:{action:()=>location.reload()}},{label:"Proceed to diagnosis",value:2,other:{action:e=>f(e,l)}},{label:"Go to dashboard",value:3,other:{action:()=>l.push(m.value)}}]}]});function T(){const t=p.value.patient;return{home_district:t.person.addresses[0].address2,current_district:t.person.addresses[0].state_province,current_village:t.person.addresses[0].city_village,current_traditional_authority:t.person.addresses[0].township_division,home_village:t.person.addresses[0].neighborhood_cell,home_traditional_authority:t.person.addresses[0].county_district}}async function w(t,n){var e,i;const a=new R,o={...T(),...s.resolvePerson(n)};await a.createPerson(o),await a.createPatient(),await v.createRelation(F.value,a.personId,S.TB_CONTACT),typeof((i=(e=t.action)==null?void 0:e.other)==null?void 0:i.action)=="function"&&t.action.other.action(a.personId)}return(t,n)=>($(),A(_(I),null,{default:D(()=>[N(V,{cancelDestinationPath:_(m),onFinishAction:w,fields:c.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{ie as default};
