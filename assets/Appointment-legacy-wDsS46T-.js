System.register(["./index-legacy-CA6M7ipO.js","./HisStandardForm-legacy-a9YJRGaH.js","./useEncounter-legacy-CgHUO1ZL.js","./commons-legacy-BqS3TQTP.js","./appointment_service-legacy-C2qV7ECG.js","./isEmpty-legacy-cRrH0Hs5.js","./encounter_guidelines-legacy-Bcz_Mw7r.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,n,i,o,l,s,r,u,d,p,c,m,_,g,T,y,D,I,b,A,v,E,f,w,N;return{setters:[e=>{a=e.d,n=e.r,i=e.bQ,o=e.bV,l=e.ad,s=e.ab,r=e.e3,u=e.ae,d=e.d$,p=e.ci,c=e.a,m=e.c,_=e.w,g=e.b,T=e.u,y=e.bU,D=e.bA,I=e.e0,b=e.W,A=e.e7,v=e.I},e=>{E=e.H},e=>{f=e.u},e=>{w=e.r},e=>{N=e.A},null,null,null],execute:function(){e("default",a({__name:"Appointment",setup(e){const t=n([]),a=new i(-1,o.APPOINTMENT);let h=0;const{goToNextTask:P,patientDashboardUrl:j}=f(((e,n)=>{a.patientID=n,a.providerID=e,h=n,t.value=[(()=>{let e={},t=-1;const i={};return{id:"appointment",helpText:"Appointment booking",type:l.TT_DATE_PICKER,init:async()=>(t=await s.get(r.CLINIC_APPOINTMENT_LIMIT),e=await N.getJson(`programs/${a.programID}/patients/${n}/next_appointment_date`,{date:a.date}),!0),defaultValue:()=>e?.appointment_date,validation:e=>u.required(e),computedValue:t=>[{concept_id:d("APPOINTMENT_DATE"),value_datetime:t,obs_datetime:a.date},{concept_id:d("ESTIMATED_DATE"),value_datetime:e?.appointment_date,obs_datetime:a.date}],config:{minDate:()=>a.date,maxDate:()=>e?.drugs_run_out_date,supValue:e=>`${(i[e]||[]).length}`,infoItems:async n=>(i[n]||(i[n]=await N.getJson(`programs/${a.programID}/booked_appointments`,{date:n,paginate:!1})),[{label:"Medication Run out Date",value:p(e?.drugs_run_out_date||"Not available")},{label:"User set appointment date",value:p(n)},{label:"Appointments",value:(i[n]||[]).length},{label:"Appointment limit (per/day)",value:t||"N/A"}]),hiddenFooterBtns:["Clear"]}}})()]}));async function S(e,t){if(await a.createEncounter(),await a.saveObservationList(await w(t)),await y.shouldTransferToExternalFacility(a.patientID)){const e=new D(a.patientID);e.setStateDate(a.date),e.setStateId(I.TRANSFER_OUT);try{await e.updateState()}catch(n){b("Failed to transfer out patient, please do it manually for now."),console.error(n)}}await A(a.patientID),P()}return(e,a)=>(c(),m(T(v),null,{default:_((()=>[g(E,{cancelDestinationPath:T(j),onFinishAction:S,fields:t.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
