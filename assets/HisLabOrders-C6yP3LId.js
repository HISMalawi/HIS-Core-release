import{d as $,bO as C,a3 as S,aX as E,e8 as B,e9 as T,ea as F,ag as d,cO as c,aj as v,O as y,ad as z,aq as A,aJ as H,bi as V,K as I,ah as L,a6 as N,ab as f,u as l,v as P,w as u,G as r,B as m,E as b,C as w,Z as o,z as R,aE as x,x as a}from"./index-NAoeW21C.js";import{L as G}from"./LabOrderModal-D8Zu_yXg.js";import{_ as j}from"./FieldMixin.vue_vue_type_script_lang-qPXmBOyT.js";import{p as q}from"./VoidReason-_6eT8YPT.js";import"./lab_order_service-BVnvbLsT.js";const J=$({components:{ViewPort:C,IonButton:S,IonIcon:E},mixins:[j],data:()=>({trash:B,print:T,pencil:F,HisDate:d,rows:[],fetchingOrders:!1,ordersToday:{}}),methods:{async init(){this.$emit("onFieldActivated",this),this.fetchingOrders=!0;let t=[];try{t=await this.options(this.fdata)}catch(s){console.error("".concat(s))}this.fetchingOrders=!1;const e=t[0].other.values;this.ordersToday=e.reduce((s,i)=>(c(i.ordered)===c(v.getSessionDate())&&!i.result.length&&(s[i.test_name]=!0),s),{}),this.rows=e.map(s=>(s.id=s.order_id,s.ordered&&(s.ordered=d.toStandardHisDisplayFormat(s.ordered)),s.released&&(s.released=d.toStandardHisDisplayFormat(s.released)),s))},async printOrder(t){var e;if(c(t.ordered)!=c(v.getSessionDate()))return y("Printing order #".concat(t.accession_number," is restricted to today. Consider using BDE mode/set session date to the order date"));typeof((e=this.config)==null?void 0:e.printOrder)=="function"&&await z("Do you want to print order with accession number ".concat(t.accession_number,"?"))&&this.config.printOrder(t.id)},formatOrders(t){return t.map(e=>({id:e.order_id,encounter_id:e.encounter_id,result_given:e.result_given,accession_number:e.accession_number,test_name:e.tests[0].name,specimen:e.specimen.name,ordered:d.toStandardHisDisplayFormat(e.order_date),result:[],release:""}))},async launchOrderSelection(t=null){if(this.fetchingOrders)return y("Please wait....");const e=await A.create({component:G,backdropDismiss:!1,cssClass:"large-modal",componentProps:{testFilters:t,ordersToday:this.ordersToday,onOrderAdded:i=>this.ordersToday[i]=!0}});e.present();const{data:s}=await e.onDidDismiss();H.isEmpty(s)||(this.rows=[...this.formatOrders(s),...this.rows])},voidOrder(t){q(async e=>{V.voidEncounter(t.encounter_id,e).then(()=>{this.rows=this.rows.filter(s=>s.encounter_id!=t.encounter_id),I("Record has been voided successfully!")}).catch(s=>{L("An error has occured while deleting order: ".concat(s))})})}},mounted(){this.init()},activated(){this.init()}}),K={class:"view-port-content"},M={class:"his-sm-text"};function W(t,e,s,i,X,Y){const p=f("ion-icon"),h=f("ion-button"),O=f("view-port");return l(),P(O,null,{default:u(()=>[r("div",K,[r("table",M,[e[1]||(e[1]=r("tr",null,[r("th",null,"Accession #"),r("th",null,"Test Name"),r("th",null,"Specimen"),r("th",null,"Ordered"),r("th",null,"Result"),r("th",null,"Released"),r("th",null,"Given"),r("th",null,"Action")],-1)),(l(!0),m(b,null,w(t.rows,(n,D)=>{var g;return l(),m("tr",{key:D},[r("td",null,o(n.accession_number),1),r("td",null,o(n.test_name),1),r("td",null,o(n.specimen),1),r("td",null,o(n.ordered),1),r("td",null,[(l(!0),m(b,null,w(n.result,(_,k)=>(l(),m("span",{key:k},[R(o(_)+" ",1),e[0]||(e[0]=r("br",null,null,-1))]))),128))]),r("td",null,o(n.released),1),r("td",null,[r("span",{style:x("color: ".concat(n.result_given==="Yes"?"green;":"black;"))},o(n.result_given),5)]),r("td",null,[a(h,{onClick:_=>t.printOrder(n)},{default:u(()=>[a(p,{size:"large",icon:t.print},null,8,["icon"])]),_:2},1032,["onClick"]),a(h,{disabled:n.delivery_mode?n.delivery_mode!="test_results_delivered_to_site_manually":!1,color:"success"},{default:u(()=>[a(p,{size:"large",icon:t.pencil},null,8,["icon"])]),_:2},1032,["disabled"]),a(h,{disabled:((g=n.result)!=null?g:[]).length,onClick:_=>t.voidOrder(n),color:"danger"},{default:u(()=>[a(p,{size:"large",icon:t.trash},null,8,["icon"])]),_:2},1032,["disabled","onClick"])])])}),128))])])]),_:1})}const te=N(J,[["render",W],["__scopeId","data-v-f918568f"]]);export{te as default};
