import{d as v,r,H as g,o as D,D as _,a as h,b as y,w as C,e as w,f as p,x as V,n as A,U as S}from"./index-SU-Girx6.js";import{v as $}from"./TableView-CuKH2law.js";import{s as x,w as P}from"./v2utils--Dezgu0T.js";import"./Export-DfsAiS0C.js";import"./index-DsYrnnJ9.js";const M=v({__name:"SystemAudits",setup(k){const n=r([]),s=r(""),u=r(""),i=r(""),d=V("reports.png"),f=[[{label:"Encounter",ref:"auditable_type"},{label:"Action Type",ref:"action"},{label:"User",ref:"user",toValue:e=>e?"".concat(e.username," (").concat(e.name,")"):""},{label:"Timestamp",ref:"created_at",toValue:g.toStandardHisDisplayFormat},{label:"Changes",ref:"changes",toValue:e=>{var t;return(t=e==null?void 0:e.length)!=null?t:0},tdClick:async e=>{const t=[[{label:"Attribute",ref:"attribute"},{label:"Previous Value",ref:"previous"},{label:"Current Value",ref:"current"}]],l=e.data.changes.map(o=>{const[a,b]=Object.entries(o)[0]||[];return a?/password/i.test(a)?{attribute:a,previous:"*******",current:"*******"}:{attribute:a,...b}:null}).filter(o=>o!==null);await x({title:"Changes made by ".concat(e.data.user.name," on ").concat(e.data.auditable_type),columns:t,columnData:l})}}]],c=()=>P(async()=>{n.value=await S.getAuditReports(u.value,i.value)}),m=()=>_({onFinish:(e,t,l)=>{s.value="".concat(l),u.value=e,i.value=t,c()}});return D(()=>!n.value.length&&m()),(e,t)=>(y(),h(p(A),null,{default:C(()=>[w($,{"default-sort-order":"asc","default-sorted-column":"encounter",title:"System Audits","icon-url":p(d),subtitle:s.value,columns:f,columnData:n.value,rowsPerPage:20,onConfigure:m,onRefresh:c},null,8,["icon-url","subtitle","columnData"])]),_:1}))}});export{M as default};
