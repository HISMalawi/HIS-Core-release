import{d as R,r as u,u as U,c as f,o as q,a as E,b as p,w as a,e as o,f as r,I as F,g as t,h as _,i as g,j as n,k as L,l as T,t as m,m as $,n as z,A as w,p as H,q as l,s as K}from"./index-DrAzzURJ.js";import{H as y}from"./HelpdeskFlyer-CYE0RvHv.js";import{F as i,D as N}from"./index-CKDW3HWh.js";import{C as j}from"./index-DL5ItpLz.js";const G=t("div",{class:"ion-text-center ion-padding",style:{"font-weight":"bold","font-size":"2.0rem"}}," This EMR needs an update. ",-1),O=t("div",{class:"ion-text-center"}," Follow the steps below to update. ",-1),W={key:0,style:{"margin-top":"1%"},class:"ion-padding"},J={style:{"font-size":"2.5rem"},class:"ion-text-center"},Q=t("h1",null,[t("b",null,"Step 1:"),n(" Click below to update EMR ")],-1),X={class:"ion-text-center"},Y=t("h3",null,[t("b",null,"Step 2:"),n(" Contact Helpdesk if update is not possible "),t("b",null,"(Optional)")],-1),Z={key:1,style:{"margin-top":"1%"},class:"ion-padding"},ee={class:"ion-text-center"},te=t("h1",null,[t("b",null,"Step 1:"),n(" Contact the Helpdesk")],-1),oe=t("p",null,null,-1),ne=t("h2",null,[t("b",null,"Step 2:"),n(" Click Reload when an officer tells you to")],-1),se={style:{"margin-top":"10px"},class:"ion-text-center"},de=R({__name:"Upgrade",setup(ae){const c=u(!1),v=U(),d=f(()=>"".concat(v.query.version)),h=u("-"),b=f(()=>K("android")),k=new w,x=u("");function P(){z.push("/"),setTimeout(()=>location.reload(),150)}async function C(){h.value=await new w().getApiVersion()}async function S(){try{if(await A()){c.value=!0,I();const e=await B();if(c.value=!1,!e)throw new Error("Unable to download the app");H("Download completed. Installing the app..."),await M(e)}}catch(e){c.value=!1,console.error(e),l("Unable to update the app")}}async function A(){try{const{publicStorage:e}=await i.checkPermissions();if(e!=="granted"){const{publicStorage:s}=await i.requestPermissions();if(s!=="granted")return l("Permission to access storage is required to download the app."),!1}return!0}catch(e){return console.error(e),l("Unable to download the app. Please try again later"),!1}}async function B(){try{return(await i.downloadFile({url:await k.getApkDownloadLink(d.value),path:"Download/emr-".concat(d.value,".apk"),directory:N.ExternalStorage,recursive:!0,progress:!0})).path}catch(e){console.error(e),l(e.toString())}}function I(){i.addListener("progress",e=>{const s=Math.round(e.contentLength/1024),V=Math.round(e.bytes/1024),D=Math.round(e.bytes/e.contentLength*100);x.value="Downloading... ".concat(V,"KB / ").concat(s,"KB (").concat(D,"%)")})}async function M(e){try{await j.install({file:e})}catch(s){console.error(s),l("Unable to install the app. Please try again later")}}return q(()=>C()),(e,s)=>(p(),E(r($),null,{default:a(()=>[o(r(F),null,{default:a(()=>[G,O,b.value?(p(),_("div",W,[t("div",J,[t("div",null,[Q,o(r(g),{onClick:S,size:"large",color:"success"},{default:a(()=>[n("Update EMR")]),_:1})])]),t("div",X,[Y,o(y)])])):(p(),_("div",Z,[t("div",ee,[te,o(y),oe,ne])])),t("div",se,[o(r(g),{onClick:P,size:"large"},{default:a(()=>[n("Reload")]),_:1})])]),_:1}),o(r(L),null,{default:a(()=>[o(r(T),{class:"ion-text-center"},{default:a(()=>[n(" Required version: "),t("b",null,m(d.value)+"/"+m(h.value),1)]),_:1})]),_:1})]),_:1}))}});export{de as default};
