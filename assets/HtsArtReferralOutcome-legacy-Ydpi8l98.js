System.register(["./index-legacy-Ck8hVlzC.js","./LocationFieldOptions-legacy-UgaUiM8M.js","./HisStandardForm-legacy-OroqgFde.js","./storage-legacy-CIkBlJKf.js"],(function(e,t){"use strict";var a,o,n,i,r,l,u,s,c,d,m,b,p,T,f,h;return{setters:[e=>{a=e.bk,o=e.d,n=e.I,i=e.K,r=e.dF,l=e.F,u=e.aT,s=e.ai,c=e._,d=e.r,m=e.o,b=e.c,p=e.w,T=e.b},e=>{f=e.g},e=>{h=e.H},null],execute:function(){class t extends a{constructor(e,t=-1){super(e,10,t)}}const _=o({components:{IonPage:n,HisStandardForm:h},setup(){const e=i([]),a=new t(-1),{visitID:o,htsClient:n,yesNoOptions:c,saveEncounter:d,mapStrToOptions:m,patientDashboardUrl:b}=r({onInitVisit:()=>{e.value=[p(),{id:"outcome",helpText:"ART Outcome Referral",type:l.TT_SELECT,isRequired:()=>!0,condition:e=>null===e.on_art,finalComputedValue:e=>({obs:a.buildValueCoded("Antiretroviral status or outcome",e.value)}),options:()=>m(["Linked","Refused","Died","Already on ART","Unknown"])},...s({id:"outcome_date",helpText:"Outcome",required:!0,minDate:()=>n.birthDate,maxDate:()=>a.date,condition:e=>!/unknown/i.test(e.outcome.value),computeValue:e=>({date:e,obs:a.buildValueDate("Outcome date",e)}),estimation:{allowUnknown:!1}}),{id:"art_site",helpText:"Visited Clinic Name",type:l.TT_SELECT,isRequired:()=>!0,condition:e=>/Linked|Already on art/i.test(e.outcome.value),finalComputedValue:e=>({obs:a.buildValueText("ART clinic location",e.label)}),options:(e,t="")=>f(t),config:{footerBtns:[{name:"Here",slot:"end",onClickComponentEvents:{setValue:()=>t.getLocationName()},onClick:()=>null}],showKeyboard:!0,isFilterDataViaApi:!0}},{id:"has_arv_number",helpText:"ARV Number available",type:l.TT_YES_NO,isRequired:()=>!0,condition:e=>/linked|already on art/i.test(e.outcome.value),options:()=>[{label:"ARV number available?",values:c()}]},{id:"arv_number",helpText:"ARV Number",type:l.TT_TEXT,isRequired:()=>!0,condition:e=>"Yes"===e.has_arv_number,finalComputedValue:e=>({obs:a.buildValueText("Art number",`${e.value}`)})}]}});function p(){let e=!1,t=[],n=!1;return{id:"on_art",helpText:"ART Summary",type:l.TT_HIDDEN,init:async()=>{try{const i=await u.getProgramInformation(o.value);n=i&&/Linked|art/i.test(i.art_outcome);const r=await u.getProgramSummary(o.value,1);if(e=[!/unknown/.test(r.current_outcome),!/n\/a/i.test(r.art_start_date)].every(Boolean),!e)return!0;t=[{label:"Outcome",value:r.current_outcome,other:{obs:()=>a.buildValueCoded("Antiretroviral status or outcome","Linked")}},{label:"Outcome date",value:r.art_start_date,other:{obs:()=>a.buildValueDate("Outcome date",r.art_start_date)}},{label:"Facility",value:u.getLocationName(),other:{obs:()=>a.buildValueText("ART clinic location",`${u.getLocationName()}`)}},{label:"ARV Number",value:r.arv_number,other:{obs:()=>a.buildValueText("Art number",r.arv_number)}}]}catch(i){console.error(i)}return!0},summaryMapValue:e=>e,condition:()=>e,defaultValue:()=>t,finalComputedValue:e=>{if(!n)return{obs:e.filter((e=>"function"==typeof e.other.obs)).map((e=>e.other.obs()))}},options:()=>t}}return{patientDashboardUrl:b,onFinish:function(e,t){d({encounterName:"ART Referral Outcome",encounterTypeID:a.encounterTypeID,computedData:t})},fields:e}}});e("default",c(_,[["render",function(e,t,a,o,n,i){const r=d("his-standard-form"),l=d("ion-page");return m(),b(l,null,{default:p((()=>[T(r,{formLabel:"ART Referral outcome",fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:e.patientDashboardUrl()},null,8,["fields","onFinishAction","cancelDestinationPath"])])),_:1})}]]))}}}));
