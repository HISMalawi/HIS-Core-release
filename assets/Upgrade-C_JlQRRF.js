import{d as U,r as p,u as q,c as g,o as E,a as c,b as F,w as a,e as n,f as o,g as m,h as s,i as r,t as w,j as L,A as y,k as _,l,I as T,m as v,n as $,p as z,q as H,s as K}from"./index-CJleCCtM.js";import{H as b}from"./HelpdeskFlyer-BUEuAABJ.js";import{F as i,D as N}from"./index-DC9jnrfb.js";import{C as j}from"./index-C7dhC3AS.js";const G={key:0,style:{"margin-top":"1%"},class:"ion-padding"},O={style:{"font-size":"2.5rem"},class:"ion-text-center"},W={class:"ion-text-center"},J={key:1,style:{"margin-top":"1%"},class:"ion-padding"},Q={class:"ion-text-center"},X={style:{"margin-top":"10px"},class:"ion-text-center"},ne=U({__name:"Upgrade",setup(Y){const d=p(!1),h=q(),u=g(()=>"".concat(h.query.version)),f=p("-"),k=g(()=>K("android")),x=new y,P=p("");function C(){L.push("/"),setTimeout(()=>location.reload(),150)}async function S(){f.value=await new y().getApiVersion()}async function A(){try{if(await B()){d.value=!0,M();const t=await I();if(d.value=!1,!t)throw new Error("Unable to download the app");_("Download completed. Installing the app..."),await V(t)}}catch(t){d.value=!1,console.error(t),l("Unable to update the app")}}async function B(){try{const{publicStorage:t}=await i.checkPermissions();if(t!=="granted"){const{publicStorage:e}=await i.requestPermissions();if(e!=="granted")return l("Permission to access storage is required to download the app."),!1}return!0}catch(t){return console.error(t),l("Unable to download the app. Please try again later"),!1}}async function I(){try{return(await i.downloadFile({url:await x.getApkDownloadLink(u.value),path:"Download/emr-".concat(u.value,".apk"),directory:N.ExternalStorage,recursive:!0,progress:!0})).path}catch(t){console.error(t),l(t.toString())}}function M(){i.addListener("progress",t=>{const e=Math.round(t.contentLength/1024),D=Math.round(t.bytes/1024),R=Math.round(t.bytes/t.contentLength*100);P.value="Downloading... ".concat(D,"KB / ").concat(e,"KB (").concat(R,"%)")})}async function V(t){try{await j.install({file:t})}catch(e){console.error(e),l("Unable to install the app. Please try again later")}}return E(()=>S()),(t,e)=>(c(),F(r(H),null,{default:a(()=>[n(r(T),null,{default:a(()=>[e[7]||(e[7]=o("div",{class:"ion-text-center ion-padding",style:{"font-weight":"bold","font-size":"2.0rem"}}," This EMR needs an update. ",-1)),e[8]||(e[8]=o("div",{class:"ion-text-center"}," Follow the steps below to update. ",-1)),k.value?(c(),m("div",G,[o("div",O,[o("div",null,[e[1]||(e[1]=o("h1",null,[o("b",null,"Step 1:"),s(" Click below to update EMR ")],-1)),n(r(v),{onClick:A,size:"large",color:"success"},{default:a(()=>e[0]||(e[0]=[s("Update EMR")])),_:1})])]),o("div",W,[e[2]||(e[2]=o("h3",null,[o("b",null,"Step 2:"),s(" Contact Helpdesk if update is not possible "),o("b",null,"(Optional)")],-1)),n(b)])])):(c(),m("div",J,[o("div",Q,[e[3]||(e[3]=o("h1",null,[o("b",null,"Step 1:"),s(" Contact the Helpdesk")],-1)),n(b),e[4]||(e[4]=o("p",null,null,-1)),e[5]||(e[5]=o("h2",null,[o("b",null,"Step 2:"),s(" Click Reload when an officer tells you to")],-1))])])),o("div",X,[n(r(v),{onClick:C,size:"large"},{default:a(()=>e[6]||(e[6]=[s("Reload")])),_:1})])]),_:1}),n(r($),null,{default:a(()=>[n(r(z),{class:"ion-text-center"},{default:a(()=>[e[9]||(e[9]=s(" Required version: ")),o("b",null,w(u.value)+"/"+w(f.value),1)]),_:1})]),_:1})]),_:1}))}});export{ne as default};
