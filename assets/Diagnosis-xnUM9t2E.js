import{H as C}from"./HisStandardForm-tiWNF5wA.js";import{b2 as c,aR as y,d as E,K as d,aT as x,V as L,ab as p,o as P,c as F,w as N,b as V,cj as m,I as O,S as M,n as I}from"./index-iM2cGz0p.js";import{F as g}from"./dynamic-import-helper-9HnG3Mif.js";import{u as R}from"./useEncounter-7mornhHm.js";import{a as k,r as f}from"./commons-nTtbalOG.js";import"./TouchScreenForm-hvB0I83y.js";import"./ToolbarMediumCard-ny9gUih7.js";import"./Transformers-XlEF3tgP.js";import"./ViewPort-4mhPlN2U.js";import"./isEmpty-FyXdwgxL.js";import"./encounter_guidelines-zqd44jxT.js";import"./GuidelineEngine-syyQoOzo.js";class _ extends c{constructor(a,i){super(a,41,i)}static async getDiagnosis(a="",i=1,n=10){const o=y.getConceptID("Qech outpatient diagnosis list");return c.getJson("diagnosis",{id:o,name:a,page:i,page_size:n})}}class $ extends c{constructor(a,i){super(a,105,i)}}const W=E({__name:"Diagnosis",setup(l){let a,i;const n=d("No"),o=d([]),{goToNextTask:v,patientDashboardUrl:T}=R((t,e)=>{x.getLatestMalariaTestResult(e).then(s=>n.value=s),a=new $(e,t),i=new _(e,t),o.value=[u("Primary"),u("Secondary"),w()]});async function S(t,e){await i.createEncounter();const s=await f({...e,obs_datetime:M.getSessionDate()},"diagnosis");await i.saveObservationList(s);const r=await f({...e},"notes");p.isEmpty(r)||(await a.createEncounter(),await a.saveObservationList(r)),v()}async function b(t){return t.some(({label:s})=>/Malaria/i.test(s))?n.value==="Positive"?!0:await I("Patient has ".concat(n.value," malaria test result. Do you want to continue?")):!0}function u(t){return{id:"".concat(t.toLowerCase(),"_diagnosis"),helpText:"".concat(t," Diagnosis"),type:g.TT_INFINITE_SCROLL_MULTIPLE_SELECT,validation:e=>t==="Primary"?L.required(e):null,options:async(e,s="",r=1,D=10)=>{const h=await _.getDiagnosis(s,r,D);return k(h,"name","concept_id")},beforeNext:async e=>await b(e),computedValue:e=>({tag:"diagnosis",obs:e.map(({value:s})=>i.buildValueCoded("".concat(t," Diagnosis"),s))}),config:{isFilterDataViaApi:!0,showKeyboard:!0}}}function w(){return{id:"clinical_notes",helpText:"Clinical notes",type:g.TT_TEXT,computedValue:t=>p.isEmpty(t)?null:{tag:"notes",obs:a.buildValueText("Clinical notes construct",t.value)}}}return(t,e)=>(P(),F(m(O),null,{default:N(()=>[V(C,{cancelDestinationPath:m(T),fields:o.value,onFinishAction:S},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{W as default};
