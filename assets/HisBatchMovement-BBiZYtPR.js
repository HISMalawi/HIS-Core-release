import{V as C}from"./ViewPort-DixuDTZA.js";import{_ as I}from"./FieldMixin.vue_vue_type_script_lang-qMf9z2fm.js";import{d as w,ai as z,g as R,ak as B,aj as S,h as q,C as E,b8 as F,ck as M,V as f,_ as L,r as i,o as d,c as _,w as s,b as t,x as P,F as A,y as H,u as c,v as T,z as j}from"./index-BPESSmpp.js";import{F as V}from"./dynamic-import-helper-Bsjrd6Ro.js";import G from"./BaseTextInput-CYKc9m-x.js";import{P as k}from"./PopupKeyboard-g7iSFnuB.js";import"./SIngleTouchField-Bfe7QxF5.js";import"./TouchScreenForm-BjDI66hA.js";import"./ToolbarMediumCard-DnRdVW_r.js";import"./Transformers-BPPLlH12.js";import"./HisKeypad-BqXUAOKr.js";import"./BaseKeyboard-DxmkwR6c.js";import"./KbLayouts-VRA-vjeH.js";import"./KbHandler-BuQ4TFU6.js";import"./overlays-04a9a43f-pvrUHYCC.js";const K=w({components:{ViewPort:C,IonGrid:z,IonList:R,IonCol:B,IonRow:S,IonItem:q,IonLabel:E,IonInput:F,HisTextInput:G},mixins:[I],data:()=>({drugs:[],selectedDrug:null}),async activated(){this.init()},methods:{async init(){this.$emit("onFieldActivated",this),this.drugs=await this.options(),this.drugs.length>=1&&this.selectDrug(0)},fmtNumber(e){return M(e)},getModalTitle(e){return"".concat(e," (").concat(this.drugs[this.selectedDrug].label,")")},getDrugValue(e){return this.drugs[this.selectedDrug].other[e]},setDrugValue(e,o){this.drugs[this.selectedDrug].other[e]=o?o.value:""},enterTins(){k({id:"tins",helpText:this.getModalTitle("Enter number of tins"),type:V.TT_NUMBER,defaultValue:()=>this.getDrugValue("tins"),validation:e=>!e||e&&!e.value?null:f.validateSeries([()=>f.isNumber(e),()=>e.value<=0?["Number of tins must be greater than 1"]:null,()=>e.value>this.getDrugValue("quantity")?["You cannot dispose/relocate more than available tins"]:null])},e=>this.setDrugValue("tins",e))},async selectReason(){const e=this.getDrugValue("batch_number");k({id:"reason",helpText:this.getModalTitle("Select reason for disposing/relocating Batch ".concat(e)),type:V.TT_SELECT,defaultValue:()=>this.getDrugValue("reason"),validation:o=>f.required(o),options:()=>{var o;return((o=this.config)==null?void 0:o.getReasons(this.drugs[this.selectedDrug],this.fdata))||[]}},o=>{this.setDrugValue("reason",o)})},selectDrug(e){this.selectedDrug=e}},computed:{fullSelectedDrugName(){var e,o,r;try{const[p,D,,b]=(r=(o=(e=this.drugs[this.selectedDrug])==null?void 0:e.description)==null?void 0:o.text.split("-"))!=null?r:"",g=this.drugs[this.selectedDrug].label;return"".concat(g," (").concat(p,"-").concat(D,"-").concat(b,")")}catch(p){return"N/A"}},updatedDrugs(){return this.drugs.filter(e=>{var o,r;return!!((o=e.other)!=null&&o.tins)&&!!((r=e.other)!=null&&r.reason)})}},watch:{clear(){this.drugs=this.drugs.map(e=>(e.other={...e.other,tins:null,quantity:e.current_quantity/e.pack_size||1,reason:""},e))},drugs:{async handler(){this.$emit("onValue",this.updatedDrugs)},immediate:!0,deep:!0}}});function U(e,o,r,p,D,b){const g=i("his-text-input"),u=i("ion-item"),$=i("ion-list"),a=i("ion-col"),m=i("ion-label"),h=i("ion-input"),y=i("ion-row"),v=i("ion-grid"),N=i("view-port");return d(),_(N,null,{default:s(()=>[t(g,{readonly:"",value:e.fullSelectedDrugName},null,8,["value"]),t(v,{style:{background:"white"}},{default:s(()=>[t(y,null,{default:s(()=>[t(a,{size:"4",class:"border-right scroll-list"},{default:s(()=>[(d(!0),P(A,null,H(e.drugs,(n,l)=>(d(),_($,{key:l},{default:s(()=>[t(u,{detail:"",color:l===e.selectedDrug?"secondary":"",onClick:Y=>e.selectDrug(l)},{default:s(()=>[c(T(n.label),1)]),_:2},1032,["color","onClick"])]),_:2},1024))),128))]),_:1}),t(a,null,{default:s(()=>[e.selectedDrug!==null?(d(),_(v,{key:0,class:"scroll-list"},{default:s(()=>[t(y,null,{default:s(()=>[t(a,{size:"12",class:"ion-margin-bottom"},{default:s(()=>[t(u,null,{default:s(()=>{var n;return[t(m,{position:"floating"},{default:s(()=>{var l;return[c("Available Tins/Pallets (pack size: "+T((l=e.drugs[e.selectedDrug].other)==null?void 0:l.pack_size)+"):",1)]}),_:1}),t(h,{readonly:"",disabled:"",value:e.fmtNumber((n=e.drugs[e.selectedDrug].other)==null?void 0:n.quantity)},null,8,["value"])]}),_:1})]),_:1}),t(a,{size:"12"},{default:s(()=>[t(u,null,{default:s(()=>{var n;return[t(m,{position:"floating"},{default:s(()=>[c("Total Tins Relocated/Disposed")]),_:1}),t(h,{readonly:"",color:"primary",value:e.fmtNumber(((n=e.drugs[e.selectedDrug].other)==null?void 0:n.tins)||0),onClick:e.enterTins},null,8,["value","onClick"])]}),_:1})]),_:1}),t(a,{size:"12"},{default:s(()=>[t(u,null,{default:s(()=>{var n;return[t(m,{position:"floating"},{default:s(()=>[c("Reason for Relocating/Disposing")]),_:1}),t(h,{readonly:"",color:"primary",placeholder:"select reason",value:((n=e.drugs[e.selectedDrug].other)==null?void 0:n.reason)||"",onClick:e.selectReason},null,8,["value","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1})):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}const ae=L(K,[["render",U],["__scopeId","data-v-549e1350"]]);export{ae as default};
