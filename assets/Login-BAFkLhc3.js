import{d as O,au as A,av as D,aw as M,ax as W,ay as Y,a9 as L,O as I,aa as g,az as q,aA as G,ah as j,aB as Q,a6 as U,u as d,B as f,G as n,Z as m,aC as N,aD as B,E as k,C as $,H as V,aE as J,W as X,a3 as Z,S as x,a1 as ee,a5 as se,Q as te,R as oe,U as ae,a4 as ne,X as ie,Y as le,r as P,aF as re,ap as ue,aG as pe,t as de,aH as E,aI as ce,aJ as fe,aK as he,v as S,w as l,ab as p,x as u,z as _}from"./index-BMAYi21T.js";import{p as me}from"./main-BIrABgL0.js";const we=O({props:{useVirtualInput:{type:Boolean}},data:function(){return{keyboard:A,auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new D,M.clearScreenTimeout()},setup(){const{facilityName:s,district:e}=Q();return{facilityName:s,district:e}},methods:{renderKeyBoard(s){this.focusInput=s.currentTarget,this.focusInput.id=="password"?this.btnCaption="Login":this.btnCaption="Next";let e=s.currentTarget.getBoundingClientRect().top;e=parseInt(e),this.keyboardTop=e+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(s){const e=s.currentTarget.id;let o;try{e.match(/@#/i)?this.keyboard=W:e.match(/qwerty/i)?this.keyboard=A:e.match(/Del/i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):e.match(/Next/i)?(this.display="none",o=this.$refs.password,o.click()):e.match(/Login/i)?(this.display="none",this.doLogin()):e.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",this.focusInput.id==="username"?o=this.$refs.username:o=this.$refs.password,o.click()):e.match(/Hide/i)?this.display="none":this.focusInput.value+=e,this.focusInput.id=="username"?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(a){console.warn("input error")}},isStrongPassword(){},doLogin:async function(){if(this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!await this.auth.checkTimeIntegrity())throw"Local date does not match API date. Please Update your device's date";await this.auth.login(this.userInput.password),this.auth.startSession();const s=await Promise.all([this.auth.passwordPolicyEnabled(),this.auth.passwordExpired()]),e=(()=>{let o=0;const a=me(this.userInput.password);return o+=a.score,/^(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])/i.test(this.userInput.password)&&(o+=2),o<3})();if(e||s.every(Boolean)){const o=a=>"".concat(a.value).toLowerCase();return Y([{id:"new_password",proxyID:"password",helpText:"Change your password",type:L.TT_PASSWORD,init:()=>(setTimeout(()=>{e?I("Your password is weak, please change it below"):I("Your password has expired, please change it below",6e3)},500),!0),computedValue:a=>o(a),validation:a=>g.validateSeries([()=>g.required(a),()=>g.hasLengthRangeOf(a,4,15),()=>{if("".concat(this.userInput.password).toLowerCase()===o(a))return["New password should not match old password"]}]),config:{inputType:"password"}},{id:"verify_password",proxyID:"password",helpText:"Confirm Password",type:L.TT_PASSWORD,computedValue:a=>o(a),validation:(a,c)=>g.validateSeries([()=>g.required(a),()=>{if(o(c.verify_password)!=o(c.new_password))return["New password does not match current password"]}]),config:{inputType:"password"}}],async(a,c)=>{await q.updateUser(this.auth.userID,c)?(await this.auth.resetUserPasswordChangeCheck(),this.$router.push("/select_hc_location")):I("Unable to update user")})}this.$router.push("/select_hc_location")}catch(s){s instanceof G?I("Invalid username or password"):j("".concat(s),5e4)}}else I("Complete form to log in")}},computed:{btnStyles(){return"display: ".concat(this.display,"; top: ").concat(this.keyboardTop,";")}}}),ye={class:"main",ref:"main"},Ie={class:"cells ion-padding-bottom"},ge={style:{color:"#cd853f"}},_e={class:"rows"},ve={class:"cells"},be=["readonly"],Ce={class:"rows input-rows"},ke={class:"cells"},Pe=["readonly"],Se={class:"rows"},$e=["id"],Ve=["id"];function Te(s,e,o,a,c,w){return d(),f(k,null,[n("div",ye,[n("div",Ie,[n("h3",null,[e[6]||(e[6]=n("b",{style:{color:"#8b4513"}},"Facility: ",-1)),n("b",ge,m(s.facilityName)+" ("+m(s.district)+")",1)])]),n("div",_e,[n("div",ve,[N(n("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":e[0]||(e[0]=i=>s.userInput.username=i),onClick:e[1]||(e[1]=i=>s.renderKeyBoard(i)),class:"input-boxes",readonly:s.useVirtualInput},null,8,be),[[B,s.userInput.username]])])]),n("div",Ce,[n("div",ke,[N(n("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>s.userInput.password=i),type:"password",name:"password",ref:"password",id:"password",onClick:e[3]||(e[3]=i=>s.renderKeyBoard(i)),class:"input-boxes",placeholder:"Password",readonly:s.useVirtualInput},null,8,Pe),[[B,s.userInput.password]])])])],512),n("div",{id:"keyboard",style:J(s.btnStyles),class:"keyboard"},[(d(!0),f(k,null,$(s.keyboard,(i,h)=>(d(),f("span",{key:h},[n("div",Se,[(d(!0),f(k,null,$(i,t=>(d(),f("div",{class:"cells",key:t},[t==="Next"||t==="Login"?(d(),f("button",{key:0,id:s.btnCaption,class:"keyboard-btn login-btn",onClick:e[4]||(e[4]=r=>s.keyPress(r))},m(s.btnCaption),9,$e)):V("",!0),t!="Login"&&t!="Next"?(d(),f("button",{key:1,id:s.Caps.on?t.toUpperCase():t.toLowerCase(),class:"keyboard-btn",onClick:e[5]||(e[5]=r=>s.keyPress(r))},m(t==="Del."||t==="Caps"?t:s.Caps.on?t.toUpperCase():t.toLowerCase()),9,Ve)):V("",!0)]))),128))])]))),128))],4)],64)}const Ae=U(we,[["render",Te],["__scopeId","data-v-96af8267"]]),Le=O({components:{IonItem:X,Inputs:Ae,IonButton:Z,IonTitle:x,IonLabel:ee,IonPage:se,IonHeader:te,IonToolbar:oe,IonContent:ae,IonFooter:ne,IonSelect:ie,IonSelectOption:le},setup(){const s=P([]),e=async()=>{const t=await ce("Application Selection","Please specify the application you wish to use",s.value.map(r=>r.name),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(t.selection&&t.action!="Cancel"){const r=s.value.find(y=>y.name===t.selection);window.open("".concat(r.protocol||"http","://").concat(r.IP,":").concat(r.port||80),"_blank")}},{activePlatformProfile:o,platformProfiles:a}=re(),c=P(""),w=P(""),i=ue(()=>o.value.keyboard===he.HIS_KEYBOARD_ONLY),h=Object.keys(a.value).map(t=>({label:t,value:{profileName:t,...a.value[t]}}));return pe(w,t=>{o.value=(fe.find(h,{label:t})||{}).value}),de(async()=>{var v,b;const t=new D;s.value=((v=await t.loadConfig())==null?void 0:v.otherApps)||[];const r=t.getHeadVersion();t.setActiveVersion(r);const y=await t.getApiVersion();c.value="".concat(r," / ").concat(y),w.value=((b=o.value)==null?void 0:b.profileName)||""}),{version:c,profile:w,otherApps:s,deviceProfiles:h,useVirtualInputOnly:i,activePlatformProfile:o,coatImg:E("login-logos/Malawi-Coat_of_arms_of_arms.png"),pepfarImg:E("login-logos/PEPFAR.png"),showConfig:localStorage.getItem("useLocalStorage")==="true",openSelect:e}}}),Ne={slot:"start"},Be=["src"],Ee=["src"];function Oe(s,e,o,a,c,w){const i=p("ion-label"),h=p("ion-title"),t=p("ion-toolbar"),r=p("ion-header"),y=p("inputs"),v=p("ion-content"),b=p("ion-select-option"),R=p("ion-select"),T=p("ion-button"),F=p("ion-item"),H=p("ion-footer"),K=p("ion-page");return d(),S(K,null,{default:l(()=>[u(r,null,{default:l(()=>[u(t,null,{default:l(()=>[u(h,null,{default:l(()=>[u(i,{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:l(()=>e[1]||(e[1]=[n("b",{style:{color:"#8b4513"}},"National ",-1),n("b",{style:{color:"#cd853f"}},"EMR",-1)])),_:1})]),_:1}),u(i,{class:"ion-padding",slot:"end"},{default:l(()=>[e[2]||(e[2]=_(" Version: ")),n("b",null,m(s.version),1)]),_:1})]),_:1})]),_:1}),u(v,{fullscreen:!1,style:{width:"100%"}},{default:l(()=>[u(y,{useVirtualInput:s.useVirtualInputOnly},null,8,["useVirtualInput"])]),_:1}),u(H,null,{default:l(()=>[u(t,null,{default:l(()=>[n("span",Ne,[n("img",{id:"coat",src:s.coatImg,alt:"Malawi Coat of Arms logo"},null,8,Be),n("img",{id:"pepfar",src:s.pepfarImg,alt:"PEPFAR logo"},null,8,Ee)]),u(F,{class:"his-sm-text",style:{width:"75%"},slot:"end"},{default:l(()=>[u(i,null,{default:l(()=>e[3]||(e[3]=[_("Device Profile")])),_:1}),u(R,{modelValue:s.profile,"onUpdate:modelValue":e[0]||(e[0]=C=>s.profile=C),value:s.profile},{default:l(()=>[(d(!0),f(k,null,$(s.deviceProfiles,(C,z)=>(d(),S(b,{key:z,value:C.label},{default:l(()=>[_(m(C.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","value"]),u(T,{color:"dark",fill:"outline",size:"large",slot:"end","router-link":"/settings/host"},{default:l(()=>e[4]||(e[4]=[_(" Network ")])),_:1}),s.otherApps.length?(d(),S(T,{key:0,color:"dark",fill:"outline",size:"large",slot:"end",onClick:s.openSelect},{default:l(()=>e[5]||(e[5]=[_(" Other Applications ")])),_:1},8,["onClick"])):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}const Re=U(Le,[["render",Oe],["__scopeId","data-v-f474746d"]]);export{Re as default};
