import{d as T,K as b,b5 as g,cV as v,G as I,cZ as D,V as E,cb as p,o as h,c as N,w as P,b as A,cl as l,I as w}from"./index-BCTN_bnC.js";import{F as y}from"./dynamic-import-helper-BkBZiFw5.js";import{H as k}from"./HisStandardForm-CaDwl-hA.js";import{u as C}from"./useEncounter-CDUT-p5Y.js";import{g as m}from"./util-CyjuS_4X.js";import{r as F}from"./commons-BDvZ1JFN.js";import{A as c}from"./appointment_service-GvbXvyjD.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./isEmpty-OXtHK5dz.js";import"./_Set-VKtKUQAI.js";import"./_setToArray-BLmuRUHx.js";import"./encounter_guidelines-DZpIPlYY.js";import"./GuidelineEngine-D6V1_Znr.js";const z=T({__name:"Appointment",setup(V){const n=b([]),a=new g(-1,v.APPOINTMENT),{goToNextTask:u,patientDashboardUrl:d}=C((r,o)=>{a.patientID=o,a.providerID=r;const f=()=>{let e={},s=-1,i={};return{id:"appointment",helpText:"Appointment booking",type:y.TT_DATE_PICKER,init:async()=>(s=await I.get(D.CLINIC_APPOINTMENT_LIMIT),e=await c.getJson("programs/".concat(a.programID,"/patients/").concat(o,"/next_appointment_date"),{date:a.date}),!0),defaultValue:()=>e==null?void 0:e.appointment_date,validation:t=>E.required(t),computedValue:t=>[{concept_id:m("APPOINTMENT_DATE"),value_datetime:t,obs_datetime:a.date},{concept_id:m("ESTIMATED_DATE"),value_datetime:e==null?void 0:e.appointment_date,obs_datetime:a.date}],config:{minDate:()=>a.date,maxDate:()=>e==null?void 0:e.drugs_run_out_date,supValue:t=>"".concat((i[t]||[]).length),infoItems:async t=>(i[t]||(i[t]=await c.getJson("programs/".concat(a.programID,"/booked_appointments"),{date:t,paginate:!1})),[{label:"Medication Run out Date",value:p((e==null?void 0:e.drugs_run_out_date)||"Not available")},{label:"User set appointment date",value:p(t)},{label:"Appointments",value:(i[t]||[]).length},{label:"Appointment limit (per/day)",value:s||"N/A"}]),hiddenFooterBtns:["Clear"]}}};n.value=[f()]});async function _(r,o){await a.createEncounter(),await a.saveObservationList(await F(o)),u()}return(r,o)=>(h(),N(l(w),null,{default:P(()=>[A(k,{cancelDestinationPath:l(d),onFinishAction:_,fields:n.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{z as default};
