import{F as t}from"./dynamic-import-helper-Bsjrd6Ro.js";import{H as c}from"./HisStandardForm-B93s5uaV.js";import{b5 as p,d as h,t as l,T as m,V as i,_ as v,r as T,o as g,c as _}from"./index-CZt4BSQf.js";import{_ as b}from"./EncounterMixin.vue_vue_type_script_lang-CJ7SJALh.js";import{g as f}from"./LocationFieldOptions-CaKEua6G.js";import"./TouchScreenForm-JVgeEWDh.js";import"./ToolbarMediumCard-CyRn44E2.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-DiinNO5i.js";import"./encounter_guidelines-D3HurrmR.js";import"./GuidelineEngine-D6V1_Znr.js";class u extends p{constructor(n,s){super(n,186,s)}}const V=h({mixins:[b],components:{HisStandardForm:c},data:()=>({screeningResult:{},obs:[],fieldContext:{},currentMethod:""}),watch:{patient:{async handler(){this.screeningResult=new u(this.patientID,this.providerID),this.currentMethod=await this.getTreatmentOptions(),this.fields=this.getFields()},deep:!0}},methods:{async onFinish(e,n){if(!await this.screeningResult.createEncounter())return l("Unable to create encounter");e.treatment_option&&e.treatment_option.value==="Referral"&&this.obs.push(this.screeningResult.buildValueText("Referral location",u.getLocationName()));const r=[];Object.keys(n).forEach(o=>{r.push(n[o].obs)});const a=await Promise.all([...this.obs,...r]);await this.screeningResult.saveObservationList(a),m("Observations and encounter created!"),this.nextTask()},getFacilities(e=""){return f(e)},async getTreatmentOptions(){return await this.screeningResult.getFirstValueCoded("CxCa screening method")},getOptions(e){return e||(l("No screening methods have been selected"),this.gotoPatientDashboard()),e.match(/via/i)?["VIA Negative","VIA Positive","Suspect Cancer"]:e.match(/smear/i)?["PAP Smear Normal","PAP Smear Abnormal"]:e.match(/HPV DNA/i)?["HPV positive","HPV negative"]:e.match(/Speculum/i)?["Visible Lesion","No visible Lesion","Suspect Cancer","Other Gynae"]:[]},getFields(){return[{id:"results_available",helpText:"Screening result available",type:t.TT_SELECT,validation:e=>i.required(e),options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.screeningResult.buildValueCoded("Screening results available",e.value)})},{id:"screening_result",helpText:"Screening Result",type:t.TT_SELECT,validation:e=>i.required(e),options:()=>this.mapOptions([...this.getOptions(this.currentMethod)]),condition(e){return e.results_available.value==="Yes"},computedValue:e=>({obs:this.screeningResult.buildValueCoded("Screening results",e.value)})},{id:"gynae_options",helpText:"Other Gynae treatment",type:t.TT_SELECT,validation:e=>i.required(e),options:()=>this.mapOptions(["STI","Cervicitis"]),condition(e){return e.screening_result.value==="Other Gynae"},computedValue:e=>({obs:this.screeningResult.buildValueCoded("Screening results",e.value)})},{id:"offer_via",helpText:"Offer VIA",type:t.TT_SELECT,validation:e=>i.required(e),options:()=>this.yesNoOptions(),condition(e){return e.screening_result.value==="HPV positive"},computedValue:e=>({obs:this.screeningResult.buildValueCoded("Patient went for VIA?",e.value)})},{id:"via_screening_results",helpText:"VIA screening results",type:t.TT_SELECT,validation:e=>i.required(e),options:()=>this.mapOptions(["VIA negative","VIA positive","Suspect cancer"]),condition(e){return e.offer_via.value==="Yes"},computedValue:e=>({obs:this.screeningResult.buildValueCoded("VIA Results",e.value)})},{id:"reason_for_not_offering_via",helpText:"Reason for NOT offering VIA",type:t.TT_SELECT,validation:e=>i.required(e),options:()=>this.mapOptions(["Client NOT ready","Treatment not available","Other conditions"]),condition(e){return e.offer_via.value==="No"},computedValue:e=>({obs:this.screeningResult.buildValueCoded("Other reason for not seeking services",e.value)})},{id:"further_details",helpText:"Further details",type:t.TT_TEXT,validation:e=>i.required(e),computedValue:e=>({obs:this.screeningResult.buildValueText("Other reason for not seeking services",e.label)}),condition:e=>e.possible_reasons_why.value==="Other conditions"||e.possible_reasons_why.value==="Treatment not available"},{id:"treatment_option",helpText:"Enter treatment option",type:t.TT_SELECT,validation:e=>i.required(e),options:()=>this.mapOptions(["Same day treatment","Postponed treatment","Referral"]),condition(e){return!["VIA Negative","No visible Lesion","PAP Smear Normal","HPV negative"].includes(e.screening_result.value)},computedValue:e=>({obs:this.screeningResult.buildValueCoded("Directly observed treatment option",e.value)})},{id:"postponed_reason",helpText:"Select reason for postponing treatment",type:t.TT_SELECT,validation:e=>i.required(e),options:()=>this.mapOptions(["Client not ready","Treatment not available","Other conditions"]),condition(e){return e.treatment_option.value==="Postponed treatment"},computedValue:e=>({obs:this.screeningResult.buildValueCoded("Postponed reason",e.value)})},{id:"referral_rreason",helpText:"Referral reason",type:t.TT_SELECT,validation:e=>i.required(e),options:()=>this.mapOptions(["Further Investigation and Management","Large Lesion (Greater than 75 percent)","Unable to treat client","Suspect Cancer","Treatment not available","Other conditions"]),condition(e){return e.treatment_option.value==="Referral"},computedValue:e=>({obs:this.screeningResult.buildValueCoded("Referral reason",e.value)})},{id:"further_details",helpText:"Further details",type:t.TT_TEXT,validation:e=>i.required(e),computedValue:e=>({obs:this.screeningResult.buildValueText("Referral reason",e.label)}),condition:e=>e.possible_reasons_why.value==="Other conditions"||e.possible_reasons_why.value==="Unable to treat client"}]}}});function C(e,n,s,r,a,o){const d=T("his-standard-form");return g(),_(d,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!1,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}const N=v(V,[["render",C]]);export{N as default};
