import{d as N,Q as O,al as U,bY as z,a5 as q,U as j,R as Y,aW as G,a4 as Q,a1 as W,bZ as Z,W as J,b_ as K,aj as c,aJ as h,aH as b,aq as X,bu as x,b$ as ee,bk as f,ah as F,c0 as _,aM as te,ad as oe,a6 as se,ab as s,u as n,B as d,aC as re,c1 as ie,x as r,v as g,w as o,G as a,H as l,z as p,Z as u,E as R,C as ae,c2 as ne}from"./index-ZHjf-rL0.js";import{t as le,a as pe}from"./Export-B_lPSBZx.js";import{H as ue}from"./HisStandardForm-DV91SVN0.js";import{R as ce}from"./ReportErrors-DsFNAGwl.js";const he=N({components:{HisStandardForm:ue,IonHeader:O,ReportTable:U,HisFooter:z,IonPage:q,IonContent:j,IonToolbar:Y,IonChip:G,IonFooter:Q,IonLabel:W,IonThumbnail:Z,IonItem:J,IonImg:K},props:{encryptPDF:{type:Boolean,default:!1},showValidationStatus:{type:Boolean,default:!1},validationErrors:{type:Array,default:()=>[]},config:{type:Object},headerInfoList:{type:Array,default:()=>[]},reportPrefix:{type:String,default:""},reportLogo:{type:String},showtitleOnly:{type:Boolean,default:!1},title:{type:String,required:!0},period:{type:String},showFilters:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},columns:{type:Object,required:!0},rows:{type:Object,required:!0},customBtns:{type:Array,default:()=>[]},hasServerSideCaching:{type:Boolean,default:!1},canExportPDf:{type:Boolean,default:!0},canExportCsv:{type:Boolean,default:!0},enabledPDFHorizontalPageBreak:{type:Boolean,default:!1},onFinishBtnAction:{type:Function},onReportConfiguration:{type:Function,required:!0},onDefaultConfiguration:{type:Function},customFileName:{type:String,default:""}},data:()=>({date:"",formData:{},btns:[],computeFormData:{},activeColumns:[],activeRows:[],isLoadingData:!1,canShowReport:!1,siteUUID:c.getSiteUUID(),apiVersion:c.getApiVersion(),coreVersion:c.getCoreVersion(),artVersion:c.getAppVersion(),tableCssTheme:"art-report-theme"}),watch:{validationErrors:{handler(e){h.isEmpty(e)||this.showErrors()},deep:!0,immediate:!0},fields:{handler(e){h.isEmpty(e)?(this.canShowReport=!0,this.refreshTimeStamp()):(this.canShowReport=!1,this.btns.forEach(t=>{t.name==="Back"&&(t.visible=!0)}))},immediate:!0}},computed:{logo(){if(!this.reportLogo&&typeof this.reportPrefix=="string"){if(this.reportPrefix.match(/pepfar/i))return b("login-logos/PEPFAR.png");if(this.reportPrefix.match(/moh/i))return b("login-logos/Malawi-Coat_of_arms_of_arms.png")}return b("reports.png")},hasErrors(){return!h.isEmpty(this.validationErrors)},errorCount(){return this.validationErrors?this.validationErrors.length:0},footerRows(){const e=[["Date Created: ".concat(this.date)]];return this.period&&e.push(["Quarter: ".concat(this.period)]),e.push(["HIS-Core Version: ".concat(this.coreVersion)]),e.push(["API Version: ".concat(this.apiVersion)]),e.push(["Site UUID: ".concat(this.siteUUID)]),e.push(["Generated by: ".concat(c.getUserName())]),e}},methods:{async showErrors(){(await X.create({component:ce,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:this.validationErrors}})).present()},pdfEncryptionData(){const e=c.getUserName();return{encryption:{userPassword:e,ownerPassword:e,userPermissions:["print"]}}},refreshTimeStamp(){this.date=x().format("DD/MMM/YYYY HH:MM:ss")},onActiveColumns(e){this.activeColumns=e},onActiveRows(e){this.activeRows=e},getFileName(){var e;return this.customFileName||"".concat(this.reportPrefix," ").concat(c.getLocationName()," ").concat(ee(this.title).replace(this.reportPrefix,"")," ").concat((e=this.period)!=null?e:this.date)},async onLoadDefault(){this.canShowReport=!0,await this.presentLoading();try{this.refreshTimeStamp(),this.onDefaultConfiguration&&await this.onDefaultConfiguration(),f.dismiss()}catch(e){F("".concat(e)),console.error(e),f.dismiss()}},async onFinish(e,t,y=!1){this.formData=e,this.computeFormData=t,this.canShowReport=!0,await this.presentLoading();try{this.refreshTimeStamp(),await this.onReportConfiguration(this.formData,this.computeFormData,y),f.dismiss()}catch(w){F("".concat(w)),console.error(w),f.dismiss()}},async reloadReport(e=!1){if(!h.isEmpty(this.formData)||!h.isEmpty(this.computeFormData)){await this.onFinish(this.formData,this.computeFormData,e);return}this.onDefaultConfiguration&&await this.onLoadDefault()},async presentLoading(){await(await f.create({message:"Please wait...",backdropDismiss:!1})).present()}},created(){this.onDefaultConfiguration&&this.onLoadDefault(),this.btns=this.customBtns,this.btns.push({name:"CSV",size:"large",slot:"start",color:"primary",visible:this.canExportCsv,onClick:async()=>{const{columns:e,rows:t}=_(this.activeColumns,this.activeRows,"csvMode");le(e,[...t,...this.footerRows],this.getFileName())}}),this.btns.push({name:"PDF",size:"large",slot:"start",color:"primary",visible:this.canExportPDf,onClick:async()=>{let e="pdfMode";this.encryptPDF&&(e=await te("Security warning","PDF may contain private data that will require a password to unlock","To access private data choose Secure PDF over Regular PDF",[{name:"Secure PDF",slot:"start",color:"success"},{name:"Regular PDF",slot:"start",color:"success"}],"his-danger-color")==="Secure PDF"?"pdfMode":"ignorePDFColumnexport");const{columns:t,rows:y}=_(this.activeColumns,this.activeRows,e);pe(t,y,this.getFileName(),this.enabledPDFHorizontalPageBreak,this.encryptPDF&&e!="ignorePDFColumnexport"?this.pdfEncryptionData():{})}}),this.btns.push({name:"Refresh/Rebuild",size:"large",slot:"end",color:"warning",visible:!0,onClick:async()=>{let e=!1;this.hasServerSideCaching&&(e=await oe("Do you want to rebuild report cache?",{header:"Rebuild Report"})),this.reloadReport(e)}}),this.btns.push({name:"Back",size:"large",slot:"end",color:"primary",visible:!h.isEmpty(this.fields),onClick:()=>this.canShowReport=!1}),this.btns.push({name:"Finish",size:"large",slot:"end",color:"success",visible:!0,onClick:()=>{this.onFinishBtnAction?this.onFinishBtnAction():this.$router.push({path:"/"})}})}}),de=["innerHTML"],me={class:"header-text-list"},fe=["onClick"],ge={key:1},ye=["innerHTML"],we={key:0},be={class:"report-content"};function Ce(e,t,y,w,De,ve){const S=s("his-standard-form"),P=s("ion-title"),k=s("ion-img"),E=s("ion-thumbnail"),m=s("ion-chip"),B=s("ion-label"),I=s("ion-item"),C=s("ion-toolbar"),A=s("ion-header"),V=s("report-table"),T=s("ion-content"),$=s("ion-footer"),L=s("his-footer"),H=s("ion-page");return n(),d(R,null,[re(r(S,{onOnFinish:e.onFinish,skipSummary:!0,fields:e.fields},null,8,["onOnFinish","fields"]),[[ie,!e.canShowReport]]),e.canShowReport?(n(),g(H,{key:0},{default:o(()=>[r(A,null,{default:o(()=>[r(C,null,{default:o(()=>[e.showtitleOnly?(n(),g(P,{key:0},{default:o(()=>[a("span",{innerHTML:e.title},null,8,de)]),_:1})):l("",!0),e.showtitleOnly?l("",!0):(n(),g(I,{key:1},{default:o(()=>[r(E,{slot:"start"},{default:o(()=>[r(k,{src:e.logo},null,8,["src"])]),_:1}),r(B,null,{default:o(()=>[a("ul",me,[a("li",null,[t[0]||(t[0]=p("Title ")),a("b",null,u(e.title),1)]),a("li",null,[t[1]||(t[1]=p("Period ")),a("b",null,u(e.period),1)]),(n(!0),d(R,null,ae(e.headerInfoList,(i,M)=>{var D,v;return n(),d("li",{key:M},[p(u(i.label)+" ",1),i&&((D=i==null?void 0:i.other)!=null&&D.onclick)?(n(),d("a",{key:0,href:"#",onClick:ne(Fe=>i.other.onclick(),["prevent"])},u(i.value),9,fe)):l("",!0),i&&!((v=i==null?void 0:i.other)!=null&&v.onclick)?(n(),d("b",ge,[a("span",{innerHTML:i.value},null,8,ye)])):l("",!0)])}),128)),e.showValidationStatus?(n(),d("li",we,[e.hasErrors?(n(),g(m,{key:0,onClick:e.showErrors,color:"danger"},{default:o(()=>[a("b",null,u(e.errorCount),1),t[2]||(t[2]=p(" Error(s) found. Click for more "))]),_:1},8,["onClick"])):l("",!0),e.hasErrors?l("",!0):(n(),g(m,{key:1,color:"success"},{default:o(()=>t[3]||(t[3]=[p(" Report is Consistent ")])),_:1}))])):l("",!0)])]),_:1})]),_:1}))]),_:1})]),_:1}),r(T,null,{default:o(()=>[a("div",be,[r(V,{rows:e.rows,columns:e.columns,showFilters:e.showFilters,config:{...e.config,tableCssTheme:e.tableCssTheme},onOnActiveColumns:e.onActiveColumns,onOnActiveRows:e.onActiveRows},null,8,["rows","columns","showFilters","config","onOnActiveColumns","onOnActiveRows"])])]),_:1}),r($,null,{default:o(()=>[r(C,null,{default:o(()=>[r(m,{color:"primary"},{default:o(()=>[t[4]||(t[4]=p("Date Created: ")),a("b",null,u(e.date),1)]),_:1}),r(m,{color:"primary"},{default:o(()=>[t[5]||(t[5]=p("His-Core Version: ")),a("b",null,u(e.coreVersion),1)]),_:1}),r(m,{color:"primary"},{default:o(()=>[t[6]||(t[6]=p("API Version: ")),a("b",null,u(e.apiVersion),1)]),_:1})]),_:1})]),_:1}),r(L,{btns:e.btns},null,8,["btns"])]),_:1})):l("",!0)],64)}const ke=se(he,[["render",Ce],["__scopeId","data-v-6ccbfe61"]]);export{ke as R};
