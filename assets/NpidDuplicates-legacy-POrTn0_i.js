System.register(["./index-legacy-CA6M7ipO.js"],(function(e,t){"use strict";var i,n,a,s,d,o,l,r,c,u,h,m,p,g,f,I,k,C,D,b,w,y,_,N,A,$,E,V,P,x,z;return{setters:[e=>{i=e.d,n=e.I,a=e.ai,s=e.a8,d=e.a5,o=e.$,l=e.Y,r=e.X,c=e.Z,u=e._,h=e.a9,m=e.aj,p=e.W,g=e.ak,f=e.al,I=e.H,k=e.am,C=e.an,D=e.aa,b=e.c,w=e.w,y=e.af,_=e.a,N=e.b,A=e.C,$=e.a2,E=e.E,V=e.G,P=e.J,x=e.M,z=e.K}],execute:function(){const t=i({components:{IonPage:n,IonCheckbox:a,IonButton:s,IonList:d,IonItem:o,IonToolbar:l,IonHeader:r,IonTitle:c,IonContent:u,IonFooter:h},data:()=>({dde:{},ddeEnabled:!1,items:[],title:"",npid:""}),watch:{$route:{handler({params:e}){e&&(this.npid=e.npid,this.title=`Duplicates for NPID (${this.npid})`,this.init(this.npid))},deep:!0,immediate:!0}},computed:{itemsChecked(){return this.items.filter((e=>e.isChecked))}},methods:{async onAction(e,t="proceed"){if(await m(`\n                Are you sure you want to ${t}?\n            `))try{await e()}catch(i){p(`${i}`),console.error(i)}},async mergeSelected(){if(!this.itemsChecked.every((e=>e.isComplete)))return p("One or more patients have missing data. Please update them before merging.",5e3);await this.dde.postMerge(this.itemsChecked)&&(await this.dde.printNpid(this.dde.patientID),g(this.dde.patientID,this.$router))},async reassignIdentifier(e){if(!e.isComplete&&this.ddeEnabled){if(await m("Do you want to update missing information?",{header:"Incomplete Demographics"})){let t=`edit_person=${e.patientID}`;t+="&dde_reassign=true",t+=`&doc_id=${e.docID}`,this.$router.push(`/patient/registration?${t}`)}}else this.onAction((async()=>{this.ddeEnabled?await this.dde.reassignNpid(e.docID,e.patientID)&&await this.dde.printNpid(e.patientID):"function"==typeof e.assignLocalNpidAndPrint&&await e.assignLocalNpidAndPrint(),g(e.patientID,this.$router)}),"Reassign")},buildItems:e=>e.map((e=>{try{const t=new f(e);return{isChecked:!1,patientID:t.getID(),name:t.getFullName(),gender:t.getGender(),birthdate:I.toStandardHisDisplayFormat(t.getBirthdate()),curDistrict:t.getCurrentDistrict(),homeVillage:t.getHomeVillage(),docID:t.getPatientIdentifier(27),isComplete:t.patientIsComplete(),assignLocalNpidAndPrint:async()=>{await t.assignNpid(),await t.printNationalID()}}}catch(t){k("An error has occured while building data"),console.error(t)}return{isChecked:!1,patientID:"N/A",name:"N/A",gender:"N/A",birthdate:"N/A",curDistrict:"N/A",homeVillage:"N/A",docID:"N/A",isComplete:!1}})),clear(){this.items=this.items.map((e=>(e.isChecked=!1,e)))},async init(e){try{if(this.dde=new C,await this.dde.loadDDEStatus(),this.ddeEnabled=this.dde.isEnabled(),this.ddeEnabled){const{locals:t,remotes:i}=await this.dde.findNpid(e);this.items=[...this.buildItems(t),...this.buildItems(i)]}else{const t=await f.findByNpid(e);t&&(this.items=this.buildItems(t))}}catch(t){k(`${t}`,5e3)}}}});e("default",D(t,[["render",function(e,t,i,n,a,s){const d=y("ion-title"),o=y("ion-toolbar"),l=y("ion-header"),r=y("ion-checkbox"),c=y("ion-label"),u=y("ion-button"),h=y("ion-item"),m=y("ion-list"),p=y("ion-content"),g=y("ion-footer"),f=y("ion-page");return _(),b(f,null,{default:w((()=>[N(l,null,{default:w((()=>[N(o,null,{default:w((()=>[N(d,{class:"his-lg-text"},{default:w((()=>[A($(e.title),1)])),_:1})])),_:1})])),_:1}),N(p,null,{default:w((()=>[N(m,null,{default:w((()=>[(_(!0),E(P,null,V(e.items,((i,n)=>(_(),b(h,{class:"his-md-text",key:n},{default:w((()=>[e.ddeEnabled?(_(),b(r,{key:0,slot:"start",modelValue:i.isChecked,"onUpdate:modelValue":e=>i.isChecked=e},null,8,["modelValue","onUpdate:modelValue"])):x("",!0),N(c,{color:i.isComplete?"":"danger"},{default:w((()=>[A($(i.name)+" ("+$(i.gender)+") "+$(i.birthdate)+" ",1),t[1]||(t[1]=z("br",null,null,-1)),t[2]||(t[2]=A(" Current District: ")),z("b",null,$(i.curDistrict||"Unknown"),1),t[3]||(t[3]=A(" Home Village: ")),z("b",null,$(i.homeVillage||"Unknown"),1)])),_:2},1032,["color"]),N(u,{size:"medium",onClick:()=>e.reassignIdentifier(i)},{default:w((()=>t[4]||(t[4]=[A(" Re-Assign ")]))),_:2},1032,["onClick"]),i.isComplete?x("",!0):(_(),b(u,{key:1,size:"medium",color:"warning","router-link":`/patient/registration?edit_person=${i.patientID}`},{default:w((()=>t[5]||(t[5]=[A(" Update Missing Data ")]))),_:2},1032,["router-link"]))])),_:2},1024)))),128))])),_:1})])),_:1}),N(g,null,{default:w((()=>[N(o,{color:"dark"},{default:w((()=>[N(u,{"router-link":"/",color:"danger",slot:"start",size:"large"},{default:w((()=>t[6]||(t[6]=[A(" Cancel ")]))),_:1}),e.itemsChecked.length>0?(_(),b(u,{key:0,onClick:e.clear,color:"warning",slot:"end",size:"large"},{default:w((()=>t[7]||(t[7]=[A(" Clear ")]))),_:1},8,["onClick"])):x("",!0),e.itemsChecked.length>1?(_(),b(u,{key:1,onClick:t[0]||(t[0]=t=>e.onAction(e.mergeSelected,"merge")),color:"primary",size:"large",slot:"end"},{default:w((()=>[A(" Merge ("+$(e.itemsChecked.length)+") ",1)])),_:1})):x("",!0)])),_:1})])),_:1})])),_:1})}]]))}}}));
