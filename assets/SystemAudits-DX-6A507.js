import{d as v,r,o as g,a as D,b as _,w as h,e as y,i as p,H as C,D as w,q as V,y as A,U as S}from"./index-CJleCCtM.js";import{v as $}from"./TableView-CMbHc5dx.js";import{s as P,w as k}from"./v2utils-Czfb_0FR.js";import"./Export-CXTwynHo.js";import"./index-DC9jnrfb.js";const M=v({__name:"SystemAudits",setup(x){const l=r([]),s=r(""),u=r(""),i=r(""),d=A("reports.png"),f=[[{label:"Encounter",ref:"auditable_type"},{label:"Action Type",ref:"action"},{label:"User",ref:"user",toValue:e=>e?"".concat(e.username," (").concat(e.name,")"):""},{label:"Timestamp",ref:"created_at",toValue:C.toStandardHisDisplayFormat},{label:"Changes",ref:"changes",toValue:e=>{var t;return(t=e==null?void 0:e.length)!=null?t:0},tdClick:async e=>{const t=[[{label:"Attribute",ref:"attribute"},{label:"Previous Value",ref:"previous"},{label:"Current Value",ref:"current"}]],n=e.data.changes.map(o=>{const[a,b]=Object.entries(o)[0]||[];return a?/password/i.test(a)?{attribute:a,previous:"*******",current:"*******"}:{attribute:a,...b}:null}).filter(o=>o!==null);await P({title:"Changes made by ".concat(e.data.user.name," on ").concat(e.data.auditable_type),columns:t,columnData:n})}}]],c=()=>k(async()=>{l.value=await S.getAuditReports(u.value,i.value)}),m=()=>w({onFinish:(e,t,n)=>{s.value="".concat(n),u.value=e,i.value=t,c()}});return g(()=>!l.value.length&&m()),(e,t)=>(D(),_(p(V),null,{default:h(()=>[y($,{"default-sort-order":"asc","default-sorted-column":"encounter",title:"System Audits","icon-url":p(d),subtitle:s.value,columns:f,columnData:l.value,rowsPerPage:20,onConfigure:m,onRefresh:c},null,8,["icon-url","subtitle","columnData"])]),_:1}))}});export{M as default};
