import{d as M,r as C,ar as J,t as z,u as p,B as y,x as o,w as s,y as e,z as f,E as D,C as V,a1 as Q,Y as k,G as L,v as S,as as H,Q as w,R as q,O as K,aV as X,Z,_ as Y,$ as j,df as G,U as m,dk as P,a0 as E,ae as ee,S as ae,a3 as $,a4 as te,a8 as oe,bJ as x,bO as se,ab as B,cZ as le,aL as ne,ac as F,dP as _,a5 as ue}from"./index-Cpa1Vu_O.js";import{H as ie}from"./HisStandardForm-XdnY6fvn.js";import{u as re}from"./useEncounter-8lPOhkwU.js";import{r as de}from"./commons-6pz3n8CO.js";import"./isEmpty-_82UNsn5.js";import"./encounter_guidelines-Cl074Os2.js";import"./GuidelineEngine-D6V1_Znr.js";const ce={key:0,class:"side-title"},fe=M({__name:"SideEffects",props:{prevSideEffectState:{type:Object},sideEffects:{type:Object,required:!0},drugs:{type:Array,default:()=>[]}},setup(U){const n=C(""),a=C({}),v=U,R=J(()=>Object.keys(a.value).every(u=>{const l=a.value[u];return Object.keys(l.drugReason).some(c=>l.drugReason[c].isChecked)||"".concat(l.otherReason).length>0}));function h(){H.dismiss()}function T(){const u=[];Object.keys(a.value).forEach(l=>{Object.keys(a.value[l].drugReason).forEach(t=>{a.value[l].drugReason[t].isChecked&&u.push({concept:a.value[l].concept,drug:a.value[l].drugReason[t].detail})}),a.value[l].otherReason&&u.push({concept:a.value[l].concept,other:a.value[l].otherReason})}),H.dismiss({values:u,state:a.value})}function A(u){u.detail.checked&&(a.value[n.value].otherReason="")}function N(){Object.keys(a.value[n.value].drugReason).forEach(u=>{a.value[n.value].drugReason[u].isChecked=!1})}return z(()=>{v.prevSideEffectState?a.value=v.prevSideEffectState:v.sideEffects.forEach(u=>{n.value||(n.value=u.label),a.value[u.label]={concept:u.other.concept,drugReason:v.drugs.reduce((l,t)=>(l[t.drug.name]={isChecked:!1,detail:t},l),{}),otherReason:""}})}),(u,l)=>(p(),y(D,null,[o(e(K),null,{default:s(()=>[o(e(w),null,{default:s(()=>[o(e(q),{class:"his-lg-text"},{default:s(()=>[f("Suspected causes")]),_:1})]),_:1})]),_:1}),o(e(ae),{style:{overflowY:"hidden",background:"grey"}},{default:s(()=>[o(e(X),null,{default:s(()=>[o(e(Z),null,{default:s(()=>[o(e(Y),null,{default:s(()=>[o(e(j),{style:{overflowY:"auto",height:"78vh"}},{default:s(()=>[o(e(G),{modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=t=>n.value=t)},{default:s(()=>[(p(!0),y(D,null,V(a.value,(t,c)=>(p(),S(e(m),{class:"his-md-text",key:c},{default:s(()=>[o(e(P),{slot:"start",value:c},null,8,["value"]),o(e(E),null,{default:s(()=>[f(k(c),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(e(Y),{style:{overflowY:"auto",height:"78vh"}},{default:s(()=>[n.value?(p(),y("div",ce,[Q("b",null,k(n.value),1),f(" causes ")])):L("",!0),n.value?(p(),S(e(j),{key:1},{default:s(()=>[o(e(m),{class:"his-lg-text"},{default:s(()=>[o(e(E),null,{default:s(()=>[f("Current Medication(s)")]),_:1})]),_:1}),(p(!0),y(D,null,V(a.value[n.value].drugReason,(t,c)=>(p(),S(e(m),{class:"his-md-text",key:c},{default:s(()=>[o(e(E),null,{default:s(()=>[f(k(c),1)]),_:2},1024),o(e(ee),{onIonChange:A,slot:"start",modelValue:t.isChecked,"onUpdate:modelValue":b=>t.isChecked=b},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1})):L("",!0),n.value?(p(),S(e(G),{key:2,onIonChange:N,modelValue:a.value[n.value].otherReason,"onUpdate:modelValue":l[1]||(l[1]=t=>a.value[n.value].otherReason=t)},{default:s(()=>[o(e(m),{class:"his-lg-text"},{default:s(()=>[o(e(E),null,{default:s(()=>[f("Previous Medication")]),_:1})]),_:1}),o(e(m),{class:"his-md-text"},{default:s(()=>[o(e(E),null,{default:s(()=>[f("Other, not drug related")]),_:1}),o(e(P),{slot:"start",value:"Other"})]),_:1}),o(e(m),{class:"his-md-text"},{default:s(()=>[o(e(E),null,{default:s(()=>[f("Drug side effect")]),_:1}),o(e(P),{slot:"start",value:"Drug side effect"})]),_:1})]),_:1},8,["modelValue"])):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),o(e(te),null,{default:s(()=>[o(e(w),null,{default:s(()=>[o(e($),{onClick:h,slot:"start",size:"large",color:"danger"},{default:s(()=>[f(" Close ")]),_:1}),o(e($),{onClick:T,size:"large",slot:"end",disabled:!R.value},{default:s(()=>[f(" Save ")]),_:1},8,["disabled"])]),_:1})]),_:1})],64))}}),_e=oe(fe,[["__scopeId","data-v-feb7a6c4"]]),Se=M({__name:"Complications",setup(U){const n=C([]),a=new x(-1,se.COMPLICATIONS),v=C([]),R=C({}),h={pageOne:{"Abnominal pain":"ABNOMINAL_PAIN",Athralgia:"ATHRALGIA","Colour body fluids":"COLOUR_BODY_FLUIDS",Depression:"DEPRESSION",Fatigue:"FATIGUE",Gastrointestinal:"GASTROINTESTINAL",Headache:"HEADACHE","Hearing Difficulties":"HEARING_DIFFICULTIES",Hematological:"HEMATOLOGICAL",Hepatoxicity:"HEPATOXICITY",Hypothyroidism:"HYPOTHYROIDISM",Itching:"SKIN_ITCHING"},pageTwo:{Jaundice:"JAUNDICE","Lactic Acidosis":"LACTIC_ACIDOSIS",Numbness:"NUMBNESS_IN_HANDS_FEET_LEGS","Optic Neuritis":"OPTIC_NEURITIS",Pancreatitis:"PANCREATITIS","Periferal Neuropathy":"PERIFERAL_NEUROPATHY",Psychosis:"PSYCHOSIS","QT Prolongation":"QT_PROLONGATION","Renal failure":"RENAL_FAILURE","Skin Rash":"SKIN_RASH",Toxicity:"TOXICITY"}},{goToNextTask:T,patientDashboardUrl:A}=re((l,t)=>{a.patientID=t,a.providerID=l;function c(){let d=[];return{id:"history",helpText:"Side effects / Contraindications history",type:B.TT_TABLE_VIEWER,init:async()=>{const O=await x.getJson("programs/".concat(a.programID,"/patients/").concat(t,"/medication_side_effects"),{date:a.date});return Object.keys(O).forEach(i=>{d.push([le(i),Object.values(O[i]).flat(1).map(r=>"<b>".concat(r.name,"</b> ").concat(r.drug_induced?"(Drug-induced)":""," : ").concat(r.drug||"Unknown"," ")).join("<p/>")])}),!0},condition:()=>d.length,options:()=>[{label:"",value:"",other:{columns:["Date","Condition"],rows:d}}]}}function b(){return Object.keys(h).map((d,O)=>({id:d,helpText:"Page ".concat(O+1,": Contraindications / Side effects"),type:B.TT_MULTIPLE_YES_NO,init:async()=>(ne.isEmpty(v.value)&&(v.value=await x.getJson("patients/".concat(t,"/last_drugs_received"),{program_id:a.programID})),!0),beforeNext:async i=>{const r=i.filter(I=>I.value==="YES_ANSWER");if(r.length){const I=await H.create({component:_e,backdropDismiss:!1,cssClass:"large-modal",componentProps:{sideEffects:r,drugs:v.value}});I.present();const{data:g}=await I.onDidDismiss();if(!g)return!1;R.value[d]=g.values}return!0},validation:i=>F.validateSeries([()=>F.required(i),()=>F.anyEmpty(i)]),computedValue:i=>i.map(r=>({concept_id:_("MALAWI_TB_SIDE_EFFECTS"),value_coded:_("".concat(r.other.concept)),child:[{concept_id:_("".concat(r.other.concept)),value_coded:_("".concat(r.value)),obs_datetime:a.date}],obs_datetime:a.date})),options:i=>Object.keys(h[d]).map(r=>{var I,g;return{label:r,value:((g=(I=i[d])==null?void 0:I.find(W=>W.label===r))==null?void 0:g.value)||"",other:{concept:h[d][r],values:[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]}}}),config:{footerBtns:[{name:"None",slot:"end",onClickComponentEvents:{refreshOptions:()=>Object.keys(h[d]).map(i=>({label:i,value:"NO_ANSWER",other:{concept:h[d][i],values:[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]}}))},onClick:()=>"None"}]}}))}n.value=[c(),...b()]});function N(){return Object.values(R.value).flat(1).map(t=>t.other&&/drug/i.test(t.other)?{concept_id:_("DRUG_INDUCED"),value_coded:_(t.concept),value_text:"Past medication history"}:t.drug?{concept_id:_("DRUG_INDUCED"),value_coded:_(t.concept),value_drug:t.drug.drug.drug_id}:{concept_id:_("CONTRAINDICATIONS"),value_coded:_(t.concept)})}async function u(l,t){await a.createEncounter(),await a.saveObservationList([...await de(t),...N()]),T()}return(l,t)=>(p(),S(e(ue),null,{default:s(()=>[o(ie,{cancelDestinationPath:e(A),onFinishAction:u,fields:n.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{Se as default};
