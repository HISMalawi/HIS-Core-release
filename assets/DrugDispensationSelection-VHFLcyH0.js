import{V as E}from"./ViewPort-kkmofE00.js";import{d as S,O as C,ck as N,_ as V,r as c,o as r,x as d,b as a,w as u,A as e,v as h,F as k,y as D,ar as M,u as y,a3 as I,a4 as z,af as R,aj as H,ak as T,ab as q,q as F,c as Q,z as A}from"./index-hoLU9YgK.js";import{O as U}from"./ActionSideButton-A1Ifbsj9.js";import{R as j}from"./ResetButton-17rWFPmA.js";import{_ as L}from"./FieldMixin.vue_vue_type_script_lang-iJxb79-6.js";const G=S({data:()=>({listData:[],tabsIndex:2,packsIndex:3}),props:{drugName:{type:String,required:!0},tabsNeeded:{type:String,required:!0},items:{type:Array,required:!0},onDispense:{type:Function,required:!0}},computed:{dispensedValues(){return this.listData.filter(t=>t[this.tabsIndex]>0).map(t=>[t[this.tabsIndex],t[this.packsIndex]])},amountNeededRowSpan(){return this.listData.length+1}},watch:{items:{handler(t){t&&(this.listData=[...t])},deep:!0,immediate:!0}},methods:{async onClose(){await C.dismiss({})},incrementAmount(t){const[n,,i,p]=this.listData[t],o=n+i,m=p+1;this.listData[t][2]=o,this.listData[t][3]=m},decrementAmount(t){const[n,,i,p]=this.listData[t],o=p-1;if(o>=0){const m=i-n;this.listData[t][2]=m,this.listData[t][3]=o}},fmtNumber(t){return/-/i.test(t)?t:N(t)}}}),B=t=>(I("data-v-278bd60b"),t=t(),z(),t),J={colspan:"6"},K=B(()=>e("tr",null,[e("th",null,"Total tab(s) needed "),e("th",{colspan:"2"}," Available stock "),e("th",{colspan:"2"}," Dispensed "),e("th")],-1)),W=B(()=>e("tr",null,[e("th"),e("th",null," Pack size "),e("th",null," Packs "),e("th",null," Total Tab(s)"),e("th",null," Packs "),e("th")],-1)),X=["rowspan"],Y={class:"btn-list"};function Z(t,n,i,p,o,m){const l=c("ion-button"),b=c("ion-content"),g=c("ion-toolbar"),w=c("ion-footer");return r(),d(k,null,[a(b,null,{default:u(()=>[e("table",null,[e("thead",null,[e("tr",null,[e("th",J,h(t.drugName),1)]),K,W]),e("tbody",null,[e("tr",null,[e("td",{rowspan:t.amountNeededRowSpan},h(t.tabsNeeded)+" tab(s) ",9,X)]),(r(!0),d(k,null,D(t.listData,(v,_)=>(r(),d("tr",{key:_},[(r(!0),d(k,null,D(v,(f,s)=>(r(),d("td",{key:s,class:M(s>=2?"input-field":"his-md-text")},h(t.fmtNumber(f)),3))),128)),e("td",null,[e("ul",Y,[e("li",null,[a(l,{onClick:f=>t.incrementAmount(_),class:"dispense-btn",size:"large"},{default:u(()=>[y(" + ")]),_:2},1032,["onClick"])]),e("li",null,[a(l,{onClick:f=>t.decrementAmount(_),class:"dispense-btn",size:"large"},{default:u(()=>[y(" - ")]),_:2},1032,["onClick"])])])])]))),128))])])]),_:1}),a(w,null,{default:u(()=>[a(g,null,{default:u(()=>[a(l,{onClick:t.onClose,color:"danger",size:"large",slot:"end"},{default:u(()=>[y(" Close ")]),_:1},8,["onClick"]),a(l,{onClick:n[0]||(n[0]=v=>t.onDispense(t.dispensedValues)),color:"success",size:"large",slot:"end"},{default:u(()=>[y(" Dispense ")]),_:1})]),_:1})]),_:1})],64)}const x=V(G,[["render",Z],["__scopeId","data-v-278bd60b"]]),tt=S({components:{ViewPort:E,Barcode:R,NavButton:U,ResetButton:j,IonRow:H,IonCol:T},mixins:[L],data:()=>({tab:"prescribe",listData:[],medicationHistory:[],isStockManagementEnabled:!1}),mounted(){this.init()},activated(){this.init()},watch:{tab:{handler(t){t==="history"&&q.isEmpty(this.medicationHistory)&&typeof this.config.medicationHistory=="function"&&this.config.medicationHistory().then(n=>{n&&(this.medicationHistory=n)}).catch(n=>{F("".concat(n))})}}},methods:{async init(){var t,n;this.$emit("onFieldActivated",this),typeof((t=this.config)==null?void 0:t.isDrugManagementEnabled)=="function"&&(this.isStockManagementEnabled=(n=this.config)==null?void 0:n.isDrugManagementEnabled()),this.listData=await this.options(this.fdata)},async onScan(t){const[n,i]=t.split("-"),p=this.listData.map(async o=>{if(o.other.drug_id===parseInt(n)){const m=parseInt(o.value.toString()),l=parseInt(i);await this.updateOnValue(o,l,[],!0)&&(o.value=l+m)}return o});this.listData=await Promise.all(p)},async onReset(t){await this.updateOnValue(t,-1)},fmtNumber(t){return!this.isStockManagementEnabled||/-/i.test(t)?"-":N(t)},async updateOnValue(t,n,i=[],p=!1){return this.onValue&&!await this.onValue({label:t.label,other:{dispenses:i,...t.other},value:n},p)?!1:(t.value=n<0?0:n,this.$emit("onValue",t),this.onValueUpdate&&(this.listData=await this.onValueUpdate(t,this.listData)),!0)},async launchDispenser(t){(await C.create({component:x,backdropDismiss:!1,cssClass:"custom-modal",componentProps:{drugName:t.label,tabsNeeded:t.other.amount_needed,items:t.other.pack_sizes,onDispense:async i=>{const o=i.reduce((l,b)=>l+b[0],0);await this.updateOnValue(t,o,i)&&await C.dismiss({})}}})).present()}}}),O=t=>(I("data-v-b8f05877"),t=t(),z(),t),et={class:"view-port-content"},nt={key:0,class:"his-card history"},st={class:"his-table"},ot=O(()=>e("tr",null,[e("th",null," Medication"),e("th",null," Date"),e("th",null," Amount dispensed ")],-1)),at={key:1,class:"prescription-tab"},it={class:"prescription-table-section his-card"},lt={class:"his-table"},rt=O(()=>e("tr",null,[e("th",null," Medication"),e("th",null," Amount in stock"),e("th",null," Amount needed"),e("th",null," Amount dispensed "),e("th",null," Reset ")],-1)),ct={class:"barcode-section"};function ut(t,n,i,p,o,m){const l=c("nav-button"),b=c("ion-col"),g=c("ion-input"),w=c("reset-button"),v=c("barcode"),_=c("ion-row"),f=c("view-port");return r(),Q(f,null,{default:u(()=>[e("div",et,[a(_,null,{default:u(()=>[a(b,{size:"2"},{default:u(()=>[a(l,{onClick:n[0]||(n[0]=s=>t.tab="prescribe"),isActive:t.tab==="prescribe",image:"prescription/rx",label:"Prescribed"},null,8,["isActive"]),a(l,{onClick:n[1]||(n[1]=s=>t.tab="history"),isActive:t.tab==="history",image:"prescription/history",label:"History"},null,8,["isActive"])]),_:1}),a(b,{size:"10"},{default:u(()=>[t.tab==="history"?(r(),d("div",nt,[e("table",st,[ot,(r(!0),d(k,null,D(t.medicationHistory,(s,$)=>(r(),d("tr",{key:$},[e("td",null,h(s.medication),1),e("td",null,h(s.date),1),e("td",null,h(s.amount),1)]))),128))])])):A("",!0),t.tab==="prescribe"?(r(),d("div",at,[e("div",it,[e("table",lt,[rt,(r(!0),d(k,null,D(t.listData,(s,$)=>(r(),d("tr",{key:$},[e("td",null,h(s.label),1),e("td",null,h(t.fmtNumber(s.other.available_stock)),1),e("td",null,h(s.other.amount_needed),1),e("td",null,[a(g,{disabled:s.value>0,value:s.value,onClick:P=>s.value<=0?t.launchDispenser(s):null,class:"dosage-input"},null,8,["disabled","value","onClick"])]),e("td",null,[a(w,{label:"",disabled:s.value<=0,onClick:P=>s.value>0?t.onReset(s):null},null,8,["disabled","onClick"])])]))),128))])]),e("div",ct,[a(v,{onOnScan:t.onScan,class:"his-card"},null,8,["onOnScan"])])])):A("",!0)]),_:1})]),_:1})])]),_:1})}const _t=V(tt,[["render",ut],["__scopeId","data-v-b8f05877"]]);export{_t as default};
