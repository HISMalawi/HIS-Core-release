import{_ as w}from"./ReportMixin.vue_vue_type_script_lang-r1arG92A.js";import{R as u}from"./TableReportTemplate-A4sKSoQg.js";import{d as c,I as _,L as e,ab as g,cx as f,_ as m,r as h,o as D,c as F,w as L,b as v}from"./index-iM2cGz0p.js";import{V as T}from"./viral_load_report-qvaWmZ2L.js";import"./MultiFieldDateHelper-BIZNjBD7.js";import"./dynamic-import-helper-9HnG3Mif.js";import"./KbLayouts-9dqmDWmG.js";import"./HisKbConfigurations-a7K7dizM.js";import"./BasicReportTemplate-Cy-G-sIO.js";import"./Export-VO9zGhWb.js";import"./SIngleTouchField-TVlhbHrr.js";import"./Pagination-nCJl9BUM.js";import"./HisStandardForm-tiWNF5wA.js";import"./TouchScreenForm-hvB0I83y.js";import"./ToolbarMediumCard-ny9gUih7.js";import"./Transformers-XlEF3tgP.js";import"./ViewPort-4mhPlN2U.js";import"./ReportErrors-SvbbPxAT.js";const V=c({mixins:[w],components:{ReportTemplate:u,IonPage:_},data:()=>({title:"VL Coverage report",cohort:{},rows:[],totals:{F:{},M:{}},columns:[[e.thTxt("",{colspan:4,exportable:!1}),e.thTxt("Sample Drawn",{colspan:2,exportable:!1}),e.thTxt("High VL (>=1000 copies)",{colspan:2,exportable:!1}),e.thTxt("Low VL (<1000 copies)",{colspan:2,exportable:!1})],[e.thTxt("Age group"),e.thTxt("Gender"),e.thTxt("Due for VL"),e.thTxt("Routine",{value:"Routine (Sample Drawn)"}),e.thTxt("Targeted",{value:"Targeted (Sample Drawn)"}),e.thTxt("Routine",{value:"Routine (High VL (>=1000 copies))"}),e.thTxt("Targeted",{value:"Targeted High VL (>=1000 copies)"}),e.thTxt("Routine",{value:"Routine (Low VL (<1000 copies))"}),e.thTxt("Targeted",{value:"Targeted (Low VL (<1000 copies))"})]]}),created(){this.fields=this.getDateDurationFields()},methods:{async onPeriod(t,i){this.rows=[],this.totals={F:{},M:{}},this.report=new T,this.report.setOccupation(i.occupation),this.report.setStartDate(i.start_date),this.report.setEndDate(i.end_date),this.period=this.report.getDateIntervalPeriod(),this.cohort=await this.report.getVLCoverage(),await this.setRows("F"),await this.setRows("M"),this.setAllMalesTotalsRow(),await this.setFemaleTotalsRow()},setTotals(t,i,r){this.totals[i][t]||(this.totals[i][t]=[]),this.totals[i][t]=this.totals[i][t].concat(r)},drillDown(t,i){if(t.length>=1){const r=[[e.thTxt("ARV #"),e.thTxt("DOB"),e.thTxt("Gender"),e.thTxt("Action")]],s=()=>this.sortByArvNumber(t).map(o=>[this.tdARV(o.arv_number),e.tdDate(o.birthdate),e.td(this.formatGender(o.gender)),e.tdBtn("Show",()=>this.$router.push({path:"/patient/dashboard/".concat(o.patient_id)}))]);return e.tdLink(t.length,()=>this.drilldownAsyncRows(i,r,s))}return e.td(0)},async setFemaleTotalsRow(){const t=this.totals.F,i=Object.values(t).reduce((a,n)=>g.uniq(a.concat(n.map(d=>d.patient_id))),[]),r=await this.report.getMaternalStatus(i),s=r.FBf.concat(r.FP),o=(a,n)=>n.filter(d=>r[a].includes(d.patient_id)),l=a=>a.filter(n=>!s.includes(n.patient_id));this.rows.push([e.td("All"),e.td("FP"),this.drillDown(o("FP",t.due_for_vl),"Due for VL FP"),this.drillDown(o("FP",t.drawn_routine),"Routine (Sample Drawn) FP"),this.drillDown(o("FP",t.drawn_targeted),"Targetted (Sample Drawn) FP"),this.drillDown(o("FP",t.high_vl_routine),"Routine (High VL (>=1000 copies)) FP"),this.drillDown(o("FP",t.high_vl_targeted),"Targeted High VL (>=1000 copies) FP"),this.drillDown(o("FP",t.low_vl_routine),"Routine (Low VL (<1000 copies)) FP"),this.drillDown(o("FP",t.low_vl_targeted),"Targeted (Low VL (<1000 copies)) FP")]),this.rows.push([e.td("All"),e.td("FNP"),this.drillDown(l(t.due_for_vl),"Due for VL FNP"),this.drillDown(l(t.drawn_routine),"Routine (Sample Drawn) FNP"),this.drillDown(l(t.drawn_targeted),"Targetted (Sample Drawn) FNP"),this.drillDown(l(t.high_vl_routine),"Routine (High VL (>=1000 copies)) FNP"),this.drillDown(l(t.high_vl_targeted),"Targeted High VL (>=1000 copies) FNP"),this.drillDown(l(t.low_vl_routine),"Routine (Low VL (<1000 copies)) FNP"),this.drillDown(l(t.low_vl_targeted),"Targeted (Low VL (<1000 copies)) FNP")]),this.rows.push([e.td("All"),e.td("FBF"),this.drillDown(o("FBf",t.due_for_vl),"Due for VL FBf"),this.drillDown(o("FBf",t.drawn_routine),"Routine (Sample Drawn) FBf"),this.drillDown(o("FBf",t.drawn_targeted),"Targetted (Sample Drawn) FBf"),this.drillDown(o("FBf",t.high_vl_routine),"Routine (High VL (>=1000 copies)) FBf"),this.drillDown(o("FBf",t.high_vl_targeted),"Targeted High VL (>=1000 copies) FBf"),this.drillDown(o("FBf",t.low_vl_routine),"Routine (Low VL (<1000 copies)) FBf"),this.drillDown(o("FBf",t.low_vl_targeted),"Targeted (Low VL (<1000 copies)) FBf")])},setAllMalesTotalsRow(){const t=this.totals.M;return this.rows.push([e.td("All"),e.td("Male"),this.drillDown(t.due_for_vl,"Due for VL Male"),this.drillDown(t.drawn_routine,"Routine (Sample Drawn) Male"),this.drillDown(t.drawn_targeted,"Targetted (Sample Drawn) Male"),this.drillDown(t.high_vl_routine,"Routine (High VL (>=1000 copies)) Male"),this.drillDown(t.high_vl_targeted,"Targeted High VL (>=1000 copies) Male"),this.drillDown(t.low_vl_routine,"Routine (Low VL (<1000 copies)) Male"),this.drillDown(t.low_vl_targeted,"Targeted (Low VL (<1000 copies)) Male")])},async setRows(t){const i=this.formatGender(t);for(const r of f)if(r in this.cohort){const s=this.cohort[r],o=(l,a,n)=>{const d=a.filter(p=>p.gender===t);return this.setTotals(l,t,d),this.drillDown(d,n)};this.rows.push([e.td(r),e.td(i),o("due_for_vl",s.due_for_vl,"".concat(r," Due for VL (").concat(i,")")),o("drawn_routine",s.drawn.routine,"".concat(r," Routine (Sample Drawn) (").concat(i,"s)")),o("drawn_targeted",s.drawn.targeted,"".concat(r," Targeted (Sample Drawn) (").concat(i,"s)")),o("high_vl_routine",s.high_vl.routine,"".concat(r," Routine (High VL (>=1000 copies)) (").concat(i,"s)")),o("high_vl_targeted",s.high_vl.targeted,"".concat(r," Targeted High VL (>=1000 copies) (").concat(i,"s)")),o("low_vl_routine",s.low_vl.routine,"".concat(r," Routine (Low VL (<1000 copies)) (").concat(i,"s)")),o("low_vl_targeted",s.low_vl.targeted,"".concat(r," Targeted (Low VL (<1000 copies)) (").concat(i,"s)"))])}else this.rows.push([e.td(r),e.td(i),e.td(0),e.td(0),e.td(0),e.td(0),e.td(0),e.td(0)])}}});function R(t,i,r,s,o,l){const a=h("report-template"),n=h("ion-page");return D(),F(n,null,{default:L(()=>[v(a,{title:t.title,period:t.period,rows:t.rows,fields:t.fields,columns:t.columns,config:{showIndex:!0},reportPrefix:"PEPFAR",onReportConfiguration:t.onPeriod},null,8,["title","period","rows","fields","columns","onReportConfiguration"])]),_:1})}const U=m(V,[["render",R]]);export{U as default};
