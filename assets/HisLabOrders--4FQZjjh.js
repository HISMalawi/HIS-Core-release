import{d as $,bW as C,a8 as S,ay as B,el as T,em as F,en as H,H as d,ci as c,ao as g,W as v,aj as A,au as E,aN as L,dB as N,R as P,am as R,aa as V,af as f,a as l,c as z,w as u,K as t,E as m,J as w,G as b,a2 as o,C as I,aJ as W,b as a}from"./index-CMZASHAR.js";import{L as x}from"./LabOrderModal-BUwI49Wy.js";import{_ as G}from"./FieldMixin.vue_vue_type_script_lang-Bg-mZnL5.js";import{p as J}from"./VoidReason-H99Hq1yQ.js";import"./lab_order_service-DVn-Zq6K.js";const j=$({components:{ViewPort:C,IonButton:S,IonIcon:B},mixins:[G],data:()=>({trash:T,print:F,pencil:H,HisDate:d,rows:[],fetchingOrders:!1,ordersToday:{}}),methods:{async init(){this.$emit("onFieldActivated",this),this.fetchingOrders=!0;let r=[];try{r=await this.options(this.fdata)}catch(s){console.error("".concat(s))}this.fetchingOrders=!1;const e=r[0].other.values;this.ordersToday=e.reduce((s,i)=>(c(i.ordered)===c(g.getSessionDate())&&!i.result.length&&(s[i.test_name]=!0),s),{}),this.rows=e.map(s=>(s.id=s.order_id,s.ordered&&(s.ordered=d.toStandardHisDisplayFormat(s.ordered)),s.released&&(s.released=d.toStandardHisDisplayFormat(s.released)),s))},async printOrder(r){var e;if(c(r.ordered)!=c(g.getSessionDate()))return v("Printing order #".concat(r.accession_number," is restricted to today. Consider using BDE mode/set session date to the order date"));typeof((e=this.config)==null?void 0:e.printOrder)=="function"&&await A("Do you want to print order with accession number ".concat(r.accession_number,"?"))&&this.config.printOrder(r.id)},formatOrders(r){return r.map(e=>({id:e.order_id,encounter_id:e.encounter_id,result_given:e.result_given,accession_number:e.accession_number,test_name:e.tests[0].name,specimen:e.specimen.name,ordered:d.toStandardHisDisplayFormat(e.order_date),result:[],release:""}))},async launchOrderSelection(r=null){if(this.fetchingOrders)return v("Please wait....");const e=await E.create({component:x,backdropDismiss:!1,cssClass:"large-modal",componentProps:{testFilters:r,ordersToday:this.ordersToday,onOrderAdded:i=>this.ordersToday[i]=!0}});e.present();const{data:s}=await e.onDidDismiss();L.isEmpty(s)||(this.rows=[...this.formatOrders(s),...this.rows])},voidOrder(r){J(async e=>{new N(-1).voidOrder(r.order_id,e).then(()=>{this.rows=this.rows.filter(s=>s.order_id!=r.order_id),P("Record has been voided successfully!")}).catch(s=>{R("An error has occured while deleting order: ".concat(s))})})}},mounted(){this.init()},activated(){this.init()}}),K={class:"view-port-content"},M={class:"his-sm-text"};function Y(r,e,s,i,q,Q){const p=f("ion-icon"),_=f("ion-button"),O=f("view-port");return l(),z(O,null,{default:u(()=>[t("div",K,[t("table",M,[e[1]||(e[1]=t("tr",null,[t("th",null,"Accession #"),t("th",null,"Test Name"),t("th",null,"Specimen"),t("th",null,"Ordered"),t("th",null,"Result"),t("th",null,"Released"),t("th",null,"Given"),t("th",null,"Action")],-1)),(l(!0),m(w,null,b(r.rows,(n,D)=>{var y;return l(),m("tr",{key:D},[t("td",null,o(n.accession_number),1),t("td",null,o(n.test_name),1),t("td",null,o(n.specimen),1),t("td",null,o(n.ordered),1),t("td",null,[(l(!0),m(w,null,b(n.result,(h,k)=>(l(),m("span",{key:k},[I(o(h)+" ",1),e[0]||(e[0]=t("br",null,null,-1))]))),128))]),t("td",null,o(n.released),1),t("td",null,[t("span",{style:W("color: ".concat(n.result_given==="Yes"?"green;":"black;"))},o(n.result_given),5)]),t("td",null,[a(_,{onClick:h=>r.printOrder(n)},{default:u(()=>[a(p,{size:"large",icon:r.print},null,8,["icon"])]),_:2},1032,["onClick"]),a(_,{disabled:n.delivery_mode?n.delivery_mode!="test_results_delivered_to_site_manually":!1,color:"success"},{default:u(()=>[a(p,{size:"large",icon:r.pencil},null,8,["icon"])]),_:2},1032,["disabled"]),a(_,{disabled:n.delivery_mode!="test_results_delivered_to_site_manually"&&((y=n.result)!=null?y:[]).length>=1,onClick:h=>r.voidOrder(n),color:"danger"},{default:u(()=>[a(p,{size:"large",icon:r.trash},null,8,["icon"])]),_:2},1032,["disabled","onClick"])])])}),128))])])]),_:1})}const re=V(j,[["render",Y],["__scopeId","data-v-07fd4d82"]]);export{re as default};
