System.register(["./index-legacy-Dx_PXhkv.js","./disaggregated_service-legacy-BFkI5EPp.js","./regimen_report_service-legacy-B7xCY7IS.js","./moh_cohort_service-legacy-b3YZF8uK.js","./ArtDrilldown-legacy-DqBgrlw_.js","./TableView-legacy-BlS6nANK.js","./ReportErrors-legacy-D7ibYEif.js","./fuse-legacy-CQoBB3MK.js","./Export-legacy-CSZpFAtY.js","./HisKeyboard-legacy-BFoifhRH.js"],(function(e,t){"use strict";var a,r,o,n,l,i,s,c,u,d,g,p,v,m,b,y,f,h,_,D,$,x,q,w,R,A,F,j;return{setters:[e=>{a=e.d,r=e.I,o=e.ch,n=e.E,l=e.K,i=e.N,s=e.ct,c=e.ac,u=e.n,d=e.q,g=e.bK,p=e.cu,v=e.cv,m=e.O,b=e.cx,y=e.cy,f=e._,h=e.r,_=e.o,D=e.c,$=e.w,x=e.b},e=>{q=e.D},e=>{w=e.R},e=>{R=e.M},e=>{A=e.A},e=>{F=e.v},e=>{j=e.R},null,null,null],execute:function(){const t=a({components:{IonPage:r,IonLoading:o,v2Datatable:F},setup(){const e=n(),t=l(!1),a=l([]),r=l(""),o=l(""),f=l(!1),h=new q,_=new R,D=l([]),$=async e=>{(await m.create({component:A,backdropDismiss:!1,cssClass:"large-modal",componentProps:{...e,subtitle:r.value,onFinish:()=>m.getTop().then((e=>e&&m.dismiss()))}})).present()},x=(e,t)=>({ref:t,label:e,defaultValue:"0",toValue:e=>e.length,tdClick:async e=>{e.refData.length&&$({patientIdentifiers:e.refData,title:`${e.data.age_group} ${e.data.gender} ${e.column.label}`})}}),F=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},x("TX curr (receiving ART)","tx_curr"),...w.map((e=>x(e,e))),x("Unknown","N/A"),x("Total (regimen)","regimen_total")]],P=function(e){const t=D.value.findIndex((t=>t.id===e.id));-1!==t?D.value[t]=e:D.value.push(e)},T=async function(e){const t="validation";(await m.create({id:t,component:j,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:e}})).present(),P({id:t,text:`<b>${e.length}</b> validation errors detected`,icon:y,color:"danger",action:()=>T(e)})},I=async(e=!1)=>{if(!t.value)return d("Unable to generate report, return to cohort report");f.value=!0;try{a.value=[];const t=(await h.getDisaggReport(e,"moh")).reduce(((e,t)=>{if(/unknown/i.test(t.age_group))return e;const a=`${t.gender}`.toUpperCase();return e[a]&&e[a].push({...t,gender:g(t.gender)}),["M","F"].includes(a)&&!/all/i.test(t.age_group)&&(e.totalAlive=[...e.totalAlive,...t.tx_curr]),e}),{M:[],F:[],FP:[],FBF:[],FNP:[],totalAlive:[]});a.value=[...t.F,...t.M,...t.FP,...t.FNP,...t.FBF].map(((e,t)=>({index:t+1,...e}))),P({text:`Total alive and on ART: <b>${t.totalAlive.length}</b>`,icon:p,color:"primary",action:()=>$({patientIdentifiers:t.totalAlive,title:`Total alive and on ART: ${t.totalAlive.length}`})}),(async e=>{const t={total_alive_and_on_art:{param:e.length,check:(e,t)=>e!=t,error:(e,t)=>`\n                        Total alive of <b>${t}</b>\n                        Does not match total alive of <b>${e}</b> on MOH report\n                    `}};-1===_.validateIndicators(t,(e=>{e.length?T(e):P({id:"validation",text:"<b>Report is consistent</b>",icon:b,color:"success"})}))&&T(["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])})(t.totalAlive)}catch(r){const e="Unable to generate report!";d(e),D.value=[{text:e,color:"danger",icon:v,action:function(){D.value=[{text:`Exception occured: <b>${r}</b>`,color:"danger",icon:v}]}}]}f.value=!1,o.value=""};return i((()=>{t.value=!!(e.query.start_date&&e.query.end_date&&e.query.quarter),t.value&&(h.setStartDate(`${e.query.start_date}`),h.setEndDate(`${e.query.end_date}`),h.setOccupation(`${e.query.occupation}`),_.setOccupation(h.occupation),_.setStartDate(h.startDate),_.setEndDate(h.endDate),r.value=`${s(h.startDate)} to ${s(h.endDate)}`,e.query.quarter&&(h.setQuarter(`${e.query.quarter}`),_.setQuarter(h.quarter),r.value=`${"Custom"===h.quarter?r.value:h.quarter}`),I())})),{Img:c,onRegenerate:async()=>I(await u("Do you want to rebuild report?")),headerBadge:D,reportData:a,isLoading:f,generate:I,columns:F,period:r}}});e("default",f(t,[["render",function(e,t,a,r,o,n){const l=h("ion-loading"),i=h("v2Datatable"),s=h("ion-page");return _(),D(s,null,{default:$((()=>[x(l,{"is-open":e.isLoading,message:"Please wait.."},null,8,["is-open"]),x(i,{"icon-url":e.Img("login-logos/Malawi-Coat_of_arms_of_arms.png"),title:"Disaggregated report","report-prefix":"MoH",subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onRefresh:e.onRegenerate,headerBadge:e.headerBadge},null,8,["icon-url","subtitle","columns","columnData","onRefresh","headerBadge"])])),_:1})}]]))}}}));
