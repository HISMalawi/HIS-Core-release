import{d as ae,Y as re,$ as se,ay as le,a6 as ie,Z as ce,X as ue,a8 as de,a9 as fe,_ as ge,c3 as pe,ag as ve,r as b,at as K,aL as _e,c6 as me,c7 as be,c8 as ye,c9 as he,ca as Ce,dU as De,bd as Ie,ao as w,bC as te,aN as W,aa as ne,af as p,a as c,E as _,b as f,w as d,C as P,a2 as Y,M as k,K as I,c as V,J as $,G as U,b7 as we,aJ as Se,I as Oe,cJ as Te,o as ke,W as $e,am as Ne,aE as Ae,ci as j,au as z,ad as x,ae as B,H as Re}from"./index-CMZASHAR.js";import{b as Ee,a as He}from"./Export-CpyT9Gk1.js";import{C as Me}from"./cxca_report_service-BLTGK-Am.js";import{D as Ve}from"./DrillPatientIds-CwQBWjf6.js";import"./index-_zuoFVCp.js";import"./TableView-DhTjQT8r.js";const Fe=ae({components:{IonToolbar:re,IonItem:se,IonIcon:le,IonLabel:ie,IonTitle:ce,IonHeader:ue,IonButton:de,IonFooter:fe,IonContent:ge,IonButtons:pe},props:{title:{type:String,default:"Report"},subtitle:{type:String},columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},onFinish:{type:Function},onRefresh:{type:Function},onConfigure:{type:Function},csvQuarter:{type:String},headers:{type:Array,default:()=>[]},order:{type:Array,default:()=>[]},csvSpacing:{type:Number},csvSubHeader:{type:Array,default:()=>[]},csvData:{type:Array,default:()=>[]}},setup(n){const u=ve(),S=b([]),O=b(""),h=b("desc"),A=K(()=>n.columns.slice(0,1)),C=K(()=>{var s;const o=[];return(s=n.columnData)==null||s.forEach(e=>{const a=n.columns[1].map(t=>{let r="",l={},i=1;try{W.isEmpty(e)?r="...":typeof t.value=="function"?r=t.value(e):r=e[t.ref]||""}catch(y){r="_ERROR_",console.error(y)}return typeof t.dataStyle=="function"&&(l=t.dataStyle(e)),typeof t.colSpan=="function"&&(i=t.colSpan(e)),{column:t,data:e,value:r,styling:l,colSpan:i,[t.ref||"nada"]:r}});o.push({row:a,data:e,searchIndex:[...a,a.map(t=>t.value).join(" ")]})}),o}),m=o=>{O.value=o,h.value=h.value==="asc"?"desc":"asc"},v=()=>{typeof n.onFinish=="function"?n.onFinish():u.push("/")},R=o=>{var s,e;try{typeof((s=o.column)==null?void 0:s.tdClick)=="function"&&((e=o.column)==null||e.tdClick(o));return}catch(a){console.error(a)}},T=()=>n.columns.reduce((o,s)=>o.concat(s),[]).filter(o=>o.value||o.ref),E=()=>{var s;const o=(s=window==null?void 0:window.document)==null?void 0:s.getElementById("report-content");Ee("\n                <html>\n                    <head> \n                        <style> \n                        table {\n                            border-collapse: collapse;\n                        }\n                        th, td {\n                            width: 4%;\n                            text-align: left;\n                            border: solid 1px black;\n                        }\n                        td {\n                            border-bottom: 1px solid rgb(165, 165, 165);\n                            padding: 0.6em;\n                            font-weight: 500;\n                            font-size: .8em;\n                        }\n                        </style>    \n                    </head>\n                <body> \n                 ".concat(o.innerHTML,"    \n                </body>\n                </html>\n            "))},F=()=>{const o="".concat(w.getLocationName()||"Unknown site","-").concat(n.title,"-").concat(n.subtitle,"-").concat(w.getSessionDate());He([n.headers],[...n.csvData,["Date Created: ".concat(te().format("DD/MMM/YYYY HH:MM:ss"))],["Quarter: ".concat(n.csvQuarter||n.subtitle)],["HIS-Core Version: ".concat(w.getCoreVersion())],["API Version: ".concat(w.getApiVersion())],["Site UUID: ".concat(w.getSiteUUID())],["Generated by: ".concat(w.getUserName())]],o)},H=o=>{o.forEach(s=>{const e=T().map(a=>{let t="",r={},l=1;try{W.isEmpty(s)?t="...":typeof a.value=="function"?t=a.value(s):t=s[a.ref]||""}catch(i){t="_ERROR_",console.error(i)}return typeof a.dataStyle=="function"&&(r=a.dataStyle(s)),typeof a.colSpan=="function"&&(l=a.colSpan(s)),{column:a,data:s,value:t,styling:r,colSpan:l,[a.ref||"nada"]:t}});S.value.push({row:e,data:s,searchIndex:[...e,e.map(a=>a.value).join(" ")]})})};return _e(()=>n.columnData,o=>{S.value=[],Array.isArray(o)&&H(o)},{immediate:!0,deep:!0}),{sortColumn:m,onClickTablecell:R,toPDF:E,toCSV:F,finish:v,headerRow:A,sync:me,search:be,close:ye,arrowUp:he,arrowDown:Ce,document:De,calendar:Ie,sortOrder:h,sectionOne:C,columnSorted:O}}}),Le={key:0},Pe={class:"his-sm-text"},Ye={id:"report-content"},Ue={class:"art-report-theme"},je={class:"stick-report-header"},ze=["colspan","rowspan","onClick"],Be=["onClick","colspan"];function Qe(n,u,S,O,h,A){const C=p("ion-title"),m=p("ion-icon"),v=p("ion-button"),R=p("ion-buttons"),T=p("ion-toolbar"),E=p("ion-header"),F=p("ion-label"),H=p("ion-item"),o=p("ion-content"),s=p("ion-footer");return c(),_($,null,[f(E,null,{default:d(()=>[f(T,null,{default:d(()=>[f(C,{class:"his-md-text"},{default:d(()=>[P(Y(n.title)+" ",1),n.subtitle?(c(),_("br",Le)):k("",!0),I("span",Pe,Y(n.subtitle),1)]),_:1}),f(R,{slot:"end"},{default:d(()=>[typeof n.onConfigure=="function"?(c(),V(v,{key:0,onClick:n.onConfigure},{default:d(()=>[f(m,{size:"large",icon:n.calendar},null,8,["icon"])]),_:1},8,["onClick"])):k("",!0),typeof n.onRefresh=="function"?(c(),V(v,{key:1,onClick:n.onRefresh,color:"success",size:"large"},{default:d(()=>[f(m,{size:"large",icon:n.sync},null,8,["icon"])]),_:1},8,["onClick"])):k("",!0)]),_:1})]),_:1})]),_:1}),f(o,{"scroll-y":"","scroll-x":""},{default:d(()=>[I("div",Ye,[I("table",Ue,[I("thead",je,[(c(!0),_($,null,U(n.headerRow,(e,a)=>(c(),_("tr",{key:a},[(c(!0),_($,null,U(e,(t,r)=>{var l,i;return c(),_("th",{key:r,colspan:((l=t==null?void 0:t.span)==null?void 0:l.thColspan)||1,rowspan:((i=t==null?void 0:t.span)==null?void 0:i.thRowspan)||1,onClick:y=>n.sortColumn(t.ref)},[f(H,{lines:"none"},{default:d(()=>[n.columnSorted&&n.columnSorted===t.ref?(c(),V(m,{key:0,icon:n.sortOrder==="asc"?n.arrowUp:n.arrowDown},null,8,["icon"])):k("",!0),a<n.columns.length-1?(c(),V(F,{key:1,class:"ion-text-center"},{default:d(()=>[I("b",null,Y(t.label),1)]),_:2},1024)):k("",!0)]),_:2},1024)],8,ze)}),128))]))),128))]),I("tbody",null,[(c(!0),_($,null,U(n.sectionOne,(e,a)=>(c(),_("tr",{key:a},[(c(!0),_($,null,U(e.row||[],(t,r)=>{var l;return c(),_($,{key:r},[t.value!="TH"?(c(),_("td",{key:0,onClick:()=>n.onClickTablecell(t),class:we({"clickable-cell":(l=t==null?void 0:t.column)==null?void 0:l.tdClick}),colspan:t.colSpan},[I("b",{style:Se(t.styling),class:"his-sm-text"},Y(t.value),5)],10,Be)):k("",!0)],64)}),128))]))),128))])])])]),_:1}),f(s,null,{default:d(()=>[f(T,{color:"dark"},{default:d(()=>[f(v,{onClick:u[0]||(u[0]=e=>n.toCSV()),size:"large"},{default:d(()=>u[2]||(u[2]=[P(" CSV ")])),_:1}),f(v,{onClick:u[1]||(u[1]=e=>n.toPDF()),size:"large"},{default:d(()=>u[3]||(u[3]=[P(" PDF ")])),_:1}),f(v,{onClick:n.finish,color:"success",size:"large",slot:"end"},{default:d(()=>u[4]||(u[4]=[P(" Finish ")])),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const We=ne(Fe,[["render",Qe],["__scopeId","data-v-26464ae3"]]),Q=b([]),N=b(""),M=b(""),q=b(""),G=b(!1),ee=b(""),X=b([]),Je=ae({components:{IonPage:Oe,IonLoading:Te,v2Datatable:We},setup(){const n=["screened_disaggregated_by_age","screened_disaggregated_by_hiv_status","screened_disaggregated_by_reason_for_visit","screened_disaggregated_by_screening_method","screening_results_hiv_positive","screening_results_hiv_negative","suspects_disaggregated_by_age","total_treated","total_treated_disaggregated_by_tx_option","referral_reasons","referral_feedback","family_planning"],u=e=>Math.floor(e.length/2),S=(e,a)=>e.slice(0,a),O=(e,a)=>e.slice(a),h=(e,a)=>{const t=[];for(let r=0;r<e.length;r++)t.push(e[r].concat(a[r]));return t},A=e=>{const a=[],t=[],r=Object.keys(e);let l,i=0,y=0,D="";return r.forEach(g=>{Object.entries(e[g]).forEach(([L,J])=>{l!=g&&(i=i+1,y=0,T.forEach(Z=>{Z[0]==g&&(g=Z[1])}),a.push([i,g,"TH"]),t.push([i,g,""])),Array.isArray(J)?(y=y+1,D=i+"."+y,a.push([D,L,J]),t.push([D,L,J])):(a.push([D,L,[]]),t.push([D,L,[]])),l=g})}),X.value=t,a},C=e=>{const a={};return n.forEach(t=>{e[t]&&(a[t]=e[t])}),a},m=async(e,a)=>{a.length<=0||(await z.create({component:Ve,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e,subtitle:q,patientIdentifiers:a,onFinish:()=>z.getTop().then(t=>t&&z.dismiss())}})).present()},v=e=>(e.forEach(a=>{a[2]=a[2]==="TH"?" ":a[2],Array.isArray(a[5])&&(a[5]=""+a[5].length),Array.isArray(a[2])&&(a[2]=""+a[2].length,a[5]=a[5]==="TH"?" ":a[5])}),e),R=["age_group","cryotherapy","thermocoagulation","leep","via_deffered","via_reffered","suspected_reffered"],T=[["family_planning","Offered family planning services"],["referral_feedback","Number of clients with referral feedback"],["referral_reasons","Number of clients referred disaggregated by referral reasons"],["screened_disaggregated_by_age","Number of clients screened for cervical cancer disaggregated by age"],["screened_disaggregated_by_hiv_status","Number of clients screened for cervical cancer disaggregated by HIV status"],["screened_disaggregated_by_reason_for_visit","Number of clients screened for cervical cancer disaggregated by reason for visit"],["screened_disaggregated_by_screening_method","Number of clients screened disaggregated by screening method"],["screening_results_hiv_negative","Cervical cancer screening results (HIV- / unknown)"],["screening_results_hiv_positive","Cervical cancer screening results (HIV+)"],["suspects_disaggregated_by_age","Cervical Cancer suspects disaggregated by age"],["total_treated","Total number of clients treated"],["total_treated_disaggregated_by_tx_option","Number of clients treated disaggregated by treatment option"]],E=["Indicator #","Name of Indicator","Value","Indicator #","Name of Indicator","Value"],H=[[{label:"indicator #",ref:""},{label:"Name of indicator",ref:""},{label:"value",ref:""},{label:"indicator #",ref:""},{label:"Name of indicator",ref:""},{label:"value",ref:""}],[{label:"Indicator #",ref:"data.indicatorOne",secondaryLabel:"Indicator #",value:e=>e.indicatorOne},{label:"Name of Indicator",ref:"data.nameOfIndicatorOne",secondaryLabel:"Name of Indicator",value:e=>e.nameOfIndicatorOne,dataStyle:e=>e.valueOne==="TH"?{fontWeight:"bold"}:{fontWeight:"normal"},colSpan:e=>e.valueOne==="TH"?2:1},{label:"value",ref:"data.valueOne",secondaryLabel:"Value",value:e=>Array.isArray(e.valueOne)?e.valueOne.length:e.valueOne,tdClick:({data:e})=>m("".concat(e.indicatorOne," ").concat(e.nameOfIndicatorOne),e.valueOne)},{label:"Indicator #",ref:"data.indicatorTwo",secondaryLabel:"Indicator #",value:e=>e.indicatorTwo},{label:"Name of Indicator",ref:"data.nameOfIndicatorTwo",secondaryLabel:"Name of Indicator",value:e=>e.nameOfIndicatorTwo,dataStyle:e=>e.valueTwo==="TH"?{fontWeight:"bold"}:{fontWeight:"normal"},colSpan:e=>e.valueTwo==="TH"?2:1},{label:"value",ref:"data.valueTwo",secondaryLabel:"Value",value:e=>Array.isArray(e.valueTwo)?e.valueTwo.length:e.valueTwo,tdClick:({data:e})=>m("".concat(e.indicatorTwo," ").concat(e.nameOfIndicatorTwo),e.valueTwo)}]],o=async()=>{if(!(N.value&&M.value))return $e("Start date and end date required!");G.value=!0,Q.value=[];const e=new Me;e.startDate=N.value,e.endDate=M.value;try{const a=await e.getClinicReport("SCREENED FOR CXCA"),t=C(a),r=A(t),l=u(r),i=h(S(r,l),O(r,l)),y=W.cloneDeep(i);X.value=v(y);const D=i.map(g=>({indicatorOne:g[0],nameOfIndicatorOne:g[1],valueOne:g[2],indicatorTwo:g[3],nameOfIndicatorTwo:g[4],valueTwo:g[5]}));Q.value=D}catch(a){Ne("Unable to generate report!"),console.error(a)}G.value=!1},s=()=>Ae([{id:"year",helpText:"Select Year",type:x.TT_NUMBER,computedValue:e=>e.value,validation:e=>{const a=W.isPlainObject(e)?e.value:-1;return B.validateSeries([()=>B.required(e),()=>isNaN(parseInt("".concat(a)))?["Invalid year"]:null,()=>B.rangeOf(e,2e3,Re.getYear(w.getSessionDate()))])}},{id:"month",helpText:"Select Month",type:x.TT_SELECT,validation:e=>B.required(e),computedValue:e=>e.value,options:()=>[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}]}],e=>{N.value="".concat(e.year.value,"-").concat(e.month.value,"-01"),M.value=te(new Date(N.value).toISOString()).endOf("month").format("YYYY-MM-DD"),q.value="Period (".concat(j(N.value)," to ").concat(j(M.value),")"),z.dismiss(),ee.value="".concat(j(N.value)," to ").concat(j(M.value)),o()});return ke(()=>!Q.value.length&&s()),{columns:H,isLoading:G,reportData:Q,period:q,csvQuarter:ee,generate:o,configure:s,order:R,csvheaders:E,spacing:5,csvData:X}}});function qe(n,u,S,O,h,A){const C=p("ion-loading"),m=p("v2Datatable"),v=p("ion-page");return c(),V(v,null,{default:d(()=>[f(C,{"is-open":n.isLoading,message:"Please wait..."},null,8,["is-open"]),f(m,{title:"MONTHLY MOH Report",subtitle:n.period,columns:n.columns,columnData:n.reportData,rowsPerPage:25,onConfigure:n.configure,csvQuarter:n.csvQuarter,onRefresh:()=>n.generate(),order:n.order,headers:n.csvheaders,"csv-spacing":n.spacing,"csv-data":n.csvData},null,8,["subtitle","columns","columnData","onConfigure","csvQuarter","onRefresh","order","headers","csv-spacing","csv-data"])]),_:1})}const aa=ne(Je,[["render",qe]]);export{aa as default};
