import{O as F}from"./opd_report_service-Cmi1UKwr.js";import{R as M}from"./BaseTableReport-BBx4OjVW.js";import{d as D,_ as B,r as s,o as h,x as w,b as n,w as o,u as m,F as R,y as P,c as b,v as f,A as g,I as H,L as i,H as y,S as O}from"./index-BFG-WECc.js";import{_ as V}from"./ReportMixin.vue_vue_type_script_lang-Ce5B9pzq.js";import{m as C}from"./overlays-04a9a43f-sOHkVQfY.js";import"./Export-CRv3Yrt4.js";import"./HisStandardForm-B3aw5EdY.js";import"./TouchScreenForm-DiI3Xfhg.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./ToolbarMediumCard-C3iotOe-.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-0kHLdkku.js";import"./BasicReportTemplate-SATK8Q6M.js";import"./SIngleTouchField-OvqCQtJi.js";import"./Pagination-wn9n5xfa.js";import"./MultiFieldDateHelper-CAg9Dfet.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";const I=D({props:{list:Object},setup(){return{closeModal:async()=>await C.dismiss()}}}),L=g("h3",null,"Type of Visit",-1),A=g("h3",null," < 5yrs ",-1),E=g("h3",null," > 5yrs",-1),j=g("h3",null,"Total",-1);function z(t,e,r,a,d,c){const p=s("ion-title"),u=s("ion-button"),v=s("ion-toolbar"),$=s("ion-header"),l=s("ion-col"),S=s("ion-row"),T=s("ion-item"),N=s("ion-list"),k=s("ion-grid"),x=s("ion-content");return h(),w(R,null,[n($,null,{default:o(()=>[n(v,null,{default:o(()=>[n(p,null,{default:o(()=>[m("Clinic Registration Report Summary")]),_:1}),n(u,{color:"danger",slot:"end",onClick:e[0]||(e[0]=_=>t.closeModal())},{default:o(()=>[m("X")]),_:1})]),_:1})]),_:1}),n(x,{class:"ion-padding"},{default:o(()=>[n(k,null,{default:o(()=>[n(S,null,{default:o(()=>[n(l,null,{default:o(()=>[L]),_:1}),n(l,null,{default:o(()=>[A]),_:1}),n(l,null,{default:o(()=>[E]),_:1}),n(l,null,{default:o(()=>[j]),_:1})]),_:1}),n(N,null,{default:o(()=>[(h(!0),w(R,null,P(t.list,_=>(h(),b(T,{key:_},{default:o(()=>[n(l,null,{default:o(()=>[m(f(_.label),1)]),_:2},1024),n(l,null,{default:o(()=>[m(f(_.under5),1)]),_:2},1024),n(l,null,{default:o(()=>[m(f(_.over5),1)]),_:2},1024),n(l,null,{default:o(()=>[m(f(_.value),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})],64)}const G=B(I,[["render",z]]),X=D({components:{ReportTemplate:M,IonPage:H},mixins:[V],data:()=>({title:"Clinic Registration",rows:[],reportData:[],columns:[[i.thTxt("Reg"),i.thTxt("First Name"),i.thTxt("Last Name"),i.thTxt("Gender"),i.thTxt("DOB"),i.thTxt("Date reg.")]],customBtns:[]}),created(){this.fields=this.getDateDurationFields(),this.customBtns.push({name:"High level view",size:"large",slot:"start",color:"primary",visible:!0,onClick:async()=>this.showModal()})},methods:{async init(t,e){const r=new F;r.setStartDate(e.start_date),r.setEndDate(e.end_date),this.period=r.getDateIntervalPeriod();const a=await r.getClinicRegistrations();this.reportData=a.sort((d,c)=>d.visit_type>c.visit_type?1:d.visit_type<c.visit_type?-1:0),this.rows=this.buildRows(this.reportData)},buildRows(t){return t.length?t.map(e=>[i.td(e.visit_type),i.td(e.given_name),i.td(e.family_name),i.td(e.gender),i.td(y.toStandardHisDisplayFormat(e.birthdate)),i.td(y.toStandardHisDisplayFormat(e.visit_date))]):[]},filterBy(t,e){return this.reportData.filter(r=>{const a=y.calculateAge(r.birthdate,O.getSessionDate());return r.visit_type===t&&(e==="under5"?a<=5:a>6)})},modalData(){const t=[...this.filterBy("New patient","under5")].length,e=[...this.filterBy("New patient","over5")].length,r=t+e,a=[...this.filterBy("Referral","under5")].length,d=[...this.filterBy("Referral","over5")].length,c=a+d,p=[...this.filterBy("Revisiting","under5")].length,u=[...this.filterBy("Revisiting","over5")].length,v=p+u;return[{label:"New patient",under5:t,over5:e,value:r},{label:"Referral",under5:a,over5:d,value:c},{label:"Revisiting",under5:p,over5:u,value:v}]},async showModal(){const t=[...this.modalData()];(await C.create({component:G,backdropDismiss:!0,cssClass:"action-sheet-modal",componentProps:{list:t}})).present()}}});function q(t,e,r,a,d,c){const p=s("report-template"),u=s("ion-page");return h(),b(u,null,{default:o(()=>[n(p,{title:t.title,rows:t.rows,fields:t.fields,columns:t.columns,itemsPerPage:10,period:t.period,reportPrefix:"Clinic",onReportConfiguration:t.init,customBtns:t.customBtns,paginated:""},null,8,["title","rows","fields","columns","period","onReportConfiguration","customBtns"])]),_:1})}const pt=B(X,[["render",q]]);export{pt as default};
