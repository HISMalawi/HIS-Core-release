System.register(["./index-legacy-zV5Jd_xD.js","./main-legacy-CPQZbB54.js","./HelpdeskFlyer-legacy-BqD4N4lN.js"],(function(e,t){"use strict";var a,o,s,i,n,r,l,d,u,c,p,h,f,g,w,m,b,y,v,k,x,_,I,C,P,T,L,S,$,B,A,N,V,z,D,U,O,E,R,j,H,M,F,K,Y,W,q,G,X,J,Q,Z,ee,te,ae,oe,se,ie,ne,re,le,de;return{setters:[e=>{a=e.d,o=e.aC,s=e.k,i=e.ai,n=e.aD,r=e.U,l=e.aE,d=e.al,u=e.am,c=e.s,p=e.aF,h=e.y,f=e.aG,g=e.aH,w=e.aI,m=e.A,b=e.aJ,y=e.aK,v=e.aL,k=e.ak,x=e.ap,_=e.h,I=e.b,C=e.g,P=e.t,T=e.aM,L=e.aN,S=e.e,$=e.w,B=e.a,A=e.a6,N=e.a9,V=e.aa,z=e.aO,D=e.r,U=e.aP,O=e.c,E=e.aQ,R=e.aR,j=e.o,H=e.f,M=e.a4,F=e.m,K=e.a5,Y=e.ah,W=e.j,q=e.I,G=e.l,X=e.x,J=e.aS,Q=e.aT,Z=e.ag,ee=e.a7,te=e.aU,ae=e.aV,oe=e.aW,se=e.aX,ie=e.n,ne=e.aY,re=e.aZ},e=>{le=e.p},e=>{de=e.H}],execute:function(){var t=document.createElement("style");t.textContent=".input-boxes[data-v-aaf6011d]{height:70px;border:1px solid #ccc;border-radius:5px;width:50%;font-family:Nimbus Sans L,Arial Narrow,sans-serif;font-size:2.2em;background-color:#dcdcdc;color:#000;padding:8px}.main[data-v-aaf6011d]{width:100%;text-align:center;margin-top:5%;display:table}.keyboard[data-v-aaf6011d]{z-index:100;text-align:center;position:absolute;background-color:#fff;width:100%;border:1px solid rgb(204,204,204);word-wrap:normal!important;margin:0 auto;max-width:300px;left:0;right:0}.rows[data-v-aaf6011d]{display:table-row;line-height:1px}.cells[data-v-aaf6011d]{display:table-cell}.keyboard-btn[data-v-aaf6011d]{border:1px solid #7eb9d0;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:5px!important;font-size:1.6vw!important;font-family:arial,helvetica,sans-serif;text-decoration:none;display:inline-block;text-shadow:-1px -1px 0 rgba(0,0,0,.3);font-weight:700;color:#fff;background-color:#a7cfdf;background-image:-webkit-gradient(linear,left top,left bottom,from(#a7cfdf),to(#23538a));background-image:-webkit-linear-gradient(top,#a7cfdf,#23538a);background-image:-moz-linear-gradient(top,#a7cfdf,#23538a);background-image:-ms-linear-gradient(top,#a7cfdf,#23538a);background-image:-o-linear-gradient(top,#a7cfdf,#23538a);background-image:linear-gradient(to bottom,#a7cfdf,#23538a);filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=#a7cfdf,endColorstr=#23538a);max-width:85px;max-height:85px;cursor:pointer;text-align:center;margin:3px;width:8vw;height:8vh;overflow:hidden;white-space:nowrap}@media screen and (max-width:600px){.keyboard-btn[data-v-aaf6011d]{font-size:10px!important}}@media screen and (min-width:1020px){.keyboard-btn[data-v-aaf6011d]{font-size:25px!important}}.login-btn[data-v-aaf6011d]{background-image:-webkit-gradient(linear,left top,left bottom,from(green),to green);background-image:-webkit-linear-gradient(top,green,green);background-image:-moz-linear-gradient(top,green,green);background-image:-ms-linear-gradient(top,green,green);background-image:-o-linear-gradient(top,green,green);background-image:linear-gradient(to bottom,green,green);filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=green,endColorstr=green)}.input-rows[data-v-aaf6011d]{line-height:140px}#coat[data-v-b23d751a]{width:8vw;height:8vw}#pepfar[data-v-b23d751a]{width:6vw;height:6vw}.devices[data-v-b23d751a]{background-color:var(--ion-color-primary);color:#fff;border:1px solid lightblue;font-size:1.3em;padding:1rem;margin-right:.5rem}.devices>option[data-v-b23d751a]{background:#fff;color:#000}\n/*$vite$:1*/",document.head.appendChild(t);const ue=a({components:{IonInput:i,IonButton:s,IonIcon:o},props:{useVirtualInput:{type:Boolean}},data:function(){return{eye:v,eyeOff:y,passwordTimeout:null,showPasswordButtonTimeout:null,showPassword:!1,showPasswordButton:!1,keyboard:g,auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new m,b.clearScreenTimeout()},setup(){const{facilityName:e,district:t}=w();return{facilityName:e,district:t}},methods:{onShowPassword(){this.showPassword=!0,this.showPasswordButton=!0,this.passwordTimeout&&clearTimeout(this.passwordTimeout),this.passwordTimeout=setTimeout((()=>this.showPassword=!1),1e4)},renderKeyBoard(e){this.focusInput=e.currentTarget,"password"==this.focusInput.id?this.btnCaption="Login":this.btnCaption="Next";let t=e.currentTarget.getBoundingClientRect().top;t=parseInt(t),this.keyboardTop=t+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(e){const t=e.currentTarget.id;let a;try{t.match(/@#/i)?this.keyboard=f:t.match(/qwerty/i)?this.keyboard=g:t.match(/Del/i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):t.match(/Next/i)?(this.display="none",a=this.$refs.password,a.$el.click()):t.match(/Login/i)?(this.display="none",this.doLogin()):t.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",a="username"===this.focusInput.id?this.$refs.username:this.$refs.password,a.click()):t.match(/Hide/i)?this.display="none":this.focusInput.value+=t,"username"==this.focusInput.id?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(o){console.warn("input error")}},doLogin:async function(){if(this.showPasswordButtonTimeout&&clearTimeout(this.showPasswordButtonTimeout),this.showPasswordButton=!1,this.showPassword=!1,this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!(await this.auth.checkTimeIntegrity()))throw"Local date does not match API date. Please Update your device's date";await this.auth.login(this.userInput.password),this.auth.startSession();const e=await Promise.all([this.auth.passwordPolicyEnabled(),this.auth.passwordExpired()]),t=(()=>{let e=0;return e+=le(this.userInput.password).score,/^(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])/i.test(this.userInput.password)&&(e+=2),e<3})();if(t||e.every(Boolean)){const e=e=>`${e.value}`.toLowerCase();return l([{id:"new_password",proxyID:"password",helpText:"Change your password",type:u.TT_PASSWORD,init:()=>(setTimeout((()=>{t?c("Your password is weak, please change it below"):c("Your password has expired, please change it below",6e3)}),500),!0),computedValue:t=>e(t),validation:t=>d.validateSeries([()=>d.required(t),()=>d.hasLengthRangeOf(t,4,15),()=>{if(`${this.userInput.password}`.toLowerCase()===e(t))return["New password should not match old password"]}]),config:{inputType:"password"}},{id:"verify_password",proxyID:"password",helpText:"Confirm Password",type:u.TT_PASSWORD,computedValue:t=>e(t),validation:(t,a)=>d.validateSeries([()=>d.required(t),()=>{if(e(a.verify_password)!=e(a.new_password))return["New password does not match current password"]}]),config:{inputType:"password"}}],(async(e,t)=>{await r.updateUser(this.auth.userID,t)?(await this.auth.resetUserPasswordChangeCheck(),await this.navigateAfterLogin()):c("Unable to update user")}))}await this.navigateAfterLogin()}catch(e){e instanceof p?(c("Invalid username or password"),this.showPasswordButton=!0,this.showPasswordButtonTimeout=setTimeout((()=>this.showPasswordButton=!1),3e4)):h(`${e}`,5e4)}}else c("Complete form to log in")},async navigateAfterLogin(){try{const t=n.version;try{const e=await r.getJson("user_properties",{property:"his_core_update_acknowledged"}),a=e?.property_value?.split("|")[0];if(a===t)return void this.$router.push("/select_hc_location")}catch(e){console.log("[Login] User property not found or error - showing updates")}console.log(`[Login] Showing update flashcards for version ${t}`),this.$router.push("/updates/flashcards")}catch(e){console.error("Error during post-login navigation:",e),this.$router.push("/updates/flashcards")}}},computed:{btnStyles(){return`display: ${this.display}; top: ${this.keyboardTop};`}}}),ce={class:"main",ref:"main"},pe={class:"cells ion-padding-bottom"},he={style:{color:"#cd853f"}},fe={class:"rows"},ge={class:"cells"},we=["readonly"],me={class:"rows input-rows"},be={class:"cells"},ye={class:"rows"},ve=["id"],ke=["id"],xe=k(ue,[["render",function(e,t,a,o,s,i){const n=x("ion-icon"),r=x("ion-button"),l=x("ion-input");return I(),_(N,null,[C("div",ce,[C("div",pe,[C("h3",null,[t[7]||(t[7]=C("b",{style:{color:"#8b4513"}},"Facility: ",-1)),C("b",he,P(e.facilityName)+" ("+P(e.district)+")",1)])]),C("div",fe,[C("div",ge,[T(C("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":t[0]||(t[0]=t=>e.userInput.username=t),onClick:t[1]||(t[1]=t=>e.renderKeyBoard(t)),class:"input-boxes ion-padding",readonly:e.useVirtualInput},null,8,we),[[L,e.userInput.username]])])]),C("div",me,[C("div",be,[S(l,{style:{margin:"0px auto","margin-top":"15px","text-align":"left"},modelValue:e.userInput.password,"onUpdate:modelValue":t[3]||(t[3]=t=>e.userInput.password=t),type:e.showPassword?"text":"password",name:"password",ref:"password",id:"password",onClick:t[4]||(t[4]=t=>e.renderKeyBoard(t)),class:"input-boxes ion-padding",placeholder:"Password",readonly:e.useVirtualInput},{default:$((()=>[!e.showPassword&&e.showPasswordButton?(I(),B(r,{key:0,onClick:e.onShowPassword,color:"light",size:"large",slot:"end"},{default:$((()=>[S(n,{size:"large",icon:e.eye},null,8,["icon"])])),_:1},8,["onClick"])):A("",!0),e.showPassword&&e.showPasswordButton?(I(),B(r,{key:1,onClick:t[2]||(t[2]=t=>e.showPassword=!1),color:"light",size:"large",slot:"end"},{default:$((()=>[S(n,{size:"large",icon:e.eyeOff},null,8,["icon"])])),_:1})):A("",!0)])),_:1},8,["modelValue","type","readonly"])])])],512),C("div",{id:"keyboard",style:z(e.btnStyles),class:"keyboard"},[(I(!0),_(N,null,V(e.keyboard,((a,o)=>(I(),_("span",{key:o},[C("div",ye,[(I(!0),_(N,null,V(a,(a=>(I(),_("div",{class:"cells",key:a},["Next"===a||"Login"===a?(I(),_("button",{key:0,id:e.btnCaption,class:"keyboard-btn login-btn",onClick:t[5]||(t[5]=t=>e.keyPress(t))},P(e.btnCaption),9,ve)):A("",!0),"Login"!=a&&"Next"!=a?(I(),_("button",{key:1,id:e.Caps.on?a.toUpperCase():a.toLowerCase(),class:"keyboard-btn",onClick:t[6]||(t[6]=t=>e.keyPress(t))},P("Del."===a||"Caps"===a?a:e.Caps.on?a.toUpperCase():a.toLowerCase()),9,ke)):A("",!0)])))),128))])])))),128))],4)],64)}],["__scopeId","data-v-aaf6011d"]]),_e={slot:"start"},Ie=["src"],Ce=["src"];e("default",k(a({__name:"Login",setup(e){const t=X("login-logos/Malawi-Coat_of_arms_of_arms.png"),a=X("login-logos/PEPFAR.png"),i=D([]),n=async()=>{const e=await ne("Application Selection","Please specify the application you wish to use",i.value.map((e=>e.name)),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(e.selection&&"Cancel"!=e.action){const t=i.value.find((t=>t.name===e.selection));window.open(`${t.protocol||"http"}://${t.IP}:${t.port||80}`,"_blank")}},{activePlatformProfile:r,platformProfiles:l}=U(),d=D(""),u=D(""),c=O((()=>r.value.keyboard===E.HIS_KEYBOARD_ONLY)),p=Object.keys(l.value).map((e=>({label:e,value:{profileName:e,...l.value[e]}})));return R(u,(e=>{r.value=(re.find(p,{label:e})||{}).value})),j((async()=>{const e=new m;i.value=(await e.loadConfig())?.otherApps||[];const t=e.getHeadVersion();e.setActiveVersion(t);const a=await e.getApiVersion();d.value=`${t} / ${a}`,u.value=r.value?.profileName||""})),(e,i)=>(I(),B(H(ie),null,{default:$((()=>[S(H(M),null,{default:$((()=>[S(H(F),null,{default:$((()=>[S(H(K),null,{default:$((()=>[S(H(Y),{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:$((()=>[...i[0]||(i[0]=[C("b",{style:{color:"#8b4513"}},"National ",-1),C("b",{style:{color:"#cd853f"}},"EMR",-1)])])),_:1})])),_:1}),S(H(Y),{class:"ion-padding",slot:"end"},{default:$((()=>[i[1]||(i[1]=W(" Version: ",-1)),C("b",null,P(d.value),1)])),_:1})])),_:1})])),_:1}),S(H(q),{fullscreen:!1,style:{width:"100%"}},{default:$((()=>[S(xe,{useVirtualInput:c.value},null,8,["useVirtualInput"]),C("p",null,[S(de)])])),_:1}),S(H(G),null,{default:$((()=>[S(H(F),null,{default:$((()=>[C("span",_e,[C("img",{id:"coat",src:H(t),alt:"Malawi Coat of Arms logo"},null,8,Ie),C("img",{id:"pepfar",src:H(a),alt:"PEPFAR logo"},null,8,Ce)]),S(H(s),{color:"dark",fill:"outline",size:"large",slot:"end",id:"configuration"},{default:$((()=>[S(H(o),{slot:"end",icon:H(J)},null,8,["icon"]),i[2]||(i[2]=W(" Quick Actions ",-1))])),_:1}),S(H(Q),{trigger:"configuration","dismiss-on-select":"",style:{"--width":"300px"}},{default:$((()=>[S(H(q),null,{default:$((()=>[S(H(Z),null,{default:$((()=>[S(H(ee),{button:"","router-link":"/reset_password",class:"his-sm-text"},{default:$((()=>[S(H(o),{icon:H(te),slot:"start"},null,8,["icon"]),S(H(Y),null,{default:$((()=>[...i[3]||(i[3]=[W("Reset Password",-1)])])),_:1})])),_:1}),S(H(ee),{button:"","router-link":"/settings/host",class:"his-sm-text"},{default:$((()=>[S(H(o),{icon:H(ae),slot:"start"},null,8,["icon"]),S(H(Y),null,{default:$((()=>[...i[4]||(i[4]=[W("Network Settings",-1)])])),_:1})])),_:1}),S(H(ee),{button:"",detail:"",id:"devices",class:"his-sm-text"},{default:$((()=>[S(H(o),{icon:H(oe),slot:"start"},null,8,["icon"]),S(H(Y),null,{default:$((()=>[...i[5]||(i[5]=[W("Device Profile",-1)])])),_:1})])),_:1}),S(H(Q),{trigger:"devices","dismiss-on-select":"",side:"end"},{default:$((()=>[(I(!0),_(N,null,V(H(p),(e=>(I(),B(H(ee),{key:e.label,color:e.label===u.value?"primary":"light",button:"",onClick:()=>u.value=e.label},{default:$((()=>[S(H(Y),null,{default:$((()=>[W(P(e.label),1)])),_:2},1024)])),_:2},1032,["color","onClick"])))),128))])),_:1}),S(H(ee),{button:"",onClick:n,class:"his-sm-text"},{default:$((()=>[S(H(o),{icon:H(se),slot:"start"},null,8,["icon"]),S(H(Y),null,{default:$((()=>[...i[6]||(i[6]=[W("Other Applications",-1)])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}))}}),[["__scopeId","data-v-b23d751a"]]))}}}));
