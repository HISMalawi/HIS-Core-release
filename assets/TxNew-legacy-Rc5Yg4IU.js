System.register(["./index-legacy-2bdI6aeZ.js","./ReportDateSelectionPrompt-legacy-Sv-Ah6NW.js","./tx_report_service-legacy-upQL0aoD.js","./TableView-legacy-CkBYUnNn.js","./ArtDrilldown-legacy-aM6Rpnwo.js","./ReportErrors-legacy-IkveOCYc.js","./moh_cohort_service-legacy-r9GjLt8k.js","./dynamic-import-helper-legacy-BhGHTWZn.js","./MultiFieldDateHelper-legacy-ABlXxdvs.js","./KbLayouts-legacy-NQmKRJpJ.js","./HisKbConfigurations-legacy-AV_G95Cg.js","./PopupKeyboard-legacy-E9tCYbQ8.js","./SIngleTouchField-legacy-hpCyTWH6.js","./TouchScreenForm-legacy-H8a4O6o5.js","./ToolbarMediumCard-legacy-EA1aA9jU.js","./Transformers-legacy-PbfCTy2a.js","./ViewPort-legacy-AULqwBLs.js","./HisKeypad-legacy-u28jWxW5.js","./BaseKeyboard-legacy-EPPfL8N-.js","./KbHandler-legacy-YpKYWvgQ.js","./overlays-33ae3ea0-legacy-mcssBBSM.js","./fuse-legacy-T9FrQdXS.js","./Export-legacy-cuEy_-Nh.js","./HisKeyboard-legacy-zNn6DvML.js","./person_service-legacy-jJzke8LT.js"],(function(e,n){"use strict";var t,a,r,l,o,i,s,c,u,d,g,p,m,_,f,b,h,y,w,v,j,D,T,x,P,$,A;return{setters:[e=>{t=e.d,a=e.I,r=e.c2,l=e.K,o=e.N,i=e.a9,s=e.O,c=e.t,u=e.ab,d=e.c3,g=e.q,p=e.c4,m=e.c5,_=e.c6,f=e.c7,b=e._,h=e.r,y=e.o,w=e.c,v=e.w,j=e.b},e=>{D=e.D},e=>{T=e.T},e=>{x=e.v},e=>{P=e.A},e=>{$=e.R},e=>{A=e.M},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){const n=t({components:{IonPage:a,IonLoading:r,v2Datatable:x},setup(){const e=l([]),n=l(""),t=l(!1),a=new T,r=l([]),b=new A,h=l(!0),y=(e,t)=>({ref:t,label:e,toValue:e=>e.length,tdClick:async e=>{e.refData.length&&(await s.create({component:P,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:n,patientIdentifiers:e.refData,title:`${e.data.age_group} ${e.data.gender} ${e.column.label}`,onFinish:()=>s.getTop().then((e=>e&&s.dismiss()))}})).present()}}),w=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},y("Tx new CD4 <200","cd4_less_than_200"),y("Tx new CD4 >=200","cd4_greater_than_equal_to_200"),y("Tx new CD4 Unknown","cd4_unknown_or_not_done"),y("Transfer-ins","transfer_in")]],v=function(e){const n=r.value.findIndex((n=>n.id===e.id));-1!==n?r.value[n]=e:r.value.push(e)},j=async function(e){const n="validationErrors";(await s.create({id:n,component:$,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:e}})).present(),v({id:n,text:`<b>${e.length}</b> validation errors detected`,icon:f,color:"danger",action:()=>j(e)})},x=async()=>{if(!a.startDate||!a.endDate)return c("Start date and end date required!");t.value=!0,e.value=[];try{let t=null;t=h.value?await a.getTxNewReport(!1):await a.getTxNewReport(!0);const r=t.filter((e=>!["All"].includes(e.age_group))).reduce(((e,n)=>(e[n.gender]=Object.keys(n).reduce(((e,t)=>Array.isArray(n[t])?{...e,[t]:[...e[t]||[],...n[t]]}:e),e[n.gender]||{}),e)),{Male:{},Female:{}});e.value=t;const l=t.reduce(((e,n)=>{if("FP"===n.gender){const t=Object.values(n).filter(Array.isArray).flat();return e.concat(t)}return e}),[]),o=["cd4_less_than_200","cd4_greater_than_equal_to_200","cd4_unknown_or_not_done"],i=u.uniq(["Female","Male"].reduce(((e,n)=>[...e,...o.map((e=>r[n][e])).flat(1)]),[]));v({id:"stats",text:`Tx new <b>${i.length}</b>`,icon:d,color:"primary",action:async()=>{(await s.create({component:P,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"All TxNew",subtitle:n.value,patientIdentifiers:i,onFinish:()=>s.getTop().then((e=>e&&s.dismiss()))}})).present()}}),function(e){const n={initiated_on_art_first_time:{param:e.total,check:(e,n)=>e!=n,error:(e,n)=>`\n                        MOH cohort initiated on ART first time <b>(${e})</b> is not matching Tx New <b>(${n})</b>\n                    `},initial_pregnant_females_all_ages:{param:e.pregnant,check:(e,n)=>e!=n,error:(e,n)=>`\n                        MOH cohort initial pregnant females all ages \n                        <b>(${e})</b> is not matching with TX new Pregnant women <b>${n}</b>\n                    `},males_initiated_on_art_first_time:{param:e.male,check:(e,n)=>e!=n,error:(e,n)=>`\n                        MoH Cohort males initiated on ART first time <b>(${e})</b>\n                        is not matching with TX new All male <b>(${n})</b>\n                    `},"quarterly_re_initiated_on_art + transfer_in":{param:e.transfer_in,check:(e,n)=>e!=n,error:(e,n)=>`\n                        Quarterly Transfer In + Reinitiated Clients <b>${e}</b>  does not match Transfer In <b>${n}</b> clients in TXNEW report\n                    `}};-1===b.validateIndicators(n,(e=>{e.length?j(e):v({id:"reportOk",text:"<b>Report is consistent</b>",icon:_,color:"success"})}))&&j(["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])}({total:i.length,pregnant:u.uniq(o.map((e=>r.Female[e].filter((e=>l.includes(e))))).flat(1)).length,male:u.uniq(o.map((e=>r.Male[e])).flat(1)).length,transfer_in:[...r.Male.transfer_in,...r.Female.transfer_in].length}),e.value=e.value.map(((e,n)=>({index:n+1,...e})))}catch(l){console.error(`${l}`),g("Unable to generate report!"),r.value=[{text:"Unable to generate report!",color:"danger",icon:p,action:function(){r.value=[{text:`Exception occured: <b>${l}</b>`,color:"danger",icon:m}]}}]}t.value=!1,h.value=!1},F=()=>D({onFinish:(e,t,r,l)=>{n.value=r,a.startDate=e,a.endDate=t,l&&a.setOccupation(l),b.setStartDate(a.startDate),b.setEndDate(a.endDate),x()}});return o((()=>F())),{Img:i,headerBadge:r,reportData:e,isLoading:t,configure:F,generate:x,columns:w,isFirstLoad:h,period:n}}});e("default",b(n,[["render",function(e,n,t,a,r,l){const o=h("ion-loading"),i=h("v2Datatable"),s=h("ion-page");return y(),w(s,null,{default:v((()=>[j(o,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),j(i,{"icon-url":e.Img("login-logos/PEPFAR.png"),title:"Pepfar Tx New","report-prefix":"Pepfar",subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,headerBadge:e.headerBadge,onConfigure:e.configure,onRefresh:e.generate},null,8,["icon-url","subtitle","columns","columnData","headerBadge","onConfigure","onRefresh"])])),_:1})}]]))}}}));
