import{d as E,r as l,t as R,u as S,v as P,w as G,x as k,y,cK as A,ab as L,cW as o,a5 as B,aI as M,ca as v,d3 as V,dk as F}from"./index-DrPQ21-i.js";import{v as I}from"./TableView-DYQq8HZp.js";import{L as j}from"./lab_report_service-CGCPstAh.js";import{w as U,b as K,a as N}from"./v2utils-B87E9iaX.js";import"./Export-CWTuI3QV.js";const X=E({__name:"ClinicLabResultsReport",setup(W){const x=M("reports.png"),p=l([]),m=l(""),b=l("asc"),f=l(""),c=l([]),n=new j,_=l([]),d=l("disaggregated"),h=l([]),O=r=>{const t={};return r.forEach(e=>{e.measures.forEach(a=>{a.name in t||(t[a.name]=[]),t[a.name].push({id:e.patient_id,arv:e.arv_number,gender:e.gender,ageGroup:e.age_group,birthdate:o(e.birthdate),ordered:o(e.order_date),specimen:e.test,test:a.name,result:"".concat(a.modifier," ").concat(a.value),released:o(e.result_date)})})}),t},g=()=>{const r=[[N("arv"),{label:"Gender",ref:"gender",toValue:e=>v(e)},{label:"Birthdate",ref:"birthdate",toValue:e=>"".concat(o(e))},{label:"Ordered",ref:"ordered",toValue:e=>"".concat(o(e))},{label:"Specimen",ref:"specimen"},{label:"Test",ref:"test"},{label:"Result",ref:"result"},{label:"Released",ref:"released",toValue:e=>"".concat(o(e))}]],t={disaggregated:{sortColumn:"gender",sortOrder:"desc",columns:[[{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender",toValue:e=>v(e)},...c.value.map(e=>({ref:e.label,label:e.label,toValue:a=>a.length,tdClick:a=>K({title:"".concat(a.data.age_group," | ").concat(v(a.data.gender)," | ").concat(e.label),columns:r,columnData:a.refData})}))]],data:()=>{const e=u=>F.reduce((i,s)=>{const $=c.value.reduce((w,C)=>({...w,[C.label]:C.other.filter(D=>D.ageGroup===s&&D.gender===u)}),{});return{...i,[s]:{age_group:s,gender:u,...$}}},{}),a=u=>Object.values(e(u)).flat(1);return[...a("F"),...a("M")]}},patient_level:{sortColumn:"arv",sortOrder:"asc",columns:r,data:()=>c.value.map(e=>e.other).flat(1)}};h.value=[{text:"<b>View Disaggregated</b>",icon:V,color:d.value==="disaggregated"?"primary":"dark",action:()=>{d.value="disaggregated",g()}},{text:"<b>View Patient Level</b>",icon:V,color:d.value==="patient_level"?"primary":"dark",action:()=>{d.value="patient_level",g()}}],setTimeout(()=>{const e=t[d.value];_.value=e.columns,p.value=e.data(),f.value=e.sortColumn,b.value=e.sortOrder},100)},T=()=>A({fields:[{id:"tests",helpText:"Available test(s) results",type:L.TT_MULTIPLE_SELECT,options:async(r,t,e)=>{n.setStartDate(e.start_date),n.setEndDate(e.end_date);const a=await U(async()=>{const u=await n.getLabResultsReport(),i=O(u);return Object.keys(i).map(s=>({label:s,value:i[s].length,other:i[s]}))},!1);return a!=null?a:[]}},{id:"type",helpText:"Select report type",type:L.TT_SELECT,options:()=>[{label:"Disaggregated",value:"disaggregated"},{label:"Patient level",value:"patient_level"}]}],defaultOnFinish:(r,t)=>{t.occupation&&n.setOccupation(t.occupation),m.value="".concat(o(t.start_date)," to ").concat(o(t.end_date)),n.startDate=t.start_date,n.endDate=t.end_date,c.value=r.tests,d.value=r.type.value,g()}});return R(()=>!p.value.length&&T()),(r,t)=>(S(),P(y(B),null,{default:G(()=>[k(I,{"header-badge":h.value,"default-sorted-column":f.value,"default-sort-order":b.value,"icon-url":y(x),title:"Lab test result(s)","report-prefix":"Clinic",subtitle:m.value,columns:_.value,columnData:p.value,rowsPerPage:50,onConfigure:T},null,8,["header-badge","default-sorted-column","default-sort-order","icon-url","subtitle","columns","columnData"])]),_:1}))}});export{X as default};
