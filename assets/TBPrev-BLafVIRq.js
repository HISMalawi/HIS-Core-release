import{_ as h}from"./ReportMixin.vue_vue_type_script_lang-DYy2lpd9.js";import{bT as _,cu as c,d as w,L as t,ah as A,cW as u,_ as R,r as m,o as T,c as H,w as v,b as g}from"./index-BFVcutZq.js";import{R as P}from"./TableReportTemplate-BDV868op.js";import"./HisStandardForm-DO3sZVdL.js";import"./ReportErrors-B0y1wUIE.js";class f extends _{constructor(){super()}getTBPrevReport(){return this.getReport("/programs/".concat(this.programID,"/reports/tb_prev2"))}getMaternalStatus(s){const o={start_date:this.startDate,end_date:this.endDate,date:this.date,program_id:this.programID,report_definition:"pepfar"};this.occupation&&(o.occupation=this.occupation);const e=c.parameterizeObjToString(o);return _.postJson("vl_maternal_status?".concat(e),{patient_ids:s})}}const y=w({mixins:[h],components:{ReportTemplate:P},data:()=>({title:"TB PREV Report",cohort:{},rows:[],columns:[[t.thTxt("",{colspan:3,sortable:!1,exportable:!1}),t.thTxt("Started new on ART",{colspan:2,sortable:!1,exportable:!1}),t.thTxt("Started previously on ART",{colspan:2,sortable:!1,exportable:!1}),t.thTxt("Completed New on ART",{colspan:2,sortable:!1,exportable:!1}),t.thTxt("Completed previously on ART",{colspan:2,sortable:!1,exportable:!1})],[t.thTxt("Age group"),t.thTxt("Gender"),t.thNum("3HP",{value:"3HP(Started New on ART)"}),t.thNum("6H",{value:"6H(Started New on ART)"}),t.thNum("3HP",{value:"3HP(Started Previously on ART)"}),t.thNum("6H",{value:"6H(Started Previously on ART)"}),t.thNum("3H",{value:"3HP(Completed New on ART)"}),t.thNum("6H",{value:"6H(Completed New on ART)"}),t.thNum("3H",{value:"3HP(Completed Previously on ART)"}),t.thNum("6H",{value:"6H(Completed Previously on ART)"})]]}),created(){this.fields=this.getDateDurationFields()},methods:{async onPeriod(r,s){this.rows=[],this.report=new f,this.report.setOccupation(s.occupation),this.report.setStartDate(s.start_date),this.report.setEndDate(s.end_date),this.period=this.report.getDateIntervalPeriod(),this.cohort=await this.report.getTBPrevReport(),this.setRows("F"),this.setRows("M"),this.setTotalMaleRow(),this.setMaternityRows()},makeDrilldown(r,s){if(r.length){const o=[[t.thTxt("ARV#"),t.thTxt("Birthdate"),t.thTxt("TPT Initiation Date"),t.thTxt("Outcome")]],e=()=>this.sortByArvNumber(r,"arv_number").map(a=>[t.td(a.arv_number),t.tdDate(a.birthdate),t.tdDate(a.tpt_initiation_date),t.td(a.outcome)]);return t.tdLink(r.length,()=>this.drilldownAsyncRows(s,o,e))}return t.td(0)},aggregate(r,s,o){return Object.values(this.cohort).reduce((e,a)=>[...a[r][s][o],...e],[])},async setMaternityRows(){const r=["started_new_on_art","started_previously_on_art","completed_new_on_art","completed_previously_on_art"].reduce((l,n)=>[...l,{group:"3HP",indicator:n,data:this.aggregate("F","3HP",n)},{group:"6H",indicator:n,data:this.aggregate("F","6H",n)}],[]),s=await this.report.getMaternalStatus(A.uniq(r.reduce((l,n)=>[...l,...n.data],[]).map(l=>l.patient_id))),o=(l,n)=>r.reduce((i,d)=>d.indicator===l&&n===d.group?[...i,...d.data]:i,[]),e=(l,n,i)=>[this.makeDrilldown(o(n,"3HP").filter(d=>s[l].includes(d.patient_id)),"All ".concat(i," (3HP)")),this.makeDrilldown(o(n,"6H").filter(d=>s[l].includes(d.patient_id)),"All ".concat(i," (6H)"))],a=s.FBf.concat(s.FP),p=(l,n)=>[this.makeDrilldown(o(l,"3HP").filter(i=>!a.includes(i.patient_id)),"All ".concat(n," (3HP)")),this.makeDrilldown(o(l,"6H").filter(i=>!a.includes(i.patient_id)),"All ".concat(n," (6H)"))];this.rows.push([t.td("All"),t.td("FP"),...e("FP","started_new_on_art","Started new on ART"),...e("FP","started_previously_on_art","Started previously on ART"),...e("FP","completed_new_on_art","Completed new on ART"),...e("FP","completed_previously_on_art","Completed previously on ART")]),this.rows.push([t.td("All"),t.td("FNP"),...p("started_new_on_art","Started new on ART"),...p("started_previously_on_art","Started previously on ART"),...p("completed_new_on_art","Completed new on ART"),...p("completed_previously_on_art","Completed previously on ART")]),this.rows.push([t.td("All"),t.td("FBF"),...e("FBf","started_new_on_art","Started new on ART"),...e("FBf","started_previously_on_art","Started previously on ART"),...e("FBf","completed_new_on_art","Completed new on ART"),...e("FBf","completed_previously_on_art","Completed previously on ART")])},setTotalMaleRow(){this.rows.push([t.td("All"),t.td("Male"),this.makeDrilldown(this.aggregate("M","3HP","started_new_on_art"),"All male started new on 3HP"),this.makeDrilldown(this.aggregate("M","6H","started_new_on_art"),"All male started new on ART 6H"),this.makeDrilldown(this.aggregate("M","3HP","started_previously_on_art"),"All male started previously on ART 3HP"),this.makeDrilldown(this.aggregate("M","6H","started_previously_on_art"),"All male started previously on ART 6H"),this.makeDrilldown(this.aggregate("M","3HP","completed_new_on_art"),"All male completed new on ART 3HP"),this.makeDrilldown(this.aggregate("M","6H","completed_new_on_art"),"All male completed new on ART 6H"),this.makeDrilldown(this.aggregate("M","3HP","completed_previously_on_art"),"All male completed previously on ART 3HP"),this.makeDrilldown(this.aggregate("M","6H","completed_previously_on_art"),"All male completed previously on ART 6H")])},async setRows(r){for(const s in u){const o=u[s],e=this.cohort[o][r],a=this.formatGender(r);this.rows.push([t.td(o),t.td(a),this.makeDrilldown(e["3HP"].started_new_on_art,"".concat(o," started new on ART 3HP (").concat(a,"s)")),this.makeDrilldown(e["6H"].started_new_on_art,"".concat(o," started new on ART 6H (").concat(a,"s)")),this.makeDrilldown(e["3HP"].started_previously_on_art,"".concat(o," started previously on ART 3HP (").concat(a,"s)")),this.makeDrilldown(e["6H"].started_previously_on_art,"".concat(o," started previously on ART 6H (").concat(a,"s)")),this.makeDrilldown(e["3HP"].completed_new_on_art,"".concat(o," completed new on ART 3HP (").concat(a,"s)")),this.makeDrilldown(e["6H"].completed_new_on_art,"".concat(o," completed new on ART 6H (").concat(a,"s)")),this.makeDrilldown(e["3HP"].completed_previously_on_art,"".concat(o," completed previously on ART 3HP (").concat(a,"s)")),this.makeDrilldown(e["6H"].completed_previously_on_art,"".concat(o," completed previously on ART 6H (").concat(a,"s)"))])}}}});function D(r,s,o,e,a,p){const l=m("report-template"),n=m("ion-page");return T(),H(n,null,{default:v(()=>[g(l,{title:r.title,period:r.period,rows:r.rows,fields:r.fields,columns:r.columns,reportPrefix:"PEPFAR",config:{showIndex:!0},onReportConfiguration:r.onPeriod},null,8,["title","period","rows","fields","columns","onReportConfiguration"])]),_:1})}const F=R(y,[["render",D]]);export{F as default};
