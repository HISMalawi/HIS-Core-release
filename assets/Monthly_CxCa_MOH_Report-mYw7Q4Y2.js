import{d as ae,cb as re,I as se,l as le,k as ie,a4 as ce,a5 as ue,ah as de,aC as fe,a7 as ge,m as pe,r as b,c as K,aR as ve,bD as me,dX as _e,ce as be,cf as ye,cg as he,ch as Ce,ci as De,aq as Ie,aZ as W,S as w,B as te,ak as ne,ap as p,h as m,b as c,e as f,w as d,j as P,a6 as k,g as I,t as j,a as V,a9 as $,aa as Y,bb as we,aO as Se,v as Oe,n as Te,o as ke,aE as $e,z,s as Ne,y as Ae,am as x,al as U,H as Re,ct as B}from"./index-SU-Girx6.js";import{b as He,a as Ee}from"./Export-DfsAiS0C.js";import{C as Me}from"./cxca_report_service-lG-YOKiv.js";import{D as Ve}from"./DrillPatientIds-BVerviVc.js";import"./index-DsYrnnJ9.js";import"./TableView-CuKH2law.js";const Fe=ae({components:{IonToolbar:pe,IonItem:ge,IonIcon:fe,IonLabel:de,IonTitle:ue,IonHeader:ce,IonButton:ie,IonFooter:le,IonContent:se,IonButtons:re},props:{title:{type:String,default:"Report"},subtitle:{type:String},columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},onFinish:{type:Function},onRefresh:{type:Function},onConfigure:{type:Function},csvQuarter:{type:String},headers:{type:Array,default:()=>[]},order:{type:Array,default:()=>[]},csvSpacing:{type:Number},csvSubHeader:{type:Array,default:()=>[]},csvData:{type:Array,default:()=>[]}},setup(n){const u=Ie(),S=b([]),O=b(""),h=b("desc"),A=K(()=>n.columns.slice(0,1)),C=K(()=>{var s;const o=[];return(s=n.columnData)==null||s.forEach(e=>{const a=n.columns[1].map(t=>{let r="",l={},i=1;try{W.isEmpty(e)?r="...":typeof t.value=="function"?r=t.value(e):r=e[t.ref]||""}catch(y){r="_ERROR_",console.error(y)}return typeof t.dataStyle=="function"&&(l=t.dataStyle(e)),typeof t.colSpan=="function"&&(i=t.colSpan(e)),{column:t,data:e,value:r,styling:l,colSpan:i,[t.ref||"nada"]:r}});o.push({row:a,data:e,searchIndex:[...a,a.map(t=>t.value).join(" ")]})}),o}),_=o=>{O.value=o,h.value=h.value==="asc"?"desc":"asc"},v=()=>{typeof n.onFinish=="function"?n.onFinish():u.push("/")},R=o=>{var s,e;try{typeof((s=o.column)==null?void 0:s.tdClick)=="function"&&((e=o.column)==null||e.tdClick(o));return}catch(a){console.error(a)}},T=()=>n.columns.reduce((o,s)=>o.concat(s),[]).filter(o=>o.value||o.ref),H=()=>{var s;const o=(s=window==null?void 0:window.document)==null?void 0:s.getElementById("report-content");He("\n                <html>\n                    <head> \n                        <style> \n                        table {\n                            border-collapse: collapse;\n                        }\n                        th, td {\n                            width: 4%;\n                            text-align: left;\n                            border: solid 1px black;\n                        }\n                        td {\n                            border-bottom: 1px solid rgb(165, 165, 165);\n                            padding: 0.6em;\n                            font-weight: 500;\n                            font-size: .8em;\n                        }\n                        </style>    \n                    </head>\n                <body> \n                 ".concat(o.innerHTML,"    \n                </body>\n                </html>\n            "))},F=()=>{const o="".concat(w.getLocationName()||"Unknown site","-").concat(n.title,"-").concat(n.subtitle,"-").concat(w.getSessionDate());Ee([n.headers],[...n.csvData,["Date Created: ".concat(te().format("DD/MMM/YYYY HH:MM:ss"))],["Quarter: ".concat(n.csvQuarter||n.subtitle)],["HIS-Core Version: ".concat(w.getCoreVersion())],["API Version: ".concat(w.getApiVersion())],["Site UUID: ".concat(w.getSiteUUID())],["Generated by: ".concat(w.getUserName())]],o)},E=o=>{o.forEach(s=>{const e=T().map(a=>{let t="",r={},l=1;try{W.isEmpty(s)?t="...":typeof a.value=="function"?t=a.value(s):t=s[a.ref]||""}catch(i){t="_ERROR_",console.error(i)}return typeof a.dataStyle=="function"&&(r=a.dataStyle(s)),typeof a.colSpan=="function"&&(l=a.colSpan(s)),{column:a,data:s,value:t,styling:r,colSpan:l,[a.ref||"nada"]:t}});S.value.push({row:e,data:s,searchIndex:[...e,e.map(a=>a.value).join(" ")]})})};return ve(()=>n.columnData,o=>{S.value=[],Array.isArray(o)&&E(o)},{immediate:!0,deep:!0}),{sortColumn:_,onClickTablecell:R,toPDF:H,toCSV:F,finish:v,headerRow:A,sync:De,search:Ce,close:he,arrowUp:ye,arrowDown:be,document:_e,calendar:me,sortOrder:h,sectionOne:C,columnSorted:O}}}),Le={key:0},Pe={class:"his-sm-text"},je={id:"report-content"},Ye={class:"art-report-theme"},ze={class:"stick-report-header"},Ue=["colspan","rowspan","onClick"],Be=["onClick","colspan"];function Qe(n,u,S,O,h,A){const C=p("ion-title"),_=p("ion-icon"),v=p("ion-button"),R=p("ion-buttons"),T=p("ion-toolbar"),H=p("ion-header"),F=p("ion-label"),E=p("ion-item"),o=p("ion-content"),s=p("ion-footer");return c(),m($,null,[f(H,null,{default:d(()=>[f(T,null,{default:d(()=>[f(C,{class:"his-md-text"},{default:d(()=>[P(j(n.title)+" ",1),n.subtitle?(c(),m("br",Le)):k("",!0),I("span",Pe,j(n.subtitle),1)]),_:1}),f(R,{slot:"end"},{default:d(()=>[typeof n.onConfigure=="function"?(c(),V(v,{key:0,onClick:n.onConfigure},{default:d(()=>[f(_,{size:"large",icon:n.calendar},null,8,["icon"])]),_:1},8,["onClick"])):k("",!0),typeof n.onRefresh=="function"?(c(),V(v,{key:1,onClick:n.onRefresh,color:"success",size:"large"},{default:d(()=>[f(_,{size:"large",icon:n.sync},null,8,["icon"])]),_:1},8,["onClick"])):k("",!0)]),_:1})]),_:1})]),_:1}),f(o,{"scroll-y":"","scroll-x":""},{default:d(()=>[I("div",je,[I("table",Ye,[I("thead",ze,[(c(!0),m($,null,Y(n.headerRow,(e,a)=>(c(),m("tr",{key:a},[(c(!0),m($,null,Y(e,(t,r)=>{var l,i;return c(),m("th",{key:r,colspan:((l=t==null?void 0:t.span)==null?void 0:l.thColspan)||1,rowspan:((i=t==null?void 0:t.span)==null?void 0:i.thRowspan)||1,onClick:y=>n.sortColumn(t.ref)},[f(E,{lines:"none"},{default:d(()=>[n.columnSorted&&n.columnSorted===t.ref?(c(),V(_,{key:0,icon:n.sortOrder==="asc"?n.arrowUp:n.arrowDown},null,8,["icon"])):k("",!0),a<n.columns.length-1?(c(),V(F,{key:1,class:"ion-text-center"},{default:d(()=>[I("b",null,j(t.label),1)]),_:2},1024)):k("",!0)]),_:2},1024)],8,Ue)}),128))]))),128))]),I("tbody",null,[(c(!0),m($,null,Y(n.sectionOne,(e,a)=>(c(),m("tr",{key:a},[(c(!0),m($,null,Y(e.row||[],(t,r)=>{var l;return c(),m($,{key:r},[t.value!="TH"?(c(),m("td",{key:0,onClick:()=>n.onClickTablecell(t),class:we({"clickable-cell":(l=t==null?void 0:t.column)==null?void 0:l.tdClick}),colspan:t.colSpan},[I("b",{style:Se(t.styling),class:"his-sm-text"},j(t.value),5)],10,Be)):k("",!0)],64)}),128))]))),128))])])])]),_:1}),f(s,null,{default:d(()=>[f(T,{color:"dark"},{default:d(()=>[f(v,{onClick:u[0]||(u[0]=e=>n.toCSV()),size:"large"},{default:d(()=>[...u[2]||(u[2]=[P(" CSV ",-1)])]),_:1}),f(v,{onClick:u[1]||(u[1]=e=>n.toPDF()),size:"large"},{default:d(()=>[...u[3]||(u[3]=[P(" PDF ",-1)])]),_:1}),f(v,{onClick:n.finish,color:"success",size:"large",slot:"end"},{default:d(()=>[...u[4]||(u[4]=[P(" Finish ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const We=ne(Fe,[["render",Qe],["__scopeId","data-v-26464ae3"]]),Q=b([]),N=b(""),M=b(""),J=b(""),X=b(!1),ee=b(""),G=b([]),qe=ae({components:{IonPage:Te,IonLoading:Oe,v2Datatable:We},setup(){const n=["screened_disaggregated_by_age","screened_disaggregated_by_hiv_status","screened_disaggregated_by_reason_for_visit","screened_disaggregated_by_screening_method","screening_results_hiv_positive","screening_results_hiv_negative","suspects_disaggregated_by_age","total_treated","total_treated_disaggregated_by_tx_option","referral_reasons","referral_feedback","family_planning"],u=e=>Math.floor(e.length/2),S=(e,a)=>e.slice(0,a),O=(e,a)=>e.slice(a),h=(e,a)=>{const t=[];for(let r=0;r<e.length;r++)t.push(e[r].concat(a[r]));return t},A=e=>{const a=[],t=[],r=Object.keys(e);let l,i=0,y=0,D="";return r.forEach(g=>{Object.entries(e[g]).forEach(([L,q])=>{l!=g&&(i=i+1,y=0,T.forEach(Z=>{Z[0]==g&&(g=Z[1])}),a.push([i,g,"TH"]),t.push([i,g,""])),Array.isArray(q)?(y=y+1,D=i+"."+y,a.push([D,L,q]),t.push([D,L,q])):(a.push([D,L,[]]),t.push([D,L,[]])),l=g})}),G.value=t,a},C=e=>{const a={};return n.forEach(t=>{e[t]&&(a[t]=e[t])}),a},_=async(e,a)=>{a.length<=0||(await z.create({component:Ve,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e,subtitle:J,patientIdentifiers:a,onFinish:()=>z.getTop().then(t=>t&&z.dismiss())}})).present()},v=e=>(e.forEach(a=>{a[2]=a[2]==="TH"?" ":a[2],Array.isArray(a[5])&&(a[5]=""+a[5].length),Array.isArray(a[2])&&(a[2]=""+a[2].length,a[5]=a[5]==="TH"?" ":a[5])}),e),R=["age_group","cryotherapy","thermocoagulation","leep","via_deffered","via_reffered","suspected_reffered"],T=[["family_planning","Offered family planning services"],["referral_feedback","Number of clients with referral feedback"],["referral_reasons","Number of clients referred disaggregated by referral reasons"],["screened_disaggregated_by_age","Number of clients screened for cervical cancer disaggregated by age"],["screened_disaggregated_by_hiv_status","Number of clients screened for cervical cancer disaggregated by HIV status"],["screened_disaggregated_by_reason_for_visit","Number of clients screened for cervical cancer disaggregated by reason for visit"],["screened_disaggregated_by_screening_method","Number of clients screened disaggregated by screening method"],["screening_results_hiv_negative","Cervical cancer screening results (HIV- / unknown)"],["screening_results_hiv_positive","Cervical cancer screening results (HIV+)"],["suspects_disaggregated_by_age","Cervical Cancer suspects disaggregated by age"],["total_treated","Total number of clients treated"],["total_treated_disaggregated_by_tx_option","Number of clients treated disaggregated by treatment option"]],H=["Indicator #","Name of Indicator","Value","Indicator #","Name of Indicator","Value"],E=[[{label:"indicator #",ref:""},{label:"Name of indicator",ref:""},{label:"value",ref:""},{label:"indicator #",ref:""},{label:"Name of indicator",ref:""},{label:"value",ref:""}],[{label:"Indicator #",ref:"data.indicatorOne",secondaryLabel:"Indicator #",value:e=>e.indicatorOne},{label:"Name of Indicator",ref:"data.nameOfIndicatorOne",secondaryLabel:"Name of Indicator",value:e=>e.nameOfIndicatorOne,dataStyle:e=>e.valueOne==="TH"?{fontWeight:"bold"}:{fontWeight:"normal"},colSpan:e=>e.valueOne==="TH"?2:1},{label:"value",ref:"data.valueOne",secondaryLabel:"Value",value:e=>Array.isArray(e.valueOne)?e.valueOne.length:e.valueOne,tdClick:({data:e})=>_("".concat(e.indicatorOne," ").concat(e.nameOfIndicatorOne),e.valueOne)},{label:"Indicator #",ref:"data.indicatorTwo",secondaryLabel:"Indicator #",value:e=>e.indicatorTwo},{label:"Name of Indicator",ref:"data.nameOfIndicatorTwo",secondaryLabel:"Name of Indicator",value:e=>e.nameOfIndicatorTwo,dataStyle:e=>e.valueTwo==="TH"?{fontWeight:"bold"}:{fontWeight:"normal"},colSpan:e=>e.valueTwo==="TH"?2:1},{label:"value",ref:"data.valueTwo",secondaryLabel:"Value",value:e=>Array.isArray(e.valueTwo)?e.valueTwo.length:e.valueTwo,tdClick:({data:e})=>_("".concat(e.indicatorTwo," ").concat(e.nameOfIndicatorTwo),e.valueTwo)}]],o=async()=>{if(!(N.value&&M.value))return Ne("Start date and end date required!");X.value=!0,Q.value=[];const e=new Me;e.startDate=N.value,e.endDate=M.value;try{const a=await e.getClinicReport("SCREENED FOR CXCA"),t=C(a),r=A(t),l=u(r),i=h(S(r,l),O(r,l)),y=W.cloneDeep(i);G.value=v(y);const D=i.map(g=>({indicatorOne:g[0],nameOfIndicatorOne:g[1],valueOne:g[2],indicatorTwo:g[3],nameOfIndicatorTwo:g[4],valueTwo:g[5]}));Q.value=D}catch(a){Ae("Unable to generate report!"),console.error(a)}X.value=!1},s=()=>$e([{id:"year",helpText:"Select Year",type:x.TT_NUMBER,computedValue:e=>e.value,validation:e=>{const a=W.isPlainObject(e)?e.value:-1;return U.validateSeries([()=>U.required(e),()=>isNaN(parseInt("".concat(a)))?["Invalid year"]:null,()=>U.rangeOf(e,2e3,Re.getYear(w.getSessionDate()))])}},{id:"month",helpText:"Select Month",type:x.TT_SELECT,validation:e=>U.required(e),computedValue:e=>e.value,options:()=>[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}]}],e=>{N.value="".concat(e.year.value,"-").concat(e.month.value,"-01"),M.value=te(new Date(N.value).toISOString()).endOf("month").format("YYYY-MM-DD"),J.value="Period (".concat(B(N.value)," to ").concat(B(M.value),")"),z.dismiss(),ee.value="".concat(B(N.value)," to ").concat(B(M.value)),o()});return ke(()=>!Q.value.length&&s()),{columns:E,isLoading:X,reportData:Q,period:J,csvQuarter:ee,generate:o,configure:s,order:R,csvheaders:H,spacing:5,csvData:G}}});function Je(n,u,S,O,h,A){const C=p("ion-loading"),_=p("v2Datatable"),v=p("ion-page");return c(),V(v,null,{default:d(()=>[f(C,{"is-open":n.isLoading,message:"Please wait..."},null,8,["is-open"]),f(_,{title:"MONTHLY MOH Report",subtitle:n.period,columns:n.columns,columnData:n.reportData,rowsPerPage:25,onConfigure:n.configure,csvQuarter:n.csvQuarter,onRefresh:()=>n.generate(),order:n.order,headers:n.csvheaders,"csv-spacing":n.spacing,"csv-data":n.csvData},null,8,["subtitle","columns","columnData","onConfigure","csvQuarter","onRefresh","order","headers","csv-spacing","csv-data"])]),_:1})}const aa=ne(qe,[["render",Je]]);export{aa as default};
