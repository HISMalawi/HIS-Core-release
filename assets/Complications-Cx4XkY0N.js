import{d as M,r as C,ap as J,t as q,u as v,B as O,x as s,w as l,y as t,z as f,E as b,C as w,G as z,Z as k,H as L,v as S,aq as U,R as V,S as Q,Q as K,b3 as X,_ as Z,$ as Y,a0 as j,dt as G,W as E,dy as x,a1 as g,ac as ee,U as te,a3 as $,a4 as ae,a6 as oe,bT as P,bY as se,a9 as B,cn as le,aU as ne,aa as H,e2 as p,a5 as ue}from"./index-ii3Qn3XY.js";import{H as ie}from"./HisStandardForm-BNHNq2GT.js";import{u as re}from"./useEncounter-DoAE9IB5.js";import{r as de}from"./commons-MplJBN16.js";import"./isEmpty-BXfQY2H7.js";import"./encounter_guidelines-3aDCQ_kP.js";import"./GuidelineEngine-D6V1_Znr.js";const ce={key:0,class:"side-title"},fe=M({__name:"SideEffects",props:{prevSideEffectState:{type:Object},sideEffects:{type:Object,required:!0},drugs:{type:Array,default:()=>[]}},setup(F){const n=C(""),a=C({}),_=F,R=J(()=>Object.keys(a.value).every(u=>{const e=a.value[u];return Object.keys(e.drugReason).some(c=>e.drugReason[c].isChecked)||"".concat(e.otherReason).length>0}));function I(){U.dismiss()}function T(){const u=[];Object.keys(a.value).forEach(e=>{Object.keys(a.value[e].drugReason).forEach(o=>{a.value[e].drugReason[o].isChecked&&u.push({concept:a.value[e].concept,drug:a.value[e].drugReason[o].detail})}),a.value[e].otherReason&&u.push({concept:a.value[e].concept,other:a.value[e].otherReason})}),U.dismiss({values:u,state:a.value})}function A(u){u.detail.checked&&(a.value[n.value].otherReason="")}function N(){Object.keys(a.value[n.value].drugReason).forEach(u=>{a.value[n.value].drugReason[u].isChecked=!1})}return q(()=>{_.prevSideEffectState?a.value=_.prevSideEffectState:_.sideEffects.forEach(u=>{n.value||(n.value=u.label),a.value[u.label]={concept:u.other.concept,drugReason:_.drugs.reduce((e,o)=>(e[o.drug.name]={isChecked:!1,detail:o},e),{}),otherReason:""}})}),(u,e)=>(v(),O(b,null,[s(t(K),null,{default:l(()=>[s(t(V),null,{default:l(()=>[s(t(Q),{class:"his-lg-text"},{default:l(()=>e[2]||(e[2]=[f("Suspected causes")])),_:1})]),_:1})]),_:1}),s(t(te),{style:{overflowY:"hidden",background:"grey"}},{default:l(()=>[s(t(X),null,{default:l(()=>[s(t(Z),null,{default:l(()=>[s(t(Y),null,{default:l(()=>[s(t(j),{style:{overflowY:"auto",height:"78vh"}},{default:l(()=>[s(t(G),{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=o=>n.value=o)},{default:l(()=>[(v(!0),O(b,null,w(a.value,(o,c)=>(v(),S(t(E),{class:"his-md-text",key:c},{default:l(()=>[s(t(x),{slot:"start",value:c},null,8,["value"]),s(t(g),null,{default:l(()=>[f(k(c),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),s(t(Y),{style:{overflowY:"auto",height:"78vh"}},{default:l(()=>[n.value?(v(),O("div",ce,[z("b",null,k(n.value),1),e[3]||(e[3]=f(" causes "))])):L("",!0),n.value?(v(),S(t(j),{key:1},{default:l(()=>[s(t(E),{class:"his-lg-text"},{default:l(()=>[s(t(g),null,{default:l(()=>e[4]||(e[4]=[f("Current Medication(s)")])),_:1})]),_:1}),(v(!0),O(b,null,w(a.value[n.value].drugReason,(o,c)=>(v(),S(t(E),{class:"his-md-text",key:c},{default:l(()=>[s(t(g),null,{default:l(()=>[f(k(c),1)]),_:2},1024),s(t(ee),{onIonChange:A,slot:"start",modelValue:o.isChecked,"onUpdate:modelValue":D=>o.isChecked=D},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1})):L("",!0),n.value?(v(),S(t(G),{key:2,onIonChange:N,modelValue:a.value[n.value].otherReason,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value[n.value].otherReason=o)},{default:l(()=>[s(t(E),{class:"his-lg-text"},{default:l(()=>[s(t(g),null,{default:l(()=>e[5]||(e[5]=[f("Previous Medication")])),_:1})]),_:1}),s(t(E),{class:"his-md-text"},{default:l(()=>[s(t(g),null,{default:l(()=>e[6]||(e[6]=[f("Other, not drug related")])),_:1}),s(t(x),{slot:"start",value:"Other"})]),_:1}),s(t(E),{class:"his-md-text"},{default:l(()=>[s(t(g),null,{default:l(()=>e[7]||(e[7]=[f("Drug side effect")])),_:1}),s(t(x),{slot:"start",value:"Drug side effect"})]),_:1})]),_:1},8,["modelValue"])):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),s(t(ae),null,{default:l(()=>[s(t(V),null,{default:l(()=>[s(t($),{onClick:I,slot:"start",size:"large",color:"danger"},{default:l(()=>e[8]||(e[8]=[f(" Close ")])),_:1}),s(t($),{onClick:T,size:"large",slot:"end",disabled:!R.value},{default:l(()=>e[9]||(e[9]=[f(" Save ")])),_:1},8,["disabled"])]),_:1})]),_:1})],64))}}),pe=oe(fe,[["__scopeId","data-v-94746907"]]),Se=M({__name:"Complications",setup(F){const n=C([]),a=new P(-1,se.COMPLICATIONS),_=C([]),R=C({}),I={pageOne:{"Abnominal pain":"ABNOMINAL_PAIN",Athralgia:"ATHRALGIA","Colour body fluids":"COLOUR_BODY_FLUIDS",Depression:"DEPRESSION",Fatigue:"FATIGUE",Gastrointestinal:"GASTROINTESTINAL",Headache:"HEADACHE","Hearing Difficulties":"HEARING_DIFFICULTIES",Hematological:"HEMATOLOGICAL",Hepatoxicity:"HEPATOXICITY",Hypothyroidism:"HYPOTHYROIDISM",Itching:"SKIN_ITCHING"},pageTwo:{Jaundice:"JAUNDICE","Lactic Acidosis":"LACTIC_ACIDOSIS",Numbness:"NUMBNESS_IN_HANDS_FEET_LEGS","Optic Neuritis":"OPTIC_NEURITIS",Pancreatitis:"PANCREATITIS","Periferal Neuropathy":"PERIFERAL_NEUROPATHY",Psychosis:"PSYCHOSIS","QT Prolongation":"QT_PROLONGATION","Renal failure":"RENAL_FAILURE","Skin Rash":"SKIN_RASH",Toxicity:"TOXICITY"}},{goToNextTask:T,patientDashboardUrl:A}=re((e,o)=>{a.patientID=o,a.providerID=e;function c(){let d=[];return{id:"history",helpText:"Side effects / Contraindications history",type:B.TT_TABLE_VIEWER,init:async()=>{const y=await P.getJson("programs/".concat(a.programID,"/patients/").concat(o,"/medication_side_effects"),{date:a.date});return Object.keys(y).forEach(i=>{d.push([le(i),Object.values(y[i]).flat(1).map(r=>"<b>".concat(r.name,"</b> ").concat(r.drug_induced?"(Drug-induced)":""," : ").concat(r.drug||"Unknown"," ")).join("<p/>")])}),!0},condition:()=>d.length,options:()=>[{label:"",value:"",other:{columns:["Date","Condition"],rows:d}}]}}function D(){return Object.keys(I).map((d,y)=>({id:d,helpText:"Page ".concat(y+1,": Contraindications / Side effects"),type:B.TT_MULTIPLE_YES_NO,init:async()=>(ne.isEmpty(_.value)&&(_.value=await P.getJson("patients/".concat(o,"/last_drugs_received"),{program_id:a.programID})),!0),beforeNext:async i=>{const r=i.filter(m=>m.value==="YES_ANSWER");if(r.length){const m=await U.create({component:pe,backdropDismiss:!1,cssClass:"large-modal",componentProps:{sideEffects:r,drugs:_.value}});m.present();const{data:h}=await m.onDidDismiss();if(!h)return!1;R.value[d]=h.values}return!0},validation:i=>H.validateSeries([()=>H.required(i),()=>H.anyEmpty(i)]),computedValue:i=>i.map(r=>({concept_id:p("MALAWI_TB_SIDE_EFFECTS"),value_coded:p("".concat(r.other.concept)),child:[{concept_id:p("".concat(r.other.concept)),value_coded:p("".concat(r.value)),obs_datetime:a.date}],obs_datetime:a.date})),options:i=>Object.keys(I[d]).map(r=>{var m,h;return{label:r,value:((h=(m=i[d])==null?void 0:m.find(W=>W.label===r))==null?void 0:h.value)||"",other:{concept:I[d][r],values:[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]}}}),config:{footerBtns:[{name:"None",slot:"end",onClickComponentEvents:{refreshOptions:()=>Object.keys(I[d]).map(i=>({label:i,value:"NO_ANSWER",other:{concept:I[d][i],values:[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]}}))},onClick:()=>"None"}]}}))}n.value=[c(),...D()]});function N(){return Object.values(R.value).flat(1).map(o=>o.other&&/drug/i.test(o.other)?{concept_id:p("DRUG_INDUCED"),value_coded:p(o.concept),value_text:"Past medication history"}:o.drug?{concept_id:p("DRUG_INDUCED"),value_coded:p(o.concept),value_drug:o.drug.drug.drug_id}:{concept_id:p("CONTRAINDICATIONS"),value_coded:p(o.concept)})}async function u(e,o){await a.createEncounter(),await a.saveObservationList([...await de(o),...N()]),T()}return(e,o)=>(v(),S(t(ue),null,{default:l(()=>[s(ie,{cancelDestinationPath:t(A),onFinishAction:u,fields:n.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{Se as default};
