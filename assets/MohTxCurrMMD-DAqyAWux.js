import{_ as f}from"./ReportMixin.vue_vue_type_script_lang-5B57RLMa.js";import{T as u}from"./tx_report_service-BEoNLADR.js";import{R as w}from"./TableReportTemplate-BXc2_KE-.js";import{d as M,I as g,L as n,ab as m,cx as A,_ as v,r as d,o as R,c as F,w as T,b as _}from"./index-ChqjXh1q.js";import{M as S}from"./moh_cohort_service-xLibs2Zh.js";import"./MultiFieldDateHelper-BeB1wkpH.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./BasicReportTemplate-Cd6YwWw4.js";import"./Export-C9Hhxwb2.js";import"./SIngleTouchField-BdybEVDH.js";import"./Pagination-CrJFF6Hd.js";import"./HisStandardForm-BfZPxRjA.js";import"./TouchScreenForm-Bp625zJI.js";import"./ToolbarMediumCard-NV07rtjo.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-DBgU2Ffk.js";import"./ReportErrors-CzIGccNx.js";const C=M({mixins:[f],components:{ReportTemplate:w,IonPage:g},data:()=>({title:"Moh TX CURR MMD Report",cohort:{},rows:[],headerInfoList:[],totals:new Set,mohCohort:{},errors:[],showStatus:!1,aggregate:{Male:{},Female:{}},columns:[[n.thTxt("Age group"),n.thTxt("Gender"),n.thNum("# of clients on <3 months of ARVs"),n.thNum("# of clients on 3 - 5 months of ARVs"),n.thNum("# of clients on >= 6 months of ARVs")]],canValidate:!1}),created(){this.fields=this.getDateDurationFields()},watch:{async canValidate(t){t&&await this.validateReport()}},methods:{async onPeriod(t,s){this.canValidate=!1,this.rows=[],this.errors=[],this.showStatus=!1,this.report=new u,this.mohCohort=new S,this.mohCohort.setStartDate(s.start_date),this.mohCohort.setEndDate(s.end_date),this.mohCohort.setOccupation(s.occupation),this.report.setOrg("moh"),this.report.setOccupation(s.occupation),this.report.setStartDate(s.start_date),this.report.setEndDate(s.end_date),this.period=this.report.getDateIntervalPeriod(),await this.setMaleFemaleRows(),this.setTotalMalesRows(),await this.setTotalFemaleRows(),this.setHeaderInfoList(),this.canValidate=!0,this.showStatus=!0},setHeaderInfoList(){this.headerInfoList=[{label:"Total clients",value:this.totals.size,other:{onclick:()=>this.runTableDrill(Array.from(this.totals),"Total Clients")}}]},addToAggregates(t,s){Object.entries(s).forEach(([o,e])=>{var a;this.aggregate[t][o]=[...(a=this.aggregate[t][o])!=null?a:[],...e]})},buildRow(t,s,o){const e=[],a=[],r=[],i=t[o];if(!m.isEmpty(i))for(const l in i){const h=i[l].prescribed_days;this.totals.add(l),h<90&&e.push(l),h>=90&&h<=150&&a.push(l),h>150&&r.push(l)}return this.addToAggregates(o,{underThreeMonths:e,betweenThreeAndFiveMonths:a,overSixMonths:r}),[n.td(s),n.td(o),this.drill(e,"".concat(s," (").concat(o,"s) < 3 months of Arvs")),this.drill(a,"".concat(s," (").concat(o,"s) 3-5 months of Arvs")),this.drill(r,"".concat(s," (").concat(o,"s) > 6 months months of Arvs"))]},async setMaleFemaleRows(){const t=[],s=[];for(const o of A){const[e,a]=this.parseAgeGroup(o),r=await this.report.getTxCurrMMDReport(e,a);this.report.initArvRefillPeriod(!1),s.push(this.buildRow(r,o,"Female")),t.push(this.buildRow(r,o,"Male")),this.rows=[...s,...t]}},setTotalMalesRows(){this.rows.push([n.td("All"),n.td("Male"),this.drill(this.aggregate.Male.underThreeMonths,"All (Males) < 3 months of Arvs"),this.drill(this.aggregate.Male.betweenThreeAndFiveMonths,"All (Males) 3-5 months of Arvs"),this.drill(this.aggregate.Male.overSixMonths,"All (Males) > 6 months months of Arvs")])},async setTotalFemaleRows(){const t=m.uniq(Object.values(this.aggregate.Female).flat(1)),s=await this.report.getMaternalStatus(t),o=s.FBf.concat(s.FP),e=(r,i,l)=>{const h=r.filter(c=>{const p=parseInt(c.toString());return i==="FNP"?!o.includes(p):s[i].includes(p)});return this.drill(h,l)},a=(r,i)=>{this.rows.push([n.td("All"),n.td(r),e(this.aggregate.Female.underThreeMonths,i,"All (".concat(r,"s) < 3 months of Arvs")),e(this.aggregate.Female.betweenThreeAndFiveMonths,i,"All (".concat(r,"s) 3-5 months of Arvs")),e(this.aggregate.Female.overSixMonths,i,"All (".concat(r,"s) > 6 months of Arvs"))])};a("FP","FP"),a("FNP","FNP"),a("FBF","FBf")},validateReport(){const t={total_alive_and_on_art:{param:this.totals.size,check:(o,e)=>o!=e,error:(o,e)=>"\n                        MoH cohort Alive and on ART clients <b>(".concat(o,")</b> is not\n                        matching with total TX MMD clients <b(").concat(e,").</b>\n                    ")}};this.mohCohort.validateIndicators(t,o=>this.errors=o)===-1&&(this.errors=["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])}}});function $(t,s,o,e,a,r){const i=d("report-template"),l=d("ion-page");return R(),F(l,null,{default:T(()=>[_(i,{title:t.title,period:t.period,rows:t.rows,fields:t.fields,columns:t.columns,reportPrefix:"MoH",config:{showIndex:!0},validationErrors:t.errors,showValidationStatus:t.showStatus,headerInfoList:t.headerInfoList,onReportConfiguration:t.onPeriod},null,8,["title","period","rows","fields","columns","validationErrors","showValidationStatus","headerInfoList","onReportConfiguration"])]),_:1})}const G=v(C,[["render",$]]);export{G as default};
