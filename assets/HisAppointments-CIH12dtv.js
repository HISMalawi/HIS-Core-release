import{d as S,ac as v,ad as $,b5 as L,c0 as F,H as n,au as m,B as O,dj as c,ak as R,ap as o,a as y,b as D,w as a,g as i,e as s,bb as B,h as T,a6 as w,t as l}from"./index-3BeNlo1y.js";import{_ as I}from"./v-calendar.es--VDGtzwE.js";import{A as _}from"./appointment_service-zeZG6hW9.js";import{_ as M}from"./FieldMixin.vue_vue_type_script_lang-DWS8ZAew.js";const P=S({components:{ViewPort:F,Calendar:I,IonGrid:L,IonCol:$,IonRow:v},mixins:[M],watch:{startDate:{async handler(t){const e=t||n.toStandardHisDisplayFormat(this.sessionDate);this.$emit("onValue",{label:"",value:e})},immediate:!0}},data:()=>({rows:[],startDate:null,runOutDate:null,appointments:[],clinicHolidays:[],clinicDays:[],patientAge:0,appointmentLimit:0,sessionDate:null,masks:{weekdays:"WWW"}}),mounted(){this.$emit("onFieldActivated",this)},activated(){this.$emit("onFieldActivated",this)},async created(){this.patientAge=this.config.patientAge||0,await this.getAppointmentLimit(),await this.getClinicHolidays(),await this.getClinicDays();const t=await this.options(this.fdata);this.sessionDate=_.getSessionDate();const e=t[0].other.appointmentDate;this.appointments=await this.getAppointments(e),this.setDate(e),this.runOutDate=t[0].other.runOutDate?new Date(t[0].other.runOutDate):null},methods:{getAppointments(t){return _.getDailiyAppointments(n.toStandardHisFormat(t))},async getAppointmentLimit(){const t=await c.appointmentLimit();t&&(this.appointmentLimit=t)},async getClinicHolidays(){const t=await c.clinicHolidays();t&&(this.clinicHolidays=t.split(","))},async getClinicDays(){let t="";this.patientAge>=18?t=await c.adultClinicDays():t=await c.peadsClinicDays(),t&&(this.clinicDays=t.split(","))},async isDateAvalaible(t){const e=await this.getAppointments(t);if(e.length!==0&&e.length>=this.appointmentLimit&&await m("Appointment limit reached for the selected date ".concat(n.toStandardHisDisplayFormat(t)),{header:"APPOINTMENT LIMIT REACHED",cancelBtnLabel:"Proceed with Selected Date",confirmBtnLabel:"Select Another Date"})||this.clinicHolidays.includes(n.toStandardHisFormat(t))&&!await m("Selected date is a clinic holiday, do you want to set an appointment?"))return!1;const h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][O(t).day()];return!this.clinicDays.includes(h)&&!await m("The selected date ".concat(n.toStandardHisDisplayFormat(t)," is not a clinic day. Do you want to proceed with this date?"))?!1:(this.appointments=e,!0)},async setDate(t){this.startDate=new Date(t);const e=this.$refs.calendar;await e.move(this.startDate),await e.focusDate(this.startDate)},async dayClicked(t){!t.isDisabled&&await this.isDateAvalaible(t.id)&&this.setDate(t.id)}},computed:{showMedicationRunoutDate(){var t,e;return typeof((t=this.config)==null?void 0:t.hideRunoutDate)=="boolean"?!((e=this.config)!=null&&e.hideRunoutDate):!0},aDate(){return n.toStandardHisDisplayFormat(this.startDate)},rDate(){return n.toStandardHisDisplayFormat(this.runOutDate)},cDate(){return n.toStandardHisFormat(this.startDate)},attributes(){return[{highlight:!0,dates:this.aDate}]}}}),N={class:"view-port-content"},V=["onClick"],E={key:0,class:"appointments"};function W(t,e,g,h,u,z){const b=o("Calendar"),f=o("ion-col"),d=o("ion-label"),p=o("ion-item"),A=o("ion-list"),C=o("ion-row"),k=o("ion-grid"),H=o("view-port");return D(),y(H,null,{default:a(()=>[i("div",N,[s(k,null,{default:a(()=>[s(C,null,{default:a(()=>[s(f,{size:"8"},{default:a(()=>[s(b,{color:"blue",ref:"calendar","is-expanded":"",class:"custom-calendar","min-date":t.sessionDate,"max-date":t.runOutDate,attributes:t.attributes,masks:t.masks,"disable-page-swipe":""},{"day-content":a(({day:r})=>[i("div",{onClick:j=>t.dayClicked(r),class:B({selected:r.id===t.cDate,isDisabled:r.isDisabled})},[i("span",null,l(r.day),1),r.id===t.cDate?(D(),T("sup",E,l(t.appointments.length),1)):w("",!0)],10,V)]),_:1},8,["min-date","max-date","attributes","masks"])]),_:1}),s(f,{size:"4",class:"his-card"},{default:a(()=>[s(A,null,{default:a(()=>[t.showMedicationRunoutDate&&t.rDate?(D(),y(p,{key:0,class:"his-sm-text"},{default:a(()=>[s(d,{class:"ion-text-wrap"},{default:a(()=>[e[0]||(e[0]=i("b",null,"Medication Run out Date",-1)),e[1]||(e[1]=i("p",null,null,-1)),i("span",null,l(t.rDate),1)]),_:1})]),_:1})):w("",!0),s(p,{class:"his-sm-text"},{default:a(()=>[s(d,{class:"ion-text-wrap"},{default:a(()=>[e[2]||(e[2]=i("b",null,"User set appointment date",-1)),e[3]||(e[3]=i("p",null,null,-1)),i("span",null,l(t.aDate),1)]),_:1})]),_:1}),s(p,{class:"his-sm-text"},{default:a(()=>[s(d,{class:"ion-text-wrap"},{default:a(()=>[e[4]||(e[4]=i("b",null,"Appointment(s)",-1)),e[5]||(e[5]=i("p",null,null,-1)),i("span",null,l(t.appointments.length),1)]),_:1})]),_:1}),s(p,{class:"his-sm-text"},{default:a(()=>[s(d,{class:"ion-text-wrap"},{default:a(()=>[e[6]||(e[6]=i("b",null,"Appointment limit (per/day)",-1)),e[7]||(e[7]=i("p",null,null,-1)),i("span",null,l(t.appointmentLimit),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})}const J=R(P,[["render",W]]);export{J as default};
