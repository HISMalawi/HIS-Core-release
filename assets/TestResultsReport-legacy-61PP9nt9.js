System.register(["./lab_report_service-legacy-CSUYjLdb.js","./ReportMixin.vue_vue_type_script_lang-legacy-C85CDn6B.js","./TableReportTemplate-legacy-CpYI8faP.js","./index-legacy-Ck8hVlzC.js","./HisStandardForm-legacy-OroqgFde.js","./ReportErrors-legacy-D5GAXSdV.js"],(function(e,t){"use strict";var r,s,a,i,o,l,n,d,p,h,u;return{setters:[e=>{r=e.L},e=>{s=e._},e=>{a=e.R},e=>{i=e.d,o=e.L,l=e.F,n=e.cW,d=e._,p=e.r,h=e.o,u=e.c},null,null],execute:function(){const t=i({mixins:[s],components:{ReportTemplate:a},data:()=>({title:"Lab test result(s)",rows:[],cohort:[],reportType:"",reportReady:!1,columns:[],patientLevelColumns:[[o.thTxt("ARV#"),o.thTxt("Gender"),o.thTxt("Birthdate"),o.thTxt("Ordered"),o.thTxt("Specimen"),o.thTxt("Test"),o.thTxt("Result"),o.thTxt("Released")]],disaggregatedColumns:[o.thTxt("Age group"),o.thTxt("Gender")]}),created(){this.report=new r,this.fields=this.getFormFields()},methods:{async onPeriod({type:e,tests:t}){this.reportReady=!0,this.rows=[],this.period=this.report.getDateIntervalPeriod(),this.reportType=e.value,"disaggregated"===this.reportType?this.setDisaggregatedRows(t):"patient_level"===this.reportType&&this.setPatientLevelRows(t)},getFormFields(){return[...this.getDateDurationFields(),{id:"tests",helpText:"Available test(s) results",type:l.TT_MULTIPLE_SELECT,options:async(e,t,r)=>{this.report.setStartDate(r.start_date),this.report.setEndDate(r.end_date);const s=await this.report.getLabResultsReport(),a=this.buildAvailableTests(s);return this.buildAvailableTestOptions(a)}},{id:"type",helpText:"Select report type",type:l.TT_SELECT,options:()=>[{label:"Disaggregated",value:"disaggregated"},{label:"Patient level",value:"patient_level"}]}]},buildAvailableTests(e){const t={};return this.sortByArvNumber(e).forEach((e=>{e.measures.forEach((r=>{r.name in t||(t[r.name]=[]),t[r.name].push({id:e.patient_id,arv:e.arv_number,gender:e.gender,ageGroup:e.age_group,birthdate:this.toDate(e.birthdate),ordered:this.toDate(e.order_date),specimen:e.test,test:r.name,result:`${r.modifier} ${r.value}`,released:this.toDate(e.result_date)})}))})),t},buildAvailableTestOptions(e){const t=[];for(const r in e){const s=e[r];t.push({label:r,value:s.length,other:s})}return t},setDisaggregatedRows(e){const t=[],r=[];this.columns=[this.disaggregatedColumns.concat(e.map((e=>o.thTxt(e.label))))];for(const s in n){const a=n[s],i=[o.td(a),o.td("M")],l=[o.td(a),o.td("F")];e.forEach((({other:e})=>{const t=t=>e.filter((e=>e.gender===t&&e.ageGroup===a)).map((e=>e.id));i.push(this.drill(t("M"))),l.push(this.drill(t("F")))})),t.push(i),r.push(l),this.rows=[...r,...t]}},setPatientLevelRows(e){this.columns=this.patientLevelColumns,e.forEach((({other:e})=>{e.forEach((e=>{this.rows.push([this.tdARV(e.arv),o.td(e.gender),o.tdDate(e.birthdate),o.tdDate(e.ordered),o.td(e.specimen),o.td(e.test),o.td(e.result),o.tdDate(e.released)])}))}))}}});e("default",d(t,[["render",function(e,t,r,s,a,i){const o=p("report-template");return h(),u(o,{title:e.title,period:e.period,rows:e.rows,fields:e.fields,columns:e.columns,canExportCsv:!0,canExportPDf:!0,reportReady:e.reportReady,onReportConfiguration:e.onPeriod},null,8,["title","period","rows","fields","columns","reportReady","onReportConfiguration"])}]]))}}}));
