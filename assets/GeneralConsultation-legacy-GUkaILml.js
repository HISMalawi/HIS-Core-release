System.register(["./HisStandardForm-legacy-CGi-zolz.js","./index-legacy-pSEoxn3J.js","./useEncounter-legacy-D27v7I9F.js","./commons-legacy-B7dPhjdd.js","./isEmpty-legacy-De9HmsH6.js","./encounter_guidelines-legacy-mYSO8ZN5.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,n,o,i,s,l,u,r,c,d,m,y,p,T,g,b,v,h,f,_;return{setters:[e=>{a=e.H},e=>{n=e.d,o=e.r,i=e.bW,s=e.an,l=e.ao,u=e.a,r=e.w,c=e.e,d=e.f,m=e.m,y=e.a$,p=e.bn,T=e.b,g=e.q},e=>{b=e.u},e=>{v=e.y,h=e.m,f=e.a,_=e.r},null,null,null],execute:function(){e("default",n({__name:"GeneralConsultation",setup(e){const t=o(0),n=o(!1);let w;const C=o([]),{patientDashboardUrl:S,goToNextTask:B}=b(((e,a,o)=>{w=new i(a,168,e),C.value=function(e){return[{id:"on_tb_treatment",helpText:"On TB Treatment?",type:l.TT_SELECT,validation:e=>s.required(e),computedValue:e=>{const t={tag:"consultation",obs:[w.buildValueCoded("TB treatment",e.value)]};return/yes/i.test(e.value)&&t.obs.push(w.buildValueCoded("TB Status","Confirmed TB on treatment")),t},options:v},{id:"tb_side_effects",helpText:"TB Associated symptoms",type:l.TT_MULTIPLE_YES_NO,init:async()=>{const a=await e.getWeightHistory();return t.value=e.getWeightLossPercentageFromTrail(a),n.value=Number(t.value)>=10,!0},onValue:async e=>(await async function(e){if(n.value&&`${e.label}`.match(/malnutrition/i)&&`${e.value}`.match(/no/i)){const a=await y("Recommendation",`Patient's weight has dropped by ${t.value}% , is this controlled weight loss??`,"Please verify",[{name:"Confirm weight loss",slot:"start",color:"success"},{name:"Confirm controlled",slot:"end",color:"primary"}]);e.value="Confirm weight loss"===a?"Yes":"No"}}(e),!0),validation:e=>s.validateSeries([()=>s.required(e),()=>s.anyEmpty(e)]),condition:e=>e.on_tb_treatment.value.match(/no/i),options:(e,t)=>function(e){const t=p.getConceptsByCategory("tb_symptom",!0).map((({name:e})=>e));return f([...t],e)}(t),computedValue:e=>({tag:"consultation",obs:e.map((async e=>({...await w.buildValueCoded("Routine TB Screening",e.label),child:[await w.buildValueCoded(e.label,e.value)]})))})},{id:"tb_status",helpText:"TB Status",type:l.TT_SELECT,validation:e=>s.required(e),condition:e=>e.tb_side_effects.value.some((e=>/yes/i.test(e.value))),options:()=>h(["TB NOT suspected","TB Suspected","Confirmed TB Not on treatment"]),computedValue:e=>({tag:"consultation",obs:w.buildValueCoded("TB Status",e.value)})}]}(o)}));async function E(e,t){try{const e=await _(t,"consultation");await w.createEncounter(),await w.saveObservationList(e),B()}catch(a){console.error(a),g("An error occurred while saving the complaints")}}return(e,t)=>(T(),u(d(m),null,{default:r((()=>[c(a,{cancelDestinationPath:d(S),fields:C.value,onFinishAction:E,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
