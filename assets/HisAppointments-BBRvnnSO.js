import{V as v}from"./ViewPort-BCxYiILf.js";import{d as S,ai as $,ak as L,aj as F,H as n,cn as p,n as m,a$ as O,_ as R,r as o,o as h,c as f,w as a,A as i,b as s,ar as B,v as l,x as T,z as y}from"./index-BCTN_bnC.js";import{C as I}from"./index-jqPBj3gu.js";import{A as w}from"./appointment_service-GvbXvyjD.js";import{_ as M}from"./FieldMixin.vue_vue_type_script_lang-BcY4Dt1h.js";const P=S({components:{ViewPort:v,Calendar:I,IonGrid:$,IonCol:L,IonRow:F},mixins:[M],watch:{startDate:{async handler(t){const e=t||n.toStandardHisDisplayFormat(this.sessionDate);this.$emit("onValue",{label:"",value:e})},immediate:!0}},data:()=>({rows:[],startDate:null,runOutDate:null,appointments:[],clinicHolidays:[],clinicDays:[],patientAge:0,appointmentLimit:0,sessionDate:null,masks:{weekdays:"WWW"}}),mounted(){this.$emit("onFieldActivated",this)},activated(){this.$emit("onFieldActivated",this)},async created(){this.patientAge=this.config.patientAge||0,await this.getAppointmentLimit(),await this.getClinicHolidays(),await this.getClinicDays();const t=await this.options(this.fdata);this.sessionDate=w.getSessionDate();const e=t[0].other.appointmentDate;this.appointments=await this.getAppointments(e),this.setDate(e),this.runOutDate=t[0].other.runOutDate?new Date(t[0].other.runOutDate):null},methods:{getAppointments(t){return w.getDailiyAppointments(n.toStandardHisFormat(t))},async getAppointmentLimit(){const t=await p.appointmentLimit();t&&(this.appointmentLimit=t)},async getClinicHolidays(){const t=await p.clinicHolidays();t&&(this.clinicHolidays=t.split(","))},async getClinicDays(){let t="";this.patientAge>=18?t=await p.adultClinicDays():t=await p.peadsClinicDays(),t&&(this.clinicDays=t.split(","))},async isDateAvalaible(t){const e=await this.getAppointments(t);if(e.length!==0&&e.length>=this.appointmentLimit&&await m("Appointment limit reached for the selected date ".concat(n.toStandardHisDisplayFormat(t)),{header:"APPOINTMENT LIMIT REACHED",cancelBtnLabel:"Proceed with Selected Date",confirmBtnLabel:"Select Another Date"})||this.clinicHolidays.includes(n.toStandardHisFormat(t))&&!await m("Selected date is a clinic holiday, do you want to set an appointment?"))return!1;const D=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][O(t).day()];return!this.clinicDays.includes(D)&&!await m("The selected date ".concat(n.toStandardHisDisplayFormat(t)," is not a clinic day. Do you want to proceed with this date?"))?!1:(this.appointments=e,!0)},async setDate(t){this.startDate=new Date(t);const e=this.$refs.calendar;await e.move(this.startDate),await e.focusDate(this.startDate)},async dayClicked(t){!t.isDisabled&&await this.isDateAvalaible(t.id)&&this.setDate(t.id)}},computed:{showMedicationRunoutDate(){var t,e;return typeof((t=this.config)==null?void 0:t.hideRunoutDate)=="boolean"?!((e=this.config)!=null&&e.hideRunoutDate):!0},aDate(){return n.toStandardHisDisplayFormat(this.startDate)},rDate(){return n.toStandardHisDisplayFormat(this.runOutDate)},cDate(){return n.toStandardHisFormat(this.startDate)},attributes(){return[{highlight:!0,dates:this.aDate}]}}}),V={class:"view-port-content"},N=["onClick"],z={key:0,class:"appointments"},E=i("b",null,"Medication Run out Date",-1),W=i("p",null,null,-1),x=i("b",null,"User set appointment date",-1),j=i("p",null,null,-1),G=i("b",null,"Appointment(s)",-1),U=i("p",null,null,-1),q=i("b",null,"Appointment limit (per/day)",-1),J=i("p",null,null,-1);function K(t,e,g,D,u,Q){const A=o("Calendar"),_=o("ion-col"),r=o("ion-label"),d=o("ion-item"),b=o("ion-list"),C=o("ion-row"),k=o("ion-grid"),H=o("view-port");return h(),f(H,null,{default:a(()=>[i("div",V,[s(k,null,{default:a(()=>[s(C,null,{default:a(()=>[s(_,{size:"8"},{default:a(()=>[s(A,{color:"blue",ref:"calendar","is-expanded":"",class:"custom-calendar","min-date":t.sessionDate,"max-date":t.runOutDate,attributes:t.attributes,masks:t.masks,"disable-page-swipe":""},{"day-content":a(({day:c})=>[i("div",{onClick:X=>t.dayClicked(c),class:B({selected:c.id===t.cDate,isDisabled:c.isDisabled})},[i("span",null,l(c.day),1),c.id===t.cDate?(h(),T("sup",z,l(t.appointments.length),1)):y("",!0)],10,N)]),_:1},8,["min-date","max-date","attributes","masks"])]),_:1}),s(_,{size:"4",class:"his-card"},{default:a(()=>[s(b,null,{default:a(()=>[t.showMedicationRunoutDate&&t.rDate?(h(),f(d,{key:0,class:"his-sm-text"},{default:a(()=>[s(r,{class:"ion-text-wrap"},{default:a(()=>[E,W,i("span",null,l(t.rDate),1)]),_:1})]),_:1})):y("",!0),s(d,{class:"his-sm-text"},{default:a(()=>[s(r,{class:"ion-text-wrap"},{default:a(()=>[x,j,i("span",null,l(t.aDate),1)]),_:1})]),_:1}),s(d,{class:"his-sm-text"},{default:a(()=>[s(r,{class:"ion-text-wrap"},{default:a(()=>[G,U,i("span",null,l(t.appointments.length),1)]),_:1})]),_:1}),s(d,{class:"his-sm-text"},{default:a(()=>[s(r,{class:"ion-text-wrap"},{default:a(()=>[q,J,i("span",null,l(t.appointmentLimit),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})}const it=R(P,[["render",K]]);export{it as default};
