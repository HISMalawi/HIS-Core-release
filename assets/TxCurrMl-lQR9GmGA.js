import{_ as c}from"./ReportMixin.vue_vue_type_script_lang-CqLvuQmv.js";import{T as f}from"./tx_report_service-ghYPkiJy.js";import{R as T}from"./TableReportTemplate-CRKA8rFt.js";import{d as w,I,as as t,aN as R,dz as p,aa as D,c as F,w as x,af as h,a as g,b as P}from"./index-CMZASHAR.js";import"./BasicReportTemplate-CbJ_oMga.js";import"./Export-CpyT9Gk1.js";import"./index-_zuoFVCp.js";import"./Pagination-D_B_LriE.js";import"./HisStandardForm-BCjM4-bc.js";import"./ReportErrors-JbEvJfLt.js";const $=w({mixins:[c],components:{ReportTemplate:T,IonPage:I},data:()=>({title:"PEPFAR Tx ML Report",rows:[],drillData:{},columns:[[t.thTxt("Age group"),t.thTxt("Gender"),t.thTxt("Died"),t.thTxt("IIT <3 mo"),t.thTxt("IIT 3-5 mo"),t.thTxt("IIT 6+ mo"),t.thTxt("Transferred out"),t.thTxt("Refused (Stopped)")]],indexLabel:["Died","IIT <3 mo","IIT 3-5 mo","IIT 6+ mo","Tranferred out","Refused (Stopped)"],cohort:{}}),created(){this.fields=this.getDateDurationFields()},methods:{async onPeriod(e,s,n=!1){this.rows=[],this.report=new f,this.report.setOccupation(s.occupation),this.report.setStartDate(s.start_date),this.report.setEndDate(s.end_date),this.period=this.report.getDateIntervalPeriod(),this.cohort=await this.report.getTxMlReport(n),this.setRows("F"),this.setRows("M"),this.setTotalMaleRow(),this.setMaternalRows()},drilldown(e,s){const n=[[t.thTxt("ARV#"),t.thTxt("DOB"),t.thTxt("Dispensed"),t.thTxt("ARVs"),t.thTxt("Art start date")]],o=async()=>{if(s in this.drillData)return this.drillData[s];const l=await this.report.getTxMMDClientLevelData(e);if(!l)return[];const d=this.report.remapTxClientLevelData(l).map(r=>{const a=r.drugs.map(i=>{const u="\n                                <table style='width: 100%;'> \n                                    <td style='width: 65%;'>".concat(i.name,"</td>\n                                    <td style='width: 30%;'>(").concat(i.quantity,", ").concat(i.dose," a day)</td>\n                                </table>"),m="".concat(i.name," (Quantity: ").concat(i.quantity," Dose: ").concat(i.dose,")");return{tableView:u,dataView:m}});return[t.td(r.id||"N/A"),t.tdDate(r.dob),t.tdDate(r.dispenseDate),t.td(a.map(i=>i.tableView).join("<p/>"),{value:a.map(i=>i.dataView).join("|")}),t.td(r.artStartDate)]});return this.drillData[s]=d,d};return e.length<=0?t.td(0):t.tdLink(e.length,()=>this.drilldownAsyncRows(s,n,o))},aggregate(e,s){return Object.values(this.cohort).reduce((n,o)=>o[e]?[...o[e][this.indexLabel.indexOf(s)],...n]:n,[])},setTotalMaleRow(){const e=s=>this.drilldown(this.aggregate("M",s),s);this.rows.push([t.td("All"),t.td("Male"),e("Died"),e("IIT <3 mo"),e("IIT 3-5 mo"),e("IIT 6+ mo"),e("Tranferred out"),e("Refused (Stopped)")])},async setMaternalRows(){const e=this.indexLabel.reduce((r,a)=>[...r,{indicator:a,data:this.aggregate("F",a)}],[]),s=await this.report.getMaternalStatus(R.uniq(e.reduce((r,a)=>[...r,...a.data],[]).map(r=>r))),n=r=>e.reduce((a,i)=>i.indicator===r?[...a,...i.data]:a,[]),o=(r,a)=>this.drilldown(n(a).filter(i=>s[r].includes(i)),"All ".concat(a," Female Pregnant")),l=s.FBf.concat(s.FP),d=r=>this.drilldown(n(r).filter(a=>!l.includes(a)),"All ".concat(r," Female not pregnant"));this.rows.push([t.td("All"),t.td("FP"),o("FP","Died"),o("FP","IIT <3 mo"),o("FP","IIT 3-5 mo"),o("FP","IIT 6+ mo"),o("FP","Tranferred out"),o("FP","Refused (Stopped)")]),this.rows.push([t.td("All"),t.td("FNP"),d("Died"),d("IIT <3 mo"),d("IIT 3-5 mo"),d("IIT 6+ mo"),d("Tranferred out"),d("Refused (Stopped)")]),this.rows.push([t.td("All"),t.td("FBF"),o("FBf","Died"),o("FBf","IIT <3 mo"),o("FBf","IIT 3-5 mo"),o("FBf","IIT 6+ mo"),o("FBf","Tranferred out"),o("FBf","Refused (Stopped)")])},setRows(e){for(const s in p){const n=p[s],o=this.formatGender(e);try{const l=this.cohort[n][e],d="".concat(o,"s ").concat(n),r=l.map((a,i)=>this.drilldown(a,"".concat(d," ").concat(this.indexLabel[i])));this.rows.push([t.td(n),t.td(o),...r])}catch(l){this.rows.push([t.td(n),t.td(o),t.td(0),t.td(0),t.td(0),t.td(0),t.td(0),t.td(0)])}}}}});function _(e,s,n,o,l,d){const r=h("report-template"),a=h("ion-page");return g(),F(a,null,{default:x(()=>[P(r,{title:e.title,period:e.period,rows:e.rows,fields:e.fields,columns:e.columns,config:{showIndex:!0},reportPrefix:"PEPFAR",hasServerSideCaching:!0,onReportConfiguration:e.onPeriod},null,8,["title","period","rows","fields","columns","onReportConfiguration"])]),_:1})}const E=D($,[["render",_]]);export{E as default};
