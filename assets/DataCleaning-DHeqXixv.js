import{D as l,C as i}from"./data_cleaning_report_service-CoqECnmS.js";import{_ as D}from"./ReportMixin.vue_vue_type_script_lang-CdMugi9u.js";import{R as _}from"./TableReportTemplate-DGwSQvwe.js";import{d as f,I as w,V as g,L as t,ab as T,cy as h,cb as R,S as u,_ as b,r as c,o as x,c as I,w as v,b as S}from"./index-L7KBnPzM.js";import{F as C}from"./dynamic-import-helper-Bsjrd6Ro.js";import{g as m}from"./MultiFieldDateHelper-C5td-0Rz.js";import"./BasicReportTemplate-BJvPkGk8.js";import"./Export-DMwHfvYp.js";import"./SIngleTouchField-BYpOdmHo.js";import"./Pagination-DQYhjMaN.js";import"./HisStandardForm-4iY8ramV.js";import"./TouchScreenForm-DLhU6o0i.js";import"./ToolbarMediumCard-BO4GFuiT.js";import"./Transformers-BPPLlH12.js";import"./ViewPort--UGxBUFx.js";import"./ReportErrors-BOVOs6ef.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";const E=f({mixins:[D],components:{ReportTemplate:_,IonPage:w},data:()=>({title:"Data cleaning report",rows:[],columns:[]}),created(){this.fields=[{id:"indicator",helpText:"Select indicator",type:C.TT_SELECT,requireNext:!1,validation:a=>g.required(a),options:()=>this.getIndicatorOptions()},...m({id:"start_date",helpText:"Start",required:!0,condition:a=>!a.indicator.other.skipDateSelection,minDate:()=>"2001-01-01",maxDate:()=>u.getSessionDate(),estimation:{allowUnknown:!1},computeValue:a=>a}),...m({id:"end_date",helpText:"End",required:!0,condition:a=>!a.indicator.other.skipDateSelection,minDate:(a,e)=>e.start_date,maxDate:()=>u.getSessionDate(),estimation:{allowUnknown:!1},computeValue:a=>a})]},methods:{async onPeriod(a,e){this.rows=[],this.title=a.indicator.label;const s=a.indicator;this.columns=s.other.columns,await s.other.setRows(a,e)},masterCardBtn(a){return t.tdBtn("View",()=>this.$router.push("/art/mastercard/".concat(a)))},getDefaultIndicatorColumns(a=[]){return[[t.thTxt("ARV Number"),t.thTxt("Patient Id"),t.thTxt("First Name"),t.thTxt("Last Name"),t.thTxt("Gender"),t.thTxt("Date of birth"),...a,t.thTxt("Action")]]},async setDefaultIndicatorRows(a,e,s,o=null){this.report=new l,this.report.setStartDate(e),this.report.setEndDate(s),this.period=this.report.getDateIntervalPeriod();const r=this.sortByArvNumber(await this.report.getCleaningToolReport(a)||[],"arv_number");T.isEmpty(r)||r.forEach(n=>{const d=typeof o=="function"?o(n):[];this.rows.push([t.td(n.arv_number),t.td(n.patient_id),t.td(n.given_name),t.td(n.family_name),t.td(this.formatGender(n.gender)),t.tdDate(n.birthdate),...d,this.masterCardBtn(n.patient_id)])})},getIndicatorOptions(){return[{label:"DOB > Date enrolled",value:i.DobMoreThanEnrolledDate,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns(),setRows:(a,e)=>this.setDefaultIndicatorRows(i.DobMoreThanEnrolledDate,e.start_date,e.end_date)}},{label:"Date enrolled < Earliest start date",value:i.DateEnrolledLessThanEarliestStartDate,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns([t.thTxt("Earliest start date"),t.thTxt("Date enrolled")]),setRows:(a,e)=>this.setDefaultIndicatorRows(i.DateEnrolledLessThanEarliestStartDate,e.start_date,e.end_date,s=>[t.tdDate(s.earliest_start_date),t.tdDate(s.date_enrolled)])}},{label:"Encounters after Death",value:i.ClientsWithEncountersAfterDeath,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns(),setRows:(a,e)=>this.setDefaultIndicatorRows(i.ClientsWithEncountersAfterDeath,e.start_date,e.end_date)}},{label:"Incomplete visits",value:"Incomplete visits",other:{skipDateSelection:!1,columns:[[t.thTxt("ARV#"),t.thTxt("NHID"),t.thTxt("First name"),t.thTxt("Last name"),t.thTxt("Gender"),t.thTxt("Birthdate"),t.thTxt("Date(s)"),t.thTxt("Action")]],setRows:async(a,e)=>{this.report=new l,this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period=this.report.getDateIntervalPeriod();const s=await this.report.getIncompleteVisits();for(const o in s){const r=s[o];this.rows.push([t.td(r.arv_number),t.td(r.national_id),t.td(r.given_name),t.td(r.family_name),t.td(this.formatGender(r.gender)),t.tdDate(r.birthdate),t.td(r.dates.map(n=>this.toDate(n)).join("<br/>")),this.masterCardBtn(parseInt(o.toString()))])}}}},{label:"Enrolled on ART before birth",value:"Enrolled on ART before birth",other:{skipDateSelection:!0,columns:[[t.thTxt("ARV number"),t.thTxt("Name"),t.thTxt("Earliest start date"),t.thTxt("Date enrolled"),t.thTxt("Gender"),t.thTxt("Birth Date"),t.thTxt("Action")]],setRows:async()=>{try{this.report=new l,(await this.report.getEnrolledOnArtBeforeBirth()).forEach(e=>{this.rows.push([t.td(e.identifier),t.td(e.name),t.tdDate(e.earliest_start_date),t.tdDate(e.date_enrolled),t.td(this.formatGender(e.gender)),t.tdDate(e.birthdate),this.masterCardBtn(e.patient_id)])})}catch(a){if(!(a instanceof h))throw a}}}},{label:"Missing VL Results",value:"Missing VL Results",other:{columns:[[t.thTxt("ARV number"),t.thTxt("First name"),t.thTxt("Last name"),t.thTxt("Gender"),t.thTxt("Accession number"),t.thTxt("Order date"),t.thTxt("Action")]],setRows:async(a,e)=>{try{this.report=new l,this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period=this.report.getDateIntervalPeriod(),(await this.report.getCleaningToolReport(i.MissingVlResults)).forEach(o=>{this.rows.push([t.td(o.arv_number),t.td(o.given_name),t.td(o.family_name),t.td(this.formatGender(o.gender)),t.td(o.accession_number),t.tdDate(o.order_date),this.masterCardBtn(o.patient_id)])})}catch(s){if(!(s instanceof h))throw s}}}},{label:"Male patients with female observations",value:i.MalesWithFemaleObs,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns([t.thTxt("Visit date")]),setRows:(a,e)=>this.setDefaultIndicatorRows(i.MalesWithFemaleObs,e.start_date,e.end_date,s=>[t.tdDate(s.visit_date)])}},{label:"Missing important demographics elements",value:i.MissingDemographics,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns(),setRows:(a,e)=>this.setDefaultIndicatorRows(i.MissingDemographics,e.start_date,e.end_date)}},{label:"Missing start reason",value:i.MissingStartReasons,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns(),setRows:(a,e)=>this.setDefaultIndicatorRows(i.MissingStartReasons,e.start_date,e.end_date)}},{label:"Missing ART start date",value:i.MissingArtStartDate,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns(),setRows:(a,e)=>this.setDefaultIndicatorRows(i.MissingArtStartDate,e.start_date,e.end_date)}},{label:"Multiple start reasons",value:i.MultipleStartReasons,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns([t.thTxt("Reasons"),t.thTxt("Visits")]),setRows:(a,e)=>this.setDefaultIndicatorRows(i.MultipleStartReasons,e.start_date,e.end_date,s=>[t.td("".concat(s.reasons).split(",").join("<p/>")),t.td(s.visits.split(",").map(o=>R(o)).join("<p/>"))])}},{label:"Patients with Pre-ART / Unknown outcome",value:i.PreArtOrUnknownOutcomes,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns(),setRows:(a,e)=>this.setDefaultIndicatorRows(i.PreArtOrUnknownOutcomes,e.start_date,e.end_date)}},{label:"Prescriptions without dispensations",value:i.PrescriptionWithoutDispensation,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns([t.thTxt("Visit Date")]),setRows:(a,e)=>this.setDefaultIndicatorRows(i.PrescriptionWithoutDispensation,e.start_date,e.end_date,s=>[t.tdDate(s.visit_date)])}},{label:"Different pregnancy value on same date",value:i.DifferentPregnancyValueOnSameDate,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns([t.thTxt("Visit Date")]),setRows:(a,e)=>this.setDefaultIndicatorRows(i.DifferentPregnancyValueOnSameDate,e.start_date,e.end_date,s=>[t.tdDate(s.visit_date)])}}]}}});function k(a,e,s,o,r,n){const d=c("report-template"),p=c("ion-page");return x(),I(p,null,{default:v(()=>[S(d,{title:a.title,period:a.period,rows:a.rows,fields:a.fields,columns:a.columns,showFilters:!0,onReportConfiguration:a.onPeriod},null,8,["title","period","rows","fields","columns","onReportConfiguration"])]),_:1})}const J=b(E,[["render",k]]);export{J as default};
