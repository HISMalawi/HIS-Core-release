import{d as O,X as N,aq as A,cu as E,I as H,_ as U,Y as q,a9 as M,b4 as z,a6 as j,H as J,ao as u,cg as K,bs as h,am as W,cv as F,aW as X,aa as Y,af as a,a as l,E as d,aH as G,cw as Q,b as s,c as P,w as r,K as n,C as p,a2 as i,cx as Z,J as y,M as g}from"./index-CMZASHAR.js";import{a as _,t as x}from"./Export-CpyT9Gk1.js";import{H as ee}from"./HisStandardForm-BCjM4-bc.js";import{R as oe}from"./BasicReportTemplate-CbJ_oMga.js";import{P as te}from"./Pagination-D_B_LriE.js";const se=O({components:{HisStandardForm:ee,IonHeader:N,ReportTable:A,HisFooter:E,IonPage:H,IonContent:U,IonToolbar:q,Pagination:te,ReportFilter:oe,IonFooter:M,IonChip:z,IonLabel:j},props:{title:{type:String,required:!0},customFilter:{type:Function},period:{type:String,default:""},encryptPDF:{type:Boolean,default:!1},config:{type:Object},fields:{type:Array,default:()=>[]},columns:{type:Array,required:!0},rows:{type:Array,required:!0},paginated:{type:Boolean,default:!1},customBtns:{type:Array,default:()=>[]},canExportPDf:{type:Boolean,default:!0},canExportCsv:{type:Boolean,default:!0},onReportConfiguration:{type:Function,required:!1},rowParser:{type:Function},showFilters:{type:Boolean,default:!1},showVLFilter:{type:Boolean,default:!1},rowsPerPage:{type:Number},asyncRows:{type:Function},footerColor:{type:String,default:"dark"},customFileName:{type:String,default:""},canExport:{type:Boolean,default:!0},showReportStamp:{type:Boolean,default:!0},customInfo:{type:Object},reportPrefix:{type:String,default:""}},data:()=>({formData:{},computeFormData:{},btns:[],isLoadingData:!1,showForm:!1,logo:"/assets/images/login-logos/Malawi-Coat_of_arms_of_arms.png",isTableLoading:!1,searchFilter:"",itemsPerPage:50,itemsVLtype:"",currentPage:0,tableRows:[],totalPages:0,activeColumns:[],activeRows:[],date:J.toStandardHisDisplayFormat(u.getSessionDate()),apiVersion:u.getApiVersion(),coreVersion:u.getCoreVersion(),siteUUID:u.getSiteUUID(),tableCssTheme:"opd-report-theme"}),methods:{getFileName(){var e,o;return"".concat((e=this.reportPrefix)!=null?e:""," ").concat(u.getLocationName()," ").concat(K(this.title).replace(this.reportPrefix,"")," ").concat((o=this.period)!=null?o:this.date)},pdfEncryptionData(){const e=u.getUserName();return{encryption:{userPassword:e,ownerPassword:e,userPermissions:["print"]}}},async onFinish(e,o){this.formData=e,this.computeFormData=o,this.showForm=!1,await this.presentLoading();try{this.onReportConfiguration&&await this.onReportConfiguration(this.formData,this.computeFormData),h.dismiss()}catch(m){console.error(m),W("".concat(m)),h.dismiss()}},async reloadReport(){await this.onFinish(this.formData,this.computeFormData)},async presentLoading(){await(await h.create({message:"Please wait...",backdropDismiss:!1})).present()}},created(){this.showForm=!!this.fields.length,this.btns=this.customBtns,this.btns.push({name:"CSV",size:"large",slot:"start",color:"primary",visible:this.canExportCsv,onClick:async()=>{const{columns:e,rows:o}=F(this.columns,this.rows,"csvMode");_(e,[...o,["Date Created: ".concat(this.date)],["Period: ".concat(this.period)],["HIS-Core Version: ".concat(this.coreVersion)],["API Version: ".concat(this.apiVersion)],["Site UUID: ".concat(this.siteUUID)]],this.getFileName())}},{name:"PDF",size:"large",slot:"start",color:"primary",visible:this.canExportPDf,onClick:async()=>{let e="pdfMode";this.encryptPDF&&(e=await X("Security warning","PDF may contain private data that will require a password to unlock","To access private data choose Secure PDF over Regular PDF",[{name:"Secure PDF",slot:"start",color:"success"},{name:"Regular PDF",slot:"start",color:"success"}],"his-danger-color")==="Secure PDF"?"pdfMode":"ignorePDFColumnexport");const{columns:o,rows:m}=F(this.activeColumns,this.activeRows,e);x(o,m,this.getFileName(),!1,this.encryptPDF&&e!="ignorePDFColumnexport"?this.pdfEncryptionData():{})}},{name:"Back",size:"large",slot:"end",color:"primary",visible:!0,onClick:()=>this.showForm=!0},{name:"Refresh",size:"large",slot:"end",color:"warning",visible:!0,onClick:()=>this.reloadReport()},{name:"Finish",size:"large",slot:"end",color:"success",visible:!0,onClick:()=>this.$router.push({path:"/"})})}}),ae={class:"header-text-list"},re={key:0},ne={class:"report-content"};function ie(e,o,m,b,le,pe){const C=a("his-standard-form"),D=a("ion-img"),v=a("ion-thumbnail"),R=a("ion-label"),I=a("report-filter"),f=a("ion-toolbar"),S=a("ion-header"),k=a("report-table"),V=a("ion-content"),B=a("pagination"),c=a("ion-chip"),T=a("ion-footer"),$=a("his-footer"),L=a("ion-page");return l(),d(y,null,[G(s(C,{onOnFinish:e.onFinish,skipSummary:!0,fields:e.fields},null,8,["onOnFinish","fields"]),[[Q,e.showForm]]),e.showForm?g("",!0):(l(),P(L,{key:0},{default:r(()=>[s(S,null,{default:r(()=>[s(f,null,{default:r(()=>[s(v,{slot:"start"},{default:r(()=>[s(D,{src:e.logo},null,8,["src"])]),_:1}),s(R,null,{default:r(()=>{var t,w;return[n("ul",ae,[n("li",null,[o[10]||(o[10]=p("Title ")),n("b",null,i(e.title),1)]),n("li",null,[o[11]||(o[11]=p("Period ")),n("b",null,i(e.period),1)]),e.customInfo?(l(),d("li",re,[p(i(e.customInfo.label)+" ",1),n("b",null,[typeof((w=(t=e.customInfo)==null?void 0:t.other)==null?void 0:w.click)=="function"?(l(),d("a",{key:0,href:"#",onClick:o[0]||(o[0]=Z(ue=>e.customInfo.other.click(),["prevent"]))},i(e.customInfo.value),1)):(l(),d(y,{key:1},[p(i(e.customInfo.value),1)],64))])])):g("",!0),o[12]||(o[12]=n("template",null,null,-1))])]}),_:1}),s(I,{slot:"end",showPerPageFilter:e.showFilters||e.paginated,disableSearchFilter:e.isTableLoading,disablePerPageFilter:e.isTableLoading,totalRowCount:e.tableRows.length,customFilter:e.customFilter,onOnItemsPerPage:o[1]||(o[1]=t=>e.itemsPerPage=t),onOnItemsVLtype:o[2]||(o[2]=t=>e.itemsVLtype=t),onOnSearchFilter:o[3]||(o[3]=t=>e.searchFilter=t)},null,8,["showPerPageFilter","disableSearchFilter","disablePerPageFilter","totalRowCount","customFilter"])]),_:1})]),_:1}),s(V,null,{default:r(()=>[n("div",ne,[s(k,{rows:e.rows,paginated:e.paginated,asyncRows:e.asyncRows,rowParser:e.rowParser,config:{...e.config,tableCssTheme:e.tableCssTheme},columns:e.columns,showFilters:e.showFilters,newPage:e.currentPage,searchFilter:e.searchFilter,rowsPerPage:e.itemsPerPage,onOnIsLoading:o[4]||(o[4]=t=>e.isTableLoading=t),onOnTableRows:o[5]||(o[5]=t=>e.tableRows=t),onOnPagination:o[6]||(o[6]=t=>e.totalPages=t.length),onOnActiveColumns:o[7]||(o[7]=t=>e.activeColumns=t),onOnActiveRows:o[8]||(o[8]=t=>e.activeRows=t)},null,8,["rows","paginated","asyncRows","rowParser","config","columns","showFilters","newPage","searchFilter","rowsPerPage"])])]),_:1}),s(T,null,{default:r(()=>[!e.searchFilter&&e.paginated||!e.searchFilter&&e.totalPages>0&&e.paginated?(l(),P(f,{key:0},{default:r(()=>[s(B,{perPage:e.itemsPerPage,maxVisibleButtons:10,totalPages:e.totalPages,onOnChangePage:o[9]||(o[9]=t=>e.currentPage=t)},null,8,["perPage","totalPages"])]),_:1})):g("",!0),e.showReportStamp?(l(),P(f,{key:1},{default:r(()=>[s(c,{color:"primary"},{default:r(()=>[o[13]||(o[13]=p("Date Created: ")),n("b",null,i(e.date),1)]),_:1}),s(c,{color:"primary"},{default:r(()=>[o[14]||(o[14]=p("His-Core Version: ")),n("b",null,i(e.coreVersion),1)]),_:1}),s(c,{color:"primary"},{default:r(()=>[o[15]||(o[15]=p("API Version: ")),n("b",null,i(e.apiVersion),1)]),_:1})]),_:1})):g("",!0)]),_:1}),s($,{color:e.footerColor,btns:e.btns},null,8,["color","btns"])]),_:1}))],64)}const he=Y(se,[["render",ie],["__scopeId","data-v-2b6cbb18"]]);export{he as R};
