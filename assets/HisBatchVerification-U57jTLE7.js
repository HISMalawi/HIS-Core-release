import{d as E,bW as M,aW as R,$ as F,_ as S,a_ as L,a0 as U,W as O,a1 as W,a2 as G,eS as H,c4 as P,df as K,dD as C,a9 as k,aa as f,a6 as Q,ab as s,u as c,v as b,w as i,x as a,B as V,E as N,C as $,z as p,Z as v,G as Z}from"./index-CyYd6aWW.js";import{_ as j}from"./FieldMixin.vue_vue_type_script_lang-DVMlEpjU.js";import J from"./BaseTextInput-R_3uIRWn.js";const X=E({components:{ViewPort:M,HisTextInput:J,IonGrid:R,IonCol:F,IonRow:S,IonIcon:L,IonList:U,IonItem:O,IonLabel:W,IonInput:G},mixins:[j],data:()=>({drugs:[],selectedDrug:null,chevronDown:H,previousTinCount:0,newTinCount:0}),mounted(){this.init()},activated(){this.init()},methods:{clearValue(){this.drugs=this.drugs.map(e=>(e.entries&&(e.entries=e.entries.map(t=>(t.current_quantity=t.originalQuantity,t))),e))},async init(){this.$emit("onFieldActivated",this),P(this.drugs)&&(this.drugs=await this.options())},disableReasonsOptions(e,t){const n=["Theft","Took out for training","Accidents","Flooding","Natural disaster"];return t.map(r=>({...r,disabled:e?r.disabled||n.includes(r.label):!n.includes(r.label)}))},fmtNumber(e){return K(e)},getModalTitle(e){return"".concat(e," (").concat(this.drugs[this.selectedDrug].label,")")},getDrugValue(e,t){return this.drugs[this.selectedDrug].other[e][t]},setDrugValue(e,t,n){this.drugs[this.selectedDrug].other[e][t]=n?n.value:""},async enterAmount(e){const t=this.getDrugValue(e,"batch_number");C({id:"tins",helpText:this.getModalTitle("Enter number of tins for Batch ".concat(t)),type:k.TT_NUMBER,defaultValue:()=>(this.previousTinCount=this.getDrugValue(e,"current_quantity"),this.previousTinCount),validation:n=>!n||n&&!n.value?null:f.validateSeries([()=>f.isNumber(n),()=>n.value<0?["Number of tins must be greater than 1"]:null])},n=>(this.newTinCount=n.value,this.setDrugValue(e,"current_quantity",n)))},async selectReason(e){const t=this.getDrugValue(e,"batch_number");C({id:"reason",helpText:this.getModalTitle("Select reason for Batch ".concat(t," modification")),type:k.TT_SELECT,defaultValue:()=>this.getDrugValue(e,"reason"),validation:n=>f.required(n),options:()=>{const n=[{label:"Theft",value:"Theft"},{label:"Took out for training",value:"Took out for training"},{label:"Accidents",value:"Accidents"},{label:"Flooding",value:"Flooding"},{label:"Natural disaster",value:"Natural disaster"},{label:"Misplaced stock",value:"Misplaced stock"},{label:"Incorrect entry",value:"Incorrect entry"}];return this.disableReasonsOptions(this.newTinCount>this.previousTinCount,n)}},n=>{this.setDrugValue(e,"reason",n)})},async selectDrug(e){this.selectedDrug=e},isBatchUpdated(e){return e.current_quantity!==e.original_quantity&&!!e.reason},isModificationComplete(){return this.drugs.every(e=>{var t;return(t=e.other)==null?void 0:t.every(n=>n.current_quantity===n.original_quantity?!0:!!n.reason)})},getUpdatedDrugs(){const e=[];return this.drugs.forEach(t=>{var r;const n=(r=t.other)==null?void 0:r.filter(y=>this.isBatchUpdated(y));e.push(...n)}),e}},watch:{clear(){this.drugs=this.drugs.map(e=>(e.other&&(e.other=e.other.map(t=>(t.current_quantity=t.original_quantity,t))),e))},drugs:{async handler(){if(this.isModificationComplete())return this.$emit("onValue",this.getUpdatedDrugs());this.$emit("onValue",null)},immediate:!0,deep:!0}}});function Y(e,t,n,r,y,x){const q=s("his-text-input"),d=s("ion-item"),w=s("ion-list"),l=s("ion-col"),_=s("ion-label"),m=s("ion-input"),I=s("ion-icon"),T=s("ion-row"),B=s("ion-grid"),z=s("view-port");return c(),b(z,null,{default:i(()=>{var D;return[a(q,{readonly:"",value:((D=e.drugs[e.selectedDrug])==null?void 0:D.label)||""},null,8,["value"]),a(B,{style:{background:"white"}},{default:i(()=>[a(T,null,{default:i(()=>[a(l,{size:"4",class:"border-right scroll-list"},{default:i(()=>[(c(!0),V(N,null,$(e.drugs,(h,o)=>(c(),b(w,{key:o},{default:i(()=>[a(d,{detail:"",color:o===e.selectedDrug?"lightblue":"",onClick:u=>e.selectDrug(o)},{default:i(()=>[p(v(h.label),1)]),_:2},1032,["color","onClick"])]),_:2},1024))),128))]),_:1}),a(l,{size:"8",class:"scroll-list"},{default:i(()=>{var h;return[(c(!0),V(N,null,$(((h=e.drugs[e.selectedDrug])==null?void 0:h.other)||[],(o,u)=>(c(),b(T,{key:u},{default:i(()=>[a(l,{size:"12"},{default:i(()=>[Z("h4",null,"Batch Number: "+v(o.batch_number)+" ("+v(o.pack_size)+"/tin) ",1)]),_:2},1024),a(l,{"size-md":"4"},{default:i(()=>[a(d,null,{default:i(()=>[a(_,{position:"floating"},{default:i(()=>t[0]||(t[0]=[p("Available Tins")])),_:1}),a(m,{readonly:"",placeholder:"0",value:e.fmtNumber(o.original_quantity)},null,8,["value"])]),_:2},1024)]),_:2},1024),a(l,{"size-md":"4"},{default:i(()=>[a(d,null,{default:i(()=>[a(_,{position:"floating"},{default:i(()=>t[1]||(t[1]=[p("Verified Tins")])),_:1}),a(m,{readonly:"",placeholder:"0",value:e.fmtNumber(o.current_quantity),color:o.current_quantity!=o.original_quantity?"danger":"success",onClick:g=>e.enterAmount(u)},null,8,["value","color","onClick"])]),_:2},1024)]),_:2},1024),a(l,{"size-md":"4"},{default:i(()=>[a(d,null,{default:i(()=>{var g;return[a(_,{position:"floating"},{default:i(()=>t[2]||(t[2]=[p("Reason")])),_:1}),a(m,{disabled:o.current_quantity==o.original_quantity,placeholder:"0",value:(g=o.reason)!=null?g:"N/A",onClick:A=>e.selectReason(u)},null,8,["disabled","value","onClick"]),a(I,{icon:e.chevronDown,slot:"end",class:"ion-padding-top",onClick:A=>e.selectReason(u)},null,8,["icon","onClick"])]}),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]}),_:1})]),_:1})]),_:1})]}),_:1})}const ae=Q(X,[["render",Y],["__scopeId","data-v-e5193b0a"]]);export{ae as default};
