System.register(["./index-legacy-Clyg4LY-.js","./TableView-legacy-5EUY3MUg.js","./tb_report_service-legacy-Cah-wKcC.js","./v2utils-legacy-BAw2ntll.js","./TBDrilldown-legacy-CdHdWJsJ.js","./Export-legacy-DC9e93Qn.js"],(function(e,a){"use strict";var t,l,i,r,s,o,n,c,u,p,g,_,m,v,d,f,b,y,h,T,w;return{setters:[e=>{t=e.d,l=e.r,i=e.t,r=e.u,s=e.v,o=e.w,n=e.x,c=e.y,u=e.dO,p=e.ab,g=e.ac,_=e.a5,m=e.aK,v=e.M,d=e.c_,f=e.as},e=>{b=e.v},e=>{y=e.T},e=>{h=e.w,T=e.d},e=>{w=e.T},null],execute:function(){e("default",t({__name:"TBCaseFindingReport",setup(e){const a=new y,t=l([]),P=l(""),B=l(""),C=l(""),x=l([]),E=l([]),F=l([]),$=["0-4","5-14","15-24","25-34","35-44","45-54","55-64","65+"],D=[{label:"New Smear positive",ref:"new_smear_positive",tags:["cases"]},{label:"New MTB Detected Xpert",ref:"new_mtb_detected_xpert",tags:["cases"]},{label:"New Pulmonary Clinically Diagnosed",ref:"new_pulmonary_clinically_diagnosed",tags:["cases"]},{label:"New EPTB",ref:"new_eptb",tags:["cases"]},{label:"Relapse Bacteriologically Confirmed",ref:"relapse_bacteriologically_confirmed",tags:["cases"]},{label:"Treatment Failure Bacteriologically Confirmed",ref:"treatment_failure_bacteriologically_confirmed",tags:["cases"]},{label:"Treatment LTF Bacteriologically Confirmed",ref:"treatment_ltf_bacteriologically_confirmed",tags:["cases"]},{label:"Treatment LTF Clinically Diagnosed Pulmonary",ref:"treatment_ltf_clinically_diagnosed_pulmonary",tags:["cases"]},{label:"Treatment LTF EPTB",ref:"treatment_ltf_eptb",tags:["cases"]},{label:"Relapse Clinical Pulmonary",ref:"relapse_clinical_pulmonary",tags:["cases"]},{label:"Relapse EPTB",ref:"relapse_eptb",tags:["cases"]},{label:"Other Previously Treated Bacteriologically Confirmed",ref:"other_previously_treated_bacteriologically_confirmed",tags:["cases"]},{label:"Other Previously Treated Clinical Pulmonary",ref:"other_previously_treated_clinical_pulmonary",tags:["cases"]},{label:"Other Previously Treated EPTB",ref:"other_previously_treated_eptb",tags:["cases"]},{label:"Unknown Previous Treatment History Bacteriological",ref:"unknown_previous_treatment_history_bacteriological",tags:["cases"]},{label:"Unknown Previous Treatment History EPTB",ref:"unknown_previous_treatment_history_eptb",tags:["cases"]},{label:"Patients with Presumptive TB Undergoing Bacteriological Examination Via Xpert",ref:"patients_with_presumptive_tb_undergoing_bacteriological_examination_via_xpert",tags:["presumptives"]},{label:"Patients with Presumptive TB Undergoing Bacteriological Examination Via Microscopy",ref:"patients_with_presumptive_tb_undergoing_bacteriological_examination_via_microscopy",tags:["presumptives"]},{label:"Patients with Presumptive TB with Positive Bacteriological Examination Via Xpert",ref:"patients_with_presumptive_tb_with_positive_bacteriological_examination_via_xpert",tags:["presumptives"]},{label:"Patients with Presumptive TB with Positive Bacteriological Examination Via Microscopy",ref:"patients_with_presumptive_tb_with_positive_bacteriological_examination_via_microscopy",tags:["presumptives"]}];function L(){const e=[{label:"#",ref:"index",span:{thRowspan:2}},{label:"Age Category",ref:"age_group",span:{thRowspan:2}},...x.value.map((e=>({...e,ref:"",span:{thColspan:2}})))],a=x.value.reduce(((e,a)=>{const t=e=>({label:e,ref:`${a.ref}_${e.toLowerCase()}`,secondaryLabel:`${a.label} (${"M"===e?"Male":"Female"})`,toValue:e=>`${e.length}`,tdClick:e=>e.refData.length&&async function(e,a){(await f.create({component:w,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e,patientIdentifiers:a,onFinish:()=>f.getTop().then((e=>e&&f.dismiss()))}})).present()}(a.label,e.refData)});return[...e,t("F"),t("M")]}),[]);F.value=[e,a]}const M=()=>h((async()=>{if(!B.value||!C.value)return v("Year and quarter are required!");const e=(await a.getTBCaseFindingReport(B.value,parseInt(`${C.value}`),x.value.map((e=>e.ref)))).reduce(((e,a)=>{const{indicator:t,...l}=a;return{...e,[t]:l}}),{}),l=$.reduce(((a,t)=>{const l={age_group:t};return Object.keys(e).forEach((i=>{const r=`${i}_m`,s=`${i}_f`,o=e[i][t].male,n=e[i][t].female;l[r]=o,l[s]=n,a.aggregates={...a.aggregates,[r]:[...a.aggregates?.[r]??[],...o],[s]:[...a.aggregates?.[s]??[],...n]}})),a.rows.push(l),a}),{aggregates:{},rows:[]});return t.value=T([...l.rows,{age_group:"Totals",...l.aggregates}]),E.value=[{text:"All",icon:d,color:"primary",action:()=>{x.value=D,L(),M()}},{text:"Show Presumptives",icon:d,color:"primary",action:()=>{x.value=D.filter((e=>e.tags.includes("presumptives"))),L(),M()}},{text:"Cases",icon:d,color:"primary",action:()=>{x.value=D.filter((e=>e.tags.includes("cases"))),L(),M()}}],!0})),R=()=>u([{id:"indicator",helpText:"Indicators",type:p.TT_SELECT,validation:e=>g.required(e),options:()=>[{label:"All",value:"all",other:()=>D},{label:"Cases",value:"cases",other:()=>D.filter((e=>e.tags.includes("cases")))},{label:"Presumptives",value:"presumptives",other:()=>D.filter((e=>e.tags.includes("presumptives")))},{label:"Custom Indicators",value:"custom"}]},{id:"custom",helpText:"Custom indicators",type:p.TT_MULTIPLE_SELECT,validation:e=>g.required(e),condition:e=>"custom"===e.indicator.value,options:()=>D.map((e=>({label:e.label,value:e.ref,other:e})))}],(e=>{t.value=[],x.value=[],B.value=e.year.value,C.value=e.quarter.value,P.value=`Q${C.value} ${B.value}`,"function"==typeof e.indicator.other?x.value=e.indicator.other():m.isEmpty(e.custom)||(x.value=e.custom.map((e=>e.other))),x.value.length&&(L(),M())}));return i((()=>R())),(e,a)=>(r(),s(c(_),null,{default:o((()=>[n(b,{title:"TB Case Finding Report",subtitle:P.value,columns:F.value,columnData:t.value,headerBadge:E.value,rowsPerPage:100,onConfigure:R},null,8,["subtitle","columns","columnData","headerBadge"])])),_:1}))}}))}}}));
