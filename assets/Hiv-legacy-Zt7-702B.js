System.register(["./index-legacy-CA6M7ipO.js","./HisStandardForm-legacy-a9YJRGaH.js","./useEncounter-legacy-CgHUO1ZL.js","./commons-legacy-BqS3TQTP.js","./isEmpty-legacy-cRrH0Hs5.js","./encounter_guidelines-legacy-Bcz_Mw7r.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,i,l,u,n,o,d,s,r,T,c,_,v,S,E,p,m,A;return{setters:[e=>{a=e.d,i=e.r,l=e.bQ,u=e.bV,n=e.ad,o=e.bU,d=e.aN,s=e.ae,r=e.d$,T=e.a,c=e.c,_=e.w,v=e.b,S=e.u,E=e.I},e=>{p=e.H},e=>{m=e.u},e=>{A=e.r},null,null,null],execute:function(){e("default",a({__name:"Hiv",setup(e){const t=i([]),a=new l(-1,u.UPDATE_HIV_STATUS),b=i(),{goToNextTask:N,patientDashboardUrl:R}=m(((e,i,u)=>{a.patientID=i,a.providerID=e,t.value=[(()=>{const e=[];return{id:"artSummary",helpText:"ART Summary",type:n.TT_SUMMARY,init:async()=>(b.value=await o.generateArtStatusFromArt(i,l.getSessionDate()),b.value&&Object.keys(b.value).forEach((t=>e.push(b.value[t]))),!0),condition:()=>!d.isEmpty(b.value),options:()=>e}})(),{id:"hivStatus",helpText:"HIV Status",type:n.TT_SELECT,requireNext:!1,validation:e=>s.required(e),condition:()=>d.isEmpty(b.value),computedValue:e=>"NOT_DONE"===e.value?{concept_id:r("HIV_TEST_DONE_TODAY"),value_coded:r("NO_ANSWER"),obs_datetime:a.date}:{concept_id:r("HIV_STATUS"),value_coded:r(`${e.value}`),obs_datetime:a.date},options:()=>[{value:"POSITIVE",label:"Positive"},{value:"NEGATIVE",label:"Negative"},{value:"NOT_DONE",label:"Not Tested"}]},{id:"timeOfHIVTest",helpText:"Time of HIV test",type:n.TT_SELECT,requireNext:!1,validation:e=>s.required(e),computedValue:e=>({concept_id:r("TIME_OF_HIV_TEST"),value_coded:r(`${e.value}`),obs_datetime:a.date}),condition:e=>"POSITIVE"===e.hivStatus.value||"NEGATIVE"===e.hivStatus.value,options:()=>[{value:"HIV_BEFORE_TB",label:"Before TB Registration"},{value:"HIV_AFTER_TB",label:"After TB Registration"}]},{id:"artStatus",helpText:"ART Started",type:n.TT_SELECT,requireNext:!1,validation:e=>s.required(e),condition:e=>"POSITIVE"===e.hivStatus.value,computedValue:e=>({concept_id:r("ON_ART"),value_coded:r(`${e.value}`),obs_datetime:a.date}),options:()=>[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]},{id:"arvStatus",helpText:"ARV Status",type:n.TT_SELECT,requireNext:!1,validation:e=>s.required(e),condition:e=>"YES_ANSWER"===e.artStatus.value,computedValue:e=>({concept_id:r("ARV_STATUS"),value_coded:r(`${e.value}`),obs_datetime:a.date}),options:()=>[{value:"ARV_BEFORE_TB",label:"Started ARV before TB Treatment"},{value:"ARV_WHILE_TB",label:"Started ARV while on TB Treatment"},{value:"ARV_AFTER_DISCHARGE",label:"ARV not started by the time when discharged from TB treatment"}]},{id:"cptStatus",helpText:"Started CPT",type:n.TT_SELECT,requireNext:!1,validation:e=>s.required(e),condition:e=>"YES_ANSWER"===e.artStatus.value,computedValue:e=>({concept_id:r("ON_CPT"),value_coded:r(`${e.value}`),obs_datetime:a.date}),options:()=>[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]},{id:"cptStartDate",helpText:"CPT Start Date",type:n.TT_FULL_DATE,validation:e=>s.validateSeries([()=>s.required(e),()=>s.dateRangeOf(e,`${u.getBirthdate()}`,a.date)]),computedValue:e=>({concept_id:r("CPT_START_DATE"),[/unknown/i.test(`${e.value}`)?"value_text":"value_datetime"]:e.value,obs_datetime:a.date}),condition:e=>"YES_ANSWER"===e.cptStatus.value,config:{allowUnknown:!0}}]}));async function V(e,t){d.isEmpty(b.value)?(await a.createEncounter(),await a.saveObservationList(await A(t))):b.value?.hivStatus?._recordedStatusInTB||(await a.createEncounter(),await a.saveObservationList(Object.keys(b.value).reduce(((e,t)=>[...e,b.value[t].obs]),[]))),N()}return(e,a)=>(T(),c(S(E),null,{default:_((()=>[v(p,{cancelDestinationPath:S(R),onFinishAction:V,fields:t.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
