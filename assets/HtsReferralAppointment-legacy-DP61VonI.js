System.register(["./index-legacy-Ck8hVlzC.js","./LocationFieldOptions-legacy-UgaUiM8M.js","./HisStandardForm-legacy-OroqgFde.js","./storage-legacy-CIkBlJKf.js"],(function(e,t){"use strict";var n,a,i,o,s,l,r,u,d,c,f,g,p,m,v,y,T,h;return{setters:[e=>{n=e.bk,a=e.d,i=e.I,o=e.K,s=e.dF,l=e.F,r=e.aV,u=e.aW,d=e.ct,c=e.ba,f=e._,g=e.r,p=e.o,m=e.c,v=e.w,y=e.b},e=>{T=e.g},e=>{h=e.H},null],execute:function(){class t extends n{constructor(e,t=-1){super(e,7,t)}nextAppointment(){return n.getJson(`/programs/${this.programID}/patients/${this.patientID}/next_appointment_date`,{date:this.date})}}const b=a({components:{IonPage:i,HisStandardForm:h},setup(){const e=o([]),n=new t(-1),a=o(!1),{visitID:i,htsClient:f,getEncounter:g,patientDashboardUrl:p,saveEncounter:m,toOption:v}=s({onInitVisit:()=>{e.value=[y(),{id:"referral_location",helpText:"Intended site for retesting",type:l.TT_SELECT,isRequired:()=>!0,finalComputedValue:({label:e})=>({obs:n.buildValueText("Referral location",e)}),defaultValue:()=>t.getLocationName(),condition:e=>"Not done"!=e.re_test.value,options:(e,t="")=>T(t),config:{footerBtns:[{name:"Here",slot:"end",onClickComponentEvents:{setValue:()=>t.getLocationName()},onClick:()=>null}],showKeyboard:!0,isFilterDataViaApi:!0}},h()]}});function y(){let e=null;return{id:"re_test",helpText:"Referral for Re-Testing",type:l.TT_TEXT_BANNER,init:async()=>{let n="",o="",s="";const l=new t(i.value),u=g("Testing");if(u?(n=u["HIV status"]||"N/A",o=u["client risk category"]||"N/A"):r().isOfflineMode.value||(o=await l.getFirstValueCoded("client risk category")||"N/A",n=await l.getFirstValueCoded("HIV Status")||"N/A"),"F"===f.gender){const e=g("PREGNANCY STATUS");e?s=e["Pregnancy status"]:r().isOfflineMode.value||(s=await l.getFirstValueCoded("Pregnancy status")||"N/A")}return/Negative/i.test(n)&&"BREASTFEEDING"===s?(a.value=!0,e={label:"Book a Re-Test for Female Breastfeeding Client",value:"Re-test"}):/Negative/i.test(n)&&"Pregnant woman"==s?(a.value=!0,e={label:"Book a Re-Test for Female Pregnant Client",value:"Re-test"}):e=/Positive Initial Professional/i.test(n)?{label:"Confirmatory test is needed for Positive result",value:"Confirmatory HIV test"}:/high risk|High risk event|on-going/i.test(`${o}`)?{label:`Retesting is required due to "${o}"`,value:"Re-test"}:{label:"No re-test required",value:"Not done"},!0},defaultValue:()=>(console.log(e.value),v(e.value)),condition:()=>null!=e,finalComputedValue:e=>({obs:n.buildValueCoded("Referral for Re-Testing",e.value)}),options:()=>[v(e.label)]}}function h(){let e="",t="";return{id:"set_appointment",helpText:"Select Appointment Date for Re-testing",type:l.TT_DATE_PICKER,init:async()=>{if(t=n.date,a.value)e=u(t).add(365,"day").format("YYYY-MM-DD");else try{t=function(){const e=g("Testing");if(!e)return n.date;const t={14:["Positive Initial Professional"===e["HIV status"],"Inconclusive"===e["HIV status"]],28:[/negative/i.test(e["HIV status"])&&/High risk event in last 3 months|not done/i.test(e["client risk category"])],365:[/negative/i.test(e["HIV status"])&&/On-going risk/i.test(e["client risk category"])]};return Object.keys(t).reduce(((e,a)=>!e&&t[a].some(Boolean)?u(n.date).add(a,"days").format(c):e),"")}(),e=u(t).add(15,"day").format("YYYY-MM-DD")}catch(i){}return!0},isRequired:()=>!0,condition:e=>e.referral_location.value,defaultValue:()=>t,finalComputedValue:e=>({obs:n.buildValueDate("Appointment date",`${e.value}`)}),config:{minDate:()=>t,maxDate:()=>e,infoItems:e=>[{label:"System set appointment",value:d(t)},{label:"User set appointment",value:d(e)}],hiddenFooterBtns:["Clear"]}}}return{patientDashboardUrl:p,onFinish:function(e,t){m({encounterName:"APPOINTMENT",encounterTypeID:n.encounterTypeID,computedData:t})},fields:e}}});e("default",f(b,[["render",function(e,t,n,a,i,o){const s=g("his-standard-form"),l=g("ion-page");return p(),m(l,null,{default:v((()=>[y(s,{formLabel:"Appointment",fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:e.patientDashboardUrl()},null,8,["fields","onFinishAction","cancelDestinationPath"])])),_:1})}]]))}}}));
