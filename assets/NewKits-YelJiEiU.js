import{d as F,aW as V,$ as G,_ as O,a5 as U,S as W,Q as A,R as H,U as P,a4 as Q,a3 as R,aQ as j,W as M,a1 as X,ak as Z,r as w,ap as q,t as J,aj as Y,dD as T,a9 as S,ad as k,O as ee,K as oe,aU as te,ah as ae,a6 as ne,v as g,w as t,ab as n,u as b,x as a,G as u,Z as D,B as re,C as le,E as se,z as d,b1 as C,H as ie}from"./index-CyYd6aWW.js";import{T as ue}from"./testKits-D8rScTQY.js";const ce=F({components:{IonGrid:V,IonCol:G,IonRow:O,IonPage:U,IonTitle:W,IonHeader:A,IonToolbar:H,IonContent:P,IonFooter:Q,IonButton:R,BarcodeInput:j,IonItem:M,IonLabel:X,IonText:Z},setup(){const{kits:o,initKits:l,saveKits:E}=ue(),c=w(),p=w(!1),h=q(()=>o.value.some(e=>!e.lotNo&&e.expiryDate||!e.expiryDate&&e.lotNo||o.value.some(s=>s.expiryDateError))),_=()=>{o.value.forEach(e=>(e.expiryDate&&new Date(e.expiryDate)<=new Date(Y.getSessionDate())?e.expiryDateError="Kit has expired!!":e.expiryDateError="",e))};function f(e){T({id:"lot",helpText:o.value[e].kitName+" Lot No.",type:S.TT_TEXT,defaultValue:()=>o.value[e].lotNo},s=>{const y=(s==null?void 0:s.value)||"";o.value[e].lotNo=y})}function x(e){T({id:"expiry",helpText:o.value[e].kitName+" Expiry Date",type:S.TT_FULL_DATE,defaultValue:()=>o.value[e].expiryDate},s=>{const y=(s==null?void 0:s.value)||"";o.value[e].expiryDate=y,_()})}function N(e){o.value[c.value].lotNo=e,o.value[c.value].expiryDate||x(c.value)}async function i(){await k("Are you sure you want to clear everything?")&&(o.value.forEach(e=>{e.expiryDate="",e.lotNo="",e.expiryDateError=""}),c.value=null)}async function m(){if(_(),h.value)return ee("Some kits have errors! please fix them below");if(!(o.value.every(e=>!(e.lotNo&&e.expiryDate))&&!await k("Do you want to continue without updating test kits?"))){p.value=!1;try{return await E(),oe("Testkits updated!"),te.back()}catch(e){console.error("".concat(e)),ae("General error has occured!")}p.value=!0}}return J(()=>l().then(()=>{_(),p.value=!0})),{kits:o,activeIndex:c,hasErrors:h,canFinish:p,save:m,onScan:N,updateLot:f,updateExpiryDate:x,clear:i}}}),de={class:"his-card"};function pe(o,l,E,c,p,h){const _=n("ion-title"),f=n("ion-toolbar"),x=n("barcode-input"),N=n("ion-header"),i=n("ion-label"),m=n("ion-item"),e=n("ion-col"),s=n("ion-text"),y=n("ion-row"),K=n("ion-grid"),L=n("ion-content"),I=n("ion-button"),$=n("ion-footer"),z=n("ion-page");return b(),g(z,null,{default:t(()=>[a(N,null,{default:t(()=>[a(f,{color:"light"},{default:t(()=>[a(_,{class:"ion-text-center his-md-text"},{default:t(()=>{var r;return[u("b",null,D(((r=o.kits[o.activeIndex])==null?void 0:r.kitName)||"-"),1)]}),_:1})]),_:1}),a(f,null,{default:t(()=>[a(x,{style:{margin:"0px auto",width:"90%"},onOnScan:o.onScan},null,8,["onOnScan"])]),_:1})]),_:1}),a(L,null,{default:t(()=>[a(K,null,{default:t(()=>[(b(!0),re(se,null,le(o.kits,(r,v)=>(b(),g(y,{onClick:()=>o.activeIndex=v,class:C(o.activeIndex===v?"his-card active":""),key:v},{default:t(()=>[a(e,{size:"4"},{default:t(()=>[u("div",de,[a(m,{lines:"none"},{default:t(()=>[a(i,null,{default:t(()=>l[0]||(l[0]=[d(" Kit name ")])),_:1}),a(i,{slot:"end"},{default:t(()=>[u("b",null,D(r.kitName),1)]),_:2},1024)]),_:2},1024)])]),_:2},1024),a(e,{size:"4"},{default:t(()=>[u("div",{class:C(["his-card",r.expiryDate&&!r.lotNo?"error":""])},[a(m,{onClick:B=>o.updateLot(v),lines:"none"},{default:t(()=>[a(i,null,{default:t(()=>l[1]||(l[1]=[d(" Lot No. ")])),_:1}),a(i,{slot:"end"},{default:t(()=>[u("b",null,D(r.lotNo),1)]),_:2},1024)]),_:2},1032,["onClick"])],2)]),_:2},1024),a(e,{size:"4"},{default:t(()=>[u("div",{class:C(["his-card",!r.expiryDate&&r.lotNo?"error":""])},[a(m,{onClick:B=>o.updateExpiryDate(v),lines:"none"},{default:t(()=>[a(i,null,{default:t(()=>l[2]||(l[2]=[d(" Expiry Date ")])),_:1}),a(i,{color:r.expiryDateError?"danger":"",slot:"end"},{default:t(()=>[u("b",null,D(r.expiryDate),1)]),_:2},1032,["color"])]),_:2},1032,["onClick"]),r.expiryDateError?(b(),g(s,{key:0,color:"danger",class:"ion-text-center"},{default:t(()=>[d(D(r.expiryDateError),1)]),_:2},1024)):ie("",!0)],2)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})]),_:1}),a($,null,{default:t(()=>[a(f,{color:"light"},{default:t(()=>[a(I,{onClick:o.clear,slot:"end",color:"warning",size:"large"},{default:t(()=>l[3]||(l[3]=[d(" Clear ")])),_:1},8,["onClick"]),a(I,{onClick:o.save,disabled:!o.canFinish||o.hasErrors,slot:"end",color:"success",size:"large"},{default:t(()=>l[4]||(l[4]=[d(" Finish ")])),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})}const me=ne(ce,[["render",pe],["__scopeId","data-v-d37657b0"]]);export{me as default};
