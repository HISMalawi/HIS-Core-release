System.register(["./index-legacy-DhfIpXPN.js","./TableView-legacy-BtsAnnvm.js"],(function(t,e){"use strict";var n,a,r,i,s,o,l,c,u,d,p,f,m,b,g,h,v,w,y,D;return{setters:[t=>{n=t.d,a=t.n,r=t.r,i=t.aR,s=t.aZ,o=t.bl,l=t.cs,c=t.ct,u=t.bM,d=t.ak,p=t.a,f=t.w,m=t.e,b=t.ap,g=t.b,h=t.br,v=t.y,w=t.p,y=t.z},t=>{D=t.v}],execute:function(){t({a:async function(t){t.patientIdentifiers.length&&(await y.create({component:_,backdropDismiss:!1,cssClass:"large-modal",componentProps:{onFinish:()=>y.getTop().then((t=>t&&y.dismiss())),...t}})).present()},b:P,c:A,d:function(t){return t.map(((t,e)=>({...t,index:e+1})))},s:async function(t){(t.columnData??[]).length&&(await y.create({component:D,backdropDismiss:!1,cssClass:"large-modal",componentProps:{onFinish:()=>y.getTop().then((t=>t&&y.dismiss())),...t}})).present()},w:async function(t,e=!0){e&&(await h.create({message:"Please wait...",backdropDismiss:!1})).present();try{const e=await t();return h.getTop().then((t=>t?h.dismiss():null)),e}catch(n){console.error(n),v("Unable to generate report")}h.getTop().then((t=>t?h.dismiss():null))}});const e=n({props:{title:{type:String,default:"Drilldown"},patientIdentifiers:{type:Object},onFinish:{type:Function},viewRef:{type:String,default:"person_id"}},components:{IonPage:a,v2Datatable:D},setup(t){const e=r(!0),n=r("-"),a=r([]),d=[[P("identifier","ARV Number"),{label:"Gender",ref:"gender"},{label:"Birthdate",ref:"birthdate"},{label:"Art start date",ref:"art_start_date"},A(t.viewRef)]];return i((()=>t.patientIdentifiers),(async t=>{if(a.value=[],n.value="Total: 0",!t||!t.length)return;const r=s.chunk(t,1e3);for(const s of r){try{if(!e.value)break;const t=(await o.getPersons(s)).map((t=>({...t,birthdate:c(t.birthdate),art_start_date:c(t.art_start_date),gender:l(t.gender)})));a.value=[...a.value,...t]}catch(i){console.error(i)}n.value=`Total: ${a.value.length} of ${(t||[]).length}`,await u(100)}}),{immediate:!0}),{columns:d,subtitle:n,reportData:a,canLoadData:e,ITEMS_PER_PAGE:25,runFinishAction:function(){e.value=!1,"function"==typeof t.onFinish&&t.onFinish()}}}}),_=t("A",d(e,[["render",function(t,e,n,a,r,i){const s=b("v2Datatable"),o=b("ion-page");return g(),p(o,null,{default:f((()=>[m(s,{title:t.title,subtitle:t.subtitle,columnData:t.reportData,columns:t.columns,"default-sort-order":"asc","default-sorted-column":"identifier","on-finish":t.runFinishAction,rowsPerPage:t.ITEMS_PER_PAGE},null,8,["title","subtitle","columnData","columns","on-finish","rowsPerPage"])])),_:1})}]]));function P(t="arv_number",e="ARV#"){return{ref:t,label:e,sortValue:t=>{const e=`${t}`.match(/\w{2,5}-arv-(?<arvDigit>\d*)/i);return parseInt(e?.groups?.arvDigit||"-1")}}}function A(t="patient_id",e="/patient/dashboard/"){return{ref:t,label:"Actions",exportable:!1,toValue:()=>"View",tdClick:({refData:t})=>w.push(`${e}${t}`)}}}}}));
