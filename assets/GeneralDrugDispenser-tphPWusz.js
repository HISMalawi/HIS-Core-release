import{d as B,d_ as M,as as V,a8 as P,ad as i,u as l,B as r,x as e,w as o,a1 as n,E as y,C as D,z as h,Y as u,a6 as O,a7 as R,bP as F,aP as U,Z as q,_ as K,v as Q,G as A}from"./index-C85Md6LK.js";import{O as Y}from"./ActionSideButton-DnmmS5z7.js";import{R as L}from"./ResetButton-BJB_91EY.js";import{_ as T}from"./FieldMixin.vue_vue_type_script_lang-D2wF-hk-.js";const Z=B({data:()=>({amount:"",keyboard:M}),props:{drugName:{type:String,required:!0},amountNeeded:{type:String,required:!0},onDispense:{type:Function,required:!0}},methods:{async onKeyPress(t){const s=this.amount;t.match(/del/i)?this.amount=s.substring(0,s.length-1):t.match(/clear/i)?this.amount="":t.match(/close/i)?this.onClose():t.match(/reset/i)?this.amount="":t.match(/dispense/i)?(this.amount&&this.onDispense(this.amount),this.onClose()):this.amount+=t},async onClose(){await V.dismiss({})}}}),I=t=>(O("data-v-59c9686c"),t=t(),R(),t),j={class:"",style:{border:".1rem solid #c2c2c2c2"}},J={class:"keypad"},W=I(()=>n("b",null,"Medication: ",-1)),X=I(()=>n("b",null,"Amount needed: ",-1)),x=I(()=>n("b",null,"Amount Dispensed: ",-1));function tt(t,s,d,m,c,k){const p=i("ion-input"),_=i("ion-button"),g=i("ion-col"),f=i("ion-label"),b=i("ion-item"),$=i("ion-list"),w=i("ion-row"),a=i("ion-grid"),v=i("ion-content"),C=i("ion-toolbar"),E=i("ion-footer");return l(),r(y,null,[e(v,null,{default:o(()=>[e(a,null,{default:o(()=>[e(w,null,{default:o(()=>[e(g,{size:"5"},{default:o(()=>[n("div",j,[e(p,{type:"text",class:"keypad-input",value:t.amount},null,8,["value"]),n("table",J,[(l(!0),r(y,null,D(t.keyboard,(S,H)=>(l(),r("tr",{key:H},[(l(!0),r(y,null,D(S,(N,G)=>(l(),r("td",{class:"his-keyboard-margin",key:"btn-".concat(G)},[e(_,{color:"primary",class:"his-keyboard-btn",onClick:_t=>t.onKeyPress(N)},{default:o(()=>[h(u(N),1)]),_:2},1032,["onClick"])]))),128))]))),128))])])]),_:1}),e(g,{size:"7"},{default:o(()=>[e($,null,{default:o(()=>[e(b,null,{default:o(()=>[e(f,null,{default:o(()=>[W,h(" "+u(t.drugName),1)]),_:1})]),_:1}),e(b,null,{default:o(()=>[e(f,null,{default:o(()=>[X,h(u(t.amountNeeded),1)]),_:1})]),_:1}),e(b,null,{default:o(()=>[e(f,null,{default:o(()=>[x,h(u(t.amount.length?t.amount:0),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(E,null,{default:o(()=>[e(C,null,{default:o(()=>[e(_,{onClick:t.onClose,color:"danger",size:"large",slot:"start"},{default:o(()=>[h(" Close ")]),_:1},8,["onClick"]),e(_,{onClick:s[0]||(s[0]=S=>t.onDispense(t.amount)),disabled:t.amount.length<=0,color:"success",size:"large",slot:"end"},{default:o(()=>[h(" Dispense ")]),_:1},8,["disabled"])]),_:1})]),_:1})],64)}const et=P(Z,[["render",tt],["__scopeId","data-v-59c9686c"]]),nt=B({components:{ViewPort:F,Barcode:U,NavButton:Y,ResetButton:L,IonRow:q,IonCol:K},mixins:[T],data:()=>({isDispensing:!1,tab:"prescribe",listData:[]}),mounted(){this.init()},activated(){this.init()},computed:{medicationHistory(){return this.config&&this.config.medicationHistory?this.config.medicationHistory:[]}},methods:{async init(){this.$emit("onFieldActivated",this),this.listData=await this.options(this.fdata)},async onScan(t){const[s,d]=t.split("-"),m=this.listData.map(async c=>{if(c.other.drug_id===parseInt(s)){const k=parseInt(c.value.toString()),p=parseInt(d);await this.updateOnValue(c,p,[],!0)&&(c.value=p+k)}return c});this.listData=await Promise.all(m)},async onReset(t){await this.updateOnValue(t,-1)},async updateOnValue(t,s,d=[],m=!1){return this.onValue&&!await this.onValue({label:t.label,other:{dispenses:d,...t.other},value:s},m)?!1:(t.value=s<0?0:s,this.$emit("onValue",t),this.onValueUpdate&&(this.listData=await this.onValueUpdate(t,this.listData)),!0)},async launchDispenser(t){if(this.isDispensing)return;this.isDispensing=!0;const s=await V.create({component:et,backdropDismiss:!1,cssClass:"custom-modal",componentProps:{drugName:t.label,amountNeeded:t.other.amount_needed,onDispense:async d=>{await this.updateOnValue(t,d)&&await V.dismiss({})}}});s.present(),await s.onDidDismiss(),this.isDispensing=!1}}}),z=t=>(O("data-v-57e38329"),t=t(),R(),t),ot={class:"view-port-content"},st={key:0,class:"his-card history"},it={class:"his-table"},at=z(()=>n("tr",null,[n("th",null," Medication"),n("th",null," Date"),n("th",null," Amount dispensed ")],-1)),lt={key:1,class:"prescription-tab"},rt={class:"prescription-table-section his-card"},ut={class:"his-table"},ct=z(()=>n("tr",null,[n("th",null," Medication"),n("th",null," Amount needed"),n("th",null," Amount dispensed "),n("th",null," Reset ")],-1)),dt={class:"barcode-section"};function pt(t,s,d,m,c,k){const p=i("nav-button"),_=i("ion-col"),g=i("ion-input"),f=i("reset-button"),b=i("barcode"),$=i("ion-row"),w=i("view-port");return l(),Q(w,null,{default:o(()=>[n("div",ot,[e($,null,{default:o(()=>[e(_,{size:"2"},{default:o(()=>[e(p,{onClick:s[0]||(s[0]=a=>t.tab="prescribe"),isActive:t.tab==="prescribe",image:"prescription/rx",label:"Prescribed"},null,8,["isActive"]),e(p,{onClick:s[1]||(s[1]=a=>t.tab="history"),isActive:t.tab==="history",image:"prescription/history",label:"History"},null,8,["isActive"])]),_:1}),e(_,{size:"10"},{default:o(()=>[t.tab==="history"?(l(),r("div",st,[n("table",it,[at,(l(!0),r(y,null,D(t.medicationHistory,(a,v)=>(l(),r("tr",{key:v},[n("td",null,u(a.medication),1),n("td",null,u(a.date),1),n("td",null,u(a.amount),1)]))),128))])])):A("",!0),t.tab==="prescribe"?(l(),r("div",lt,[n("div",rt,[n("table",ut,[ct,(l(!0),r(y,null,D(t.listData,(a,v)=>(l(),r("tr",{key:v},[n("td",null,u(a.label),1),n("td",null,u(a.other.amount_needed),1),n("td",null,[e(g,{disabled:a.value>0,value:a.value,onClick:C=>a.value<=0?t.launchDispenser(a):null,class:"dosage-input"},null,8,["disabled","value","onClick"])]),n("td",null,[e(f,{disabled:a.value<=0,onClick:C=>a.value>0?t.onReset(a):null},null,8,["disabled","onClick"])])]))),128))])]),n("div",dt,[e(b,{onOnScan:t.onScan,class:"his-card"},null,8,["onOnScan"])])])):A("",!0)]),_:1})]),_:1})])]),_:1})}const vt=P(nt,[["render",pt],["__scopeId","data-v-57e38329"]]);export{vt as default};
