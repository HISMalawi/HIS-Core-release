System.register(["./index-legacy-DLdqxVnr.js","./HisStandardForm-legacy-D9LtBbE8.js","./useEncounter-legacy-BWIHzFlJ.js","./commons-legacy-Bc6uhvf5.js","./isEmpty-legacy-0aF-DGmx.js","./encounter_guidelines-legacy-Cn5GVi4r.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,i,l,u,o,n,d,s,r,T,c,v,_,S,E,p,A,m;return{setters:[e=>{a=e.d,i=e.r,l=e.bH,u=e.bM,o=e.a9,n=e.bL,d=e.aJ,s=e.aa,r=e.dQ,T=e.u,c=e.v,v=e.w,_=e.x,S=e.y,E=e.a5},e=>{p=e.H},e=>{A=e.u},e=>{m=e.r},null,null,null],execute:function(){e("default",a({__name:"Hiv",setup(e){const t=i([]),a=new l(-1,u.UPDATE_HIV_STATUS),b=i(),{goToNextTask:N,patientDashboardUrl:R}=A(((e,i,u)=>{a.patientID=i,a.providerID=e,t.value=[(()=>{const e=[];return{id:"artSummary",helpText:"ART Summary",type:o.TT_SUMMARY,init:async()=>(b.value=await n.generateArtStatusFromArt(i,l.getSessionDate()),b.value&&Object.keys(b.value).forEach((t=>e.push(b.value[t]))),!0),condition:()=>!d.isEmpty(b.value),options:()=>e}})(),{id:"hivStatus",helpText:"HIV Status",type:o.TT_SELECT,requireNext:!1,validation:e=>s.required(e),condition:()=>d.isEmpty(b.value),computedValue:e=>"NOT_DONE"===e.value?{concept_id:r("HIV_TEST_DONE_TODAY"),value_coded:r("NO_ANSWER"),obs_datetime:a.date}:{concept_id:r("HIV_STATUS"),value_coded:r(`${e.value}`),obs_datetime:a.date},options:()=>[{value:"POSITIVE",label:"Positive"},{value:"NEGATIVE",label:"Negative"},{value:"NOT_DONE",label:"Not Tested"}]},{id:"timeOfHIVTest",helpText:"Time of HIV test",type:o.TT_SELECT,requireNext:!1,validation:e=>s.required(e),computedValue:e=>({concept_id:r("TIME_OF_HIV_TEST"),value_coded:r(`${e.value}`),obs_datetime:a.date}),condition:e=>"POSITIVE"===e.hivStatus.value||"NEGATIVE"===e.hivStatus.value,options:()=>[{value:"HIV_BEFORE_TB",label:"Before TB Registration"},{value:"HIV_AFTER_TB",label:"After TB Registration"}]},{id:"artStatus",helpText:"ART Started",type:o.TT_SELECT,requireNext:!1,validation:e=>s.required(e),condition:e=>"POSITIVE"===e.hivStatus.value,computedValue:e=>({concept_id:r("ON_ART"),value_coded:r(`${e.value}`),obs_datetime:a.date}),options:()=>[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]},{id:"arvStatus",helpText:"ARV Status",type:o.TT_SELECT,requireNext:!1,validation:e=>s.required(e),condition:e=>"YES_ANSWER"===e.artStatus.value,computedValue:e=>({concept_id:r("ARV_STATUS"),value_coded:r(`${e.value}`),obs_datetime:a.date}),options:()=>[{value:"ARV_BEFORE_TB",label:"Started ARV before TB Treatment"},{value:"ARV_WHILE_TB",label:"Started ARV while on TB Treatment"},{value:"ARV_AFTER_DISCHARGE",label:"ARV not started by the time when discharged from TB treatment"}]},{id:"cptStatus",helpText:"Started CPT",type:o.TT_SELECT,requireNext:!1,validation:e=>s.required(e),condition:e=>"YES_ANSWER"===e.artStatus.value,computedValue:e=>({concept_id:r("ON_CPT"),value_coded:r(`${e.value}`),obs_datetime:a.date}),options:()=>[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]},{id:"cptStartDate",helpText:"CPT Start Date",type:o.TT_FULL_DATE,validation:e=>s.validateSeries([()=>s.required(e),()=>s.dateRangeOf(e,`${u.getBirthdate()}`,a.date)]),computedValue:e=>({concept_id:r("CPT_START_DATE"),[/unknown/i.test(`${e.value}`)?"value_text":"value_datetime"]:e.value,obs_datetime:a.date}),condition:e=>"YES_ANSWER"===e.cptStatus.value,config:{allowUnknown:!0}}]}));async function y(e,t){d.isEmpty(b.value)?(await a.createEncounter(),await a.saveObservationList(await m(t))):b.value?.hivStatus?._recordedStatusInTB||(await a.createEncounter(),await a.saveObservationList(Object.keys(b.value).reduce(((e,t)=>[...e,b.value[t].obs]),[]))),N()}return(e,a)=>(T(),c(S(E),null,{default:v((()=>[_(p,{cancelDestinationPath:S(R),onFinishAction:y,fields:t.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
