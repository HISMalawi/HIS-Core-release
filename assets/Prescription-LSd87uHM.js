import{Q as x}from"./HisKbConfigurations-a7K7dizM.js";import{V as ee}from"./ViewPort-kkmofE00.js";import{k as N}from"./KbHandler-oqPdZ1-Q.js";import te from"./BaseTextInput-SRt5aROE.js";import{d as q,O as H,j as oe,i as z,k as se,l as U,m as j,f as G,_ as T,r as s,o as l,x as h,b as o,w as i,u as p,F as I,y as B,c as _,ar as O,g as Q,h as Y,cu as ne,cr as ie,v as K,e as ae,B as re,C as le,cB as ce,cC as de,cD as ue,t as V,n as pe,T as he,p as me,H as fe,b7 as _e,A as r,z as g,a3 as be,a4 as ye}from"./index-hoLU9YgK.js";import{_ as ve}from"./FieldMixin.vue_vue_type_script_lang-iJxb79-6.js";import{H as ke}from"./HisKeyboard-9a4WjXaD.js";import{B as ge}from"./BaseKeyboard-Atx0WGaP.js";import{P as Ie}from"./KbLayouts-9dqmDWmG.js";import{D as A,a as F,A as Ce}from"./drug_prescription_service-xcUL0LMP.js";import{_ as De}from"./EncounterMixin.vue_vue_type_script_lang-k7lbT0HV.js";import"./drug_order_service-81VjW-RO.js";import"./drug_service-OLXJt66C.js";import"./encounter_guidelines-NSNTqAoK.js";import"./GuidelineEngine-syyQoOzo.js";import"./HisStandardForm-rzQ2tZDj.js";import"./TouchScreenForm-3AdFBAzj.js";import"./dynamic-import-helper-9HnG3Mif.js";import"./ToolbarMediumCard-8sJVQ55x.js";import"./Transformers-XlEF3tgP.js";const $e=q({name:"Modal",props:{items:{type:Object,required:!0},submitData:{type:Function}},async created(){console.log("created modal")},methods:{async closeModal(e){await H.dismiss(e)}},data(){return{content:"Content",artStartDate:"",monthsOnART:"",lastOrder:"",currentRegimen:"",regimenStartDate:""}},components:{IonHeader:oe,IonToolbar:z,IonTitle:se,IonContent:U,IonFooter:j,IonButton:G}});function we(e,t,n,u,C,v){const c=s("ion-title"),f=s("ion-toolbar"),d=s("ion-header"),D=s("ion-label"),k=s("ion-item"),$=s("ion-list"),w=s("ion-content"),b=s("ion-button"),S=s("ion-footer");return l(),h(I,null,[o(d,null,{default:i(()=>[o(f,null,{default:i(()=>[o(c,null,{default:i(()=>[p("Select Malaria Drugs")]),_:1})]),_:1})]),_:1}),o(w,{style:{overflowY:"hidden",background:"grey"}},{default:i(()=>[o($,{class:"view-port-content"},{default:i(()=>[(l(!0),h(I,null,B(e.items,(m,M)=>(l(),_(k,{key:M,class:"items"},{default:i(()=>{var P;return[o(D,{class:O((P=m==null?void 0:m.other)!=null&&P.wrapTxt?"ion-text-wrap":""),innerHTML:m.label,onClick:[e.submitData,t[0]||(t[0]=E=>e.closeModal("later"))],value:m.value},null,8,["class","innerHTML","onClick","value"])]}),_:2},1024))),128))]),_:1})]),_:1}),o(S,null,{default:i(()=>[o(f,null,{default:i(()=>[o(b,{slot:"start",color:"danger",size:"large",onClick:t[1]||(t[1]=m=>e.closeModal("later"))},{default:i(()=>[p(" Cancel ")]),_:1})]),_:1})]),_:1})],64)}const Se=T($e,[["render",we],["__scopeId","data-v-8ec5afc7"]]),Ke=q({components:{IonList:Q,IonItem:Y,IonRadio:ne,IonRadioGroup:ie},data:()=>({activeLabel:""}),props:{list:{type:Object,required:!0},label:String},methods:{async frequencyKeypress(e){this.$emit("frequencyKeypress",e)}}}),Pe={class:"freq-content"};function Be(e,t,n,u,C,v){const c=s("snap"),f=s("center"),d=s("ion-radio"),D=s("ion-label"),k=s("ion-item"),$=s("ion-radio-group"),w=s("ion-list");return l(),h("div",Pe,[o(f,{style:{"padding-top":"12px"}},{default:i(()=>[o(c,null,{default:i(()=>[p(" Frequency ")]),_:1})]),_:1}),o(w,null,{default:i(()=>[o($,{value:e.activeLabel},{default:i(()=>[(l(!0),h(I,null,B(e.list,(b,S)=>(l(),_(k,{class:"his-md-text",key:S,onClick:m=>e.frequencyKeypress(b)},{default:i(()=>[o(d,{slot:"start",value:b},null,8,["value"]),o(D,null,{default:i(()=>[p(K(b),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1},8,["value"])]),_:1})])}const qe=T(Ke,[["render",Be],["__scopeId","data-v-1eb7d818"]]),Te=q({components:{BaseKeyboard:ge},props:{title:{type:String},preset:{type:String},onKeyPress:{type:Function,required:!0},strictNumbers:{type:Boolean,default:!1}},data:()=>({value:"",keypad:Ie}),watch:{preset:{handler(e){e&&(this.value=e.toString())},immediate:!0}},methods:{async keypress(e){if(this.strictNumbers){if(e.includes(".")&&this.value.includes("."))return;!e.includes(".")&&this.value==="0"&&(this.value=""),this.value=N(e,this.value),this.value||(this.value=""),"".concat(parseInt(this.value))===this.value?this.onKeyPress(parseInt(this.value)):this.onKeyPress(this.value)}else this.value=N(e,this.value),this.onKeyPress(this.value)}}}),Me={class:"keypad"};function Le(e,t,n,u,C,v){const c=s("snap"),f=s("ion-input"),d=s("base-keyboard");return l(),h("div",Me,[o(c,{class:"ion-text-center"},{default:i(()=>[p(K(e.title),1)]),_:1}),o(f,{value:e.value,style:{"text-align":"center",border:"solid 1px #b7b7b7","margin-top":"12px","margin-bottom":"12px"}},null,8,["value"]),o(d,{btnSize:"8.5vw",layout:e.keypad,onKeyPress:e.keypress},null,8,["layout","onKeyPress"])])}const Ve=T(Te,[["render",Le],["__scopeId","data-v-def589c8"]]),Ae=q({name:"HisInfiniteScrollMultipleSelect",mixins:[ve,De],components:{PrescriptionKeypad:Ve,IonCheckbox:ae,IonText:re,IonButton:G,ViewPort:ee,HisTextInput:te,IonContent:U,IonList:Q,IonItem:Y,IonLabel:le,HisKeyboard:ke,IonInfiniteScroll:ce,IonInfiniteScrollContent:de,IonFooter:j,IonToolbar:z,PrescriptionFrequency:qe},data:()=>({switchKeyboard:!0,keyboard:x,listData:[],checkedItems:[],disableScroll:!1,filter2:"",selected:"",selectedItems:[],malariaDrug:[],prescriptionService:{},label:String,page:1,limit:10,trash:ue,list:A.map(e=>e.label),showMalariaDrugs:!1,hasMalaria:!1,disableNextBtn:!0,confirmBtn:!1}),watch:{checkedItems:{handler(e){this.listData.forEach(t=>{e.find(n=>n.value===t.value)?t.isChecked=!0:t.isChecked=!1}),this.$emit("onValue",e)},deep:!0,immediate:!0},filter2:{async handler(){this.page=1,this.disableScroll=!1;const e=await this.getListData();[...this.checkedItems].forEach(t=>{const n=e.findIndex(u=>u.value===t.value);n===-1?e.push(t):e[n].isChecked=!0}),this.listData=e}}},mounted(){this.init()},activated(){this.init()},methods:{async init(){this.listData=await this.getListData()},async getListData(){return this.prescriptionService=new F(this.patientID,this.providerID),await this.prescriptionService.loadDrugs(this.filter2,this.page,this.limit)},async dosageKeypress(e){this.checkedItems[0].other.dosage=e},async frequencyKeypress(){this.checkedItems[0].other.frequency=this.label},async durationKeypress(e){e.match(/Confirm/i)?(this.confirmBtn=!0,this.inputFieldType()):this.checkedItems[0].other.duration=e},async keypress(e){this.filter2||(this.selected=""),this.filter2=N(e,this.selected),this.selected=this.filter2},async onKBValue(e){!this.listData||this.selected===e||(this.filter2=e,this.selected=this.filter2)},async pushData(e){this.page++;const t=await this.getListData();t.length>0?this.listData=[...this.listData,...t.filter(n=>!this.listData.find(u=>u.value===n.value))]:this.disableScroll=!0,e.target.complete()},isComplete(){const e=this.checkedItems[0];return!e.other.frequency||!e.other.duration||!e.other.dosage?(this.disableNextBtn=!0,this.confirmBtn&&(V("complete prescription details for ".concat(e.label)),this.confirmBtn=!1),!1):(this.confirmBtn=!1,this.disableNextBtn=!1,!0)},inputFieldType(){return!this.switchKeyboard&&this.isComplete()?(this.switchKeyboard=!0,!0):(this.switchKeyboard=!1,!1)},async predefinedMalariaDrug(){if(this.hasMalaria=await this.prescriptionService.hasMalaria(),!this.hasMalaria&&!await pe("Patient has no malaria. Do you still want to prescribe anti malaria drugs?"))return;(await H.create({component:Se,backdropDismiss:!1,cssClass:"lager-modal",componentProps:{items:Ce.map(t=>({label:"".concat(t.name,", ").concat(t.frequency," time(s) a day, for ").concat(t.duration," days"),value:[t.name,t.frequency,t.duration,t.dose_strength,t.units,t.drug_id],other:t})),submitData:async t=>{const n=t.target.attributes.value.nodeValue.split(","),u=A.find(c=>c.value==n[1]),C={isChecked:!0,label:n[0],other:{frequency:u.label,units:n[4],drug_id:n[5],duration:n[2],dosage:n[3]},value:n[0]},v=["Lumefantrine + Arthemether 1 x 6","Lumefantrine + Arthemether 2 x 6","Lumefantrine + Arthemether 3 x 6","Lumefantrine + Arthemether 4 x 6"];v.includes(n[0])&&(this.checkedItems=this.checkedItems.filter(c=>!v.includes(c.value))),this.checkedItems.unshift(C),this.isComplete()&&(this.disableNextBtn=!1)}}})).present()},onSelect(e){this.$nextTick(async()=>{e.isChecked?this.checkedItems.findIndex(t=>t.value===e.value)===-1&&(this.checkedItems.unshift(e),this.selected="",this.inputFieldType(),this.isComplete()):this.unCheck(e)})},unCheck(e){this.checkedItems.length==1&&(this.disableNextBtn=!0,this.switchKeyboard=!0),this.checkedItems=this.checkedItems.filter(t=>t.value!==e.value)},clearPrescription(){this.selected=""},async savePrescription(){try{const e=this.mapToOrders();if(!await this.prescriptionService.createEncounter())return V("Unable to create treatment encounter");if(!await this.prescriptionService.createDrugOrder(e))return V("Unable to create drug orders!");he("Drug order has been created"),this.printVisitSummary(),me(this.patientID,this.$router)}catch(e){console.error(e)}},mapToOrders(){return this.checkedItems.map(e=>{const t=F.getSessionDate(),n=A.find(u=>u.label===e.other.frequency)||{};return{drug_inventory_id:e.other.drug_id,equivalent_daily_dose:e.other.dosage=="Unknown"?0:e.other.dosage*(n==null?void 0:n.value)||0,start_date:t,auto_expire_date:this.calculateExpireDate(t,e.other.duration),units:e.other.units,instructions:"".concat(e.label,": ").concat(e.other.dosage," ").concat(e.other.units," ").concat((n==null?void 0:n.code)||""," for ").concat(e.other.duration," days"),dose:e.other.dosage,frequency:(n==null?void 0:n.code)||""}})},calculateExpireDate(e,t){const n=new Date(e);return n.setDate(n.getDate()+parseInt(t)),fe.toStandardHisFormat(n)},printVisitSummary(){return new _e(this.patientID).printVisitSummaryLbl(F.getSessionDate())}},created(){this.keyboard=x,this.page=1,this.limit=10}}),Fe=e=>(be("data-v-cfdfe3c2"),e=e(),ye(),e),Ne={style:{width:"97.8%",margin:"auto"}},Oe={id:"cummulative",class:"cummulative_hight",style:{border:"1px solid #999","border-bottom":"none","background-color":"#f6f2ca",height:"25vh",overflow:"auto",padding:"5px"}},Ee={style:{width:"100%"}},Re=Fe(()=>r("thead",null,[r("tr",null,[r("th",null,"Drug"),r("th",null,"Frequency"),r("th",null,"Dosage"),r("th",null,"Duration"),r("th")])],-1)),xe={class:"dosage-input"},He={class:"dosage-input"},ze={class:"dosage-input"},Ue={class:"dosage-input"},je=["onClick"],Ge={key:2,class:"content"};function Qe(e,t,n,u,C,v){const c=s("ion-input"),f=s("ion-icon"),d=s("ion-button"),D=s("his-text-input"),k=s("ion-text"),$=s("ion-label"),w=s("ion-checkbox"),b=s("ion-item"),S=s("ion-list"),m=s("ion-infinite-scroll-content"),M=s("ion-infinite-scroll"),P=s("ion-content"),E=s("view-port"),W=s("his-keyboard"),J=s("prescription-frequency"),R=s("prescription-keypad"),X=s("ion-toolbar"),Z=s("ion-footer");return l(),h(I,null,[r("div",null,[r("div",Ne,[r("div",Oe,[r("table",Ee,[Re,r("tbody",null,[(l(!0),h(I,null,B(e.checkedItems,(a,L)=>(l(),h("tr",{key:L},[r("td",xe,[r("b",null,K(a.label),1)]),r("td",He,[o(c,{readonly:"",placeholder:"Add frequency..",value:a.other.frequency},null,8,["value"])]),r("td",ze,[o(c,{readonly:"",placeholder:"Add dosage..",value:a.other.dosage},null,8,["value"])]),r("td",Ue,[o(c,{readonly:"",placeholder:"Add duration..",value:a.other.duration},null,8,["value"])]),r("td",{class:"dosage-input",onClick:y=>e.unCheck(a)},[o(d,{color:"danger"},{default:i(()=>[o(f,{icon:e.trash},null,8,["icon"])]),_:1})],8,je)]))),128))])])])]),e.switchKeyboard?(l(),_(E,{key:0,style:{"margin-top":"0px",height:"37vh"}},{default:i(()=>[o(D,{value:e.selected,onOnValue:e.onKBValue},null,8,["value","onOnValue"]),o(P,{style:{width:"100%"},class:"ion-padding-bottom"},{default:i(()=>[r("div",{class:O(["ion-content-scroll-host",{"ion-margin-bottom ion-padding-bottom":e.disableScroll}])},[o(S,{class:O(["view-port-content",{"ion-margin-bottom":e.disableScroll}])},{default:i(()=>[(l(!0),h(I,null,B(e.listData,(a,L)=>(l(),_(b,{key:L,color:a.isChecked?"lightblue":"",lines:a.isChecked?"none":""},{default:i(()=>[o($,null,{default:i(()=>{var y;return[o(k,{class:"his-md-text"},{default:i(()=>[p(K(a.label),1)]),_:2},1024),a.description&&a.isChecked?(l(),_(k,{key:0,color:(y=a.description)==null?void 0:y.color},{default:i(()=>[r("p",null,[r("i",null,K(a.description.text),1)])]),_:2},1032,["color"])):g("",!0)]}),_:2},1024),o(w,{slot:"start",modelValue:a.isChecked,"onUpdate:modelValue":y=>a.isChecked=y,onIonChange:y=>e.onSelect(a,y),disabled:a.disabled},null,8,["modelValue","onUpdate:modelValue","onIonChange","disabled"])]),_:2},1032,["color","lines"]))),128))]),_:1},8,["class"]),o(M,{onIonInfinite:t[0]||(t[0]=a=>e.pushData(a)),threshold:"100px",disabled:e.disableScroll},{default:i(()=>[o(m,{"loading-spinner":"crescent","loading-text":"Loading more data..."})]),_:1},8,["disabled"])],2)]),_:1})]),_:1})):g("",!0),e.switchKeyboard?(l(),_(W,{key:1,kbConfig:e.keyboard,onKeyPress:e.keypress},null,8,["kbConfig","onKeyPress"])):g("",!0),e.switchKeyboard?g("",!0):(l(),h("div",Ge,[o(J,{list:e.list,onFrequencyKeypress:t[1]||(t[1]=a=>e.label=a),onClick:t[2]||(t[2]=a=>e.frequencyKeypress())},null,8,["list"]),o(R,{onKeyPress:e.dosageKeypress,title:"Dosage",onClick:e.isComplete},null,8,["onKeyPress","onClick"]),o(R,{onKeyPress:e.durationKeypress,title:"Duration",onClick:e.isComplete},null,8,["onKeyPress","onClick"])]))]),o(Z,{style:{position:"absolute",bottom:"0"}},{default:i(()=>[o(X,{color:"dark"},{default:i(()=>[o(d,{"router-link":e.cancelDestination,slot:"start",size:"large",color:"danger"},{default:i(()=>[p(" Cancel ")]),_:1},8,["router-link"]),e.switchKeyboard?(l(),_(d,{key:0,onClick:e.predefinedMalariaDrug,slot:"end",size:"large",color:"primary"},{default:i(()=>[p(" Predefined Malaria Drugs ")]),_:1},8,["onClick"])):g("",!0),e.switchKeyboard?g("",!0):(l(),_(d,{key:1,onClick:t[3]||(t[3]=a=>e.durationKeypress("Confirm")),slot:"end",size:"large",color:"success"},{default:i(()=>[p(" Add Drug ")]),_:1})),o(d,{onClick:e.clearPrescription,slot:"end",size:"large",color:"warning"},{default:i(()=>[p(" Clear ")]),_:1},8,["onClick"]),o(d,{disabled:e.disableNextBtn,onClick:e.savePrescription,slot:"end",size:"large",color:"success"},{default:i(()=>[p(" Finish ")]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})],64)}const ft=T(Ae,[["render",Qe],["__scopeId","data-v-cfdfe3c2"]]);export{ft as default};
