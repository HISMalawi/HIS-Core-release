import{d as K,a7 as Y,a8 as M,ay as g,az as x,aA as q,aB as E,ah as H,aC as G,aD as Q,aE as j,ad as D,W as P,ae as C,U as J,aF as X,am as Z,aG as ss,aa as W,af as V,a as p,E as h,K as u,a2 as I,aH as es,aI as ts,b as o,w as i,c as B,M as S,J as $,G as A,aJ as os,r as L,aK as as,at as ns,aL as is,o as ls,u as e,C as w,aM as rs,aN as us,X as ds,Y as U,Z as ps,a6 as m,_ as R,a9 as cs,aO as hs,aP as F,a5 as fs,$ as _,aQ as ws,aR as ms,aS as ys,aT as gs,I as Is,i as z,aU as bs}from"./index-CMZASHAR.js";import{p as vs}from"./main-CPH6X1Kh.js";const Ps=K({components:{IonInput:Y,IonButton:M,IonIcon:g},props:{useVirtualInput:{type:Boolean}},data:function(){return{eye:x,eyeOff:q,passwordTimeout:null,showPasswordButtonTimeout:null,showPassword:!1,showPasswordButton:!1,keyboard:E,auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new H,G.clearScreenTimeout()},setup(){const{facilityName:s,district:t}=ss();return{facilityName:s,district:t}},methods:{onShowPassword(){this.showPassword=!0,this.showPasswordButton=!0,this.passwordTimeout&&clearTimeout(this.passwordTimeout),this.passwordTimeout=setTimeout(()=>this.showPassword=!1,1e4)},renderKeyBoard(s){this.focusInput=s.currentTarget,this.focusInput.id=="password"?this.btnCaption="Login":this.btnCaption="Next";let t=s.currentTarget.getBoundingClientRect().top;t=parseInt(t),this.keyboardTop=t+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(s){const t=s.currentTarget.id;let r;try{t.match(/@#/i)?this.keyboard=Q:t.match(/qwerty/i)?this.keyboard=E:t.match(/Del/i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):t.match(/Next/i)?(this.display="none",r=this.$refs.password,r.$el.click()):t.match(/Login/i)?(this.display="none",this.doLogin()):t.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",this.focusInput.id==="username"?r=this.$refs.username:r=this.$refs.password,r.click()):t.match(/Hide/i)?this.display="none":this.focusInput.value+=t,this.focusInput.id=="username"?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(l){console.warn("input error")}},doLogin:async function(){if(this.showPasswordButtonTimeout&&clearTimeout(this.showPasswordButtonTimeout),this.showPasswordButton=!1,this.showPassword=!1,this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!await this.auth.checkTimeIntegrity())throw"Local date does not match API date. Please Update your device's date";await this.auth.login(this.userInput.password),this.auth.startSession();const s=await Promise.all([this.auth.passwordPolicyEnabled(),this.auth.passwordExpired()]),t=(()=>{let r=0;const l=vs(this.userInput.password);return r+=l.score,/^(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])/i.test(this.userInput.password)&&(r+=2),r<3})();if(t||s.every(Boolean)){const r=l=>"".concat(l.value).toLowerCase();return j([{id:"new_password",proxyID:"password",helpText:"Change your password",type:D.TT_PASSWORD,init:()=>(setTimeout(()=>{t?P("Your password is weak, please change it below"):P("Your password has expired, please change it below",6e3)},500),!0),computedValue:l=>r(l),validation:l=>C.validateSeries([()=>C.required(l),()=>C.hasLengthRangeOf(l,4,15),()=>{if("".concat(this.userInput.password).toLowerCase()===r(l))return["New password should not match old password"]}]),config:{inputType:"password"}},{id:"verify_password",proxyID:"password",helpText:"Confirm Password",type:D.TT_PASSWORD,computedValue:l=>r(l),validation:(l,f)=>C.validateSeries([()=>C.required(l),()=>{if(r(f.verify_password)!=r(f.new_password))return["New password does not match current password"]}]),config:{inputType:"password"}}],async(l,f)=>{await J.updateUser(this.auth.userID,f)?(await this.auth.resetUserPasswordChangeCheck(),this.$router.push("/select_hc_location")):P("Unable to update user")})}this.$router.push("/select_hc_location")}catch(s){s instanceof X?(P("Invalid username or password"),this.showPasswordButton=!0,this.showPasswordButtonTimeout=setTimeout(()=>this.showPasswordButton=!1,3e4)):Z("".concat(s),5e4)}}else P("Complete form to log in")}},computed:{btnStyles(){return"display: ".concat(this.display,"; top: ").concat(this.keyboardTop,";")}}}),Cs={class:"main",ref:"main"},_s={class:"cells ion-padding-bottom"},ks={style:{color:"#cd853f"}},Ts={class:"rows"},Ss={class:"cells"},$s=["readonly"],Bs={class:"rows input-rows"},Vs={class:"cells"},Ls={class:"rows"},As=["id"],Ns=["id"];function Os(s,t,r,l,f,k){const b=V("ion-icon"),v=V("ion-button"),y=V("ion-input");return p(),h($,null,[u("div",Cs,[u("div",_s,[u("h3",null,[t[7]||(t[7]=u("b",{style:{color:"#8b4513"}},"Facility: ",-1)),u("b",ks,I(s.facilityName)+" ("+I(s.district)+")",1)])]),u("div",Ts,[u("div",Ss,[es(u("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":t[0]||(t[0]=d=>s.userInput.username=d),onClick:t[1]||(t[1]=d=>s.renderKeyBoard(d)),class:"input-boxes ion-padding",readonly:s.useVirtualInput},null,8,$s),[[ts,s.userInput.username]])])]),u("div",Bs,[u("div",Vs,[o(y,{style:{margin:"0px auto","margin-top":"15px","text-align":"left"},modelValue:s.userInput.password,"onUpdate:modelValue":t[3]||(t[3]=d=>s.userInput.password=d),type:s.showPassword?"text":"password",name:"password",ref:"password",id:"password",onClick:t[4]||(t[4]=d=>s.renderKeyBoard(d)),class:"input-boxes ion-padding",placeholder:"Password",readonly:s.useVirtualInput},{default:i(()=>[!s.showPassword&&s.showPasswordButton?(p(),B(v,{key:0,onClick:s.onShowPassword,color:"light",size:"large",slot:"end"},{default:i(()=>[o(b,{size:"large",icon:s.eye},null,8,["icon"])]),_:1},8,["onClick"])):S("",!0),s.showPassword&&s.showPasswordButton?(p(),B(v,{key:1,onClick:t[2]||(t[2]=d=>s.showPassword=!1),color:"light",size:"large",slot:"end"},{default:i(()=>[o(b,{size:"large",icon:s.eyeOff},null,8,["icon"])]),_:1})):S("",!0)]),_:1},8,["modelValue","type","readonly"])])])],512),u("div",{id:"keyboard",style:os(s.btnStyles),class:"keyboard"},[(p(!0),h($,null,A(s.keyboard,(d,T)=>(p(),h("span",{key:T},[u("div",Ls,[(p(!0),h($,null,A(d,a=>(p(),h("div",{class:"cells",key:a},[a==="Next"||a==="Login"?(p(),h("button",{key:0,id:s.btnCaption,class:"keyboard-btn login-btn",onClick:t[5]||(t[5]=n=>s.keyPress(n))},I(s.btnCaption),9,As)):S("",!0),a!="Login"&&a!="Next"?(p(),h("button",{key:1,id:s.Caps.on?a.toUpperCase():a.toLowerCase(),class:"keyboard-btn",onClick:t[6]||(t[6]=n=>s.keyPress(n))},I(a==="Del."||a==="Caps"?a:s.Caps.on?a.toUpperCase():a.toLowerCase()),9,Ns)):S("",!0)]))),128))])]))),128))],4)],64)}const Es=W(Ps,[["render",Os],["__scopeId","data-v-5581b3d6"]]),Ds={slot:"start"},Us=["src"],Rs=["src"],Fs=K({__name:"Login",setup(s){const t=z("login-logos/Malawi-Coat_of_arms_of_arms.png"),r=z("login-logos/PEPFAR.png"),l=L([]),f=async()=>{const a=await rs("Application Selection","Please specify the application you wish to use",l.value.map(n=>n.name),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(a.selection&&a.action!="Cancel"){const n=l.value.find(c=>c.name===a.selection);window.open("".concat(n.protocol||"http","://").concat(n.IP,":").concat(n.port||80),"_blank")}},{activePlatformProfile:k,platformProfiles:b}=as(),v=L(""),y=L(""),d=ns(()=>k.value.keyboard===bs.HIS_KEYBOARD_ONLY),T=Object.keys(b.value).map(a=>({label:a,value:{profileName:a,...b.value[a]}}));return is(y,a=>{k.value=(us.find(T,{label:a})||{}).value}),ls(async()=>{var N,O;const a=new H;l.value=((N=await a.loadConfig())==null?void 0:N.otherApps)||[];const n=a.getHeadVersion();a.setActiveVersion(n);const c=await a.getApiVersion();v.value="".concat(n," / ").concat(c),y.value=((O=k.value)==null?void 0:O.profileName)||""}),(a,n)=>(p(),B(e(Is),null,{default:i(()=>[o(e(ds),null,{default:i(()=>[o(e(U),null,{default:i(()=>[o(e(ps),null,{default:i(()=>[o(e(m),{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:i(()=>n[0]||(n[0]=[u("b",{style:{color:"#8b4513"}},"National ",-1),u("b",{style:{color:"#cd853f"}},"EMR",-1)])),_:1})]),_:1}),o(e(m),{class:"ion-padding",slot:"end"},{default:i(()=>[n[1]||(n[1]=w(" Version: ")),u("b",null,I(v.value),1)]),_:1})]),_:1})]),_:1}),o(e(R),{fullscreen:!1,style:{width:"100%"}},{default:i(()=>[o(Es,{useVirtualInput:d.value},null,8,["useVirtualInput"])]),_:1}),o(e(cs),null,{default:i(()=>[o(e(U),null,{default:i(()=>[u("span",Ds,[u("img",{id:"coat",src:e(t),alt:"Malawi Coat of Arms logo"},null,8,Us),u("img",{id:"pepfar",src:e(r),alt:"PEPFAR logo"},null,8,Rs)]),o(e(M),{color:"dark",fill:"outline",size:"large",slot:"end",id:"configuration"},{default:i(()=>[o(e(g),{slot:"end",icon:e(hs)},null,8,["icon"]),n[2]||(n[2]=w(" Quick Actions "))]),_:1}),o(e(F),{trigger:"configuration","dismiss-on-select":"",style:{"--width":"300px"}},{default:i(()=>[o(e(R),null,{default:i(()=>[o(e(fs),null,{default:i(()=>[o(e(_),{button:"","router-link":"/reset_password",class:"his-sm-text"},{default:i(()=>[o(e(g),{icon:e(ws),slot:"start"},null,8,["icon"]),o(e(m),null,{default:i(()=>n[3]||(n[3]=[w("Reset Password")])),_:1})]),_:1}),o(e(_),{button:"","router-link":"/settings/host",class:"his-sm-text"},{default:i(()=>[o(e(g),{icon:e(ms),slot:"start"},null,8,["icon"]),o(e(m),null,{default:i(()=>n[4]||(n[4]=[w("Network Settings")])),_:1})]),_:1}),o(e(_),{button:"",detail:"",id:"devices",class:"his-sm-text"},{default:i(()=>[o(e(g),{icon:e(ys),slot:"start"},null,8,["icon"]),o(e(m),null,{default:i(()=>n[5]||(n[5]=[w("Device Profile")])),_:1})]),_:1}),o(e(F),{trigger:"devices","dismiss-on-select":"",side:"end"},{default:i(()=>[(p(!0),h($,null,A(e(T),c=>(p(),B(e(_),{key:c.label,color:c.label===y.value?"primary":"light",button:"",onClick:()=>y.value=c.label},{default:i(()=>[o(e(m),null,{default:i(()=>[w(I(c.label),1)]),_:2},1024)]),_:2},1032,["color","onClick"]))),128))]),_:1}),o(e(_),{button:"",onClick:f,class:"his-sm-text"},{default:i(()=>[o(e(g),{icon:e(gs),slot:"start"},null,8,["icon"]),o(e(m),null,{default:i(()=>n[6]||(n[6]=[w("Other Applications")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),Ms=W(Fs,[["__scopeId","data-v-a49a4382"]]);export{Ms as default};
