System.register(["./index-legacy-Dg5P6bX-.js","./dynamic-import-helper-legacy-arUa2LZV.js","./HisStandardForm-legacy-BXV61qjj.js","./useEncounter-legacy-Bp6E5sCN.js","./commons-legacy-CiEua9CM.js","./TouchScreenForm-legacy-Bqug27CT.js","./ToolbarMediumCard-legacy-DWokgyDV.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-D3j1oaCn.js","./isEmpty-legacy-rdjCNuhy.js","./_Set-legacy-BL8ow4HL.js","./_setToArray-legacy-jEwcQpqP.js","./encounter_guidelines-legacy-mRSBdMQj.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,r,n,o,s,l,i,u,c,d,p,h,g,m,_,y,b,v,f,T;return{setters:[e=>{a=e.d,r=e.K,n=e.b5,o=e.cV,s=e.t,l=e.V,i=e.aS,u=e.ab,c=e.H,d=e.o,p=e.c,h=e.w,g=e.b,m=e.cl,_=e.a$,y=e.I},e=>{b=e.F},e=>{v=e.H},e=>{f=e.u},e=>{T=e.r},null,null,null,null,null,null,null,null,null],execute:function(){e("default",a({__name:"Adherence",setup(e){const t=r([]),a=new n(-1,o.ADHERENCE);function E(e,t){return _(c.toStandardHisFormat(a.date)).diff(c.toStandardHisFormat(e),t)}function D(e,t,a){return Math.round(100*(e-t)/(e-a))}function j(e){const t="QW"===e.frequency?"week":"day",a=E(e.order.start_date,t);return e.quantity-a*parseFloat(`${e.equivalent_daily_dose}`)}const{goToNextTask:$,patientDashboardUrl:A}=f(((e,r)=>{a.patientID=r,a.providerID=e,t.value=[(()=>{let e=[];return{id:"pills_brought",helpText:"Pills remaining (brought to clinic)",type:b.TT_ADHERENCE_INPUT,init:async()=>{try{e=await n.getJson(`patients/${r}/drugs_orders_by_program`,{date:a.date,program_id:a.programID})}catch(t){console.error(`${t}`),s("Unable to load data!")}return!0},validation:e=>l.validateSeries([()=>l.required(e),()=>e.some((e=>""===e.value))?["Some values are missing"]:null]),computedValue:e=>e.map((e=>{const t=e.other;return[{concept_id:i.getCachedConceptID("Drug adherence"),value_drug:t.drug.drug_id,order_id:t.order_id,value_modifier:"%",person_id:r,value_numeric:D(t.quantity,parseInt(`${e.value}`),j(t))},{concept_id:i.getCachedConceptID("Number of tablets brought to clinic"),order_id:t.order_id,value_numeric:e.value,person_id:r}]})).flat(1),options:t=>u.isEmpty(t.pills_brought)?e.map((e=>({label:e.drug.name,value:"",other:e}))):t.pills_brought}})(),{id:"adherence_report",helpText:"ART adherence",type:b.TT_TABLE_VIEWER,condition:e=>e.pills_brought.length,options:e=>{const t=e.pills_brought,a=t[0].other.order.start_date,r=E(a,"day"),n=` Last visit: ${c.toStandardHisDisplayFormat(a)} \n                    (${r} Days Elapsed)`,o=[],s=[n],l=[["Prescription"],["Tabs given"],["Tabs per day"],["Tabs remaining"],["Expected"],["Actual (counted)"],["Adherence"],["Doses missed/ Unaccounted for"],["Doses consumed"],["Art Adherence"]];return t.forEach(((e,t)=>{const a=j(e.other),r=D(e.other.quantity,parseInt(`${e.value}`),a),n=r>=95&&r<=105?"Good adherence":"Explore problem",i=function(e,t){const a=parseFloat(e)-parseFloat(t);return a<0?-1*a+" missed":a+" unacc"}(`${a}`,`${e.value}`);s.push(e.other.drug.name),l[0].push(""),l[1].push(e.other.quantity),l[2].push(`${e.other.equivalent_daily_dose}`),l[3].push(""),l[4].push(a<0?"0":`${a}`),l[5].push(`${e.value}`),l[6].push(""),l[7].push(i),l[8].push(`${r}%`),l[9].push(n),o.push({index:t+1,row:9,class:n.match(/good/i)?"adherence-txt-good":"adherence-txt-bad"})})),[{label:"Selected Medication",value:"Table",other:{columns:s,rows:l,rowColors:[{indexes:[0,3,6],class:"adherence-col-bg"}],cellColors:o}}]},config:{hiddenFooterBtns:["Clear"]}}]}));async function S(e,t){await a.createEncounter(),await a.saveObservationList(await T(t)),$()}return(e,a)=>(d(),p(m(y),null,{default:h((()=>[g(v,{cancelDestinationPath:m(A),onFinishAction:S,fields:t.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
