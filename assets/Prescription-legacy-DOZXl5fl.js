System.register(["./HisKbConfigurations-legacy-vrLd9Pgz.js","./ViewPort-legacy-BdWinx1S.js","./KbHandler-legacy-De8o5nTq.js","./BaseTextInput-legacy-b28UU1f8.js","./index-legacy-rttSvejT.js","./FieldMixin.vue_vue_type_script_lang-legacy-DIF6qnJ3.js","./HisKeyboard-legacy-f-J1EiOZ.js","./BaseKeyboard-legacy-CJP1DHRk.js","./KbLayouts-legacy-BKvPSxzZ.js","./drug_order_service-legacy-D5jcmcrv.js","./drug_service-legacy-B9OPOpaO.js","./EncounterMixin.vue_vue_type_script_lang-legacy-DgDsRgb3.js","./encounter_guidelines-legacy-Da880sWK.js","./GuidelineEngine-legacy-KsvQuFdF.js","./HisStandardForm-legacy-CfaEhksJ.js","./TouchScreenForm-legacy-Bt9NJZEE.js","./dynamic-import-helper-legacy-DYK5bIOV.js","./ToolbarMediumCard-legacy-Bi2VVsZ_.js","./Transformers-legacy-DhNYVLaS.js"],(function(e,t){"use strict";var a,i,n,s,l,r,o,d,c,u,h,p,g,m,y,b,f,v,k,_,D,I,x,C,w,S,A,K,T,M,N,O,q,E,P,H,L,B,j,V,Q,F,z,$,R,Y,U,W,G,X,Z,J,ee;return{setters:[e=>{a=e.Q},e=>{i=e.V},e=>{n=e.k},e=>{s=e.default},e=>{l=e.d,r=e.O,o=e.j,d=e.i,c=e.k,u=e.l,h=e.m,p=e.f,g=e._,m=e.r,y=e.o,b=e.x,f=e.b,v=e.w,k=e.u,_=e.F,D=e.y,I=e.c,x=e.ar,C=e.g,w=e.h,S=e.cw,A=e.ct,K=e.v,T=e.b5,M=e.aU,N=e.e,O=e.B,q=e.C,E=e.cD,P=e.cE,H=e.cF,L=e.t,B=e.n,j=e.T,V=e.p,Q=e.H,F=e.ba,z=e.A,$=e.z,R=e.a3,Y=e.a4},e=>{U=e._},e=>{W=e.H},e=>{G=e.B},e=>{X=e.P},e=>{Z=e.D},e=>{J=e.D},e=>{ee=e._},null,null,null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent="p[data-v-e3252dd2]{font-size:2rem;font-weight:700;text-align:center}ion-title[data-v-e3252dd2]{text-align:center;color:#333;font-size:1.2rem;font-weight:700}ion-item[data-v-e3252dd2]:hover{--background: #efefef}ion-item[data-v-a27904b4]{font-size:20px}action-header[data-v-a27904b4]{padding-bottom:2rem}.freq-content[data-v-a27904b4]{float:left;border:solid 1px gray;height:62vh;overflow:scroll;width:40%}snap[data-v-a27904b4]{color:#333;font-weight:700;font-family:Nimbus Sans L,Arial Narrow,sans-serif;font-size:20px}snap[data-v-1f2102c7]{color:#333;font-weight:700;font-family:Nimbus Sans L,Arial Narrow,sans-serif;font-size:20px}.keypad[data-v-1f2102c7]{padding:.7em;float:left;border:solid 1px grey;width:30%;height:62vh;border-left:none}table[data-v-1f2102c7]{margin:auto}.his-keyboard-margin[data-v-1f2102c7]{padding:0!important}.his-keyboard-btn[data-v-1f2102c7]{width:110px!important}.keypad-input[data-v-1f2102c7]{border:solid 1px #ccc;background:#fff;border-radius:10px;width:100%;height:70px;text-align:center;font-size:3em}.table[data-v-c5a53854]{display:table;border-spacing:1px;width:100%}.dosage-input[data-v-c5a53854]{background:#fff;border:solid 1px #3333;padding-left:10px;padding-right:10px}input[data-v-c5a53854]{padding:0}.sc-ion-input-md-h[data-v-c5a53854]{--padding-top: 0px;--padding-bottom: 0px}.content[data-v-c5a53854]{width:97.8%;margin:auto}#view-port[data-v-c5a53854]{height:60vh}.his-floating-keyboard[data-v-c5a53854]{position:unset}\n",document.head.appendChild(t);const te=l({name:"Modal",props:{items:{type:Object,required:!0},submitData:{type:Function}},async created(){console.log("created modal")},methods:{async closeModal(e){await r.dismiss(e)}},data:()=>({content:"Content",artStartDate:"",monthsOnART:"",lastOrder:"",currentRegimen:"",regimenStartDate:""}),components:{IonHeader:o,IonToolbar:d,IonTitle:c,IonContent:u,IonFooter:h,IonButton:p}}),ae=g(te,[["render",function(e,t,a,i,n,s){const l=m("ion-title"),r=m("ion-toolbar"),o=m("ion-header"),d=m("ion-label"),c=m("ion-item"),u=m("ion-list"),h=m("ion-content"),p=m("ion-button"),g=m("ion-footer");return y(),b(_,null,[f(o,null,{default:v((()=>[f(r,null,{default:v((()=>[f(l,null,{default:v((()=>[k("Select Malaria Drugs")])),_:1})])),_:1})])),_:1}),f(h,{style:{overflowY:"hidden",background:"grey"}},{default:v((()=>[f(u,{class:"view-port-content"},{default:v((()=>[(y(!0),b(_,null,D(e.items,((a,i)=>(y(),I(c,{key:i,class:"items"},{default:v((()=>[f(d,{class:x(a?.other?.wrapTxt?"ion-text-wrap":""),innerHTML:a.label,onClick:[e.submitData,t[0]||(t[0]=t=>e.closeModal("later"))],value:a.value},null,8,["class","innerHTML","onClick","value"])])),_:2},1024)))),128))])),_:1})])),_:1}),f(g,null,{default:v((()=>[f(r,null,{default:v((()=>[f(p,{slot:"start",color:"danger",size:"large",onClick:t[1]||(t[1]=t=>e.closeModal("later"))},{default:v((()=>[k(" Cancel ")])),_:1})])),_:1})])),_:1})],64)}],["__scopeId","data-v-e3252dd2"]]),ie=l({components:{IonList:C,IonItem:w,IonRadio:S,IonRadioGroup:A},data:()=>({activeLabel:""}),props:{list:{type:Object,required:!0},label:String},methods:{async frequencyKeypress(e){this.$emit("frequencyKeypress",e)}}}),ne={class:"freq-content"},se=g(ie,[["render",function(e,t,a,i,n,s){const l=m("snap"),r=m("center"),o=m("ion-radio"),d=m("ion-label"),c=m("ion-item"),u=m("ion-radio-group"),h=m("ion-list");return y(),b("div",ne,[f(r,{style:{"padding-top":"12px"}},{default:v((()=>[f(l,null,{default:v((()=>[k(" Frequency ")])),_:1})])),_:1}),f(h,null,{default:v((()=>[f(u,{value:e.activeLabel},{default:v((()=>[(y(!0),b(_,null,D(e.list,((t,a)=>(y(),I(c,{class:"his-md-text",key:a,onClick:a=>e.frequencyKeypress(t)},{default:v((()=>[f(o,{slot:"start",value:t},null,8,["value"]),f(d,null,{default:v((()=>[k(K(t),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1},8,["value"])])),_:1})])}],["__scopeId","data-v-a27904b4"]]),le=l({components:{BaseKeyboard:G},props:{title:{type:String},preset:{type:String},onKeyPress:{type:Function,required:!0},strictNumbers:{type:Boolean,default:!1}},data:()=>({value:"",keypad:X}),watch:{preset:{handler(e){e&&(this.value=e.toString())},immediate:!0}},methods:{async keypress(e){if(this.strictNumbers){if(e.includes(".")&&this.value.includes("."))return;e.includes(".")||"0"!==this.value||(this.value=""),this.value=n(e,this.value),this.value||(this.value=""),`${parseInt(this.value)}`===this.value?this.onKeyPress(parseInt(this.value)):this.onKeyPress(this.value)}else this.value=n(e,this.value),this.onKeyPress(this.value)}}}),re={class:"keypad"},oe=g(le,[["render",function(e,t,a,i,n,s){const l=m("snap"),r=m("ion-input"),o=m("base-keyboard");return y(),b("div",re,[f(l,{class:"ion-text-center"},{default:v((()=>[k(K(e.title),1)])),_:1}),f(r,{value:e.value,style:{"text-align":"center",border:"solid 1px #b7b7b7","margin-top":"12px","margin-bottom":"12px"}},null,8,["value"]),f(o,{btnSize:"8.5vw",layout:e.keypad,onKeyPress:e.keypress},null,8,["layout","onKeyPress"])])}],["__scopeId","data-v-1f2102c7"]]),de=[{label:"ONCE A DAY (OD)",code:"OD",value:1},{label:"TWICE A DAY (BD)",code:"BD",value:2},{label:"THREE TIMES A DAY (TDS)",code:"TDS",value:3},{label:"FOUR TIMES A DAY (QID)",code:"QID",value:4},{label:"FIVE TIMES A DAY (5X/D)",code:"5X/D",value:5},{label:"SIX TIMES A DAY (Q4HRS)",code:"Q4HRS",value:6},{label:"IN THE MORNING (QAM)",code:"QAM",value:1},{label:"ONCE A DAY AT NOON (QNOON)",code:"QNOON",value:1},{label:"IN THE EVENING (QPM)",code:"QPM",value:1},{label:"ONCE A DAY AT NIGHT (QHS)",code:"QHS",value:1},{label:"EVERY OTHER DAY (QOD)",code:"QOD",value:.5},{label:"ONCE A WEEK (QWK)",code:"QWK",value:.14},{label:"ONCE A MONTH",code:"ONCE A MONTH",value:.03},{label:"TWICE A MONTH",code:"TWICE A MONTH",value:.071},{label:"Unknown",code:"Unknown",value:0}],ce=[{drug_id:236,duration:3,tabs:6,name:"Lumefantrine + Arthemether 1 x 6",dose_strength:1,units:"tabs",frequency:2},{drug_id:237,duration:3,tabs:12,name:"Lumefantrine + Arthemether 2 x 6",dose_strength:2,units:"tabs",frequency:2},{drug_id:238,duration:3,tabs:18,name:"Lumefantrine + Arthemether 3 x 6",dose_strength:3,units:"tabs",frequency:2},{drug_id:239,duration:3,tabs:24,name:"Lumefantrine + Arthemether 4 x 6",dose_strength:4,units:"tabs",frequency:2},{drug_id:311,duration:1,tabs:1,name:"SP (525mg tablet)",dose_strength:1,units:"tabs",frequency:.03},{drug_id:1218,duration:1,tabs:1,name:"Artesunate injenction",dose_strength:1,units:"ml",frequency:1},{drug_id:1219,duration:3,tabs:3,name:"ASAQ 25mg/67.5mg (3 tablets)",dose_strength:1,units:"mg",frequency:1},{drug_id:1220,duration:3,tabs:3,name:"ASAQ 50mg/135mg (3 tablets)",dose_strength:1,units:"mg",frequency:1},{drug_id:1221,duration:3,tabs:3,name:"ASAQ 100mg/270mg (3 tablets)",dose_strength:1,units:"mg",frequency:1},{drug_id:1222,duration:3,tabs:6,name:"ASAQ 100mg/270mg (6 tablets)",dose_strength:2,units:"mg",frequency:1}];class ue extends T{static getDrugs;constructor(e,t){super(e,25,t)}async loadDrugs(e="",t=1,a=10){return(await J.getDrugs({name:e,page:t,page_size:a,concept_set:"OPD Medication"})).map((e=>({label:e.name,value:e.name,other:e})))}async getDrugs(e="",t=1,a=10){return(await J.getDrugs({name:e,page:t,page_size:a,concept_set:"OPD Medication"})).map((e=>({label:e.name,value:e.name,other:e})))}async hasMalaria(){const e=await M.getLatestMalariaTestResult(this.patientID);return"No"===e?!!(await T.getAllValueCoded(this.patientID,"Primary diagnosis")).includes("Malaria")||!!(await T.getAllValueCoded(this.patientID,"Secondary diagnosis")).includes("Malaria"):"Positive"===e}createDrugOrder(e){return Z.create({encounter_id:this.encounterID,drug_orders:e})}}const he=l({name:"HisInfiniteScrollMultipleSelect",mixins:[U,ee],components:{PrescriptionKeypad:oe,IonCheckbox:N,IonText:O,IonButton:p,ViewPort:i,HisTextInput:s,IonContent:u,IonList:C,IonItem:w,IonLabel:q,HisKeyboard:W,IonInfiniteScroll:E,IonInfiniteScrollContent:P,IonFooter:h,IonToolbar:d,PrescriptionFrequency:se},data:()=>({switchKeyboard:!0,keyboard:a,listData:[],checkedItems:[],disableScroll:!1,filter2:"",selected:"",selectedItems:[],malariaDrug:[],prescriptionService:{},label:String,page:1,limit:10,trash:H,list:de.map((e=>e.label)),showMalariaDrugs:!1,hasMalaria:!1,disableNextBtn:!0,confirmBtn:!1}),watch:{checkedItems:{handler(e){this.listData.forEach((t=>{e.find((e=>e.value===t.value))?t.isChecked=!0:t.isChecked=!1})),this.$emit("onValue",e)},deep:!0,immediate:!0},filter2:{async handler(){this.page=1,this.disableScroll=!1;const e=await this.getListData();[...this.checkedItems].forEach((t=>{const a=e.findIndex((e=>e.value===t.value));-1===a?e.push(t):e[a].isChecked=!0})),this.listData=e}}},mounted(){this.init()},activated(){this.init()},methods:{async init(){this.listData=await this.getListData()},async getListData(){return this.prescriptionService=new ue(this.patientID,this.providerID),await this.prescriptionService.loadDrugs(this.filter2,this.page,this.limit)},async dosageKeypress(e){this.checkedItems[0].other.dosage=e},async frequencyKeypress(){this.checkedItems[0].other.frequency=this.label},async durationKeypress(e){e.match(/Confirm/i)?(this.confirmBtn=!0,this.inputFieldType()):this.checkedItems[0].other.duration=e},async keypress(e){this.filter2||(this.selected=""),this.filter2=n(e,this.selected),this.selected=this.filter2},async onKBValue(e){this.listData&&this.selected!==e&&(this.filter2=e,this.selected=this.filter2)},async pushData(e){this.page++;const t=await this.getListData();t.length>0?this.listData=[...this.listData,...t.filter((e=>!this.listData.find((t=>t.value===e.value))))]:this.disableScroll=!0,e.target.complete()},isComplete(){const e=this.checkedItems[0];return e.other.frequency&&e.other.duration&&e.other.dosage?(this.confirmBtn=!1,this.disableNextBtn=!1,!0):(this.disableNextBtn=!0,this.confirmBtn&&(L(`complete prescription details for ${e.label}`),this.confirmBtn=!1),!1)},inputFieldType(){return!this.switchKeyboard&&this.isComplete()?(this.switchKeyboard=!0,!0):(this.switchKeyboard=!1,!1)},async predefinedMalariaDrug(){this.hasMalaria=await this.prescriptionService.hasMalaria(),(this.hasMalaria||await B("Patient has no malaria. Do you still want to prescribe anti malaria drugs?"))&&(await r.create({component:ae,backdropDismiss:!1,cssClass:"lager-modal",componentProps:{items:ce.map((e=>({label:`${e.name}, ${e.frequency} time(s) a day, for ${e.duration} days`,value:[e.name,e.frequency,e.duration,e.dose_strength,e.units,e.drug_id],other:e}))),submitData:async e=>{const t=e.target.attributes.value.nodeValue.split(","),a=de.find((e=>e.value==t[1])),i={isChecked:!0,label:t[0],other:{frequency:a.label,units:t[4],drug_id:t[5],duration:t[2],dosage:t[3]},value:t[0]},n=["Lumefantrine + Arthemether 1 x 6","Lumefantrine + Arthemether 2 x 6","Lumefantrine + Arthemether 3 x 6","Lumefantrine + Arthemether 4 x 6"];n.includes(t[0])&&(this.checkedItems=this.checkedItems.filter((e=>!n.includes(e.value)))),this.checkedItems.unshift(i),this.isComplete()&&(this.disableNextBtn=!1)}}})).present()},onSelect(e){this.$nextTick((async()=>{e.isChecked?-1===this.checkedItems.findIndex((t=>t.value===e.value))&&(this.checkedItems.unshift(e),this.selected="",this.inputFieldType(),this.isComplete()):this.unCheck(e)}))},unCheck(e){1==this.checkedItems.length&&(this.disableNextBtn=!0,this.switchKeyboard=!0),this.checkedItems=this.checkedItems.filter((t=>t.value!==e.value))},clearPrescription(){this.selected=""},async savePrescription(){try{const e=this.mapToOrders();if(!(await this.prescriptionService.createEncounter()))return L("Unable to create treatment encounter");if(!(await this.prescriptionService.createDrugOrder(e)))return L("Unable to create drug orders!");j("Drug order has been created"),this.printVisitSummary(),V(this.patientID,this.$router)}catch(e){console.error(e)}},mapToOrders(){return this.checkedItems.map((e=>{const t=ue.getSessionDate(),a=de.find((t=>t.label===e.other.frequency));return{drug_inventory_id:e.other.drug_id,equivalent_daily_dose:"Unknown"==e.other.dosage?0:e.other.dosage*a.value,start_date:t,auto_expire_date:this.calculateExpireDate(t,e.other.duration),units:e.other.units,instructions:`${e.label}: ${e.other.dosage} ${e.other.units} ${a.code} for ${e.other.duration} days`,dose:e.other.dosage,frequency:a.code}}))},calculateExpireDate(e,t){const a=new Date(e);return a.setDate(a.getDate()+parseInt(t)),Q.toStandardHisFormat(a)},printVisitSummary(){return new F(this.patientID).printVisitSummaryLbl(ue.getSessionDate())}},created(){this.keyboard=a,this.page=1,this.limit=10}}),pe={style:{width:"97.8%",margin:"auto"}},ge={id:"cummulative",class:"cummulative_hight",style:{border:"1px solid #999","border-bottom":"none","background-color":"#f6f2ca",height:"25vh",overflow:"auto",padding:"5px"}},me={style:{width:"100%"}},ye=(e=>(R("data-v-c5a53854"),e=e(),Y(),e))((()=>z("thead",null,[z("tr",null,[z("th",null,"Drug"),z("th",null,"Frequency"),z("th",null,"Dosage"),z("th",null,"Duration"),z("th")])],-1))),be={class:"dosage-input"},fe={class:"dosage-input"},ve={class:"dosage-input"},ke={class:"dosage-input"},_e=["onClick"],De={key:2,class:"content"};e("default",g(he,[["render",function(e,t,a,i,n,s){const l=m("ion-input"),r=m("ion-icon"),o=m("ion-button"),d=m("his-text-input"),c=m("ion-text"),u=m("ion-label"),h=m("ion-checkbox"),p=m("ion-item"),g=m("ion-list"),C=m("ion-infinite-scroll-content"),w=m("ion-infinite-scroll"),S=m("ion-content"),A=m("view-port"),T=m("his-keyboard"),M=m("prescription-frequency"),N=m("prescription-keypad"),O=m("ion-toolbar"),q=m("ion-footer");return y(),b(_,null,[z("div",null,[z("div",pe,[z("div",ge,[z("table",me,[ye,z("tbody",null,[(y(!0),b(_,null,D(e.checkedItems,((t,a)=>(y(),b("tr",{key:a},[z("td",be,[z("b",null,K(t.label),1)]),z("td",fe,[f(l,{readonly:"",placeholder:"Add frequency..",value:t.other.frequency},null,8,["value"])]),z("td",ve,[f(l,{readonly:"",placeholder:"Add dosage..",value:t.other.dosage},null,8,["value"])]),z("td",ke,[f(l,{readonly:"",placeholder:"Add duration..",value:t.other.duration},null,8,["value"])]),z("td",{class:"dosage-input",onClick:a=>e.unCheck(t)},[f(o,{color:"danger"},{default:v((()=>[f(r,{icon:e.trash},null,8,["icon"])])),_:1})],8,_e)])))),128))])])])]),e.switchKeyboard?(y(),I(A,{key:0,style:{"margin-top":"0px",height:"37vh"}},{default:v((()=>[f(d,{value:e.selected,onOnValue:e.onKBValue},null,8,["value","onOnValue"]),f(S,{style:{width:"100%"},class:"ion-padding-bottom"},{default:v((()=>[z("div",{class:x(["ion-content-scroll-host",{"ion-margin-bottom ion-padding-bottom":e.disableScroll}])},[f(g,{class:x(["view-port-content",{"ion-margin-bottom":e.disableScroll}])},{default:v((()=>[(y(!0),b(_,null,D(e.listData,((t,a)=>(y(),I(p,{key:a,color:t.isChecked?"lightblue":"",lines:t.isChecked?"none":void 0},{default:v((()=>[f(u,null,{default:v((()=>[f(c,{class:"his-md-text"},{default:v((()=>[k(K(t.label),1)])),_:2},1024),t.description&&t.isChecked?(y(),I(c,{key:0,color:t.description?.color},{default:v((()=>[z("p",null,[z("i",null,K(t.description.text),1)])])),_:2},1032,["color"])):$("",!0)])),_:2},1024),f(h,{slot:"start",modelValue:t.isChecked,"onUpdate:modelValue":e=>t.isChecked=e,onIonChange:a=>e.onSelect(t),disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","onIonChange","disabled"])])),_:2},1032,["color","lines"])))),128))])),_:1},8,["class"]),f(w,{onIonInfinite:t[0]||(t[0]=t=>e.pushData(t)),threshold:"100px",disabled:e.disableScroll},{default:v((()=>[f(C,{"loading-spinner":"crescent","loading-text":"Loading more data..."})])),_:1},8,["disabled"])],2)])),_:1})])),_:1})):$("",!0),e.switchKeyboard?(y(),I(T,{key:1,kbConfig:e.keyboard,onKeyPress:e.keypress},null,8,["kbConfig","onKeyPress"])):$("",!0),e.switchKeyboard?$("",!0):(y(),b("div",De,[f(M,{list:e.list,onFrequencyKeypress:t[1]||(t[1]=t=>e.label=t),onClick:t[2]||(t[2]=t=>e.frequencyKeypress())},null,8,["list"]),f(N,{onKeyPress:e.dosageKeypress,title:"Dosage",onClick:e.isComplete},null,8,["onKeyPress","onClick"]),f(N,{onKeyPress:e.durationKeypress,title:"Duration",onClick:e.isComplete},null,8,["onKeyPress","onClick"])]))]),f(q,{style:{position:"absolute",bottom:"0"}},{default:v((()=>[f(O,{color:"dark"},{default:v((()=>[f(o,{"router-link":e.cancelDestination,slot:"start",size:"large",color:"danger"},{default:v((()=>[k(" Cancel ")])),_:1},8,["router-link"]),e.switchKeyboard?(y(),I(o,{key:0,onClick:e.predefinedMalariaDrug,slot:"end",size:"large",color:"primary"},{default:v((()=>[k(" Predefined Malaria Drugs ")])),_:1},8,["onClick"])):$("",!0),e.switchKeyboard?$("",!0):(y(),I(o,{key:1,onClick:t[3]||(t[3]=t=>e.durationKeypress("Confirm")),slot:"end",size:"large",color:"success"},{default:v((()=>[k(" Add Drug ")])),_:1})),f(o,{onClick:e.clearPrescription,slot:"end",size:"large",color:"warning"},{default:v((()=>[k(" Clear ")])),_:1},8,["onClick"]),f(o,{disabled:e.disableNextBtn,onClick:e.savePrescription,slot:"end",size:"large",color:"success"},{default:v((()=>[k(" Finish ")])),_:1},8,["disabled","onClick"])])),_:1})])),_:1})],64)}],["__scopeId","data-v-c5a53854"]]))}}}));
