System.register(["./index-legacy-Ck8hVlzC.js","./hts_circumcision_service-legacy-BqcSFz9-.js","./HisStandardForm-legacy-OroqgFde.js"],(function(e,t){"use strict";var i,n,s,o,a,r,l,u,c,d,p,f,v,h,m,C;return{setters:[e=>{i=e.bk,n=e.d,s=e.I,o=e.K,a=e.dF,r=e.F,l=e.aV,u=e.dI,c=e._,d=e.r,p=e.o,f=e.c,v=e.w,h=e.b},e=>{m=e.H},e=>{C=e.H}],execute:function(){class t extends i{constructor(e,t=-1){super(e,114,t)}}const P=n({components:{IonPage:s,HisStandardForm:C},setup(){const e=new t(-1),i=o([]),n=o(!1),{visitID:s,getEncounter:c,saveEncounter:d,patientDashboardUrl:p,htsClient:f}=a({onInitVisit:()=>{i.value=[h(),{id:"comment",helpText:"Comments (Optional)",type:r.TT_NOTE,finalComputedValue:t=>t&&!/^\s*$/gi.test(`${t.value}`)?{obs:e.buildValueText("Comments",`${t.value}`)}:null}]}});function v(e){return t.getFirstValueCoded(s.value,e)}function h(){let t=!1;const i=[];return{id:"services",helpText:"Refer Client to other Services?",type:r.TT_MULTIPLE_SELECT,isRequired:()=>!0,init:async()=>{const e=f.age;if("M"===f.gender){const i=c("CIRCUMCISION");if(i)t=/no/i.test(i["Circumcision status"])&&e>14&&e<64;else if(!l().isOfflineMode.value){const i=new m(s.value),n=await i.getRecentCircumcisionStatus();t=["No"===n,e>14&&e<64].every(Boolean)}}const o=["Hepatitis B Test Result","Syphilis Test Result"],a=c("Testing");if(a)o.forEach((e=>{"Positive"===a[e]&&i.push(e)})),n.value=/positive/i.test(`${a["HIV status"]}`);else if(!l().isOfflineMode.value){for(const e of o)"Positive"===await v(e)&&i.push(e);n.value=["Positive","Positive Initial Professional"].includes(await v("HIV status"))}return!0},finalComputedValue:t=>({obs:t.map((t=>e.buildValueText("Referrals ordered",`${t.value}`)))}),onValueUpdate:(e,t)=>e.map((e=>("None"===t.value&&"None"!=e.value&&(e.isChecked=!1),"None"!=t.value&&t.isChecked&&"None"===e.value&&(e.isChecked=!1),e))),options:e=>{const s=[],o=(t,i={})=>{const n=!!e.services&&e.services.some((e=>e.value===t));return{label:t,value:t,isChecked:n,...i}};return s.push(o("STI",i.length?{description:{text:`Client tested positive for ${u(i)}. Please recommend this option if client has not started yet`}}:{})),s.push(o("TB")),"M"===f.gender&&s.push(o("VMMC",t?{description:{text:"Client is not circumcised, please recommend this option"}}:{})),s.push(o("PrEP ",n.value?{disabled:n.value,description:{text:"Client is HIV positive, cannot refer for PrEP"}}:{})),s.push(o("PEP ",n.value?{disabled:n.value,description:{text:"Client is HIV positive, cannot refer for PEP"}}:{})),s.push(o("Other")),s.push(o("None")),s},config:{footerBtns:[{name:"None",slot:"end",onClickComponentEvents:{refreshOptions:(e,t)=>t.map((e=>(e.isChecked="None"===e.label,e)))},onClick:()=>"None"}]}}}return{patientDashboardUrl:p,onFinish:function(t,i){d({encounterTypeID:e.encounterTypeID,encounterName:"REFERRAL",computedData:i})},fields:i}}});e("default",c(P,[["render",function(e,t,i,n,s,o){const a=d("his-standard-form"),r=d("ion-page");return p(),f(r,null,{default:v((()=>[h(a,{formLabel:"Referral",skipSummary:!0,fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:e.patientDashboardUrl()},null,8,["fields","onFinishAction","cancelDestinationPath"])])),_:1})}]]))}}}));
