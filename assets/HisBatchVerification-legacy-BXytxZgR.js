System.register(["./index-legacy-C29Eb2Qm.js","./ViewPort-legacy-CDi_rmkw.js","./FieldMixin.vue_vue_type_script_lang-legacy-Ctrzw-s_.js","./dynamic-import-helper-legacy-DYK5bIOV.js","./BaseTextInput-legacy-0bWTNnsr.js","./isEmpty-legacy-DuM3tHlb.js","./PopupKeyboard-legacy-BqngSQ76.js","./_Set-legacy-DwoRCLJe.js","./SIngleTouchField-legacy-BRNk_9sq.js","./TouchScreenForm-legacy-BmEuIwWy.js","./ToolbarMediumCard-legacy-CF38wqjC.js","./Transformers-legacy-DhNYVLaS.js","./HisKeypad-legacy-CPvjpCHl.js","./BaseKeyboard-legacy-BwPGWdsO.js","./KbLayouts-legacy-BKvPSxzZ.js","./KbHandler-legacy-De8o5nTq.js"],(function(e,t){"use strict";var l,i,a,n,s,u,o,r,d,c,g,h,y,f,p,b,m,_,v,T,C,D,j,k,w,I,V,q,x,N;return{setters:[e=>{l=e.d,i=e.ai,a=e.ak,n=e.aj,s=e.ao,u=e.g,o=e.h,r=e.C,d=e.bb,c=e.cZ,g=e.cm,h=e.V,y=e._,f=e.r,p=e.o,b=e.c,m=e.w,_=e.b,v=e.x,T=e.F,C=e.y,D=e.u,j=e.v,k=e.A},e=>{w=e.V},e=>{I=e._},e=>{V=e.F},e=>{q=e.default},e=>{x=e.j},e=>{N=e.P},null,null,null,null,null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent="ion-label[data-v-917dfc61]{font-weight:700}.border-right[data-v-917dfc61]{border-right:solid 1px #ccc}.scroll-list[data-v-917dfc61]{height:70vh;overflow:auto}.input_display[data-v-917dfc61]{font-size:1.3em}\n",document.head.appendChild(t);const F=l({components:{ViewPort:w,HisTextInput:q,IonGrid:i,IonCol:a,IonRow:n,IonIcon:s,IonList:u,IonItem:o,IonLabel:r,IonInput:d},mixins:[I],data:()=>({drugs:[],selectedDrug:null,chevronDown:c,previousTinCount:0,newTinCount:0}),mounted(){this.init()},activated(){this.init()},methods:{async init(){this.$emit("onFieldActivated",this),x(this.drugs)&&(this.drugs=await this.options())},disableReasonsOptions(e,t){const l=["Theft","Took out for training","Accidents","Flooding","Natural disaster"];return t.map((t=>({...t,disabled:e?t.disabled||l.includes(t.label):!l.includes(t.label)})))},fmtNumber:e=>g(e),getModalTitle(e){return`${e} (${this.drugs[this.selectedDrug].label})`},getDrugValue(e,t){return this.drugs[this.selectedDrug].other[e][t]},setDrugValue(e,t,l){this.drugs[this.selectedDrug].other[e][t]=l?l.value:""},async enterAmount(e){const t=this.getDrugValue(e,"batch_number");N({id:"tins",helpText:this.getModalTitle(`Enter number of tins for Batch ${t}`),type:V.TT_NUMBER,defaultValue:()=>(this.previousTinCount=this.getDrugValue(e,"current_quantity"),this.previousTinCount),validation:e=>!e||e&&!e.value?null:h.validateSeries([()=>h.isNumber(e),()=>e.value<0?["Number of tins must be greater than 1"]:null])},(t=>(this.newTinCount=t.value,this.setDrugValue(e,"current_quantity",t))))},async selectReason(e){const t=this.getDrugValue(e,"batch_number");N({id:"reason",helpText:this.getModalTitle(`Select reason for Batch ${t} modification`),type:V.TT_SELECT,defaultValue:()=>this.getDrugValue(e,"reason"),validation:e=>h.required(e),options:()=>this.disableReasonsOptions(this.newTinCount>this.previousTinCount,[{label:"Theft",value:"Theft"},{label:"Took out for training",value:"Took out for training"},{label:"Accidents",value:"Accidents"},{label:"Flooding",value:"Flooding"},{label:"Natural disaster",value:"Natural disaster"},{label:"Misplaced stock",value:"Misplaced stock"},{label:"Incorrect entry",value:"Incorrect entry"}])},(t=>{this.setDrugValue(e,"reason",t)}))},async selectDrug(e){this.selectedDrug=e},isBatchUpdated:e=>e.current_quantity!==e.original_quantity&&!!e.reason,isModificationComplete(){return this.drugs.every((e=>e.other?.every((e=>e.current_quantity===e.original_quantity||!!e.reason))))},getUpdatedDrugs(){const e=[];return this.drugs.forEach((t=>{const l=t.other?.filter((e=>this.isBatchUpdated(e)));e.push(...l)})),e}},watch:{clear(){this.drugs=this.drugs.map((e=>e.other?(e.other=e.other.map((e=>(e.current_quantity=e.original_quantity,e))),e):e))},drugs:{async handler(){if(this.isModificationComplete())return this.$emit("onValue",this.getUpdatedDrugs());this.$emit("onValue",null)},immediate:!0,deep:!0}}});e("default",y(F,[["render",function(e,t,l,i,a,n){const s=f("his-text-input"),u=f("ion-item"),o=f("ion-list"),r=f("ion-col"),d=f("ion-label"),c=f("ion-input"),g=f("ion-icon"),h=f("ion-row"),y=f("ion-grid"),w=f("view-port");return p(),b(w,null,{default:m((()=>[_(s,{readonly:"",value:e.drugs[e.selectedDrug]?.label||""},null,8,["value"]),_(y,{style:{background:"white"}},{default:m((()=>[_(h,null,{default:m((()=>[_(r,{size:"4",class:"border-right scroll-list"},{default:m((()=>[(p(!0),v(T,null,C(e.drugs,((t,l)=>(p(),b(o,{key:l},{default:m((()=>[_(u,{detail:"",color:l===e.selectedDrug?"lightblue":"",onClick:t=>e.selectDrug(l)},{default:m((()=>[D(j(t.label),1)])),_:2},1032,["color","onClick"])])),_:2},1024)))),128))])),_:1}),_(r,{size:"8",class:"scroll-list"},{default:m((()=>[(p(!0),v(T,null,C(e.drugs[e.selectedDrug]?.other||[],((t,l)=>(p(),b(h,{key:l},{default:m((()=>[_(r,{size:"12"},{default:m((()=>[k("h4",null,"Batch Number: "+j(t.batch_number)+" ("+j(t.pack_size)+"/tin) ",1)])),_:2},1024),_(r,{"size-md":"4"},{default:m((()=>[_(u,null,{default:m((()=>[_(d,{position:"floating"},{default:m((()=>[D("Available Tins")])),_:1}),_(c,{readonly:"",placeholder:"0",value:e.fmtNumber(t.original_quantity)},null,8,["value"])])),_:2},1024)])),_:2},1024),_(r,{"size-md":"4"},{default:m((()=>[_(u,null,{default:m((()=>[_(d,{position:"floating"},{default:m((()=>[D("Verified Tins")])),_:1}),_(c,{readonly:"",placeholder:"0",value:e.fmtNumber(t.current_quantity),color:t.current_quantity!=t.original_quantity?"danger":"success",onClick:t=>e.enterAmount(l)},null,8,["value","color","onClick"])])),_:2},1024)])),_:2},1024),_(r,{"size-md":"4"},{default:m((()=>[_(u,null,{default:m((()=>[_(d,{position:"floating"},{default:m((()=>[D("Reason")])),_:1}),_(c,{disabled:t.current_quantity==t.original_quantity,placeholder:"0",value:t.reason??"N/A",onClick:t=>e.selectReason(l)},null,8,["disabled","value","onClick"]),_(g,{icon:e.chevronDown,slot:"end",class:"ion-padding-top",onClick:t=>e.selectReason(l)},null,8,["icon","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-917dfc61"]]))}}}));
