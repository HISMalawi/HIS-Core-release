import{d as O,bm as B,ap as L,ar as R,aq as j,D as z,g as T,h as A,cP as F,e as G,cK as P,a$ as C,_ as q,r as i,o as l,c as u,w as o,b as n,x as m,B as g,y as D,u as k,v,z as E,a6 as H,a7 as K,A as U}from"./index-DsVZSn5I.js";import{_ as y}from"./FieldMixin.vue_vue_type_script_lang-CGAzuKk0.js";const J=O({mixins:[y],components:{ViewPort:B,IonGrid:L,IonCol:R,IonRow:j,IonLabel:z,IonList:T,IonItem:A,IonRadio:F,IonCheckbox:G,IonRadioGroup:P},data:()=>({whitelist:[],testData:{},focusedTestName:""}),watch:{testData:{handler(e){const t=Object.keys(e).reduce((s,c)=>{const d=this.testData[c];return d.isChecked&&this.isSelectionComplete(c)&&s.push({label:c,value:d.specimen.name,other:{reason:"Routine",accessionNumber:null,concept_id:d.testConcept,specimenConcept:d.specimen.concept_id}}),s},[]);this.$emit("onValue",t.length?t:null)},deep:!0}},computed:{testTypeOptions(){const e=this.whitelist.map(s=>s.value),t=Object.keys(this.testData);return e.length?t.filter(s=>e.includes(s)):t}},methods:{async init(){this.$emit("onFieldActivated",this),typeof this.options=="function"&&(this.whitelist=await this.options(this.fdata)),Object.keys(this.testData).length||C.getTestTypes().then(e=>{this.testData=e.reduce((t,s)=>(t[s.name]={testConcept:s.concept_id,isChecked:!1,specimens:[],reason:"",specimen:""},t),{})})},isSelectionComplete(e){return e&&this.testData[e].isChecked?this.testData[e].specimen:!0},selectTest(e,t){var s;this.testData[t].isChecked=e.detail.checked,e.detail.checked?(this.focusedTestName=t,(s=this.testData[t])!=null&&s.specimens.length||C.getSpecimens(t).then(c=>this.testData[t].specimens=c)):(this.testData[t]={...this.testData[t],isChecked:!1,specimen:""},this.focusedTestName="")}},mounted(){this.init()},activated(){this.init()}}),M=e=>(H("data-v-29f67c87"),e=e(),K(),e),Q={key:0},W=M(()=>U("h3",{class:"title"},"Select specimen",-1));function X(e,t,s,c,d,Y){const b=i("ion-checkbox"),h=i("ion-label"),p=i("ion-item"),_=i("ion-list"),f=i("ion-col"),I=i("ion-radio"),w=i("ion-radio-group"),N=i("ion-row"),S=i("ion-grid"),V=i("view-port");return l(),u(V,null,{default:o(()=>[n(S,{class:"view-port-content"},{default:o(()=>[n(N,null,{default:o(()=>[n(f,{class:"mx-height",size:"5"},{default:o(()=>[n(_,null,{default:o(()=>[(l(!0),m(g,null,D(e.testTypeOptions,(a,r)=>(l(),u(p,{key:r,class:"his-sm-text"},{default:o(()=>[n(b,{onIonChange:$=>e.selectTest($,a),disabled:!e.isSelectionComplete(e.focusedTestName)&&e.focusedTestName!=a,color:e.isSelectionComplete(a)?"success":"danger",value:e.testData[a].isChecked,slot:"start"},null,8,["onIonChange","disabled","color","value"]),n(h,{color:e.isSelectionComplete(a)?"":"danger"},{default:o(()=>[k(v(a),1)]),_:2},1032,["color"])]),_:2},1024))),128))]),_:1})]),_:1}),n(f,{class:"border-right mx-height",size:"7"},{default:o(()=>[e.focusedTestName?(l(),m("div",Q,[W,n(_,null,{default:o(()=>[n(w,{modelValue:e.testData[e.focusedTestName].specimen,"onUpdate:modelValue":t[0]||(t[0]=a=>e.testData[e.focusedTestName].specimen=a)},{default:o(()=>[(l(!0),m(g,null,D(e.testData[e.focusedTestName].specimens,(a,r)=>(l(),u(p,{key:r,class:"his-sm-text"},{default:o(()=>[n(I,{value:a,slot:"start"},null,8,["value"]),n(h,null,{default:o(()=>[k(v(a.name),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})])):E("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}const ee=q(J,[["render",X],["__scopeId","data-v-29f67c87"]]);export{ee as default};
