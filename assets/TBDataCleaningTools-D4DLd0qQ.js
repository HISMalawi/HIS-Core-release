import{T as l}from"./tb_report_service-B_N3sPGu.js";import{_ as c}from"./ReportMixin.vue_vue_type_script_lang-B8Yefvtn.js";import{R as _}from"./TableReportTemplate-BpS_AT45.js";import{d as N,f as R,av as e,aX as m,aP as u,S as p,H as w,af as E,c as f,w as I,ak as T,a as D,b as O}from"./index-DUHy09-D.js";import"./BasicReportTemplate-DjXp5lQY.js";import"./Export-Mg5mHyUQ.js";import"./index-h-mcwuuY.js";import"./Pagination-D0_y9e6I.js";import"./HisStandardForm-D4x6GRNw.js";import"./ReportErrors-C9-RQZ0w.js";var o=(t=>(t.WITHOUT_PROGRAM="WITHOUT PROGRAM",t.WITHOUT_TB_NUMBER="WITHOUT TB NUMBER",t.BAD_TB_NUMBER="BAD TB NUMBER",t.IN_TREATMENT_BUT_COMPLETED="IN TREATMENT BUT COMPLETED",t.WITH_DISPENSATION_ANOMALIES="WITH DISPENSATION ANOMALIES",t.WITH_UNKNOWN_OUTCOME="WITH UNKNOWN OUTCOME",t.WITH_DUPLICATE_TB_NUMBER="WITH DUPLICATE TB NUMBER",t))(o||{});class U extends l{constructor(){super()}getDataToolReport(a){return l.getJson("tb_data_cleaning_tools",this.buildRequestParams({context:a}))}}const A=N({mixins:[c],components:{ReportTemplate:_,IonPage:R},data:()=>({title:"Data cleaning report",rows:[],columns:[[e.thTxt("National ID"),e.thTxt("TB Number"),e.thTxt("Name"),e.thTxt("Gender"),e.thTxt("Birthdate"),e.thTxt("Residence"),e.thTxt("State")]],defaultIndicator:{}}),created(){this.fields=[...m({id:"start_date",helpText:"Start",required:!0,minDate:()=>"2000-01-01",maxDate:()=>p.getSessionDate(),computeValue:t=>t,estimation:{allowUnknown:!1}}),...m({id:"end_date",helpText:"End",required:!0,minDate:()=>"2000-01-01",maxDate:()=>p.getSessionDate(),computeValue:t=>t,estimation:{allowUnknown:!1}})],this.defaultIndicator=u.find(this.getIndicatorOptions(),{label:this.$route.query.case})||null},methods:{async onPeriod(t,a){const n=i=>w.toStandardHisDisplayFormat(i);this.rows=[];const s=this.defaultIndicator;this.title=s.label,this.columns=s.other.columns,this.report=new U,this.report.setStartDate(a.start_date),this.report.setEndDate(a.end_date),this.period="".concat(n(a.start_date)," - ").concat(n(a.end_date));const r=await this.report.getDataToolReport(s.value);console.log(s,r),u.isNull(r)||(this.rows=await Promise.all(r.map(i=>s.other.formatRow(i))))},mapRow(t){return[e.td(t.identifier||"N/A"),e.td(t.tb_number||"N/A"),e.tdLink(t.name,()=>this.$router.push({path:"/patient/dashboard/".concat(t.patient_id)})),e.td(t.gender||"N/A"),e.td(t.birthdate||"N/A"),e.td(t.residence||"N/A"),e.td(t.state||"N/A")]},getIndicatorOptions(){return[{label:"without program",value:o.WITHOUT_PROGRAM,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"with duplicate tb number",value:o.WITH_DUPLICATE_TB_NUMBER,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"with unknown outcome",value:o.WITH_UNKNOWN_OUTCOME,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"with dispensation anomalies",value:o.WITH_DISPENSATION_ANOMALIES,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"in treatment but completed",value:o.IN_TREATMENT_BUT_COMPLETED,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"bad tb number",value:o.BAD_TB_NUMBER,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"without tb number",value:o.WITHOUT_TB_NUMBER,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}}]}}});function b(t,a,n,s,r,i){const d=T("report-template"),h=T("ion-page");return D(),f(h,null,{default:I(()=>[O(d,{title:t.title,period:t.period,rows:t.rows,fields:t.fields,columns:t.columns,showFilters:!0,onReportConfiguration:t.onPeriod},null,8,["title","period","rows","fields","columns","onReportConfiguration"])]),_:1})}const L=E(A,[["render",b]]);export{L as default};
