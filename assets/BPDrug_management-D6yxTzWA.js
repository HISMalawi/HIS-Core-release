import{d as j,bk as z,i as A,j as V,l as K,ap as L,f as M,aq as J,m as R,I as X,e as Z,F as q,aO as U,ae as D,t as W,O as Y,bL as G,_ as Q,r as d,o as s,c as y,w as n,b as a,x as i,A as o,B as p,y as h,u as m,v as C,z as w,a6 as x,a7 as ee}from"./index-C234CYGF.js";import{_ as te}from"./EncounterMixin.vue_vue_type_script_lang-BoMgPPpX.js";import{B as H,H as I}from"./htn_service-CdoPxQ_G.js";import"./encounter_guidelines-CCe6tBQD.js";import"./GuidelineEngine-D6V1_Znr.js";import"./HisStandardForm-BltiJhPp.js";const se=j({mixins:[te],components:{ViewPort:z,IonToolbar:A,IonHeader:V,IonContent:K,IonRow:L,IonButton:M,IonCol:J,IonFooter:R,IonPage:X,IonCheckbox:Z},watch:{ready:{async handler(e){if(e){this.HTN=new H(this.patientID,this.providerID),this.drugs=this.HTN.getDrugs();const{drugs:t,notes:r}=await this.HTN.getCurrentDrugs();this.setPreviousBpDrugs(t),this.setPreviousBpNotes(r),this.canClearHtnSessionPrescription=this.patientHasHtnSessionKey()}},immediate:!0}},data:()=>({HTN:{},drugs:null,canClearHtnSessionPrescription:!1}),methods:{clearPrescriptionInSession(){sessionStorage.removeItem(I.Prescription),this.canClearHtnSessionPrescription=!1},patientHasHtnSessionKey(){try{const e=sessionStorage.getItem(I.Prescription);if(e)return JSON.parse(e)[this.patientID]}catch(e){console.warn(e)}return!1},removeNote(e,t){this.drugs[e].notes.splice(t,1)},launchNotePad(e){this.showModal({id:"note",helpText:"Add notes for ".concat(e),type:q.TT_TEXT},t=>{t&&this.drugs[e].notes.push({date:U.getSessionDate(),description:t.value||"",drugID:this.drugs[e].drugs[0].drugID,isNewNote:!0})})},async onFinish(){const e=Object.values(this.drugs).filter(t=>!D.isEmpty(t.notes)).map(t=>t.notes).reduce((t,r)=>t.concat(r),[]).filter(t=>t.isNewNote).map(t=>this.HTN.buildObs("Clinician notes",{value_text:t.description,value_drug:t.drugID}));if(!D.isEmpty(e))try{await this.HTN.createEncounter(),await this.HTN.saveObservationList(await Promise.all(e))}catch(t){return W("Unable to save notes ".concat(t))}this.gotoTreatment()},gotoTreatment(){const e=this.selectedDrugs.map(r=>D.find(H.htnDrugReferences(),{drug_id:r.drugID})),t={};t[this.patientID]=e,sessionStorage.setItem(I.Prescription,JSON.stringify(t)),this.$router.push("/art/encounters/prescriptions/".concat(this.patientID))},async showModal(e,t){(await Y.create({component:G,backdropDismiss:!1,cssClass:"full-modal",componentProps:{dismissType:"modal",currentField:e,onFinish:t}})).present()},setPreviousBpNotes(e){for(const t in e)this.drugs[t].notes=Object.keys(e[t]).map(r=>e[t][r].map(g=>({date:r,description:g,isNewNote:!1}))).reduce((r,g)=>r.concat(g),[])},setPreviousBpDrugs(e){e.forEach(t=>{for(const r in this.drugs)this.drugs[r].drugs.forEach((g,k)=>{t.drug_id===g.drugID&&(this.drugs[r].drugs[k].current=!0,this.drugs[r].drugs[k].selected=!0,this.drugs[r].selected=t.drug_id)})})},selectDrug(e,t,r){this.drugs[e].drugs.forEach((g,k)=>{this.drugs[e].drugs[k].selected=!1}),this.drugs[e].drugs[t].selected=r.detail.checked}},computed:{selectedDrugs(){return this.drugs?Object.values(this.drugs).map(e=>e.drugs).reduce((e,t)=>e.concat(t),[]).filter(e=>e.selected):[]}}}),f=e=>(x("data-v-cb76923f"),e=e(),ee(),e),oe=f(()=>o("label",{class:"his-title"}," Prescribe BP drugs ",-1)),ne={key:0,class:"view-port-content"},re={id:"main-table",style:{width:"100%"}},ae=f(()=>o("th",null," ",-1)),ie=f(()=>o("td",{class:"td-remaining td-title"},[o("span",null,"New/Current")],-1)),le=f(()=>o("td",{class:"td-remaining td-title"},[o("span",null," ")],-1)),de=f(()=>o("p",null,null,-1)),ue={id:"table-notes",style:{width:"100%"}},ce=f(()=>o("caption",{style:{"font-size":"1.2em"}}," Notes ",-1)),pe=f(()=>o("p",null,null,-1)),he={class:"table-inner-notes",id:"notes-HCZ"},ge={class:"date-td today-td"},_e={class:"date-td today-td"};function me(e,t,r,g,k,fe){const N=d("ion-col"),v=d("ion-row"),P=d("ion-toolbar"),T=d("ion-header"),B=d("ion-checkbox"),b=d("ion-button"),O=d("view-port"),E=d("ion-content"),$=d("ion-footer"),F=d("ion-page");return s(),y(F,null,{default:n(()=>[a(T,null,{default:n(()=>[a(P,null,{default:n(()=>[a(v,null,{default:n(()=>[a(N,null,{default:n(()=>[oe]),_:1})]),_:1})]),_:1})]),_:1}),a(E,null,{default:n(()=>[a(O,null,{default:n(()=>[e.drugs?(s(),i("div",ne,[o("table",re,[o("tr",null,[ae,(s(!0),i(p,null,h(e.drugs,(u,l)=>(s(),i("th",{key:l},[m(C(l)+" ",1),a(v,null,{default:n(()=>[(s(!0),i(p,null,h(u.drugs,(c,_)=>(s(),y(N,{class:"col-borders",key:_},{default:n(()=>[m(C(c.amount||"0mg"),1)]),_:2},1024))),128))]),_:2},1024)]))),128))]),o("tr",null,[ie,(s(!0),i(p,null,h(e.drugs,(u,l)=>(s(),i("td",{key:l,class:"td-current td-value"},[a(v,null,{default:n(()=>[(s(!0),i(p,null,h(u.drugs,(c,_)=>(s(),y(N,{key:_},{default:n(()=>[a(B,{checked:c.selected,onIonChange:S=>e.selectDrug(l,_,S)},null,8,["checked","onIonChange"])]),_:2},1024))),128))]),_:2},1024)]))),128))]),o("tr",null,[le,(s(!0),i(p,null,h(Object.keys(e.drugs),(u,l)=>(s(),i("td",{class:"td-remaining td-value",key:l},[a(v,null,{default:n(()=>[a(N,null,{default:n(()=>[a(b,{onClick:c=>e.launchNotePad(u),color:"warning"},{default:n(()=>[m(" Add notes ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]),de,o("table",ue,[ce,pe,o("tr",null,[(s(!0),i(p,null,h(e.drugs,(u,l)=>(s(),i("th",{style:{width:"25%"},key:l},[o("span",null,C(l),1)]))),128))]),o("tr",null,[(s(!0),i(p,null,h(Object.keys(e.drugs),(u,l)=>(s(),i("td",{id:"HCZ",style:{"padding-top":"2px !important"},valign:"top",key:l},[o("table",he,[(s(!0),i(p,null,h(e.drugs[u].notes,(c,_)=>(s(),i("tr",{key:_},[o("td",ge,C(c.date),1),o("td",_e,C(c.description),1),o("td",null,[c.isNewNote?(s(),y(b,{key:0,color:"danger",onClick:S=>e.removeNote(u,_)},{default:n(()=>[m(" X ")]),_:2},1032,["onClick"])):w("",!0)])]))),128))])]))),128))])])])):w("",!0)]),_:1})]),_:1}),a($,null,{default:n(()=>[a(P,{color:"dark"},{default:n(()=>[a(b,{size:"large",color:"danger",slot:"start",onClick:e.gotoPatientDashboard},{default:n(()=>[m(" cancel ")]),_:1},8,["onClick"]),e.canClearHtnSessionPrescription?(s(),y(b,{key:0,size:"large",color:"warning",slot:"end",onClick:e.clearPrescriptionInSession},{default:n(()=>[m(" Clear Session Prescription ")]),_:1},8,["onClick"])):w("",!0),e.selectedDrugs&&e.selectedDrugs.length>0?(s(),y(b,{key:1,size:"large",color:"success",slot:"end",onClick:e.onFinish},{default:n(()=>[m(" Continue ")]),_:1},8,["onClick"])):w("",!0)]),_:1})]),_:1})]),_:1})}const we=Q(se,[["render",me],["__scopeId","data-v-cb76923f"]]);export{we as default};
