import{d as A,I as $,cg as x,K as b,N as B,ac as E,t as I,n as k,ae as P,cv as q,O as c,q as N,cw as O,cx as S,_ as j,r as F,o as U,c as L,w as G,b as R}from"./index-C-Wf7IuL.js";import{D as V}from"./ReportDateSelectionPrompt-CrlqSABS.js";import{T as K}from"./tx_report_service-Daw1l1kJ.js";import{v as W}from"./TableView-D3Avejt1.js";import{A as M}from"./ArtDrilldown-CPxJ_UjE.js";import"./Export-DKDjU6pH.js";const X=A({components:{IonPage:$,IonLoading:x,v2Datatable:W},setup(){const e=b([]),m=b(""),f=b(!1),u=b([]),o=new K;function r(d,p){return{ref:p,label:d,toValue:t=>t.length,tdClick:async t=>{t.refData.length&&(await c.create({component:M,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"".concat(t.data.age_group," ").concat(t.data.gender," ").concat(t.column.label),patientIdentifiers:t.refData,onFinish:()=>c.getTop().then(i=>i&&c.dismiss())}})).present()}}}const D=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},r("CD4 <200","cd4_less_than_200"),r("CD4 >=200","cd4_greater_than_or_equal_to_200"),r("Unknown CD4","unknown_cd4_count"),r("Not Eligible for CD4","not_eligible_for_cd4"),r("Returned <3 mo","returned_less_than_3_months"),r("Returned 3-5 mo","returned_greater_than_3_months_and_less_than_6_months"),r("Returned 6+ mo","returned_greater_than_or_equal_to_6_months")]],_=async(d=!1)=>{o.startDate&&o.endDate||I("Start date and end date required!");const p=d&&await k("Do you want to rebuild report?");f.value=!0;try{const t=await o.getTxRttReport(p),i={F:"Female",M:"Male"},s=t.reduce((n,a)=>(a.age_group!="Unknown"&&(n[a.gender].rows.push({...a,gender:i[a.gender]}),n[a.gender].aggregate=Object.keys(a).reduce((g,l)=>Array.isArray(a[l])?{...g,[l]:[...g[l]||[],...a[l]]}:g,n[a.gender].aggregate)),n),{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...s.F.rows,...s.M.rows,{age_group:"All",gender:"Male",...s.M.aggregate}];const C=Object.values(s.F.aggregate).flat(1),v=await o.getMaternalStatus(P.uniq(C)),T=v.FBf.concat(v.FP);["FP","FNP","FBf"].forEach(n=>{e.value.push(Object.keys(s.F.aggregate).reduce((a,g)=>({...a,[g]:s.F.aggregate[g].filter(l=>n==="FNP"?!T.includes(l):v[n].includes(l))}),{age_group:"All",gender:n}))}),e.value=e.value.map((n,a)=>({index:a+1,...n}));const y=Object.values(s.M.aggregate).flat(1),w=P.uniq([...C,...y]);u.value=[{id:"stats",text:"Total <b>".concat(w.length,"</b>"),icon:q,color:"primary",action:async()=>{(await c.create({component:M,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"Total Clients",subtitle:m.value,patientIdentifiers:w,onFinish:()=>c.getTop().then(n=>n&&c.dismiss())}})).present()}}]}catch(t){console.error(t),N("Unable to generate report!"),u.value=[{text:"Unable to generate report!",color:"danger",icon:O,action:function(){u.value=[{text:"Exception occured: <b>".concat(t,"</b>"),color:"danger",icon:S}]}}]}f.value=!1},h=()=>V({onFinish:(d,p,t,i)=>{m.value=t,o.startDate=d,o.endDate=p,i&&o.setOccupation(i),_()}});return B(()=>h()),{headerBadge:u,reportData:e,isLoading:f,Img:E,configure:h,generate:_,columns:D,period:m}}});function z(e,m,f,u,o,r){const D=F("ion-loading"),_=F("v2Datatable"),h=F("ion-page");return U(),L(h,null,{default:G(()=>[R(D,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),R(_,{title:"TX RTT Report","report-prefix":"Pepfar","icon-url":e.Img("login-logos/PEPFAR.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,headerBadge:e.headerBadge,onConfigure:e.configure,onRefresh:()=>e.generate(!0)},null,8,["icon-url","subtitle","columns","columnData","headerBadge","onConfigure","onRefresh"])]),_:1})}const te=j(X,[["render",z]]);export{te as default};
