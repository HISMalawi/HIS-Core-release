import{H as C}from"./HisStandardForm-BhUAZgIK.js";import{bd as c,aY as y,d as E,K as d,a_ as x,F as p,V as L,ae as m,o as P,c as F,w as N,b as V,cz as g,I as O,S as M,n as I}from"./index-BBbw6-oc.js";import{u as k}from"./useEncounter-B6CriU5f.js";import{a as R,r as f}from"./commons-Br6psXCt.js";import"./isEmpty-Xznx3aXJ.js";import"./_Set-CtJlLato.js";import"./_setToArray-wJUAXAuD.js";import"./encounter_guidelines-DqZrhpay.js";import"./GuidelineEngine-D6V1_Znr.js";class _ extends c{constructor(t,i){super(t,41,i)}static async getDiagnosis(t="",i=1,n=10){const o=y.getConceptID("Qech outpatient diagnosis list");return c.getJson("diagnosis",{id:o,name:t,page:i,page_size:n})}}class $ extends c{constructor(t,i){super(t,105,i)}}const Q=E({__name:"Diagnosis",setup(l){let t,i;const n=d("No"),o=d([]),{goToNextTask:v,patientDashboardUrl:S}=k((a,e)=>{x.getLatestMalariaTestResult(e).then(s=>n.value=s),t=new $(e,a),i=new _(e,a),o.value=[u("Primary"),u("Secondary"),b()]});async function T(a,e){await i.createEncounter();const s=await f({...e,obs_datetime:M.getSessionDate()},"diagnosis");await i.saveObservationList(s);const r=await f({...e},"notes");m.isEmpty(r)||(await t.createEncounter(),await t.saveObservationList(r)),v()}async function w(a){return a.some(({label:s})=>/Malaria/i.test(s))?n.value==="Positive"?!0:await I("Patient has ".concat(n.value," malaria test result. Do you want to continue?")):!0}function u(a){return{id:"".concat(a.toLowerCase(),"_diagnosis"),helpText:"".concat(a," Diagnosis"),type:p.TT_INFINITE_SCROLL_MULTIPLE_SELECT,validation:e=>a==="Primary"?L.required(e):null,options:async(e,s="",r=1,D=10)=>{const h=await _.getDiagnosis(s,r,D);return R(h,"name","concept_id")},beforeNext:async e=>await w(e),computedValue:e=>({tag:"diagnosis",obs:e.map(({value:s})=>i.buildValueCoded("".concat(a," Diagnosis"),s))}),config:{isFilterDataViaApi:!0,showKeyboard:!0}}}function b(){return{id:"clinical_notes",helpText:"Clinical notes",type:p.TT_TEXT,computedValue:a=>m.isEmpty(a)?null:{tag:"notes",obs:t.buildValueText("Clinical notes construct",a.value)}}}return(a,e)=>(P(),F(g(O),null,{default:N(()=>[V(C,{cancelDestinationPath:g(S),fields:o.value,onFinishAction:T},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{Q as default};
