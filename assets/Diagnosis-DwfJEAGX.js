import{H as h}from"./HisStandardForm-B3LOSMqB.js";import{P as n}from"./patient_diagnosis_service-y6YKcmod.js";import{bW as v,d as w,r,an as E,ao as l,a_ as c,a as L,f as C,aw as D,b as F,S as x}from"./index-qFt4YszW.js";import{u as V}from"./useEncounter-Bj5eamVf.js";import{u as I}from"./useLabResultsManager-C1yuzl99.js";import{r as g}from"./commons-B4jZtVaM.js";import"./isEmpty-1LErKKNT.js";import"./encounter_guidelines-CLmFwnI6.js";import"./GuidelineEngine-D6V1_Znr.js";import"./lab_order_service-EUN9C6_8.js";class P extends v{constructor(s,i){super(s,105,i)}}const q=w({__name:"Diagnosis",setup(y){let s,i;const u=r("No"),d=r([]),m=r(Math.random()),{patientDashboardUrl:b,goToNextTask:_}=V(async(a,e)=>{s=new P(e,a),i=new n(e,a);const{getLabFields:t}=I(e,a,m);d.value=[...t(!0),...S()]});async function T(a,e){await i.createEncounter();const t=await g({...e,obs_datetime:x.getSessionDate()},"diagnosis");await i.saveObservationList(t);const o=await g({...e},"notes");c.isEmpty(o)||(await s.createEncounter(),await s.saveObservationList(o)),_()}function p(a){return c.isEmpty(a)?[]:a.map(e=>({label:e.name,value:e.name,other:e.concept_id,isChecked:!1})).sort((e,t)=>e.label<t.label?-1:e.label>t.label?1:0)}async function f(a){return a.find(t=>t.label==="Malaria")?u.value==="Positive"?!0:await D("Patient has ".concat(u.value," malaria test result. Do you want to continue?")):!0}function S(){return[{id:"primary_diagnosis",helpText:"Select primary diagnosis",type:l.TT_INFINITE_SCROLL_MULTIPLE_SELECT,validation:a=>E.required(a),options:async(a,e="",t=1,o=10)=>p(await n.getDiagnosis(e,t,o)),beforeNext:async a=>await f(a),computedValue:a=>({tag:"diagnosis",obs:a.map(({other:e})=>i.buildValueCodedFromConceptId("Primary diagnosis",e))}),summaryMapValue:({value:a})=>({value:a,label:"Primary diagnosis"}),config:{isFilterDataViaApi:!0,showKeyboard:!0}},{id:"secondary_diagnosis",helpText:"Select secondary diagnosis",type:l.TT_INFINITE_SCROLL_MULTIPLE_SELECT,options:async(a,e="",t=1,o=10)=>p(await n.getDiagnosis(e,t,o)),beforeNext:async a=>await f(a),computedValue:a=>!c.isEmpty(a)&&{tag:"diagnosis",obs:a.map(({other:e})=>i.buildValueCodedFromConceptId("Secondary diagnosis",e))},summaryMapValue:({value:a})=>({value:a,label:"Secondary diagnosis"}),config:{showKeyboard:!0,isFilterDataViaApi:!0}},{id:"clinical_notes",helpText:"Clinical notes",type:l.TT_TEXT,computedValue:a=>a&&{tag:"notes",obs:s.buildValueText("Clinical notes construct",a.value)}}]}return(a,e)=>(F(),L(h,{key:m.value,cancelDestinationPath:C(b),fields:d.value,onFinishAction:T},null,8,["cancelDestinationPath","fields"]))}});export{q as default};
