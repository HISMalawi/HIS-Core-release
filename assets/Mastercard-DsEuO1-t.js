import{d as w,dz as F,ak as C,h as g,e as o,w as u,ap as i,a9 as S,aa as O,b as m,a as P,a6 as B,g as v,t as T,z as R,j as D,ay as a,cw as H,I as E,aw as G,n as M,ba as L,bd as A,bn as p,ct as $,dA as N,aB as U,bQ as j,aZ as q,H as V,at as K,K as W,y as x,au as z}from"./index-BCOAvIf2.js";import{P as Y}from"./Pagination-GuhX970n.js";const Q=w({name:"InformationHeader",components:{MultiColumnView:F},props:{icon:{required:!1},items:{type:Object,required:!0},numberOfColumns:{type:Number,default:2}},emits:["update","updateARVNumber","addGuardian"],setup(e,{emit:t}){return{onClick:s=>s.other.category==="demographics"?t("update",s.other.attribute):s.other.category==="arv_number"?t("updateARVNumber"):t("addGuardian")}}}),Z={style:{padding:".1rem"}},J={style:{width:"100%",display:"flex",justifyContent:"space-between",fontSize:"12px",margin:0,padding:0}},X=["onClick"],ee=["innerHTML"];function te(e,t,n,s,h,f){const b=i("ion-item"),d=i("ion-list"),l=i("multi-column-view");return m(),g("div",Z,[o(l,{items:e.items,numberOfColumns:e.numberOfColumns},{default:u(({entries:c})=>[o(d,null,{default:u(()=>[(m(!0),g(S,null,O(c,r=>(m(),g("span",{key:r.label},[typeof r.visible!="boolean"||r.visible?(m(),P(b,{key:0,style:{padding:"0 !important",margin:"0 !important"}},{default:u(()=>[v("div",J,[v("span",null,T(r.label)+": ",1),r.other&&r.other.editable?(m(),g("span",{key:0,onClick:_=>e.onClick(r)},[v("a",null,[v("b",null,T(r.value),1)])],8,X)):(m(),g("b",{key:1,innerHTML:r.value||"N/A"},null,8,ee))])]),_:2},1024)):B("",!0)]))),128))]),_:2},1024)]),_:1},8,["items","numberOfColumns"])])}const k=C(Q,[["render",te],["__scopeId","data-v-3e4c09f5"]]),ae=w({components:{InformationHeader:k},props:{title:{type:String,required:!0},visitData:{type:Object,required:!0}},methods:{async closeModal(){await R.dismiss({})}}});function ie(e,t,n,s,h,f){const b=i("ion-title"),d=i("ion-toolbar"),l=i("ion-header"),c=i("information-header"),r=i("ion-content"),_=i("ion-button"),y=i("ion-footer");return m(),g(S,null,[o(l,null,{default:u(()=>[o(d,null,{default:u(()=>[o(b,null,{default:u(()=>[D(T(e.title),1)]),_:1})]),_:1})]),_:1}),o(r,null,{default:u(()=>[o(c,{items:e.visitData},null,8,["items"])]),_:1}),o(y,null,{default:u(()=>[o(d,null,{default:u(()=>[o(_,{onClick:e.closeModal,slot:"end"},{default:u(()=>[...t[0]||(t[0]=[D(" Close ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const ne=C(ae,[["render",ie]]),se=w({components:{Preloader:L,Pagination:Y,IonPage:M,ReportTable:G,IonContent:E,HisFooter:H,InformationHeader:k},data:()=>({patientId:0,patient:{},patientCardInfo:[],btns:[],itemsPerPage:10,currentPage:0,totalPages:0,pages:[],visitDates:[],tbStats:[],visitDatesInitialised:!1,columns:[[a.thTxt("VISIT DATE"),a.thTxt("WEIGHT (Kg)"),a.thTxt("REG"),a.thTxt("VIRAL LOAD"),a.thTxt("TB STATUS"),a.thTxt("OUTCOME"),a.thTxt("PILLS DISPENSED"),a.thTxt("ACTIONS")]],rows:[]}),created(){this.setPatientCards(),this.patientId=parseInt("".concat(this.$route.params.patient_id)),K.getPatientVisits(this.patientId,!0).then(e=>{this.visitDatesInitialised=!0,this.visitDates=e,this.rows=e.map(t=>[a.tdBtn(V.toStandardHisDisplayFormat(t),()=>W(this.patientId,t)),a.td("..."),a.td("..."),a.td("..."),a.td("..."),a.td("..."),a.td("..."),a.td("...")])}).catch(e=>{this.visitDatesInitialised=!0,x("".concat(e)),console.error(e)}),this.btns.push({name:"Finish",color:"success",size:"large",slot:"end",visible:!0,onClick:()=>{z("Are you sure you want to exit?").then(e=>{if(e)return this.$router.push("/patient/dashboard/".concat(this.patientId))})}})},async mounted(){if(this.patientId)for(const e of this.patientCardInfo)typeof e.init=="function"&&await e.init(),typeof e.condition=="function"?e.visible=e.condition():e.visible=!0,typeof e.asyncValue=="function"?e.asyncValue(e).then(t=>e.value=t||""):typeof e.staticValue=="function"&&(e.value=e.staticValue())},methods:{setPatientCards(){this.patientCardInfo=[{label:"ARV Number",value:"...",staticValue:()=>this.patient.getArvNumber(),init:async()=>{this.patient=await U.get("ACTIVE_PATIENT",{patientID:this.patientId})},other:{editable:!0,category:"arv_number"}},{label:"National Patient ID",value:"...",staticValue:()=>this.patient.getNationalID()},{label:"Given Name",value:"...",staticValue:()=>this.patient.getGivenName(),other:{editable:!0,attribute:"given_name",category:"demographics"}},{label:"Family Name",value:"...",staticValue:()=>this.patient.getFamilyName(),other:{editable:!0,attribute:"family_name",category:"demographics"}},{label:"Age",value:"...",staticValue:()=>this.patient.getAge(),other:{editable:!0,attribute:"year_birth_date",category:"demographics"}},{label:"Sex",value:"...",staticValue:()=>this.patient.getGender(),other:{editable:!0,attribute:"gender",category:"demographics"}},{label:"Location",value:"...",staticValue:()=>this.patient.getCurrentVillage(),other:{editable:!0,attribute:"home_region",category:"demographics"}},{label:"Landmark",value:"...",staticValue:()=>this.patient.getAttribute(19)},{label:"Guardian",value:"...",asyncValue:async e=>{const t=await j.getGuardianDetails(this.patientId);return q.isEmpty(t)?(e.other.editable=!0,"add"):t.map(n=>" ".concat(n.name," (").concat(n.relationshipType,")")).join(" ")},other:{editable:!1,attribute:"",category:"guardian"}},{label:"Init W(KG)",value:"...",asyncValue:()=>this.patient.getInitialWeight()},{label:"Init H(CM)",value:"...",asyncValue:()=>this.patient.getInitialHeight()},{label:"Init BMI",value:"...",asyncValue:()=>this.patient.getInitialBMI()},{label:"init Preg",value:"...",condition:()=>this.patient.isFemale(),asyncValue:()=>this.patient.getInitialObs("Is patient pregnant","value_coded")},{label:"init Breastfeeding",value:"...",condition:()=>this.patient.isFemale(),asyncValue:()=>this.patient.getInitialObs("Is patient breast feeding","value_coded")},{label:"cur Preg",value:"...",condition:()=>this.patient.isFemale(),asyncValue:async()=>await this.patient.isPregnant()?"Yes":"No"},{label:"cur Breastfeeding",value:"...",condition:()=>this.patient.isFemale(),asyncValue:async()=>await this.patient.isBreastfeeding()?"Yes":"No"},{label:"TI",value:"...",asyncValue:()=>p.getFirstValueCoded(this.patientId,"Ever received ART")},{label:"Agrees to follow up",value:"...",asyncValue:()=>p.getFirstValueCoded(this.patientId,"Agrees to followup")},{label:"Reason for starting ART",value:"...",asyncValue:()=>p.getFirstValueCoded(this.patientId,"Reason for ART eligibility")},{label:"HIV test date",value:"...",asyncValue:async()=>{const e=await p.getFirstValueDatetime(this.patientId,"Confirmatory HIV test date");return e?V.toStandardHisDisplayFormat(e):""}},{label:"HIV test place",value:"...",asyncValue:()=>p.getFirstValueText(this.patientId,"Confirmatory HIV test location")},{label:"Date of starting first line ART",value:"...",asyncValue:async()=>{const e=await p.getFirstValueDatetime(this.patientId,"Date ART started");return e?V.toStandardHisDisplayFormat(e):""}},{label:"Pulmonary TB within the last 2 years",value:"...",init:async()=>{this.tbStats=await p.getAllValueCoded(this.patientId,"Who stages criteria present")||[]},staticValue:()=>this.hasTbStat("Tuberculosis (PTB or EPTB) within the last 2 years")},{label:"Extra pulmonary TB (EPTB)",value:"...",staticValue:()=>this.hasTbStat("Extrapulmonary tuberculosis (EPTB)")},{label:"Pulmonary TB (current)",value:"...",staticValue:()=>this.hasTbStat("Pulmonary tuberculosis (current)")},{label:"Kaposis sarcoma",value:"...",staticValue:()=>this.hasTbStat("Kaposis sarcoma")}]},buildDetails(e){const t=n=>n.map(([s,h])=>"".concat(s," (").concat(h,")")).join("/");return[{label:"Outcome",value:e.outcome},{label:"Outcome Date",value:e.outcome_date},{label:"Side effects",value:e.side_effects},{label:"Viral load",value:N(e.viral_load)},{label:"Pills Brought",value:t(e.pills_brought)},{label:"Pills dispensed",value:t(e.pills_dispensed)},{label:"Visit by",value:e.visit_by},{label:"Regimen",value:e.regimen},{label:"Adherence",value:t(e.adherence)},{label:"TB Status",value:e.tb_status},{label:"Height (cm)",value:e.height},{label:"Weight (Kg)",value:e.weight},{label:"BMI",value:e.bmi},{label:"Is pregnant",value:e.isPregnant,visible:this.patient.isFemale()},{label:"Is breastfeeding",value:e.isBreastfeeding,visible:this.patient.isFemale()}]},async onNewRow(e){const t=[...e];if(t[1]&&t[1].td!="...")return t;const n=t[0].td,s=await A.getCurrentProgramInformation(this.patientId,n),h=await A.getMastercardDrugInformation(this.patientId,n),f=((h==null?void 0:h.pills_given)||[]).map(l=>"".concat(l.short_name||l.name," <b>(").concat(l.quantity||"?",")</b>")).join("<br/>");let b="N/A",d="N/A";if(this.patient.isFemale()){const l=await p.getFirstObs(this.patientId,"Is patient pregnant",n);l&&$(l.obs_datetime)===n&&(b=l.value_coded);const c=await p.getFirstObs(this.patientId,"Is patient breast feeding",n);c&&$(c.obs_datetime)===n&&(d=c.value_coded)}return t[1]=a.td(s.weight),t[2]=a.td(s.regimen),t[3]=a.td(N(s.viral_load)),t[4]=a.td(s.tb_status),t[5]=a.td(s.outcome.match(/Unk/i)?"Unknown":s.outcome),t[6]=a.td(f),t[7]=a.tdBtn("More",async()=>{(await R.create({component:ne,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:n,visitData:this.buildDetails({...s,isPregnant:b,isBreastfeeding:d})}})).present()}),t},hasTbStat(e){return this.tbStats.includes(e)?"Yes":"No"},updateDemographics(e){this.$router.push({path:"/patient/registration",query:{edit_person:this.patientId,person_attribute:e}})},addGuardian(){var e;this.$router.push({path:"/guardian/registration/".concat(this.patientId),query:{source:(e=this.$route.name)==null?void 0:e.toString()}})},updateARVNumber(){this.$router.push({name:"Edit ARV Number"})}}});function oe(e,t,n,s,h,f){const b=i("information-header"),d=i("report-table"),l=i("preloader"),c=i("pagination"),r=i("ion-content"),_=i("his-footer"),y=i("ion-page");return m(),P(y,{style:{background:"#fff"}},{default:u(()=>[o(b,{items:e.patientCardInfo,numberOfColumns:4,onAddGuardian:e.addGuardian,onUpdate:e.updateDemographics,onUpdateARVNumber:e.updateARVNumber},null,8,["items","onAddGuardian","onUpdate","onUpdateARVNumber"]),o(r,null,{default:u(()=>[o(d,{paginated:!0,rows:e.rows,columns:e.columns,rowsPerPage:e.itemsPerPage,newPage:e.currentPage,asyncRowParser:e.onNewRow,onOnPagination:t[0]||(t[0]=I=>e.totalPages=I.length)},null,8,["rows","columns","rowsPerPage","newPage","asyncRowParser"]),e.visitDatesInitialised?B("",!0):(m(),P(l,{key:0,itemCount:5})),o(c,{perPage:e.itemsPerPage,maxVisibleButtons:20,totalPages:e.totalPages,onOnChangePage:t[1]||(t[1]=I=>e.currentPage=I)},null,8,["perPage","totalPages"])]),_:1}),o(_,{btns:e.btns},null,8,["btns"])]),_:1})}const ue=C(se,[["render",oe]]);export{ue as default};
