System.register(["./EncounterMixin.vue_vue_type_script_lang-legacy-BYNMg0KB.js","./HisStandardForm-legacy-C7VqHmr3.js","./index-legacy--hxN_V8z.js","./dynamic-import-helper-legacy-DYK5bIOV.js","./radiology_examination_service-legacy-D-gJjl-R.js","./PersonFieldHelper-legacy-DXv4y3LF.js","./radiology_global_props-legacy-vS5dJQ8z.js","./encounter_guidelines-legacy-BZk5BWg2.js","./GuidelineEngine-legacy-KsvQuFdF.js","./TouchScreenForm-legacy-DxIQwsU4.js","./ToolbarMediumCard-legacy-CzmL2SiF.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-TUlObaz7.js","./LocationFieldOptions-legacy-TTrPmoN6.js","./person_service-legacy-BPtn1P_Z.js","./MultiFieldDateHelper-legacy-B97J9Bxd.js","./KbLayouts-legacy-BKvPSxzZ.js","./HisKbConfigurations-legacy-vrLd9Pgz.js"],(function(e,i){"use strict";var t,a,n,l,s,o,r,d,u,c,p,h,m,v,y,T,f,E,_,b;return{setters:[e=>{t=e._},e=>{a=e.H},e=>{n=e.S,l=e.d,s=e.I,o=e.V,r=e.ab,d=e.t,u=e.n,c=e.q,p=e._,h=e.r,m=e.o,v=e.c,y=e.w,T=e.b},e=>{f=e.F},e=>{E=e.R},e=>{_=e.P},e=>{b=e.a},null,null,null,null,null,null,null,null,null,null,null],execute:function(){class i extends n{constructor(){super()}static getInternalSections(){return super.getJson("internal_sections")}static createInternalSection(e){return super.postJson("internal_sections",{name:e})}}const x=l({mixins:[t],components:{IonPage:s,HisStandardForm:a},data:()=>({service:{},examinationOptions:[],defaultExternalLocation:"",detailedExaminationOptions:[]}),watch:{ready:{handler(e){e&&(this.service=new E(this.patientID,this.providerID),this.fields.push(this.listOfRadiologyTestsField()),this.fields.push(this.examinationField()),this.fields.push(this.detailedExaminationField()),this.fields.push(this.referralTypeField()),this.fields.push(this.internalReferralField()),this.fields.push(this.externalReferralField()),this.fields.push(this.payingField()),this.fields.push(this.paymentTypeField()),this.fields.push(this.receiptField()),this.fields.push(this.paymentAmountField()),this.fields.push(this.invoiceField()),this.fields.push(this.invoiceAmountField()))},immediate:!0}},methods:{getTestsOptions:async e=>(await E.getListOfRadiologyTests(e)).map((e=>({label:e.name,value:e.concept_id}))),validateAmount:e=>e.match(/([0-9]+\\.[0-9])|Unknown$/i)?["You must enter a decimal number"]:null,async onFinish(e,i){await this.service.createEncounter();const t=await this.service.createOrder({concept_id:i.list_of_radiology_test.concept,encounter_id:this.service.encounterID,provider_id:this.providerID}),a=(await this.resolveObs(i)).map((e=>(e.order_id=t.order_id,e)));await this.service.saveObservationList(a),this.service.printExamination(t.accession_number),this.gotoPatientDashboard()},listOfRadiologyTestsField(){let e=[],i=-1;return{id:"list_of_radiology_test",helpText:"Please select the type of examination",type:f.TT_SELECT,validation:e=>o.required(e),computedValue:e=>({concept:e.value,obs:this.service.buildValueCoded("RADIOLOGY TEST",e.value)}),beforeNext:async e=>(i!=e.value&&(i=e.value,this.examinationOptions=await this.getTestsOptions(e.value)),!0),options:async()=>(r.isEmpty(e)&&(e=await this.getTestsOptions("LIST OF RADIOLOGY TESTS")),e)}},examinationField(){let e=-1;return{id:"examination",helpText:"Please select the examination",type:f.TT_SELECT,validation:e=>o.required(e),computedValue:e=>({obs:this.service.buildValueCoded("Examination",e.value)}),condition:()=>!r.isEmpty(this.examinationOptions),beforeNext:async(i,t)=>(e!=t.list_of_radiology_test.value&&(e=i.value,this.detailedExaminationOptions=await this.getTestsOptions(e)),!0),options:()=>this.examinationOptions}},detailedExaminationField(){return{id:"detailed_examination",helpText:"Please select the detailed examination",type:f.TT_SELECT,condition:()=>!r.isEmpty(this.detailedExaminationOptions),computedValue:e=>({obs:this.service.buildValueCoded("Detailed examination",e.value)}),validation:e=>o.required(e),options:()=>this.detailedExaminationOptions}},referralTypeField(){return{id:"referral_type",helpText:"Please select the referral type",type:f.TT_SELECT,validation:e=>o.required(e),computedValue:e=>({obs:this.service.buildValueText("Source of referral",e.label)}),options:()=>this.mapStrToOptions(["External","Internal"])}},externalReferralField(){const e=_.getFacilityLocationField();return e.id="external_referral",e.init=async()=>(this.defaultExternalLocation=await b.defaultReferralLocation(),!0),e.defaultValue=()=>this.defaultExternalLocation,e.condition=e=>"External"===e.referral_type.value,e.computedValue=e=>({obs:this.service.buildValueText("REFERRED FROM",e.label)}),e},internalReferralField(){let e=[];return{id:"referred_by",helpText:"Referred from",type:f.TT_SELECT,validation:e=>o.required(e),condition:e=>"Internal"===e.referral_type.value,computedValue:e=>({obs:this.service.buildValueText("REFERRED FROM",e.label)}),options:async()=>(r.isEmpty(e)&&(e=(await i.getInternalSections()).map((e=>({value:e.id,label:`${e?.name}`.toUpperCase()})))),e),config:{showKeyboard:!0,footerBtns:[{name:"Add Referral",slot:"end",color:"success",onClick:async(e,t,a)=>{if("string"!=typeof a.filter||a.filter.length<3)return d("Please enter a valid name");if(a.filtered.some((e=>e.label.toLowerCase()===a.filter.toLowerCase())))return d("Can't add already existing referral location");if(await u("Do you want to add referral location?")){const e=await i.createInternalSection(a.filter.toUpperCase());e?(a.filter=e.name,a.listData=[{label:e.name,value:e.id},...a.listData]):c(`Unable to add ${a.filter}`)}}}]}}},payingField(){return{id:"paying",helpText:"Is this a paying patient?",type:f.TT_SELECT,computedValue:e=>({obs:this.service.buildValueCoded("PAYING",e.value)}),validation:e=>o.required(e),options:()=>this.yesNoOptions()}},paymentTypeField(){return{id:"payment_type",helpText:"Select payment method",type:f.TT_SELECT,validation:e=>o.required(e),condition:e=>"Yes"===e.paying.value,computedValue:e=>({obs:this.service.buildValueCoded("PAYMENT TYPE",e.value)}),options:()=>this.mapStrToOptions(["Cash","Invoice"])}},receiptField(){return{id:"receipt_number",helpText:"Enter receipt number",type:f.TT_TEXT,condition:e=>"Cash"===e.payment_type.value,computedValue:e=>({obs:this.service.buildValueText("RECEIPT NUMBER",e.value)}),validation:e=>o.validateSeries([()=>o.required(e),()=>this.validateAmount(`${e.value}`)])}},invoiceField(){return{id:"invoice_number",helpText:"Enter invoice number",type:f.TT_TEXT,computedValue:e=>({obs:this.service.buildValueText("INVOICE NUMBER",e.value)}),condition:e=>"Invoice"===e.payment_type.value,validation:e=>o.required(e)}},paymentAmountField(){return{id:"payment_amount",helpText:"Enter payment amount",type:f.TT_NUMBER,condition:e=>e.receipt_number.value,computedValue:e=>({obs:this.service.buildValueNumber("PAYMENT AMOUNT",e.value)}),validation:e=>o.validateSeries([()=>o.required(e),()=>this.validateAmount(`${e.value}`)])}},invoiceAmountField(){return{id:"invoice_amount",helpText:"Enter invoice amount",type:f.TT_NUMBER,condition:e=>e.invoice_number.value,computedValue:e=>({obs:this.service.buildValueNumber("INVOICE AMOUNT",e.value)}),validation:e=>o.validateSeries([()=>o.required(e),()=>this.validateAmount(`${e.value}`)])}}}});e("default",p(x,[["render",function(e,i,t,a,n,l){const s=h("his-standard-form"),o=h("ion-page");return m(),v(o,null,{default:y((()=>[T(s,{fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])])),_:1})}]]))}}}));
