import{d as C,bW as w,b1 as I,a5 as R,a4 as z,a3 as B,$ as S,a6 as E,a7 as M,de as q,dw as T,ad as V,ae as f,aa as L,af as l,a as d,c as _,w as n,b as s,E as A,J as F,G as P,C as c,a2 as $,M as G}from"./index-CMZASHAR.js";import{_ as H}from"./FieldMixin.vue_vue_type_script_lang-Bg-mZnL5.js";import J from"./BaseTextInput-DJ8sG-L8.js";const K=C({components:{ViewPort:w,IonGrid:I,IonList:R,IonCol:z,IonRow:B,IonItem:S,IonLabel:E,IonInput:M,HisTextInput:J},mixins:[H],data:()=>({drugs:[],selectedDrug:null}),async activated(){this.init()},methods:{async init(){this.$emit("onFieldActivated",this),this.drugs=await this.options(),this.drugs.length>=1&&this.selectDrug(0)},fmtNumber(e){return q(e)},getModalTitle(e){return"".concat(e," (").concat(this.drugs[this.selectedDrug].label,")")},getDrugValue(e){return this.drugs[this.selectedDrug].other[e]},setDrugValue(e,t){this.drugs[this.selectedDrug].other[e]=t?t.value:""},enterTins(){T({id:"tins",helpText:this.getModalTitle("Enter number of tins"),type:V.TT_NUMBER,defaultValue:()=>this.getDrugValue("tins"),validation:e=>!e||e&&!e.value?null:f.validateSeries([()=>f.isNumber(e),()=>e.value<=0?["Number of tins must be greater than 1"]:null,()=>e.value>this.getDrugValue("quantity")?["You cannot dispose/relocate more than available tins"]:null])},e=>this.setDrugValue("tins",e))},async selectReason(){const e=this.getDrugValue("batch_number");T({id:"reason",helpText:this.getModalTitle("Select reason for disposing/relocating Batch ".concat(e)),type:V.TT_SELECT,defaultValue:()=>this.getDrugValue("reason"),validation:t=>f.required(t),options:()=>{var t;return((t=this.config)==null?void 0:t.getReasons(this.drugs[this.selectedDrug],this.fdata))||[]}},t=>{this.setDrugValue("reason",t)})},selectDrug(e){this.selectedDrug=e}},computed:{fullSelectedDrugName(){var e,t,o;try{const[g,D,,b]=(o=(t=(e=this.drugs[this.selectedDrug])==null?void 0:e.description)==null?void 0:t.text.split("-"))!=null?o:"",p=this.drugs[this.selectedDrug].label;return"".concat(p," (").concat(g,"-").concat(D,"-").concat(b,")")}catch(g){return"N/A"}},updatedDrugs(){return this.drugs.filter(e=>{var t,o;return!!((t=e.other)!=null&&t.tins)&&!!((o=e.other)!=null&&o.reason)})}},watch:{clear(){this.drugs=this.drugs.map(e=>(e.other={...e.other,tins:null,quantity:e.current_quantity/e.pack_size||1,reason:""},e))},drugs:{async handler(){this.$emit("onValue",this.updatedDrugs)},immediate:!0,deep:!0}}});function U(e,t,o,g,D,b){const p=l("his-text-input"),u=l("ion-item"),k=l("ion-list"),r=l("ion-col"),h=l("ion-label"),m=l("ion-input"),y=l("ion-row"),v=l("ion-grid"),N=l("view-port");return d(),_(N,null,{default:n(()=>[s(p,{readonly:"",value:e.fullSelectedDrugName},null,8,["value"]),s(v,{style:{background:"white"}},{default:n(()=>[s(y,null,{default:n(()=>[s(r,{size:"4",class:"border-right scroll-list"},{default:n(()=>[(d(!0),A(F,null,P(e.drugs,(a,i)=>(d(),_(k,{key:i},{default:n(()=>[s(u,{detail:"",color:i===e.selectedDrug?"secondary":"",onClick:W=>e.selectDrug(i)},{default:n(()=>[c($(a.label),1)]),_:2},1032,["color","onClick"])]),_:2},1024))),128))]),_:1}),s(r,null,{default:n(()=>[e.selectedDrug!==null?(d(),_(v,{key:0,class:"scroll-list"},{default:n(()=>[s(y,null,{default:n(()=>[s(r,{size:"12",class:"ion-margin-bottom"},{default:n(()=>[s(u,null,{default:n(()=>{var a;return[s(h,{position:"floating"},{default:n(()=>{var i;return[c("Available Tins/Pallets (pack size: "+$((i=e.drugs[e.selectedDrug].other)==null?void 0:i.pack_size)+"):",1)]}),_:1}),s(m,{readonly:"",disabled:"",value:e.fmtNumber((a=e.drugs[e.selectedDrug].other)==null?void 0:a.quantity)},null,8,["value"])]}),_:1})]),_:1}),s(r,{size:"12"},{default:n(()=>[s(u,null,{default:n(()=>{var a;return[s(h,{position:"floating"},{default:n(()=>t[0]||(t[0]=[c("Total Tins Relocated/Disposed")])),_:1}),s(m,{readonly:"",color:"primary",value:e.fmtNumber(((a=e.drugs[e.selectedDrug].other)==null?void 0:a.tins)||0),onClick:e.enterTins},null,8,["value","onClick"])]}),_:1})]),_:1}),s(r,{size:"12"},{default:n(()=>[s(u,null,{default:n(()=>{var a;return[s(h,{position:"floating"},{default:n(()=>t[1]||(t[1]=[c("Reason for Relocating/Disposing")])),_:1}),s(m,{readonly:"",color:"primary",placeholder:"select reason",value:((a=e.drugs[e.selectedDrug].other)==null?void 0:a.reason)||"",onClick:e.selectReason},null,8,["value","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1})):G("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}const Q=L(K,[["render",U],["__scopeId","data-v-549e1350"]]);export{Q as default};
