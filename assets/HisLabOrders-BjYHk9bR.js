import{d as D,bN as k,a3 as $,ag as l,cZ as d,aj as m,O as p,ad as C,aq as S,aJ as x,a6 as B,ab as h,u as a,v as T,w as f,G as s,B as c,E as _,C as g,x as E,z as y,Z as o,aE as F}from"./index-ATRrruTT.js";import{L as H}from"./LabOrderModal-Bg2-iEZ-.js";import{_ as N}from"./FieldMixin.vue_vue_type_script_lang-Cq8VqPZ3.js";import"./lab_order_service-BhvQBsZN.js";const L=D({components:{ViewPort:k,IonButton:$},mixins:[N],data:()=>({HisDate:l,rows:[],fetchingOrders:!1,ordersToday:{}}),methods:{async init(){this.$emit("onFieldActivated",this),this.fetchingOrders=!0;let r=[];try{r=await this.options(this.fdata)}catch(t){console.error("".concat(t))}this.fetchingOrders=!1;const e=r[0].other.values;this.ordersToday=e.reduce((t,i)=>(d(i.ordered)===d(m.getSessionDate())&&!i.result.length&&(t[i.test_name]=!0),t),{}),this.rows=e.map(t=>(t.id=t.order_id,t.ordered&&(t.ordered=l.toStandardHisDisplayFormat(t.ordered)),t.released&&(t.released=l.toStandardHisDisplayFormat(t.released)),t))},async printOrder(r){var e;if(d(r.ordered)!=d(m.getSessionDate()))return p("Printing order #".concat(r.accession_number," is restricted to today. Consider using BDE mode/set session date to the order date"));typeof((e=this.config)==null?void 0:e.printOrder)=="function"&&await C("Do you want to print order with accession number ".concat(r.accession_number,"?"))&&this.config.printOrder(r.id)},formatOrders(r){return r.map(e=>({id:e.order_id,encounter_id:e.encounter_id,result_given:e.result_given,accession_number:e.accession_number,test_name:e.tests[0].name,specimen:e.specimen.name,ordered:l.toStandardHisDisplayFormat(e.order_date),result:[],release:""}))},async launchOrderSelection(r=null){if(this.fetchingOrders)return p("Please wait....");const e=await S.create({component:H,backdropDismiss:!1,cssClass:"large-modal",componentProps:{testFilters:r,ordersToday:this.ordersToday,onOrderAdded:i=>this.ordersToday[i]=!0}});e.present();const{data:t}=await e.onDidDismiss();x.isEmpty(t)||(this.rows=[...this.formatOrders(t),...this.rows])}},mounted(){this.init()},activated(){this.init()}}),P={class:"view-port-content"},V={class:"his-sm-text"};function A(r,e,t,i,z,G){const w=h("ion-button"),v=h("view-port");return a(),T(v,null,{default:f(()=>[s("div",P,[s("table",V,[e[1]||(e[1]=s("tr",null,[s("th",null,"Accession #"),s("th",null,"Test Name"),s("th",null,"Specimen"),s("th",null,"Ordered"),s("th",null,"Result"),s("th",null,"Released"),s("th",null,"Given")],-1)),(a(!0),c(_,null,g(r.rows,(n,b)=>(a(),c("tr",{key:b},[s("td",null,[E(w,{color:"light",fill:"none",onClick:u=>r.printOrder(n)},{default:f(()=>[y(o(n.accession_number),1)]),_:2},1032,["onClick"])]),s("td",null,o(n.test_name),1),s("td",null,o(n.specimen),1),s("td",null,o(n.ordered),1),s("td",null,[(a(!0),c(_,null,g(n.result,(u,O)=>(a(),c("span",{key:O},[y(o(u)+" ",1),e[0]||(e[0]=s("br",null,null,-1))]))),128))]),s("td",null,o(n.released),1),s("td",null,[s("span",{style:F("color: ".concat(n.result_given==="Yes"?"green;":"black;"))},o(n.result_given),5)])]))),128))])])]),_:1})}const q=B(L,[["render",A],["__scopeId","data-v-c8e35324"]]);export{q as default};
