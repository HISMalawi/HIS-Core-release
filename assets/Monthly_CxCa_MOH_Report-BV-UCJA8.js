import{d as ae,i as re,h as se,aw as le,D as ie,k as ce,j as ue,f as de,m as fe,l as ge,ci as pe,J as ve,K as m,M as K,ah as W,ae as _e,aE as me,cw as be,cx as he,cy as ye,cz as Ce,dB as we,aH as De,cX as Ie,S as I,bN as Se,aW as te,_ as ne,r as g,o as c,x as v,b as d,w as u,u as P,v as z,z as k,A as D,c as V,B as $,y as j,az as Oe,a7 as Te,I as ke,cm as $e,N as Ne,t as Ae,q as Re,a1 as He,ct as Y,O as B,F as x,V as U,H as Ee}from"./index-C6EjxQ0a.js";import{C as Me}from"./cxca_report_service-BGfJmEIG.js";import{D as Ve}from"./DrillPatientIds-CU7igfuT.js";import"./TableView-DKbvhgCs.js";import"./fuse-YdZE3OCN.js";import"./HisKeyboard-B8oB68Wv.js";const Fe=ae({components:{IonToolbar:re,IonItem:se,IonIcon:le,IonLabel:ie,IonTitle:ce,IonHeader:ue,IonButton:de,IonFooter:fe,IonContent:ge,IonButtons:pe},props:{title:{type:String,default:"Report"},subtitle:{type:String},columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},onFinish:{type:Function},onRefresh:{type:Function},onConfigure:{type:Function},csvQuarter:{type:String},headers:{type:Array,default:()=>[]},order:{type:Array,default:()=>[]},csvSpacing:{type:Number},csvSubHeader:{type:Array,default:()=>[]},csvData:{type:Array,default:()=>[]}},setup(n){const b=ve(),S=m([]),O=m(""),y=m("desc"),A=K(()=>n.columns.slice(0,1)),C=K(()=>{var s;const o=[];return(s=n.columnData)==null||s.forEach(e=>{const a=n.columns[1].map(t=>{let r="",l={},i=1;try{W.isEmpty(e)?r="...":typeof t.value=="function"?r=t.value(e):r=e[t.ref]||""}catch(h){r="_ERROR_",console.error(h)}return typeof t.dataStyle=="function"&&(l=t.dataStyle(e)),typeof t.colSpan=="function"&&(i=t.colSpan(e)),{column:t,data:e,value:r,styling:l,colSpan:i,[t.ref||"nada"]:r}});o.push({row:a,data:e,searchIndex:[...a,a.map(t=>t.value).join(" ")]})}),o}),_=o=>{O.value=o,y.value=y.value==="asc"?"desc":"asc"},p=()=>{typeof n.onFinish=="function"?n.onFinish():b.push("/")},R=o=>{var s,e;try{typeof((s=o.column)==null?void 0:s.tdClick)=="function"&&((e=o.column)==null||e.tdClick(o));return}catch(a){console.error(a)}},T=()=>n.columns.reduce((o,s)=>o.concat(s),[]).filter(o=>o.value||o.ref),H=()=>{var s;const o=(s=window==null?void 0:window.document)==null?void 0:s.getElementById("report-content");Ie("\n                <html>\n                    <head> \n                        <style> \n                        table {\n                            border-collapse: collapse;\n                        }\n                        th, td {\n                            width: 4%;\n                            text-align: left;\n                            border: solid 1px black;\n                        }\n                        td {\n                            border-bottom: 1px solid rgb(165, 165, 165);\n                            padding: 0.6em;\n                            font-weight: 500;\n                            font-size: .8em;\n                        }\n                        </style>    \n                    </head>\n                <body> \n                 ".concat(o.innerHTML,"    \n                </body>\n                </html>\n            "))},F=()=>{const o="".concat(I.getLocationName()||"Unknown site","-").concat(n.title,"-").concat(n.subtitle,"-").concat(I.getSessionDate());Se([n.headers],[...n.csvData,["Date Created: ".concat(te().format("DD/MMM/YYYY HH:MM:ss"))],["Quarter: ".concat(n.csvQuarter||n.subtitle)],["HIS-Core Version: ".concat(I.getCoreVersion())],["API Version: ".concat(I.getApiVersion())],["Site UUID: ".concat(I.getSiteUUID())],["Generated by: ".concat(I.getUserName())]],o)},E=o=>{o.forEach(s=>{const e=T().map(a=>{let t="",r={},l=1;try{W.isEmpty(s)?t="...":typeof a.value=="function"?t=a.value(s):t=s[a.ref]||""}catch(i){t="_ERROR_",console.error(i)}return typeof a.dataStyle=="function"&&(r=a.dataStyle(s)),typeof a.colSpan=="function"&&(l=a.colSpan(s)),{column:a,data:s,value:t,styling:r,colSpan:l,[a.ref||"nada"]:t}});S.value.push({row:e,data:s,searchIndex:[...e,e.map(a=>a.value).join(" ")]})})};return _e(()=>n.columnData,o=>{S.value=[],Array.isArray(o)&&E(o)},{immediate:!0,deep:!0}),{sortColumn:_,onClickTablecell:R,toPDF:H,toCSV:F,finish:p,headerRow:A,sync:me,search:be,close:he,arrowUp:ye,arrowDown:Ce,document:we,calendar:De,sortOrder:y,sectionOne:C,columnSorted:O}}}),Le={key:0},Pe={class:"his-sm-text"},ze={id:"report-content"},je={class:"art-report-theme"},Ye={class:"stick-report-header"},Be=["colspan","rowspan","onClick"],Ue=["onClick","colspan"];function Qe(n,b,S,O,y,A){const C=g("ion-title"),_=g("ion-icon"),p=g("ion-button"),R=g("ion-buttons"),T=g("ion-toolbar"),H=g("ion-header"),F=g("ion-label"),E=g("ion-item"),o=g("ion-content"),s=g("ion-footer");return c(),v($,null,[d(H,null,{default:u(()=>[d(T,null,{default:u(()=>[d(C,{class:"his-md-text"},{default:u(()=>[P(z(n.title)+" ",1),n.subtitle?(c(),v("br",Le)):k("",!0),D("span",Pe,z(n.subtitle),1)]),_:1}),d(R,{slot:"end"},{default:u(()=>[typeof n.onConfigure=="function"?(c(),V(p,{key:0,onClick:n.onConfigure},{default:u(()=>[d(_,{size:"large",icon:n.calendar},null,8,["icon"])]),_:1},8,["onClick"])):k("",!0),typeof n.onRefresh=="function"?(c(),V(p,{key:1,onClick:n.onRefresh,color:"success",size:"large"},{default:u(()=>[d(_,{size:"large",icon:n.sync},null,8,["icon"])]),_:1},8,["onClick"])):k("",!0)]),_:1})]),_:1})]),_:1}),d(o,{"scroll-y":"","scroll-x":""},{default:u(()=>[D("div",ze,[D("table",je,[D("thead",Ye,[(c(!0),v($,null,j(n.headerRow,(e,a)=>(c(),v("tr",{key:a},[(c(!0),v($,null,j(e,(t,r)=>{var l,i;return c(),v("th",{key:r,colspan:((l=t==null?void 0:t.span)==null?void 0:l.thColspan)||1,rowspan:((i=t==null?void 0:t.span)==null?void 0:i.thRowspan)||1,onClick:h=>n.sortColumn(t.ref)},[d(E,{lines:"none"},{default:u(()=>[n.columnSorted&&n.columnSorted===t.ref?(c(),V(_,{key:0,icon:n.sortOrder==="asc"?n.arrowUp:n.arrowDown},null,8,["icon"])):k("",!0),a<n.columns.length-1?(c(),V(F,{key:1,class:"ion-text-center"},{default:u(()=>[D("b",null,z(t.label),1)]),_:2},1024)):k("",!0)]),_:2},1024)],8,Be)}),128))]))),128))]),D("tbody",null,[(c(!0),v($,null,j(n.sectionOne,(e,a)=>(c(),v("tr",{key:a},[(c(!0),v($,null,j(e.row||[],(t,r)=>{var l;return c(),v($,{key:r},[t.value!="TH"?(c(),v("td",{key:0,onClick:()=>n.onClickTablecell(t),class:Oe({"clickable-cell":(l=t==null?void 0:t.column)==null?void 0:l.tdClick}),colspan:t.colSpan},[D("b",{style:Te(t.styling),class:"his-sm-text"},z(t.value),5)],10,Ue)):k("",!0)],64)}),128))]))),128))])])])]),_:1}),d(s,null,{default:u(()=>[d(T,{color:"dark"},{default:u(()=>[d(p,{onClick:b[0]||(b[0]=e=>n.toCSV()),size:"large"},{default:u(()=>[P(" CSV ")]),_:1}),d(p,{onClick:b[1]||(b[1]=e=>n.toPDF()),size:"large"},{default:u(()=>[P(" PDF ")]),_:1}),d(p,{onClick:n.finish,color:"success",size:"large",slot:"end"},{default:u(()=>[P(" Finish ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const We=ne(Fe,[["render",Qe],["__scopeId","data-v-26464ae3"]]),Q=m([]),N=m(""),M=m(""),J=m(""),X=m(!1),ee=m(""),G=m([]),qe=ae({components:{IonPage:ke,IonLoading:$e,v2Datatable:We},setup(){const n=["screened_disaggregated_by_age","screened_disaggregated_by_hiv_status","screened_disaggregated_by_reason_for_visit","screened_disaggregated_by_screening_method","screening_results_hiv_positive","screening_results_hiv_negative","suspects_disaggregated_by_age","total_treated","total_treated_disaggregated_by_tx_option","referral_reasons","referral_feedback","family_planning"],b=e=>Math.floor(e.length/2),S=(e,a)=>e.slice(0,a),O=(e,a)=>e.slice(a),y=(e,a)=>{const t=[];for(let r=0;r<e.length;r++)t.push(e[r].concat(a[r]));return t},A=e=>{const a=[],t=[],r=Object.keys(e);let l,i=0,h=0,w="";return r.forEach(f=>{Object.entries(e[f]).forEach(([L,q])=>{l!=f&&(i=i+1,h=0,T.forEach(Z=>{Z[0]==f&&(f=Z[1])}),a.push([i,f,"TH"]),t.push([i,f,""])),Array.isArray(q)?(h=h+1,w=i+"."+h,a.push([w,L,q]),t.push([w,L,q])):(a.push([w,L,[]]),t.push([w,L,[]])),l=f})}),G.value=t,a},C=e=>{const a={};return n.forEach(t=>{e[t]&&(a[t]=e[t])}),a},_=async(e,a)=>{a.length<=0||(await B.create({component:Ve,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e,subtitle:J,patientIdentifiers:a,onFinish:()=>B.getTop().then(t=>t&&B.dismiss())}})).present()},p=e=>(e.forEach(a=>{a[2]=a[2]==="TH"?" ":a[2],Array.isArray(a[5])&&(a[5]=""+a[5].length),Array.isArray(a[2])&&(a[2]=""+a[2].length,a[5]=a[5]==="TH"?" ":a[5])}),e),R=["age_group","cryotherapy","thermocoagulation","leep","via_deffered","via_reffered","suspected_reffered"],T=[["family_planning","Offered family planning services"],["referral_feedback","Number of clients with referral feedback"],["referral_reasons","Number of clients referred disaggregated by referral reasons"],["screened_disaggregated_by_age","Number of clients screened for cervical cancer disaggregated by age"],["screened_disaggregated_by_hiv_status","Number of clients screened for cervical cancer disaggregated by HIV status"],["screened_disaggregated_by_reason_for_visit","Number of clients screened for cervical cancer disaggregated by reason for visit"],["screened_disaggregated_by_screening_method","Number of clients screened disaggregated by screening method"],["screening_results_hiv_negative","Cervical cancer screening results (HIV- / unknown)"],["screening_results_hiv_positive","Cervical cancer screening results (HIV+)"],["suspects_disaggregated_by_age","Cervical Cancer suspects disaggregated by age"],["total_treated","Total number of clients treated"],["total_treated_disaggregated_by_tx_option","Number of clients treated disaggregated by treatment option"]],H=["Indicator #","Name of Indicator","Value","Indicator #","Name of Indicator","Value"],E=[[{label:"indicator #",ref:""},{label:"Name of indicator",ref:""},{label:"value",ref:""},{label:"indicator #",ref:""},{label:"Name of indicator",ref:""},{label:"value",ref:""}],[{label:"Indicator #",ref:"data.indicatorOne",secondaryLabel:"Indicator #",value:e=>e.indicatorOne},{label:"Name of Indicator",ref:"data.nameOfIndicatorOne",secondaryLabel:"Name of Indicator",value:e=>e.nameOfIndicatorOne,dataStyle:e=>e.valueOne==="TH"?{fontWeight:"bold"}:{fontWeight:"normal"},colSpan:e=>e.valueOne==="TH"?2:1},{label:"value",ref:"data.valueOne",secondaryLabel:"Value",value:e=>Array.isArray(e.valueOne)?e.valueOne.length:e.valueOne,tdClick:({data:e})=>_("".concat(e.indicatorOne," ").concat(e.nameOfIndicatorOne),e.valueOne)},{label:"Indicator #",ref:"data.indicatorTwo",secondaryLabel:"Indicator #",value:e=>e.indicatorTwo},{label:"Name of Indicator",ref:"data.nameOfIndicatorTwo",secondaryLabel:"Name of Indicator",value:e=>e.nameOfIndicatorTwo,dataStyle:e=>e.valueTwo==="TH"?{fontWeight:"bold"}:{fontWeight:"normal"},colSpan:e=>e.valueTwo==="TH"?2:1},{label:"value",ref:"data.valueTwo",secondaryLabel:"Value",value:e=>Array.isArray(e.valueTwo)?e.valueTwo.length:e.valueTwo,tdClick:({data:e})=>_("".concat(e.indicatorTwo," ").concat(e.nameOfIndicatorTwo),e.valueTwo)}]],o=async()=>{if(!(N.value&&M.value))return Ae("Start date and end date required!");X.value=!0,Q.value=[];const e=new Me;e.startDate=N.value,e.endDate=M.value;try{const a=await e.getClinicReport("SCREENED FOR CXCA"),t=C(a),r=A(t),l=b(r),i=y(S(r,l),O(r,l)),h=W.cloneDeep(i);G.value=p(h);const w=i.map(f=>({indicatorOne:f[0],nameOfIndicatorOne:f[1],valueOne:f[2],indicatorTwo:f[3],nameOfIndicatorTwo:f[4],valueTwo:f[5]}));Q.value=w}catch(a){Re("Unable to generate report!"),console.error(a)}X.value=!1},s=()=>He([{id:"year",helpText:"Select Year",type:x.TT_NUMBER,computedValue:e=>e.value,validation:e=>{const a=W.isPlainObject(e)?e.value:-1;return U.validateSeries([()=>U.required(e),()=>isNaN(parseInt("".concat(a)))?["Invalid year"]:null,()=>U.rangeOf(e,2e3,Ee.getYear(I.getSessionDate()))])}},{id:"month",helpText:"Select Month",type:x.TT_SELECT,validation:e=>U.required(e),computedValue:e=>e.value,options:()=>[{label:"January",value:"01"},{label:"February",value:"02"},{label:"March",value:"03"},{label:"April",value:"04"},{label:"May",value:"05"},{label:"June",value:"06"},{label:"July",value:"07"},{label:"August",value:"08"},{label:"September",value:"09"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}]}],e=>{N.value="".concat(e.year.value,"-").concat(e.month.value,"-01"),M.value=te(new Date(N.value).toISOString()).endOf("month").format("YYYY-MM-DD"),J.value="Period (".concat(Y(N.value)," to ").concat(Y(M.value),")"),B.dismiss(),ee.value="".concat(Y(N.value)," to ").concat(Y(M.value)),o()});return Ne(()=>!Q.value.length&&s()),{columns:E,isLoading:X,reportData:Q,period:J,csvQuarter:ee,generate:o,configure:s,order:R,csvheaders:H,spacing:5,csvData:G}}});function Je(n,b,S,O,y,A){const C=g("ion-loading"),_=g("v2Datatable"),p=g("ion-page");return c(),V(p,null,{default:u(()=>[d(C,{"is-open":n.isLoading,message:"Please wait..."},null,8,["is-open"]),d(_,{title:"MONTHLY MOH Report",subtitle:n.period,columns:n.columns,columnData:n.reportData,rowsPerPage:25,onConfigure:n.configure,csvQuarter:n.csvQuarter,onRefresh:()=>n.generate(),order:n.order,headers:n.csvheaders,"csv-spacing":n.spacing,"csv-data":n.csvData},null,8,["subtitle","columns","columnData","onConfigure","csvQuarter","onRefresh","order","headers","csv-spacing","csv-data"])]),_:1})}const aa=ne(qe,[["render",Je]]);export{aa as default};
