System.register(["./dynamic-import-helper-legacy-DYK5bIOV.js","./HisStandardForm-legacy-BpfFI5_j.js","./index-legacy-C29Eb2Qm.js","./EncounterMixin.vue_vue_type_script_lang-legacy-rPdlUSmp.js","./LocationFieldOptions-legacy-CSWOIX88.js","./MultiFieldDateHelper-legacy-DNe3hLpD.js","./TouchScreenForm-legacy-BmEuIwWy.js","./ToolbarMediumCard-legacy-CF38wqjC.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-CDi_rmkw.js","./encounter_guidelines-legacy-BDiBaLGJ.js","./GuidelineEngine-legacy-KsvQuFdF.js","./KbLayouts-legacy-BKvPSxzZ.js","./HisKbConfigurations-legacy-vrLd9Pgz.js"],(function(t,e){"use strict";var s,i,a,o,n,l,r,u,h,d,T,c,p,m,b,v,g,_;return{setters:[t=>{s=t.F},t=>{i=t.H},t=>{a=t.d,o=t.b5,n=t.V,l=t.ab,r=t.H,u=t.ba,h=t.aU,d=t.R,T=t._,c=t.r,p=t.o,m=t.c},t=>{b=t._},t=>{v=t.g},t=>{g=t.g,_=t.E},null,null,null,null,null,null,null,null],execute:function(){const e=a({mixins:[b],components:{HisStandardForm:i},data:()=>({service:{},labOrderFieldContext:{},tbTests:["Urine Lam","GeneXpert","Culture & Sensitivity","TB Microscopic Exam","FASH"],cmTests:["Serum Crag"],ksTests:["Biopsy"],hasTBresultsWithin6Months:!1,hasCragResultsWithin6Months:!1,minTestDate:""}),watch:{ready:{async handler(t){t&&(this.service=new o(this.patientID,201,this.providerID),this.fields=this.getFields())},immediate:!0}},methods:{async onFinish(t,e){await this.service.createEncounter(),await this.service.saveObservationList(await this.resolveObs(e)),this.nextTask()},availableResultsField(){return{id:"available_results",helpText:"Results available from the last six months?",type:s.TT_MULTIPLE_YES_NO,validation:t=>n.anyEmpty(t),options:t=>[{label:"Tuberculosis (TB)",value:(t.available_results||[])[0]?.value||"",other:{values:this.yesNoOptions(),concept:"TB results from last six months available"}},{label:"Cryptococcal Meningitis(CM)",value:(t.available_results||[])[1]?.value||"",other:{values:this.yesNoOptions(),concept:"Cryptococcal Meningitis (CM) results from the last six months available"}}],computedValue:t=>({tag:"obs",obs:t.map((({other:t,value:e})=>this.service.buildValueCoded(t.concept,e)))}),onValueUpdate:t=>(this.hasTBresultsWithin6Months=l.some(t,{value:"Yes",label:"Tuberculosis (TB)"}),this.hasCragResultsWithin6Months=l.some(t,{value:"Yes",label:"Cryptococcal Meningitis(CM)"}),t),beforeNext:()=>{if(this.hasTBresultsWithin6Months||this.hasCragResultsWithin6Months){const t=this.patient.getBirthdate(),e=r.subtract(this.service.date,"years",6);this.minTestDate=e.isBefore(t)?t:e.format("YYYY-MM-DD")}return!0}}},labInvestigationsField(){let t=[];const e=async()=>h.formatLabs(await d.get("GET_LAB_ORDERS_WITH_GIVEN_RESULT_STATUS",{patientID:this.patientID}));return{id:"patient_lab_orders",helpText:"Previous Lab orders",type:s.TT_LAB_ORDERS,init:async()=>(t=await e(),!0),unload:async()=>t=await e(),onload:t=>this.labOrderFieldContext=t,options:()=>[{label:"Lab orders",value:"order trail",other:{values:t}}],config:{printOrder:t=>new u(this.patientID).printLabOrderLbl(t),hiddenFooterBtns:["Clear"]}}},tbTestLocationField(){return{id:"tb_location",helpText:"TB test location",type:s.TT_SELECT,validation:t=>n.required(t),condition:()=>this.hasTBresultsWithin6Months,options:(t,e="")=>v(e),computedValue:t=>({obs:this.service.buildValueText("TB test location",t.label)}),config:{showKeyboard:!0,isFilterDataViaApi:!0}}},cragTestLocationField(){return{id:"crag_location",helpText:"Serum crAg test location",type:s.TT_SELECT,condition:()=>this.hasCragResultsWithin6Months,validation:t=>n.required(t),options:(t,e="")=>v(e),computedValue:t=>({obs:this.service.buildValueText("Serum crAg test location",t.label)}),config:{showKeyboard:!0,isFilterDataViaApi:!0}}},tbTestDateField(){return g({id:"tb_test_date",helpText:"TB Test",required:!0,condition:()=>this.hasTBresultsWithin6Months,minDate:()=>this.minTestDate,maxDate:()=>this.service.date,computeValue:(t,e)=>({date:t,obs:this.buildDateObs("TB Test date",t,e,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:_.MONTH_ESTIMATE_FIELD}})},tbTestResultDateField(){return g({id:"tb_test_result_date",helpText:"TB Test Result",required:!0,condition:()=>this.hasTBresultsWithin6Months,minDate:(t,e)=>e.tb_test_date.date,maxDate:()=>this.service.date,computeValue:(t,e)=>({obs:this.buildDateObs("Tuberculosis test result date",t,e,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:_.MONTH_ESTIMATE_FIELD}})},cragTestDateField(){return g({id:"crag_test_date",helpText:"Serum CrAg Test",required:!0,minDate:()=>this.minTestDate,maxDate:()=>this.service.date,condition:()=>this.hasCragResultsWithin6Months,computeValue:(t,e)=>({obs:this.buildDateObs("Serum crAg test date",t,e,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:_.MONTH_ESTIMATE_FIELD}})},cragResultField(){return{id:"crag_result",helpText:"Serum CrAg result",type:s.TT_SELECT,condition:()=>this.hasCragResultsWithin6Months,validation:t=>n.required(t),computedValue:t=>({obs:this.service.buildValueCoded("Serum crAg result",t.value)}),options:()=>this.mapStrToOptions(["Positive","Negative"])}},tbTestTypeField(){return{id:"tb_test_type",helpText:"TB Test Type",condition:()=>this.hasTBresultsWithin6Months,type:s.TT_SELECT,validation:t=>n.required(t),options:()=>this.mapStrToOptions([...this.tbTests,"Chest X-Ray","Other"]),computedValue:t=>({obs:this.service.buildValueCoded("TB Test type",t.value)})}},tbTestResultField(){return{id:"tb_result",helpText:"TB test result",condition:()=>this.hasTBresultsWithin6Months,type:s.TT_SELECT,validation:t=>n.required(t),computedValue:t=>({obs:this.service.buildValueCoded("TB test result",t.value)}),options:()=>this.mapStrToOptions(["Positive","Negative","Inconclusive"])}},getTbClassification(){return{id:"tb_classification",helpText:"TB Classification",condition:t=>this.hasTBresultsWithin6Months&&/positive/i.test(t.tb_result?.value),type:s.TT_SELECT,validation:t=>n.required(t),options:()=>this.mapStrToOptions(["Category I TB case","Category II TB case","Category III TB case","Category IV TB case"]),computedValue:t=>({obs:this.service.buildValueCoded("TB classification",t.value)})}},getTbTreatmentStatus(){return{id:"on_tb_treatment",helpText:"On TB Treatment?",type:s.TT_SELECT,condition:t=>this.hasTBresultsWithin6Months&&/positive/i.test(t.tb_result?.value),validation:t=>n.required(t),computedValue:t=>({obs:this.service.buildValueCoded("TB treatment",t.value)}),options:()=>this.yesNoOptions()}},getTbTreatmentStartDate(){return g({id:"tb_treatment_start_date",helpText:"TB Treatment Start",condition:t=>this.hasTBresultsWithin6Months&&/Yes/i.test(t.on_tb_treatment?.value),minDate:()=>this.minTestDate,maxDate:()=>this.service.date,computeValue:(t,e)=>({obs:this.buildDateObs("TB treatment start date",t,e,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:_.MONTH_ESTIMATE_FIELD}})},getTbTreatmentPeriod(){return{id:"tb_treatment_period",helpText:"TB Treatment period (In months)",type:s.TT_NUMBER,validation:t=>n.validateSeries([()=>n.required(t),()=>n.isNumber(t),()=>n.rangeOf(t,3,9)]),condition:t=>this.hasTBresultsWithin6Months&&/Yes/i.test(t.on_tb_treatment?.value),computedValue:t=>({obs:this.service.buildValueNumber("TB treatment period",t.value)})}},ksSymptomsField(){return{id:"ks_symptoms",helpText:"Kaposi Sarcoma (KS) associated symptoms",type:s.TT_MULTIPLE_YES_NO,validation:t=>n.required(t),computedValue:t=>t?t.map((t=>this.service.buildValueCoded(t.label,t.value))):null,options:t=>t.ks_symptoms?t.ks_symptoms:[this.toYesNoOption("Enlarged Lymph Nodes on Neck"),this.toYesNoOption("Enlarged Lymph Nodes on Armpits"),this.toYesNoOption("Enlarged Lymph Nodes on Groin"),this.toYesNoOption("Patches or Nodes on Neck"),this.toYesNoOption("Patches or Nodes on Armpits"),this.toYesNoOption("Patches or Nodes on Groin")]}},ksLabInvestigationField(){return{id:"ks_lab",helpText:"KS Biopsy test",type:s.TT_YES_NO,appearInSummary:()=>!1,validation:t=>n.required(t),options:()=>[{label:"Order Biopsy test?",values:this.yesNoOptions()}]}},ksDiagnosisField(){return{id:"ks_diagnosis",helpText:"KS diagnosis",type:s.TT_SELECT,validation:t=>n.required(t),options:()=>this.mapStrToOptions(["Positive","Negative"])}},ksStagingField(){return{id:"ks_staging",helpText:"Ks staging",type:s.TT_MULTIPLE_SELECT,beforeNext:async(t,e)=>{const s=[];return this.hasTBresultsWithin6Months&&!/Inconclusive/i.test(e.tb_result)||s.push(...this.tbTests),this.hasCragResultsWithin6Months&&!/Positive/i.test(e.crag_result)||s.push(...this.cmTests),/Yes/i.test(e.ks_lab)&&s.push(...this.ksTests),l.isEmpty(this.labOrderFieldContext)||await this.labOrderFieldContext.launchOrderSelection(s),!0},validation:t=>n.required(t),options:()=>this.mapStrToOptions(["KS stage T0","KS stage T1"]),config:{buildOptionsOnce:!0}}},summary:()=>({id:"summary",helpText:"AHD Summary",type:s.TT_SUMMARY,options:t=>{const e=[];return e.push({label:"TB",value:t.tb_result?.value?`${t.tb_test_type?.value} ${t.tb_result?.value}`:"N/A"}),e.push({label:"CM",value:t.crag_result?.value?`Serum CrAg ${t.crag_result?.value}`:"N/A"}),e.push({label:"KS",value:t.ks_symptoms.every((t=>"No"===t.value))?"No symptoms":`${t.ks_symptoms.filter((t=>"Yes"===t.value)).length} symptom(s) recorded`}),e}}),getFields(){return[this.labInvestigationsField(),this.availableResultsField(),this.tbTestLocationField(),...this.tbTestDateField(),this.tbTestTypeField(),...this.tbTestResultDateField(),this.tbTestResultField(),this.getTbClassification(),this.getTbTreatmentStatus(),...this.getTbTreatmentStartDate(),this.getTbTreatmentPeriod(),this.cragTestLocationField(),...this.cragTestDateField(),this.cragResultField(),this.ksSymptomsField(),this.ksLabInvestigationField(),this.ksDiagnosisField(),this.ksStagingField(),this.summary()]}}});t("default",T(e,[["render",function(t,e,s,i,a,o){const n=c("his-standard-form");return p(),m(n,{skipSummary:!0,fields:t.fields,onFinishAction:t.onFinish,cancelDestinationPath:t.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}]]))}}}));
