System.register(["./dynamic-import-helper-legacy-DYK5bIOV.js","./HisStandardForm-legacy-CKuIfChD.js","./index-legacy-JGk_dRVc.js","./EncounterMixin.vue_vue_type_script_lang-legacy-DrW6yd3p.js","./MultiFieldDateHelper-legacy-DRQ-Cbl7.js","./LocationFieldOptions-legacy-H0x8IcNz.js","./TouchScreenForm-legacy-mmY57gUM.js","./ToolbarMediumCard-legacy-DQQTyubW.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-YMYfwvUb.js","./encounter_guidelines-legacy-fM1Kg0cb.js","./GuidelineEngine-legacy-KsvQuFdF.js","./KbLayouts-legacy-BKvPSxzZ.js","./HisKbConfigurations-legacy-vrLd9Pgz.js"],(function(e,t){"use strict";var a,s,i,n,o,r,l,u,d,c,h,v,m,p,C,b,g;return{setters:[e=>{a=e.F},e=>{s=e.H},e=>{i=e.b5,n=e.d,o=e.aT,r=e.aS,l=e.t,u=e.T,d=e.V,c=e._,h=e.r,v=e.o,m=e.c},e=>{p=e._},e=>{C=e.g,b=e.E},e=>{g=e.g},null,null,null,null,null,null,null,null],execute:function(){class t extends i{hivStatus;artStatus;arvNumber;arvStartDate;constructor(e,t){super(e,181,t),this.hivStatus="",this.artStatus="",this.arvNumber="",this.arvStartDate=""}getHivStatus(){return this.hivStatus}getArtStatus(){return this.artStatus}getArvNumber(){return this.arvNumber}getArvStartDate(){return this.arvStartDate}isHivPositive(){return!!this.hivStatus.match(/positive/i)}async loadArtStatus(){const e=await i.getJson(`programs/12/patients/${this.patientID}/art_hiv_status`);e&&(this.hivStatus=e.hiv_status||this.hivStatus,this.artStatus=e.art_status||"",this.arvNumber=e.arv_number||"",this.arvStartDate=e.arv_start_date||"")}}const T=n({mixins:[p],components:{HisStandardForm:s},data:()=>({assessment:{},obs:[],showHIVQuestions:!0,alreadyOnTreatment:!1,offerCxCa:!1,patientPreviousTreatment:"",patientPreviousVisitHIVStatus:""}),watch:{patient:{async handler(){this.assessment=new t(this.patientID,this.providerID),this.patientPreviousTreatment=await o.getFirstValueCoded(this.patientID,"Treatment"),this.patientPreviousVisitHIVStatus=await o.getFirstValueCoded(this.patientID,"HIV status"),this.alreadyOnTreatment=this.patientAlreadyOnTreatment(),r.getConceptsByCategory("reason_for_no_cxca"),await this.assessment.loadArtStatus(),""!==this.assessment.getHivStatus()&&(this.showHIVQuestions=!1),"Positive"===this.assessment.getHivStatus()&&(this.showHIVQuestions=!1),await this.setOfferCxCa(),this.fields=await this.getFields()},deep:!0}},methods:{skipTreatmentSelection(){const e=["Chemotherapy","Hysterectomy","Palliative Care"];if(this.patientPreviousTreatment){const t=this.patientPreviousTreatment;return e.includes(t)}return!1},skipHIVStatusSelection(){const e=["positive on art","positive not on art"];if(this.patientPreviousVisitHIVStatus){const t=this.patientPreviousVisitHIVStatus.toLowerCase();return e.includes(t.toLowerCase())}return!1},patientAlreadyOnTreatment(){return!this.isNullOrUndefined(this.patientPreviousTreatment)},isNullOrUndefined:e=>null==e,async onFinish(e,t){if(!(await this.assessment.createEncounter()))return l("Unable to create encounter");const a=[];Object.keys(t).forEach((e=>{a.push(t[e].obs)}));const s=await Promise.all([...this.obs,...a]);if(!(await this.assessment.saveObservationList(s)))return l("Unable to save patient observations");u("Observations and encounter created!"),this.nextTask()},async setOfferCxCa(){const e=await this.assessment.getFirstValueCoded("Offer CxCa");return this.offerCxCa=e&&"Yes"===e,this.offerCxCa||this.obs.push(this.assessment.buildValueCoded("Ever had CxCa","No")),!0},hasHIVStatus(){return""!==this.assessment.getHivStatus},enterPreviousCxCaData(e){const t="Yes"===e.ever_had_cxca.value,a="Yes"===e.results_available.value;return t&&a},getFacilities:(e="")=>g(e),getReasonsForNoCxcaOptions:()=>r.getConceptsByCategory("reason_for_no_cxca").map((e=>({label:e.name,value:e.name,other:{c:e}}))),getFields(){return[{id:"reason_for_visit",helpText:"Reason for visit",type:a.TT_SELECT,validation:e=>d.required(e),options:()=>[{label:"Initial screening",value:"Initial screening"},{label:"Postponed treatmment",value:"Postponed treatment"},{label:"One year subsequent check-up after treatment",value:"One year subsequent check-up after treatment"},{label:"Subsequent screening",value:"Subsequent screening"},{label:"Problem visit after treatment",value:"Problem visit after treatment"},{label:"Referral",value:"Referral"}],computedValue:e=>({obs:this.assessment.buildValueCoded("Reason for visit",e.value)})},{id:"hiv_status",helpText:"HIV status",type:a.TT_SELECT,condition:()=>this.showHIVQuestions&&!this.skipHIVStatusSelection(),validation:e=>d.required(e),options:()=>[{label:"Positive on ART",value:"Positive on ART"},{label:"Positive Not on ART",value:"Positive Not on ART"},{label:"Negative",value:"Negative"},{label:"Never tested",value:"Never tested"},{label:"Prefers Not to disclose",value:"Undisclosed"}],computedValue:e=>({obs:this.assessment.buildValueCoded("HIV status",e.value)})},...C({id:"hiv_test_date",helpText:"HIV test result date",required:!0,condition:e=>e.hiv_status.value.match(/Negative|ART/i),minDate:()=>this.patient.getBirthdate(),maxDate:()=>this.assessment.getDate(),estimation:{allowUnknown:!0,estimationFieldType:b.MONTH_ESTIMATE_FIELD},computeValue:(e,t)=>({date:e,tag:"cxca screening",isEstimate:t,obs:this.assessment.buildValueDate("HIV test date",e,t)})}),{id:"ever_had_cxca",helpText:"Ever had CxCa screening",type:a.TT_SELECT,condition:e=>"Initial screening"!==e.reason_for_visit.value&&!this.alreadyOnTreatment,options:()=>this.yesNoOptions(),validation:e=>d.required(e),computedValue:e=>({obs:this.assessment.buildValueCoded("Ever had CxCa",e.value)})},{id:"results_available",helpText:"Results available?",type:a.TT_SELECT,validation:e=>d.required(e),condition:e=>"Initial screening"!==e.reason_for_visit.value&&"No"!==e.ever_had_cxca.value,options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.assessment.buildValueCoded("CxCa test results",e.value)})},{id:"location",helpText:"CxCa screening location",type:a.TT_SELECT,validation:e=>d.required(e),options:(e,t="")=>this.getFacilities(t),config:{showKeyboard:!0,isFilterDataViaApi:!0},condition:e=>this.enterPreviousCxCaData(e),computedValue:e=>({obs:this.assessment.buildValueText("Previous CxCa location",e.value)})},...C({id:"cxca_date",helpText:"Previous CxCa test",required:!0,minDate:()=>this.patient.getBirthdate(),maxDate:()=>this.assessment.getDate(),estimation:{allowUnknown:!1},condition:e=>this.enterPreviousCxCaData(e),computeValue:(e,t)=>({date:e,tag:"cxca screening",isEstimate:t,obs:this.assessment.buildValueDate("cxca test date",e)})}),{id:"previous_screening_method",helpText:"Previous screening method",type:a.TT_SELECT,validation:e=>d.required(e),condition:e=>this.enterPreviousCxCaData(e),options:()=>[{label:"VIA",value:"VIA"},{label:"PAP Smear",value:"PAP Smear"},{label:"HPV DNA",value:"HPV DNA"},{label:"Speculum Exam",value:"Speculum Exam"}],computedValue:e=>({obs:this.assessment.buildValueCoded("Previous CxCa screening method",e.value)})},{id:"offer_CxCa",helpText:"Offer CxCa screening today",type:a.TT_SELECT,condition:this.skipTreatmentSelection(),validation:e=>d.required(e),options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.assessment.buildValueCoded("Offer CxCa",e.value)})},{id:"screening_method",helpText:"Screening method being offered",type:a.TT_SELECT,validation:e=>d.required(e),condition:e=>"Yes"===e.offer_CxCa.value,options:()=>[{label:"VIA",value:"VIA"},{label:"PAP Smear",value:"PAP Smear"},{label:"HPV DNA",value:"HPV DNA"},{label:"Speculum Exam",value:"Speculum Exam"}],computedValue:e=>({obs:this.assessment.buildValueCoded("CxCa screening method",e.value)})},{id:"offer_family_planning",helpText:"Offer Family Planning ?",type:a.TT_SELECT,condition:e=>"No"!==e.offer_CxCa.value,validation:e=>d.required(e),options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.assessment.buildValueCoded("Family planning",e.label)})},{id:"reason_for_no_cxca",helpText:"Reason for NOT offering CxCa screening",type:a.TT_SELECT,validation:e=>d.required(e),condition:e=>"No"===e.offer_CxCa.value,options:()=>this.getReasonsForNoCxcaOptions(),computedValue:e=>({obs:this.assessment.buildValueCoded("Reason for NOT offering CxCa",e.value)})}]}}});e("default",c(T,[["render",function(e,t,a,s,i,n){const o=h("his-standard-form");return v(),m(o,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!1,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}]]))}}}));
