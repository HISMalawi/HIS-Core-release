import{d as z,aE as g,i as K,ai as j,aF as Q,an as v,ao as E,q as P,U as G,aG as J,y as X,aH as Z,aI as U,aJ as ss,A as M,aK as es,aL as ts,aM as os,am as x,ar as B,h,b as p,g as l,t as _,aN as as,aO as ns,e as o,w as n,a as V,a6 as S,a9 as $,aa as A,aP as is,ak as W,al as Y,r as L,aQ as ls,c as rs,aR as us,o as ds,f as e,a4 as ps,l as D,a5 as cs,ah as w,j as m,I as R,k as hs,x as F,aS as fs,aT as H,ag as ws,a7 as k,aU as ms,aV as ys,aW as gs,aX as _s,m as Is,aY as bs,aZ as vs,a_ as Ps}from"./index-qFt4YszW.js";import{p as ks}from"./main-BLS6kvyD.js";import{H as Cs}from"./HelpdeskFlyer-BaXCz_eK.js";const Ts=z({components:{IonInput:j,IonButton:K,IonIcon:g},props:{useVirtualInput:{type:Boolean}},data:function(){return{eye:os,eyeOff:ts,passwordTimeout:null,showPasswordButtonTimeout:null,showPassword:!1,showPasswordButton:!1,keyboard:U,auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new M,es.clearScreenTimeout()},setup(){const{facilityName:s,district:t}=ss();return{facilityName:s,district:t}},methods:{onShowPassword(){this.showPassword=!0,this.showPasswordButton=!0,this.passwordTimeout&&clearTimeout(this.passwordTimeout),this.passwordTimeout=setTimeout(()=>this.showPassword=!1,1e4)},renderKeyBoard(s){this.focusInput=s.currentTarget,this.focusInput.id=="password"?this.btnCaption="Login":this.btnCaption="Next";let t=s.currentTarget.getBoundingClientRect().top;t=parseInt(t),this.keyboardTop=t+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(s){const t=s.currentTarget.id;let r;try{t.match(/@#/i)?this.keyboard=Z:t.match(/qwerty/i)?this.keyboard=U:t.match(/Del/i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):t.match(/Next/i)?(this.display="none",r=this.$refs.password,r.$el.click()):t.match(/Login/i)?(this.display="none",this.doLogin()):t.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",this.focusInput.id==="username"?r=this.$refs.username:r=this.$refs.password,r.click()):t.match(/Hide/i)?this.display="none":this.focusInput.value+=t,this.focusInput.id=="username"?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(i){console.warn("input error")}},doLogin:async function(){if(this.showPasswordButtonTimeout&&clearTimeout(this.showPasswordButtonTimeout),this.showPasswordButton=!1,this.showPassword=!1,this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!await this.auth.checkTimeIntegrity())throw"Local date does not match API date. Please Update your device's date";await this.auth.login(this.userInput.password),this.auth.startSession();const s=await Promise.all([this.auth.passwordPolicyEnabled(),this.auth.passwordExpired()]),t=(()=>{let r=0;const i=ks(this.userInput.password);return r+=i.score,/^(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])/i.test(this.userInput.password)&&(r+=2),r<3})();if(t||s.every(Boolean)){const r=i=>"".concat(i.value).toLowerCase();return Q([{id:"new_password",proxyID:"password",helpText:"Change your password",type:E.TT_PASSWORD,init:()=>(setTimeout(()=>{t?P("Your password is weak, please change it below"):P("Your password has expired, please change it below",6e3)},500),!0),computedValue:i=>r(i),validation:i=>v.validateSeries([()=>v.required(i),()=>v.hasLengthRangeOf(i,4,15),()=>{if("".concat(this.userInput.password).toLowerCase()===r(i))return["New password should not match old password"]}]),config:{inputType:"password"}},{id:"verify_password",proxyID:"password",helpText:"Confirm Password",type:E.TT_PASSWORD,computedValue:i=>r(i),validation:(i,f)=>v.validateSeries([()=>v.required(i),()=>{if(r(f.verify_password)!=r(f.new_password))return["New password does not match current password"]}]),config:{inputType:"password"}}],async(i,f)=>{await G.updateUser(this.auth.userID,f)?(await this.auth.resetUserPasswordChangeCheck(),this.$router.push("/select_hc_location")):P("Unable to update user")})}this.$router.push("/select_hc_location")}catch(s){s instanceof J?(P("Invalid username or password"),this.showPasswordButton=!0,this.showPasswordButtonTimeout=setTimeout(()=>this.showPasswordButton=!1,3e4)):X("".concat(s),5e4)}}else P("Complete form to log in")}},computed:{btnStyles(){return"display: ".concat(this.display,"; top: ").concat(this.keyboardTop,";")}}}),Ss=s=>(W("data-v-5581b3d6"),s=s(),Y(),s),$s={class:"main",ref:"main"},Vs={class:"cells ion-padding-bottom"},Bs=Ss(()=>l("b",{style:{color:"#8b4513"}},"Facility: ",-1)),Ls={style:{color:"#cd853f"}},As={class:"rows"},Ns={class:"cells"},Os=["readonly"],Es={class:"rows input-rows"},Us={class:"cells"},Ds={class:"rows"},Rs=["id"],Fs=["id"];function Hs(s,t,r,i,f,C){const I=B("ion-icon"),b=B("ion-button"),y=B("ion-input");return p(),h($,null,[l("div",$s,[l("div",Vs,[l("h3",null,[Bs,l("b",Ls,_(s.facilityName)+" ("+_(s.district)+")",1)])]),l("div",As,[l("div",Ns,[as(l("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":t[0]||(t[0]=d=>s.userInput.username=d),onClick:t[1]||(t[1]=d=>s.renderKeyBoard(d)),class:"input-boxes ion-padding",readonly:s.useVirtualInput},null,8,Os),[[ns,s.userInput.username]])])]),l("div",Es,[l("div",Us,[o(y,{style:{margin:"0px auto","margin-top":"15px","text-align":"left"},modelValue:s.userInput.password,"onUpdate:modelValue":t[3]||(t[3]=d=>s.userInput.password=d),type:s.showPassword?"text":"password",name:"password",ref:"password",id:"password",onClick:t[4]||(t[4]=d=>s.renderKeyBoard(d)),class:"input-boxes ion-padding",placeholder:"Password",readonly:s.useVirtualInput},{default:n(()=>[!s.showPassword&&s.showPasswordButton?(p(),V(b,{key:0,onClick:s.onShowPassword,color:"light",size:"large",slot:"end"},{default:n(()=>[o(I,{size:"large",icon:s.eye},null,8,["icon"])]),_:1},8,["onClick"])):S("",!0),s.showPassword&&s.showPasswordButton?(p(),V(b,{key:1,onClick:t[2]||(t[2]=d=>s.showPassword=!1),color:"light",size:"large",slot:"end"},{default:n(()=>[o(I,{size:"large",icon:s.eyeOff},null,8,["icon"])]),_:1})):S("",!0)]),_:1},8,["modelValue","type","readonly"])])])],512),l("div",{id:"keyboard",style:is(s.btnStyles),class:"keyboard"},[(p(!0),h($,null,A(s.keyboard,(d,T)=>(p(),h("span",{key:T},[l("div",Ds,[(p(!0),h($,null,A(d,a=>(p(),h("div",{class:"cells",key:a},[a==="Next"||a==="Login"?(p(),h("button",{key:0,id:s.btnCaption,class:"keyboard-btn login-btn",onClick:t[5]||(t[5]=u=>s.keyPress(u))},_(s.btnCaption),9,Rs)):S("",!0),a!="Login"&&a!="Next"?(p(),h("button",{key:1,id:s.Caps.on?a.toUpperCase():a.toLowerCase(),class:"keyboard-btn",onClick:t[6]||(t[6]=u=>s.keyPress(u))},_(a==="Del."||a==="Caps"?a:s.Caps.on?a.toUpperCase():a.toLowerCase()),9,Fs)):S("",!0)]))),128))])]))),128))],4)],64)}const zs=x(Ts,[["render",Hs],["__scopeId","data-v-5581b3d6"]]),q=s=>(W("data-v-b23d751a"),s=s(),Y(),s),Ks=q(()=>l("b",{style:{color:"#8b4513"}},"National ",-1)),Ms=q(()=>l("b",{style:{color:"#cd853f"}},"EMR",-1)),xs={slot:"start"},Ws=["src"],Ys=["src"],qs=z({__name:"Login",setup(s){const t=F("login-logos/Malawi-Coat_of_arms_of_arms.png"),r=F("login-logos/PEPFAR.png"),i=L([]),f=async()=>{const a=await bs("Application Selection","Please specify the application you wish to use",i.value.map(u=>u.name),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(a.selection&&a.action!="Cancel"){const u=i.value.find(c=>c.name===a.selection);window.open("".concat(u.protocol||"http","://").concat(u.IP,":").concat(u.port||80),"_blank")}},{activePlatformProfile:C,platformProfiles:I}=ls(),b=L(""),y=L(""),d=rs(()=>C.value.keyboard===vs.HIS_KEYBOARD_ONLY),T=Object.keys(I.value).map(a=>({label:a,value:{profileName:a,...I.value[a]}}));return us(y,a=>{C.value=(Ps.find(T,{label:a})||{}).value}),ds(async()=>{var N,O;const a=new M;i.value=((N=await a.loadConfig())==null?void 0:N.otherApps)||[];const u=a.getHeadVersion();a.setActiveVersion(u);const c=await a.getApiVersion();b.value="".concat(u," / ").concat(c),y.value=((O=C.value)==null?void 0:O.profileName)||""}),(a,u)=>(p(),V(e(Is),null,{default:n(()=>[o(e(ps),null,{default:n(()=>[o(e(D),null,{default:n(()=>[o(e(cs),null,{default:n(()=>[o(e(w),{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:n(()=>[Ks,Ms]),_:1})]),_:1}),o(e(w),{class:"ion-padding",slot:"end"},{default:n(()=>[m(" Version: "),l("b",null,_(b.value),1)]),_:1})]),_:1})]),_:1}),o(e(R),{fullscreen:!1,style:{width:"100%"}},{default:n(()=>[o(zs,{useVirtualInput:d.value},null,8,["useVirtualInput"]),l("p",null,[o(Cs)])]),_:1}),o(e(hs),null,{default:n(()=>[o(e(D),null,{default:n(()=>[l("span",xs,[l("img",{id:"coat",src:e(t),alt:"Malawi Coat of Arms logo"},null,8,Ws),l("img",{id:"pepfar",src:e(r),alt:"PEPFAR logo"},null,8,Ys)]),o(e(K),{color:"dark",fill:"outline",size:"large",slot:"end",id:"configuration"},{default:n(()=>[o(e(g),{slot:"end",icon:e(fs)},null,8,["icon"]),m(" Quick Actions ")]),_:1}),o(e(H),{trigger:"configuration","dismiss-on-select":"",style:{"--width":"300px"}},{default:n(()=>[o(e(R),null,{default:n(()=>[o(e(ws),null,{default:n(()=>[o(e(k),{button:"","router-link":"/reset_password",class:"his-sm-text"},{default:n(()=>[o(e(g),{icon:e(ms),slot:"start"},null,8,["icon"]),o(e(w),null,{default:n(()=>[m("Reset Password")]),_:1})]),_:1}),o(e(k),{button:"","router-link":"/settings/host",class:"his-sm-text"},{default:n(()=>[o(e(g),{icon:e(ys),slot:"start"},null,8,["icon"]),o(e(w),null,{default:n(()=>[m("Network Settings")]),_:1})]),_:1}),o(e(k),{button:"",detail:"",id:"devices",class:"his-sm-text"},{default:n(()=>[o(e(g),{icon:e(gs),slot:"start"},null,8,["icon"]),o(e(w),null,{default:n(()=>[m("Device Profile")]),_:1})]),_:1}),o(e(H),{trigger:"devices","dismiss-on-select":"",side:"end"},{default:n(()=>[(p(!0),h($,null,A(e(T),c=>(p(),V(e(k),{key:c.label,color:c.label===y.value?"primary":"light",button:"",onClick:()=>y.value=c.label},{default:n(()=>[o(e(w),null,{default:n(()=>[m(_(c.label),1)]),_:2},1024)]),_:2},1032,["color","onClick"]))),128))]),_:1}),o(e(k),{button:"",onClick:f,class:"his-sm-text"},{default:n(()=>[o(e(g),{icon:e(_s),slot:"start"},null,8,["icon"]),o(e(w),null,{default:n(()=>[m("Other Applications")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),Js=x(qs,[["__scopeId","data-v-b23d751a"]]);export{Js as default};
