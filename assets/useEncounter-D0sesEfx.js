import{d5 as R,d6 as L,d7 as k,d8 as X,d9 as H,da as O,db as V,dc as q,dd as S,de as J,df as K,dg as j,dh as z,di as Q,dj as W,dk as Y,dl as Z,E as rr,cs as D,K as y,J as er,N as ar,T,p as nr,aT as E,bX as tr,dm as sr}from"./index-BFVcutZq.js";import{E as ir,F as p}from"./encounter_guidelines-fEzG7yyD.js";import{m as or}from"./GuidelineEngine-D6V1_Znr.js";var B=R,ur=L,cr=k,F=B?B.isConcatSpreadable:void 0;function vr(e){return cr(e)||ur(e)||!!(F&&e&&e[F])}var dr=vr,fr=X,lr=dr;function x(e,r,a,t,n){var s=-1,i=e.length;for(a||(a=lr),n||(n=[]);++s<i;){var o=e[s];r>0&&a(o)?r>1?x(o,r-1,a,t,n):fr(n,o):t||(n[n.length]=o)}return n}var pr=x;function _r(e){return function(r,a,t){for(var n=-1,s=Object(r),i=t(r),o=i.length;o--;){var c=i[e?o:++n];if(a(s[c],c,s)===!1)break}return r}}var br=_r,gr=br,mr=gr(),yr=mr,Er=yr,hr=H;function Tr(e,r){return e&&Er(e,r,hr)}var $r=Tr,Or=O;function Sr(e,r){return function(a,t){if(a==null)return a;if(!Or(a))return e(a,t);for(var n=a.length,s=r?n:-1,i=Object(a);(r?s--:++s<n)&&t(i[s],s,i)!==!1;);return a}}var Ar=Sr,wr=$r,Dr=Ar,Br=Dr(wr),Fr=Br,Nr=Fr,Cr=O;function Pr(e,r){var a=-1,t=Cr(e)?Array(e.length):[];return Nr(e,function(n,s,i){t[++a]=r(n,s,i)}),t}var Mr=Pr;function kr(e,r){var a=e.length;for(e.sort(r);a--;)e[a]=e[a].value;return e}var xr=kr,N=V;function Ir(e,r){if(e!==r){var a=e!==void 0,t=e===null,n=e===e,s=N(e),i=r!==void 0,o=r===null,c=r===r,f=N(r);if(!o&&!f&&!s&&e>r||s&&i&&c&&!o&&!f||t&&i&&c||!a&&c||!n)return 1;if(!t&&!s&&!f&&e<r||f&&a&&n&&!t&&!s||o&&a&&n||!i&&n||!c)return-1}return 0}var Gr=Ir,Ur=Gr;function Rr(e,r,a){for(var t=-1,n=e.criteria,s=r.criteria,i=n.length,o=a.length;++t<i;){var c=Ur(n[t],s[t]);if(c){if(t>=o)return c;var f=a[t];return c*(f=="desc"?-1:1)}}return e.index-r.index}var Lr=Rr,$=q,Xr=J,Hr=K,Vr=Mr,qr=xr,Jr=j,Kr=Lr,jr=S,zr=k;function Qr(e,r,a){r.length?r=$(r,function(s){return zr(s)?function(i){return Xr(i,s.length===1?s[0]:s)}:s}):r=[jr];var t=-1;r=$(r,Jr(Hr));var n=Vr(e,function(s,i,o){var c=$(r,function(f){return f(s)});return{criteria:c,index:++t,value:s}});return qr(n,function(s,i){return Kr(s,i,a)})}var Wr=Qr;function Yr(e,r,a){switch(a.length){case 0:return e.call(r);case 1:return e.call(r,a[0]);case 2:return e.call(r,a[0],a[1]);case 3:return e.call(r,a[0],a[1],a[2])}return e.apply(r,a)}var Zr=Yr,re=Zr,C=Math.max;function ee(e,r,a){return r=C(r===void 0?e.length-1:r,0),function(){for(var t=arguments,n=-1,s=C(t.length-r,0),i=Array(s);++n<s;)i[n]=t[r+n];n=-1;for(var o=Array(r+1);++n<r;)o[n]=t[n];return o[r]=a(i),re(e,this,o)}}var ae=ee;function ne(e){return function(){return e}}var te=ne,se=z,ie=function(){try{var e=se(Object,"defineProperty");return e({},"",{}),e}catch(r){}}(),oe=ie,ue=te,P=oe,ce=S,ve=P?function(e,r){return P(e,"toString",{configurable:!0,enumerable:!1,value:ue(r),writable:!0})}:ce,de=ve,fe=800,le=16,pe=Date.now;function _e(e){var r=0,a=0;return function(){var t=pe(),n=le-(t-a);if(a=t,n>0){if(++r>=fe)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}var be=_e,ge=de,me=be,ye=me(ge),Ee=ye,he=S,Te=ae,$e=Ee;function Oe(e,r){return $e(Te(e,r,he),e+"")}var Se=Oe,Ae=Q,we=O,De=W,Be=Y;function Fe(e,r,a){if(!Be(a))return!1;var t=typeof r;return(t=="number"?we(a)&&De(r,a.length):t=="string"&&r in a)?Ae(a[r],e):!1}var Ne=Fe,Ce=pr,Pe=Wr,Me=Se,M=Ne,ke=Me(function(e,r){if(e==null)return[];var a=r.length;return a>1&&M(e,r[0],r[1])?r=[]:a>2&&M(r[0],r[1],r[2])&&(r=[r[0]]),Pe(e,Ce(r,1),[])}),xe=ke;const Ie=Z(xe);function Le(e){const r=rr();let a=D({});const t=y(-1),n=D({}),s=y(-1),i=y([]),o=er(),c=y(""),f=()=>nr(a.getID(),o),A=()=>o.push(c.value),I=()=>Ie(i.value,({username:u})=>u).map(u=>{var v,_;let l="".concat(u.username);if(!tr((v=u==null?void 0:u.person)==null?void 0:v.names)){const[b]=((_=u.person)==null?void 0:_.names)||[];l+=" (".concat(b.given_name," ").concat(b.family_name,")")}return l}),G=async(u="N/A")=>{const l=await T.get("PATIENT_PROGRAM",{patientID:a.getID()});n.outcome=l.outcome,n.outcomeStartDate=l.startDate,n.sessionDate=E.getSessionDate(),n.apiDate=E.getCachedApiDate(),n.isBdeMode=E.isBDE(),n.birthDate=a.getBirthdate(),n.encounterName=u.toUpperCase(),E.isBDE()&&(i.value=await T.get("PROVIDERS"),n.providers=I())},w=(u,l=null)=>{const v={};if(v[p.SET_PROVIDER]=_=>{var g,m;const[b]=_.split(" ");return s.value=(m=(g=sr(i.value,{username:b}))==null?void 0:g.person_id)!=null?m:-1,p.CONTINUE},v[p.CHANGE_SESSION_DATE]=()=>(o.push("/session/date?patient_dashboard_redirection_id=".concat(a.getID())),p.EXIT),v[p.CHANGE_PATIENT_OUTCOME]=()=>(o.push("/patient/programs/".concat(a.getID())),p.EXIT),v[p.GO_TO_PATIENT_DASHBOARD]=()=>(A(),p.EXIT),u in v)return v[u](l)},U=async u=>{var v,_,b,g;const l=or(u,ir);for(const m in l){const d=l[m];if((v=d==null?void 0:d.actions)!=null&&v.alert&&w(await((_=d==null?void 0:d.actions)==null?void 0:_.alert(u)))===p.EXIT)return;if((b=d==null?void 0:d.actions)!=null&&b.selection){const h=await((g=d==null?void 0:d.actions)==null?void 0:g.selection(u));w(h.flowState,h.value)}}};return ar(async()=>{try{t.value=parseInt(r.params.patient_id),c.value="/patient/dashboard/".concat(t.value),a=await T.get("ACTIVE_PATIENT",{patientID:t.value}),await G(r.name),await U(n),typeof e=="function"&&e(s.value,t.value,a)}catch(u){console.error("Error in useEncounter hook:",u)}}),{patient:a,patientId:t,provider:s,providers:i,facts:n,patientDashboardUrl:c,goToPatientDashboard:A,goToNextTask:f}}export{Le as u};
