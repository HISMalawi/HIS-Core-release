System.register(["./dynamic-import-helper-legacy-arUa2LZV.js","./HisStandardForm-legacy-BXV61qjj.js","./vitals_service-legacy-2VCdFIW0.js","./index-legacy-Dg5P6bX-.js","./useEncounter-legacy-Bp6E5sCN.js","./TouchScreenForm-legacy-Bqug27CT.js","./ToolbarMediumCard-legacy-DWokgyDV.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-D3j1oaCn.js","./isEmpty-legacy-rdjCNuhy.js","./_Set-legacy-BL8ow4HL.js","./_setToArray-legacy-jEwcQpqP.js","./encounter_guidelines-legacy-mRSBdMQj.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,n,l,i,r,o,u,s,c,g,v,h,d;return{setters:[e=>{a=e.F},e=>{n=e.H},e=>{l=e.V},e=>{i=e.d,r=e.K,o=e.M,u=e.o,s=e.c,c=e.cl,g=e.ab,v=e.ad,h=e.n},e=>{d=e.u},null,null,null,null,null,null,null,null,null],execute:function(){e("default",i({__name:"AncVitals",setup(e){const t=r(0),i=r(-1),f=r(-1),b=r(-1),y=r([]);let m;const{patientDashboardUrl:p,goToNextTask:w}=d((async function(e,n,r){m=new l(n,e);const o=await l.getFirstObs(n,"Weight");f.value=parseFloat(`${o?.value_numeric??0}`),b.value=parseInt(`${o?.obs_id??-1}`),t.value=r.getAge(),i.value=await r.getRecentHeight(),y.value.push({id:"vitals",helpText:"Vitals entry",type:a.TT_VITALS_ENTRY,validation:S,options:()=>[j,P.value,T,A.value],config:{onUpdateAlertStatus:$,onChangeOption:E,hiddenFooterBtns:["Clear"]}})})),j={label:"Weight",value:"",other:{modifier:"KG",icon:"weight",required:!0}},T={label:"BP",value:"",other:{modifier:"mmHG",icon:"bp"}},A=o((()=>({label:"Age",value:t.value,other:{doNotSave:!0,modifier:"Years old",icon:"",visible:!1}}))),P=o((()=>{const e=i.value>0&&t.value>18;return{label:"Height",value:`${e?i.value:""}`,other:{modifier:"CM",icon:"height",recentHeight:i.value,visible:!e}}}));function S(e){const t=function(e){return e.filter((e=>""===e.value&&!0===e.other.required))}(e);if(t.length>0)return t.map((e=>[`${e.label} can not be empty`]));const a=function(e){return e.filter((e=>("Height"!==e.label||0!=e.other.required)&&""!==e.value&&"Age"!==e.label))}(e);return m.validateAll(a)}function $(e){const t=g.find(e,{label:"BP"});if(t&&""!=t.value){const[e,a]=`${t.value}`.split("/").map((e=>parseInt(e)));if(e>=140&&a>=90)return{status:"Client is at risk of pre-eclampsia, refer for urine protein test.",color:"brown"};if(e<120||e>140)return{status:"Systolic reading is out of normal range",color:"brown"};if(a<80||a>90)return{status:"Diastolic reading is out of normal range",color:"brown"};if(e>=130&&e<=139&&a>=80&&a<=89)return{status:"Prehypertension",color:"brown"}}return{status:"",color:""}}async function H(e){const t=e.value,a=t-f.value;if(100*(Math.abs(a)/f.value||1)>30){const e=`Use ${f.value} Kg`,n=`Use ${t} Kg`;if(await v("Abnormal Weight Change",`Previous Weight "${f.value} Kg". Current Weight "${t} Kg"`,`Weight Reading has been ${a>0?"increased":"decresed"} by more than 30%. Please SELECT the correct Weight.)`,[{name:e,slot:"start",color:"success"},{name:n,slot:"end",color:"danger"}])!==n||!b)return f.value;await h(`Do you want to void Weight observation for ${f.value}`)&&await l.voidObs(b.value)}return t}async function E(e){if(!e.value&&e.other.required)throw`Value for ${e.label} is required`;if(e.value){const t=m.validator(e);if(t&&t.length)throw t}"Weight"===e.label&&f.value>0&&(e.value=await H(e))}async function V(e){return(await Promise.all(e.filter((e=>!(e.other?.doNotSave||g.isEmpty(e.value)))).map((async e=>"BP"===e.label?async function(e){const[t,a]=e.split("/");return[await m.buildValueNumber("Systolic",parseInt(t)),await m.buildValueNumber("Diastolic",parseInt(a))]}(e.value):("Weight"===e.label&&f.value>0&&(e.value=await H(e)),m.buildValueNumber(e.label,e.value)))))).flat()}async function W({vitals:e}){if(!(await async function(e){const t=g.find(e,{label:"Height"});return t?.value>0||!(await h("Patient has no height reading. Do you want to proceed without recording height?",{header:"HEIGHT CONFIRMATION",confirmBtnLabel:"Enter Height",cancelBtnLabel:"Proceed"}))}(e)))return;await m.createEncounter();const t=await V(e);await m.saveObservationList(t),w()}return(e,t)=>(u(),s(n,{fields:y.value,onFinishAction:W,skipSummary:!0,cancelDestinationPath:c(p)},null,8,["fields","cancelDestinationPath"]))}}))}}}));
