import{d as b,r as v,bI as g,dP as I,ab as D,a9 as E,dT as P,ac as h,cW as l,u as y,v as N,w,x as A,y as p,dW as k,a5 as C}from"./index-DrPQ21-i.js";import{H as S}from"./HisStandardForm-rh8Trs2q.js";import{u as F}from"./useEncounter-DKfF-d5Z.js";import{g as u}from"./util-CyjuS_4X.js";import{r as M}from"./commons-BNWLqk9R.js";import{A as d}from"./appointment_service-CVvR4x_-.js";import"./isEmpty-BSlM0y0K.js";import"./encounter_guidelines-D8L0Wl1z.js";import"./GuidelineEngine-D6V1_Znr.js";const W=b({__name:"Appointment",setup(V){const r=v([]),e=new g(-1,I.APPOINTMENT);let m=0;const{goToNextTask:c,patientDashboardUrl:_}=F((n,o)=>{e.patientID=o,e.providerID=n,m=o;const T=()=>{let a={},s=-1;const i={};return{id:"appointment",helpText:"Appointment booking",type:D.TT_DATE_PICKER,init:async()=>(s=await E.get(P.CLINIC_APPOINTMENT_LIMIT),a=await d.getJson("programs/".concat(e.programID,"/patients/").concat(o,"/next_appointment_date"),{date:e.date}),!0),defaultValue:()=>a==null?void 0:a.appointment_date,validation:t=>h.required(t),computedValue:t=>[{concept_id:u("APPOINTMENT_DATE"),value_datetime:t,obs_datetime:e.date},{concept_id:u("ESTIMATED_DATE"),value_datetime:a==null?void 0:a.appointment_date,obs_datetime:e.date}],config:{minDate:()=>e.date,maxDate:()=>a==null?void 0:a.drugs_run_out_date,supValue:t=>"".concat((i[t]||[]).length),infoItems:async t=>(i[t]||(i[t]=await d.getJson("programs/".concat(e.programID,"/booked_appointments"),{date:t,paginate:!1})),[{label:"Medication Run out Date",value:l((a==null?void 0:a.drugs_run_out_date)||"Not available")},{label:"User set appointment date",value:l(t)},{label:"Appointments",value:(i[t]||[]).length},{label:"Appointment limit (per/day)",value:s||"N/A"}]),hiddenFooterBtns:["Clear"]}}};r.value=[T()]});async function f(n,o){await e.createEncounter(),await e.saveObservationList(await M(o)),await k(e.patientID),c()}return(n,o)=>(y(),N(p(C),null,{default:w(()=>[A(S,{cancelDestinationPath:p(_),onFinishAction:f,fields:r.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{W as default};
