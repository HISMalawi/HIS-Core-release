import{R as l}from"./TableReportTemplate-vw3YSnxU.js";import{F as p}from"./dynamic-import-helper-BkBZiFw5.js";import{d as c,L as t,s as m,V as u,H as f,O as o,P as h,q as g,_ as y,r as v,o as w,c as D}from"./index-BCTN_bnC.js";import{I as n}from"./identifier_service-Gyvt1JKz.js";import{D as T}from"./DrillTableModal-COI1WyeV.js";import"./Export-nPQsqN2_.js";import"./HisStandardForm-CaDwl-hA.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./ReportErrors-Dkeo3N9I.js";const I=c({components:{ReportTemplate:l},data:()=>({service:{},dde:{},title:"Duplicate Identifiers",fields:[],rows:[],columns:[[t.thTxt("Identifier"),t.thTxt("Count"),t.thTxt("View"),t.thTxt("Resolve")]]}),async created(){this.fields=this.getFormFields(),this.dde=new m,await this.dde.loadDDEStatus()},methods:{async onPeriod({identifier:e}){const s=parseInt(e.value.toString());this.title=e.label+" Duplicates",this.service=new n,this.service.setIdentifierType(s),this.rows=await this.getRows()},getFormFields(){return[{id:"identifier",helpText:"Select Identifier type",type:p.TT_SELECT,validation:e=>u.required(e),options:async()=>(await n.getIdentifierTypes()).map(e=>({label:e.name,value:e.patient_identifier_type_id}))}]},toDate(e){return f.toStandardHisDisplayFormat(e)},async drillDuplicates(e){(await o.create({component:T,cssClass:"custom-modal",componentProps:{title:"Persons using identifier ".concat(e),columns:["Given name","Family name","Gender","Birth date","Action"],onRows:async()=>(await this.service.getPatientsByIdentifier(e)).map(a=>{try{const i=new h(a);return[i.getGivenName(),i.getFamilyName(),i.getGender(),this.toDate(i.getBirthdate()),{type:"button",name:"View",action:()=>{o.dismiss().then(()=>{this.$router.push("/patient/dashboard/".concat(i.getID()))})}}]}catch(i){return g("Unable to load patient details"),["N/A","N/A","N/A","N/A","N/A"]}})}})).present()},async getRows(){return(await this.service.getDuplicateIndentifiers()).map(e=>[t.td(e.identifier),t.td(e.count),t.tdBtn("Select",()=>this.drillDuplicates(e.identifier)),t.tdBtn("Resolve",()=>{this.$router.push("/npid/duplicates/".concat(e.identifier))},{event:{disabled:this.service.getIdentifierType()!=3}},"danger")])}}});function _(e,s,r,a,i,C){const d=v("report-template");return w(),D(d,{title:e.title,period:e.period,rows:e.rows,fields:e.fields,columns:e.columns,canExportCsv:!1,canExportPDf:!1,onReportConfiguration:e.onPeriod},null,8,["title","period","rows","fields","columns","onReportConfiguration"])}const V=y(I,[["render",_]]);export{V as default};
