import{d as U,X as G,ay as K,a3 as M,a6 as P,b1 as W,a4 as H,I as J,_ as Q,Z as X,a7 as Y,a8 as Z,a9 as x,Y as ee,dR as te,dS as ne,j as ie,aj as T,W as q,dw as D,ad as v,ae as y,aa as ae,af as a,a as u,c as h,w as n,b as i,C as d,K as o,E as b,J as I,G as V,a2 as k,M as E}from"./index-CMZASHAR.js";import{_ as se}from"./EncounterMixin.vue_vue_type_script_lang-v2aYCq6R.js";import{A as oe,D as re}from"./anc_treatment_service-BzZoe-tG.js";import{D as $}from"./drug_service-Dy0XwoPz.js";import{A as le}from"./anc_drug_set-bCKHBq_x.js";import"./encounter_guidelines-CJXpBOk4.js";import"./GuidelineEngine-D6V1_Znr.js";import"./HisStandardForm-BCjM4-bc.js";import"./drug_order_service-DwQHOfYk.js";const ue=U({components:{IonHeader:G,IonIcon:K,IonRow:M,IonLabel:P,IonGrid:W,IonCol:H,IonPage:J,IonContent:Q,IonTitle:X,IonInput:Y,IonButton:Z,IonFooter:x,IonToolbar:ee},mixins:[se],setup(){return{add:te,trashBin:ne}},data:()=>({activeDrugs:[],drugSets:[],defaultDrugs:[],isSubmitting:!1,service:{}}),computed:{selectedDrugNames(){return this.activeDrugs.map(e=>e.drug_name||"")}},watch:{ready:{async handler(e){this.activeDrugs=[this.defaultDrugObj()],e&&(this.service=new oe(this.patientID,this.providerID),this.drugSets=(await le.getDrugSets()).map(t=>({label:t.name,value:t.description,other:{drugs:t.drugs}})),this.defaultDrugs=await $.getDrugs({page_size:50}))},immediate:!0}},methods:{printVisitSummary(){return ie(this.patientID)},async onFinish(){if(this.formIsEmpty()){await T("Do you want to proceed without prescribing drugs?")&&(await this.service.createEncounter(),await this.service.saveValueCodedObs("Medication received at vist","No"),await this.printVisitSummary(),this.nextTask());return}if(!this.formIsComplete())return q("Please complete the form");this.isSubmitting=!0;try{return await this.service.submitTreatment(this.activeDrugs),await this.printVisitSummary(),this.nextTask()}catch(e){q("".concat(e)),console.error(e)}this.isSubmitting=!1},getDurationUnit(e){return/week/i.test(e.frequency)?"week(s)":/month/i.test(e.frequency)?"month(s)":"day(s)"},defaultDrugObj(){return{id:0,drug_name:"",dose:"",duration:0,frequency:"",units:""}},formIsComplete(){return this.activeDrugs.every(e=>e.id&&e.duration&&e.frequency)},formIsEmpty(){return this.activeDrugs.length===1&&this.activeDrugs[0].drug_name===""&&this.activeDrugs[0].duration===0&&this.activeDrugs[0].frequency===""},appendDrugSetValues(e){const t=e.other.drugs.reduce((l,c)=>l.concat(c),[]);this.activeDrugs.length===1&&!this.activeDrugs[0].id?this.activeDrugs=t:this.activeDrugs=this.activeDrugs.concat(t.filter(l=>!this.selectedDrugNames.includes(l.drug_name)))},editDrugName(e){D({id:"new_drug",helpText:"Add drug to prescribe",type:v.TT_SELECT,defaultValue:()=>e.drug_name,validation:t=>this.validateSeries([()=>y.required(t),()=>this.selectedDrugNames.includes(t.label)?["Drug already added"]:null]),options:async(t,l)=>{let c=[];return l?c=await $.getDrugs({page_size:50,name:l}):c=this.defaultDrugs,c.map(p=>({label:p.name,value:p.drug_id,other:{dose:p.dose_strength,units:p.units}}))},config:{showKeyboard:!0,isFilterDataViaApi:!0}},t=>{e.id=t.value,e.drug_name=t.label,e.dose=t.other.dose,e.units=t.other.units})},editDrugFrequency(e){D({id:"frequency",helpText:"Edit drug frequency for ".concat(e.drug_name),type:v.TT_SELECT,defaultValue:()=>e.frequency,validation:t=>y.required(t),options:()=>this.mapStrToOptions(Object.keys(re))},t=>{e.frequency=t.label})},editDrugDuration(e){D({id:"duration",helpText:"Edit duration of ".concat(e.drug_name," in days"),type:v.TT_NUMBER,defaultValue:()=>e.duration,validation:t=>y.required(t)},t=>{e.duration=t.value})},async clear(){await T("Are you sure you want to clear all drugs?")&&(this.activeDrugs=[this.defaultDrugObj()])}}});function de(e,t,l,c,p,ce){const A=a("ion-title"),C=a("ion-toolbar"),N=a("ion-header"),f=a("ion-input"),m=a("ion-button"),w=a("ion-icon"),_=a("ion-col"),S=a("ion-row"),F=a("ion-grid"),B=a("ion-label"),j=a("ion-item"),z=a("ion-list"),O=a("ion-content"),L=a("ion-footer"),R=a("ion-page");return u(),h(R,null,{default:n(()=>[i(N,null,{default:n(()=>[i(C,null,{default:n(()=>[i(A,{class:"his-lg-text"},{default:n(()=>t[1]||(t[1]=[d("Treatment")])),_:1})]),_:1})]),_:1}),i(O,null,{default:n(()=>[i(F,null,{default:n(()=>[i(S,{style:{height:"50vh"},class:"his-card section drug-section-style"},{default:n(()=>[i(_,null,{default:n(()=>[o("table",null,[t[3]||(t[3]=o("thead",null,[o("tr",{class:"his-sm-text"},[o("th",null,"Drug"),o("th",null,"Frequency"),o("th",null,"Duration"),o("th")])],-1)),o("tbody",null,[(u(!0),b(I,null,V(e.activeDrugs,(s,r)=>(u(),b("tr",{key:r},[o("td",null,[i(f,{readonly:"",onClick:g=>e.editDrugName(s),value:s.drug_name,placeholder:"Add drug",class:"his-sm-text dosage-input"},null,8,["onClick","value"])]),o("td",null,[i(f,{readonly:"",onClick:g=>e.editDrugFrequency(s),value:s.frequency,class:"his-sm-text dosage-input",placeholder:"Add frequency.."},null,8,["onClick","value"])]),o("td",null,[i(f,{readonly:"",onClick:g=>e.editDrugDuration(s),value:s.duration,placeholder:"Add duration..",class:"dosage-input his-sm-text"},{default:n(()=>[i(m,{slot:"end",fill:"none",disabled:"true"},{default:n(()=>[d(k(e.getDurationUnit(s)),1)]),_:2},1024)]),_:2},1032,["onClick","value"])]),o("td",null,[i(S,null,{default:n(()=>[r+1>=e.activeDrugs.length?(u(),h(_,{key:0,size:"6"},{default:n(()=>[i(m,{disabled:!(s.id&&s.frequency&&s.duration),onClick:t[0]||(t[0]=g=>e.activeDrugs.push(e.defaultDrugObj())),class:"his-md-text",style:{width:"100%"},color:"success"},{default:n(()=>[i(w,{icon:e.add},null,8,["icon"]),t[2]||(t[2]=d(" Add "))]),_:2},1032,["disabled"])]),_:2},1024)):E("",!0),r+1<e.activeDrugs.length||r!=0&&r+1>=e.activeDrugs.length?(u(),h(_,{key:1,size:"6"},{default:n(()=>[i(m,{onClick:g=>e.activeDrugs.splice(r,1),class:"his-lg-text",style:{width:"100%"},color:"danger"},{default:n(()=>[i(w,{icon:e.trashBin},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)):E("",!0)]),_:2},1024)])]))),128))])])]),_:1})]),_:1})]),_:1}),i(z,{style:{height:"29vh"},class:"his-card section"},{default:n(()=>[(u(!0),b(I,null,V(e.drugSets,(s,r)=>(u(),h(j,{class:"his-md-text",detail:"",onClick:g=>e.appendDrugSetValues(s),button:"",key:r},{default:n(()=>[i(B,null,{default:n(()=>[d(k(s.label)+" ("+k(s.value)+")",1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),i(L,null,{default:n(()=>[i(C,{color:"dark"},{default:n(()=>[i(m,{"router-link":e.cancelDestination,slot:"start",size:"large",color:"danger"},{default:n(()=>t[4]||(t[4]=[d(" Cancel ")])),_:1},8,["router-link"]),i(m,{onClick:e.clear,slot:"end",size:"large",color:"warning"},{default:n(()=>t[5]||(t[5]=[d(" Clear ")])),_:1},8,["onClick"]),i(m,{disabled:e.isSubmitting,onClick:e.onFinish,slot:"end",size:"large",color:"success"},{default:n(()=>t[6]||(t[6]=[d(" Finish ")])),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1})}const be=ae(ue,[["render",de],["__scopeId","data-v-4e4c5e6b"]]);export{be as default};
