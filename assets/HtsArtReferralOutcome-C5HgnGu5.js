import{bk as D,d as F,I as C,K as g,dF as k,F as u,aT as l,ai as N,_ as O,r as f,o as S,c as x,w,b as E}from"./index-BFVcutZq.js";import{g as L}from"./LocationFieldOptions-C8xpWQA4.js";import{H as I}from"./HisStandardForm-DO3sZVdL.js";import"./storage-DBvOSj8j.js";class _ extends D{constructor(t,i=-1){super(t,10,i)}}const H=F({components:{IonPage:C,HisStandardForm:I},setup(){const r=g([]),t=new _(-1),{visitID:i,htsClient:d,yesNoOptions:m,saveEncounter:p,mapStrToOptions:s,patientDashboardUrl:c}=k({onInitVisit:()=>{r.value=[v(),h(),...V(),A(),R(),y()]}});function T(e,n){p({encounterName:"ART Referral Outcome",encounterTypeID:t.encounterTypeID,computedData:n})}function v(){let e=!1,n=[],b=!1;return{id:"on_art",helpText:"ART Summary",type:u.TT_HIDDEN,init:async()=>{try{const o=await l.getProgramInformation(i.value);b=o&&/Linked|art/i.test(o.art_outcome);const a=await l.getProgramSummary(i.value,1);if(e=[!/unknown/.test(a.current_outcome),!/n\/a/i.test(a.art_start_date)].every(Boolean),!e)return!0;n=[{label:"Outcome",value:a.current_outcome,other:{obs:()=>t.buildValueCoded("Antiretroviral status or outcome","Linked")}},{label:"Outcome date",value:a.art_start_date,other:{obs:()=>t.buildValueDate("Outcome date",a.art_start_date)}},{label:"Facility",value:l.getLocationName(),other:{obs:()=>t.buildValueText("ART clinic location","".concat(l.getLocationName()))}},{label:"ARV Number",value:a.arv_number,other:{obs:()=>t.buildValueText("Art number",a.arv_number)}}]}catch(o){console.error(o)}return!0},summaryMapValue:o=>o,condition:()=>e,defaultValue(){return n},finalComputedValue:o=>{if(!b)return{obs:o.filter(a=>typeof a.other.obs=="function").map(a=>a.other.obs())}},options:()=>n}}function h(){return{id:"outcome",helpText:"ART Outcome Referral",type:u.TT_SELECT,isRequired:()=>!0,condition:e=>e.on_art===null,finalComputedValue:e=>({obs:t.buildValueCoded("Antiretroviral status or outcome",e.value)}),options:()=>s(["Linked","Refused","Died","Already on ART","Unknown"])}}function A(){return{id:"art_site",helpText:"Visited Clinic Name",type:u.TT_SELECT,isRequired:()=>!0,condition:e=>/Linked|Already on art/i.test(e.outcome.value),finalComputedValue:e=>({obs:t.buildValueText("ART clinic location",e.label)}),options:(e,n="")=>L(n),config:{footerBtns:[{name:"Here",slot:"end",onClickComponentEvents:{setValue:()=>_.getLocationName()},onClick:()=>null}],showKeyboard:!0,isFilterDataViaApi:!0}}}function V(){return N({id:"outcome_date",helpText:"Outcome",required:!0,minDate:()=>d.birthDate,maxDate:()=>t.date,condition:e=>!/unknown/i.test(e.outcome.value),computeValue:e=>({date:e,obs:t.buildValueDate("Outcome date",e)}),estimation:{allowUnknown:!1}})}function R(){return{id:"has_arv_number",helpText:"ARV Number available",type:u.TT_YES_NO,isRequired:()=>!0,condition:e=>/linked|already on art/i.test(e.outcome.value),options:()=>[{label:"ARV number available?",values:m()}]}}function y(){return{id:"arv_number",helpText:"ARV Number",type:u.TT_TEXT,isRequired:()=>!0,condition:e=>e.has_arv_number==="Yes",finalComputedValue:e=>({obs:t.buildValueText("Art number","".concat(e.value))})}}return{patientDashboardUrl:c,onFinish:T,fields:r}}});function P(r,t,i,d,m,p){const s=f("his-standard-form"),c=f("ion-page");return S(),x(c,null,{default:w(()=>[E(s,{formLabel:"ART Referral outcome",fields:r.fields,onFinishAction:r.onFinish,cancelDestinationPath:r.patientDashboardUrl()},null,8,["fields","onFinishAction","cancelDestinationPath"])]),_:1})}const K=O(H,[["render",P]]);export{K as default};
