import{d as N,S as c,c8 as O,a7 as U,c9 as z,ah as j,l as q,b8 as Y,m as G,I as Q,n as Z,cv as J,aw as K,a4 as W,cw as F,aZ as X,au as x,aY as h,bq as f,y as _,cj as ee,B as te,z as oe,x as b,ak as se,h as d,aL as re,a as g,a6 as l,cx as ie,e as s,w as o,ap as r,g as a,j as p,t as u,a9 as S,aa as ae,b as n,cy as ne}from"./index-y6JY22M4.js";import{a as le,t as pe}from"./Export-CltTNrmu.js";import{H as ue}from"./HisStandardForm-CXnAooxi.js";import{R as ce}from"./ReportErrors-D7aI-1S2.js";const he=N({components:{HisStandardForm:ue,IonHeader:W,ReportTable:K,HisFooter:J,IonPage:Z,IonContent:Q,IonToolbar:G,IonChip:Y,IonFooter:q,IonLabel:j,IonThumbnail:z,IonItem:U,IonImg:O},props:{encryptPDF:{type:Boolean,default:!1},showValidationStatus:{type:Boolean,default:!1},validationErrors:{type:Array,default:()=>[]},config:{type:Object},headerInfoList:{type:Array,default:()=>[]},reportPrefix:{type:String,default:""},reportLogo:{type:String},showtitleOnly:{type:Boolean,default:!1},title:{type:String,required:!0},period:{type:String},showFilters:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},columns:{type:Object,required:!0},rows:{type:Object,required:!0},customBtns:{type:Array,default:()=>[]},hasServerSideCaching:{type:Boolean,default:!1},canExportPDf:{type:Boolean,default:!0},canExportCsv:{type:Boolean,default:!0},enabledPDFHorizontalPageBreak:{type:Boolean,default:!1},onFinishBtnAction:{type:Function},onReportConfiguration:{type:Function,required:!0},onDefaultConfiguration:{type:Function},customFileName:{type:String,default:""}},data:()=>({date:"",formData:{},btns:[],computeFormData:{},activeColumns:[],activeRows:[],isLoadingData:!1,canShowReport:!1,siteUUID:c.getSiteUUID(),apiVersion:c.getApiVersion(),coreVersion:c.getCoreVersion(),artVersion:c.getAppVersion(),tableCssTheme:"art-report-theme"}),watch:{validationErrors:{handler(e){h.isEmpty(e)||this.showErrors()},deep:!0,immediate:!0},fields:{handler(e){h.isEmpty(e)?(this.canShowReport=!0,this.refreshTimeStamp()):(this.canShowReport=!1,this.btns.forEach(t=>{t.name==="Back"&&(t.visible=!0)}))},immediate:!0}},computed:{logo(){if(!this.reportLogo&&typeof this.reportPrefix=="string"){if(this.reportPrefix.match(/pepfar/i))return b("login-logos/PEPFAR.png");if(this.reportPrefix.match(/moh/i))return b("login-logos/Malawi-Coat_of_arms_of_arms.png")}return b("reports.png")},hasErrors(){return!h.isEmpty(this.validationErrors)},errorCount(){return this.validationErrors?this.validationErrors.length:0},footerRows(){const e=[["Date Created: ".concat(this.date)]];return this.period&&e.push(["Quarter: ".concat(this.period)]),e.push(["HIS-Core Version: ".concat(this.coreVersion)]),e.push(["API Version: ".concat(this.apiVersion)]),e.push(["Site UUID: ".concat(this.siteUUID)]),e.push(["Generated by: ".concat(c.getUserName())]),e}},methods:{async showErrors(){(await oe.create({component:ce,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:this.validationErrors}})).present()},pdfEncryptionData(){const e=c.getUserName();return{encryption:{userPassword:e,ownerPassword:e,userPermissions:["print"]}}},refreshTimeStamp(){this.date=te().format("DD/MMM/YYYY HH:MM:ss")},onActiveColumns(e){this.activeColumns=e},onActiveRows(e){this.activeRows=e},getFileName(){var e;return this.customFileName||"".concat(this.reportPrefix," ").concat(c.getLocationName()," ").concat(ee(this.title).replace(this.reportPrefix,"")," ").concat((e=this.period)!=null?e:this.date)},async onLoadDefault(){this.canShowReport=!0,await this.presentLoading();try{this.refreshTimeStamp(),this.onDefaultConfiguration&&await this.onDefaultConfiguration(),f.dismiss()}catch(e){_("".concat(e)),console.error(e),f.dismiss()}},async onFinish(e,t,y=!1){this.formData=e,this.computeFormData=t,this.canShowReport=!0,await this.presentLoading();try{this.refreshTimeStamp(),await this.onReportConfiguration(this.formData,this.computeFormData,y),f.dismiss()}catch(w){_("".concat(w)),console.error(w),f.dismiss()}},async reloadReport(e=!1){if(!h.isEmpty(this.formData)||!h.isEmpty(this.computeFormData)){await this.onFinish(this.formData,this.computeFormData,e);return}this.onDefaultConfiguration&&await this.onLoadDefault()},async presentLoading(){await(await f.create({message:"Please wait...",backdropDismiss:!1})).present()}},created(){this.onDefaultConfiguration&&this.onLoadDefault(),this.btns=this.customBtns,this.btns.push({name:"CSV",size:"large",slot:"start",color:"primary",visible:this.canExportCsv,onClick:async()=>{const{columns:e,rows:t}=F(this.activeColumns,this.activeRows,"csvMode");le(e,[...t,...this.footerRows],this.getFileName())}}),this.btns.push({name:"PDF",size:"large",slot:"start",color:"primary",visible:this.canExportPDf,onClick:async()=>{let e="pdfMode";this.encryptPDF&&(e=await X("Security warning","PDF may contain private data that will require a password to unlock","To access private data choose Secure PDF over Regular PDF",[{name:"Secure PDF",slot:"start",color:"success"},{name:"Regular PDF",slot:"start",color:"success"}],"his-danger-color")==="Secure PDF"?"pdfMode":"ignorePDFColumnexport");const{columns:t,rows:y}=F(this.activeColumns,this.activeRows,e);pe(t,y,this.getFileName(),this.enabledPDFHorizontalPageBreak,this.encryptPDF&&e!="ignorePDFColumnexport"?this.pdfEncryptionData():{})}}),this.btns.push({name:"Refresh/Rebuild",size:"large",slot:"end",color:"warning",visible:!0,onClick:async()=>{let e=!1;this.hasServerSideCaching&&(e=await x("Do you want to rebuild report cache?",{header:"Rebuild Report"})),this.reloadReport(e)}}),this.btns.push({name:"Back",size:"large",slot:"end",color:"primary",visible:!h.isEmpty(this.fields),onClick:()=>this.canShowReport=!1}),this.btns.push({name:"Finish",size:"large",slot:"end",color:"success",visible:!0,onClick:()=>{this.onFinishBtnAction?this.onFinishBtnAction():this.$router.push({path:"/"})}})}}),de=["innerHTML"],me={class:"header-text-list"},fe=["onClick"],ge={key:1},ye=["innerHTML"],we={key:0},be={class:"report-content"};function Ce(e,t,y,w,De,ve){const P=r("his-standard-form"),R=r("ion-title"),k=r("ion-img"),E=r("ion-thumbnail"),m=r("ion-chip"),I=r("ion-label"),B=r("ion-item"),C=r("ion-toolbar"),A=r("ion-header"),V=r("report-table"),T=r("ion-content"),L=r("ion-footer"),$=r("his-footer"),H=r("ion-page");return n(),d(S,null,[re(s(P,{onOnFinish:e.onFinish,skipSummary:!0,fields:e.fields},null,8,["onOnFinish","fields"]),[[ie,!e.canShowReport]]),e.canShowReport?(n(),g(H,{key:0},{default:o(()=>[s(A,null,{default:o(()=>[s(C,null,{default:o(()=>[e.showtitleOnly?(n(),g(R,{key:0},{default:o(()=>[a("span",{innerHTML:e.title},null,8,de)]),_:1})):l("",!0),e.showtitleOnly?l("",!0):(n(),g(B,{key:1},{default:o(()=>[s(E,{slot:"start"},{default:o(()=>[s(k,{src:e.logo},null,8,["src"])]),_:1}),s(I,null,{default:o(()=>[a("ul",me,[a("li",null,[t[0]||(t[0]=p("Title ",-1)),a("b",null,u(e.title),1)]),a("li",null,[t[1]||(t[1]=p("Period ",-1)),a("b",null,u(e.period),1)]),(n(!0),d(S,null,ae(e.headerInfoList,(i,M)=>{var D,v;return n(),d("li",{key:M},[p(u(i.label)+" ",1),i&&((D=i==null?void 0:i.other)!=null&&D.onclick)?(n(),d("a",{key:0,href:"#",onClick:ne(Fe=>i.other.onclick(),["prevent"])},u(i.value),9,fe)):l("",!0),i&&!((v=i==null?void 0:i.other)!=null&&v.onclick)?(n(),d("b",ge,[a("span",{innerHTML:i.value},null,8,ye)])):l("",!0)])}),128)),e.showValidationStatus?(n(),d("li",we,[e.hasErrors?(n(),g(m,{key:0,onClick:e.showErrors,color:"danger"},{default:o(()=>[a("b",null,u(e.errorCount),1),t[2]||(t[2]=p(" Error(s) found. Click for more ",-1))]),_:1},8,["onClick"])):l("",!0),e.hasErrors?l("",!0):(n(),g(m,{key:1,color:"success"},{default:o(()=>[...t[3]||(t[3]=[p(" Report is Consistent ",-1)])]),_:1}))])):l("",!0)])]),_:1})]),_:1}))]),_:1})]),_:1}),s(T,null,{default:o(()=>[a("div",be,[s(V,{rows:e.rows,columns:e.columns,showFilters:e.showFilters,config:{...e.config,tableCssTheme:e.tableCssTheme},onOnActiveColumns:e.onActiveColumns,onOnActiveRows:e.onActiveRows},null,8,["rows","columns","showFilters","config","onOnActiveColumns","onOnActiveRows"])])]),_:1}),s(L,null,{default:o(()=>[s(C,null,{default:o(()=>[s(m,{color:"primary"},{default:o(()=>[t[4]||(t[4]=p("Date Created: ",-1)),a("b",null,u(e.date),1)]),_:1}),s(m,{color:"primary"},{default:o(()=>[t[5]||(t[5]=p("His-Core Version: ",-1)),a("b",null,u(e.coreVersion),1)]),_:1}),s(m,{color:"primary"},{default:o(()=>[t[6]||(t[6]=p("API Version: ",-1)),a("b",null,u(e.apiVersion),1)]),_:1})]),_:1})]),_:1}),s($,{btns:e.btns},null,8,["btns"])]),_:1})):l("",!0)],64)}const ke=se(he,[["render",Ce],["__scopeId","data-v-6ccbfe61"]]);export{ke as R};
