var g=Object.defineProperty;var _=(e,i,t)=>i in e?g(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var p=(e,i,t)=>_(e,typeof i!="symbol"?i+"":i,t);import{_ as O}from"./EncounterMixin.vue_vue_type_script_lang-v2aYCq6R.js";import{bQ as v,d as k,I as y,bx as S,ad as a,ae as o,aN as d,aj as h,dO as f,aa as E,af as T,a as F,c as w,w as V,b as L}from"./index-CMZASHAR.js";import{A as b}from"./anc_current_pregnancy-C2a3KiMr.js";import"./encounter_guidelines-CJXpBOk4.js";import"./GuidelineEngine-D6V1_Znr.js";import"./HisStandardForm-BCjM4-bc.js";const u={12:14,13:15,14:16,15:17,16:18,17:19,18:20,19:22,20:23,21:24,22:25,23:26,24:27,"24.5":28,25:29,26:30,27:31,28:32,29:33,30:34,31:35,"31.5":36,32:37,33:38,34:39,35:40,36:42};class N extends v{constructor(t,n){super(t,98,n);p(this,"gestationWeeks");p(this,"visitNumber");this.gestationWeeks=0,this.visitNumber=0}isFirstVisit(){return this.visitNumber===1}expectedFundalHeightForGestationWeeks(){return this.getEquivalentFundalHeight(this.gestationWeeks)}async loadPregnancyStatus(){var n;const t=await v.getJson("programs/".concat(this.programID,"/patients/").concat(this.patientID));if(t){const s=t.date_of_lnmp;if(s){const r=new b(this.patientID,this.providerID);this.gestationWeeks=r.calculateWeekOfFirstVisit(s),this.visitNumber=(n=t.anc_visits)!=null?n:0}}}getEquivalentFundalWeeks(t){return t<12?u[12]:t>37?u[37]:u[t]}getEquivalentFundalHeight(t){for(const n in u){const s=u[n];if(t<=s)return parseInt(n)}return t>42?37:t<13?12:0}}const x=k({components:{IonPage:y},mixins:[O],data:()=>({service:{},statusService:{},deliveryObs:void 0}),watch:{ready:{async handler(e){e&&(this.service=new N(this.patientID,this.providerID),await this.service.loadPregnancyStatus(),this.fields=this.getFields())},immediate:!0}},methods:{async onFinish(e,i){var t;await this.service.createEncounter(),await this.service.saveObservationList(await this.resolveObs(i)),(t=this.deliveryObs)!=null&&t.length&&(await this.statusService.createEncounter(),await this.statusService.saveObservationList(await Promise.all(this.deliveryObs))),this.nextTask()},diagnosisOptions(e){return[...S.getConceptsByCategory("anc_diagnosis"),{name:"None"}].map(i=>e({...this.toOption(i.name),isChecked:!1}))},getFields(){return[{id:"ultrasound",helpText:"Ultrasound scan results available",type:a.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueCoded("Ultrasound",e.value),options:()=>this.yesNoOptions()},{id:"multiple_gestation",helpText:"Number of fetuses",type:a.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueText("Multiple gestation",e.value),condition:e=>e.ultrasound.value==="Yes",options:()=>[{label:"One",value:1},{label:"Two",value:2},{label:"Three",value:3},{label:"Four",value:4},{label:"Unknown",value:"Unknown"}]},{id:"liquor",helpText:"Liquor",type:a.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueText("LIQUOR",e.value),condition:e=>e.ultrasound.value==="Yes",options:()=>this.mapStrToOptions(["Adequate","Not adequate","Unknown"])},{id:"lie",helpText:"Lie",type:a.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueText("Lie",e.value),condition:e=>e.ultrasound.value==="Yes",options:()=>this.mapStrToOptions(["Longitudinal","Transverse","Unknown"])},{id:"fetal_heart_movement_seen",helpText:"Fetal heart movement seen",type:a.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueCoded("Fetal heart movement seen",e.value),condition:e=>e.ultrasound.value==="Yes",options:()=>this.yesNoOptions()},{id:"presentation",helpText:"Presentation",type:a.TT_GROUP_SELECTOR,validation:e=>this.validateSeries([()=>o.required(e),()=>e&&!e.value?["Presentation cannot be Empty!"]:null,()=>{var i,t,n;return e&&((i=e==null?void 0:e.other)!=null&&i.subGroupOptions)&&d.isEmpty((t=e==null?void 0:e.other)==null?void 0:t.subGroupOptionValue)?["".concat(((n=e==null?void 0:e.other)==null?void 0:n.subgroupTitle)||"Subgroup"," has no value selected")]:null},()=>{var i,t,n,s,r,l,c,m;return e&&!d.isEmpty((i=e==null?void 0:e.other)==null?void 0:i.subGroupOptionValue)&&!d.isEmpty((s=(n=(t=e==null?void 0:e.other)==null?void 0:t.subGroupOptionValue)==null?void 0:n.other)==null?void 0:s.options)&&!((l=(r=e==null?void 0:e.other)==null?void 0:r.subGroupOptionValue)!=null&&l.value)?["".concat((m=(c=e==null?void 0:e.other)==null?void 0:c.subGroupOptionValue)==null?void 0:m.label,"'s value isnt selected")]:null}]),computedValue:e=>{var t,n,s,r;const i=[this.service.buildValueText("Presentation",e.label)];return(n=(t=e==null?void 0:e.other)==null?void 0:t.subGroupOptionValue)!=null&&n.value&&i.push(this.service.buildValueText("Position",(r=(s=e==null?void 0:e.other)==null?void 0:s.subGroupOptionValue)==null?void 0:r.value)),i},options:e=>{const i=(n,s="",r={})=>({label:n,value:s,other:r}),t=[i("Vertex","",{options:this.mapStrToOptions(["Left Occipito Anterior","Left Occipito Transverse","Left Occipito Posterior","Right Occipito Anterior","Right Occipito Transverse","Right Occipito Posterior","Unknown"])}),this.toOption("Oblique"),this.toOption("Transverse"),this.toOption("Breech",{options:this.mapStrToOptions(["Left Sacro Anterior","Left Sacro Transverse","Left Sacro Posterior","Right Sacro Anterior","Right Sacro Transverse","Right Sacro Posterior","Unknown"])}),i("Face","",{concept:"Position",options:this.mapStrToOptions(["Left Mento Anterior","Left Mento Transverse","Left Mento Posterior","Right Mento Anterior","Right Mento Transverse","Right Mento Posterior","Unknown"])}),i("Shoulder","",{options:this.mapStrToOptions(["Left Acromion Dorsal Anterior","Left Acromion Dorsal Transverse","Left Acromion Dorsal Posterior","Right Acromion Dorsal Anterior","Right Acromion Dorsal Transverse","Right Acromion Dorsal Posterior","Unknown"])})];return e.presentation?e.presentation:[i("Cephalic","",{subGroupOptions:t,subgroupTitle:"Cephalic Position",options:this.mapStrToOptions(["Right Occipito Anterior","Left Occipito Anterior","Unknown"])}),i("Breech","",{subGroupOptions:t,subgroupTitle:"Breech Position",options:this.mapStrToOptions(["Right Sacro Anterior","Left Sacro Anterior","Unknown"])}),this.toOption("Ball"),this.toOption("Nil palpable")]}},{id:"enter_fundal_height",helpText:"Fundal height (cm)",type:a.TT_NUMBER,condition:()=>this.service.gestationWeeks>=12,dynamicHelpText:()=>{const e="Fundal height (cm)";return this.service.gestationWeeks?"".concat(e," (").concat(this.service.gestationWeeks,"wks/").concat(this.service.getEquivalentFundalHeight(this.service.gestationWeeks)," cm)"):e},beforeNext:async(e,i)=>{if(e&&"".concat(e.value).match(/unknown/i)&&!["Nil palpable","Ball"].includes(i.presentation.value))return h("Do you want to proceed with Unknown Fundal height?");const t=this.service.expectedFundalHeightForGestationWeeks(),n=parseInt(e.value);if(this.service.gestationWeeks&&(n<t||n>t)){if(!await h("\n                        Fundal height is not equal to expected ".concat(t," cm from gestation weeks of ").concat(this.service.gestationWeeks,".\n                        Are you sure about this value?")))return!1;if(this.service.isFirstVisit()){this.statusService=new b(this.patientID,this.providerID);const r=this.service.getEquivalentFundalWeeks(n),l=this.statusService.estimateLnmpDate(r,this.service.date);this.deliveryObs=this.statusService.buildDelieveryDateObs(l)}}return!0},validation:e=>this.validateSeries([()=>o.required(e),()=>e&&!"".concat(e.value).match(/unknown/i)?o.rangeOf(e,10,45):null]),computedValue:e=>e.value!="Unknown"?this.service.buildValueNumber("Fundus",e.value):this.service.buildObs("Fundus",{value_coded:e.value,value_numeric:0}),config:{keypad:f}},{id:"fetal_heart_beat",helpText:"Fetal heart beat",type:a.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueText("Fetal Heart Beat",e.value),options:()=>this.mapStrToOptions(["Heard","Not heard"])},{id:"fetal_heart_rate",helpText:"Fetal heart rate",type:a.TT_NUMBER,validation:e=>o.required(e),beforeNext:async e=>{const n=e?parseInt(e.value):-1;return e&&typeof n=="number"&&(n<120||n>140)?!!await h("\n                            The value is out of Range of 120 - 140.\n                            Are you sure about this value?"):!0},condition:e=>e.fetal_heart_beat.value==="Heard",computedValue:e=>e.value!="Unknown"?this.service.buildValueNumber("Fetal heart movement seen",e.value):this.service.buildObs("Fetal heart movement seen",{value_numeric:0,value_coded:e.value}),config:{keypad:f}},{id:"enter_fetal_movement",helpText:"Fetal movement heard",type:a.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueCoded("Fetal movement heard","".concat(e.value)),options:()=>this.yesNoOptions()},{id:"fetal_movement_felt",helpText:"Fetal movement felt",type:a.TT_SELECT,validation:e=>o.required(e),condition:e=>!["Ball","Nil palpable"].includes(e.presentation.label),computedValue:e=>this.service.buildValueCoded("Fetal movement felt","".concat(e.value)),options:()=>this.yesNoOptions()},{id:"last_fmf",helpText:"Last fetal movement felt (in Weeks)",type:a.TT_NUMBER,validation:e=>o.validateSeries([()=>o.required(e),()=>o.rangeOf(e,0,42)]),condition:e=>e.fetal_movement_felt.value!="Unknown",computedValue:e=>e.value!="Unknown"?this.service.buildValueNumber("Last Fetal movement felt",e.value):this.service.buildObs("Last Fetal movement felt",{value_numeric:0,value_coded:e.value}),options:()=>this.yesNoUnknownOptions()},{id:"diagnosis",helpText:"Diagnosis",type:a.TT_MULTIPLE_SELECT,validation:e=>o.required(e),computedValue:e=>e&&e.map(i=>i.value).includes("None")?[]:e.map(i=>this.service.buildValueCoded(i.label,"Yes")),onValueUpdate(e,i){return e.map(t=>(i.value==="None"&&t.value!="None"&&(t.isChecked=!1),i.value!="None"&&i.isChecked&&t.value==="None"&&(t.isChecked=!1),t))},options:()=>this.diagnosisOptions(e=>e),config:{footerBtns:[{name:"None",slot:"end",onClickComponentEvents:{refreshOptions:()=>this.diagnosisOptions(e=>(e.isChecked=e.label==="None",e))},onClick:()=>"None"}]}}]}}});function C(e,i,t,n,s,r){const l=T("his-standard-form"),c=T("ion-page");return F(),w(c,null,{default:V(()=>[L(l,{fields:e.fields,skipSummary:!0,onFinishAction:e.onFinish,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])]),_:1})}const W=E(x,[["render",C]]);export{W as default};
