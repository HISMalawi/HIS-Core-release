import{d as T,r as v,bI as b,dO as g,ab as I,dS as D,a9 as E,ac as h,cW as l,u as N,v as P,w as y,x as A,y as p,a5 as w}from"./index-LyP1z09P.js";import{H as k}from"./HisStandardForm-DTr2fl7A.js";import{u as C}from"./useEncounter-aN4Ia2f8.js";import{g as u}from"./util-KW2bx-74.js";import{r as S}from"./commons-P78U_Jw3.js";import{A as d}from"./appointment_service-hOEr4jLO.js";import"./isEmpty-XyLlvQzF.js";import"./encounter_guidelines-6akTZ644.js";import"./GuidelineEngine-syyQoOzo.js";const R=T({__name:"Appointment",setup(F){const r=v([]),t=new b(-1,g.APPOINTMENT),{goToNextTask:m,patientDashboardUrl:c}=C((n,o)=>{t.patientID=o,t.providerID=n;const f=()=>{let e={},s=-1,i={};return{id:"appointment",helpText:"Appointment booking",type:I.TT_DATE_PICKER,init:async()=>(s=await E.get(D.CLINIC_APPOINTMENT_LIMIT),e=await d.getJson("programs/".concat(t.programID,"/patients/").concat(o,"/next_appointment_date"),{date:t.date}),!0),defaultValue:()=>e==null?void 0:e.appointment_date,validation:a=>h.required(a),computedValue:a=>[{concept_id:u("APPOINTMENT_DATE"),value_datetime:a,obs_datetime:t.date},{concept_id:u("ESTIMATED_DATE"),value_datetime:e==null?void 0:e.appointment_date,obs_datetime:t.date}],config:{minDate:()=>t.date,maxDate:()=>e==null?void 0:e.drugs_run_out_date,supValue:a=>"".concat((i[a]||[]).length),infoItems:async a=>(i[a]||(i[a]=await d.getJson("programs/".concat(t.programID,"/booked_appointments"),{date:a,paginate:!1})),[{label:"Medication Run out Date",value:l((e==null?void 0:e.drugs_run_out_date)||"Not available")},{label:"User set appointment date",value:l(a)},{label:"Appointments",value:(i[a]||[]).length},{label:"Appointment limit (per/day)",value:s||"N/A"}]),hiddenFooterBtns:["Clear"]}}};r.value=[f()]});async function _(n,o){await t.createEncounter(),await t.saveObservationList(await S(o)),m()}return(n,o)=>(N(),P(p(w),null,{default:y(()=>[A(k,{cancelDestinationPath:p(c),onFinishAction:_,fields:r.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{R as default};
