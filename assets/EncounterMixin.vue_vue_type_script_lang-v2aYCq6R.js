import{d as c,aw as l,aN as u,am as d,bn as p,ak as m}from"./index-CMZASHAR.js";import{F as o,E as f}from"./encounter_guidelines-CJXpBOk4.js";import{m as D}from"./GuidelineEngine-D6V1_Znr.js";import{H as v}from"./HisStandardForm-BCjM4-bc.js";const T=c({components:{HisStandardForm:v},data:()=>({patient:{},fields:[],patientID:"",providerID:-1,providers:[],facts:{sessionDate:"",apiDate:"",encounterName:"N/A",providers:[],isBdeMode:!1,birthDate:"",outcome:"",outcomeStartDate:""},ready:!1}),watch:{$route:{handler(t){t.params.patient_id&&this.patientID!=t.params.patient_id&&(this.patientID=parseInt(t.params.patient_id),l.get("ACTIVE_PATIENT",{patientID:this.patientID}).then(s=>{this.patient=s,this.setEncounterFacts().then(()=>{this.checkEncounterGuidelines().then(()=>{this.ready=!0})})}))},immediate:!0,deep:!0}},computed:{cancelDestination(){return this.patientDashboardUrl()}},methods:{runflowState(t,s=null){const e={};if(e[o.SET_PROVIDER]=a=>{const[n]=a.split(" "),r=u.find(this.providers,{username:n});return r&&(this.providerID=r.person_id),o.CONTINUE},e[o.CHANGE_SESSION_DATE]=()=>(this.$router.push("/session/date?patient_dashboard_redirection_id=".concat(this.patientID)),o.EXIT),e[o.CHANGE_PATIENT_OUTCOME]=()=>(this.$router.push("/patient/programs/".concat(this.patientID)),o.EXIT),e[o.GO_TO_PATIENT_DASHBOARD]=()=>(this.gotoPatientDashboard(),o.EXIT),t in e)return e[t](s)},async checkEncounterGuidelines(){var s,e,a,n;const t=D(this.facts,f);for(const r in t){const i=t[r];if((s=i==null?void 0:i.actions)!=null&&s.alert&&this.runflowState(await((e=i==null?void 0:i.actions)==null?void 0:e.alert(this.facts)))===o.EXIT)return;if((a=i==null?void 0:i.actions)!=null&&a.selection){const h=await((n=i==null?void 0:i.actions)==null?void 0:n.selection(this.facts));this.runflowState(h.flowState,h.value)}}},async setEncounterFacts(){try{const t=await l.get("PATIENT_PROGRAM",{patientID:this.patientID});this.facts.outcome=t.outcome,this.facts.outcomeStartDate=t.startDate}catch(t){console.error(t),d("".concat(t))}if(this.facts.sessionDate=p.getSessionDate(),this.facts.apiDate=p.getCachedApiDate(),this.facts.isBdeMode=p.isBDE(),this.facts.birthDate=this.patient.getBirthdate(),this.facts.encounterName=this.$route.name?this.$route.name.toString().toUpperCase():"N/A",p.isBDE()){this.providers=await l.get("PROVIDERS");const t=u.find(this.providers,e=>e.user_id==p.getUserID());this.providers=this.providers.sort((e,a)=>{const n=e.username.toUpperCase(),r=a.username.toUpperCase();return n<r?-1:n>r?1:0});const s=t?[t,...this.providers]:this.providers;this.facts.providers=u.uniq(s.map(e=>{var n,r;let a="".concat(e.username);if(!u.isEmpty((n=e==null?void 0:e.person)==null?void 0:n.names)){const[i]=((r=e.person)==null?void 0:r.names)||[];a+=" (".concat(i.given_name," ").concat(i.family_name,")")}return a}))}},toOption(t,s={}){return{label:t,value:t,other:s}},mapStrToOptions(t){return t.map(s=>({label:s,value:s}))},patientDashboardUrl(){return"/patient/dashboard/".concat(this.patientID)},gotoPatientDashboard(){return this.$router.push({path:this.patientDashboardUrl()})},nextTask(){return m(this.patientID,this.$router)},getOptions(t,s){return t.map(e=>{const a=u.find(s,{label:e});return{label:e,value:a?a.value:"",other:{values:this.yesNoOptions()}}})},yesNoOptions(){return[{label:"Yes",value:"Yes"},{label:"No",value:"No"}]},toYesNoOption(t,s={}){return{label:t,value:"",other:{...s,values:this.yesNoOptions()}}},mapOptions(t){return t.map(s=>({label:s,value:s}))},yesNoUnknownOptions(){return[{label:"Yes",value:"Yes"},{label:"No",value:"No"},{label:"Unknown",value:"Unknown"}]},resolveObs(t,s=""){const e=Object.values(t).filter(a=>a&&(a.tag===s||s==="")).reduce((a,n)=>{const r=n.obs?n.obs:n;return Array.isArray(r)?a=a.concat(r):typeof r=="function"?a.push(r()):a.push(r),a},[]);return Promise.all(e)},inArray(t,s){try{return t.filter(e=>s(e)).length>0}catch(e){return!1}},validateSeries(t){try{for(const s in t){const e=t[s]();if(e)return e}}catch(s){return[s]}}}});export{T as _};
