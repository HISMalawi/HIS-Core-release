import{d as T,I as y,cg as A,K as h,N as $,ac as B,t as x,ae as C,ch as E,O as c,q as I,ci as k,cj as q,_ as N,r as v,o as O,c as j,w as S,b as w}from"./index-BzVWU-6u.js";import{D as U}from"./ReportDateSelectionPrompt-BUka0vzS.js";import{T as L}from"./tx_report_service-BSoiWAj-.js";import{v as G}from"./TableView-CIAE159z.js";import{A as P}from"./ArtDrilldown-AYOsHY7t.js";import"./fuse-YdZE3OCN.js";import"./Export-PjGFz1RJ.js";import"./HisKeyboard-mYPg-10z.js";const V=T({components:{IonPage:y,IonLoading:A,v2Datatable:G},setup(){const t=h([]),p=h(""),m=h(!1),u=h([]),o=new L;function r(s,d){return{ref:d,label:s,toValue:e=>e.length,tdClick:async e=>{e.refData.length&&(await c.create({component:P,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"".concat(e.data.age_group," ").concat(e.data.gender," ").concat(e.column.label),patientIdentifiers:e.refData,onFinish:()=>c.getTop().then(l=>l&&c.dismiss())}})).present()}}}const b=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},r("CD4 <200","cd4_less_than_200"),r("CD4 >=200","cd4_greater_than_or_equal_to_200"),r("Unknown CD4","unknown_cd4_count"),r("Not Eligible for CD4","not_eligible_for_cd4"),r("Returned <3 mo","returned_less_than_3_months"),r("Returned 3-5 mo","returned_greater_than_3_months_and_less_than_6_months"),r("Returned 6+ mo","returned_greater_than_or_equal_to_6_months")]],_=async()=>{o.startDate&&o.endDate||x("Start date and end date required!"),m.value=!0;try{const s=await o.getTxRttReport(),d={F:"Female",M:"Male"},e=s.reduce((n,a)=>(a.age_group!="Unknown"&&(n[a.gender].rows.push({...a,gender:d[a.gender]}),n[a.gender].aggregate=Object.keys(a).reduce((g,i)=>Array.isArray(a[i])?{...g,[i]:[...g[i]||[],...a[i]]}:g,n[a.gender].aggregate)),n),{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});t.value=[...e.F.rows,...e.M.rows,{age_group:"All",gender:"Male",...e.M.aggregate}];const l=Object.values(e.F.aggregate).flat(1),D=await o.getMaternalStatus(C.uniq(l)),R=D.FBf.concat(D.FP);["FP","FNP","FBf"].forEach(n=>{t.value.push(Object.keys(e.F.aggregate).reduce((a,g)=>({...a,[g]:e.F.aggregate[g].filter(i=>n==="FNP"?!R.includes(i):D[n].includes(i))}),{age_group:"All",gender:n}))}),t.value=t.value.map((n,a)=>({index:a+1,...n}));const M=Object.values(e.M.aggregate).flat(1),F=C.uniq([...l,...M]);u.value=[{id:"stats",text:"Total <b>".concat(F.length,"</b>"),icon:E,color:"primary",action:async()=>{(await c.create({component:P,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"Total Clients",subtitle:p.value,patientIdentifiers:F,onFinish:()=>c.getTop().then(n=>n&&c.dismiss())}})).present()}}]}catch(s){console.error(s),I("Unable to generate report!"),u.value=[{text:"Unable to generate report!",color:"danger",icon:k,action:function(){u.value=[{text:"Exception occured: <b>".concat(s,"</b>"),color:"danger",icon:q}]}}]}m.value=!1},f=()=>U({onFinish:(s,d,e,l)=>{p.value=e,o.startDate=s,o.endDate=d,l&&o.setOccupation(l),_()}});return $(()=>f()),{headerBadge:u,reportData:t,isLoading:m,Img:B,configure:f,generate:_,columns:b,period:p}}});function K(t,p,m,u,o,r){const b=v("ion-loading"),_=v("v2Datatable"),f=v("ion-page");return O(),j(f,null,{default:S(()=>[w(b,{"is-open":t.isLoading,message:"Please wait..."},null,8,["is-open"]),w(_,{title:"TX RTT Report","report-prefix":"Pepfar","icon-url":t.Img("login-logos/PEPFAR.png"),subtitle:t.period,columns:t.columns,columnData:t.reportData,rowsPerPage:100,headerBadge:t.headerBadge,onConfigure:t.configure,onRefresh:()=>t.generate()},null,8,["icon-url","subtitle","columns","columnData","headerBadge","onConfigure","onRefresh"])]),_:1})}const ee=N(V,[["render",K]]);export{ee as default};
