import{bQ as y,d as f,dT as g,W as m,bn as n,bx as C,ad as t,as as T,ae as a,aa as E,af as S,a as L,c as N}from"./index-CMZASHAR.js";import{H as P}from"./HisStandardForm-BCjM4-bc.js";import{_ as D}from"./EncounterMixin.vue_vue_type_script_lang-v2aYCq6R.js";import"./encounter_guidelines-CJXpBOk4.js";import"./GuidelineEngine-D6V1_Znr.js";class V extends y{constructor(i,o){super(i,182,o)}async getSummary(){const i=await this.getFirstValueCoded("Screening results"),o=await this.getFirstValueCoded("Directly observed treatment option"),s=await this.getFirstValueCoded("Referral reason");return{"Screening Result":i,"Treatment Type":o,"Referral Reason":s||"N/A"}}}const A=f({mixins:[D],components:{HisStandardForm:P},data:()=>({reception:{},summaryData:{},referralReason:"",isReferralSiteEnabled:!1,skipToTreatment:!1}),watch:{patient:{async handler(){this.reception=new V(this.patientID,this.providerID),this.summaryData=await this.reception.getSummary(),this.isReferralSiteEnabled=await g.isReferralSiteEnabled(),await this.setReason(),this.fields=this.getFields()},deep:!0}},methods:{updateTreatmentOptions(e,i){const o=["Hysterectomy","Chemotherapy","Palliative Care","Treatment with antibiotic","Anti-parasitic medication","Conisation"];return i.map(s=>({...s,disabled:e&&o.includes(s.label)}))},isNotSameDayTreatment(){var e;return((e=this.summaryData)==null?void 0:e["Treatment Type"])!=="Same day treatment"},async setReason(){const e=await this.reception.getFirstValueCoded("Referral reason");this.referralReason=e||"N/A"},showSampleCollected(){return["Large Lesion (>75%)","Suspect cancer","Further Investigation and Management"].includes(this.referralReason)},async onFinish(e,i){const o=await this.reception.createEncounter(),s=await this.resolveObs({...i});if(await this.reception.saveObservationList(s),!o)return m("Unable to create encounter");const u=n.getProgramID(),c=await n.getProgramWorkflows(n.getProgramID()),r={};c.forEach(v=>{v.states.forEach(d=>{const b=d.program_workflow_state_id,_=d.concept.concept_names[0].name;r[_]=b})});const l=e.patient_outcome?e.patient_outcome.value:"Continue follow-up",h=await C.getConceptID(l);r[l]=h;const p={location_id:n.getLocationName(),state:r[l],date:n.getSessionDate()};if(console.log("STATE ",p),!await n.createState(this.patientID,u,p))return m("Unable to update state");this.nextTask()},getFields(){return[{id:"screening_summary",helpText:"Screening Summary",type:t.TT_DATA_TABLE,config:{rows:()=>Object.keys(this.summaryData).map(e=>[T.td(e),T.td(this.summaryData[e])]),dataTableConfig:{showIndex:!1}}},{id:"type_of_referral",helpText:"Type of referral visit",type:t.TT_SELECT,validation:e=>a.required(e),condition:()=>this.isNotSameDayTreatment()&&!this.isReferralSiteEnabled,options:()=>[{label:"Initial/1st visit to referral facility",value:"Initial visit"},{label:"Follow-up visit",value:"Follow-up"}],computedValue:e=>({obs:this.reception.buildValueCoded("Referral reason",e.value)})},{id:"returning_client_referral_question",helpText:"Did the returning patient visit the referral facility ?",type:t.TT_SELECT,validation:e=>a.required(e),condition:()=>this.isNotSameDayTreatment()&&this.isReferralSiteEnabled,options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.reception.buildValueCoded("Are Histological results after LLETZ available",e.label)})},{id:"possible_reasons_why",helpText:"Possible reasons why client didn't visit",type:t.TT_SELECT,validation:e=>a.required(e),condition:e=>(this.skipToTreatment=e.returning_client_referral_question.value==="No",e.returning_client_referral_question.value==="No"&&this.isNotSameDayTreatment()&&this.isReferralSiteEnabled),options:()=>[{label:"Provider unavailable",value:"Provider NOT available"},{label:"Transport lacking",value:"Transport problems"},{label:"Other",value:"Other (Specify)"}],computedValue:e=>({obs:this.reception.buildValueCoded("Reason for no result",e.value)})},{id:"other_reason",helpText:"Other reason",type:t.TT_TEXT,validation:e=>a.required(e),computedValue:e=>({obs:this.reception.buildValueText("Other reason for not seeking services",e.label)}),condition:e=>e.possible_reasons_why.value==="Other (Specify)"},{id:"cervix_screening_assessment",helpText:"Cervix Screening Assessment",type:t.TT_SELECT,validation:e=>a.required(e),condition:()=>this.isNotSameDayTreatment()&&!this.skipToTreatment,options:()=>[{label:"STI Infection",value:"STI Infection"},{label:"VIA Negative",value:"VIA Negative"},{label:"VIA Positive",value:"VIA Positive"},{label:"PAP Smear Normal",value:"PAP Smear Normal"},{label:"PAP Smear Abnormal",value:"PAP Smear Abnormal"},{label:"No Visible Lesion (After Speculum)",value:"No visible Lesion"},{label:"Suspected Cancer",value:"Suspected Cancer"}],computedValue:e=>({obs:this.reception.buildValueCoded("Cervix screening assessment",e.value)})},{id:"are_figo_staging_results_available",helpText:"Are FIGO staging results available?",type:t.TT_SELECT,validation:e=>a.required(e),condition:()=>this.isNotSameDayTreatment()&&!this.skipToTreatment,options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.reception.buildValueCoded("Are FIGO staging results available",e.value)})},{id:"figo_staging_results",helpText:"FIGO staging results",type:t.TT_SELECT,validation:e=>a.required(e),condition:e=>e.are_figo_staging_results_available.value==="Yes"&&this.isNotSameDayTreatment()&&!this.skipToTreatment,options:()=>this.mapOptions(["Cervical stage 1","Cervical stage 2","Cervical stage 3","Cervical stage 4"]),computedValue:e=>({obs:this.reception.buildValueCoded("FIGO staging of cervical cancer",e.label)})},{id:"type_of_sample_collected",helpText:"Type of sample collected",type:t.TT_SELECT,validation:e=>a.required(e),condition:()=>this.isNotSameDayTreatment()&&!this.skipToTreatment,options:()=>this.mapOptions(["Punch Biopsy","LLETZ/LEEP Sample","Cone Biopsy Sample"]),computedValue:e=>({obs:this.reception.buildValueCoded("Sample",e.label)})},{id:"are_histological_results_after_lletz_available",helpText:"",dynamicHelpText:e=>"Are Histology results after ".concat(e.type_of_sample_collected.value," available"),type:t.TT_SELECT,validation:e=>a.required(e),condition:()=>this.isNotSameDayTreatment()&&!this.skipToTreatment,options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.reception.buildValueCoded("Are Histological results after LLETZ available",e.label)})},{id:"histology_results_after_lletz",helpText:"Histology Results After LLETZ",dynamicHelpText:e=>"Histology Results After ".concat(e.type_of_sample_collected.value),type:t.TT_SELECT,validation:e=>a.required(e),condition:e=>e.are_histological_results_after_lletz_available.value==="Yes"&&this.isNotSameDayTreatment()&&!this.skipToTreatment,options:()=>this.mapOptions(["Normal","Chronic Cervicitis","Schistosomiasis","Tuberculosis(TB)","CIN 1","CIN 2","CIN 3","Carcinoma in Situ","Invasive cancer of cervix","Benign warts"]),computedValue:e=>({obs:this.reception.buildValueCoded("Sample",e.label)})},{id:"complications_during_lletz_leep_biopsy",helpText:"Complications During LLETZ/LEEP Biopsy",type:t.TT_SELECT,validation:e=>a.required(e),condition:()=>this.isNotSameDayTreatment()&&!this.skipToTreatment&&!this.isReferralSiteEnabled,options:()=>[{label:"None (N/A)",value:"None"},{label:"Excessive Bleeding or pain",value:"Excessive Bleeding or pain"}],computedValue:e=>({obs:this.reception.buildValueCoded("Complications During LLETZ/LEEP Biopsy",e.value)})},{id:"complications_after_lletz_leep_biopsy",helpText:"Complications After LLETZ/LEEP Biopsy",type:t.TT_SELECT,validation:e=>a.required(e),condition:()=>this.isNotSameDayTreatment()&&!this.skipToTreatment&&!this.isReferralSiteEnabled,options:()=>[{label:"None (N/A)",value:"None"},{label:"Excessive Bleeding or pain",value:"Excessive Bleeding or pain"}],computedValue:e=>({obs:this.reception.buildValueCoded("Complications After LLETZ/LEEP Biopsy",e.value)})},{id:"recommended_care_after_lletz_histology",helpText:"Recommended Care After LLETZ Histology",type:t.TT_SELECT,validation:e=>a.required(e),condition:()=>this.isNotSameDayTreatment()&&!this.skipToTreatment,options:()=>[{label:"Hysterectomy",value:"Hysterectomy"},{label:"Chemotherapy",value:"Chemotherapy"},{label:"Palliative Care",value:"Palliative Care"},{label:"LLETZ/LEEP",value:"LLETZ/LEEP"},{label:"Treatment with antibiotic",value:"Antibiotics"},{label:"Anti-parasitic medication",value:"Antiparasitic"},{label:"Conisation",value:"Conisation"},{label:"Other",value:"Other (Specify)"}],computedValue:e=>({obs:this.reception.buildValueCoded("Treatment",e.value)})},{id:"treatment_provided",helpText:"Treatment Provided",type:t.TT_SELECT,validation:e=>a.required(e),condition:()=>!this.skipToTreatment,options:()=>{const e=[{label:"Hysterectomy",value:"Hysterectomy"},{label:"Chemotherapy",value:"Chemotherapy"},{label:"Thermocoagulation",value:"Thermocoagulation"},{label:"Cryotherapy",value:"Cryotherapy"},{label:"Palliative Care",value:"Palliative Care"},{label:"LLETZ/LEEP",value:"LLETZ/LEEP"},{label:"Treatment with antibiotic",value:"Antibiotics"},{label:"Anti-parasitic medication",value:"Antiparasitic"},{label:"Conisation",value:"Conisation"},{label:"Other",value:"Other (Specify)"}];return this.updateTreatmentOptions(!this.isNotSameDayTreatment(),e)},computedValue:e=>({obs:this.reception.buildValueCoded("Treatment",e.value)})},{id:"none_treatment_reasons",helpText:"Reasons why treatment was refused",type:t.TT_SELECT,validation:e=>a.required(e),condition:e=>e.treatment_provided.value==="Other (Specify)",options:()=>[{label:"Patient refused treatment",value:"Patient refused"},{label:"Provider not available",value:"Provider NOT available"},{label:"other",value:"Other (Specify)"}],computedValue:e=>({obs:this.reception.buildValueCoded("Other reason for not seeking services",e.value)})},{id:"other_reason",helpText:"Other reason",type:t.TT_TEXT,validation:e=>a.required(e),computedValue:e=>({obs:this.reception.buildValueCoded("Other reason for not seeking services",e.value)}),condition:e=>e.none_treatment_reasons.value==="Other (Specify)"},{id:"patient_denial_outcome",helpText:"Patient outcome",type:t.TT_SELECT,condition:e=>this.isNotSameDayTreatment()&&e.returning_client_referral_question.value==="No",validation:e=>a.required(e),options:()=>this.mapOptions(["Death","On going follow-up","Denied consultation"])},{id:"patient_outcome",helpText:"Patient outcome",type:t.TT_SELECT,condition:e=>this.isNotSameDayTreatment()&&e.returning_client_referral_question.value==="Yes",validation:e=>a.required(e),options:()=>this.mapOptions(["On-going Palliative Care","No Dysplasia/Cancer","Death","On going follow-up","Denied consultation"])}]}}});function O(e,i,o,s,u,c){const r=S("his-standard-form");return L(),N(r,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!1,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}const F=E(A,[["render",O]]);export{F as default};
