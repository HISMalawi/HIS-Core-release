import{d as h,r as v,bU as S,bZ as I,an as r,bY as O,aR as T,ao as o,e0 as a,a as y,b as D,w as x,e as F,i as p,q as B}from"./index-CJleCCtM.js";import{H}from"./HisStandardForm-BPNPJCrM.js";import{u as w}from"./useEncounter-BYi6HXkG.js";import{r as C}from"./commons-CcXQGk9e.js";import"./isEmpty-Dwdx9lIX.js";import"./encounter_guidelines-CfQXyRxl.js";import"./GuidelineEngine-D6V1_Znr.js";const $=h({__name:"Hiv",setup(g){const _=v([]),t=new S(-1,I.UPDATE_HIV_STATUS),i=v(),{goToNextTask:E,patientDashboardUrl:m}=w((s,u,l)=>{t.patientID=u,t.providerID=s;const n=()=>{const e=[];return{id:"artSummary",helpText:"ART Summary",type:r.TT_SUMMARY,init:async()=>(i.value=await O.generateArtStatusFromArt(u,S.getSessionDate()),i.value&&Object.keys(i.value).forEach(R=>e.push(i.value[R])),!0),condition:()=>!T.isEmpty(i.value),options:()=>e}},d=()=>({id:"hivStatus",helpText:"HIV Status",type:r.TT_SELECT,requireNext:!1,validation:e=>o.required(e),condition:()=>T.isEmpty(i.value),computedValue:e=>e.value==="NOT_DONE"?{concept_id:a("HIV_TEST_DONE_TODAY"),value_coded:a("NO_ANSWER"),obs_datetime:t.date}:{concept_id:a("HIV_STATUS"),value_coded:a("".concat(e.value)),obs_datetime:t.date},options:()=>[{value:"POSITIVE",label:"Positive"},{value:"NEGATIVE",label:"Negative"},{value:"NOT_DONE",label:"Not Tested"}]}),c=()=>({id:"timeOfHIVTest",helpText:"Time of HIV test",type:r.TT_SELECT,requireNext:!1,validation:e=>o.required(e),computedValue:e=>({concept_id:a("TIME_OF_HIV_TEST"),value_coded:a("".concat(e.value)),obs_datetime:t.date}),condition:e=>e.hivStatus.value==="POSITIVE"||e.hivStatus.value==="NEGATIVE",options:()=>[{value:"HIV_BEFORE_TB",label:"Before TB Registration"},{value:"HIV_AFTER_TB",label:"After TB Registration"}]}),b=()=>({id:"artStatus",helpText:"ART Started",type:r.TT_SELECT,requireNext:!1,validation:e=>o.required(e),condition:e=>e.hivStatus.value==="POSITIVE",computedValue:e=>({concept_id:a("ON_ART"),value_coded:a("".concat(e.value)),obs_datetime:t.date}),options:()=>[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]}),f=()=>({id:"arvStatus",helpText:"ARV Status",type:r.TT_SELECT,requireNext:!1,validation:e=>o.required(e),condition:e=>e.artStatus.value==="YES_ANSWER",computedValue:e=>({concept_id:a("ARV_STATUS"),value_coded:a("".concat(e.value)),obs_datetime:t.date}),options:()=>[{value:"ARV_BEFORE_TB",label:"Started ARV before TB Treatment"},{value:"ARV_WHILE_TB",label:"Started ARV while on TB Treatment"},{value:"ARV_AFTER_DISCHARGE",label:"ARV not started by the time when discharged from TB treatment"}]}),N=()=>({id:"cptStatus",helpText:"Started CPT",type:r.TT_SELECT,requireNext:!1,validation:e=>o.required(e),condition:e=>e.artStatus.value==="YES_ANSWER",computedValue:e=>({concept_id:a("ON_CPT"),value_coded:a("".concat(e.value)),obs_datetime:t.date}),options:()=>[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]}),V=()=>({id:"cptStartDate",helpText:"CPT Start Date",type:r.TT_FULL_DATE,validation:e=>o.validateSeries([()=>o.required(e),()=>o.dateRangeOf(e,"".concat(l.getBirthdate()),t.date)]),computedValue:e=>({concept_id:a("CPT_START_DATE"),[/unknown/i.test("".concat(e.value))?"value_text":"value_datetime"]:e.value,obs_datetime:t.date}),condition:e=>e.cptStatus.value==="YES_ANSWER",config:{allowUnknown:!0}});_.value=[n(),d(),c(),b(),f(),N(),V()]});async function A(s,u){var l,n;T.isEmpty(i.value)?(await t.createEncounter(),await t.saveObservationList(await C(u))):(n=(l=i.value)==null?void 0:l.hivStatus)!=null&&n._recordedStatusInTB||(await t.createEncounter(),await t.saveObservationList(Object.keys(i.value).reduce((d,c)=>[...d,i.value[c].obs],[]))),E()}return(s,u)=>(y(),D(p(B),null,{default:x(()=>[F(H,{cancelDestinationPath:p(m),onFinishAction:A,fields:_.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{$ as default};
