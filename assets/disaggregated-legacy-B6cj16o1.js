System.register(["./index-legacy-Brqe4EI3.js","./ReportDateSelectionPrompt-legacy-CK5vOen0.js","./disaggregated_service-legacy-DxD2NUz7.js","./TableView-legacy-KeDiC1Vq.js","./ArtDrilldown-legacy-NOzzLDXn.js","./regimen_report_service-legacy-CTlbt1Pr.js","./fuse-legacy-CQoBB3MK.js","./Export-legacy-HAUD0Wvp.js","./HisKeyboard-legacy-jnWZQiUD.js"],(function(e,a){"use strict";var r,t,n,o,g,l,s,i,u,c,d,p,f,b,y,m,F,A,v,D,w,P,x,h,j;return{setters:[e=>{r=e.d,t=e.I,n=e.cg,o=e.K,g=e.N,l=e.ac,s=e.n,i=e.t,u=e.cQ,c=e.q,d=e.cj,p=e.O,f=e.ae,b=e.ch,y=e._,m=e.r,F=e.o,A=e.c,v=e.w,D=e.b},e=>{w=e.D},e=>{P=e.D},e=>{x=e.v},e=>{h=e.A},e=>{j=e.R},null,null,null],execute:function(){const a=r({components:{IonPage:t,IonLoading:n,v2Datatable:x},setup(){const e=o([]),a=o(""),r=o(""),t=o(!1),n=new P,y=o([]),m=async e=>{(await p.create({component:h,backdropDismiss:!1,cssClass:"large-modal",componentProps:{...e,subtitle:a.value,onFinish:()=>p.getTop().then((e=>e&&p.dismiss()))}})).present()},F=(e,a)=>({ref:a,label:e,defaultValue:"0",toValue:e=>e.length,tdClick:async e=>{e.refData.length&&m({patientIdentifiers:e.refData,title:`${e.data.age_group} ${e.data.gender} ${e.column.label}`})}}),A=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},F("TX curr (receiving ART)","tx_curr"),...j.reduce(((e,a)=>[...e,F(a,a)]),[]),F("Unknown","N/A"),F("Total (regimen)","regimen_total")]],v=[...j,"N/A"].reduce(((e,a)=>({...e,[a]:[]})),{}),D=async(a=!1)=>{if(!n.startDate||!n.endDate)return i("Start date and end date required!");t.value=!0;const o=["Pregnant","Breastfeeding"],g={F:{label:"Female",rows:[],aggregate:{},excludedAgeGroups:o},M:{label:"Male",rows:[],aggregate:{},excludedAgeGroups:o},FP:{label:"Pregnant",rows:[],aggregate:{},gender:"F",ageGroup:"All",genderDisplay:"FP",excludedAgeGroups:[...u,"Breastfeeding"]},FBF:{label:"Breastfeeding",rows:[],aggregate:{},gender:"F",ageGroup:"All",genderDisplay:"FBF",excludedAgeGroups:[...u,"Pregnant"]}},l=(a=!1)=>{const t=Object.keys(g.FP.aggregate).reduce(((e,a)=>({...e,[a]:[...g.FP.aggregate[a]||[],...g.FBF.aggregate[a]||[]]})),{}),n=Object.keys(g.F.aggregate).reduce(((e,a)=>({...e,[a]:e[a].filter((e=>!Array.isArray(t[a])||!t[a].includes(e)))})),g.F.aggregate);e.value=[...g.F.rows,...g.M.rows,{age_group:"All",gender:"Male",...g.M.aggregate},...g.FP.rows,{age_group:"All",gender:"FNP",...n},...g.FBF.rows];const o=f.uniq([...g.M.aggregate.tx_curr||[],...g.F.aggregate.tx_curr||[]]),l={text:`Total alive and on ART: <b>${o.length}</b>`,icon:b,color:"primary",action:()=>m({patientIdentifiers:o,title:`Total alive and on ART: ${o.length}`})};y.value=a?[l]:[l,{text:r.value,icon:d,color:"dark"}]};try{if(n.setRebuildOutcome(a),!(await n.init()))return i("Unable to initialise report");for(const e of[...u,...o]){r.value=`Processing <b>${e}</b>`,n.setAgeGroup(e);const a=await n.getCohort();n.setRebuildOutcome(!1);for(const r of Object.keys(g)){if((g[r].excludedAgeGroups||[]).includes(e))continue;n.setGender(r),g[r].ageGroup&&n.setAgeGroup(g[r].ageGroup);const t=await n.getRegimenDistribution(),o={age_group:g[r]?.ageGroup||e,gender:g[r]?.genderDisplay||g[r].label,...a[e]?a[e][g[r]?.gender||r]:{},...v,...t,regimen_total:Object.values(t).flat(1)};g[r].rows.push(o),g[r].aggregate=Object.keys(o).reduce(((e,a)=>Array.isArray(o[a])?{...e,[a]:[...e[a]||[],...o[a]]}:e),g[r].aggregate),l(!1)}}l(!0),e.value=e.value.map(((e,a)=>({index:a+1,...e})))}catch(s){const e="Unable to generate report!";c(e),y.value=[{text:e,color:"danger",icon:d,action:function(){y.value=[{text:`Exception occured: <b>${s}</b>`,color:"danger",icon:d}]}}]}t.value=!1,r.value=""},x=(e=!1)=>w({onFinish:(r,t,o,g)=>{a.value=o,n.startDate=r,n.endDate=t,g&&n.setOccupation(g),n.setQuarter("pepfar"),D(e)}});return g((()=>x(!0))),{Img:l,onRegenerate:async()=>D(await s("Do you want to rebuild report?")),headerBadge:y,reportData:e,isLoading:t,configure:x,generate:D,columns:A,period:a}}});e("default",y(a,[["render",function(e,a,r,t,n,o){const g=m("ion-loading"),l=m("v2Datatable"),s=m("ion-page");return F(),A(s,null,{default:v((()=>[D(g,{"is-open":e.isLoading,message:"Please wait.."},null,8,["is-open"]),D(l,{"icon-url":e.Img("login-logos/PEPFAR.png"),title:"PEPFAR Disaggregated Report","report-prefix":"Pepfar",subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRegenerate,headerBadge:e.headerBadge},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh","headerBadge"])])),_:1})}]]))}}}));
