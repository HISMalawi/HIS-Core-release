System.register(["./index-legacy-D2iCn0VZ.js"],(function(e,t){"use strict";var i,n,a,s,d,o,l,r,c,u,h,m,p,g,I,f,k,C,D,b,y,w,N,_,A,$,V,E,P,x,z;return{setters:[e=>{i=e.d,n=e.l,a=e.I,s=e.a5,d=e.a4,o=e.m,l=e.a7,r=e.ag,c=e.k,u=e.ar,h=e.n,m=e.as,p=e.at,g=e.y,I=e.H,f=e.au,k=e.av,C=e.s,D=e.ak,b=e.ap,y=e.a,w=e.b,N=e.w,_=e.e,A=e.j,$=e.t,V=e.h,E=e.a9,P=e.aa,x=e.a6,z=e.g}],execute:function(){const t=i({components:{IonPage:h,IonCheckbox:u,IonButton:c,IonList:r,IonItem:l,IonToolbar:o,IonHeader:d,IonTitle:s,IonContent:a,IonFooter:n},data:()=>({dde:{},ddeEnabled:!1,items:[],title:"",npid:""}),watch:{$route:{handler({params:e}){e&&(this.npid=e.npid,this.title=`Duplicates for NPID (${this.npid})`,this.init(this.npid))},deep:!0,immediate:!0}},computed:{itemsChecked(){return this.items.filter((e=>e.isChecked))}},methods:{async onAction(e,t="proceed"){if(await f(`\n                Are you sure you want to ${t}?\n            `))try{await e()}catch(i){C(`${i}`),console.error(i)}},async mergeSelected(){if(!this.itemsChecked.every((e=>e.isComplete)))return C("One or more patients have missing data. Please update them before merging.",5e3);await this.dde.postMerge(this.itemsChecked)&&(await this.dde.printNpid(this.dde.patientID),k(this.dde.patientID,this.$router))},async reassignIdentifier(e){if(!e.isComplete&&this.ddeEnabled){if(await f("Do you want to update missing information?",{header:"Incomplete Demographics"})){let t=`edit_person=${e.patientID}`;t+="&dde_reassign=true",t+=`&doc_id=${e.docID}`,this.$router.push(`/patient/registration?${t}`)}}else this.onAction((async()=>{this.ddeEnabled?await this.dde.reassignNpid(e.docID,e.patientID)&&await this.dde.printNpid(e.patientID):"function"==typeof e.assignLocalNpidAndPrint&&await e.assignLocalNpidAndPrint(),k(e.patientID,this.$router)}),"Reassign")},buildItems:e=>e.map((e=>{try{const t=new p(e);return{isChecked:!1,patientID:t.getID(),name:t.getFullName(),gender:t.getGender(),birthdate:I.toStandardHisDisplayFormat(t.getBirthdate()),curDistrict:t.getCurrentDistrict(),homeVillage:t.getHomeVillage(),docID:t.getPatientIdentifier(27),isComplete:t.patientIsComplete(),assignLocalNpidAndPrint:async()=>{await t.assignNpid(),await t.printNationalID()}}}catch(t){g("An error has occured while building data"),console.error(t)}return{isChecked:!1,patientID:"N/A",name:"N/A",gender:"N/A",birthdate:"N/A",curDistrict:"N/A",homeVillage:"N/A",docID:"N/A",isComplete:!1}})),clear(){this.items=this.items.map((e=>(e.isChecked=!1,e)))},async init(e){try{if(this.dde=new m,await this.dde.loadDDEStatus(),this.ddeEnabled=this.dde.isEnabled(),this.ddeEnabled){const{locals:t,remotes:i}=await this.dde.findNpid(e);this.items=[...this.buildItems(t),...this.buildItems(i)]}else{const t=await p.findByNpid(e);t&&(this.items=this.buildItems(t))}}catch(t){g(`${t}`,5e3)}}}});e("default",D(t,[["render",function(e,t,i,n,a,s){const d=b("ion-title"),o=b("ion-toolbar"),l=b("ion-header"),r=b("ion-checkbox"),c=b("ion-label"),u=b("ion-button"),h=b("ion-item"),m=b("ion-list"),p=b("ion-content"),g=b("ion-footer"),I=b("ion-page");return w(),y(I,null,{default:N((()=>[_(l,null,{default:N((()=>[_(o,null,{default:N((()=>[_(d,{class:"his-lg-text"},{default:N((()=>[A($(e.title),1)])),_:1})])),_:1})])),_:1}),_(p,null,{default:N((()=>[_(m,null,{default:N((()=>[(w(!0),V(E,null,P(e.items,((i,n)=>(w(),y(h,{class:"his-md-text",key:n},{default:N((()=>[e.ddeEnabled?(w(),y(r,{key:0,slot:"start",modelValue:i.isChecked,"onUpdate:modelValue":e=>i.isChecked=e},null,8,["modelValue","onUpdate:modelValue"])):x("",!0),_(c,{color:i.isComplete?"":"danger"},{default:N((()=>[A($(i.name)+" ("+$(i.gender)+") "+$(i.birthdate)+" ",1),t[1]||(t[1]=z("br",null,null,-1)),t[2]||(t[2]=A(" Current District: ",-1)),z("b",null,$(i.curDistrict||"Unknown"),1),t[3]||(t[3]=A(" Home Village: ",-1)),z("b",null,$(i.homeVillage||"Unknown"),1)])),_:2},1032,["color"]),_(u,{size:"medium",onClick:()=>e.reassignIdentifier(i)},{default:N((()=>[...t[4]||(t[4]=[A(" Re-Assign ",-1)])])),_:1},8,["onClick"]),i.isComplete?x("",!0):(w(),y(u,{key:1,size:"medium",color:"warning","router-link":`/patient/registration?edit_person=${i.patientID}`},{default:N((()=>[...t[5]||(t[5]=[A(" Update Missing Data ",-1)])])),_:1},8,["router-link"]))])),_:2},1024)))),128))])),_:1})])),_:1}),_(g,null,{default:N((()=>[_(o,{color:"dark"},{default:N((()=>[_(u,{"router-link":"/",color:"danger",slot:"start",size:"large"},{default:N((()=>[...t[6]||(t[6]=[A(" Cancel ",-1)])])),_:1}),e.itemsChecked.length>0?(w(),y(u,{key:0,onClick:e.clear,color:"warning",slot:"end",size:"large"},{default:N((()=>[...t[7]||(t[7]=[A(" Clear ",-1)])])),_:1},8,["onClick"])):x("",!0),e.itemsChecked.length>1?(w(),y(u,{key:1,onClick:t[0]||(t[0]=t=>e.onAction(e.mergeSelected,"merge")),color:"primary",size:"large",slot:"end"},{default:N((()=>[A(" Merge ("+$(e.itemsChecked.length)+") ",1)])),_:1})):x("",!0)])),_:1})])),_:1})])),_:1})}]]))}}}));
