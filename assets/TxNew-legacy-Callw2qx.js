System.register(["./index-legacy-Ct6UqEYv.js","./ReportDateSelectionPrompt-legacy-CA621GWo.js","./tx_report_service-legacy-DhKnyaWL.js","./TableView-legacy-mGEkKCin.js","./ArtDrilldown-legacy-DrD2GoPZ.js","./ReportErrors-legacy-CR-8vy0Y.js","./moh_cohort_service-legacy-DbJ-B7pa.js","./fuse-legacy-CQoBB3MK.js","./Export-legacy-B6b_za-U.js","./HisKeyboard-legacy-Da3WBAyG.js"],(function(e,t){"use strict";var n,a,r,o,i,l,s,c,d,u,g,p,m,_,f,h,b,w,v,y,D,x,T,P,R,$,k;return{setters:[e=>{n=e.d,a=e.I,r=e.cg,o=e.K,i=e.N,l=e.ac,s=e.O,c=e.t,d=e.ae,u=e.ch,g=e.q,p=e.ci,m=e.cj,_=e.ck,f=e.cl,h=e._,b=e.r,w=e.o,v=e.c,y=e.w,D=e.b},e=>{x=e.D},e=>{T=e.T},e=>{P=e.v},e=>{R=e.A},e=>{$=e.R},e=>{k=e.M},null,null,null],execute:function(){const t=n({components:{IonPage:a,IonLoading:r,v2Datatable:P},setup(){const e=o([]),t=o(""),n=o(!1),a=new T,r=o([]),h=new k,b=o(!0),w=(e,n)=>({ref:n,label:e,toValue:e=>e.length,tdClick:async e=>{e.refData.length&&(await s.create({component:R,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:t,patientIdentifiers:e.refData,title:`${e.data.age_group} ${e.data.gender} ${e.column.label}`,onFinish:()=>s.getTop().then((e=>e&&s.dismiss()))}})).present()}}),v=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},w("Tx new CD4 <200","cd4_less_than_200"),w("Tx new CD4 >=200","cd4_greater_than_equal_to_200"),w("Tx new CD4 Unknown","cd4_unknown_or_not_done"),w("Transfer-ins","transfer_in")]],y=function(e){const t=r.value.findIndex((t=>t.id===e.id));-1!==t?r.value[t]=e:r.value.push(e)},D=async function(e){const t="validationErrors";(await s.create({id:t,component:$,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:e}})).present(),y({id:t,text:`<b>${e.length}</b> validation errors detected`,icon:f,color:"danger",action:()=>D(e)})},P=async()=>{if(!a.startDate||!a.endDate)return c("Start date and end date required!");n.value=!0,e.value=[];try{let n=null;n=b.value?await a.getTxNewReport(!1):await a.getTxNewReport(!0);const r=n.filter((e=>!["All"].includes(e.age_group))).reduce(((e,t)=>(e[t.gender]=Object.keys(t).reduce(((e,n)=>Array.isArray(t[n])?{...e,[n]:[...e[n]||[],...t[n]]}:e),e[t.gender]||{}),e)),{Male:{},Female:{}});e.value=n;const o=n.reduce(((e,t)=>{if("FP"===t.gender){const n=Object.values(t).filter(Array.isArray).flat();return e.concat(n)}return e}),[]),i=["cd4_less_than_200","cd4_greater_than_equal_to_200","cd4_unknown_or_not_done"],l=d.uniq(["Female","Male"].reduce(((e,t)=>[...e,...i.map((e=>r[t][e])).flat(1)]),[]));y({id:"stats",text:`Tx new <b>${l.length}</b>`,icon:u,color:"primary",action:async()=>{(await s.create({component:R,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"All TxNew",subtitle:t.value,patientIdentifiers:l,onFinish:()=>s.getTop().then((e=>e&&s.dismiss()))}})).present()}}),function(e){const t={initiated_on_art_first_time:{param:e.total,check:(e,t)=>e!=t,error:(e,t)=>`\n                        MOH cohort initiated on ART first time <b>(${e})</b> is not matching Tx New <b>(${t})</b>\n                    `},initial_pregnant_females_all_ages:{param:e.pregnant,check:(e,t)=>e!=t,error:(e,t)=>`\n                        MOH cohort initial pregnant females all ages \n                        <b>(${e})</b> is not matching with TX new Pregnant women <b>${t}</b>\n                    `},males_initiated_on_art_first_time:{param:e.male,check:(e,t)=>e!=t,error:(e,t)=>`\n                        MoH Cohort males initiated on ART first time <b>(${e})</b>\n                        is not matching with TX new All male <b>(${t})</b>\n                    `},"quarterly_re_initiated_on_art + transfer_in":{param:e.transfer_in,check:(e,t)=>e!=t,error:(e,t)=>`\n                        Quarterly Transfer In + Reinitiated Clients <b>${e}</b>  does not match Transfer In <b>${t}</b> clients in TXNEW report\n                    `}};-1===h.validateIndicators(t,(e=>{e.length?D(e):y({id:"reportOk",text:"<b>Report is consistent</b>",icon:_,color:"success"})}))&&D(["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])}({total:l.length,pregnant:d.uniq(i.map((e=>r.Female[e].filter((e=>o.includes(e))))).flat(1)).length,male:d.uniq(i.map((e=>r.Male[e])).flat(1)).length,transfer_in:[...r.Male.transfer_in,...r.Female.transfer_in].length}),e.value=e.value.map(((e,t)=>({index:t+1,...e})))}catch(o){console.error(`${o}`),g("Unable to generate report!"),r.value=[{text:"Unable to generate report!",color:"danger",icon:p,action:function(){r.value=[{text:`Exception occured: <b>${o}</b>`,color:"danger",icon:m}]}}]}n.value=!1,b.value=!1},j=()=>x({onFinish:(e,n,r,o)=>{t.value=r,a.startDate=e,a.endDate=n,o&&a.setOccupation(o),h.setStartDate(a.startDate),h.setEndDate(a.endDate),P()}});return i((()=>j())),{Img:l,headerBadge:r,reportData:e,isLoading:n,configure:j,generate:P,columns:v,isFirstLoad:b,period:t}}});e("default",h(t,[["render",function(e,t,n,a,r,o){const i=b("ion-loading"),l=b("v2Datatable"),s=b("ion-page");return w(),v(s,null,{default:y((()=>[D(i,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),D(l,{"icon-url":e.Img("login-logos/PEPFAR.png"),title:"Pepfar Tx New","report-prefix":"Pepfar",subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,headerBadge:e.headerBadge,onConfigure:e.configure,onRefresh:e.generate},null,8,["icon-url","subtitle","columns","columnData","headerBadge","onConfigure","onRefresh"])])),_:1})}]]))}}}));
