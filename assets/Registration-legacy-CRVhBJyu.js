System.register(["./index-legacy-u96QPI-y.js","./util-legacy-CjANJSja.js","./HisStandardForm-legacy-D_jBcchs.js","./useEncounter-legacy-BPAqCs9c.js","./commons-legacy-BjTRKIdx.js","./identifier_service-legacy-B7Rx0qaE.js","./isEmpty-legacy-B7wE2BKH.js","./encounter_guidelines-legacy-DRit2tAn.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var i,n,a,r,u,l,s,c,o,d,p,y,m,T,v,I,b,g,f,_,$,B,N,x,D,E,P,w,R;return{setters:[e=>{i=e.d,n=e.aQ,a=e.K,r=e.bg,u=e.dj,l=e.E,s=e.dp,c=e.F,o=e.aP,d=e.dl,p=e.ah,y=e.ct,m=e.ae,T=e.t,v=e.V,I=e.o,b=e.c,g=e.w,f=e.b,_=e.cu,$=e.dq,B=e.T,N=e.I},e=>{x=e.g},e=>{D=e.H},e=>{E=e.u},e=>{P=e.m,w=e.r},e=>{R=e.I},null,null,null],execute:function(){e("default",i({__name:"Registration",setup(e){const t=n.getActiveApp(),i=a([]),j=new r(-1,u.TB_REGISTRATION),q=new R,h=a(),A=a(""),M=l();function U(e){const[t,i]=`${e}`.split("/");if(i)return`${A.value}${t}/${i}`;const[n]=`${j.date}`.split("-");return`${A.value}${t}/${n.trim()}`}const C={"Multi drug resistance treatment":{type:s.MDR,label:"Patient DR TB Number",indexID:"DR TB Number",concept:"MDR_NUMBER"},"Tuberculosis Preventive Treatment (TPT)":{type:s.IPT,label:"Patient IPT Number",indexID:"IPT Number",concept:"TB_NUMBER"},"Currently in treatment":{type:s.TB,label:"Patient TB Number",indexID:"TB Number",concept:"TB_NUMBER"},DEFAULT:{type:s.TB,label:"Patient TB Number",indexID:"TB Number",concept:"TB_NUMBER"}},{goToNextTask:F,patientDashboardUrl:O,patientId:S}=E(((e,n,a,r)=>{j.patientID=n,j.providerID=e,i.value=[(()=>{let e={};const t=Object.values(C).find((e=>e.indexID===M.query.type));return{id:"reassign",helpText:`Reassign ${M.query.type}: ${M.query.id}`,proxyID:"patientIdentifier",type:c.TT_NUMBER,init:async()=>{e=await o.getProgramInformation(n),!M.query.id&&d.isOnTreatment(e.current_outcome)&&`${e.tb_number}`.split("/").length>0&&await p("Caution!",`Client is currently using program number ${e.tb_number}`,`Current outcome is ${e.current_outcome} updated on ${y(e.current_outcome_date)}`,[{name:"Ok",color:"primary",slot:"start"}]);const[i,a]=`${M.query.id}`.split("/");return q.setIdentifierType(t?.type),A.value=`${i}/${a}/`,!0},beforeNext:async e=>{const t=U(`${e.value}`),i=await q.getPatientsByIdentifier(t);return!!m.isEmpty(i)||(T(`${t} is already in use!!`),!1)},computedValue:e=>({obs_datetime:j.date,value_text:U(`${e.value}`),concept_id:x(t?.concept)}),condition:()=>M.query.reassign,validation:e=>v.required(e)}})(),{id:"new",helpText:"Identifier:",proxyID:"patientIdentifier",type:c.TT_NUMBER,init:async()=>(C[r.outcome]?h.value=C[r.outcome]:h.value=C.DEFAULT,q.setIdentifierType(h.value?.type),A.value=await(t.programPatientIdentifiers[h.value?.indexID]?.prefix()),!0),beforeNext:async e=>{const t=U(`${e.value}`),i=await q.getPatientsByIdentifier(t);return!!m.isEmpty(i)||(T(`${t} is already in use!!`),!1)},computedValue:e=>({obs_datetime:j.date,value_text:U(`${e.value}`),concept_id:x(h.value?.concept)}),condition:e=>!e.reassign?.value,validation:e=>v.required(e),dynamicHelpText:()=>h.value?.label},{id:"idSummary",helpText:"Identifier",type:c.TT_TEXT_BANNER,options:e=>P([`${h.value?.label}: <br/> <b>${U(e.patientIdentifier.value)}</b>`])}]}));async function V(e,t){await j.createEncounter(),await j.saveObservationList(await w(t)),e.new?await $.create(S.value,q.identifierType,U(e.patientIdentifier.value)):await $.update(parseInt(`${M.query.reassign}`),U(e.patientIdentifier.value)),await d.printTBNumber(j.patientID),B.invalidate("ACTIVE_PATIENT"),F()}return(e,t)=>(I(),b(_(N),null,{default:g((()=>[f(D,{cancelDestinationPath:_(O),onFinishAction:V,fields:i.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
