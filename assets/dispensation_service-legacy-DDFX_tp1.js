System.register(["./index-legacy-CA6M7ipO.js","./drug_order_service-legacy-3VUXkHbj.js"],(function(t,r){"use strict";var e,s,a,n,i;return{setters:[t=>{e=t.ao,s=t.aN,a=t.bQ,n=t.dh},t=>{i=t.D}],execute:function(){class r extends e{constructor(){super()}static async fetchAvailableDrugStock(t){const r=await this.getJson("pharmacy/items",{drug_id:t});if(!s.isEmpty(r))return r.map((t=>({quantity:t.current_quantity,packSize:t.pack_size})))}}const u={11:[30],21:[25],22:[60],24:[30,60,90,100],30:[90],39:[60],73:[120],74:[60],76:[1e3],297:[30,60,90],576:[30,60,90],613:[60],731:[60],732:[60],733:[60],734:[30],735:[30],736:[60],738:[60],931:[12,30,60],932:[30],954:[60],963:[30,60,90],968:[60],969:[30],971:[30,60,90],976:[60],977:[30],982:[30],983:[30,90],1039:[30,60,90],1043:[60],1044:[30],1056:[24],1216:[3,6,8,12]};t("D",class extends a{drugHistory;currentDrugOrder;useDrugManagement;constructor(t,r){super(t,54,r),this.drugHistory=[],this.currentDrugOrder=[],this.useDrugManagement=!1}setIsDrugManagementEnabled(t){this.useDrugManagement=t}async loadDrugManagementEnabled(){this.useDrugManagement=await n.drugManagementEnabled()}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}buildDispensations(t,r,e){const s=[];for(let a=0;a<e;a++)s.push({drug_order_id:t,date:this.date,quantity:r/e});return s}saveDispensations(t){return a.postJson("/dispensations",{dispensations:t,program_id:a.getProgramID()})}async voidOrder(t){return a.void(`/dispensations/${t}`,{})}async loadDrugHistory(){try{this.drugHistory=await i.getDrugOrderHistory(this.patientID)||[]}catch(t){console.warn(t)}}async loadCurrentDrugOrder(){if(this.currentDrugOrder=await i.getDrugOrders(this.patientID)||[],this.useDrugManagement)for(const t of this.currentDrugOrder){const e=await r.fetchAvailableDrugStock(t.drug.drug_id);t.stocks=this.groupByPackSize(e)}}groupByPackSize(t){const r=new Map;return t?.forEach((({packSize:t,quantity:e})=>{t&&(r.has(t)?r.set(t,{packSize:t,quantity:e+(r.get(t)?.quantity??0)}):r.set(t,{quantity:e,packSize:t}))})),Array.from(r.values())}getDrugPackSizes(t){return t in u?u[t]:[30,60,90]}calcCompletePack(t,r){const e=t.barcodes.sort(((t,r)=>t.tabs-r.tabs));if(0==e.length||0==r)return r;for(const s in e){const{tabs:t}=e[s];if(parseInt(t)>=r)return t}return parseInt(e[e.length-1].tabs)}})}}}));
