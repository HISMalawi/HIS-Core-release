System.register(["./HisStandardForm-legacy-vAH9pUBP.js","./index-legacy-DiG-qUFQ.js","./useEncounter-legacy-D2GFZ_1G.js","./commons-legacy-BOo_GiXV.js","./isEmpty-legacy-X2hms-O0.js","./encounter_guidelines-legacy-Dmk7ypug.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,s,n,i,o,l,c,u,r,d,g,y,p,m,b,v,w,T,_,D;return{setters:[e=>{a=e.H},e=>{s=e.bI,n=e.bp,i=e.d,o=e.r,l=e.br,c=e.a9,u=e.aa,r=e.aJ,d=e.u,g=e.v,y=e.w,p=e.x,m=e.y,b=e.a5,v=e.aj,w=e.ad},e=>{T=e.u},e=>{_=e.a,D=e.r},null,null,null],execute:function(){class t extends s{constructor(e,t){super(e,41,t)}static async getDiagnosis(e="",t=1,a=10){const i=n.getConceptID("Qech outpatient diagnosis list");return s.getJson("diagnosis",{id:i,name:e,page:t,page_size:a})}}class E extends s{constructor(e,t){super(e,105,t)}}e("default",i({__name:"Diagnosis",setup(e){let s,n;const i=o("No"),f=o([]),{goToNextTask:h,patientDashboardUrl:x}=T(((e,a)=>{l.getLatestMalariaTestResult(a).then((e=>i.value=e)),s=new E(a,e),n=new t(a,e),f.value=[j("Primary"),j("Secondary"),{id:"clinical_notes",helpText:"Clinical notes",type:c.TT_TEXT,computedValue:e=>r.isEmpty(e)?null:{tag:"notes",obs:s.buildValueText("Clinical notes construct",e.value)}}]}));async function L(e,t){await n.createEncounter();const a=await D({...t,obs_datetime:v.getSessionDate()},"diagnosis");await n.saveObservationList(a);const i=await D({...t},"notes");r.isEmpty(i)||(await s.createEncounter(),await s.saveObservationList(i)),h()}function j(e){return{id:`${e.toLowerCase()}_diagnosis`,helpText:`${e} Diagnosis`,type:c.TT_INFINITE_SCROLL_MULTIPLE_SELECT,validation:t=>"Primary"===e?u.required(t):null,options:async(e,a="",s=1,n=10)=>{const i=await t.getDiagnosis(a,s,n);return _(i,"name","concept_id")},beforeNext:async e=>await async function(e){return!e.some((({label:e})=>/Malaria/i.test(e)))||"Positive"===i.value||await w(`Patient has ${i.value} malaria test result. Do you want to continue?`)}(e),computedValue:t=>({tag:"diagnosis",obs:t.map((({value:t})=>n.buildValueCoded(`${e} Diagnosis`,t)))}),config:{isFilterDataViaApi:!0,showKeyboard:!0}}}return(e,t)=>(d(),g(m(b),null,{default:y((()=>[p(a,{cancelDestinationPath:m(x),fields:f.value,onFinishAction:L},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
