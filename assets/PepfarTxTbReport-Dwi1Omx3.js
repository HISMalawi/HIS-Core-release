import{bD as T,cc as y,d as S,I as C,c4 as M,K as D,N,a9 as x,O as v,n as $,t as B,ab as I,q as O,_ as j,r as h,o as E,c as k,w as G,b as A}from"./index-BFG-WECc.js";import{D as U}from"./ReportDateSelectionPrompt-CXB5PXhN.js";import{v as X}from"./TableView-9M7asFjO.js";import{A as q}from"./ArtDrilldown-B_33Se5B.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./MultiFieldDateHelper-CAg9Dfet.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./PopupKeyboard-DXNkcTjV.js";import"./SIngleTouchField-OvqCQtJi.js";import"./TouchScreenForm-DiI3Xfhg.js";import"./ToolbarMediumCard-C3iotOe-.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-0kHLdkku.js";import"./HisKeypad-DWBoYqiR.js";import"./BaseKeyboard-C1F0dD78.js";import"./KbHandler-BuQ4TFU6.js";import"./overlays-04a9a43f-sOHkVQfY.js";import"./fuse-YdZE3OCN.js";import"./Export-CRv3Yrt4.js";import"./HisKeyboard-CNCznGxV.js";class L extends T{constructor(){super()}getTxTbReport(s){return this.getReport("programs/1/reports/tx_tb",{rebuild_outcome:s})}getMaternalStatus(s){const u=y.parameterizeObjToString({start_date:this.startDate,end_date:this.endDate,date:this.date,program_id:this.programID,report_definition:"pepfar"});return T.postJson("vl_maternal_status?".concat(u),{patient_ids:s})}}const V=S({components:{IonPage:C,IonLoading:M,v2Datatable:X},setup(){const e=D([]),s=D(""),u=D(!1),p=new L,r=(g,i)=>({ref:i,label:g,toValue:a=>a.length,tdClick:async a=>{a.refData.length&&(await v.create({component:q,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:s,patientIdentifiers:a.refData,title:"".concat(a.data.ageGroup," ").concat(a.data.gender," ").concat(a.column.label),onFinish:()=>v.getTop().then(l=>l&&v.dismiss())}})).present()}}),w=[[{label:"#",ref:"index"},{label:"Age group",ref:"ageGroup"},{label:"Gender",ref:"gender"},r("TX_CURR","tx_curr"),r("Symptom Screen (alone)","symptom_screen_alone"),r("CXR screen","cxr_screen"),r("mWRD screen","mwrd_screen"),r("New on ART/Screen Positive","sceen_pos_new"),r("New on ART/Screen Negative","sceen_neg_new"),r("Already on ART/Screen Positive","sceen_pos_prev"),r("Already on ART/Screen Negative","sceen_neg_prev"),r("TB RX_New on ART","started_tb_new"),r("TB RX_Prev on ART","started_tb_prev")]],_=async()=>m(await $("Do you want to rebuild report?")),m=async(g=!1)=>{if(!(p.startDate&&p.endDate))return B("Start date and end date required!");u.value=!0,e.value=[];try{const i=await p.getTxTbReport(g),a={F:"Female",M:"Male"},l=Object.keys(i).reduce((t,n)=>{if(n==="Unknown")return t;const c=i[n];return Object.keys(c).forEach(o=>{t[o].rows.push({ageGroup:n,gender:a[o],...c[o]}),t[o].aggregate=Object.keys(c[o]).reduce((R,f)=>Array.isArray(c[o][f])?{...R,[f]:[...R[f]||[],...c[o][f]]}:R,t[o].aggregate)}),t},{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...l.F.rows,...l.M.rows,{ageGroup:"All",gender:"Male",...l.M.aggregate}];const F=Object.values(l.F.aggregate).reduce((t,n)=>t.concat(n),[]),b=await p.getMaternalStatus(I.uniq(F)),P=b.FBf.concat(b.FP);["FP","FNP","FBf"].forEach(t=>{e.value.push(Object.keys(l.F.aggregate).reduce((n,c)=>({...n,[c]:l.F.aggregate[c].filter(o=>t==="FNP"?!P.includes(o):b[t].includes(o))}),{ageGroup:"All",gender:t}))}),e.value=e.value.map((t,n)=>({index:n+1,...t}))}catch(i){console.error(i),O("Unable to generate report!")}u.value=!1},d=()=>U({onFinish:(g,i,a)=>{s.value="Period: ".concat(a),p.startDate=g,p.endDate=i,m()}});return N(()=>d()),{Img:x,reportData:e,isLoading:u,onRefreshReport:_,configure:d,generate:m,columns:w,period:s}}});function W(e,s,u,p,r,w){const _=h("ion-loading"),m=h("v2Datatable"),d=h("ion-page");return E(),k(d,null,{default:G(()=>[A(_,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),A(m,{title:"Tx TB Report","icon-url":e.Img("login-logos/PEPFAR.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRefreshReport,"report-prefix":"Pepfar"},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh"])]),_:1})}const de=j(V,[["render",W]]);export{de as default};
