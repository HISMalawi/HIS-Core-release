System.register(["./index-legacy-B-IGLekl.js","./drug_order_service-legacy-BKr0yRd1.js","./TaskCard-legacy-bPyRd15r.js","./VoidReason-legacy-DgjFCwcS.js","./DashboardAppIcon-legacy-a7Vucd7y.js"],(function(t,e){"use strict";var i,a,n,o,s,l,r,d,c,u,p,h,m,f,g,b,v,I,C,y,k,_,D,w,T,E,x,P,L,A,V,$,O,z,S,N,M,B,H,j,q,R,U,F,W,G,K,Y,X,Z,J,Q,tt,et,it,at,nt,ot,st,lt,rt,dt,ct,ut,pt,ht,mt,ft,gt,bt,vt,It,Ct,yt,kt,_t,Dt,wt,Tt,Et,xt,Pt,Lt,At,Vt,$t,Ot,zt,St,Nt,Mt;return{setters:[t=>{i=t.d,a=t.aW,n=t._,o=t.$,s=t.a4,l=t.R,r=t.a3,d=t.Q,c=t.S,u=t.aN,p=t.a7,h=t.aK,m=t.aq,f=t.O,g=t.ad,b=t.a6,v=t.ab,I=t.u,C=t.B,y=t.x,k=t.w,_=t.z,D=t.Z,w=t.E,T=t.C,E=t.v,x=t.aX,P=t.a0,L=t.U,A=t.W,V=t.ah,$=t.G,O=t.H,z=t.aY,S=t.a1,N=t.aZ,M=t.a_,B=t.a$,H=t.b0,j=t.b1,q=t.r,R=t.t,U=t.b2,F=t.b3,W=t.b4,G=t.a5,K=t.b5,Y=t.aJ,X=t.b6,Z=t.b7,J=t.b8,Q=t.b9,tt=t.ba,et=t.bb,it=t.bc,at=t.bd,nt=t.be,ot=t.bf,st=t.bg,lt=t.bh,rt=t.bi,dt=t.bj,ct=t.bk,ut=t.bl,pt=t.bm,ht=t.as,mt=t.bn,ft=t.az,gt=t.bo,bt=t.ag,vt=t.bp,It=t.bq,Ct=t.aA,yt=t.af,kt=t.br,_t=t.bs,Dt=t.bt,wt=t.bu,Tt=t.bv,Et=t.bw,xt=t.K,Pt=t.bx,Lt=t.by,At=t.bz,Vt=t.bA,$t=t.bB,Ot=t.I},t=>{zt=t.D},t=>{St=t.T},t=>{Nt=t.p},t=>{Mt=t.default}],execute:function(){var Bt=document.createElement("style");Bt.textContent=".selector[data-v-e1afb1d9]{width:100%;height:90%;overflow-y:auto}.close-btn[data-v-e1afb1d9]{margin:2%}.tb[data-v-077718a3]{height:80vh;overflow-y:auto}.card[data-v-5f54c099]{width:100%;border-radius:6px;border:1px solid #ccc;height:32.8vh;background-color:#fff;overflow:hidden;-webkit-box-shadow:0px -2px 19px -2px rgba(196,190,196,1);-moz-box-shadow:0px -2px 19px -2px rgba(196,190,196,1);box-shadow:0 -2px 19px -2px #c4bec4}.card[data-v-5f54c099]:active{transform:translateY(4px)}.title-card[data-v-5f54c099]{padding:5px;width:100%;color:#fff}.inactive[data-v-5f54c099]{opacity:.5}button[data-v-751691ca]:disabled,button[disabled][data-v-751691ca]{cursor:not-allowed;filter:alpha(opacity=62);-webkit-box-shadow:none;box-shadow:none;opacity:.62}.body-section[data-v-751691ca]{position:absolute}.card[data-v-751691ca]{position:relative;width:100%;height:100%;overflow:hidden}.nav-btn[data-v-751691ca]{width:90%;margin-left:5%;height:50px;background-color:#fff}.nav-btn-top[data-v-751691ca]{border-bottom:solid 2px #ccc}.nav-btn-bottom[data-v-751691ca]{border-top:solid 2px #ccc}.header-section[data-v-751691ca]{text-align:center;font-weight:700;margin:10%}.bottom-section[data-v-751691ca]{position:absolute;left:0;right:0;bottom:0;padding:15px}.tool-bar-medium-card[data-v-f304e49e]{padding:.3em;margin:0;font-size:.95rem}b[data-v-f304e49e]{color:#474646}ul li[data-v-f304e49e]{padding:0;list-style:none;color:#5e5c5c}ion-icon[data-v-ea02e0c2]{padding:.2em}.info-card-item[data-v-ea02e0c2]{height:100%!important;margin:1.2em}.next-task[data-v-ea02e0c2]{margin-top:-8px;font-weight:600;font-size:.74em}.grid-custom[data-v-ea02e0c2]{overflow-y:auto;font-size:.9em}.his-card[data-v-ea02e0c2]{height:75vh;padding:1%}@media (min-width: 1278px){.next-task[data-v-ea02e0c2]{font-size:1em}.grid-custom[data-v-ea02e0c2]{padding:.4%;height:99%}}@media only screen and (width: 1024px){.grid-custom[data-v-ea02e0c2]{height:99%;overflow:hidden}}\n/*$vite$:1*/",document.head.appendChild(Bt);const Ht=i({components:{IonGrid:a,IonRow:n,IonCol:o,TaskCard:St,IonFooter:s,IonToolbar:l,IonButton:r,IonHeader:d,IonTitle:c},props:{title:{type:String,default:"Select Activity"},items:{type:Object,required:!0},taskParams:{type:Object,required:!1}},data:()=>({filteredItems:[]}),watch:{items:{async handler(t){if(t&&!u.isEmpty(t))for(const e in t){const i=t[e];i.globalProperty&&!(await p.isProp(i.globalProperty))||i.condition&&!(await i.condition(this.taskParams))||this.filteredItems.push(i)}},deep:!0,immediate:!0}},methods:{img:t=>h(t),isDisabled(t){return"function"==typeof t&&t(this.taskParams)},closeModal(){m.dismiss({})},async doTask(t){if(this.isDisabled(t.disabled))return f("This task is disabled");"boolean"==typeof t.taskCompleted&&t?.taskCompleted&&!(await g("This task was already completed. Do you want to continue?"))||(t.action?t.action(this.taskParams,this.$router):t.url?this.$router.push({path:t.url}):t.patientUrl?this.$router.push(`${t.patientUrl}/${this.taskParams?.patientID}`):this.$router.push({name:t.id,params:{patient_id:this.taskParams?.patientID}}),this.closeModal())}}}),jt=b(Ht,[["render",function(t,e,i,a,n,o){const s=v("ion-title"),l=v("ion-toolbar"),r=v("ion-header"),d=v("task-card"),c=v("ion-col"),u=v("ion-row"),p=v("ion-grid"),h=v("ion-button"),m=v("ion-footer");return I(),C(w,null,[y(r,null,{default:k((()=>[y(l,null,{default:k((()=>[y(s,null,{default:k((()=>[_(D(t.title),1)])),_:1})])),_:1})])),_:1}),y(p,{class:"selector"},{default:k((()=>[y(u,null,{default:k((()=>[(I(!0),C(w,null,T(t.filteredItems,((e,i)=>(I(),E(c,{"size-lg":"4","size-sm":"6",key:i},{default:k((()=>[y(d,{onClick:i=>t.doTask(e),title:e.name.toUpperCase(),description:e.description,taskCompleted:e.taskCompleted,taskDisabled:t.isDisabled(e.disabled),icon:t.img(e.icon)},null,8,["onClick","title","description","taskCompleted","taskDisabled","icon"])])),_:2},1024)))),128))])),_:1})])),_:1}),y(m,null,{default:k((()=>[y(l,null,{default:k((()=>[y(h,{class:"close-btn",color:"danger",size:"large",onClick:t.closeModal,slot:"end"},{default:k((()=>e[0]||(e[0]=[_(" Close ")]))),_:1},8,["onClick"])])),_:1})])),_:1})],64)}],["__scopeId","data-v-e1afb1d9"]]),qt=i({components:{HisBasicTable:x,IonButton:r,IonToolbar:l,IonList:P,IonFooter:s,IonContent:L,IonRow:n,IonCol:o,IonTitle:c,IonHeader:d,IonItem:A},data:()=>({active:{id:-1,name:"",provider:"",rows:[],columns:[]},encounters:[]}),computed:{canVoid(){return!u.isEmpty(this.active)}},watch:{items:{handler(t){u.isEmpty(t)||(this.encounters=t,this.showDetails(this.encounters[0]))},immediate:!0,deep:!0}},props:{title:{type:String,required:!0},items:{type:Object,required:!0}},methods:{closeModal(){m.dismiss({})},removeEncounter(t){this.encounters=this.encounters.filter((e=>e.other.id!=t))},voidActiveItem(){Nt((async t=>{try{await this.active.onVoid(t),this.removeEncounter(this.active.id),this.active={},u.isEmpty(this.encounters)||this.showDetails(this.encounters[0])}catch(e){V(`${e}`)}}),"void-modal custom-modal-backdrop")},async showDetails(t){this.active.id=t.other.id,this.active.name=t.label,this.active.columns=t.other.columns,this.active.onVoid=t.other.onVoid,this.active.rows=await t.other.getRows(),this.active.provider=await t.other.provider,this.active.isBDE=t.other.isBDE??!1}}}),Rt={class:"his-md-text",style:{display:"flex","justify-content":"space-between",width:"100%"}},Ut={class:"ion-margin-start"},Ft={class:"ion-margin-end"},Wt={class:"tb"},Gt=b(qt,[["render",function(t,e,i,a,n,o){const s=v("ion-text"),l=v("ion-toolbar"),r=v("ion-header"),d=v("ion-item"),c=v("ion-list"),u=v("ion-col"),p=v("his-basic-table"),h=v("ion-row"),m=v("ion-content"),f=v("ion-button"),g=v("ion-footer");return I(),C(w,null,[y(r,null,{default:k((()=>[y(l,null,{default:k((()=>[$("div",Rt,[$("span",Ut,D(t.title),1),t.active.isBDE?(I(),E(s,{key:0,color:"danger"},{default:k((()=>e[0]||(e[0]=[_("BDE Record")]))),_:1})):O("",!0),$("span",Ft,"Provider: "+D(t.active.provider),1)])])),_:1})])),_:1}),y(m,null,{default:k((()=>[y(h,null,{default:k((()=>[y(u,{size:"4"},{default:k((()=>[y(c,null,{default:k((()=>[(I(!0),C(w,null,T(t.encounters,((e,i)=>(I(),E(d,{class:"his-sm-text",key:i,color:e.other.id===t.active.id?"primary":"",detail:!0,onClick:()=>t.showDetails(e)},{default:k((()=>[_(D(e.label.toUpperCase()),1)])),_:2},1032,["color","onClick"])))),128))])),_:1})])),_:1}),y(u,{size:"8"},{default:k((()=>[$("div",Wt,[y(p,{columns:t.active.columns,rows:t.active.rows},null,8,["columns","rows"])])])),_:1})])),_:1})])),_:1}),y(g,null,{default:k((()=>[y(l,null,{default:k((()=>[y(f,{color:"danger",onClick:t.voidActiveItem,disabled:!t.canVoid,size:"large"},{default:k((()=>e[1]||(e[1]=[_(" Void encounter")]))),_:1},8,["onClick","disabled"]),y(f,{onClick:t.closeModal,size:"large",slot:"end"},{default:k((()=>e[2]||(e[2]=[_(" Close ")]))),_:1},8,["onClick"])])),_:1})])),_:1})],64)}],["__scopeId","data-v-077718a3"]]),Kt=i({components:{HisBasicTable:x,IonHeader:d,IonToolbar:l,IonContent:L,IonFooter:s,IonButton:r},props:{title:{type:String,required:!0},columns:{type:Array,required:!0},rows:{type:Array,default:()=>[]}},methods:{async closeModal(){await m.dismiss({})}}}),Yt=b(Kt,[["render",function(t,e,i,a,n,o){const s=v("ion-title"),l=v("ion-toolbar"),r=v("ion-header"),d=v("his-basic-table"),c=v("ion-content"),u=v("ion-button"),p=v("ion-footer");return I(),C(w,null,[y(r,null,{default:k((()=>[y(l,null,{default:k((()=>[y(s,{class:"his-md-text"},{default:k((()=>[_(D(t.title),1)])),_:1})])),_:1})])),_:1}),y(c,null,{default:k((()=>[y(d,{columns:t.columns,rows:t.rows},null,8,["columns","rows"])])),_:1}),y(p,null,{default:k((()=>[y(l,null,{default:k((()=>[y(u,{size:"large",onClick:t.closeModal,slot:"end"},{default:k((()=>e[0]||(e[0]=[_(" Close ")]))),_:1},8,["onClick"])])),_:1})])),_:1})],64)}]]),Xt=i({components:{TextSkeleton:z,IonLabel:S,IonList:P,IonItem:A,IonChip:N,IonIcon:M,IonBadge:B},data:()=>({time:H}),props:{isEnabled:{type:Boolean,default:()=>!0},counter:{type:Number,required:!1},isLoading:{type:Boolean},icon:{type:String},title:{type:String,required:!0},items:{type:Object},titleColor:{type:String,required:!1,default:()=>"#337ab7"}}}),Zt=b(Xt,[["render",function(t,e,i,a,n,o){const s=v("ion-badge"),l=v("ion-label"),r=v("ion-item"),d=v("text-skeleton"),c=v("ion-icon"),u=v("ion-chip"),p=v("ion-list");return I(),C("div",{class:j(["card",{inactive:!t.isEnabled,clickable:t.isEnabled}])},[y(r,{color:t.titleColor,lines:"none",class:"his-md-text title-card"},{default:k((()=>[y(s,{slot:"start",class:"his-sm-text",color:"light"},{default:k((()=>[$("b",null,D(t.counter),1)])),_:1}),y(l,null,{default:k((()=>[_(D(t.title),1)])),_:1})])),_:1},8,["color"]),t.isLoading?(I(),E(d,{key:0,itemCount:5})):O("",!0),t.isLoading?O("",!0):(I(),E(p,{key:1},{default:k((()=>[(I(!0),C(w,null,T(t.items,((i,a)=>(I(),E(r,{key:a},{default:k((()=>[y(l,{class:j(i?.other?.wrapTxt?"ion-text-wrap":""),innerHTML:i.label},null,8,["class","innerHTML"]),i.value?(I(),E(u,{key:0,class:"his-sm-text ion-no-margin",slot:"end"},{default:k((()=>[y(c,{icon:t.icon},null,8,["icon"]),y(l,null,{default:k((()=>[_(D(i.value),1)])),_:2},1024)])),_:2},1024)):O("",!0),i.other?.isBDE?(I(),E(u,{key:1,class:"his-sm-text ion-no-margin",slot:"end",color:"danger",style:{"margin-left":".2rem"}},{default:k((()=>[y(l,null,{default:k((()=>e[0]||(e[0]=[_("BDE")]))),_:1})])),_:1})):O("",!0)])),_:2},1024)))),128))])),_:1}))],2)}],["__scopeId","data-v-5f54c099"]]),Jt=i({components:{IonList:P,IonItem:A},props:{title:{type:String,default:()=>"Visits"},items:{type:Object,required:!0}},data:()=>({active:{},activeListItems:[],paginatedListItems:[],index:-1,perPage:6,btnSize:45}),computed:{listAlignmentClass(){return this.activeListItems&&this.activeListItems.length===this.perPage?"vertically-align":""},upbuttonImg:()=>"/assets/images/drop-up-arrow.svg",downbuttonImg:()=>"/assets/images/drop-down-arrow.svg",showNextButton(){return this.index+1<this.paginatedListItems.length},showPrevButton(){return this.index>=1}},watch:{items:{handler(t){if(!u.isEmpty(t)){this.index=0,this.paginatedListItems=u.chunk(t,this.perPage),this.activeListItems=this.paginatedListItems[0],this.active=this.activeListItems[0];for(const t in this.paginatedListItems){const e=u.findIndex(this.paginatedListItems[t],(t=>!0===t.other.isActive),0);if(-1!=e){this.index=parseInt(t),this.activeListItems=this.paginatedListItems[t],this.active=this.activeListItems[e];break}}}},deep:!0,immediate:!0},index:{handler(t){this.activeListItems=this.paginatedListItems[t]},immediate:!0},active(t){this.$emit("onselect",t)}},methods:{onselect(t){this.active=t},isActive(t){return t.label===this.active.label},goNext(){const t=this.index+1;t<=this.paginatedListItems.length&&(this.index=t)},goPrev(){this.paginatedListItems.length>=1&&(this.index-=1)}}}),Qt={class:"card his-card"},te={class:"his-md-text header-section"},ee=["disabled"],ie=["src","width"],ae={class:"bottom-section"},ne=["disabled"],oe=["src","width"],se=b(Jt,[["render",function(t,e,i,a,n,o){const s=v("ion-item"),l=v("ion-list");return I(),C("div",Qt,[$("div",te,D(t.title),1),$("button",{class:"nav-btn nav-btn-top clickable",disabled:!t.showPrevButton,onClick:e[0]||(e[0]=(...e)=>t.goPrev&&t.goPrev(...e))},[$("img",{src:t.upbuttonImg,width:t.btnSize},null,8,ie)],8,ee),$("div",{class:j(t.listAlignmentClass)},[y(l,null,{default:k((()=>[(I(!0),C(w,null,T(t.activeListItems,((e,i)=>(I(),E(s,{class:"his-md-text",key:i,onClick:i=>t.onselect(e),detail:!0,color:t.isActive(e)?"primary":""},{default:k((()=>[_(D(e.label),1)])),_:2},1032,["onClick","color"])))),128))])),_:1})],2),$("div",ae,[$("button",{class:"nav-btn nav-btn-bottom clickable",disabled:!t.showNextButton,onClick:e[1]||(e[1]=(...e)=>t.goNext&&t.goNext(...e))},[$("img",{src:t.downbuttonImg,width:t.btnSize},null,8,oe)],8,ne)])])}],["__scopeId","data-v-751691ca"]]),le=i({name:"HisResultCard",components:{IonIcon:M},props:{icon:{required:!1},items:{type:Object,required:!0}},methods:{hasIcon:t=>"other"in t&&"icon"in t.other}}),re={class:"tool-bar-medium-card"},de=i({name:"PatientToolbar",components:{IonHeader:d,IonToolbar:l,IonCol:o,IonRow:n,InfoCard:b(le,[["render",function(t,e,i,a,n,o){const s=v("ion-icon");return I(),C("div",re,[(I(!0),C(w,null,T(t.items,((e,i)=>(I(),C("div",{key:i},[t.hasIcon(e)?(I(),E(s,{key:0,icon:e.other.icon},null,8,["icon"])):O("",!0),_(" "+D(e.label)+": ",1),$("b",null,D(e.value),1)])))),128))])}],["__scopeId","data-v-f304e49e"]]),IconCard:Mt},props:{app:{type:Object},appVersion:{type:String},patientCardInfo:{type:Array,required:!0},programCardInfo:{type:Array,required:!0},appIcon:{type:String,required:!0}},computed:{logo(){return h(this.appIcon)}}}),ce=i({components:{IonList:P,IonLabel:S,IonItem:A,IonSegment:F,IonSegmentButton:W,IonChip:N,IonPage:G,IonIcon:M,IonFooter:s,IonContent:L,IonButton:r,IonToolbar:l,IonGrid:a,IonRow:n,IonCol:o,FullToolbar:b(de,[["render",function(t,e,i,a,n,o){const s=v("info-card"),l=v("ion-col"),r=v("icon-card"),d=v("ion-row"),c=v("ion-toolbar"),u=v("ion-header");return I(),E(u,{translucent:!0},{default:k((()=>[y(c,null,{default:k((()=>[y(d,null,{default:k((()=>[y(l,{size:"5"},{default:k((()=>[y(s,{items:t.patientCardInfo},null,8,["items"])])),_:1}),y(l,{size:"5"},{default:k((()=>[y(s,{items:t.programCardInfo},null,8,["items"])])),_:1}),y(l,{size:"2"},{default:k((()=>[y(r,{app:t.app,version:t.appVersion,icon:t.logo},null,8,["app","version","icon"])])),_:1})])),_:1})])),_:1})])),_:1})}]]),PrimaryCard:Zt,VisitDatesCard:se,MinimalToolbar:K((()=>$t((()=>e.import("./MinimalToolbar-legacy-DPG5jtQn.js")),void 0)))},setup(){const t=q("lg"),{resolution:e}=function(){const t=q({width:window.innerWidth,height:window.innerHeight});function e(e){t.value={height:e.currentTarget.innerHeight,width:e.currentTarget.innerWidth}}return R((()=>{addEventListener("resize",e)})),U((()=>{removeEventListener("resize",e)})),{resolution:t}}();return Y((()=>e.value),(e=>{e&&e.width<=900?t.value="sm":t.value="lg"}),{immediate:!0,deep:!0}),{sync:X,time:H,timeOutline:Z,person:J,calendar:Q,medical:tt,clipboard:et,apps:it,folder:at,logOut:nt,clipboardOutline:ot,appsOutline:st,folderOutline:lt,logOutOutline:rt,alertCircle:dt,screenBreakPoint:t}},data:()=>({online:ct,initMode:"",activeTab:1,app:{},dashboardComponent:{},isBDE:!1,currentDate:"",sessionDate:"",nextTask:{},programId:0,patientId:0,patient:{},patientProgram:{},patientCardInfo:[],programCardInfo:[],visitDates:[],activeVisitDate:"",patientCards:[],appVersion:ut.getFullVersion(),sessionEncounterMap:{},savedEncounters:[]}),computed:{patientIsset(){return!u.isEmpty(this.patient)},patientName(){return u.isEmpty(this.patient)?"N/A":this.patient.name},appHasCustomContent(){return!u.isEmpty(this.app.customPatientDashboardContentComponent)},customDashboardContent(){return this.app.customPatientDashboardContentComponent},visitDatesTitle(){return`${this.visitDates.length} Visits`},hasOfflineObs(){const{offlineData:t}=mt();return t.value.some((t=>`${t.id}`==`${this.patientId}`&&(t.obsToSave||[]).some((t=>"Success"!=t.uploadStatus))&&t.programID===ut.getProgramID()))}},watch:{online:{handler(t){t&&this.init()}},activeVisitDate(t){this.appHasCustomContent||this.updateCardVisitData(t)}},created(){this.app=pt.getActiveApp(),this.setPatientCards()},mounted(){this.$route.params.id&&(this.patientId=this.$route.params.id,pt.doAppManagementTasks().then((()=>{this.app=pt.getActiveApp(),"function"==typeof this.app?.overridePatientDashboardCards&&this.setPatientCards(),this.programId=this.app.programID,this.appHasCustomContent&&(this.patientCards=[]),this.init()})))},methods:{async initSynchronization(){const{synchronizeRecord:t,findByID:e}=mt();await this.showLoader("Synchronization has started. this may take a while");try{const i=(await t(this.patientId)).personID;if(!i)return this.clearLoader(),this.patientId;if(`${i}`!=`${this.patientId}`){const t=e(this.patientId);t.id=i,t.personID=i,t.generatedIDs=[...t.generatedIDs||[],i],document.location=`/patient/dashboard/${i}`}return this.clearLoader(),parseInt(`${i}`)}catch(i){console.error("Error synchronizing data "+i)}this.clearLoader()},async initOnline(){const t=parseInt(`${this.patientId}`);try{let e=await ht.get("ACTIVE_PATIENT",{patientID:t});if(u.isEmpty(e)||this.hasOfflineObs){const t=await this.initSynchronization();if(e=await ht.get("ACTIVE_PATIENT",{patientID:parseInt(`${t}`)}),u.isEmpty(e))return!1}this.patient={patient_id:e.getID(),birthdate:e.getBirthdate(),name:e.getFullName(),currentVillage:e.getCurrentVillage(),age:e.getAge(),nationalID:e.getNationalID(),gender:e.getGender(),phone:e.getPhoneNumber()},mt().cachePatient(e)}catch(e){return console.error(`${e}`),f("Unable to initialise client online"),!1}return this.patientCardInfo=this.getPatientCardInfo(this.patient),this.getNextTask().then((t=>this.nextTask=t)),this.getPatientVisitDates(t).then((t=>{this.visitDates=t,this.loadSavedEncounters()})).catch((t=>{console.error(t)})),this.buildProgramInfoData(t),ft.value=!1,!0},initOffline(){const t=mt().findByID(this.patientId),e=t?.personParams?.person;return!!e&&(this.patient={patient_id:e.personID,birthdate:e.birthdate,name:`${e.given_name} ${e.family_name}`,currentVillage:e.current_village||"N/A",age:e?.age||gt(ut.getSessionDate()).diff(e.birthdate,"years"),gender:e.gender,phone:e.phone||"N/A",nationalID:e.npid||"No npid"},this.getNextTask().then((t=>this.nextTask=t)),this.patientCardInfo=this.getPatientCardInfo(this.patient),this.buildProgramInfoData(this.patientId),!0)},async init(){this.currentDate=bt.currentDisplayDate(),this.sessionDate=this.toDate(ut.getSessionDate()),this.isBDE=ut.isBDE()||!1,this.initMode="",await this.initOnline()?this.initMode="online":this.initOffline()&&(this.initMode="offline"),this.initMode?"offline"===this.initMode&&this.launchSyncDialog():f("Unable to initialise dashboard")},async buildProgramInfoData(t){this.programCardInfo="function"==typeof this.app?.patientProgramInfoData?this.app?.patientProgramInfoData(t):[];for(const i of this.programCardInfo)try{"function"==typeof i.init&&await i.init(),"function"==typeof i.asyncValue?i.asyncValue().then((t=>i.value=t)):"function"==typeof i.staticValue&&(i.value=i.staticValue())}catch(e){console.error(`${e}`)}},setPatientCards(){const t=[{id:"c1",items:[],cache:{},label:"Activities",color:"primary",isLoading:!1,icon:Z,isEnabled:this.isCardEnabled("activitiesEnabled"),onVisitDate:({card:t,date:e,allCards:i})=>{t.isLoading=!0;const a=i.filter((t=>t.subscription&&t.subscription.c1));a.forEach((t=>t.isLoading=!0)),vt.getEncounters(parseInt(`${this.patientId}`),{date:e}).then((i=>{this.sessionEncounterMap={},a.forEach((t=>{t.subscription&&t.subscription.c1&&(t.isLoading=!1,t.subscription.c1({encounters:i,card:t,date:e}))})),t.items=this.getActivitiesCardInfo(i),t.cache&&(t.cache[e]=t.items),e!==ut.getSessionDate()||u.isEmpty(i)||(this.sessionEncounterMap=i.reduce(((t,e)=>(t[e.type.name.toLowerCase()]=e.observations.reduce(((t,e)=>t.concat(e.concept.concept_names)),[]).map((t=>t.name.toLowerCase())),t)),{})),t.isLoading=!1})).catch((i=>{console.error(i),t.items=[],t.isLoading=!1,t.cache&&(t.cache[e]=t.items),a.forEach((t=>t.isLoading=!1))}))},onClick:t=>{t.isEnabled&&(t.isLoading?f("Please wait..."):this.openModal(t.items,"Select Activities",Gt))}},{id:"c2",items:[],cache:{},color:"success",isLoading:!1,label:"Lab Orders",icon:Z,isEnabled:this.isCardEnabled("labEnabled"),onVisitDate:({card:t,date:e})=>{t.isLoading=!0,this.getLabOrderCardInfo(e).then((i=>{t.items=i,t.cache[e]=t.items,t.isLoading=!1})).catch((()=>{t.items=[],t.cache[e]=t.items,t.isLoading=!1}))},onClick:t=>t.isEnabled&&this.$router.push(`/art/encounters/lab/${this.patientId}`)},{id:"c3",items:[],label:"Alerts",color:"danger",icon:It,isLoading:!1,isInit:!1,isEnabled:this.isCardEnabled("alertsEnabled"),onVisitDate:({card:t})=>{if(t.isInit)return;const e=this.getPatientAlertCardInfo();"object"==typeof e&&"function"==typeof e.then&&(t.isLoading=!0,this.getPatientAlertCardInfo().then((e=>{e&&(t.items=e),t.isInit=!0,t.isLoading=!1})).catch((()=>{t.items=[],t.isInit=!0,t.isLoading=!1}))),e&&(t.items=e)},onClick:()=>{}},{id:"c4",items:[],cache:{},label:"Medications",color:"warning",icon:Z,isLoading:!1,isEnabled:this.isCardEnabled("medicationsEnabled"),onVisitDate:({card:t,date:e})=>{t.isLoading=!0,zt.getOrderByPatient(parseInt(`${this.patientId}`),{start_date:e}).then((i=>{t.items=this.getMedicationCardInfo(i),t.cache&&(t.cache[e]=t.items),t.isLoading=!1})).catch((()=>{t.items=[],t.cache&&(t.cache[e]=t.items),t.isLoading=!1}))},onClick:t=>{if(!t.isEnabled)return;if(t.isLoading)return f("Please wait..");const e=t.items.map((t=>[t.other.drug.name,this.toDate(t.other.order.start_date),this.toDate(t.other.order.auto_expire_date),t.other.quantity]));this.openTableModal(["Medication","Start date","End date","Amount given"],e,"Medication History")}}];if("function"==typeof this.app?.overridePatientDashboardCards)for(const e of this.app.overridePatientDashboardCards()){const i=u.findIndex(t,{id:e.id});i>=0&&(t[i]=e)}this.patientCards=t},launchSyncDialog(){mt().launchObservationDialog(this.patientId,{onDeleteEncounter:()=>this.init()})},isCardEnabled(t){const e=this.app?.configDefaultPatientDashboardCards;return!e||!(t in e)||e[t]||!1},async showLoader(t="Please wait...."){(await Ct.create({message:t,backdropDismiss:!1})).present()},clearLoader(){Ct.getTop().then((t=>t?Ct.dismiss():null))},toDate:t=>bt.toStandardHisDisplayFormat(t),toTime:t=>bt.toStandardHisTimeFormat(t),loadSavedEncounters(){vt.getSavedEncounters(parseInt(`${this.patientId}`)).then((t=>this.savedEncounters=t))},updateCardVisitData(t,e=!1,i=""){this.patientCards.forEach((i=>{"object"==typeof i.cache&&i.cache[t]&&!e?i.items=i.cache[t]:i.isEnabled&&"function"==typeof i.onVisitDate?i.onVisitDate({card:i,invalidateCache:e,date:t,allCards:this.patientCards,patient:this.patient}):i.items=[]}))},async getPatientVisitDates(t){return(await yt.getPatientVisits(t,!1)).map((t=>({label:this.toDate(t),value:t,other:{isActive:t===ut.getSessionDate()}})))},async getNextTask(){return ft.value?mt().nextPatientWorkflowActivity(this.patientId)||{}:kt.getNextTaskParams(parseInt(`${this.patientId}`))},goToNextTask(){if(this.nextTask?.patientUrl&&ft.value)return this.$router.push(`${this.nextTask?.patientUrl}/${this.patientId}`);_t(this.nextTask?.name,this.patientId)},onActiveVisitDate(t){this.activeVisitDate=t.value},getPatientCardInfo(t){const e="M"===t.gender?Dt:wt;return[{label:"Name",value:t.name,other:{icon:e}},{label:"Birthdate",value:`\n                    ${this.toDate(t.birthdate)}\n                    (${t.age}) \n                    (${t.nationalID})`},{label:"Current Village",value:t.currentVillage},{label:"Phone#",value:t.phone}]},getActivitiesCardInfo(t){return t.map((t=>({label:`${t.type.name}`.toUpperCase(),value:this.toTime(t.encounter_datetime),other:{provider:Tt.getPersonFullName(t.provider_id),isBDE:vt.isEncounterInBDE(t),id:t.encounter_id,columns:["Observation","Value","Time"],onVoid:async e=>{await this.showLoader(),vt.voidEncounter(t.encounter_id,e).then((()=>{this.clearLoader(),this.loadSavedEncounters(),this.updateCardVisitData(this.activeVisitDate,!0),Et.emit("EncounterVoided",t.encounter_id),this.getNextTask().then((t=>this.nextTask=t)),xt("Encounter has been voided!",2e3)})).catch((t=>{this.clearLoader(),V(`${t}`,32e3)}))},getRows:async()=>{const e=[],{observations:i}=t;for(const t in i){let n="<UNKNOWN CONCEPT>";const o=i[t];try{if(o?.concept?.concept_names){const t=o?.drug?.drug_cms?.short_name??o?.drug?.name??"",e=t?`(${t})`:"";n=`${o.concept.concept_names[0].name} ${e}`.trim()}else n=await Pt.getConceptName(o.concept_id)}catch(a){console.error(o,a)}const s=await Lt.resolvePrimaryValue(o),l=bt.toStandardHisTimeFormat(o.date_created);e.push([n,s,l])}return e}}})))},getMedicationCardInfo(t){return t.map((t=>({label:`${t.drug.name}${t.regimen?` (${t.regimen})`:""}`,value:this.toTime(t.order.start_date),other:t})))},async getLabOrderCardInfo(t){return"function"==typeof this.app.getPatientDashboardLabOrderCardItems?this.app.getPatientDashboardLabOrderCardItems(this.patientId,t):(await At.getOrders(parseInt(`${this.patientId}`),{date:t})).map((t=>({label:t.specimen.name,value:this.toTime(t.order_date)})))},async getPatientAlertCardInfo(){if("getPatientDashboardAlertsAndNotes"in this.app)return this.app.getPatientDashboardAlertsAndNotes(this.patient)},async changeApp(){const t=await pt.selectApplication("PatientDashboard",!0);t&&(t.programID!=this.programId?(this.programId=t.programID,this.$router.push(`/patients/confirm?patient_barcode=${this.patient.nationalID}`)):this.init())},async showTasks(){if("primaryPatientActivites"in this.app){const t=[...this.app.primaryPatientActivites].map((t=>{const e=(t.encounterTypeName||t.name).toLowerCase();return"object"!=typeof t.taskCompletionChecklist||u.isEmpty(this.sessionEncounterMap)?t.taskCompleted=!u.isEmpty(this.sessionEncounterMap[e]):t.taskCompleted=t.taskCompletionChecklist.every((t=>u.isArray(this.sessionEncounterMap[e])&&this.sessionEncounterMap[e].includes(t.toLowerCase()))),t}));this.openModal(t,"Tasks for",jt,this.sessionDate)}},showOptions(){if("secondaryPatientActivites"in this.app){const t=this.app.secondaryPatientActivites;this.openModal(t,"Select Activity",jt)}},async startModal(t,e){(await m.create({component:t,backdropDismiss:!1,cssClass:"large-modal",componentProps:e})).present()},async openModal(t,e,i,a=""){u.isEmpty(this.patientProgram)&&(this.patientProgram=await new Vt(this.patientId).getProgram()),this.startModal(i,{items:t,title:`${e}: ${a||this.toDate(this.activeVisitDate.toString())}`,taskParams:{patient:this.patient,gender:this.patient.gender,program:this.patientProgram,visitDate:this.activeVisitDate,patientID:this.patientId,savedEncounters:this.savedEncounters}})},openTableModal(t,e,i){this.startModal(Yt,{columns:t,rows:e,title:`${i}: ${this.toDate(this.activeVisitDate.toString())}`})},onCancel(){ht.invalidate("ACTIVE_PATIENT"),ht.invalidate("PATIENT_PROGRAM"),ht.invalidate("PATIENT_LAB_ORDERS"),this.$router.push({path:"/"})}}}),ue={key:0},pe={class:"his-card info-card-item"},he={class:"his-card info-card-item"},me={class:"his-card info-card-item"},fe={class:"his-sm-text his-card"},ge={key:0},be={key:1},ve={key:0},Ie={key:1},Ce={key:1};t("default",b(ce,[["render",function(t,e,i,a,n,o){const s=v("minimal-toolbar"),l=v("ion-icon"),r=v("ion-label"),d=v("ion-segment-button"),c=v("ion-segment"),u=v("ion-toolbar"),p=v("ion-button"),h=v("primary-card"),m=v("ion-col"),f=v("ion-row"),g=v("ion-grid"),b=v("ion-item"),x=v("ion-list"),P=v("ion-content"),L=v("ion-footer"),A=v("ion-page"),V=v("full-toolbar"),z=v("visit-dates-card"),S=v("ion-chip");return I(),C(w,null,["sm"===t.screenBreakPoint?(I(),E(A,{key:0},{default:k((()=>[y(s,{title:t.patientName,menuTitle:t.visitDatesTitle,menuItems:t.visitDates,appIcon:t.app.applicationIcon,onOnClickMenuItem:t.onActiveVisitDate},null,8,["title","menuTitle","menuItems","appIcon","onOnClickMenuItem"]),"sm"===t.screenBreakPoint?(I(),E(u,{key:0},{default:k((()=>[y(c,{value:t.activeTab,class:"ion-justify-content-center"},{default:k((()=>[y(d,{value:"1",onClick:e[0]||(e[0]=e=>t.activeTab=1)},{default:k((()=>[y(l,{icon:t.calendar},null,8,["icon"]),y(r,null,{default:k((()=>e[6]||(e[6]=[_("Visits")]))),_:1})])),_:1}),y(d,{value:"2",onClick:e[1]||(e[1]=e=>t.activeTab=2)},{default:k((()=>[y(l,{icon:t.person},null,8,["icon"]),y(r,null,{default:k((()=>e[7]||(e[7]=[_("Patient")]))),_:1})])),_:1}),y(d,{value:"3",onClick:e[2]||(e[2]=e=>t.activeTab=3)},{default:k((()=>[y(l,{icon:t.medical},null,8,["icon"]),y(r,null,{default:k((()=>e[8]||(e[8]=[_("Program")]))),_:1})])),_:1}),y(d,{value:"4",onClick:e[3]||(e[3]=e=>t.activeTab=4)},{default:k((()=>[y(l,{icon:t.time},null,8,["icon"]),y(r,null,{default:k((()=>e[9]||(e[9]=[_("Dates")]))),_:1})])),_:1})])),_:1},8,["value"])])),_:1})):O("",!0),t.nextTask.name&&"sm"===t.screenBreakPoint?(I(),E(u,{key:1},{default:k((()=>[y(p,{style:{width:"100%"},color:"success",onClick:t.goToNextTask},{default:k((()=>[y(r,null,{default:k((()=>[$("b",null,"Next Task: "+D(t.nextTask.name.toUpperCase()),1)])),_:1}),y(l,{icon:t.alertCircle},null,8,["icon"])])),_:1},8,["onClick"])])),_:1})):O("",!0),y(P,{id:"main-content"},{default:k((()=>["sm"===t.screenBreakPoint?(I(),C("div",ue,[t.appHasCustomContent&&1===t.activeTab&&t.patientIsset?(I(),E(Ot(t.customDashboardContent),{key:0,patient:t.patient,visitDate:t.activeVisitDate},null,8,["patient","visitDate"])):O("",!0),t.appHasCustomContent||1!==t.activeTab?O("",!0):(I(),E(g,{key:1},{default:k((()=>[y(f,null,{default:k((()=>[(I(!0),C(w,null,T(t.patientCards,((t,e)=>(I(),E(m,{size:"12",key:e},{default:k((()=>[(I(),E(h,{key:`mcard${e}`,isEnabled:t.isEnabled,counter:t.items.length,icon:t.icon,title:t.label,titleColor:t.color,items:t.items,isLoading:t.isLoading,onClick:e=>t.onClick(t)},null,8,["isEnabled","counter","icon","title","titleColor","items","isLoading","onClick"]))])),_:2},1024)))),128))])),_:1})])),_:1})),2===t.activeTab?(I(),E(x,{key:2},{default:k((()=>[(I(!0),C(w,null,T(t.patientCardInfo,((t,e)=>(I(),C("div",{class:"his-card info-card-item",key:e},[y(b,{lines:"none"},{default:k((()=>[y(r,null,{default:k((()=>[_(D(t.label),1)])),_:2},1024),y(r,{slot:"end"},{default:k((()=>[$("b",null,D(t.value),1)])),_:2},1024)])),_:2},1024)])))),128))])),_:1})):O("",!0),3===t.activeTab?(I(),E(x,{key:3},{default:k((()=>[(I(!0),C(w,null,T(t.programCardInfo,((t,i)=>(I(),C("div",{class:"his-card info-card-item",key:i},[y(b,{lines:"none"},{default:k((()=>[y(r,null,{default:k((()=>[_(D(t.label),1)])),_:2},1024),y(r,{slot:"end"},{default:k((()=>[$("b",null,D(t.value),1)])),_:2},1024)])),_:2},1024),e[10]||(e[10]=$("p",null,null,-1))])))),128))])),_:1})):O("",!0),4===t.activeTab?(I(),E(x,{key:4},{default:k((()=>[$("div",pe,[y(b,{lines:"none"},{default:k((()=>[y(r,null,{default:k((()=>e[11]||(e[11]=[_(" Today ")]))),_:1}),y(r,{slot:"end"},{default:k((()=>[$("b",null,D(t.currentDate),1)])),_:1})])),_:1})]),$("div",he,[y(b,{lines:"none"},{default:k((()=>[y(r,null,{default:k((()=>e[12]||(e[12]=[_(" Session ")]))),_:1}),y(r,{slot:"end"},{default:k((()=>[$("b",null,D(t.sessionDate),1)])),_:1})])),_:1})]),$("div",me,[y(b,{lines:"none"},{default:k((()=>[y(r,null,{default:k((()=>e[13]||(e[13]=[_(" Current visit date ")]))),_:1}),y(r,{slot:"end"},{default:k((()=>[$("b",null,D(t.activeVisitDate),1)])),_:1})])),_:1})])])),_:1})):O("",!0)])):O("",!0)])),_:1}),y(L,null,{default:k((()=>["sm"===t.screenBreakPoint?(I(),E(u,{key:0,color:"dark"},{default:k((()=>[t.hasOfflineObs?(I(),E(p,{key:0,color:"success",size:"large",slot:"start",onClick:t.launchSyncDialog},{default:k((()=>[y(l,{icon:t.sync},null,8,["icon"])])),_:1},8,["onClick"])):O("",!0),y(p,{color:"light",size:"medium",slot:"start","router-link":"/session/date"},{default:k((()=>[y(l,{icon:t.timeOutline},null,8,["icon"])])),_:1}),y(p,{color:"primary",size:"medium",slot:"end",onClick:t.showTasks},{default:k((()=>[y(l,{icon:t.clipboard},null,8,["icon"])])),_:1},8,["onClick"]),y(p,{color:"primary",size:"medium",slot:"end",onClick:t.showOptions},{default:k((()=>[y(l,{icon:t.folder},null,8,["icon"])])),_:1},8,["onClick"]),y(p,{color:"primary",size:"medium",slot:"end",onClick:t.changeApp},{default:k((()=>[y(l,{icon:t.apps},null,8,["icon"])])),_:1},8,["onClick"]),y(p,{color:"success",size:"medium",slot:"end",onClick:t.onCancel},{default:k((()=>[y(l,{icon:t.logOut},null,8,["icon"])])),_:1},8,["onClick"])])),_:1})):O("",!0)])),_:1})])),_:1})):O("",!0),"lg"===t.screenBreakPoint?(I(),E(A,{key:1},{default:k((()=>[y(V,{app:t.app,appVersion:t.appVersion,appIcon:t.app.applicationIcon,patientCardInfo:t.patientCardInfo,programCardInfo:t.programCardInfo},null,8,["app","appVersion","appIcon","patientCardInfo","programCardInfo"]),y(P,{id:"main-content"},{default:k((()=>[y(g,{class:"grid-custom vertically-align"},{default:k((()=>[y(f,null,{default:k((()=>[y(m,{size:"2.4"},{default:k((()=>[y(z,{title:t.visitDatesTitle,items:t.visitDates,onOnselect:t.onActiveVisitDate},null,8,["title","items","onOnselect"])])),_:1}),y(m,{size:"9.6"},{default:k((()=>[$("div",fe,[y(f,null,{default:k((()=>[y(m,{"size-md":"4","size-sm":"6"},{default:k((()=>[e[14]||(e[14]=_(" Today's Date: ")),$("b",null,D(t.currentDate),1)])),_:1}),y(m,{"size-md":"4","size-sm":"6"},{default:k((()=>[t.nextTask.name?(I(),C("span",ge,[y(S,{class:"next-task",color:"success",onClick:t.goToNextTask},{default:k((()=>[_("Next Task: "+D(t.nextTask.name.toUpperCase()),1)])),_:1},8,["onClick"])])):(I(),C("span",be,e[15]||(e[15]=[_(" Next Task: "),$("b",null,"NONE",-1)])))])),_:1}),y(m,{"size-md":"4","size-sm":"12"},{default:k((()=>[t.isBDE?(I(),C("span",ve,[y(S,{style:{marginTop:"-8px"},color:"danger",onClick:e[4]||(e[4]=e=>t.$router.push({name:"Session Date"}))},{default:k((()=>[$("b",null," BDE: "+D(t.sessionDate.toUpperCase()),1)])),_:1})])):(I(),C("span",Ie,[y(S,{style:{marginTop:"-8px"},color:"dark",onClick:e[5]||(e[5]=e=>t.$router.push({name:"Session Date"}))},{default:k((()=>[$("b",null,"Set Date: "+D(t.sessionDate.toUpperCase()),1)])),_:1})]))])),_:1})])),_:1}),t.appHasCustomContent&&t.patientIsset?(I(),E(Ot(t.customDashboardContent),{key:0,patient:t.patient,visitDate:t.activeVisitDate},null,8,["patient","visitDate"])):O("",!0),t.appHasCustomContent?O("",!0):(I(),C("div",Ce,[y(f,null,{default:k((()=>[(I(!0),C(w,null,T(t.patientCards,((t,e)=>(I(),E(m,{size:"6",key:e},{default:k((()=>[(I(),E(h,{key:t.label,isEnabled:t.isEnabled,counter:t.items.length,icon:t.icon,title:t.label,titleColor:t.color,items:t.items,isLoading:t.isLoading,onClick:e=>t.onClick(t)},null,8,["isEnabled","counter","icon","title","titleColor","items","isLoading","onClick"]))])),_:2},1024)))),128))])),_:1})]))])])),_:1})])),_:1})])),_:1})])),_:1}),y(u,{color:"dark"},{default:k((()=>[t.hasOfflineObs?(I(),E(p,{key:0,color:"light",size:"large",slot:"start",onClick:t.launchSyncDialog},{default:k((()=>[y(l,{icon:t.sync},null,8,["icon"])])),_:1},8,["onClick"])):O("",!0),y(p,{color:"primary",size:"large",slot:"end",onClick:t.showTasks},{default:k((()=>[y(l,{icon:t.clipboardOutline},null,8,["icon"]),e[16]||(e[16]=_(" Tasks "))])),_:1},8,["onClick"]),y(p,{color:"primary",size:"large",slot:"end",onClick:t.showOptions},{default:k((()=>[y(l,{icon:t.folderOutline},null,8,["icon"]),e[17]||(e[17]=_(" Printouts/Other "))])),_:1},8,["onClick"]),y(p,{color:"primary",size:"large",slot:"end",onClick:t.changeApp},{default:k((()=>[y(l,{icon:t.appsOutline},null,8,["icon"]),e[18]||(e[18]=_(" Applications "))])),_:1},8,["onClick"]),y(p,{onClick:t.onCancel,color:"success",size:"large",slot:"end"},{default:k((()=>[y(l,{icon:t.logOutOutline},null,8,["icon"]),e[19]||(e[19]=_(" Finish "))])),_:1},8,["onClick"])])),_:1})])),_:1})):O("",!0)],64)}],["__scopeId","data-v-ea02e0c2"]]))}}}));
