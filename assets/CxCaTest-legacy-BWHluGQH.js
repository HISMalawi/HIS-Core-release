System.register(["./index-legacy-DSKrJPb4.js","./HisStandardForm-legacy-CmEkJw1V.js","./useEncounter-legacy-cWgDAB8I.js","./commons-legacy-BB-uL7vP.js","./isEmpty-legacy-B4nQFqOP.js","./encounter_guidelines-legacy-Cub79fhD.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,i,n,l,s,o,u,r,d,v,c,m,b,p,C,h,g,T,_,f;return{setters:[e=>{a=e.bT,i=e.d,n=e.r,l=e.aw,s=e.bC,o=e.ai,u=e.aj,r=e.aX,d=e.c0,v=e.b$,c=e.a,m=e.c,b=e.u,p=e.t,C=e._,h=e.bz},e=>{g=e.H},e=>{T=e.u},e=>{_=e.y,f=e.r},null,null,null],execute:function(){class t extends a{hivStatus;artStatus;arvNumber;arvStartDate;constructor(e,t){super(e,181,t),this.hivStatus="",this.artStatus="",this.arvNumber="",this.arvStartDate=""}getHivStatus(){return this.hivStatus}getArtStatus(){return this.artStatus}getArvNumber(){return this.arvNumber}getArvStartDate(){return this.arvStartDate}isHivPositive(){return!!this.hivStatus.match(/positive/i)}async loadArtStatus(){const e=await a.getJson(`programs/12/patients/${this.patientID}/art_hiv_status`);e&&(this.hivStatus=e.hiv_status||this.hivStatus,this.artStatus=e.art_status||"",this.arvNumber=e.arv_number||"",this.arvStartDate=e.arv_start_date||"")}}e("default",i({__name:"CxCaTest",setup(e){let a;const i=n([]),x=n(""),S=n(""),V=n([]),y=n([]);let E;const P=l((()=>!(/positive/i.test(S.value)||y.value.some((e=>/hiv/i.test(e.program.name)))))),N=l((()=>!/Chemotherapy|Hysterectomy|Palliative Care/.test(x.value))),{patientDashboardUrl:A,goToNextTask:D}=T((async(e,n,l)=>{E=l,a=new t(n,e),x.value=await a.getFirstValueCoded("Treatment"),S.value=await a.getFirstValueCoded("HIV status");const c=new s(n);y.value=await c.getPrograms(),await async function(){const e=await a.getFirstValueCoded("Offer CxCa");e&&"Yes"===e||a.buildValueCoded("Ever had CxCa","No").then((e=>i.value.push(e)))}(),V.value=function(){const e=String(E.getBirthdate());return[{id:"reason_for_visit",helpText:"Reason for visit",type:o.TT_SELECT,validation:e=>u.required(e),options:()=>[{label:"Initial screening",value:"Initial screening"},{label:"Postponed treatmment",value:"Postponed treatment"},{label:"One year subsequent check-up after treatment",value:"One year subsequent check-up after treatment"},{label:"Subsequent screening",value:"Subsequent screening"},{label:"Problem visit after treatment",value:"Problem visit after treatment"},{label:"Referral",value:"Referral"}],computedValue:e=>({obs:a.buildValueCoded("Reason for visit",e.value)})},{id:"hiv_status",helpText:"HIV status",type:o.TT_SELECT,condition:()=>P.value,validation:e=>u.required(e),options:()=>[{label:"Positive on ART",value:"Positive on ART"},{label:"Positive Not on ART",value:"Positive Not on ART"},{label:"Negative",value:"Negative"},{label:"Never tested",value:"Never tested"},{label:"Prefers Not to disclose",value:"Undisclosed"}],computedValue:e=>({obs:a.buildValueCoded("HIV status",e.value)})},...r({id:"hiv_test_date",helpText:"HIV test result date",required:!0,condition:e=>/Negative|Positive/i.test(e.hiv_status.value),minDate:()=>e,maxDate:()=>a.getDate(),estimation:{allowUnknown:!0,estimationFieldType:d.MONTH_ESTIMATE_FIELD},computeValue:(e,t)=>({date:e,tag:"cxca screening",isEstimate:t,obs:a.buildValueDate("HIV test date",e,t)})}),{id:"ever_had_cxca",helpText:"Ever had CxCa screening",type:o.TT_SELECT,condition:e=>"Initial screening"!==e.reason_for_visit.value&&!x.value,options:()=>_(),validation:e=>u.required(e),computedValue:e=>({obs:a.buildValueCoded("Ever had CxCa",e.value)})},{id:"results_available",helpText:"Results available?",type:o.TT_SELECT,validation:e=>u.required(e),condition:e=>"Initial screening"!==e.reason_for_visit.value&&"No"!==e.ever_had_cxca.value,options:()=>_(),computedValue:e=>({obs:a.buildValueCoded("CxCa test results",e.value)})},{id:"location",helpText:"CxCa screening location",type:o.TT_SELECT,validation:e=>u.required(e),options:(e,t="")=>v(t),config:{showKeyboard:!0,isFilterDataViaApi:!0},condition:e=>I(e),computedValue:e=>({obs:a.buildValueText("Previous CxCa location",e.value)})},...r({id:"cxca_date",helpText:"Previous CxCa test",required:!0,minDate:()=>e,maxDate:()=>a.getDate(),estimation:{allowUnknown:!1},condition:e=>I(e),computeValue:(e,t)=>({date:e,tag:"cxca screening",isEstimate:t,obs:a.buildValueDate("cxca test date",e)})}),{id:"previous_screening_method",helpText:"Previous screening method",type:o.TT_SELECT,validation:e=>u.required(e),condition:e=>I(e),options:()=>[{label:"VIA",value:"VIA"},{label:"PAP Smear",value:"PAP Smear"},{label:"HPV DNA",value:"HPV DNA"},{label:"Speculum Exam",value:"Speculum Exam"}],computedValue:e=>({obs:a.buildValueCoded("Previous CxCa screening method",e.value)})},{id:"offer_CxCa",helpText:"Offer CxCa screening today",type:o.TT_SELECT,condition:()=>N.value,validation:e=>u.required(e),options:()=>_(),computedValue:e=>({obs:a.buildValueCoded("Offer CxCa",e.value)})},{id:"screening_method",helpText:"Screening method being offered",type:o.TT_SELECT,validation:e=>u.required(e),condition:e=>"Yes"===e.offer_CxCa.value,options:()=>[{label:"VIA",value:"VIA"},{label:"PAP Smear",value:"PAP Smear"},{label:"HPV DNA",value:"HPV DNA"},{label:"Speculum Exam",value:"Speculum Exam"}],computedValue:e=>({obs:a.buildValueCoded("CxCa screening method",e.value)})},{id:"offer_family_planning",helpText:"Offer Family Planning ?",type:o.TT_SELECT,condition:e=>"No"!==e.offer_CxCa.value,validation:e=>u.required(e),options:()=>_(),computedValue:e=>({obs:a.buildValueCoded("Family planning",e.label)})},{id:"reason_for_no_cxca",helpText:"Reason for NOT offering CxCa screening",type:o.TT_SELECT,validation:e=>u.required(e),condition:e=>"No"===e.offer_CxCa.value,options:()=>h.getConceptsByCategory("reason_for_no_cxca").map((e=>({label:e.name,value:e.name,other:{c:e}}))),computedValue:e=>({obs:a.buildValueCoded("Reason for NOT offering CxCa",e.value)})}]}()}));async function w(e,t){if(!(await a.createEncounter()))return p("Unable to create encounter");const n=await f(t);if(!(await a.saveObservationList([...n,...i.value])))return p("Unable to save patient observations");C("Observations and encounter created!"),D()}function I(e){const t="Yes"===e.ever_had_cxca.value,a="Yes"===e.results_available.value;return t&&a}return(e,t)=>(c(),m(g,{fields:V.value,onFinishAction:w,skipSummary:!1,cancelDestinationPath:b(A)},null,8,["fields","cancelDestinationPath"]))}}))}}}));
