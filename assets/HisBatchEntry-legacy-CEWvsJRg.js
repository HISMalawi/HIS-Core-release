System.register(["./index-legacy-2OuOZQ1w.js","./FieldMixin.vue_vue_type_script_lang-legacy-dDuAoURA.js","./BaseTextInput-legacy-sf8us9B2.js"],(function(e,t){"use strict";var l,a,i,s,u,n,r,d,o,c,h,g,p,f,y,m,b,_,D,v,k,x,T,E,S,w,z,C,N,V,I,B,$,P,M,A;return{setters:[e=>{l=e.d,a=e.S,i=e.i,s=e.ac,u=e.ad,n=e.b6,r=e.a7,d=e.ag,o=e.ah,c=e.ai,h=e.c1,g=e.dr,p=e.a_,f=e.dB,y=e.ao,m=e.B,b=e.H,_=e.an,D=e.aF,v=e.z,k=e.cw,x=e.di,T=e.am,E=e.ar,S=e.a,w=e.b,z=e.w,C=e.e,N=e.h,V=e.a9,I=e.aa,B=e.j,$=e.t,P=e.a6},e=>{M=e._},e=>{A=e.default}],execute:function(){var t=document.createElement("style");t.textContent="ion-label[data-v-e9c2b14d]{font-weight:700}.border-right[data-v-e9c2b14d]{border-right:solid 1px #ccc}.scroll-list[data-v-e9c2b14d]{height:70vh;overflow:auto}.input_display[data-v-e9c2b14d]{font-size:1.3em}\n/*$vite$:1*/",document.head.appendChild(t);const F=l({components:{HisTextInput:A,ViewPort:h,IonInput:c,IonLabel:o,IonList:d,IonItem:r,IonGrid:n,IonCol:u,IonRow:s,IonButton:i},mixins:[M],data:()=>({drugs:[],allDrugsByName:[],selectedDrug:null,entryDate:a.getSessionDate()}),mounted(){this.init()},async activated(){this.init()},methods:{fmtNumber:e=>x(e),fmtDate:e=>k(e),async init(){this.$emit("onFieldActivated",this),await this.setDefaultValue()},async setDefaultValue(){const e=await this.options();this.drugs=this.drugs.filter((t=>e.map((e=>e.label)).includes(t.label))),e.forEach((e=>{const t={tabs:null,tins:null,expiry:null,batchNumber:null},l={label:e.label,entries:[{...t},{...t},{...t}],...e.value};p.find(this.drugs,{label:e.label})||this.drugs.push(l)})),this.drugs.length>=1&&this.selectDrug(0),"function"==typeof this.config.entryDate&&(this.entryDate=this.config.entryDate(this.fdata,this.cdata))},getModalTitle(e){return`${e} (${this.drugs[this.selectedDrug].short_name})`},getDrugValue(e,t){return this.drugs[this.selectedDrug].entries[e][t]},setDrugValue(e,t,l){this.drugs[this.selectedDrug].entries[e][t]=l?l.value:""},useCustomPackSize(e){return p.isEmpty(this.packSizes)||e.standard_pack_size.label.includes("Other")},async selectPackSize(e){await D([{id:"standard_pack_size",helpText:"Select Pack Size",type:y.TT_SELECT,condition:()=>!p.isEmpty(this.packSizes),defaultValue:()=>this.getDrugValue(e,"tabs"),options:()=>[...this.packSizes.map((e=>({label:`${e}`,value:e}))),{label:"Other (specify)",value:"Other"}]},{id:"custom_pack_size",helpText:"Input quantity",type:y.TT_NUMBER,defaultValue:()=>this.getDrugValue(e,"tabs"),validation:e=>_.required(e),condition:e=>this.useCustomPackSize(e),config:{showKeyboard:!0}}],(async t=>{this.setDrugValue(e,"tabs",this.useCustomPackSize(t)?t.custom_pack_size:t.standard_pack_size),await v.dismiss()}))},enterTins(e){f({id:"tins",helpText:this.getModalTitle("Enter number of tins/pallets"),type:y.TT_NUMBER,defaultValue:()=>this.getDrugValue(e,"tins"),validation:e=>!e||e&&!e.value?null:_.validateSeries([()=>_.isNumber(e),()=>e.value<=0?["Number of tins must be greater than 1"]:null])},(t=>this.setDrugValue(e,"tins",t)))},enterBatch(e){f({id:"batch",helpText:this.getModalTitle("Enter batch number"),type:y.TT_TEXT,config:{initialkb:"qwerty"},defaultValue:()=>this.getDrugValue(e,"batchNumber")},(t=>{const l={...t},a=`${l.value}`.toUpperCase();l.label=a,l.value=a,this.setDrugValue(e,"batchNumber",l)}))},enterExpiry(e){f({id:"expiry",helpText:this.getModalTitle("Enter expiry date")+` (Delivery Date: ${b.toStandardHisDisplayFormat(this.entryDate)})`,type:y.TT_FULL_DATE,defaultValue:()=>this.getDrugValue(e,"expiry"),validation:e=>{if(e&&e.value)return m(e.value).isBefore(m(this.entryDate).add(30,"day"))?["You are not allowed to enter drugs that are expiring within the next 30 days from the delivery date"]:null}},(t=>this.setDrugValue(e,"expiry",t)))},addRow(){this.drugs[this.selectedDrug].entries.push({tabs:null,tins:null,expiry:null,batchNumber:null})},selectDrug(e){this.selectedDrug=e},validateEntry:e=>!(p.isEmpty(e.tins)||p.isEmpty(e.expiry)||p.isEmpty(e.batchNumber)||p.isEmpty(e.tabs.toString()))},computed:{packSizes(){return null===this.selectedDrug?[]:g.getPackSizes(this.drugs[this.selectedDrug].drug_inventory_id)},fullSelectedDrugName(){try{return this.drugs[this.selectedDrug].fullName}catch(e){return"N/A"}},enteredDrugs(){const e=[];return this.drugs.forEach((t=>{t.entries.filter((e=>this.validateEntry(e))).forEach((l=>{e.push({label:t.short_name,value:{...t,...l,tabs:l.tabs}})}))})),e}},watch:{clear(){this.drugs=this.drugs.map((e=>(e.entries=e.entries.map((e=>(e.tins=null,e.expiry=null,e.batchNumber=null,e))),e)))},drugs:{handler(){this.$emit("onValue",this.enteredDrugs)},immediate:!0,deep:!0}}});e("default",T(F,[["render",function(e,t,l,a,i,s){const u=E("his-text-input"),n=E("ion-item"),r=E("ion-list"),d=E("ion-col"),o=E("ion-label"),c=E("ion-input"),h=E("ion-row"),g=E("ion-button"),p=E("ion-grid"),f=E("view-port");return w(),S(f,null,{default:z((()=>[C(u,{readonly:"",value:e.fullSelectedDrugName},null,8,["value"]),C(p,{style:{background:"white"}},{default:z((()=>[C(h,null,{default:z((()=>[C(d,{size:"4",class:"border-right scroll-list"},{default:z((()=>[(w(!0),N(V,null,I(e.drugs,((t,l)=>(w(),S(r,{key:l},{default:z((()=>[C(n,{detail:"",color:l===e.selectedDrug?"secondary":"",onClick:t=>e.selectDrug(l)},{default:z((()=>[B($(`${t.short_name} (${t.code})`),1)])),_:2},1032,["color","onClick"])])),_:2},1024)))),128))])),_:1}),C(d,null,{default:z((()=>[null!==e.selectedDrug?(w(),S(p,{key:0,class:"scroll-list"},{default:z((()=>[(w(!0),N(V,null,I(e.drugs[e.selectedDrug].entries,((t,l)=>(w(),S(h,{key:l},{default:z((()=>[C(d,null,{default:z((()=>[C(n,null,{default:z((()=>[C(o,{position:"floating"},{default:z((()=>[B("Pack Size")])),_:1}),C(c,{readonly:"",placeholder:"0",value:e.fmtNumber(t.tabs),onClick:t=>e.selectPackSize(l)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024),C(d,null,{default:z((()=>[C(n,null,{default:z((()=>[C(o,{position:"floating"},{default:z((()=>[B("Tins/Pallets")])),_:1}),C(c,{readonly:"",placeholder:"0",value:e.fmtNumber(t.tins),onClick:t=>e.enterTins(l)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024),C(d,null,{default:z((()=>[C(n,null,{default:z((()=>[C(o,{position:"floating"},{default:z((()=>[B("Expiry Date")])),_:1}),C(c,{readonly:"",placeholder:"DD/MM/YYYY",value:e.fmtDate(t.expiry),onClick:t=>e.enterExpiry(l)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024),C(d,null,{default:z((()=>[C(n,null,{default:z((()=>[C(o,{position:"floating"},{default:z((()=>[B("Batch Number")])),_:1}),C(c,{readonly:"",placeholder:"e.g. 'ABC-123'",value:t.batchNumber,onClick:t=>e.enterBatch(l)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),C(h,null,{default:z((()=>[C(d,null,{default:z((()=>[C(g,{onClick:e.addRow,siz:"large"},{default:z((()=>[B("Add row")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):P("",!0)])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-e9c2b14d"]]))}}}));
