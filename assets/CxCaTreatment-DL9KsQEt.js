import{bW as N,d as q,r as c,be as m,c as I,dX as D,ao as t,an as i,aA as _,a as R,f as B,b as F,q as y,bn as H}from"./index-DrAzzURJ.js";import{H as Z}from"./HisStandardForm-BuN2ARUl.js";import{u as k}from"./useEncounter-DkJDyHxN.js";import{y as b,m as d,r as z}from"./commons-C0KTHr4m.js";import"./isEmpty-DpsHgz2w.js";import"./encounter_guidelines-wbooCIhg.js";import"./GuidelineEngine-D6V1_Znr.js";class G extends N{constructor(a,r){super(a,182,r)}async getSummary(){const a=await this.getFirstValueCoded("Screening results"),r=await this.getFirstValueCoded("Directly observed treatment option"),u=await this.getFirstValueCoded("Referral reason");return{"Screening Result":a,"Treatment Type":r,"Referral Reason":u||"N/A"}}}const M=q({__name:"CxCaTreatment",setup(f){let a,r;const u=c([]),p=c({}),g=c(""),s=c(!1),o=c(!1),C=m.getProgramID(),h=m.getLocationName(),E=m.getSessionDate(),l=I(()=>{var e;return((e=p.value)==null?void 0:e["Treatment Type"])!=="Same day treatment"}),{patientDashboardUrl:L,goToNextTask:S}=k(async(e,n)=>{r=n,a=new G(n,e),p.value=await a.getSummary(),s.value=await D.isReferralSiteEnabled(),await P(),u.value=x()});function V(e,n){const T=["Hysterectomy","Chemotherapy","Palliative Care","Treatment with antibiotic","Anti-parasitic medication","Conisation"];return n.map(v=>({...v,disabled:e&&T.includes(v.label)}))}async function P(){const e=await a.getFirstValueCoded("Referral reason");g.value=e||"N/A"}async function A(e,n){const T=await a.createEncounter(),v=await z({...n});if(await a.saveObservationList(v),!T)return y("Unable to create encounter");const O=e.patient_outcome?e.patient_outcome.value:"Continue follow-up",w=await H.getConceptID(O);if(!await m.createState(r,C,{state:w,location_id:h,date:E}))return y("Unable to update state");S()}function x(){return[{id:"screening_summary",helpText:"Screening Summary",type:t.TT_DATA_TABLE,config:{rows:()=>Object.keys(p.value).map(e=>[_.td(e),_.td(p.value[e])]),dataTableConfig:{showIndex:!1}}},{id:"type_of_referral",helpText:"Type of referral visit",type:t.TT_SELECT,validation:e=>i.required(e),condition:()=>l.value&&!s.value,options:()=>[{label:"Initial/1st visit to referral facility",value:"Initial visit"},{label:"Follow-up visit",value:"Follow-up"}],computedValue:e=>({obs:a.buildValueCoded("Referral reason",e.value)})},{id:"returning_client_referral_question",helpText:"Did the returning patient visit the referral facility ?",type:t.TT_SELECT,validation:e=>i.required(e),condition:()=>l.value&&s.value,options:()=>b(),computedValue:e=>({obs:a.buildValueCoded("Are Histological results after LLETZ available",e.label)})},{id:"possible_reasons_why",helpText:"Possible reasons why client didn't visit",type:t.TT_SELECT,validation:e=>i.required(e),condition:e=>(o.value=e.returning_client_referral_question.value==="No",e.returning_client_referral_question.value==="No"&&l.value&&s.value),options:()=>[{label:"Provider unavailable",value:"Provider NOT available"},{label:"Transport lacking",value:"Transport problems"},{label:"Other",value:"Other (Specify)"}],computedValue:e=>({obs:a.buildValueCoded("Reason for no result",e.value)})},{id:"other_reason",helpText:"Other reason",type:t.TT_TEXT,validation:e=>i.required(e),computedValue:e=>({obs:a.buildValueText("Other reason for not seeking services",e.label)}),condition:e=>e.possible_reasons_why.value==="Other (Specify)"},{id:"cervix_screening_assessment",helpText:"Cervix Screening Assessment",type:t.TT_SELECT,validation:e=>i.required(e),condition:()=>l.value&&!o.value,options:()=>[{label:"STI Infection",value:"STI Infection"},{label:"VIA Negative",value:"VIA Negative"},{label:"VIA Positive",value:"VIA Positive"},{label:"PAP Smear Normal",value:"PAP Smear Normal"},{label:"PAP Smear Abnormal",value:"PAP Smear Abnormal"},{label:"No Visible Lesion (After Speculum)",value:"No visible Lesion"},{label:"Suspected Cancer",value:"Suspected Cancer"}],computedValue:e=>({obs:a.buildValueCoded("Cervix screening assessment",e.value)})},{id:"are_figo_staging_results_available",helpText:"Are FIGO staging results available?",type:t.TT_SELECT,validation:e=>i.required(e),condition:()=>l.value&&!o.value,options:()=>b(),computedValue:e=>({obs:a.buildValueCoded("Are FIGO staging results available",e.value)})},{id:"figo_staging_results",helpText:"FIGO staging results",type:t.TT_SELECT,validation:e=>i.required(e),condition:e=>e.are_figo_staging_results_available.value==="Yes"&&l.value&&!o.value,options:()=>d(["Cervical stage 1","Cervical stage 2","Cervical stage 3","Cervical stage 4"]),computedValue:e=>({obs:a.buildValueCoded("FIGO staging of cervical cancer",e.label)})},{id:"type_of_sample_collected",helpText:"Type of sample collected",type:t.TT_SELECT,validation:e=>i.required(e),condition:()=>l.value&&!o.value,options:()=>d(["Punch Biopsy","LLETZ/LEEP Sample","Cone Biopsy Sample"]),computedValue:e=>({obs:a.buildValueCoded("Sample",e.label)})},{id:"are_histological_results_after_lletz_available",helpText:"",dynamicHelpText:e=>"Are Histology results after ".concat(e.type_of_sample_collected.value," available"),type:t.TT_SELECT,validation:e=>i.required(e),condition:()=>l.value&&!o.value,options:()=>b(),computedValue:e=>({obs:a.buildValueCoded("Are Histological results after LLETZ available",e.label)})},{id:"histology_results_after_lletz",helpText:"Histology Results After LLETZ",dynamicHelpText:e=>"Histology Results After ".concat(e.type_of_sample_collected.value),type:t.TT_SELECT,validation:e=>i.required(e),condition:e=>e.are_histological_results_after_lletz_available.value==="Yes"&&l.value&&!o.value,options:()=>d(["Normal","Chronic Cervicitis","Schistosomiasis","Tuberculosis(TB)","CIN 1","CIN 2","CIN 3","Carcinoma in Situ","Invasive cancer of cervix","Benign warts"]),computedValue:e=>({obs:a.buildValueCoded("Sample",e.label)})},{id:"complications_during_lletz_leep_biopsy",helpText:"Complications During LLETZ/LEEP Biopsy",type:t.TT_SELECT,validation:e=>i.required(e),condition:()=>l.value&&!o.value&&!s.value,options:()=>[{label:"None (N/A)",value:"None"},{label:"Excessive Bleeding or pain",value:"Excessive Bleeding or pain"}],computedValue:e=>({obs:a.buildValueCoded("Complications During LLETZ/LEEP Biopsy",e.value)})},{id:"complications_after_lletz_leep_biopsy",helpText:"Complications After LLETZ/LEEP Biopsy",type:t.TT_SELECT,validation:e=>i.required(e),condition:()=>l.value&&!o.value&&!s.value,options:()=>[{label:"None (N/A)",value:"None"},{label:"Excessive Bleeding or pain",value:"Excessive Bleeding or pain"}],computedValue:e=>({obs:a.buildValueCoded("Complications After LLETZ/LEEP Biopsy",e.value)})},{id:"recommended_care_after_lletz_histology",helpText:"Recommended Care After LLETZ Histology",type:t.TT_SELECT,validation:e=>i.required(e),condition:()=>l.value&&!o.value,options:()=>[{label:"Hysterectomy",value:"Hysterectomy"},{label:"Chemotherapy",value:"Chemotherapy"},{label:"Palliative Care",value:"Palliative Care"},{label:"LLETZ/LEEP",value:"LLETZ/LEEP"},{label:"Treatment with antibiotic",value:"Antibiotics"},{label:"Anti-parasitic medication",value:"Antiparasitic"},{label:"Conisation",value:"Conisation"},{label:"Other",value:"Other (Specify)"}],computedValue:e=>({obs:a.buildValueCoded("Treatment",e.value)})},{id:"treatment_provided",helpText:"Treatment Provided",type:t.TT_SELECT,validation:e=>i.required(e),condition:()=>!o.value,options:()=>{const e=[{label:"Hysterectomy",value:"Hysterectomy"},{label:"Chemotherapy",value:"Chemotherapy"},{label:"Thermocoagulation",value:"Thermocoagulation"},{label:"Cryotherapy",value:"Cryotherapy"},{label:"Palliative Care",value:"Palliative Care"},{label:"LLETZ/LEEP",value:"LLETZ/LEEP"},{label:"Treatment with antibiotic",value:"Antibiotics"},{label:"Anti-parasitic medication",value:"Antiparasitic"},{label:"Conisation",value:"Conisation"},{label:"Other",value:"Other (Specify)"}];return V(!l.value,e)},computedValue:e=>({obs:a.buildValueCoded("Treatment",e.value)})},{id:"none_treatment_reasons",helpText:"Reasons why treatment was refused",type:t.TT_SELECT,validation:e=>i.required(e),condition:e=>e.treatment_provided.value==="Other (Specify)",options:()=>[{label:"Patient refused treatment",value:"Patient refused"},{label:"Provider not available",value:"Provider NOT available"},{label:"other",value:"Other (Specify)"}],computedValue:e=>({obs:a.buildValueCoded("Other reason for not seeking services",e.value)})},{id:"other_reason_treatment",helpText:"Other reason",type:t.TT_TEXT,validation:e=>i.required(e),computedValue:e=>({obs:a.buildValueCoded("Other reason for not seeking services",e.value)}),condition:e=>e.none_treatment_reasons.value==="Other (Specify)"},{id:"patient_denial_outcome",helpText:"Patient outcome",type:t.TT_SELECT,condition:e=>l.value&&e.returning_client_referral_question.value==="No",validation:e=>i.required(e),options:()=>d(["Death","On going follow-up","Denied consultation"])},{id:"patient_outcome",helpText:"Patient outcome",type:t.TT_SELECT,condition:e=>l.value&&e.returning_client_referral_question.value==="Yes",validation:e=>i.required(e),options:()=>d(["On-going Palliative Care","No Dysplasia/Cancer","Death","On going follow-up","Denied consultation"])}]}return(e,n)=>(F(),R(Z,{fields:u.value,onFinishAction:A,skipSummary:!1,cancelDestinationPath:B(L)},null,8,["fields","cancelDestinationPath"]))}});export{M as default};
