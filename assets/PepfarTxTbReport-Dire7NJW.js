import{d as A,a5 as y,cr as C,r as g,t as S,aK as M,ad as N,O as B,aM as $,ah as x,cW as O,aq as D,a6 as E,v as j,w as k,ab as w,u as I,x as F}from"./index-5HNeqEZr.js";import{T as G}from"./tb_report_service-MseB3BzL.js";import{v as X}from"./TableView-8wC6VTLY.js";import{A as q}from"./v2utils-C4g-PufD.js";import"./Export-xOOutIU0.js";import"./index-D89U3den.js";const L=A({components:{IonPage:y,IonLoading:C,v2Datatable:X},setup(){const e=g([]),d=g(""),m=g(!1),l=new G;g(void 0),g(void 0);const t=(u,c)=>({ref:c,label:u,toValue:o=>o.length,tdClick:async o=>{o.refData.length&&(await D.create({component:q,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:d,patientIdentifiers:o.refData,title:"".concat(o.data.ageGroup," ").concat(o.data.gender," ").concat(o.column.label),onFinish:()=>D.getTop().then(n=>n&&D.dismiss())}})).present()}}),h=[[{label:"#",ref:"index"},{label:"Age group",ref:"ageGroup"},{label:"Gender",ref:"gender"},t("TX_CURR","tx_curr"),t("Symptom Screen (alone)","symptom_screen_alone"),t("CXR screen","cxr_screen"),t("mWRD screen","mwrd_screen"),t("New on ART/Screen Positive","sceen_pos_new"),t("New on ART/Screen Negative","sceen_neg_new"),t("Already on ART/Screen Positive","sceen_pos_prev"),t("Already on ART/Screen Negative","sceen_neg_prev"),t("TB RX_New on ART","started_tb_new"),t("TB RX_Prev on ART","started_tb_prev")]],v=async()=>p(await N("Do you want to rebuild report?")),p=async(u=!1)=>{if(!(l.startDate&&l.endDate))return B("Start date and end date required!");m.value=!0,e.value=[];try{const c=await l.getTxTbReport(u,"pepfar"),o={F:"Female",M:"Male"},n=Object.keys(c).reduce((a,s)=>{if(s==="Unknown")return a;const i=c[s];return Object.keys(i).forEach(r=>{a[r].rows.push({ageGroup:s,gender:o[r],...i[r]}),a[r].aggregate=Object.keys(i[r]).reduce((b,_)=>Array.isArray(i[r][_])?{...b,[_]:[...b[_]||[],...i[r][_]]}:b,a[r].aggregate)}),a},{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...n.F.rows,...n.M.rows,{ageGroup:"All",gender:"Male",...n.M.aggregate}];const P=Object.values(n.F.aggregate).reduce((a,s)=>a.concat(s),[]),R=await l.getMaternalStatus($.uniq(P)),T=R.FBf.concat(R.FP);["FP","FNP","FBf"].forEach(a=>{e.value.push(Object.keys(n.F.aggregate).reduce((s,i)=>({...s,[i]:n.F.aggregate[i].filter(r=>a==="FNP"?!T.includes(r):R[a].includes(r))}),{ageGroup:"All",gender:a}))}),e.value=e.value.map((a,s)=>({index:s+1,...a}))}catch(c){console.error(c),x("Unable to generate report!")}m.value=!1},f=()=>O({onFinish:(u,c,o,n)=>{d.value="Period: ".concat(o),l.startDate=u,l.endDate=c,n&&l.setOccupation(n),p()}});return S(()=>f()),{Img:M,reportData:e,isLoading:m,onRefreshReport:v,configure:f,generate:p,columns:h,period:d}}});function U(e,d,m,l,t,h){const v=w("ion-loading"),p=w("v2Datatable"),f=w("ion-page");return I(),j(f,null,{default:k(()=>[F(v,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),F(p,{title:"Tx TB Report","icon-url":e.Img("login-logos/PEPFAR.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRefreshReport,"report-prefix":"Pepfar"},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh"])]),_:1})}const Q=E(L,[["render",U]]);export{Q as default};
