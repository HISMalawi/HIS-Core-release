System.register(["./index-legacy-2OuOZQ1w.js","./HelpdeskFlyer-legacy-Cfwd7Hp3.js","./index-legacy-D_LoyUSC.js","./index-legacy-B-HMMIA1.js"],(function(e,t){"use strict";var n,a,l,o,s,i,r,c,u,d,p,g,h,y,f,w,v,b,k,m,x,S,_,C,q,M,R,U;return{setters:[e=>{n=e.d,a=e.r,l=e.u,o=e.c,s=e.o,i=e.a,r=e.b,c=e.w,u=e.e,d=e.f,p=e.I,g=e.g,h=e.h,y=e.i,f=e.j,w=e.k,v=e.l,b=e.t,k=e.m,m=e.n,x=e.A,S=e.p,_=e.q,C=e.s},e=>{q=e.H},e=>{M=e.F,R=e.D},e=>{U=e.C}],execute:function(){const t=g("div",{class:"ion-text-center ion-padding",style:{"font-weight":"bold","font-size":"2.0rem"}}," This EMR needs an update. ",-1),j=g("div",{class:"ion-text-center"}," Follow the steps below to update. ",-1),D={key:0,style:{"margin-top":"1%"},class:"ion-padding"},E={style:{"font-size":"2.5rem"},class:"ion-text-center"},P=g("h1",null,[g("b",null,"Step 1:"),f(" Click below to update EMR ")],-1),$={class:"ion-text-center"},z=g("h3",null,[g("b",null,"Step 2:"),f(" Contact Helpdesk if update is not possible "),g("b",null,"(Optional)")],-1),F={key:1,style:{"margin-top":"1%"},class:"ion-padding"},H={class:"ion-text-center"},L=g("h1",null,[g("b",null,"Step 1:"),f(" Contact the Helpdesk")],-1),A=g("p",null,null,-1),B=g("h2",null,[g("b",null,"Step 2:"),f(" Click Reload when an officer tells you to")],-1),I={style:{"margin-top":"10px"},class:"ion-text-center"};e("default",n({__name:"Upgrade",setup(e){const n=a(!1),K=l(),T=o((()=>`${K.query.version}`)),O=a("-"),V=o((()=>C("android"))),G=new x,J=a("");function N(){m.push("/"),setTimeout((()=>location.reload()),150)}async function Q(){try{if(await async function(){try{const{publicStorage:e}=await M.checkPermissions();if("granted"!==e){const{publicStorage:e}=await M.requestPermissions();if("granted"!==e)return _("Permission to access storage is required to download the app."),!1}return!0}catch(e){return console.error(e),_("Unable to download the app. Please try again later"),!1}}()){n.value=!0,M.addListener("progress",(e=>{const t=Math.round(e.contentLength/1024),n=Math.round(e.bytes/1024),a=Math.round(e.bytes/e.contentLength*100);J.value=`Downloading... ${n}KB / ${t}KB (${a}%)`}));const e=await async function(){try{return(await M.downloadFile({url:await G.getApkDownloadLink(T.value),path:`Download/emr-${T.value}.apk`,directory:R.ExternalStorage,recursive:!0,progress:!0})).path}catch(e){console.error(e),_(e.toString())}}();if(n.value=!1,!e)throw new Error("Unable to download the app");S("Download completed. Installing the app..."),await async function(e){try{await U.install({file:e})}catch(t){console.error(t),_("Unable to install the app. Please try again later")}}(e)}}catch(e){n.value=!1,console.error(e),_("Unable to update the app")}}return s((()=>async function(){O.value=await(new x).getApiVersion()}())),(e,n)=>(r(),i(d(k),null,{default:c((()=>[u(d(p),null,{default:c((()=>[t,j,V.value?(r(),h("div",D,[g("div",E,[g("div",null,[P,u(d(y),{onClick:Q,size:"large",color:"success"},{default:c((()=>[f("Update EMR")])),_:1})])]),g("div",$,[z,u(q)])])):(r(),h("div",F,[g("div",H,[L,u(q),A,B])])),g("div",I,[u(d(y),{onClick:N,size:"large"},{default:c((()=>[f("Reload")])),_:1})])])),_:1}),u(d(w),null,{default:c((()=>[u(d(v),{class:"ion-text-center"},{default:c((()=>[f(" Required version: "),g("b",null,b(T.value)+"/"+b(O.value),1)])),_:1})])),_:1})])),_:1}))}}))}}}));
