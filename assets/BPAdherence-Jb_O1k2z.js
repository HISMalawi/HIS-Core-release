import{V as z}from"./ViewPort-DXU7_cLE.js";import{d as F,i as K,j,l as R,aj as L,bb as U,f as x,ak as J,m as M,I as Y,e as q,ab as G,aa as Q,O as W,_ as X,r as d,o as s,c as w,w as n,b as o,x as a,A as e,F as g,y as _,u as C,v as k,z as P,a3 as Z,a4 as tt}from"./index-ukYYv03_.js";import{_ as et}from"./EncounterMixin.vue_vue_type_script_lang-hKvxDXOC.js";import{B,H as T}from"./htn_service-BNTiQ5mp.js";import{H as st}from"./HisKeypad-DZkFWL6y.js";import"./encounter_guidelines-DEFE9wN1.js";import"./GuidelineEngine-D6V1_Znr.js";import"./HisStandardForm-CmiKCQno.js";import"./TouchScreenForm-C0lsuVE6.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./ToolbarMediumCard-BzOm1RiU.js";import"./Transformers-BPPLlH12.js";import"./BaseKeyboard-Bzque8Wa.js";import"./KbLayouts-VRA-vjeH.js";import"./KbHandler-BuQ4TFU6.js";const nt=F({mixins:[et],components:{ViewPort:z,IonToolbar:K,IonHeader:j,IonContent:R,IonRow:L,IonInput:U,IonButton:x,IonCol:J,IonFooter:M,IonPage:Y,IonCheckbox:q},watch:{ready:{async handler(t){t&&(this.HTN=new B(this.patientID,this.providerID),this.drugs=this.HTN.getDrugs(),await this.getCurrentDrugs())},immediate:!0}},data:()=>({HTN:{},drugs:null}),methods:{onFinish(){this.selectNextAction()},goToPrescription(){this.$router.push("/art/encounters/bp_prescription/".concat(this.patientID))},gotoTreatment(){const t=this.selectedDrugs.map(m=>G.find(B.htnDrugReferences(),{drug_id:m.drugID})),r={};r[this.patientID]=t,sessionStorage.setItem(T.Prescription,JSON.stringify(r)),this.$router.push("/art/encounters/prescriptions/".concat(this.patientID))},async selectNextAction(){const t=await Q("Action confirmation","Please specify how to proceed with patient",["Continue with current BP Drugs","Continue without BP Drugs","Change BP drugs"],[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(t.selection&&t.action!="Cancel")switch(t.selection){case"Continue without BP Drugs":return sessionStorage.removeItem(T.Prescription),this.nextTask();case"Continue with current BP Drugs":return this.gotoTreatment();case"Change BP drugs":this.goToPrescription()}},async getCurrentDrugs(){const t=await this.HTN.getCurrentDrugs(),r=await this.HTN.getLastDrugs();t.drugs.forEach(m=>{for(const i in this.drugs)this.drugs[i].drugs.forEach((D,f)=>{m.drug_id===D.drugID&&(this.drugs[i].drugs[f].current=!0,this.drugs[i].drugs[f].selected=!0,this.drugs[i].selected=m.drug_id);const c=this.drugs[i].drugs[f].drugName;Object.prototype.hasOwnProperty.call(r,c)&&(this.drugs[i].drugs[f].expectedRemaining=r[c].remaining,this.drugs[i].drugs[f].dispensed=r[c].value_numeric)})})},async launchKeyPad(t,r){(await W.create({component:st,backdropDismiss:!1,cssClass:"keypad-modal",componentProps:{strictNumbers:!0,onKeyPress:async i=>{const D=await this.HTN.getAdherence(this.drugs[t].drugs[r].drugID,i);this.drugs[t].drugs[r].adherence=D.adherence,this.drugs[t].drugs[r].remaining=i}}})).present()}},computed:{selectedDrugs(){return Object.values(this.drugs).map(t=>t.drugs).reduce((t,r)=>t.concat(r),[]).filter(t=>t.dispensed)}}}),h=t=>(Z("data-v-2e3ec445"),t=t(),tt(),t),ot=h(()=>e("label",{class:"his-title"}," BP Drug management ",-1)),rt={key:0,class:"view-port-content"},at={id:"main-table",style:{width:"100%"}},it=h(()=>e("th",null,"Â ",-1)),lt=h(()=>e("td",{class:"td-current td-title"},[e("span",null,"Current")],-1)),dt=h(()=>e("td",{class:"td-remaining td-title"},[e("span",null,"Pills remaining")],-1)),ut=h(()=>e("p",null,null,-1)),ct={id:"table-notes",style:{width:"100%"}},pt=h(()=>e("caption",{style:{"font-size":"1.4em"}}," Adherence summary ",-1)),ht=h(()=>e("p",null,null,-1)),gt=h(()=>e("tr",null,[e("th",{style:{width:"25%"}},[e("span",null,"Drug")]),e("th",{style:{width:"25%"}},[e("span",null,"Pills dispensed during last visit")]),e("th",{style:{width:"25%"}},[e("span",null,"Expected pills remaining")]),e("th",{style:{width:"25%"}},[e("span",null,"Adherence for drug")])],-1)),_t={class:"date-td today-td"},mt={class:"date-td today-td"},ft={class:"date-td today-td"},yt={class:"date-td today-td"};function wt(t,r,m,i,D,f){const c=d("ion-col"),b=d("ion-row"),N=d("ion-toolbar"),S=d("ion-header"),H=d("ion-checkbox"),$=d("ion-input"),A=d("view-port"),V=d("ion-content"),I=d("ion-button"),E=d("ion-footer"),O=d("ion-page");return s(),w(O,null,{default:n(()=>[o(S,null,{default:n(()=>[o(N,null,{default:n(()=>[o(b,null,{default:n(()=>[o(c,null,{default:n(()=>[ot]),_:1})]),_:1})]),_:1})]),_:1}),o(V,null,{default:n(()=>[o(A,null,{default:n(()=>[t.drugs?(s(),a("div",rt,[e("table",at,[e("tr",null,[it,(s(!0),a(g,null,_(t.drugs,(l,u)=>(s(),a("th",{key:u},[C(k(u)+" ",1),o(b,null,{default:n(()=>[(s(!0),a(g,null,_(l.drugs,(p,y)=>(s(),w(c,{class:"col-borders",key:y},{default:n(()=>[C(k(p.amount||"0mg"),1)]),_:2},1024))),128))]),_:2},1024)]))),128))]),e("tr",null,[lt,(s(!0),a(g,null,_(t.drugs,(l,u)=>(s(),a("td",{class:"td-current td-value",key:u},[o(b,null,{default:n(()=>[(s(!0),a(g,null,_(l.drugs,(p,y)=>(s(),w(c,{key:y},{default:n(()=>[p.current?(s(),w(H,{key:0,checked:p.current,disabled:""},null,8,["checked"])):P("",!0)]),_:2},1024))),128))]),_:2},1024)]))),128))]),e("tr",null,[dt,(s(!0),a(g,null,_(t.drugs,(l,u)=>(s(),a("td",{key:u,class:"td-current td-value"},[o(b,null,{default:n(()=>[(s(!0),a(g,null,_(l.drugs,(p,y)=>(s(),w(c,{key:y},{default:n(()=>[p.dispensed?(s(),w($,{key:0,type:"number",modelValue:p.remaining,"onUpdate:modelValue":v=>p.remaining=v,onClick:v=>t.launchKeyPad(u,y)},null,8,["modelValue","onUpdate:modelValue","onClick"])):P("",!0)]),_:2},1024))),128))]),_:2},1024)]))),128))])]),ut,e("table",ct,[pt,ht,gt,(s(!0),a(g,null,_(t.selectedDrugs,(l,u)=>(s(),a("tr",{key:u,class:"dispensation-row"},[e("td",_t,k(l.drugName),1),e("td",mt,k(l.dispensed),1),e("td",ft,k(l.expectedRemaining),1),e("td",yt,k(l.adherence?"".concat(l.adherence," %"):"?"),1)]))),128))])])):P("",!0)]),_:1})]),_:1}),o(E,null,{default:n(()=>[o(N,{color:"dark"},{default:n(()=>[o(I,{size:"large",color:"danger",slot:"start",onClick:t.gotoPatientDashboard},{default:n(()=>[C(" cancel ")]),_:1},8,["onClick"]),o(I,{size:"large",color:"primary",slot:"end",onClick:t.goToPrescription},{default:n(()=>[C(" Change drugs ")]),_:1},8,["onClick"]),o(I,{size:"large",color:"success",slot:"end",onClick:t.onFinish},{default:n(()=>[C(" Continue ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const Et=X(nt,[["render",wt],["__scopeId","data-v-2e3ec445"]]);export{Et as default};
