System.register(["./index-legacy-DaDUPm0b.js","./ReportDateSelectionPrompt-legacy-DRhaZpji.js","./disaggregated_service-legacy-CTeWUM6s.js","./TableView-legacy-CmQ6PVWx.js","./ArtDrilldown-legacy-CEmfyzcu.js","./regimen_report_service-legacy-D1pbWAX8.js","./dynamic-import-helper-legacy-DYK5bIOV.js","./MultiFieldDateHelper-legacy-DbDPqams.js","./KbLayouts-legacy-BKvPSxzZ.js","./HisKbConfigurations-legacy-vrLd9Pgz.js","./PopupKeyboard-legacy-BLGVkQrT.js","./SIngleTouchField-legacy-03Ka2vYO.js","./TouchScreenForm-legacy-kTjvZFWF.js","./ToolbarMediumCard-legacy-TC6u67eT.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-DVkjms5h.js","./HisKeypad-legacy-Chnrvz-z.js","./BaseKeyboard-legacy-CcZAcjlL.js","./KbHandler-legacy-De8o5nTq.js","./fuse-legacy-CQoBB3MK.js","./Export-legacy-DVLPpzkc.js","./HisKeyboard-legacy-QKalX9Cj.js","./person_service-legacy-BsR5wfwR.js"],(function(e,a){"use strict";var r,t,l,n,o,g,s,i,u,c,d,p,y,b,f,m,F,j,v,A,D,w,P,x,h;return{setters:[e=>{r=e.d,t=e.I,l=e.c2,n=e.K,o=e.N,g=e.a9,s=e.n,i=e.t,u=e.cx,c=e.q,d=e.c5,p=e.O,y=e.ab,b=e.c3,f=e._,m=e.r,F=e.o,j=e.c,v=e.w,A=e.b},e=>{D=e.D},e=>{w=e.D},e=>{P=e.v},e=>{x=e.A},e=>{h=e.R},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){const a=r({components:{IonPage:t,IonLoading:l,v2Datatable:P},setup(){const e=n([]),a=n(""),r=n(""),t=n(!1),l=new w,f=n([]),m=async e=>{(await p.create({component:x,backdropDismiss:!1,cssClass:"large-modal",componentProps:{...e,subtitle:a.value,onFinish:()=>p.getTop().then((e=>e&&p.dismiss()))}})).present()},F=(e,a)=>({ref:a,label:e,defaultValue:"0",toValue:e=>e.length,tdClick:async e=>{e.refData.length&&m({patientIdentifiers:e.refData,title:`${e.data.age_group} ${e.data.gender} ${e.column.label}`})}}),j=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},F("TX curr (receiving ART)","tx_curr"),...h.reduce(((e,a)=>[...e,F(a,a)]),[]),F("Unknown","N/A"),F("Total (regimen)","regimen_total")]],v=[...h,"N/A"].reduce(((e,a)=>({...e,[a]:[]})),{}),A=async(a=!1)=>{if(!l.startDate||!l.endDate)return i("Start date and end date required!");t.value=!0;const n=["Pregnant","Breastfeeding"],o={F:{label:"Female",rows:[],aggregate:{},excludedAgeGroups:n},M:{label:"Male",rows:[],aggregate:{},excludedAgeGroups:n},FP:{label:"Pregnant",rows:[],aggregate:{},gender:"F",ageGroup:"All",genderDisplay:"FP",excludedAgeGroups:[...u,"Breastfeeding"]},FBF:{label:"Breastfeeding",rows:[],aggregate:{},gender:"F",ageGroup:"All",genderDisplay:"FBF",excludedAgeGroups:[...u,"Pregnant"]}},g=(a=!1)=>{const t=Object.keys(o.FP.aggregate).reduce(((e,a)=>({...e,[a]:[...o.FP.aggregate[a]||[],...o.FBF.aggregate[a]||[]]})),{}),l=Object.keys(o.F.aggregate).reduce(((e,a)=>({...e,[a]:e[a].filter((e=>!Array.isArray(t[a])||!t[a].includes(e)))})),o.F.aggregate);e.value=[...o.F.rows,...o.M.rows,{age_group:"All",gender:"Male",...o.M.aggregate},...o.FP.rows,{age_group:"All",gender:"FNP",...l},...o.FBF.rows];const n=y.uniq([...o.M.aggregate.tx_curr||[],...o.F.aggregate.tx_curr||[]]),g={text:`Total alive and on ART: <b>${n.length}</b>`,icon:b,color:"primary",action:()=>m({patientIdentifiers:n,title:`Total alive and on ART: ${n.length}`})};f.value=a?[g]:[g,{text:r.value,icon:d,color:"dark"}]};try{if(l.setRebuildOutcome(a),!(await l.init()))return i("Unable to initialise report");for(const e of[...u,...n]){r.value=`Processing <b>${e}</b>`,l.setAgeGroup(e);const a=await l.getCohort();l.setRebuildOutcome(!1);for(const r of Object.keys(o)){if((o[r].excludedAgeGroups||[]).includes(e))continue;l.setGender(r);const t=await l.getRegimenDistribution(),n={age_group:o[r]?.ageGroup||e,gender:o[r]?.genderDisplay||o[r].label,...a[e]?a[e][o[r]?.gender||r]:{},...v,...t,regimen_total:Object.values(t).flat(1)};o[r].rows.push(n),o[r].aggregate=Object.keys(n).reduce(((e,a)=>Array.isArray(n[a])?{...e,[a]:[...e[a]||[],...n[a]]}:e),o[r].aggregate),g(!1)}}g(!0),e.value=e.value.map(((e,a)=>({index:a+1,...e})))}catch(s){const e="Unable to generate report!";c(e),f.value=[{text:e,color:"danger",icon:d,action:function(){f.value=[{text:`Exception occured: <b>${s}</b>`,color:"danger",icon:d}]}}]}t.value=!1,r.value=""},P=(e=!1)=>D({onFinish:(r,t,n,o)=>{a.value=n,l.startDate=r,l.endDate=t,o&&l.setOccupation(o),l.setQuarter("pepfar"),A(e)}});return o((()=>P(!0))),{Img:g,onRegenerate:async()=>A(await s("Do you want to rebuild report?")),headerBadge:f,reportData:e,isLoading:t,configure:P,generate:A,columns:j,period:a}}});e("default",f(a,[["render",function(e,a,r,t,l,n){const o=m("ion-loading"),g=m("v2Datatable"),s=m("ion-page");return F(),j(s,null,{default:v((()=>[A(o,{"is-open":e.isLoading,message:"Please wait.."},null,8,["is-open"]),A(g,{"icon-url":e.Img("login-logos/PEPFAR.png"),title:"PEPFAR Disaggregated Report","report-prefix":"Pepfar",subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRegenerate,headerBadge:e.headerBadge},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh","headerBadge"])])),_:1})}]]))}}}));
