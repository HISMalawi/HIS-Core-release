import{d as F,I as P,ch as R,K as c,N as C,ac as $,n as w,t as B,bK as I,cu as T,q as y,cw as h,O as m,_ as k,r as v,o as M,c as N,w as x,b as _}from"./index-BbPYANJn.js";import{D as E}from"./ReportDateSelectionPrompt-ky060BJP.js";import{D as S}from"./disaggregated_service-DaBRkeHI.js";import{v as G}from"./TableView-ra7g-iYd.js";import{A as L}from"./ArtDrilldown-CdKUSW1X.js";import{R as U}from"./regimen_report_service-n94VSR0F.js";import"./fuse-YdZE3OCN.js";import"./Export-BN6ZqWE3.js";import"./HisKeyboard-BC4PLlfH.js";const V=F({components:{IonPage:P,IonLoading:R,v2Datatable:G},setup(){const a=c([]),g=c(""),D=c(""),d=c(!1),r=new S,s=c([]),u=async o=>{(await m.create({component:L,backdropDismiss:!1,cssClass:"large-modal",componentProps:{...o,subtitle:g.value,onFinish:()=>m.getTop().then(t=>t&&m.dismiss())}})).present()},i=(o,t)=>({ref:t,label:o,defaultValue:"0",toValue:e=>e.length,tdClick:async e=>{e.refData.length&&u({patientIdentifiers:e.refData,title:"".concat(e.data.age_group," ").concat(e.data.gender," ").concat(e.column.label)})}}),p=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},i("TX curr (receiving ART)","tx_curr"),...U.map(o=>i(o,o)),i("Unknown","N/A"),i("Total (regimen)","regimen_total")]],A=async()=>f(await w("Do you want to rebuild report?")),f=async(o=!1)=>{if(!(r.startDate&&r.endDate))return B("Start date and end date required!");d.value=!0;try{s.value=[],a.value=[];const t=(await r.getDisaggReport(o,"pepfar")).reduce((e,n)=>{if(/unknown/i.test(n.age_group))return e;const l="".concat(n.gender).toUpperCase();return e[l]&&e[l].push({...n,gender:I(n.gender)}),["M","F"].includes(l)&&!/all/i.test(n.age_group)&&(e.totalAlive=[...e.totalAlive,...n.tx_curr]),e},{M:[],F:[],FP:[],FBF:[],FNP:[],totalAlive:[]});a.value=[...t.F,...t.M,...t.FP,...t.FNP,...t.FBF].map((e,n)=>({index:n+1,...e})),s.value=[{text:"Total alive and on ART: <b>".concat(t.totalAlive.length,"</b>"),icon:T,color:"primary",action:()=>u({patientIdentifiers:t.totalAlive,title:"Total alive and on ART: ".concat(t.totalAlive.length)})}]}catch(t){const e="Unable to generate report!";y(e),s.value=[{text:e,color:"danger",icon:h,action:function(){s.value=[{text:"Exception occured: <b>".concat(t,"</b>"),color:"danger",icon:h}]}}]}d.value=!1,D.value=""},b=(o=!1)=>E({onFinish:(t,e,n,l)=>{g.value=n,r.startDate=t,r.endDate=e,l&&r.setOccupation(l),r.setQuarter("pepfar"),f(o)}});return C(()=>b(!0)),{Img:$,onRegenerate:A,headerBadge:s,reportData:a,isLoading:d,configure:b,generate:f,columns:p,period:g}}});function q(a,g,D,d,r,s){const u=v("ion-loading"),i=v("v2Datatable"),p=v("ion-page");return M(),N(p,null,{default:x(()=>[_(u,{"is-open":a.isLoading,message:"Please wait.."},null,8,["is-open"]),_(i,{"icon-url":a.Img("login-logos/PEPFAR.png"),title:"PEPFAR Disaggregated Report","report-prefix":"Pepfar",subtitle:a.period,columns:a.columns,columnData:a.reportData,rowsPerPage:100,onConfigure:a.configure,onRefresh:a.onRegenerate,headerBadge:a.headerBadge},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh","headerBadge"])]),_:1})}const Y=k(V,[["render",q]]);export{Y as default};
