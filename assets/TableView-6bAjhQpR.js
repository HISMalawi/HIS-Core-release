import{d as te,i as ne,h as ae,av as re,D as se,k as le,j as ie,f as ue,m as ce,l as de,cd as fe,au as pe,ak as he,bx as ye,by as ke,J as me,K as $,M as E,ab as ve,ch as ge,ci as Ce,cj as be,ck as Pe,cl as we,cm as Se,cn as Ie,co as Ve,b3 as _e,S as K,an as De,cp as $e,cq as Te,ae as X,bz as ze,cr as Fe,_ as Re,r as f,o as n,x as v,b as r,w as t,c as h,z as y,u as g,v as V,A as T,B as z,y as N,ay as Be}from"./index-CtD5m6Vn.js";import{a as Ee,t as Ke}from"./Export-BO963yok.js";const Ne=te({components:{IonToolbar:ne,IonItem:ae,IonIcon:re,IonLabel:se,IonTitle:le,IonHeader:ie,IonButton:ue,IonFooter:ce,IonContent:de,IonButtons:fe,IonChip:pe,HisKeyboard:he,IonThumbnail:ye,IonImg:ke},props:{title:{type:String,default:"Report"},headerBadge:{type:Object},iconUrl:{type:String},subtitle:{type:String},columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},enablePagination:{type:Boolean,default:!0},rowsPerPage:{type:Number,default:10},onFinish:{type:Function},onRefresh:{type:Function},onConfigure:{type:Function},csvQuarter:{type:String},reportPrefix:{type:String,default:""}},setup(e){const c=me(),_=$([]),k=$(0),P=$(""),D=$(""),w=$("desc"),A=$(!1),U=E(()=>{let o=_.value;return w.value&&D.value&&(o=$e(_.value)[w.value](a=>a.data[D.value])),P.value?new Te(o,{threshold:.3,keys:["searchIndex"],useExtendedSearch:!0}).search(P.value,{limit:e.rowsPerPage}).map(d=>d.item):o}),m=E(()=>X.chunk(U.value,e.rowsPerPage).length),p=E(()=>k.value+2<=m.value),F=E(()=>k.value>0),H=E(()=>X.chunk(U.value,e.rowsPerPage)[k.value]),L=o=>{D.value=o,w.value=w.value==="asc"?"desc":"asc"},R=()=>Ve(o=>{const a=parseInt(o);parseInt(o)<=m.value&&(k.value=a)},{title:"Select page"}),Q=()=>k.value=0,Y=()=>k.value=m.value-1||0,q=()=>k.value+=1,W=()=>k.value-=1,G=()=>{typeof e.onFinish=="function"?e.onFinish():c.push("/")},s=o=>{var a,d;try{typeof((a=o.column)==null?void 0:a.tdClick)=="function"&&((d=o.column)==null||d.tdClick(o));return}catch(u){console.error(u)}},C=()=>e.columns.reduce((o,a)=>o.concat(a),[]).filter(o=>o.value||o.ref),l=o=>{var j,Z,x;const a=C().filter(i=>[i.canExport?i==null?void 0:i.canExport[o]:!0,typeof i.exportable=="boolean"?i.exportable:!0].every(Boolean)),d=a.map(i=>i.exportedValue&&i.exportedValue.column?i.exportedValue.column(i):i.secondaryLabel||i.label),u=a.map(i=>i.ref),b=_.value.reduce((i,ee)=>{const oe=ee.row.filter(({column:I})=>u.includes(I.ref)).map(I=>I.column.exportedValue&&I.column.exportedValue.dataValue?I.column.exportedValue.dataValue(I):I.value);return[...i,oe]},[]),O="".concat(e.reportPrefix," ").concat((j=K.getLocationName())!=null?j:""," ").concat(ze(e.title).replace(e.reportPrefix,"")," ").concat(Fe((x=(Z=e.csvQuarter)!=null?Z:e.subtitle)!=null?x:""));return{headers:d,rows:b,filename:O}},B=()=>{const{headers:o,rows:a,filename:d}=l("pdf");Ee([o],a,d,!0)},S=()=>{const{headers:o,rows:a,filename:d}=l("csv");Ke([o],[...a,["Date Created: ".concat(_e().format("DD/MMM/YYYY HH:MM:ss"))],["Quarter: ".concat(e.csvQuarter||e.subtitle)],["HIS-Core Version: ".concat(K.getCoreVersion())],["API Version: ".concat(K.getApiVersion())],["Site UUID: ".concat(K.getSiteUUID())],["Generated by: ".concat(K.getUserName())]],d)},M=o=>{P.value=De(o,P.value),k.value=0},J=o=>{o.forEach(a=>{const d=C().map(u=>{let b="";const O=a[u.ref];try{X.isEmpty(a)?b="...":typeof u.toValue=="function"?b="".concat(u.toValue(O)):typeof u.value=="function"?b=u.value(a):b=a[u.ref]||""}catch(j){b=(u==null?void 0:u.defaultValue)||"_ERROR_",console.error(j)}return{column:u,refData:O,value:b,data:a}});_.value.push({row:d,data:a,searchIndex:[...d,d.map(u=>u.value).join(" ")]})})};return ve(()=>e.columnData,o=>{if(_.value=[],!Array.isArray(o)||!o.length){k.value=0,P.value="",D.value="",J(Array.from({length:e.rowsPerPage}).map(()=>({})));return}J(o)},{immediate:!0,deep:!0}),{first:Q,last:Y,next:q,prev:W,selectPage:R,sortColumn:L,onClickTablecell:s,toPDF:B,toCSV:S,finish:G,filterTable:M,sync:ge,search:Ce,close:be,arrowUp:Pe,arrowDown:we,funnelOutline:Se,page:H,canNext:p,searchTerm:P,totalPages:m,sortOrder:w,canPrev:F,currentPage:k,columnSorted:D,QWERTY:Ie,showSearchKeyboard:A}}}),Ue={key:0},He={class:"his-sm-text"},Me={class:"art-report-theme"},Oe={class:"stick-report-header"},je=["colspan","rowspan","onClick"],Ae=["onClick"],Le={class:"his-sm-text"};function Qe(e,c,_,k,P,D){const w=f("ion-img"),A=f("ion-thumbnail"),U=f("ion-title"),m=f("ion-icon"),p=f("ion-button"),F=f("ion-label"),H=f("ion-chip"),L=f("ion-buttons"),R=f("ion-toolbar"),Q=f("ion-header"),Y=f("ion-item"),q=f("ion-content"),W=f("his-keyboard"),G=f("ion-footer");return n(),v(z,null,[r(Q,null,{default:t(()=>[r(R,null,{default:t(()=>[e.iconUrl?(n(),h(A,{key:0,slot:"start"},{default:t(()=>[r(w,{src:e.iconUrl},null,8,["src"])]),_:1})):y("",!0),r(U,{slot:"start",class:"his-md-text"},{default:t(()=>[g(V(e.title)+" ",1),e.subtitle?(n(),v("br",Ue)):y("",!0),T("span",He,V(e.subtitle),1)]),_:1}),r(L,{slot:"end"},{default:t(()=>[typeof e.onConfigure=="function"?(n(),h(p,{key:0,onClick:c[0]||(c[0]=()=>e.onConfigure?e.onConfigure():null)},{default:t(()=>[r(m,{size:"large",icon:e.funnelOutline},null,8,["icon"])]),_:1})):y("",!0),e.searchTerm?(n(),h(H,{key:1,onClick:c[1]||(c[1]=()=>{e.searchTerm="",e.showSearchKeyboard=!1}),class:"his-md-text",color:"primary"},{default:t(()=>[r(F,null,{default:t(()=>[g(V(e.searchTerm?"Search: ".concat(e.searchTerm):""),1)]),_:1}),r(m,{icon:e.close},null,8,["icon"])]),_:1})):y("",!0),r(p,{color:e.showSearchKeyboard?"primary":"dark",onClick:c[2]||(c[2]=()=>e.showSearchKeyboard=!e.showSearchKeyboard),size:"large"},{default:t(()=>[r(m,{size:"large",icon:e.search},null,8,["icon"])]),_:1},8,["color"]),typeof e.onRefresh=="function"?(n(),h(p,{key:2,onClick:c[3]||(c[3]=()=>e.onRefresh?e.onRefresh():null),color:"success",size:"large"},{default:t(()=>[r(m,{size:"large",icon:e.sync},null,8,["icon"])]),_:1})):y("",!0)]),_:1})]),_:1}),(e.headerBadge||[]).length?(n(),h(R,{key:0,color:"light"},{default:t(()=>[(n(!0),v(z,null,N(e.headerBadge,(s,C)=>(n(),h(H,{onClick:l=>typeof s.action=="function"?s.action():null,key:C,color:(s==null?void 0:s.color)||"dark"},{default:t(()=>[r(m,{icon:(s==null?void 0:s.icon)||e.search},null,8,["icon"]),r(F,{innerHTML:s==null?void 0:s.text},null,8,["innerHTML"])]),_:2},1032,["onClick","color"]))),128))]),_:1})):y("",!0)]),_:1}),r(q,{"scroll-y":"","scroll-x":""},{default:t(()=>[T("table",Me,[T("thead",Oe,[(n(!0),v(z,null,N(e.columns,(s,C)=>(n(),v("tr",{key:C},[(n(!0),v(z,null,N(s,(l,B)=>{var S,M;return n(),v("th",{key:B,colspan:((S=l==null?void 0:l.span)==null?void 0:S.thColspan)||1,rowspan:((M=l==null?void 0:l.span)==null?void 0:M.thRowspan)||1,onClick:J=>e.sortColumn(l.ref)},[r(Y,{lines:"none"},{default:t(()=>[e.columnSorted&&e.columnSorted===l.ref?(n(),h(m,{key:0,icon:e.sortOrder==="asc"?e.arrowUp:e.arrowDown},null,8,["icon"])):y("",!0),r(F,{class:"ion-text-center"},{default:t(()=>[T("b",null,V(l.label),1)]),_:2},1024)]),_:2},1024)],8,je)}),128))]))),128))]),T("tbody",null,[(n(!0),v(z,null,N(e.page,(s,C)=>(n(),v("tr",{key:C},[(n(!0),v(z,null,N(s.row,(l,B)=>{var S;return n(),v("td",{key:B,onClick:()=>e.onClickTablecell(l),class:Be({"clickable-cell":(S=l==null?void 0:l.column)==null?void 0:S.tdClick})},[T("span",Le,V(l.value),1)],10,Ae)}),128))]))),128))])])]),_:1}),r(G,null,{default:t(()=>[e.showSearchKeyboard?(n(),h(W,{key:0,kbConfig:e.QWERTY,onKeyPress:e.filterTable},null,8,["kbConfig","onKeyPress"])):y("",!0),r(R,{color:"dark"},{default:t(()=>[r(p,{onClick:c[4]||(c[4]=s=>e.toCSV()),size:"large"},{default:t(()=>[g(" CSV ")]),_:1}),r(p,{onClick:c[5]||(c[5]=s=>e.toPDF()),size:"large"},{default:t(()=>[g(" PDF ")]),_:1}),e.totalPages>1?(n(),h(p,{key:0,onClick:e.first,disabled:e.currentPage===0||e.totalPages<=2,size:"large",slot:"end"},{default:t(()=>[g(" First ")]),_:1},8,["onClick","disabled"])):y("",!0),e.totalPages>1?(n(),h(p,{key:1,onClick:e.prev,disabled:!e.canPrev,color:"light",size:"large",slot:"end"},{default:t(()=>[g(" Prev ")]),_:1},8,["onClick","disabled"])):y("",!0),e.totalPages>1?(n(),h(p,{key:2,onClick:e.selectPage,size:"large",slot:"end",color:"light"},{default:t(()=>[g(V(e.currentPage)+" / "+V(e.totalPages-1),1)]),_:1},8,["onClick"])):y("",!0),e.totalPages>1?(n(),h(p,{key:3,onClick:e.next,disabled:!e.canNext,color:"light",size:"large",slot:"end"},{default:t(()=>[g(" Next ")]),_:1},8,["onClick","disabled"])):y("",!0),e.totalPages>1?(n(),h(p,{key:4,onClick:e.last,disabled:e.currentPage+1>=e.totalPages||e.totalPages<=2,size:"large",slot:"end"},{default:t(()=>[g(" Last ")]),_:1},8,["onClick","disabled"])):y("",!0),r(p,{onClick:e.finish,color:"success",size:"large",slot:"end"},{default:t(()=>[g(" Finish ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const We=Re(Ne,[["render",Qe],["__scopeId","data-v-540e223c"]]);export{We as v};
