System.register(["./index-legacy-B-IGLekl.js","./FieldMixin.vue_vue_type_script_lang-legacy-Zep7_N-u.js","./BaseTextInput-legacy-BEKgeR0k.js"],(function(e,t){"use strict";var i,a,l,n,s,u,r,o,d,c,h,g,f,p,_,b,v,m,y,T,D,C,k,q,I,w,V,x,N,$;return{setters:[e=>{i=e.d,a=e.bW,l=e.aW,n=e.$,s=e._,u=e.a_,r=e.a0,o=e.W,d=e.a1,c=e.a2,h=e.eS,g=e.c4,f=e.df,p=e.dD,_=e.a9,b=e.aa,v=e.a6,m=e.ab,y=e.u,T=e.v,D=e.w,C=e.x,k=e.B,q=e.E,I=e.C,w=e.z,V=e.Z,x=e.G},e=>{N=e._},e=>{$=e.default}],execute:function(){var t=document.createElement("style");t.textContent="ion-label[data-v-e5193b0a]{font-weight:700}.border-right[data-v-e5193b0a]{border-right:solid 1px #ccc}.scroll-list[data-v-e5193b0a]{height:70vh;overflow:auto}.input_display[data-v-e5193b0a]{font-size:1.3em}\n/*$vite$:1*/",document.head.appendChild(t);const z=i({components:{ViewPort:a,HisTextInput:$,IonGrid:l,IonCol:n,IonRow:s,IonIcon:u,IonList:r,IonItem:o,IonLabel:d,IonInput:c},mixins:[N],data:()=>({drugs:[],selectedDrug:null,chevronDown:h,previousTinCount:0,newTinCount:0}),mounted(){this.init()},activated(){this.init()},methods:{clearValue(){this.drugs=this.drugs.map((e=>e.entries?(e.entries=e.entries.map((e=>(e.current_quantity=e.originalQuantity,e))),e):e))},async init(){this.$emit("onFieldActivated",this),g(this.drugs)&&(this.drugs=await this.options())},disableReasonsOptions(e,t){const i=["Theft","Took out for training","Accidents","Flooding","Natural disaster"];return t.map((t=>({...t,disabled:e?t.disabled||i.includes(t.label):!i.includes(t.label)})))},fmtNumber:e=>f(e),getModalTitle(e){return`${e} (${this.drugs[this.selectedDrug].label})`},getDrugValue(e,t){return this.drugs[this.selectedDrug].other[e][t]},setDrugValue(e,t,i){this.drugs[this.selectedDrug].other[e][t]=i?i.value:""},async enterAmount(e){const t=this.getDrugValue(e,"batch_number");p({id:"tins",helpText:this.getModalTitle(`Enter number of tins for Batch ${t}`),type:_.TT_NUMBER,defaultValue:()=>(this.previousTinCount=this.getDrugValue(e,"current_quantity"),this.previousTinCount),validation:e=>!e||e&&!e.value?null:b.validateSeries([()=>b.isNumber(e),()=>e.value<0?["Number of tins must be greater than 1"]:null])},(t=>(this.newTinCount=t.value,this.setDrugValue(e,"current_quantity",t))))},async selectReason(e){const t=this.getDrugValue(e,"batch_number");p({id:"reason",helpText:this.getModalTitle(`Select reason for Batch ${t} modification`),type:_.TT_SELECT,defaultValue:()=>this.getDrugValue(e,"reason"),validation:e=>b.required(e),options:()=>this.disableReasonsOptions(this.newTinCount>this.previousTinCount,[{label:"Theft",value:"Theft"},{label:"Took out for training",value:"Took out for training"},{label:"Accidents",value:"Accidents"},{label:"Flooding",value:"Flooding"},{label:"Natural disaster",value:"Natural disaster"},{label:"Misplaced stock",value:"Misplaced stock"},{label:"Incorrect entry",value:"Incorrect entry"}])},(t=>{this.setDrugValue(e,"reason",t)}))},async selectDrug(e){this.selectedDrug=e},isBatchUpdated:e=>e.current_quantity!==e.original_quantity&&!!e.reason,isModificationComplete(){return this.drugs.every((e=>e.other?.every((e=>e.current_quantity===e.original_quantity||!!e.reason))))},getUpdatedDrugs(){const e=[];return this.drugs.forEach((t=>{const i=t.other?.filter((e=>this.isBatchUpdated(e)));e.push(...i)})),e}},watch:{clear(){this.drugs=this.drugs.map((e=>e.other?(e.other=e.other.map((e=>(e.current_quantity=e.original_quantity,e))),e):e))},drugs:{async handler(){if(this.isModificationComplete())return this.$emit("onValue",this.getUpdatedDrugs());this.$emit("onValue",null)},immediate:!0,deep:!0}}});e("default",v(z,[["render",function(e,t,i,a,l,n){const s=m("his-text-input"),u=m("ion-item"),r=m("ion-list"),o=m("ion-col"),d=m("ion-label"),c=m("ion-input"),h=m("ion-icon"),g=m("ion-row"),f=m("ion-grid"),p=m("view-port");return y(),T(p,null,{default:D((()=>[C(s,{readonly:"",value:e.drugs[e.selectedDrug]?.label||""},null,8,["value"]),C(f,{style:{background:"white"}},{default:D((()=>[C(g,null,{default:D((()=>[C(o,{size:"4",class:"border-right scroll-list"},{default:D((()=>[(y(!0),k(q,null,I(e.drugs,((t,i)=>(y(),T(r,{key:i},{default:D((()=>[C(u,{detail:"",color:i===e.selectedDrug?"lightblue":"",onClick:t=>e.selectDrug(i)},{default:D((()=>[w(V(t.label),1)])),_:2},1032,["color","onClick"])])),_:2},1024)))),128))])),_:1}),C(o,{size:"8",class:"scroll-list"},{default:D((()=>[(y(!0),k(q,null,I(e.drugs[e.selectedDrug]?.other||[],((i,a)=>(y(),T(g,{key:a},{default:D((()=>[C(o,{size:"12"},{default:D((()=>[x("h4",null,"Batch Number: "+V(i.batch_number)+" ("+V(i.pack_size)+"/tin) ",1)])),_:2},1024),C(o,{"size-md":"4"},{default:D((()=>[C(u,null,{default:D((()=>[C(d,{position:"floating"},{default:D((()=>t[0]||(t[0]=[w("Available Tins")]))),_:1}),C(c,{readonly:"",placeholder:"0",value:e.fmtNumber(i.original_quantity)},null,8,["value"])])),_:2},1024)])),_:2},1024),C(o,{"size-md":"4"},{default:D((()=>[C(u,null,{default:D((()=>[C(d,{position:"floating"},{default:D((()=>t[1]||(t[1]=[w("Verified Tins")]))),_:1}),C(c,{readonly:"",placeholder:"0",value:e.fmtNumber(i.current_quantity),color:i.current_quantity!=i.original_quantity?"danger":"success",onClick:t=>e.enterAmount(a)},null,8,["value","color","onClick"])])),_:2},1024)])),_:2},1024),C(o,{"size-md":"4"},{default:D((()=>[C(u,null,{default:D((()=>[C(d,{position:"floating"},{default:D((()=>t[2]||(t[2]=[w("Reason")]))),_:1}),C(c,{disabled:i.current_quantity==i.original_quantity,placeholder:"0",value:i.reason??"N/A",onClick:t=>e.selectReason(a)},null,8,["disabled","value","onClick"]),C(h,{icon:e.chevronDown,slot:"end",class:"ion-padding-top",onClick:t=>e.selectReason(a)},null,8,["icon","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-e5193b0a"]]))}}}));
