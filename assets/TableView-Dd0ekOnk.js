import{d as ne,ca as re,cb as se,b1 as le,ba as ie,cc as ue,I as ce,k as de,i as fe,a4 as pe,a5 as he,ah as ye,aE as ge,a7 as ve,l as ke,r as F,c as K,aR as be,cd as Ce,ce as me,cf as Pe,cg as we,ch as Se,ci as De,cj as Ie,ck as Ve,as as Te,a$ as _e,B as Fe,S as $,b4 as $e,cl as Re,cm as ze,cn as Ee,co as Be,a_ as Z,am as Ne,h as b,e as s,w as a,a as h,a6 as y,ar as f,j as C,g as R,t as z,a9 as E,aa as O,b as r,bc as Ue}from"./index-qFt4YszW.js";import{t as He,a as Ke}from"./Export-CDLTNdY8.js";const Oe=ne({components:{IonToolbar:ke,IonItem:ve,IonIcon:ge,IonLabel:ye,IonTitle:he,IonHeader:pe,IonButton:fe,IonFooter:de,IonContent:ce,IonButtons:ue,IonChip:ie,HisKeyboard:le,IonThumbnail:se,IonImg:re},props:{title:{type:String,default:"Report"},headerBadge:{type:Object},iconUrl:{type:String},subtitle:{type:String},columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},enablePagination:{type:Boolean,default:!0},rowsPerPage:{type:Number,default:10},onFinish:{type:Function},onRefresh:{type:Function},onConfigure:{type:Function},csvQuarter:{type:String},reportPrefix:{type:String,default:""},defaultSortedColumn:{type:String},defaultSortOrder:{type:String,default:"desc"}},setup(e){const d=Te(),V=F([]),g=F(0),S=F(""),T=F(""),w=F("desc"),A=F(!1),L=K(()=>{let t=V.value;return w.value&&T.value&&(t=Ee(V.value)[w.value](o=>o.sortData[T.value])),S.value?new Be(t,{threshold:.3,keys:["searchIndex"],useExtendedSearch:!0}).search(S.value,{limit:e.rowsPerPage}).map(c=>c.item):t}),k=K(()=>Z.chunk(L.value,e.rowsPerPage).length),p=K(()=>g.value+2<=k.value),B=K(()=>g.value>0),M=K(()=>Z.chunk(L.value,e.rowsPerPage)[g.value]),Q=t=>{T.value=t,w.value=w.value==="asc"?"desc":"asc"},N=()=>Ve(t=>{const o=parseInt(t);parseInt(t)<=k.value&&(g.value=o)},{title:"Select page"}),Y=()=>g.value=0,q=()=>g.value=k.value-1||0,W=()=>g.value+=1,G=()=>g.value-=1,J=()=>{typeof e.onFinish=="function"?e.onFinish():d.push("/")},u=t=>{var o,c;try{typeof((o=t.column)==null?void 0:o.tdClick)=="function"&&((c=t.column)==null||c.tdClick(t));return}catch(P){console.error(P)}},m=()=>e.columns.reduce((t,o)=>t.concat(o),[]).filter(t=>t.value||t.ref),i=()=>m().some(t=>t==null?void 0:t.encrypted),_=(t,o=!1)=>{var H,X,te;const c=m().filter(n=>[t==="pdf"&&typeof n.encrypted=="boolean"?(n==null?void 0:n.encrypted)&&!o:!0,t==="csv"?!(n!=null&&n.encrypted):!0,n.canExport?n==null?void 0:n.canExport[t]:!0,typeof n.exportable=="boolean"?n.exportable:!0].every(Boolean)),P=c.map(n=>n.exportedValue&&n.exportedValue.column?n.exportedValue.column(n):n.secondaryLabel||n.label),l=c.map(n=>n.ref),v=V.value.reduce((n,oe)=>{const ae=oe.row.filter(({column:I})=>l.includes(I.ref)).map(I=>I.column.exportedValue&&I.column.exportedValue.dataValue?I.column.exportedValue.dataValue(I):I.value);return[...n,ae]},[]),U="".concat(e.reportPrefix," ").concat((H=$.getLocationName())!=null?H:""," ").concat(Re(e.title).replace(e.reportPrefix,"")," ").concat(ze((te=(X=e.csvQuarter)!=null?X:e.subtitle)!=null?te:""));return{headers:P,rows:v,filename:U}},D=async()=>{let t;if(i()&&await _e("Security warning","PDF may contain private data that will require a password to unlock","To access private data choose Secure PDF over Regular PDF",[{name:"Secure PDF",slot:"start",color:"success"},{name:"Regular PDF",slot:"start",color:"success"}],"his-danger-color")==="Secure PDF"){const v=$.getUserName();t={encryption:{userPassword:v,ownerPassword:v,userPermissions:["print"]}}}const{headers:o,rows:c,filename:P}=_("pdf",!t);He([o],c,P,!0,t)},j=()=>{const{headers:t,rows:o,filename:c}=_("csv");Ke([t],[...o,["Date Created: ".concat(Fe().format("DD/MMM/YYYY HH:MM:ss"))],["Quarter: ".concat(e.csvQuarter||e.subtitle)],["HIS-Core Version: ".concat($.getCoreVersion())],["API Version: ".concat($.getApiVersion())],["Site UUID: ".concat($.getSiteUUID())],["Generated by: ".concat($.getUserName())]],c)},x=t=>{S.value=$e(t,S.value),g.value=0},ee=t=>{t.forEach(o=>{const c={...o},P=m().map(l=>{var H;let v="";const U=o[l.ref];try{Z.isEmpty(o)?v="":typeof l.toValue=="function"?v="".concat(l.toValue(U)):typeof l.value=="function"?v=l.value(o):v=o[l.ref]||""}catch(X){v=(H=l==null?void 0:l.defaultValue)!=null?H:"_ERROR_"}return c[l.ref]=v,typeof l.sortValue=="function"&&(c[l.ref]=l.sortValue(U)),{column:l,refData:U,value:v,data:o}});V.value.push({row:P,data:o,sortData:c,searchIndex:[...P,P.map(l=>l.value).join(" ")]})})};return be(()=>e.columnData,t=>{var o;if(V.value=[],!Array.isArray(t)||!t.length){g.value=0,S.value="",T.value=(o=e.defaultSortedColumn)!=null?o:"",w.value=e.defaultSortOrder,ee(Array.from({length:0}).map(()=>({})));return}ee(t)},{immediate:!0,deep:!0}),{first:Y,last:q,next:W,prev:G,selectPage:N,sortColumn:Q,onClickTablecell:u,toPDF:D,toCSV:j,finish:J,filterTable:x,sync:Ie,search:De,close:Se,arrowUp:we,arrowDown:Pe,funnelOutline:me,page:M,canNext:p,searchTerm:S,totalPages:k,sortOrder:w,canPrev:B,currentPage:g,columnSorted:T,QWERTY:Ce,showSearchKeyboard:A}}}),Le={key:0},Me={class:"his-sm-text"},je={style:{width:"100%"}},Ae={class:"stick-report-header"},Qe=["colspan","rowspan","onClick"],Ye=["onClick"],qe=["innerHTML"];function We(e,d,V,g,S,T){const w=f("ion-img"),A=f("ion-thumbnail"),L=f("ion-title"),k=f("ion-icon"),p=f("ion-button"),B=f("ion-label"),M=f("ion-chip"),Q=f("ion-buttons"),N=f("ion-toolbar"),Y=f("ion-header"),q=f("ion-item"),W=f("ion-content"),G=f("his-keyboard"),J=f("ion-footer");return r(),b(E,null,[s(Y,null,{default:a(()=>[s(N,null,{default:a(()=>[e.iconUrl?(r(),h(A,{key:0,slot:"start"},{default:a(()=>[s(w,{src:e.iconUrl},null,8,["src"])]),_:1})):y("",!0),s(L,{slot:"start",class:"his-md-text"},{default:a(()=>[C(z(e.title)+" ",1),e.subtitle?(r(),b("br",Le)):y("",!0),R("span",Me,z(e.subtitle),1)]),_:1}),s(Q,{slot:"end"},{default:a(()=>[typeof e.onConfigure=="function"?(r(),h(p,{key:0,onClick:d[0]||(d[0]=()=>e.onConfigure?e.onConfigure():null)},{default:a(()=>[s(k,{size:"large",icon:e.funnelOutline},null,8,["icon"])]),_:1})):y("",!0),e.searchTerm?(r(),h(M,{key:1,onClick:d[1]||(d[1]=()=>{e.searchTerm="",e.showSearchKeyboard=!1}),class:"his-md-text",color:"primary"},{default:a(()=>[s(B,null,{default:a(()=>[C(z(e.searchTerm?"Search: ".concat(e.searchTerm):""),1)]),_:1}),s(k,{icon:e.close},null,8,["icon"])]),_:1})):y("",!0),s(p,{color:e.showSearchKeyboard?"primary":"dark",onClick:d[2]||(d[2]=()=>e.showSearchKeyboard=!e.showSearchKeyboard),size:"large"},{default:a(()=>[s(k,{size:"large",icon:e.search},null,8,["icon"])]),_:1},8,["color"]),typeof e.onRefresh=="function"?(r(),h(p,{key:2,onClick:d[3]||(d[3]=()=>e.onRefresh?e.onRefresh():null),color:"success",size:"large"},{default:a(()=>[s(k,{size:"large",icon:e.sync},null,8,["icon"])]),_:1})):y("",!0)]),_:1})]),_:1}),(e.headerBadge||[]).length?(r(),h(N,{key:0,color:"light"},{default:a(()=>[(r(!0),b(E,null,O(e.headerBadge,(u,m)=>(r(),h(M,{onClick:i=>typeof u.action=="function"?u.action():null,key:m,color:(u==null?void 0:u.color)||"dark"},{default:a(()=>[s(k,{icon:(u==null?void 0:u.icon)||e.search},null,8,["icon"]),s(B,{innerHTML:u.text},null,8,["innerHTML"])]),_:2},1032,["onClick","color"]))),128))]),_:1})):y("",!0)]),_:1}),s(W,{"scroll-y":"","scroll-x":""},{default:a(()=>[R("table",je,[R("thead",Ae,[(r(!0),b(E,null,O(e.columns,(u,m)=>(r(),b("tr",{key:m},[(r(!0),b(E,null,O(u,(i,_)=>{var D,j;return r(),b("th",{key:_,colspan:((D=i==null?void 0:i.span)==null?void 0:D.thColspan)||1,rowspan:((j=i==null?void 0:i.span)==null?void 0:j.thRowspan)||1,onClick:x=>e.sortColumn(i.ref)},[s(q,{lines:"none"},{default:a(()=>[e.columnSorted&&e.columnSorted===i.ref?(r(),h(k,{key:0,icon:e.sortOrder==="asc"?e.arrowUp:e.arrowDown},null,8,["icon"])):y("",!0),s(B,null,{default:a(()=>[R("b",null,z(i.label),1)]),_:2},1024)]),_:2},1024)],8,Qe)}),128))]))),128))]),R("tbody",null,[(r(!0),b(E,null,O(e.page,(u,m)=>(r(),b("tr",{key:m},[(r(!0),b(E,null,O(u.row,(i,_)=>{var D;return r(),b("td",{key:_,onClick:()=>e.onClickTablecell(i),class:Ue({"clickable-cell":(D=i==null?void 0:i.column)==null?void 0:D.tdClick})},[R("span",{innerHTML:i.value,class:"his-sm-text"},null,8,qe)],10,Ye)}),128))]))),128))])])]),_:1}),s(J,null,{default:a(()=>[e.showSearchKeyboard?(r(),h(G,{key:0,kbConfig:e.QWERTY,onKeyPress:e.filterTable},null,8,["kbConfig","onKeyPress"])):y("",!0),s(N,{color:"dark"},{default:a(()=>[s(p,{onClick:d[4]||(d[4]=u=>e.toCSV()),size:"large"},{default:a(()=>[C(" CSV ")]),_:1}),s(p,{onClick:d[5]||(d[5]=u=>e.toPDF()),size:"large"},{default:a(()=>[C(" PDF ")]),_:1}),e.totalPages>1?(r(),h(p,{key:0,onClick:e.first,disabled:e.currentPage===0||e.totalPages<=2,size:"large",slot:"end"},{default:a(()=>[C(" First ")]),_:1},8,["onClick","disabled"])):y("",!0),e.totalPages>1?(r(),h(p,{key:1,onClick:e.prev,disabled:!e.canPrev,color:"light",size:"large",slot:"end"},{default:a(()=>[C(" Prev ")]),_:1},8,["onClick","disabled"])):y("",!0),e.totalPages>1?(r(),h(p,{key:2,onClick:e.selectPage,size:"large",slot:"end",color:"light"},{default:a(()=>[C(z(e.currentPage)+" / "+z(e.totalPages-1),1)]),_:1},8,["onClick"])):y("",!0),e.totalPages>1?(r(),h(p,{key:3,onClick:e.next,disabled:!e.canNext,color:"light",size:"large",slot:"end"},{default:a(()=>[C(" Next ")]),_:1},8,["onClick","disabled"])):y("",!0),e.totalPages>1?(r(),h(p,{key:4,onClick:e.last,disabled:e.currentPage+1>=e.totalPages||e.totalPages<=2,size:"large",slot:"end"},{default:a(()=>[C(" Last ")]),_:1},8,["onClick","disabled"])):y("",!0),s(p,{onClick:e.finish,color:"success",size:"large",slot:"end"},{default:a(()=>[C(" Finish ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const Xe=Ne(Oe,[["render",We],["__scopeId","data-v-2ab83098"]]);export{Xe as v};
