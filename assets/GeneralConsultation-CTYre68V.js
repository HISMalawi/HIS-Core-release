import{H as b}from"./HisStandardForm-BPNPJCrM.js";import{d as y,r as i,bU as _,an as r,ao as n,a as g,b as v,w as C,e as w,i as c,q as S,l as B,a_ as V,bA as E}from"./index-CJleCCtM.js";import{u as N}from"./useEncounter-BYi6HXkG.js";import{y as P,m as L,r as O,a as x}from"./commons-CcXQGk9e.js";import"./isEmpty-Dwdx9lIX.js";import"./encounter_guidelines-CfQXyRxl.js";import"./GuidelineEngine-D6V1_Znr.js";const U=y({__name:"GeneralConsultation",setup(A){const s=i(0),l=i(!1);let a;const u=i([]),{patientDashboardUrl:d,goToNextTask:m}=N((o,e,t)=>{a=new _(e,168,o),u.value=h(t)});async function p(o,e){try{const t=await O(e,"consultation");await a.createEncounter(),await a.saveObservationList(t),m()}catch(t){console.error(t),B("An error occurred while saving the complaints")}}async function T(o){if(l.value&&"".concat(o.label).match(/malnutrition/i)&&"".concat(o.value).match(/no/i)){const e=await V("Recommendation","Patient's weight has dropped by ".concat(s.value,"% , is this controlled weight loss??"),"Please verify",[{name:"Confirm weight loss",slot:"start",color:"success"},{name:"Confirm controlled",slot:"end",color:"primary"}]);o.value=e==="Confirm weight loss"?"Yes":"No"}}function f(o){const e=E.getConceptsByCategory("tb_symptom",!0).map(({name:t})=>t);return x([...e],o)}function h(o){return[{id:"on_tb_treatment",helpText:"On TB Treatment?",type:r.TT_SELECT,validation:e=>n.required(e),computedValue:e=>{const t={tag:"consultation",obs:[a.buildValueCoded("TB treatment",e.value)]};return/yes/i.test(e.value)&&t.obs.push(a.buildValueCoded("TB Status","Confirmed TB on treatment")),t},options:P},{id:"tb_side_effects",helpText:"TB Associated symptoms",type:r.TT_MULTIPLE_YES_NO,init:async()=>{const e=await o.getWeightHistory();return s.value=o.getWeightLossPercentageFromTrail(e),l.value=Number(s.value)>=10,!0},onValue:async e=>(await T(e),!0),validation:e=>n.validateSeries([()=>n.required(e),()=>n.anyEmpty(e)]),condition:e=>e.on_tb_treatment.value.match(/no/i),options:(e,t)=>f(t),computedValue:e=>({tag:"consultation",obs:e.map(async t=>({...await a.buildValueCoded("Routine TB Screening",t.label),child:[await a.buildValueCoded(t.label,t.value)]}))})},{id:"tb_status",helpText:"TB Status",type:r.TT_SELECT,validation:e=>n.required(e),condition:e=>e.tb_side_effects.value.some(t=>/yes/i.test(t.value)),options:()=>L(["TB NOT suspected","TB Suspected","Confirmed TB Not on treatment"]),computedValue:e=>({tag:"consultation",obs:a.buildValueCoded("TB Status",e.value)})}]}return(o,e)=>(g(),v(c(S),null,{default:C(()=>[w(b,{cancelDestinationPath:c(d),fields:u.value,onFinishAction:p,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{U as default};
