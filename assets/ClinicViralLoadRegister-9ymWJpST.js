import{d as n,I as d,L as e,bL as u,H as h,ad as m,_ as p,r as i,o as c,c as _,w as f,b as D}from"./index-BbPYANJn.js";import{R as g}from"./BaseTableReport-TUrF02Zd.js";import{_ as T}from"./ReportMixin.vue_vue_type_script_lang-BdKiUyjt.js";import"./Export-BN6ZqWE3.js";import"./HisStandardForm-Qxx6S8J3.js";import"./BasicReportTemplate-BDBwxYU4.js";import"./Pagination-DHHxTtaM.js";const w=n({components:{ReportTemplate:g,IonPage:d},mixins:[T],data:()=>({reportFilter:"",title:"Viral Load Register",reportData:[],totalTAT:[],modalData:{},columns:[[e.thTxt("ARV #"),e.thTxt("Accession #"),e.thTxt("Status"),e.thTxt("Order Date"),e.thTxt("Result"),e.thTxt("Date received"),e.thTxt("Mode of Delivery"),e.thTxt("Test reason"),e.thTxt("TAT(Days)")]],customBtns:[]}),created(){this.fields=this.getDateDurationFields(),this.customBtns.push({name:"High level view",size:"large",slot:"start",color:"primary",visible:!0,onClick:async()=>this.showModal()})},computed:{rows(){return this.reportFilter?this.buildRows(this.reportData.filter(t=>!!(this.reportFilter==="All"||this.reportFilter==="No results"&&!t.result||this.reportFilter==="With Results"&&t.result||this.reportFilter==="Rejected"&&t.order_status==="test-rejected"||this.reportFilter==="Drawn"&&t.order_status==="drawn"||this.reportFilter==="Pending"&&t.order_status==="pending"||this.reportFilter==="Started"&&t.order_status==="started"||this.reportFilter==="Failed"&&t.order_status==="failed"||this.reportFilter==="Not-done"&&t.order_status==="not-done"||this.reportFilter==="Completed"&&t.order_status==="completed"))):this.buildRows(this.reportData)}},methods:{async init(t,s){this.reportFilter="";const r=new u;r.setStartDate(s.start_date),r.setEndDate(s.end_date),this.period=r.getDateIntervalPeriod(),this.reportData=await r.getClinicElectronicAlerts(),this.buildHighLevelView()},buildRows(t){return t.length?t.map(s=>{let r=h.dateDiffInDays(s.date_received,s.date_ordered);return r?this.totalTAT.push(r):r="",[e.td(s.arv_number),e.td(s.accession_number),e.td(s.order_status),e.tdDate(s.date_ordered),e.td(s.result?s.result.replace(/</g,"&lt;"):""),e.tdDate(s.date_received),e.td(s.result_delivery_mode=="test_results_delivered_to_site_electronically"?"Electronic":s.result_delivery_mode=="test_results_delivered_to_site_manually"?"Manual":""),e.td(s.test_reason),e.td(r)]}):[]},async customFilter(){const t=await m("Select report filter","",["All","Rejected","With Results","No results","Drawn","Pending","Started","Failed","Not-done","Completed"],[{name:"Cancel",slot:"start"},{name:"Select",slot:"end",role:"action"}]);return this.reportFilter=(t==null?void 0:t.selection)||"",this.reportFilter},buildHighLevelView(){this.modalData={withResults:[],noResults:[],rejected:[],targeted:[],targetedWithResult:[],drawn:[],pending:[],started:[],failed:[],notDone:[],completed:[]},this.reportData.map(t=>{t.result&&this.modalData.withResults.push(t.accession_number),t.result||this.modalData.noResults.push(t.accession_number),t.order_status&&(t.order_status=="test-rejected"&&this.modalData.rejected.push(t.accession_number),t.order_status=="drawn"&&this.modalData.drawn.push(t.accession_number),t.order_status=="pending"&&this.modalData.pending.push(t.accession_number),t.order_status=="started"&&this.modalData.started.push(t.accession_number),t.order_status=="failed"&&this.modalData.failed.push(t.accession_number),t.order_status=="not-done"&&this.modalData.notDone.push(t.accession_number),t.order_status=="completed"&&this.modalData.completed.push(t.accession_number)),t.test_reason&&(t.test_reason.match(/target/i)&&this.modalData.targeted.push(t.accession_number),t.test_reason.match(/target/i)&&t.result&&this.modalData.targetedWithResult.push(t.accession_number))})},async showModal(){const t=[[e.thTxt("Indicator"),e.thTxt("Count")]],s=[[e.td("Total Orders"),e.td(this.reportData.length)],[e.td("Total Orders With Results"),e.td(this.modalData.withResults.length)],[e.td("Total Orders No Results"),e.td(this.modalData.noResults.length)],[e.td("Total Orders Rejected"),e.td(this.modalData.rejected.length)],[e.td("Total Targeted Orders"),e.td(this.modalData.targeted.length)],[e.td("Total Targeted Orders With Results"),e.td(this.modalData.targetedWithResult.length)],[e.td("Total Orders Drawn"),e.td(this.modalData.drawn.length)],[e.td("Total Orders Pending"),e.td(this.modalData.pending.length)],[e.td("Total Orders Started"),e.td(this.modalData.started.length)],[e.td("Total Orders Failed"),e.td(this.modalData.failed.length)],[e.td("Total Orders Not-done"),e.td(this.modalData.notDone.length)],[e.td("Total Orders Completed"),e.td(this.modalData.completed.length)],[e.td("Average TAT (days)"),e.td(Math.floor(this.totalTAT.reduce((r,a)=>r+a,0)/this.totalTAT.length))]];this.drilldownData("Register Summary",t,s,!1)}}});function R(t,s,r,a,F,b){const o=i("report-template"),l=i("ion-page");return c(),_(l,null,{default:f(()=>[D(o,{title:t.title,rows:t.rows,fields:t.fields,columns:t.columns,itemsPerPage:10,period:t.period,customFilter:t.customFilter,onReportConfiguration:t.init,customBtns:t.customBtns,showPerPageFilter:!1,showVLFilter:"","report-prefix":"Clinic"},null,8,["title","rows","fields","columns","period","customFilter","onReportConfiguration","customBtns"])]),_:1})}const P=p(w,[["render",R]]);export{P as default};
