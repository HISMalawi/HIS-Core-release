System.register(["./TableReportTemplate-legacy-Cq5KAdit.js","./index-legacy-zV5Jd_xD.js","./tb_report_service-legacy-DhIcFQ4R.js","./ReportMixin.vue_vue_type_script_lang-legacy-CI-CwMr0.js","./TBDrilldown-legacy-EhRAsgQu.js","./Export-legacy-BX7NHYFH.js","./index-legacy-DBvie6Lp.js","./HisStandardForm-legacy-DUG6a-9J.js","./ReportErrors-legacy-DH-TCP79.js","./BasicReportTemplate-legacy-aIiJ5pa3.js","./Pagination-legacy-C0F3xQXP.js","./TableView-legacy-CBK6tVyf.js"],(function(e,t){"use strict";var l,a,o,r,s,i,n,u,d,c,p,h,m,g,T,f,b,v;return{setters:[e=>{l=e.R},e=>{a=e.d,o=e.r,r=e.n,s=e.ay,i=e.z,n=e.s,u=e.al,d=e.am,c=e.ak,p=e.ap,h=e.a,m=e.b,g=e.w,T=e.e},e=>{f=e.T},e=>{b=e._},e=>{v=e.T},null,null,null,null,null,null,null],execute:function(){const t=a({mixins:[b],components:{IonPage:r,ReportTemplate:l},data:()=>({rows:[],columns:o([[]]),subtitle:o("-"),data:o([]),yearValue:o(""),quarterValue:o(1),indicatorsValue:o([]),footerText:o("Select All"),reportIndicators:[{label:"Culture positive",value:"culture_positive"},{label:"Culture negative",value:"culture_negative"},{label:"Culture and smear not done",value:"culture_and_smear_not_done"},{label:"Transfer out",value:"transfer_out"},{label:"Died",value:"died"},{label:"Lost to follow up",value:"lost_to_follow_up"}],reportConfig:[],age_groups:["0-4","5-14","15-24","25-34","35-44","45-54","55-64","65+"]}),mounted(){this.init()},methods:{init(){this.reportConfig=[{id:"year",helpText:"Year",type:d.TT_NUMBER,validation:e=>u.required(e),computedValue:e=>e.value},{id:"quater",helpText:"Quater",type:d.TT_SELECT,requireNext:!1,options:()=>[{label:"First",value:1},{label:"Second",value:2},{label:"Third",value:3},{label:"Fourth",value:4}],validation:e=>u.required(e),computedValue:e=>e.value},{id:"indicators",helpText:"Indicators",type:d.TT_MULTIPLE_SELECT,options:()=>this.reportIndicators,validation:e=>u.required(e),computedValue:e=>e.map((e=>e.value)),config:{footerBtns:[{name:this.footerText,slot:"end",onClickComponentEvents:{refreshOptions:()=>"Select All"===this.footerText?this.selectAll():this.deSelectAll()},onClick:()=>"None"}]}}]},async generate(e){try{this.rows=[],this.columns=this.buildColumns(e.indicators.map((e=>e.label))),this.indicatorsValue=e.indicators.map((e=>e.value)),this.yearValue=e.year.value,this.quarterValue=e.quater.value;const t=new f;this.data=await t.getTBDRInterimOutcomesReport(this.yearValue,this.quarterValue,this.indicatorsValue),this.pushGenderAggregatedHeaders(),this.populateRows(),this.addTotals(),i.getTop().then((e=>e&&i.dismiss()))}catch(t){console.error(t),n("Unable to generate report")}},addTotals(){let e=this.data.flatMap((e=>[Object.values(e).reduce(((e,t)=>t&&t.male&&t.male.length>0?t.male:e),[]),Object.values(e).reduce(((e,t)=>t&&t.female&&t.female.length>0?t.female:e),[])]));e=e.map((e=>this.toDrillColumn("total",{total:e,indicator:""}))),e.unshift(s.td("Totals")),this.rows.push(e)},populateRows(){this.rows=this.age_groups.map((e=>{const t=[];return t.push(s.td(e)),this.data.forEach((l=>{const a=l[e];t.push(a?this.toDrillColumn("male",a):s.td(0)),t.push(a?this.toDrillColumn("female",a):s.td(0))})),t}))},pushGenderAggregatedHeaders(){this.columns[1]=[],this.columns[1].push(s.thTxt("",{sortable:!1,exportable:!1}));for(let e=0;e<this.indicatorsValue.length;e++)this.columns[1].push(s.thTxt("M",{sortable:!1,exportable:!1}),s.thTxt("F",{sortable:!1,exportable:!1}))},toDrillColumn(e,t){return 0==t[e].length?s.td(0):s.tdLink(t[e].length,(()=>{this.drilldown({indicator:t.indicator,ids:[t[e]]})}))},async drilldown(e){(await i.create({component:v,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e.indicator,patientIdentifiers:e.ids,subtitle:`Period: ${this.period} Q${this.quarterValue}`,onFinish:()=>i.getTop().then((e=>e&&i.dismiss()))}})).present()},buildColumns(e){const t=[[s.thTxt("",{sortable:!1,exportable:!1}),s.thTxt("Age Category",{sortable:!1,exportable:!1})]];return e.forEach((e=>{t[0].push(s.thTxt(e,{colspan:2,sortable:!1,exportable:!0}))})),t},deSelectAll(){const e=this.reportIndicators;return this.footerText="Select All",e.map((e=>({...e,isChecked:!1})))},selectAll(){const e=this.reportIndicators;return this.footerText="Deselect All",e.map((e=>({...e,isChecked:!0})))}}});e("default",c(t,[["render",function(e,t,l,a,o,r){const s=p("report-template"),i=p("ion-page");return m(),h(i,null,{default:g((()=>[T(s,{title:"MDR Interim Outcomes",period:"Period",rows:e.rows,fields:e.reportConfig,columns:e.columns,reportPrefix:"NTP",config:{showIndex:!0},onReportConfiguration:e.generate},null,8,["rows","fields","columns","onReportConfiguration"])])),_:1})}]]))}}}));
