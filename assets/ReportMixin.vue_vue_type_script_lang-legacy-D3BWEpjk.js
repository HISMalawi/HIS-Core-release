System.register(["./index-legacy-pSEoxn3J.js","./BasicReportTemplate-legacy-5aAa1V_3.js"],(function(t,e){"use strict";var a,r,i,s,l,n,o,u,d,p,c,h,m,D,w,v;return{setters:[t=>{a=t.d,r=t.S,i=t.bj,s=t.an,l=t.ao,n=t.cD,o=t.cw,u=t.aD,d=t.aA,p=t.z,c=t.H,h=t.cv,m=t.a_,D=t.av,w=t.bi},t=>{v=t.D}],execute:function(){t("_",a({data:()=>({app:i.getActiveApp(),fields:[],report:{},reportReady:!1,period:"",startDate:"",endDate:"",customFileName:"",isMilitarySite:!1,drillDownCache:{}}),methods:{formatGender:t=>h(t),toDate:t=>c.toStandardHisDisplayFormat(t),sortByArvNumber(t,e="arv_number"){try{return t.sort(((t,a)=>this.getArvInt(t[e])>this.getArvInt(a[e])?1:-1))}catch(a){return console.error(a),t}},getArvInt(t){if("string"==typeof t){const e=t.split("-")[2],a=parseInt(e);return"number"==typeof a?a:0}return 0},parseAgeGroup:t=>"<1 year"===t?[0,0]:"90 plus years"===t?[90,1e3]:t.split("-").map((t=>parseInt(t,10))),tdARV(t,e={}){return d.td(t,{sortValue:this.getArvInt(t),...e})},confirmPatient(t){return this.$router.push(`/patients/confirm?person_id=${t}`)},async drilldownAsyncRows(t,e,a,r=!0){(await p.create({component:v,cssClass:"large-modal",componentProps:{title:t,columns:e,asyncRows:a,canExport:r,showFilters:!0,rowsPerPage:50,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>p.dismiss()}})).present()},async drilldownData(t,e,a,r){(await p.create({component:v,cssClass:"large-modal",componentProps:{title:t,columns:e,rows:a,rowParser:r,rowsPerPage:50,showFilters:!0,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>p.dismiss()}})).present()},getDefaultDrillDownTable(){return{rowParser:async t=>{let e=0;const a=t.map((async t=>{let a=null,r=null;if(m.isArray(t)){const[e,a]=t;if(r=e,a in this.drillDownCache)return[r,...this.drillDownCache[a].slice(1)]}else if(a=t,a in this.drillDownCache)return this.drillDownCache[a];const i=await D.findByID(a),s=await new w(a).getProgram(),l=new D(i),n=[];return r&&(e=1,n.push(r)),n.push(this.tdARV(l.getArvNumber())),n.push(d.td(this.formatGender(l.getGender()))),n.push(d.tdDate(l.getBirthdate().toString())),n.push(d.tdDate(s.startDate)),n.push(d.tdBtn("Show",(async()=>{await p.dismiss({}),this.$router.push({path:`/patient/dashboard/${a}`})}))),this.drillDownCache[a]=n,n}));return(await Promise.all(a)).sort(((t,a)=>t[e].sortValue>a[e].sortValue?1:-1))},columns:[[d.thTxt("ARV number"),d.thTxt("Gender"),d.thTxt("Birth Date"),d.thTxt("Art start date"),d.thTxt("Actions")]]}},runTableDrill(t,e="Drilldown patients"){const{columns:a,rowParser:r}=this.getDefaultDrillDownTable();this.drilldownData(e,a,t,r)},drill(t,e="Drill table"){return t&&t.length>0?d.tdLink(t.length,(()=>this.runTableDrill(t,e))):d.td(0)},getQuaterOptions:()=>n.getReportQuarters().map((t=>({label:t.name,value:t.start,other:t}))),getDateDurationFields(t=!1,e=!1,a=5,i=r.getSessionDate()){const d="2000-01-01";return[{id:"quarter",helpText:"Select Quarter",type:l.TT_SELECT,condition:()=>t,validation:t=>s.required(t),options:()=>{let t=n.getReportQuarters(a).map((t=>({label:t.name,value:t.start,other:t})));return e&&(t=[{label:"Set custom period",value:"custom_period",other:{}},...t]),t}},{id:"start_date",helpText:"Start Date",type:l.TT_FULL_DATE,validation:t=>t?new Date(t.value)<new Date(d)?[`${o(`${t.value}`)} is less than minimum date of ${o(d)}`]:i&&new Date(t.value)>new Date(i)?[`${o(`${t.value}`)} is greater than max date of ${o(i)}`]:null:["Date is required"],computedValue:t=>t.value,condition:e=>e.quarter&&"custom_period"===e.quarter.value||!t},{id:"end_date",helpText:"End Date",type:l.TT_FULL_DATE,defaultValue:t=>t.start_date.value,validation:(t,e)=>t?e.start_date.value&&new Date(t.value)<new Date(e.start_date.value)?[`${o(`${t.value}`)} is less than minimum date of ${o(e.start_date.value)}`]:i&&new Date(t.value)>new Date(i)?[`${o(`${t.value}`)} is greater than max date of ${o(i)}`]:null:["Date is required"],computedValue:t=>t.label,condition:e=>e.quarter&&"custom_period"===e.quarter.value||!t},{id:"occupation",helpText:"Report Group",type:l.TT_SELECT,init:async()=>(this.isMilitarySite=await u.get("IS_MILITARY_SITE"),!0),computedValue:t=>t.value,condition:()=>"ART"===this.app?.applicationName&&this.isMilitarySite,validation:t=>s.required(t),options:()=>[{label:"All",value:"All"},{label:"Military",value:"Military"},{label:"Civilian",value:"Civilian"}]}]}}}))}}}));
