System.register(["./index-legacy-DfH-8HCh.js","./HisStandardForm-legacy-Y3Pj6QSa.js","./useEncounter-legacy-BJsOUiSn.js","./commons-legacy-zCcf6xjj.js","./isEmpty-legacy-P9WS7X6i.js","./encounter_guidelines-legacy-BvqdoWM4.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,r,n,o,s,i,u,l,d,c,p,h,g,_,m,y,b,v,f,E;return{setters:[e=>{a=e.d,r=e.r,n=e.bJ,o=e.bO,s=e.ab,i=e.M,u=e.ac,l=e.br,d=e.aL,c=e.ai,p=e.u,h=e.v,g=e.w,_=e.x,m=e.y,y=e.bw,b=e.a5},e=>{v=e.H},e=>{f=e.u},e=>{E=e.r},null,null,null],execute:function(){e("default",a({__name:"Adherence",setup(e){const t=r([]),a=new n(-1,o.ADHERENCE);function T(e,t){return y(c.toStandardHisFormat(a.date)).diff(c.toStandardHisFormat(e),t)}function D(e,t,a){return Math.round(100*(e-t)/(e-a))}function x(e){const t="QW"===e.frequency?"week":"day",a=T(e.order.start_date,t);return e.quantity-a*parseFloat(`${e.equivalent_daily_dose}`)}const{goToNextTask:$,patientDashboardUrl:w}=f(((e,r)=>{a.patientID=r,a.providerID=e,t.value=[(()=>{let e=[];return{id:"pills_brought",helpText:"Pills remaining (brought to clinic)",type:s.TT_ADHERENCE_INPUT,init:async()=>{try{e=await n.getJson(`patients/${r}/drugs_orders_by_program`,{date:a.date,program_id:a.programID})}catch(t){console.error(`${t}`),i("Unable to load data!")}return!0},validation:e=>u.validateSeries([()=>u.required(e),()=>e.some((e=>""===e.value))?["Some values are missing"]:null]),computedValue:e=>e.map((e=>{const t=e.other;return[{concept_id:l.getCachedConceptID("Drug adherence"),value_drug:t.drug.drug_id,order_id:t.order_id,value_modifier:"%",person_id:r,value_numeric:D(t.quantity,parseInt(`${e.value}`),x(t))},{concept_id:l.getCachedConceptID("Number of tablets brought to clinic"),order_id:t.order_id,value_numeric:e.value,person_id:r}]})).flat(1),options:t=>d.isEmpty(t.pills_brought)?e.map((e=>({label:e.drug.name,value:"",other:e}))):t.pills_brought}})(),{id:"adherence_report",helpText:"TB adherence",type:s.TT_TABLE_VIEWER,condition:e=>e.pills_brought.length,options:e=>{const t=e.pills_brought,a=t[0].other.order.start_date,r=T(a,"day"),n=` Last visit: ${c.toStandardHisDisplayFormat(a)} \n                    (${r} Days Elapsed)`,o=[],s=[n],i=[["Prescription"],["Tabs given"],["Tabs per day"],["Tabs remaining"],["Expected"],["Actual (counted)"],["Adherence"],["Doses missed/ Unaccounted for"],["Doses consumed"],["TB Adherence"]];return t.forEach(((e,t)=>{const a=x(e.other),r=D(e.other.quantity,parseInt(`${e.value}`),a),n=r>=95&&r<=105?"Good adherence":"Explore problem",u=function(e,t){const a=parseFloat(e)-parseFloat(t);return a<0?-1*a+" missed":a+" unacc"}(`${a}`,`${e.value}`);s.push(e.other.drug.name),i[0].push(""),i[1].push(e.other.quantity),i[2].push(`${e.other.equivalent_daily_dose}`),i[3].push(""),i[4].push(a<0?"0":`${a}`),i[5].push(`${e.value}`),i[6].push(""),i[7].push(u),i[8].push(`${r}%`),i[9].push(n),o.push({index:t+1,row:9,class:n.match(/good/i)?"adherence-txt-good":"adherence-txt-bad"})})),[{label:"Selected Medication",value:"Table",other:{columns:s,rows:i,rowColors:[{indexes:[0,3,6],class:"adherence-col-bg"}],cellColors:o}}]},config:{hiddenFooterBtns:["Clear"]}}]}));async function C(e,t){await a.createEncounter(),await a.saveObservationList(await E(t)),$()}return(e,a)=>(p(),h(m(b),null,{default:g((()=>[_(v,{cancelDestinationPath:m(w),onFinishAction:C,fields:t.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
