System.register(["./index-legacy-CNrLGT3P.js","./storage-legacy-uuFjVbAf.js"],(function(e,t){"use strict";var a,o,n,i,s,r,l,d,c,u,p,f,g,h,m,w,y,b,v,k,I,x,C,_,T,P,S,L,V,N,A,$,D,B,O,z,E,U,R,K,F,M,Y,j,X,G,H,q,J,W,Z,Q,ee,te;return{setters:[e=>{a=e.S,o=e.d,n=e.X,i=e.Y,s=e.Z,r=e.$,l=e.a0,d=e.a1,c=e.F,u=e.t,p=e.V,f=e.a2,g=e.a3,h=e.q,m=e.a4,w=e._,y=e.o,b=e.x,v=e.A,k=e.v,I=e.a5,x=e.a6,C=e.B,_=e.y,T=e.z,P=e.a7,S=e.a8,L=e.a9,V=e.h,N=e.f,A=e.k,$=e.D,D=e.I,B=e.j,O=e.i,z=e.l,E=e.m,U=e.aa,R=e.ab,K=e.K,F=e.ac,M=e.M,Y=e.ad,j=e.ae,X=e.N,G=e.af,H=e.ag,q=e.ah,J=e.r,W=e.c,Z=e.w,Q=e.b,ee=e.u},e=>{te=e.s}],execute:function(){var t=document.createElement("style");t.textContent=".input-boxes[data-v-5cf02301]{height:70px;border:1px solid #ccc;border-radius:5px;width:50%;font-family:Nimbus Sans L,Arial Narrow,sans-serif;font-size:2.2em;background-color:#dcdcdc;color:#000;padding:8px}.main[data-v-5cf02301]{width:100%;text-align:center;margin-top:5%;display:table}.keyboard[data-v-5cf02301]{text-align:center;position:absolute;background-color:#fff;width:100%;border:1px solid rgb(204,204,204);word-wrap:normal!important;margin:0 auto;max-width:300px;left:0;right:0}.rows[data-v-5cf02301]{display:table-row;line-height:1px}.cells[data-v-5cf02301]{display:table-cell}.keyboard-btn[data-v-5cf02301]{border:1px solid #7eb9d0;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:5px!important;font-size:1.6vw!important;font-family:arial,helvetica,sans-serif;text-decoration:none;display:inline-block;text-shadow:-1px -1px 0 rgba(0,0,0,.3);font-weight:700;color:#fff;background-color:#a7cfdf;background-image:-webkit-gradient(linear,left top,left bottom,from(#a7cfdf),to(#23538a));background-image:-webkit-linear-gradient(top,#a7cfdf,#23538a);background-image:-moz-linear-gradient(top,#a7cfdf,#23538a);background-image:-ms-linear-gradient(top,#a7cfdf,#23538a);background-image:-o-linear-gradient(top,#a7cfdf,#23538a);background-image:linear-gradient(to bottom,#a7cfdf,#23538a);filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=#a7cfdf,endColorstr=#23538a);max-width:85px;max-height:85px;cursor:pointer;text-align:center;margin:3px;width:8vw;height:8vh;overflow:hidden;white-space:nowrap}@media screen and (max-width: 600px){.keyboard-btn[data-v-5cf02301]{font-size:10px!important}}@media screen and (min-width: 1020px){.keyboard-btn[data-v-5cf02301]{font-size:25px!important}}.login-btn[data-v-5cf02301]{background-image:-webkit-gradient(linear,left top,left bottom,from(green),to green);background-image:-webkit-linear-gradient(top,green,green);background-image:-moz-linear-gradient(top,green,green);background-image:-ms-linear-gradient(top,green,green);background-image:-o-linear-gradient(top,green,green);background-image:linear-gradient(to bottom,green,green);filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=green,endColorstr=green)}.input-rows[data-v-5cf02301]{line-height:140px}#coat[data-v-5c9fa721]{width:8vw;height:8vw}#pepfar[data-v-5c9fa721]{width:6vw;height:6vw}.devices[data-v-5c9fa721]{background-color:var(--ion-color-primary);color:#fff;border:1px solid lightblue;font-size:1.3em;padding:1rem;margin-right:.5rem}.devices>option[data-v-5c9fa721]{background:#fff;color:#000}\n",document.head.appendChild(t);const ae=te("IndexedDBStorage"),oe=[{key:"villages",endpoint:"villages"},{key:"traditional_authorities",endpoint:"traditional_authorities"},{key:"districts",endpoint:"districts"},{key:"regions",endpoint:"regions"},{key:"locations",endpoint:"locations"}],ne=o({props:{useVirtualInput:{type:Boolean}},data:function(){return{LOGIN_KEYBOARD:n,auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new i,s.clearScreenTimeout()},setup(){const{facilityName:e,district:t}=m();return{facilityName:e,district:t}},methods:{renderKeyBoard(e){this.focusInput=e.currentTarget,"password"==this.focusInput.id?this.btnCaption="Login":this.btnCaption="Next";let t=e.currentTarget.getBoundingClientRect().top;t=parseInt(t),this.keyboardTop=t+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(e){const t=e.currentTarget.id;let a;try{t.match(/Del./i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):t.match(/Next/i)?(this.display="none",a=this.$refs.password,a.click()):t.match(/Login/i)?(this.display="none",this.doLogin()):t.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",a="username"===this.focusInput.id?this.$refs.username:this.$refs.password,a.click()):t.match(/Hide/i)?this.display="none":this.focusInput.value+=t,"username"==this.focusInput.id?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(o){console.warn("input error")}},doLogin:async function(){if(this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!(await this.auth.checkTimeIntegrity()))throw"Local date does not match API date. Please Update your device's date";if(await this.auth.login(this.userInput.password),this.auth.startSession(),r.value=!1,(await l.create({message:"Loading metadata, this may take a while...",backdropDismiss:!1})).present(),await async function(){for(const t of oe)if(!(await ae.existsinStorage(t.key)))try{const e=await a.getJson(t.endpoint,{paginate:!1});ae.saveToStorage(t.key,e)}catch(e){console.warn(`Issue loading/saving metadata ${t}: ${e}`)}}(),l.getTop().then((e=>e&&l.dismiss())),(await Promise.all([this.auth.passwordPolicyEnabled(),this.auth.passwordExpired()])).every(Boolean)){const e=e=>`${e.value}`.toLowerCase();return d([{id:"new_password",proxyID:"password",helpText:"Change your password",type:c.TT_TEXT,init:()=>(setTimeout((()=>{u("Your password has expired! please change it now!",8e3)}),500),!0),computedValue:t=>e(t),validation:t=>p.validateSeries([()=>p.required(t),()=>p.hasLengthRangeOf(t,4,15),()=>{if(`${this.userInput.password}`.toLowerCase()===e(t))return["New password should not match old password"]}]),config:{inputType:"password"}},{id:"verify_password",proxyID:"password",helpText:"Confirm Password",type:c.TT_TEXT,computedValue:t=>e(t),validation:(t,a)=>p.validateSeries([()=>p.required(t),()=>{if(e(a.verify_password)!=e(a.new_password))return["New password does not match current password"]}]),config:{inputType:"password"}}],{onFinish:async(e,t)=>{await f.updateUser(this.auth.userID,t)?(await this.auth.resetUserPasswordChangeCheck(),this.$router.push("/select_hc_location")):u("Unable to update user")}})}this.$router.push("/select_hc_location")}catch(e){e instanceof g?u("Invalid username or password"):h("Unable to login. Please contact your local administrator for assistance",5e4)}}else u("Complete form to log in")}},computed:{btnStyles(){return`display: ${this.display}; top: ${this.keyboardTop};`}}}),ie={class:"main",ref:"main"},se={class:"cells ion-padding-bottom"},re=(e=>(S("data-v-5cf02301"),e=e(),L(),e))((()=>v("b",{style:{color:"#8b4513"}},"Facility: ",-1))),le={style:{color:"#cd853f"}},de={class:"rows"},ce={class:"cells"},ue=["readonly"],pe={class:"rows input-rows"},fe={class:"cells"},ge=["readonly"],he={class:"rows"},me=["id"],we=["id"],ye=o({name:"login",components:{IonItem:V,Inputs:w(ne,[["render",function(e,t,a,o,n,i){return y(),b(C,null,[v("div",ie,[v("div",se,[v("h3",null,[re,v("b",le,k(e.facilityName)+" ("+k(e.district)+")",1)])]),v("div",de,[v("div",ce,[I(v("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":t[0]||(t[0]=t=>e.userInput.username=t),onClick:t[1]||(t[1]=t=>e.renderKeyBoard(t)),class:"input-boxes",readonly:e.useVirtualInput},null,8,ue),[[x,e.userInput.username]])])]),v("div",pe,[v("div",fe,[I(v("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.userInput.password=t),type:"password",name:"password",ref:"password",id:"password",onClick:t[3]||(t[3]=t=>e.renderKeyBoard(t)),class:"input-boxes",placeholder:"Password",readonly:e.useVirtualInput},null,8,ge),[[x,e.userInput.password]])])])],512),v("div",{id:"keyboard",style:P(e.btnStyles),class:"keyboard"},[(y(!0),b(C,null,_(e.LOGIN_KEYBOARD,((a,o)=>(y(),b("span",{key:o},[v("div",he,[(y(!0),b(C,null,_(a,(a=>(y(),b("div",{class:"cells",key:a},["Next"===a||"Login"===a?(y(),b("button",{key:0,id:e.btnCaption,class:"keyboard-btn login-btn",onClick:t[4]||(t[4]=t=>e.keyPress(t))},k(e.btnCaption),9,me)):T("",!0),"Login"!=a&&"Next"!=a?(y(),b("button",{key:1,id:e.Caps.on?a.toUpperCase():a.toLowerCase(),class:"keyboard-btn",onClick:t[5]||(t[5]=t=>e.keyPress(t))},k("Del."===a||"Caps"===a?a:e.Caps.on?a.toUpperCase():a.toLowerCase()),9,we)):T("",!0)])))),128))])])))),128))],4)],64)}],["__scopeId","data-v-5cf02301"]]),IonButton:N,IonTitle:A,IonLabel:$,IonPage:D,IonHeader:B,IonToolbar:O,IonContent:z,IonFooter:E,IonSelect:U,IonSelectOption:R},setup(){const e=K([]),{activePlatformProfile:t,platformProfiles:a}=F(),o=K(""),n=K(""),s=M((()=>t.value.keyboard===Y.HIS_KEYBOARD_ONLY)),r=Object.keys(a.value).map((e=>({label:e,value:{profileName:e,...a.value[e]}})));return j(n,(e=>{t.value=(q.find(r,{label:e})||{}).value})),X((async()=>{const a=new i;e.value=(await a.loadConfig())?.otherApps||[];const s=a.getHeadVersion();a.setActiveVersion(s);const r=await a.getApiVersion();o.value=`${s} / ${r}`,n.value=t.value?.profileName||""})),{version:o,profile:n,otherApps:e,deviceProfiles:r,useVirtualInputOnly:s,activePlatformProfile:t,coatImg:G("login-logos/Malawi-Coat_of_arms_of_arms.png"),pepfarImg:G("login-logos/PEPFAR.png"),showConfig:"true"===localStorage.getItem("useLocalStorage"),openSelect:async()=>{const t=await H("Application Selection","Please specify the application you wish to use",e.value.map((e=>e.name)),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(t.selection&&"Cancel"!=t.action){const a=e.value.find((e=>e.name===t.selection));window.open(`${a.protocol||"http"}://${a.IP}:${a.port||80}`,"_blank")}}}}}),be=e=>(S("data-v-5c9fa721"),e=e(),L(),e),ve=be((()=>v("b",{style:{color:"#8b4513"}},"National ",-1))),ke=be((()=>v("b",{style:{color:"#cd853f"}},"EMR",-1))),Ie={slot:"start"},xe=["src"],Ce=["src"];e("default",w(ye,[["render",function(e,t,a,o,n,i){const s=J("ion-label"),r=J("ion-title"),l=J("ion-toolbar"),d=J("ion-header"),c=J("inputs"),u=J("ion-content"),p=J("ion-select-option"),f=J("ion-select"),g=J("ion-button"),h=J("ion-item"),m=J("ion-footer"),w=J("ion-page");return y(),W(w,null,{default:Z((()=>[Q(d,null,{default:Z((()=>[Q(l,null,{default:Z((()=>[Q(r,null,{default:Z((()=>[Q(s,{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:Z((()=>[ve,ke])),_:1})])),_:1}),Q(s,{class:"ion-padding",slot:"end"},{default:Z((()=>[ee(" Version: "),v("b",null,k(e.version),1)])),_:1})])),_:1})])),_:1}),Q(u,{fullscreen:"false",style:{}},{default:Z((()=>[Q(c,{useVirtualInput:e.useVirtualInputOnly},null,8,["useVirtualInput"])])),_:1}),Q(m,null,{default:Z((()=>[Q(l,null,{default:Z((()=>[v("span",Ie,[v("img",{id:"coat",src:e.coatImg,alt:"Malawi Coat of Arms logo"},null,8,xe),v("img",{id:"pepfar",src:e.pepfarImg,alt:"PEPFAR logo"},null,8,Ce)]),Q(h,{class:"his-sm-text",style:{width:"75%"},slot:"end"},{default:Z((()=>[Q(s,null,{default:Z((()=>[ee("Device Profile")])),_:1}),Q(f,{modelValue:e.profile,"onUpdate:modelValue":t[0]||(t[0]=t=>e.profile=t),value:e.profile},{default:Z((()=>[(y(!0),b(C,null,_(e.deviceProfiles,((e,t)=>(y(),W(p,{key:t,value:e.label},{default:Z((()=>[ee(k(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue","value"]),Q(g,{color:"dark",fill:"outline",size:"large",slot:"end","router-link":"/settings/host"},{default:Z((()=>[ee(" Network ")])),_:1}),e.otherApps.length?(y(),W(g,{key:0,color:"dark",fill:"outline",size:"large",slot:"end",onClick:e.openSelect},{default:Z((()=>[ee(" Other Applications ")])),_:1},8,["onClick"])):T("",!0)])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-5c9fa721"]]))}}}));
