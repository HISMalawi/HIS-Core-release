System.register(["./index-legacy-CNrLGT3P.js","./hts_items_given-legacy-Bl6xMErS.js","./testKits-legacy-DYvG61Vg.js","./HisStandardForm-legacy-OekRIZB_.js"],(function(e,t){"use strict";var l,a,i,s,n,o,r,u,d,c,m,b,v,_,f,h,p,y,g,I,T,E,S,V;return{setters:[e=>{l=e.d,a=e.I,i=e.K,s=e.dF,n=e.F,o=e.n,r=e.ah,u=e.dG,d=e.ct,c=e.aW,m=e.bf,b=e.bg,v=e.t,_=e.b4,f=e._,h=e.r,p=e.o,y=e.c,g=e.w,I=e.b},e=>{T=e.H},e=>{E=e.T,S=e.K},e=>{V=e.H}],execute:function(){const t=l({components:{IonPage:a,HisStandardForm:V},setup(){const e=i([]),t=new T(-1),{visitID:l,htsClient:a,getEncounter:f,saveEncounter:h,patientDashboardUrl:p}=s({onInitVisit:()=>{e.value=[{id:"items_given_to_client_selection",helpText:"Items given to the client",type:n.TT_ADHERENCE_INPUT,isRequired:()=>!0,appearInSummary:()=>!1,beforeNext:async e=>!(e.every((e=>""===e.value||parseInt(`${e.value}`)<=0))&&!(await o("Are you sure you want to proceed without giving items to client ?"))),validation:e=>e.some((e=>/self-test/i.test(e.label)&&parseInt(`${e.value}`)>3))?["Cannot distribute more than 3 Self-test kits. Please adjust the number accordingly"]:e.some((e=>/male condoms/i.test(e.label.toLowerCase())&&parseInt(`${e.value}`)>99))?["Cannot distribute more than 99 Male Condoms. Please adjust the number accordingly"]:e.some((e=>"Female condoms"==e.label&&parseInt(`${e.value}`)>99))?["Cannot distribute more than 99 Female Condoms. Please adjust the number accordingly"]:e.some((e=>/frs/i.test(e.label.toLowerCase())&&parseInt(`${e.value}`)>5))?["Cannot distribute more than 5 FRS. Please adjust the number accordingly"]:null,options:e=>r.isEmpty(e.items_given_to_client_selection)?[{label:"Self-Test Kit",value:""},{label:"Male condoms",value:""},{label:"Female condoms",value:""},{label:"FRS",value:""}]:e.items_given_to_client_selection,config:{noFloat:!0,titles:{label:"Item",value:"Quantity"}}},{id:"items_given_to_client",helpText:"Items given",type:n.TT_HIDDEN,summaryMapValue:e=>({label:`${e.label} given`,value:e.value}),defaultValue:e=>e.items_given_to_client_selection.every((e=>""===e.value||parseInt(`${e.value}`)<=0))?{label:"No items",value:"Yes"}:e.items_given_to_client_selection.filter((e=>parseInt(`${e.value}`)>0)),finalComputedValue:e=>Array.isArray(e)?{obs:e.map((e=>t.buildValueNumber(e.label,parseInt(`${e.value}`))))}:{obs:t.buildValueCoded("None","Yes")}},{id:"self_test_kits",helpText:"Self-test kit users",type:n.TT_INPUT_ARRAY,isRequired:()=>!0,condition:e=>e.items_given_to_client.some((e=>/self-test/i.test(e.label)&&parseInt(`${e.value}`)>0)),finalComputedValue:e=>({obs:e.map((e=>e.other.fields)).map((async e=>{const[t,...l]=e.filter((e=>"function"==typeof e.other.obs)).map((e=>e.other.obs(e.value,e)));return{...await t,child:await Promise.all(l)}}))}),summaryMapValue:e=>e.other.fields.map((e=>{const t={...e};return"Age"===t.label&&t?.other?.estimate&&(t.value=`${t.value} (Estimated)`),t})),validation:e=>{const t=e.map((e=>e.other.fields)),l=t.some((e=>{const t=e.filter((e=>""!=e.value)).length;return t>0&&t<4}));if(l)return["Some rows have incomplete data!"];const a=t.some((e=>e.some((e=>""===e.value))));return a?["Some rows are missing data"]:null},config:{columns:[{label:"End-User"},{label:"Sex"},{label:"Age"},{label:"Approach"},{label:"Result"}]},options:e=>{const i=(e,t,l,a)=>{e.forEach((e=>{if("function"==typeof e?.other?.broadcastlistener){const i=e.other.broadcastlistener(t,l,a);i&&(e.value=i.value,e.disabled=i.disabled)}}))},s=()=>({label:"User",value:"",other:{obs:e=>t.buildValueCoded("Self-test end user",e),onclick:async(e,t,a,s,n)=>{const o=[];if(!/Self/.test(JSON.stringify(n.filter(((e,t)=>t!=a))))){const e=f("Testing"),t=e?`${e?.hiv_result}`:await async function(e){return await _.getFirstValueCoded(l.value,e)||"Unknown"}("HIV status");/positive/.test(t.toLowerCase())||o.push("Self")}m([...o,"Sexual partner","Other"],(l=>{i(t,"User",l,e.value),e.value=l}),{title:"Select End-User",preset:null!=e?e.value:"",size:"small-modal"})}}}),n=y(e),o=(e=n)=>Array.from({length:e},(()=>({label:"item",value:"N/A",other:{fields:[s(),{label:"Sex",value:"",other:{broadcastlistener:(e,t,l)=>{if("User"===e){if("Self"===t)return{value:"M"===a.gender?"Male":"Female",disabled:!0};if("Self"===l)return{value:"",disabled:!1}}},obs:e=>t.buildValueCoded("Gender of contact",e),onclick:e=>{m(["Female","Male"],(t=>e.value=t),{title:"Select sex",size:"small-modal",preset:null!=e?e.value:""})}}},{label:"Age",value:"",other:{broadcastlistener:(e,t)=>{if("User"===e)return"Self"===t?{value:`${a.age}`,disabled:!0}:{value:"",disabled:!1}},obs:(e,l)=>{const a=parseInt(e);return l?.other?.estimate?t.buildNumericEstimate("Age of contact",a):t.buildValueNumber("Age of contact",a)},onclick:e=>{b(((t,l)=>{if(t&&parseInt(`${t}`)>=125)return e.value="",v("Age exceeds maximum human life expectancy of 124 years");e.value=t,e.other.estimate=l}),{title:"Age",preset:" ",toggleButton:"Age is estimated?",noFloat:!0,strictNumbers:!0})}}},{label:"Approach",value:"",other:{broadcastlistener:(e,t)=>{if("User"===e)return"Self"!=t?{value:"Un-assisted",disabled:!0}:{value:"",disabled:!1}},obs:e=>t.buildValueCoded("Self-test approach",e),onclick:(e,t)=>{m(["Directly-assisted","Un-assisted"],(l=>{i(t,"Approach",l,e.value),e.value=l}),{title:"Select approach",size:"small-modal",preset:null!=e?e.value:""})}}},{label:"Result",value:"N/A",other:{obs:e=>{if(e&&!/n\/a/i.test(`${e}`))return t.buildValueCoded("Test 1",e)},onclick:(e,t)=>{m(["Negative","Positive","N/A"],(l=>{i(t,"Result",l,e.value),e.value=l}),{title:"Directly-assisted HIV Result"})}}}]}})));return Array.isArray(e.self_test_kits)?y(e)<e.self_test_kits.length?e.self_test_kits.slice(0,y(e)):y(e)>e.self_test_kits.length?[...e.self_test_kits,...o(y(e)-e.self_test_kits.length)]:e.self_test_kits:o()}},g()]}});function y(e){return e.items_given_to_client&&Array.isArray(e.items_given_to_client)&&r.find(e.items_given_to_client,{label:"Self-Test Kit"})?.value||0}function g(){const{initKits:e,getLotNo:l,getExpiryDate:a}=E();return{id:"test_kit",helpText:"Kit information",type:n.TT_INPUT_ARRAY,config:{columns:[{label:"Kit Name"},{label:"Kit Lot No."},{label:"Kit Expiry Date"}]},init:async()=>(await e(),!0),isRequired:()=>!0,summaryMapValue:e=>e?.other?.fields,validation:e=>e.map((e=>e.other.fields)).some((e=>e.some((e=>""===e.value))))?["Some rows are missing data"]:null,condition:e=>y(e)>=1&&!l(S.HIV_SELF_KIT),finalComputedValue:e=>({obs:e.map((e=>e.other.fields)).map((async e=>{const[t,...l]=e.filter((e=>"function"==typeof e.other.obs)).map((e=>e.other.obs(e)));return{...await t,child:await Promise.all(l)}}))}),defaultOutput:e=>{if(y(e)>=1&&l(S.HIV_SELF_KIT))return Array.from({length:y(e)}).map((()=>({label:S.HIV_SELF_KIT,value:l(S.HIV_SELF_KIT),other:{fields:[{label:"Kit name",value:S.HIV_SELF_KIT,other:{obs:()=>t.buildValueText("Kit name",S.HIV_SELF_KIT)}},{label:"KitLot No.",value:l(S.HIV_SELF_KIT),other:{obs:()=>t.buildValueText("Kit lot number",l(S.HIV_SELF_KIT))}},{label:"Kit Expiry date",value:a(S.HIV_SELF_KIT),other:{obs:()=>t.buildValueDate("kit expiry date",a(S.HIV_SELF_KIT))}}]}})))},options:async e=>{if(null!=e.test_kit)return e.test_kit;const i=y(e),s=(e=i)=>Array.from({length:e},(()=>({label:"",value:"",other:{fields:[{label:"Kit Name",value:S.HIV_SELF_KIT,other:{obs:e=>t.buildValueText("Kit name",e.value),onclick:(e,t,l,a,i)=>{u({id:"name",helpText:"Kit Name",type:n.TT_TEXT,isRequired:()=>!0},(t=>{e.value=t.value,0===l&&i.forEach((t=>{t.other.fields.forEach((t=>{/name/i.test(t.label)&&""===t.value&&(t.value=e.value)}))}))}))}}},{label:"Kit Lot No.",value:l(S.HIV_SELF_KIT),other:{obs:e=>t.buildValueNumber("Kit lot number",e.value),onclick:(e,t,l,a,i)=>{u({id:"lot",helpText:"Enter Lot Number",type:n.TT_TEXT,isRequired:()=>!0},(t=>{e.value=t.value,0===l&&i.forEach((t=>{t.other.fields.forEach((t=>{/lot/i.test(t.label)&&""===t.value&&(t.value=e.value)}))}))}))}}},{label:"Kit Expiry Date",value:a(S.HIV_SELF_KIT),other:{obs:e=>t.buildValueDate("kit expiry date",e.value),onclick:(e,l,a,i,s)=>{u({id:"end_user",helpText:"Kit Expiry Date",type:n.TT_FULL_DATE,isRequired:()=>!0,validation:e=>new Date(e.label)<new Date(t.date)?["Expiry date cannot be less than current date "+d(t.date)]:c(e.label).diff(t.date,"month")<=2?["It's not advisable to use a test kit that will expire in less than 2 months"]:null},(t=>{e.value=t.value,0===a&&s.forEach((t=>{t.other.fields.forEach((t=>{/expiry/i.test(t.label)&&""===t.value&&(t.value=e.value)}))}))}))}}}]}})));return Array.isArray(e.test_kit)?i<e.test_kit.length?e.test_kit.slice(0,i):i>e.test_kit.length?[...e.test_kit,...s(i-e.test_kit.length)]:e.test_kit:s()}}}return{patientDashboardUrl:p,onFinish:function(e,l){h({encounterName:"ITEMS GIVEN",encounterTypeID:t.encounterTypeID,computedData:l})},fields:e}}});e("default",f(t,[["render",function(e,t,l,a,i,s){const n=h("his-standard-form"),o=h("ion-page");return p(),y(o,null,{default:g((()=>[I(n,{formLabel:"Items Given",fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:e.patientDashboardUrl()},null,8,["fields","onFinishAction","cancelDestinationPath"])])),_:1})}]]))}}}));
