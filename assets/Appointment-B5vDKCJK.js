import{d as h,ai as y,bH as w,ao as d,aP as c,g as A,aj as D,H as _,af as b,ak as v,a as g,c as $}from"./index-DUHy09-D.js";import{H as E}from"./HisStandardForm-D4x6GRNw.js";import{_ as F}from"./EncounterMixin.vue_vue_type_script_lang-BBWQMIB9.js";import{A as u}from"./appointment_service-BNzdtO9A.js";import{A as m}from"./anc_global_props-DZjmdCl5.js";import"./encounter_guidelines-BSirIoFm.js";import"./GuidelineEngine-D6V1_Znr.js";const P=h({mixins:[F],components:{HisStandardForm:E},data:()=>({appointment:{}}),watch:{ready:{handler(a){a&&(this.appointment=new u(this.patientID,this.providerID),this.fields=[this.getAppointmentField()])},immediate:!0}},methods:{async onFinish(a,s){await this.appointment.createEncounter(),await this.appointment.saveObservationList(await this.resolveObs(s)),this.nextTask()},getAppointmentField(){const a=t=>_.toStandardHisDisplayFormat(t),s=(t,e)=>new RegExp(t,"i").test("".concat(e));let r="",p="",i=-1,l=this.appointment.date,n=null;const o={},f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return{id:"set_appointment",helpText:"Appointments booking",type:y.TT_DATE_PICKER,init:async()=>{try{const e=await this.appointment.getNextAppointment();l=e.appointment_date,n=e.drugs_run_out_date}catch(e){if(console.warn(e),await w(400),!await d("Next appointment/drug-runout date is not available, do you want to proceed anyway?"))return this.gotoPatientDashboard(),!0}const t=await m.appointmentLimit();return i=t?parseInt(t):0,!0},onValue:async t=>{if(o[t]===void 0){const e=await u.getDailiyAppointments(t);o[t]=Array.isArray(e)?e.length:0}return!(i>=1&&o[t]>=i&&await d("".concat(o[t]," clients were booked on ").concat(a(t)),{header:"APPOINTMENT LIMIT (".concat(i,") REACHED"),cancelBtnLabel:"Proceed",confirmBtnLabel:"New date"})||(c.isEmpty(p)&&(p=await m.clinicHolidays()),s(t,p)&&!await d("".concat(a(t)," is a clinic holiday, do you want to set an appointment?")))||(c.isEmpty(r)&&(r=await m.clinicDays()),!s(f[A(t).day()],r)&&!await d("".concat(a(t)," is not a clinic day. Do you want to proceed with this date?"))))},validation:t=>D.required(t),defaultValue:()=>l,computedValue:t=>[this.appointment.buildValueDate("Appointment date",t),this.appointment.buildValueDate("Estimated date",l)],config:{hiddenFooterBtns:["Clear"],minDate:()=>this.appointment.date,maxDate:()=>n,supValue:t=>"".concat(o[t]),infoItems:t=>[{label:"Medication Run out Date",value:n?a(n):"Not available"},{label:"User set appointment date",value:a(t)},{label:"Appointments",value:o[t]},{label:"Appointment limit (per/day)",value:i}]}}}}});function T(a,s,r,p,i,l){const n=v("his-standard-form");return g(),$(n,{fields:a.fields,onFinishAction:a.onFinish,skipSummary:!0,cancelDestinationPath:a.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}const V=b(P,[["render",T]]);export{V as default};
