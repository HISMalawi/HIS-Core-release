import{d as m,r as u,ao as d,bI as T,an as o,u as N,a as D,w as _,e as v,f as c,m as y,b as g,e8 as h,a_ as w,q as M,aD as b}from"./index-qFt4YszW.js";import{H as E}from"./HisStandardForm-B3LOSMqB.js";import{u as x}from"./useEncounter-Bj5eamVf.js";import{I as W}from"./identifier_service-CnmJOKYk.js";import"./isEmpty-1LErKKNT.js";import"./encounter_guidelines-CLmFwnI6.js";import"./GuidelineEngine-D6V1_Znr.js";const B=m({__name:"NationalID",setup(S){const r=u([]),i=u(),n=N(),l=()=>!/unknown/i.test(i.value.getMWNationalID()),{goToNextTask:p,patientDashboardUrl:f}=x((t,s,a)=>{i.value=a,r.value=[{id:"currentNationalID",helpText:"Current national identifier:",type:d.TT_TEXT_BANNER,condition:()=>!n.query.reassign&&l(),options:()=>{const e="<b>".concat(a.getMWNationalID(),"</b>");return[{label:e,value:e}]}},{id:"patientIdentifier",helpText:"Malawi National ID",type:d.TT_TEXT,defaultValue:()=>l()?a.getMWNationalID():"",validation:e=>o.validateSeries([()=>o.required(e),()=>o.isMWNationalID(e)]),config:{customKeyboard:T}}]});async function I(t){const s="".concat(t.patientIdentifier.value),a=new W;if(a.identifierType=h.MW,!w.isEmpty(await a.getPatientsByIdentifier(s)))return M("ID was already assigned",15e3);if(n.query.reassign){const e=parseInt("".concat(n.query.reassign));await i.value.changeMwNationalId(e,t.patientIdentifier.value)}else await i.value.updateMWNationalId(t.patientIdentifier.value);b.invalidate("ACTIVE_PATIENT"),p()}return(t,s)=>(g(),D(c(y),null,{default:_(()=>[v(E,{cancelDestinationPath:c(f),onFinishAction:I,fields:r.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{B as default};
