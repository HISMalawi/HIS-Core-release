System.register(["./index-legacy-BiNmSRfH.js","./EncounterMixin.vue_vue_type_script_lang-legacy-Da0kN4ru.js","./RiskFactorModal-legacy-ZGd68S5z.js","./htn_service-legacy-DkbncBjx.js","./vitals_service-legacy-DaPrbpTy.js","./encounter_guidelines-legacy-Ct5w19z6.js","./GuidelineEngine-legacy-KsvQuFdF.js","./HisStandardForm-legacy-Bllf5xqT.js"],(function(t,e){"use strict";var a,n,s,i,o,r,l,c,u,d,h,p,g,f,m,y,b,k,T,w,D,I,_,v,C,P,H,F,B,N,R,x,A,V,S,O,E,$,j,U,z,G,M,Y,L,q,Z,K,J,Q;return{setters:[t=>{a=t.d,n=t.ay,s=t.ah,i=t.a7,o=t.n,r=t.l,l=t.ad,c=t.dy,u=t.ds,d=t.k,h=t.ac,p=t.b5,g=t.I,f=t.a4,m=t.m,y=t.a5,b=t.aw,k=t.ar,T=t.s,w=t.al,D=t.am,I=t.bh,_=t.q,v=t.a_,C=t.z,P=t.aZ,H=t.H,F=t.bm,B=t.bn,N=t.bd,R=t.U,x=t.br,A=t.S,V=t.ak,S=t.a,O=t.w,E=t.ap,$=t.b,j=t.e,U=t.g,z=t.h,G=t.a6,M=t.t,Y=t.j,L=t.a9,q=t.aa},t=>{Z=t._},t=>{K=t.R},t=>{J=t.B},t=>{Q=t.V},null,null,null],execute:function(){const e={background:"#444444"},W=a({mixins:[Z],components:{IonCheckbox:k,DataTable:b,IonTitle:y,IonToolbar:m,IonHeader:f,IonContent:g,IonGrid:p,IonRow:h,IonButton:d,IonRadioGroup:u,IonRadio:c,IonCol:l,IonFooter:r,IonPage:o,IonItem:i,IonLabel:s},data:()=>({htn:{},hasARVNumber:!0,suggestedNumber:"",columns:[[n.thTxt("Date",{style:e}),n.thTxt("Systolic",{style:e}),n.thTxt("Diastolic",{style:e}),n.thTxt("BP Drugs",{style:e}),n.thTxt("Action / Note",{style:e})]],bpGradeColorMap:{"N/A":"#ffffff",normal:"#ffffff","grade 1":"#FFC3CE","grade 2":"#F20056","grade 3":"#FF3333"},rows:[],riskFactors:[],action:null,trail:[],date:null,patientOnBPDrugs:!1,patientFirstVisit:!1,normatensive:!1,patientHasHyperTensionObs:!1,currentDrugs:[],items:[],isEnrolledInHTN:!1,isAliveOnHTN:!1,HTNProgramID:20,aliveState:160,refer:!1,onBpDrugActions:[],noneBpActions:[]}),watch:{ready:{async handler(t){if(!t)return;const e=await x.create({message:"Please wait...",backdropDismiss:!1});await e.present(),this.htn=new J(this.patientID,this.providerID),this.trail=await this.htn.getBPTrail(),this.rows=this.formatBpTrailRows(this.trail),this.normatensive=J.isBpNormotensive(this.trail),this.riskFactors=await this.getRiskFactors(),this.date=H.toStandardHisDisplayFormat(A.getSessionDate()),await this.isTransfered(),await this.hasHyperTenstion(),await this.getTreatmentStatus(),await this.getProgramStatus(),x.dismiss(),this.patientFirstVisit&&this.patientOnBPDrugs&&await this.alertTransferIn(),this.setBpActions()},immediate:!0}},computed:{totalRiskFactors(){return this.riskFactors.filter((t=>"Yes"===t.value)).length},showClinicianButton:()=>!(R.isClinician()&&R.isDoctor())},methods:{setBpActions(){this.onBpDrugActions=[{label:"Continue drugs",value:"on treatment",other:{action:()=>this.$router.push(`/art/encounters/bp_adherence/${this.patientID}`)}},{label:"Medication not available",value:"on treatment",other:{action:()=>this.$router.push(`/art/encounters/bp_adherence/${this.patientID}`)}},{label:"Review drugs",value:"on treatment",other:{action:()=>this.$router.push(`/art/encounters/bp_adherence/${this.patientID}?review=true`)}}],this.noneBpActions=[{label:"Lifestyle advice given",value:"Lifestyle changes only",isChecked:!1},{label:"Patient declining BP drugs ",value:"Symptomatic but not in treatment",isChecked:!1},...(()=>this.normatensive?[{label:"Return to annual screening",value:"Alive"}]:[])(),{label:"Start anti hypertensives",value:"On treatment",other:{action:()=>this.$router.push(`/art/encounters/bp_prescription/${this.patientID}`)}}]},async onFinish(){if(this.noneBpActions.some((t=>t.isChecked))||this.action||this.refer){if(!(await this.htn.createEncounter()))return T("Unable to create encounter");if(this.refer){if(!(await this.htn.saveValueCodedObs("Refer patient to clinician","Yes")))return T("Unable to create Obs");this.gotoPatientDashboard()}else{if(this.currentDrugs.length){await this.htn.saveValueTextObs("Plan",this.action.label);const t={state:this.action.value};await this.htn.enrollPatient(t)}else{const t=this.noneBpActions.filter((t=>t.isChecked));if(t.length){const e=t.map((t=>this.htn.saveValueTextObs("Plan",t.label)));await Promise.all(e)}}const t=this.noneBpActions.filter((t=>t.isChecked&&"function"==typeof t.other?.action));if(t.length)return t.forEach((t=>t.other.action()));if("function"==typeof this.action?.other?.action)return this.action.other.action();this.nextTask()}}else T("Please select an action")},referPatient(){this.refer=!0,this.onFinish()},goToDiagnosis(){return this.$router.push({path:`/art/encounters/hypertension_diagnosis/${this.patientID}`})},async hasHyperTenstion(){const t=await B.getFirstValueCoded(this.patientID,"Patient has hypertension");this.patientHasHyperTensionObs=!!`${t}`.match(/yes|no/i)},async isTransfered(){const t=await B.getFirstValueCoded(this.patientID,"Transferred");this.patientFirstVisit=!t},async getTreatmentStatus(){const t=await B.getFirstValueText(this.patientID,"Treatment status");this.patientOnBPDrugs=!(!t||!t.match(/BP Drugs started/i))},async getProgramStatus(){const t=await N.getPatientPrograms(this.patientID);this.isEnrolledInHTN=t.filter((t=>"HYPERTENSION PROGRAM"===t.program.name)).length>0,this.isEnrolledInHTN&&await this.programState()},async programState(){const t=await N.getPatientStates(this.patientID,this.HTNProgramID);this.isAliveOnHTN=t.filter((t=>"Alive"===t.name)).length>0},async getRiskFactors(){const t=F.getConceptsByCategory("risk factors").map((async t=>{const e=await B.getFirstValueCoded(this.patientID,t.name);return{concept:t.name,value:e}}));return Promise.all(t)},formatBpTrailRows(t){return Object.keys(t).map((e=>{const a=H.toStandardHisDisplayFormat(e);this.currentDrugs=this.currentDrugs.concat(t[e].drugs);const s={background:(()=>{const a=J.getBpGrade(parseInt(t[e].sbp),parseInt(t[e].dbp));return this.bpGradeColorMap[a]})()};return[n.tdDate(a,{style:s}),n.td(t[e].sbp,{style:s}),n.td(t[e].dbp,{style:s}),n.td(t[e].drugs.join(", "),{style:s}),n.td(t[e].note,{style:s})]}))},async showRiskFactors(){const t=await C.create({component:K,backdropDismiss:!1,cssClass:"large-modal",componentProps:{factors:this.riskFactors}});t.present();const{data:e}=await t.onDidDismiss();P.isEmpty(e)||(this.riskFactors=e.map((t=>{const e=!0===t.isChecked?"Yes":"No";return{concept:t.concept,value:e}})))},async alertTransferIn(){"Yes"===await v("Transfer in","Does the patient want to transfer in for HTN management?","",[{name:"Yes",slot:"end",color:"success"},{name:"No",slot:"start",color:"danger"}])?(await this.enrollInHTN(),await this.setHtnTransferred("Yes"),this.patientFirstVisit=!1,this.setBpActions()):(await this.setHtnTransferred("No"),this.nextTask())},async enrollInHTN(){PopupKeyboard({id:"enrollment_date",helpText:"HTN Enrollment date",type:D.TT_FULL_DATE,validation:t=>w.required(t)},(async t=>{try{const e=new I(this.patientID);e.setProgramId(this.HTNProgramID),e.setProgramDate(`${t.value}`),e.setStateDate(`${t.value}`),e.setStateId(this.aliveState),await e.enrollProgram(),await e.updateState(),this.isEnrolledInHTN=!0,_("Patient is now enrolled in HTN")}catch(e){console.error(e),T(`${e}`)}}))},async setHtnTransferred(t){const e=new Q(this.patientID,this.providerID);await e.createEncounter()?await e.saveValueCodedObs("Transferred",t)||T("Unable to create observation Transferred for patient"):T("Unable to create patient transfer encounter")}}}),X={key:0,style:{color:"green"}},tt={slot:"end"};t("default",V(W,[["render",function(t,e,a,n,s,i){const o=E("ion-title"),r=E("ion-button"),l=E("ion-toolbar"),c=E("ion-header"),u=E("data-table"),d=E("ion-content"),h=E("ion-radio"),p=E("ion-label"),g=E("ion-item"),f=E("ion-col"),m=E("ion-row"),y=E("ion-grid"),b=E("ion-radio-group"),k=E("ion-checkbox"),T=E("ion-footer"),w=E("ion-page");return $(),S(w,null,{default:O((()=>[j(c,null,{default:O((()=>[j(l,null,{default:O((()=>[j(o,null,{default:O((()=>[U("span",null,"BP management screening on "+M(t.date),1),t.patientOnBPDrugs?($(),z("small",X," (Patient already on BP drugs)")):G("",!0)])),_:1}),U("span",tt,[t.totalRiskFactors>0?($(),S(r,{key:0,color:"danger",onClick:t.showRiskFactors},{default:O((()=>[Y("View/Edit risk factors "+M(t.totalRiskFactors),1)])),_:1},8,["onClick"])):G("",!0),0===t.totalRiskFactors?($(),S(r,{key:1,onClick:t.showRiskFactors},{default:O((()=>[...e[1]||(e[1]=[Y("add riskfactors",-1)])])),_:1},8,["onClick"])):G("",!0)])])),_:1})])),_:1}),j(d,null,{default:O((()=>[j(u,{config:{showIndex:!1},columns:t.columns,rows:t.rows},null,8,["columns","rows"])])),_:1}),j(T,null,{default:O((()=>[t.currentDrugs.length?($(),S(l,{key:0},{default:O((()=>[e[2]||(e[2]=U("h1",{style:{"text-align":"center"}},"Actions",-1)),j(b,{modelValue:t.action,"onUpdate:modelValue":e[0]||(e[0]=e=>t.action=e)},{default:O((()=>[j(y,null,{default:O((()=>[j(m,null,{default:O((()=>[($(!0),z(L,null,q(t.onBpDrugActions,((t,e)=>($(),S(f,{key:e},{default:O((()=>[j(g,{lines:"none"},{default:O((()=>[j(h,{style:{"margin-right":"10px"},value:t},null,8,["value"]),j(p,{style:{"font-size":"1.0rem","font-weight":"bold"}},{default:O((()=>[Y(M(t.label),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):($(),S(l,{key:1},{default:O((()=>[j(y,null,{default:O((()=>[j(m,null,{default:O((()=>[j(f,null,{default:O((()=>[...e[3]||(e[3]=[U("h1",{style:{"text-align":"center"}},"Actions",-1)])])),_:1})])),_:1}),j(m,null,{default:O((()=>[($(!0),z(L,null,q(t.noneBpActions,((t,e)=>($(),S(f,{key:e},{default:O((()=>[j(g,{lines:"none"},{default:O((()=>[j(k,{style:{"margin-right":"10px"},modelValue:t.isChecked,"onUpdate:modelValue":e=>t.isChecked=e},null,8,["modelValue","onUpdate:modelValue"]),j(p,null,{default:O((()=>[Y(M(t.label),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})),j(l,{color:"dark"},{default:O((()=>[j(r,{size:"large",color:"danger",slot:"start",onClick:t.gotoPatientDashboard},{default:O((()=>[...e[4]||(e[4]=[Y(" cancel ",-1)])])),_:1},8,["onClick"]),t.showClinicianButton?($(),S(r,{key:0,size:"large",color:"danger",slot:"start",onClick:t.referPatient},{default:O((()=>[...e[5]||(e[5]=[Y(" Refer to clinician ",-1)])])),_:1},8,["onClick"])):G("",!0),t.patientHasHyperTensionObs?G("",!0):($(),S(r,{key:1,size:"large",slot:"end",onClick:t.goToDiagnosis},{default:O((()=>[...e[6]||(e[6]=[Y(" Hypertension Diagnosis ",-1)])])),_:1},8,["onClick"])),t.patientHasHyperTensionObs&&!t.isEnrolledInHTN?($(),S(r,{key:2,size:"large",slot:"end",onClick:t.enrollInHTN},{default:O((()=>[...e[7]||(e[7]=[Y(" Enroll in HTN ",-1)])])),_:1},8,["onClick"])):G("",!0),t.patientHasHyperTensionObs?($(),S(r,{key:3,size:"large",color:"success",slot:"end",onClick:t.onFinish},{default:O((()=>[...e[8]||(e[8]=[Y(" Finish ",-1)])])),_:1},8,["onClick"])):G("",!0)])),_:1})])),_:1})])),_:1})}]]))}}}));
