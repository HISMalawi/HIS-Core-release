System.register(["./index-legacy-BoFMGMh4.js","./EncounterMixin.vue_vue_type_script_lang-legacy-DeDyfLNc.js","./GuidelineEngine-legacy-KsvQuFdF.js","./tb_integration_service-legacy-gR5uAsis.js"],(function(t,i){"use strict";var e,s,n,a,o,r,d,c,g,l,h,u,p,y,C;return{setters:[t=>{e=t.au,s=t.bm,n=t.bV,a=t.aA,o=t.d,r=t.al,d=t.am,c=t.dw,g=t.a$,l=t.aZ,h=t.H,u=t.c2},t=>{p=t._},t=>{y=t.m},t=>{C=t.T}],execute:function(){const i="2016-04-30",m={"Adults with stage 4 conditions":{concept:"WHO STAGE IV ADULT",priority:1,conditions:{stage:t=>4===t}},"Classify as stage 4 when reason for ART is WHO STAGE 4":{concept:"WHO STAGE IV ADULT",priority:2,conditions:{reasonForArt:t=>"WHO STAGE IV ADULT"===t}},"Adults with stage 3 conditions":{concept:"WHO STAGE III ADULT",priority:3,conditions:{stage:t=>3===t}},"Adults with stage 2 conditions":{concept:"WHO STAGE II ADULT",priority:4,conditions:{stage:t=>2===t}},"Adults with stage 1 conditions":{concept:"WHO STAGE I ADULT",priority:5,conditions:{stage:t=>1===t}}},T={"Children with stage 4 conditions":{concept:"WHO STAGE IV PEDS",priority:1,conditions:{stage:t=>4===t}},"Classify as stage 4 when reason for ART is WHO STAGE 4":{concept:"WHO STAGE IV PEDS",priority:2,conditions:{reasonForArt:t=>"WHO STAGE IV PEDS"===t}},"For children with stage 3 conditions":{concept:"WHO STAGE III PEDS",priority:3,conditions:{stage:t=>3===t}},"Children with stage 2 conditions":{concept:"WHO STAGE II PEDS",priority:4,conditions:{stage:t=>2===t}},"Children with stage 1 conditions":{concept:"WHO STAGE I PEDS",priority:5,conditions:{stage:t=>1===t}}},b={"Warn if Severe weight loss is selected when actual patient BMI is acceptable":{priority:1,actions:{alert:async t=>await e(`Patient's BMI of ${t.bmi} greater than 18.5, do you wish to proceed?`,{confirmBtnLabel:"Yes, keep severe weightloss",cancelBtnLabel:"No, cancel"})},conditions:{selectedCondition:t=>"Severe weight loss >10% and/or BMI <18.5kg/m^2, unexplained"===t,bmi:t=>t>18.5}},"Warn for contradicting stage defining conditions":{priority:1,actions:{alert:async t=>!!(await e("CONTRADICTING STAGE DEFINING CONDITIONS",{confirmBtnLabel:"Keep Asymptomatic",cancelBtnLabel:"Keep other(s)"}))&&(t.stage=1,t.selectedConditions=[],t.stageThreeConditions=[],t.stageFourConditions=[],t.stageTwoConditions=[],!0)},conditions:{selectedCondition:t=>"Asymptomatic HIV infection"===t,stage:t=>t>=2}}},w={"Enable TB staging condition if client is TB positive":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered as a TB Patient in the TB Module"},conditions:{tbPositive:t=>t,selectedCondition:t=>/\bTuberculosis \(PTB or EPTB\)|\bPulmonary tuberculosis/i.test(t)}},"Enable TB staging condition if client is EPTB positive":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered with EPTB in TB Module"},conditions:{eptbPositive:t=>t,selectedCondition:t=>/Extrapulmonary tuberculosis/i.test(t)}},"For children whose current weight percentile is less than 70":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:t=>`Child has a low weight percentile of ${t.weightPercentile}`},conditions:{selectedCondition:t=>"Severe unexplained wasting or malnutrition not responding to treatment (weight-for-height/ -age <70% or MUAC less than 11cm or oedema)"===t,weightPercentile:t=>t<70}},"Enable Moderate unexplained malnutrition for children whose weight for height is 70-79%":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:t=>`Child has weight percentile of ${t.weightPercentile}`},conditions:{selectedCondition:t=>"Moderate unexplained wasting/malnutrition not responding to treatment (weight-for-height/ -age 70-79% or muac 11-12 cm)"===t,weightPercentile:t=>t>=70&&t<=79}},"Disable moderate weight loss when Severe unexplained weight loss is chosen":{priority:2,actions:{isChecked:!1,disabled:!0},description:{color:"secondary",show:"always",info:()=>"Severe weight loss/manutrition was already selected"},conditions:{selectedCondition:t=>"Moderate unexplained wasting/malnutrition not responding to treatment (weight-for-height/ -age 70-79% or muac 11-12 cm)"===t,selectedConditions:t=>t.includes("Severe unexplained wasting or malnutrition not responding to treatment (weight-for-height/ -age <70% or MUAC less than 11cm or oedema)")}}},S={"Enable TB staging condition if client is TB positive":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered Positive in TB Module"},conditions:{tbPositive:t=>t,selectedCondition:t=>/\bTuberculosis \(PTB or EPTB\)/i.test(t)}},"Enable TB staging condition if client is TB Pulmonary":{priority:2,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered Pulmonary TB in the TB Module"},conditions:{tbPositive:t=>t,eptbPositive:t=>!t,selectedCondition:t=>/\bPulmonary tuberculosis/i.test(t)}},"Enable TB staging condition if client is EPTB positive":{priority:3,actions:{isChecked:!0},description:{color:"danger",show:"always",info:()=>"Client registered with EPTB in TB Module"},conditions:{eptbPositive:t=>t,selectedCondition:t=>/Extrapulmonary tuberculosis/i.test(t)}},"Adults with a BMI less than 16":{priority:1,actions:{isChecked:!0},description:{color:"danger",show:"always",info:t=>`Adult has a low BMI of ${t.bmi}`},conditions:{selectedCondition:t=>"Severe weight loss >10% and/or BMI <18.5kg/m^2, unexplained"===t,bmi:t=>t<16}},"Adults whose BMI is between 16 and 18":{priority:3,actions:{isChecked:!0},description:{color:"warning",show:"onChecked",info:t=>`BMI of ${t.bmi} is between 16 and 18`},conditions:{selectedCondition:t=>"Moderate weight loss less than or equal to 10 percent, unexplained"===t,bmi:t=>t>=16&&t<=18.5}},"Disable Moderate weight loss if severe weightloss is selected":{priority:2,actions:{isChecked:!1,disabled:!0},description:{color:"secondary",show:"always",info:()=>"Severe weight loss was already selected"},conditions:{selectedCondition:t=>"Moderate weight loss less than or equal to 10 percent, unexplained"===t,selectedConditions:t=>t.includes("Severe weight loss >10% and/or BMI <18.5kg/m^2, unexplained")}}},f={"Children under twelve months who tested positive on Rapid test and have presumed severe HIV":{concept:"PRESUMED SEVERE HIV",priority:1,conditions:{ageInMonths:t=>t<12,selectedConditions:t=>s.getConceptsByCategory("pshd_condition").some((i=>t.includes(i.name))),testType:t=>"HIV rapid test"===t}},"Has stage 4 conditions":{concept:"WHO STAGE IV PEDS",priority:2,conditions:{stage:t=>4===t}},"Has stage 3 conditions":{concept:"WHO STAGE III PEDS",priority:3,conditions:{stage:t=>3===t}},"Children under twelve who tested positive via HIV DNA Polymerase Chain Reaction test":{concept:"HIV DNA polymerase chain reaction",priority:4,conditions:{ageInMonths:t=>t<12,testType:t=>"HIV DNA polymerase chain reaction"===t}},"Children who are less than 24 months":{concept:"HIV infected",priority:5,conditions:{ageInMonths:t=>t<24}},"Children between 24 and 56 months who have stage 2 or 1 conditions":{concept:"CD4 COUNT LESS THAN OR EQUAL TO 750",priority:6,conditions:{ageInMonths:t=>t>=24&&t<=56,cd4Date:t=>new Date(t)<=new Date(i),cd4:t=>t<=750,cd4Modifier:t=>"<"===t||"="===t,stage:t=>t<=2}},"Children with CD4 count less than 500 and have stage 1 and stage 2 conditions":{concept:"CD4 COUNT LESS THAN OR EQUAL TO 500",priority:7,conditions:{cd4:t=>t<=500,cd4Date:t=>new Date(t)<=new Date(i),cd4Modifier:t=>"<"===t||"="===t,stage:t=>t<=2}},"Children who are more than five years old and have cd4 count less than 500":{concept:"CD4 COUNT LESS THAN OR EQUAL TO 500",priority:9,conditions:{cd4Date:t=>new Date(t)<=new Date(i),age:t=>t>5,cd4:t=>t<=500,cd4Modifier:t=>"<"===t||"="===t}},"Children over date 2014-04-01 and less than Five years old":{concept:"HIV infected",priority:10,conditions:{date:t=>t>="2014-04-01",age:t=>t<=5}},"Women who are breast feeding":{concept:"BREASTFEEDING",priority:11,conditions:{gender:t=>"F"===t,breastFeeding:t=>"Yes"===t,stage:t=>t<=2}},"Women who are pregnant":{concept:"PATIENT PREGNANT",priority:12,conditions:{gender:t=>"F"===t,pregnant:t=>"Yes"===t,stage:t=>t<=2}},"Asymptomatic patient with either stage one or stage two conditions":{concept:"Asymptomatic",priority:13,conditions:{stage:t=>t<=2}}},A={"Has stage 4 conditions":{concept:"WHO STAGE IV ADULT",priority:1,conditions:{stage:t=>4===t}},"Has HIV wasting syndrome identified in stage 3":{concept:"WHO STAGE IV ADULT",priority:2,conditions:{selectedConditions:t=>s.getConceptsByCategory("severe_hiv_wasting_syndrome").reduce(((i,e)=>t.includes(e.name)?i+1:0),0)>=2}},"Has stage 3 conditions":{concept:"WHO STAGE III ADULT",priority:3,conditions:{stage:t=>3===t}},"CD4 less than 350 for adults before 2014":{concept:"cd4 less than or equal to 350",priority:4,conditions:{cd4Date:t=>new Date(t)<=new Date(i),cd4:t=>t<=350,cd4Modifier:t=>"<"===t||"="===t}},"CD4 less than 250 for adults after 2014":{concept:"cd4 less than or equal to 250",priority:4,conditions:{cd4Date:t=>new Date(t)<=new Date(i),cd4:t=>t<=250,cd4Modifier:t=>"<"===t||"="===t}},"CD4 less than 350 for adults after 2014":{concept:"cd4 less than or equal to 350",priority:5,conditions:{cd4Date:t=>new Date(t)<=new Date(i),cd4:t=>t<=350,cd4Modifier:t=>"<"===t||"="===t}},"CD4 less than 500 for adults after 2014":{concept:"cd4 less than or equal to 500",priority:6,conditions:{cd4Date:t=>new Date(t)<=new Date(i),cd4:t=>t<=500,cd4Modifier:t=>"<"===t||"="===t}},"Women who are breast feeding":{concept:"BREASTFEEDING",priority:8,conditions:{gender:t=>"F"===t,breastFeeding:t=>"Yes"===t,stage:t=>t<=2}},"Women who are pregnant":{concept:"PATIENT PREGNANT",priority:7,conditions:{gender:t=>"F"===t,pregnant:t=>"Yes"===t,stage:t=>t<=2}},"Asymptomatic patient with either stage one or stage two conditions":{concept:"Asymptomatic",priority:9,conditions:{stage:t=>t<=2}}};class F extends n{age;confirmatoryTest;constructor(t,i,e){super(t,52,e),this.age=i,this.confirmatoryTest=null}isAdult(){return this.age>=15}isPedaid(){return this.age<=14}setAge(t){this.age=t}getFacilities(t=""){return a.getFacilities({name:t})}getConfirmatoryTestType(){return this.confirmatoryTest}cd4CountIsValid(t){try{return!!t.match(/^(=|<|>)([0-9]*)$/m)}catch(i){return!1}}getAlertGuidelines(){return b}getWhoStageGuidelines(){return this.isAdult()?m:T}getProgramEligibilityGuidelines(){return this.isAdult()?A:f}getRecommendedConditionGuidelines(){return this.isAdult()?S:w}getStagingConditions(t){const i=this.getStagingCategoryByNum(t);return n.getConceptsByCategory(i)}buildWhoStageObs(t){return this.buildValueCoded("Who stage",t)}buildWhoCriteriaObs(t){return this.buildValueCoded("Who stages criteria present",t)}buildReasonForArtObs(t){return this.buildValueCoded("Reason for ART eligibility",t)}getStagingCategoryByNum(t){switch(t){case 1:return this.isAdult()?"stage_1_conditions_adults":"stage_1_conditions_pedaids";case 2:return this.isAdult()?"stage_2_conditions_adults":"stage_2_conditions_pedaids";case 3:return this.isAdult()?"stage_3_conditions_adults":"stage_3_conditions_pedaids";case 4:return this.isAdult()?"stage_4_conditions_adults":"stage_4_conditions_pedaids";default:return""}}async loadHivConfirmatoryTestType(){const t=await n.getFirstValueCoded(this.patientID,"Confirmatory hiv test type");t&&(this.confirmatoryTest=t)}}t("_",o({mixins:[p],data:()=>({staging:{},showStagingWeightChart:!0,canShowStagingFields:!0,bmiObj:{},stagingFacts:{age:-1,bmi:-1,gender:"",stage:-1,cd4:-1,cd4Date:"",date:"",isChildBearing:!1,stageOneConditions:[],stageTwoConditions:[],stageThreeConditions:[],stageFourConditions:[],tbPositive:!1,eptbPositive:!1,reasonForArt:"",testType:"",pregnant:"",breastFeeding:"",selectedCondition:"",selectedConditions:[],weightPercentile:-1,ageInMonths:-1,cd4Modifier:"",whoStage:""}}),watch:{ready:{handler(t){t&&(this.staging=new F(this.patient.getID(),this.patient.getAge(),this.providerID))},immediate:!0}},methods:{async initStaging(t){await this.staging.loadHivConfirmatoryTestType(),this.bmiObj=await t.getBMI(),this.stagingFacts.age=t.getAge(),this.stagingFacts.bmi=this.bmiObj.index,this.stagingFacts.date=F.getSessionDate(),this.stagingFacts.gender=t.isMale()?"M":"F",this.stagingFacts.testType=this.staging.getConfirmatoryTestType(),this.stagingFacts.ageInMonths=t.getAgeInMonths(),this.stagingFacts.isChildBearing=t.isChildBearing();const i=new C(this.patientID);await i.loadTbProgram(),i.isOnTreatment&&(this.stagingFacts.tbPositive=i.isPositive,this.stagingFacts.eptbPositive=i.isEptbPositive),this.staging.isPedaid()&&(this.stagingFacts.weightPercentile=await t.calculateWeightPercentile())},async submitStaging(t){if(!(await this.staging.createEncounter()))throw"Unable to create staging encounter";const i=await this.resolveObs(t,"staging"),e=await Promise.all([this.buildReasonForArtObs(),this.buildWhoStageObs()]);if(!(await this.staging.saveObservationList([...i,...e])))throw"Unable to save patient observations"},async onStagingCondition({label:t}){this.stagingFacts.selectedCondition=t;const i=this.staging.getAlertGuidelines(),e=y(this.stagingFacts,i);return!!l.isEmpty(e)||(!e[0]?.actions||!e[0]?.actions.alert||!!(await(e[0]?.actions.alert(this.stagingFacts))))},getFacilities:(t="")=>u(t),updateStagingFacts(){const t=[this.stagingFacts.stageOneConditions,this.stagingFacts.stageTwoConditions,this.stagingFacts.stageThreeConditions,this.stagingFacts.stageFourConditions];this.stagingFacts.stage=t.reduce(((t,i,e)=>l.isEmpty(i)?t:e+1),0),this.stagingFacts.selectedConditions=t.reduce(((t,i)=>t.concat(i)),[])},buildReasonForArtObs(){return this.staging.buildReasonForArtObs(this.stagingFacts.reasonForArt)},buildWhoStageObs(){return this.staging.buildWhoStageObs(this.stagingFacts.whoStage)},buildStagingOptions(t,i=[]){const e=this.staging.getRecommendedConditionGuidelines();return this.staging.getStagingConditions(t).map((t=>{let s,n=!1,a=i.includes(t.name);this.stagingFacts.selectedCondition=t.name;const o=y(this.stagingFacts,e);if(!l.isEmpty(o)){const t=o[0];t?.actions?.isChecked&&(a=!0),t?.actions?.disabled&&(n=!0),s=t.description}return{label:t.name,value:t.concept_id,isChecked:a,disabled:n,description:s}}))},setWhoStage(){const t=this.staging.getWhoStageGuidelines(),i=y(this.stagingFacts,t);this.stagingFacts.whoStage=i[0]?.concept||""},setReasonForArt(){const t=this.staging.getProgramEligibilityGuidelines(),i=y(this.stagingFacts,t);this.stagingFacts.reasonForArt=i[0]?.concept||""},notAsymptomatic(t){const i=t.stage_1_conditions;if(i){const t=i.filter((t=>t.label.match(/asymptomatic/i)&&t.isChecked));return l.isEmpty(t)}return!0},hasTransferLater:t=>"has_transfer_letter"in t&&t.has_transfer_letter&&"Yes"===t.has_transfer_letter.value,hasStaging(t){return!!this.hasTransferLater(t)||this.canShowStagingFields},getStagingSummaryField(t="Summary"){return{id:"summary",helpText:t,type:d.TT_ART_STAGING_SUMMARY,condition:t=>this.hasStaging(t),onload:()=>{this.setReasonForArt(),this.setWhoStage()},options:()=>[{label:"WHO Stage",value:this.stagingFacts.whoStage,other:{type:"title-section"}},{label:"Condition on starting ART",value:this.stagingFacts.reasonForArt,other:{type:"title-section"}},...(()=>this.stagingFacts.cd4>-1?[{label:"CD4 Result",value:`${this.stagingFacts.cd4Modifier}${this.stagingFacts.cd4}`,other:{type:"title-section"}}]:[])(),...this.stagingFacts.selectedConditions.map((t=>({label:t,value:t})))],config:{title:"Selected stage defining conditions",hiddenFooterBtns:["Clear"],helpText:"Patient groups with advanced HIV disease include:<br><br>                    - All children <5 years old are considered to have advanced HIV disease until they are clinically stable with a suppressed VL on ART<br>                     - CD4 < 200 cells/ml before ART initiation / while on ART.<br>                     - WHO stage 3 or 4<br>                     - Every ART experienced patient with viral load 1000+ (on ART for > 1 year)<br>",helpTitle:"CD4 Results"}}},isANCclient:()=>"ANC"===F.getSuspendedProgram(),getStagingFields(){return[{id:"pregnancy_status",helpText:"Pregnant / Breastfeeding",type:d.TT_MULTIPLE_YES_NO,validation:t=>r.anyEmpty(t),summaryMapValue:t=>({label:t.label,value:t.value}),computedValue:(t,i)=>{let e=[];return this.isANCclient()&&!this.hasTransferLater(i)&&(this.stagingFacts.pregnant="Yes",e.push(this.staging.buildValueCoded("Is patient pregnant","Yes"))),e=e.concat(t.map((t=>{const{value:i,other:e}=t,s=e.factID;return this.stagingFacts[s]=`${i}`.match(/Yes/i)?"Yes":"No",this.staging.buildValueCoded(e.concept,i)}))),{obs:e,tag:"staging"}},options:t=>{if(l.isEmpty(t.pregnancy_status)){const i=[];return this.isANCclient()&&!this.hasTransferLater(t)||i.push({label:"Pregnant?",value:"",other:{values:this.yesNoOptions(),concept:"Is patient pregnant",factID:"pregnant"}}),i.push({label:"Breastfeeding?",value:"",other:{values:this.yesNoOptions(),concept:"Is patient breast feeding",factID:"breastFeeding"}}),i}return t.pregnancy_status},condition:t=>this.hasStaging(t)&&this.stagingFacts.isChildBearing},{id:"patient_weight_chart",helpText:"Weight history",type:d.TT_WEIGHT_CHART,options:async()=>{let t=await this.patient.getWeightHistory();return t=t.map((t=>({x:h.toStandardHisDisplayFormat(t.date),y:t.weight}))),[{label:"Weight for patient",value:"Weight trail",other:{values:t,age:this.patient.getAge(),bmi:this.bmiObj}}]},config:{hiddenFooterBtns:["Clear"]},condition:t=>this.hasStaging(t)&&this.showStagingWeightChart},{id:"stage_4_conditions",helpText:"Stage 4 conditions",type:d.TT_MULTIPLE_SELECT,options:()=>this.buildStagingOptions(4,this.stagingFacts.stageFourConditions),onValue:t=>this.onStagingCondition(t),computedValue:t=>({tag:"staging",obs:t.map((t=>this.staging.buildWhoCriteriaObs(t.label)))}),unload:t=>{this.stagingFacts.stageFourConditions=t.map((t=>t.label)),this.updateStagingFacts()},onConditionFalse:()=>{this.stagingFacts.stageFourConditions=[],this.updateStagingFacts()},condition:t=>this.hasStaging(t)&&this.notAsymptomatic(t)},{id:"stage_3_conditions",helpText:"Stage 3 conditions",type:d.TT_MULTIPLE_SELECT,options:()=>this.buildStagingOptions(3,this.stagingFacts.stageThreeConditions),onValue:t=>this.onStagingCondition(t),computedValue:t=>({tag:"staging",obs:t.map((t=>this.staging.buildWhoCriteriaObs(t.label)))}),unload:t=>{this.stagingFacts.stageThreeConditions=t.map((t=>t.label)),this.updateStagingFacts()},onConditionFalse:()=>{this.stagingFacts.stageThreeConditions=[],this.updateStagingFacts()},condition:t=>this.hasStaging(t)&&this.notAsymptomatic(t)},{id:"stage_2_conditions",helpText:"Stage 2 conditions",type:d.TT_MULTIPLE_SELECT,options:()=>this.buildStagingOptions(2,this.stagingFacts.stageTwoConditions),onValue:t=>this.onStagingCondition(t),computedValue:t=>({tag:"staging",obs:t.map((t=>this.staging.buildWhoCriteriaObs(t.label)))}),unload:t=>{this.stagingFacts.stageTwoConditions=t.map((t=>t.label)),this.updateStagingFacts()},onConditionFalse:()=>{this.stagingFacts.stageTwoConditions=[],this.updateStagingFacts()},condition:t=>this.hasStaging(t)&&this.notAsymptomatic(t)},{id:"stage_1_conditions",helpText:"Stage 1 conditions",type:d.TT_MULTIPLE_SELECT,validation:t=>{if(l.isEmpty(t)&&l.isEmpty(this.stagingFacts.selectedConditions))return["Please provide atleast one staging condition"]},options:()=>this.buildStagingOptions(1,this.stagingFacts.stageOneConditions),onValue:t=>this.onStagingCondition(t),computedValue:t=>{const i=t.map((t=>t.label));return this.stagingFacts.stageOneConditions=i,this.updateStagingFacts(),{tag:"staging",obs:i.map((t=>this.staging.buildWhoCriteriaObs(t)))}},condition:t=>this.hasStaging(t)},{id:"cd4_available",helpText:"Recent CD4 count results available?",type:d.TT_SELECT,condition:t=>this.hasStaging(t),validation:t=>r.required(t),options:()=>this.yesNoOptions(),config:{helpText:"Recent CD4 count results from the previous visit or from the last 3-6 months. <br><br>                        Do routine CD4 count for all adults and children 5+ years before/when starting ART if CD4 testing is available at the site. <br><br>                        Do Targeted CD4 count for patients with suspected clinical and/or confirmed treatment failure (VL). <br><br>                        See more in section 10.3 of the HIV Clinical Guidelines",helpTitle:"CD4 Count"}},{id:"cd4_count",helpText:"CD4 Count",type:d.TT_TEXT,computedValue:t=>{const i=t.value.toString(),e=i.charAt(0),s=parseInt(i.substring(1));return{tag:"staging",modifier:e,count:s,obs:this.staging.buildValueNumber("CD4 count",s,e)}},unload:(t,i,e,s)=>{const{count:n,modifier:a}=s.cd4_count;this.stagingFacts.cd4=n,this.stagingFacts.cd4Modifier=a},onConditionFalse:()=>{this.stagingFacts.cd4=-1,this.stagingFacts.cd4Modifier=""},validation:t=>{const i=()=>this.staging.cd4CountIsValid(t.value);return this.validateSeries([()=>r.required(t),()=>i()?null:["Please start with either modifier first: >, <, or ="],()=>parseInt(`${t?.value}`.substring(1))>1e4?["Invalid CD4 count value."]:null])},config:{customKeyboard:[c,[["Unknown","Delete"]]]},condition:t=>this.hasStaging(t)&&"Yes"===t.cd4_available.value},...g({id:"cd4_result_date",helpText:"Cd4 Results",required:!0,minDate:()=>this.patient.getBirthdate(),maxDate:()=>this.staging.getDate(),condition:t=>this.hasStaging(t)&&"Yes"===t.cd4_available.value,estimation:{allowUnknown:!1},computeValue:(t,i)=>(this.stagingFacts.cd4Date=t,{date:t,tag:"staging",isEstimate:i,obs:this.staging.buildValueDate("Cd4 count datetime",t)})}),{id:"location",helpText:"CD4 Location",type:d.TT_SELECT,defaultValue:()=>F.getLocationName(),computedValue:({label:t})=>({tag:"staging",obs:this.staging.buildValueText("Cd4 count location",t)}),validation:t=>r.required(t),options:(t,i="")=>this.getFacilities(i),config:{showKeyboard:!0,isFilterDataViaApi:!0},condition:t=>this.hasStaging(t)&&"Yes"===t.cd4_available.value}]}}}))}}}));
