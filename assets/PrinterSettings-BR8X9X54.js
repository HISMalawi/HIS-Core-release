import{F as n}from"./dynamic-import-helper-Bsjrd6Ro.js";import{H as a}from"./HisStandardForm-CxcKR3FF.js";import{d as o,ae as l,ab as h,t as f,q as c,_ as d,r as u,o as m,c as p}from"./index-BPESSmpp.js";import{l as r}from"./overlays-04a9a43f-pvrUHYCC.js";import"./TouchScreenForm-BjDI66hA.js";import"./ToolbarMediumCard-DnRdVW_r.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-DixuDTZA.js";const v=o({components:{HisStandardForm:a},data(){return{printFieldContext:null,printerService:{},defaultPrinter:{},refreshKey:0,fields:[],refreshInterval:null,isRefreshingDevices:!1}},async mounted(){this.printerService=new l,this.defaultPrinter=await this.printerService.getDefaultPrinter()||{},this.fields=this.getFields()},unmounted(){this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{async onFinish(){this.$router.back()},isDefaultPrinter(e){return e.name&&this.defaultPrinter.name?e.name===this.defaultPrinter.name:e.deviceID===this.defaultPrinter.deviceID},sortPrinters(e){return e.sort((i,t)=>this.isDefaultPrinter(i)&&!this.isDefaultPrinter(t)?-1:!this.isDefaultPrinter(i)&&this.isDefaultPrinter(t)?1:(i.name||i.deviceID).localeCompare(t.name||t.deviceID))},defaultPrinterStyle(){const e=[];return h.isEmpty(this.defaultPrinter)||e.push({indexes:[0],class:"adherence-txt-good adherence-col-bg bold"}),e},getFields(){return[{id:"printer_settings",helpText:"Printer Settings",type:n.TT_TABLE_VIEWER,config:{hiddenFooterBtns:["Clear"],footerBtns:[{name:"Refresh",size:"large",slot:"end",color:"warning",visible:!0,onClick:async()=>{if(this.isRefreshingDevices)return f("Please wait...");if(this.printFieldContext){(await r.create({backdropDismiss:!1,message:"Please wait..."})).present(),this.isRefreshingDevices=!0;try{await this.printFieldContext.init()}catch(e){c("".concat(e))}this.isRefreshingDevices=!1,r.dismiss()}}}]},init:()=>{this.refreshInterval=setInterval(async()=>{this.printFieldContext&&!this.isRefreshingDevices&&(this.isRefreshingDevices=!0,await this.printFieldContext.init(),this.isRefreshingDevices=!1)},5e3)},onload:e=>{this.printFieldContext=e},options:async()=>{const e=await this.printerService.getAllPrinters(),i=this.sortPrinters(e);return[{other:{rowColors:this.defaultPrinterStyle(),columns:["Available Devices"],rows:i.map(t=>[t.name||t.deviceID,{type:"button",name:"Test Printer",action:()=>this.printerService.printTestLbl(t)},this.isDefaultPrinter(t)?"Default Printer":{type:"button",name:"Set as Default",visible:!this.isDefaultPrinter(t),action:()=>{this.printerService.setDefaultPrinter(t),this.defaultPrinter=t,this.refreshKey=Math.random()*1e4}}])}}]}}]}}});function P(e,i,t,D,g,y){const s=u("his-standard-form");return m(),p(s,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!0,key:e.refreshKey},null,8,["fields","onFinishAction"])}const b=d(v,[["render",P]]);export{b as default};
