System.register(["./index-legacy-CHWOUhn2.js"],(function(e,t){"use strict";var i,n,a,s,d,o,l,r,c,u,h,m,p,g,f,I,k,C,D,b,y,w,_,N,A,$,V,E,P,x,z;return{setters:[e=>{i=e.d,n=e.I,a=e.e,s=e.f,d=e.g,o=e.h,l=e.i,r=e.j,c=e.k,u=e.l,h=e.m,m=e.n,p=e.t,g=e.p,f=e.P,I=e.H,k=e.q,C=e.s,D=e._,b=e.r,y=e.o,w=e.c,_=e.w,N=e.b,A=e.u,$=e.v,V=e.x,E=e.y,P=e.z,x=e.A,z=e.B}],execute:function(){const t=i({components:{IonPage:n,IonCheckbox:a,IonButton:s,IonList:d,IonItem:o,IonToolbar:l,IonHeader:r,IonTitle:c,IonContent:u,IonFooter:h},data:()=>({dde:{},ddeEnabled:!1,items:[],title:"",npid:""}),watch:{$route:{handler({params:e}){e&&(this.npid=e.npid,this.title=`Duplicates for NPID (${this.npid})`,this.init(this.npid))},deep:!0,immediate:!0}},computed:{itemsChecked(){return this.items.filter((e=>e.isChecked))}},methods:{async onAction(e,t="proceed"){if(await m(`\n                Are you sure you want to ${t}?\n            `))try{await e()}catch(i){p(`${i}`),console.error(i)}},async mergeSelected(){if(!this.itemsChecked.every((e=>e.isComplete)))return p("One or more patients have missing data. Please update them before merging.",5e3);await this.dde.postMerge(this.itemsChecked)&&(await this.dde.printNpid(this.dde.patientID),g(this.dde.patientID,this.$router))},async reassignIdentifier(e){if(!e.isComplete&&this.ddeEnabled){if(await m("Do you want to update missing information?",{header:"Incomplete Demographics"})){let t=`edit_person=${e.patientID}`;t+="&dde_reassign=true",t+=`&doc_id=${e.docID}`,this.$router.push(`/patient/registration?${t}`)}}else this.onAction((async()=>{this.ddeEnabled?await this.dde.reassignNpid(e.docID,e.patientID)&&await this.dde.printNpid(e.patientID):"function"==typeof e.assignLocalNpidAndPrint&&await e.assignLocalNpidAndPrint(),g(e.patientID,this.$router)}),"Reassign")},buildItems:e=>e.map((e=>{try{const t=new f(e);return{isChecked:!1,patientID:t.getID(),name:t.getFullName(),gender:t.getGender(),birthdate:I.toStandardHisDisplayFormat(t.getBirthdate()),curDistrict:t.getCurrentDistrict(),homeVillage:t.getHomeVillage(),docID:t.getPatientIdentifier(27),isComplete:t.patientIsComplete(),assignLocalNpidAndPrint:async()=>{await t.assignNpid(),await t.printNationalID()}}}catch(t){k("An error has occured while building data"),console.error(t)}return{isChecked:!1,patientID:"N/A",name:"N/A",gender:"N/A",birthdate:"N/A",curDistrict:"N/A",homeVillage:"N/A",docID:"N/A",isComplete:!1}})),clear(){this.items=this.items.map((e=>(e.isChecked=!1,e)))},async init(e){try{if(this.dde=new C,await this.dde.loadDDEStatus(),this.ddeEnabled=this.dde.isEnabled(),this.ddeEnabled){const{locals:t,remotes:i}=await this.dde.findNpid(e);this.items=[...this.buildItems(t),...this.buildItems(i)]}else{const t=await f.findByNpid(e);t&&(this.items=this.buildItems(t))}}catch(t){k(`${t}`,5e3)}}}}),H=x("br",null,null,-1);e("default",D(t,[["render",function(e,t,i,n,a,s){const d=b("ion-title"),o=b("ion-toolbar"),l=b("ion-header"),r=b("ion-checkbox"),c=b("ion-label"),u=b("ion-button"),h=b("ion-item"),m=b("ion-list"),p=b("ion-content"),g=b("ion-footer"),f=b("ion-page");return y(),w(f,null,{default:_((()=>[N(l,null,{default:_((()=>[N(o,null,{default:_((()=>[N(d,{class:"his-lg-text"},{default:_((()=>[A($(e.title),1)])),_:1})])),_:1})])),_:1}),N(p,null,{default:_((()=>[N(m,null,{default:_((()=>[(y(!0),V(z,null,E(e.items,((t,i)=>(y(),w(h,{class:"his-md-text",key:i},{default:_((()=>[e.ddeEnabled?(y(),w(r,{key:0,slot:"start",modelValue:t.isChecked,"onUpdate:modelValue":e=>t.isChecked=e},null,8,["modelValue","onUpdate:modelValue"])):P("",!0),N(c,{color:t.isComplete?"":"danger"},{default:_((()=>[A($(t.name)+" ("+$(t.gender)+") "+$(t.birthdate)+" ",1),H,A(" Current District: "),x("b",null,$(t.curDistrict||"Unknown"),1),A(" Home Village: "),x("b",null,$(t.homeVillage||"Unknown"),1)])),_:2},1032,["color"]),N(u,{size:"medium",onClick:()=>e.reassignIdentifier(t)},{default:_((()=>[A(" Re-Assign ")])),_:2},1032,["onClick"]),t.isComplete?P("",!0):(y(),w(u,{key:1,size:"medium",color:"warning","router-link":`/patient/registration?edit_person=${t.patientID}`},{default:_((()=>[A(" Update Missing Data ")])),_:2},1032,["router-link"]))])),_:2},1024)))),128))])),_:1})])),_:1}),N(g,null,{default:_((()=>[N(o,{color:"dark"},{default:_((()=>[N(u,{"router-link":"/",color:"danger",slot:"start",size:"large"},{default:_((()=>[A(" Cancel ")])),_:1}),e.itemsChecked.length>0?(y(),w(u,{key:0,onClick:e.clear,color:"warning",slot:"end",size:"large"},{default:_((()=>[A(" Clear ")])),_:1},8,["onClick"])):P("",!0),e.itemsChecked.length>1?(y(),w(u,{key:1,onClick:t[0]||(t[0]=t=>e.onAction(e.mergeSelected,"merge")),color:"primary",size:"large",slot:"end"},{default:_((()=>[A(" Merge ("+$(e.itemsChecked.length)+") ",1)])),_:1})):P("",!0)])),_:1})])),_:1})])),_:1})}]]))}}}));
