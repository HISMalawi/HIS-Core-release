System.register(["./HisStandardForm-legacy-lMXEnQxA.js","./index-legacy-2bdI6aeZ.js","./dynamic-import-helper-legacy-BhGHTWZn.js","./LocationFieldOptions-legacy-rcaxaZcj.js","./KbLayouts-legacy-NQmKRJpJ.js","./useEncounter-legacy-CYFfFhwE.js","./commons-legacy-9h5ikRp3.js","./TouchScreenForm-legacy-H8a4O6o5.js","./ToolbarMediumCard-legacy-EA1aA9jU.js","./Transformers-legacy-PbfCTy2a.js","./ViewPort-legacy-AULqwBLs.js","./isEmpty-legacy-BYUjhW-A.js","./encounter_guidelines-legacy-o5D8kAKR.js","./GuidelineEngine-legacy--xbEVG44.js"],(function(e,a){"use strict";var i,t,n,l,o,r,s,u,c,d,y,p,v,T,g,b,f,m;return{setters:[e=>{i=e.H},e=>{t=e.b2,n=e.d,l=e.K,o=e.V,r=e.t,s=e.o,u=e.c,c=e.cj,d=e.R,y=e.P,p=e.cz},e=>{v=e.F},e=>{T=e.g},e=>{g=e.C},e=>{b=e.u},e=>{f=e.y,m=e.r},null,null,null,null,null,null,null],execute:function(){class a extends t{constructor(e,a){super(e,104,a)}}e("default",n({__name:"Registration",setup(e){let t,n;const _=l([]),{goToNextTask:E,patientDashboardUrl:h}=b(((e,i,l)=>{n=l,t=new a(i,e),_.value=[{id:"visit_type",helpText:"Type of visit",type:v.TT_SELECT,validation:e=>o.required(e),computedValue:e=>({obs:t.buildValueCoded("Type of visit",e.value)}),options:()=>[{label:"New",value:"New patient"},{label:"Referral",value:"Referral"},{label:"Re-visiting",value:"Re-visiting"}]},{id:"referring_facility_name",helpText:"Referred from",type:v.TT_SELECT,validation:e=>o.required(e),computedValue:({label:e})=>({obs:t.buildValueText("Referred from",e)}),condition:e=>"Referral"===e.visit_type.value,options:(e,a="")=>T(a),config:{showKeyboard:!0,isFilterDataViaApi:!0}},{id:"national_id_available",helpText:"National ID Available",type:v.TT_SELECT,validation:e=>o.required(e),condition:()=>"Unknown"===n.getMWNationalID(),options:()=>f(),appearInSummary:()=>!1},{id:"national_id",helpText:"Enter National ID",type:v.TT_TEXT,validation:e=>o.isMWNationalID(e),condition:e=>"Yes"===e.national_id_available.value,beforeNext:async e=>!e.value||!(await async function(e){return!!e&&(await y.findByOtherID(p,e)).length>0}(e.value.toString()))||(r("National ID already exists"),!1),summaryMapValue:({value:e})=>({value:e,label:"National ID"}),config:{casing:"uppercase",customKeyboard:[g,[["Delete"]]]}},{id:"patient_pregnant",helpText:"Patient pregnant",type:v.TT_SELECT,validation:e=>o.required(e),computedValue:({value:e})=>({obs:t.buildValueCoded("PATIENT PREGNANT",e)}),condition:()=>n.isChildBearing(),options:()=>f()}]}));async function j(e,a){if(await async function(e){const a=e.national_id_available,i=e.national_id;a&&"Yes"===a.value&&(await n.updateMWNationalId(i.value),d.invalidate("ACTIVE_PATIENT"))}(e),!(await t.createEncounter()))return r("Unable to create registration encounter");const i=await m({...a});if(!(await t.saveObservationList(i)))return r("Unable to save observations");E()}return(e,a)=>(s(),u(i,{cancelDestinationPath:c(h),fields:_.value,onFinishAction:j},null,8,["cancelDestinationPath","fields"]))}}))}}}));
