System.register(["./HisStandardForm-legacy-BXV61qjj.js","./useEncounter-legacy-Bp6E5sCN.js","./index-legacy-Dg5P6bX-.js","./dynamic-import-helper-legacy-arUa2LZV.js","./commons-legacy-CiEua9CM.js","./util-legacy-CjANJSja.js","./TouchScreenForm-legacy-Bqug27CT.js","./ToolbarMediumCard-legacy-DWokgyDV.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-D3j1oaCn.js","./isEmpty-legacy-rdjCNuhy.js","./_Set-legacy-BL8ow4HL.js","./_setToArray-legacy-jEwcQpqP.js","./encounter_guidelines-legacy-mRSBdMQj.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,i,n,s,o,l,c,r,u,d,p,m,_,g,T,v,y,R,b,h,E,f;return{setters:[e=>{a=e.H},e=>{i=e.u},e=>{n=e.d,s=e.K,o=e.b5,l=e.cV,c=e.V,r=e.S,u=e.o,d=e.c,p=e.w,m=e.b,_=e.cl,g=e.cX,T=e.cY,v=e.ad,y=e.I,R=e.ag},e=>{b=e.F},e=>{h=e.r},e=>{E=e.g,f=e.a},null,null,null,null,null,null,null,null,null],execute:function(){e("default",n({__name:"Culture",setup(e){const t=s([]),n=new o(-1,l.LAB_RESULTS),S=s(),{goToNextTask:D,patientDashboardUrl:I,facts:C}=i(((e,a,i)=>{n.patientID=a,n.providerID=e,S.value=i,t.value=[{id:"sampleResult",helpText:"Sample Result:",type:b.TT_SELECT,validation:e=>c.required(e),computedValue:e=>[{concept_id:E("TB_STATUS"),value_coded:E(`${e.value}`),obs_datetime:n.date},{concept_id:E("BACTERIOLOGICALLY_DIAGNOSED"),value_coded:E("YES_ANSWER"),obs_datetime:n.date},{concept_id:E("PROCEDURE_TYPE"),value_coded:E("CULTURE_AND_DST"),obs_datetime:n.date},..."POSITIVE"===e.value?[{concept_id:E("TB_TYPE"),value_coded:E("PULMONARY_TB"),obs_datetime:n.date}]:[]],options:()=>[{value:"POSITIVE",label:"Culture Positive"},{value:"NEGATIVE",label:"Culture Negative"}]},{id:"treatmentType",helpText:"Select treatment drugs:",type:b.TT_SELECT,validation:e=>c.required(e),condition:e=>"POSITIVE"===e.sampleResult.value,options:()=>[{value:"FIRST_LINE",label:"Firstline Drugs"},{value:"SECOND_LINE",label:"DR TB Drugs"}]},{id:"sampleResistance",helpText:"Firstline Drug Resistance:",type:b.TT_MULTIPLE_SELECT,condition:e=>"FIRST_LINE"===e.treatmentType.value,computedValue:e=>{const t=[];return 1===e.length?t.push({concept_id:E("Resistance classification"),value_coded:E("Mono drug resistant"),obs_datetime:n.date}):e.length>1&&t.push({concept_id:E("Resistance classification"),value_coded:E("Multi drug resistant"),obs_datetime:n.date}),e.some((e=>/rif/i.test(e.label)))&&t.push({concept_id:E("Rifampicin resistance confirmed"),value_coded:E("YES_ANSWER"),obs_datetime:n.date}),[...t,...e.filter((e=>!/no resistance/i.test(`${e.value}`))).map((e=>({concept_id:E("TB_DRUG_RESISTANT"),value_coded:f(`${e.value}`),obs_datetime:n.date})))]},onValueUpdate:(e,t)=>e.map((e=>{if(t.isChecked){if(/no resistance/i.test(`${t.label}`)&&e.label!=t.label)return e.isChecked=!1,e;/no resistance/i.test(`${t.label}`)||/no resistance/i.test(`${e.label}`)&&(e.isChecked=!1)}return e})),options:()=>[{value:"Rifampicin (300mg)",label:"Rifampicin Resistant"},{value:"Isoniazid (300mg)",label:"Isoniazid Resistant"},{value:"No Resistance",label:"No Resistance"}]},(()=>{const e=[];return{id:"sampleSecondlineDrugs",helpText:"DR TB Drug Resistance:",type:b.TT_MULTIPLE_SELECT,init:async()=>{try{const t=[];(await r.getJson(`programs/${n.programID}/tb_regimen_group`,{patient:a,regimen_group:"second-line-concepts"})).forEach((a=>{t.includes(a.concept_id)||/none|other non-coded/i.test(a.name)||(t.push(a.concept_id),e.push({label:a.name,value:a.concept_id}))}))}catch(t){return!1}return!0},condition:e=>"SECOND_LINE"===e.treatmentType.value,onValueUpdate:(e,t)=>e.map((e=>{if(t.isChecked){if(/no resistance/i.test(`${t.label}`)&&e.label!=t.label)return e.isChecked=!1,e;/no resistance/i.test(`${t.label}`)||/no resistance/i.test(`${e.label}`)&&(e.isChecked=!1)}return e})),computedValue:e=>{const t=[];return 1===e.length?t.push({concept_id:E("Resistance classification"),value_coded:E("Mono drug resistant"),obs_datetime:n.date}):e.length>1&&t.push({concept_id:E("Resistance classification"),value_coded:E("Multi drug resistant"),obs_datetime:n.date}),[...t,...e.filter((e=>!/no resistance/i.test(`${e.value}`))).map((e=>({concept_id:E("TB_DRUG_RESISTANT"),value_coded:e.value,obs_datetime:n.date})))]},options:()=>[...e,{value:"No Resistance",label:"No Resistance"}]}})(),{id:"sampleResultDate",helpText:"Sample Result Date:",type:b.TT_FULL_DATE,validation:e=>c.required(e),computedValue:e=>({concept_id:E("RESULT_DATE"),value_datetime:e.value,obs_datetime:n.date})}]}));async function L(e,t){await n.createEncounter(),await n.saveObservationList(await h(t));const a={tbPositive:"POSITIVE"===e.sampleResult?.value,onTreatment:g.isOnTreatment(C.outcome),tptEligible:!g.isOnTreatment(C.outcome)&&S.value.getAge()>=0&&S.value.getAge()<T,inhResistance:(e.sampleResistance||[]).some((e=>"Isoniazid Resistant"===e.label)),rrResistance:(e.sampleResistance||[]).some((e=>"Rifampicin Resistant"===e.label))},i={"try a different examination when negative result":{title:"Negative patient",message:"Do you want to try a different examination?",yes:()=>R.push(`/tb/lab/${n.patientID}`),no:()=>R.push(I.value),mandatoryCondition:{tbPositive:e=>!e,onTreatment:e=>!e,tptEligble:e=>!e}},"go to other encounters if no drug resistance was found":{action:()=>D(),mandatoryCondition:{inhResistance:e=>!e,rrResistance:e=>!e}},"enroll in MDR program if drug resistance is found":{title:"Start drug resistance program",message:"Drug resistance has been detected, do you want to enroll patient is Drug Resistance program?",yes:async()=>{await g.enrollMDR(n.patientID),D()},no:()=>D(),eitherConditionMatch:{inhResistance:e=>e,rrResistance:e=>e}}};for(const n of Object.keys(i)){const e=i[n];let t=!0,s=!0;if(e.mandatoryCondition&&(s=Object.keys(e.mandatoryCondition).every((t=>e.mandatoryCondition[t](a[t])))),e.eitherConditionMatch&&(t=Object.keys(e.eitherConditionMatch||{}).some((t=>e.eitherConditionMatch[t](a[t])))),t&&s){if("function"==typeof e.yes&&"function"==typeof e.no)return"Yes"===await v(e.title,"",e.message,[{name:"Yes",slot:"start",color:"success"},{name:"No",slot:"start",color:"primary"}])?e.yes():e.no();if("function"==typeof e.action)return e.action()}}D()}return(e,i)=>(u(),d(_(y),null,{default:p((()=>[m(a,{cancelDestinationPath:_(I),onFinishAction:L,fields:t.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
