System.register(["./index-legacy-B5_bWIZW.js","./HisStandardForm-legacy-Bk_2V3lo.js","./EncounterMixin.vue_vue_type_script_lang-legacy-3qg1ag9R.js","./lab-legacy-BrUexagE.js","./encounter_guidelines-legacy-SSGo1c3B.js","./GuidelineEngine-legacy-KsvQuFdF.js","./lab_order_service-legacy-BOcZIoyW.js"],(function(e,t){"use strict";var s,i,a,o,r,l,n,u,d,h,T,c,p,m,b,_,v,g,y;return{setters:[e=>{s=e.d,i=e.bg,a=e.F,o=e.V,r=e.bo,l=e.ag,n=e.bp,u=e.ae,d=e.H,h=e.bk,T=e.a$,c=e.T,p=e._,m=e.r,b=e.o,_=e.c},e=>{v=e.H},e=>{g=e._},e=>{y=e.c},null,null,null],execute:function(){const t=s({mixins:[g],components:{HisStandardForm:v},data:()=>({service:{},tbTests:["Urine Lam","GeneXpert","Culture & Sensitivity","TB Microscopic Exam","FASH"],hasTBresultsWithin6Months:!1,hasCragResultsWithin6Months:!1,minTestDate:""}),watch:{ready:{async handler(e){e&&(this.service=new i(this.patientID,201,this.providerID),this.fields=this.getFields())},immediate:!0}},methods:{async onFinish(e,t){await this.service.createEncounter();const s=await Promise.all(this.resolveData(t,"obs"));await this.service.saveObservationList(s);const i=this.resolveData(t,"orders");i.length&&await y(this.patientID,this.providerID,i),this.nextTask()},resultsAvailableToday(){return{id:"results_available_today",helpText:"Will results be available today?",type:a.TT_SELECT,computedValue:e=>({obs:this.service.buildValueCoded("Results available today",e.value)}),options:()=>this.yesNoOptions(),validation:e=>o.required(e),condition:(e,t)=>this.resolveData(t,"orders").length>0}},orderTbTest(){return{id:"tb_order",helpText:"Order TB test(s)",type:a.TT_HIS_LAB_ORDER_INPUT,validation:e=>o.required(e),computedValue:e=>({orders:e.map((e=>e.other))}),condition:e=>"Inconclusive"===e.tb_result?.value||e.available_results.some((e=>/TB/i.test(e.label)&&"No"===e.value)),options:()=>this.mapStrToOptions(this.tbTests)}},orderSerumCrag(){return{id:"order_serum_crag_test",helpText:"CrAg test is required",type:a.TT_HIS_LAB_ORDER_INPUT,computedValue:e=>({orders:e.map((e=>e.other))}),validation:e=>o.required(e),condition:e=>e.available_results.some((e=>/CM/i.test(e.label)&&"No"===e.value)),options:()=>this.mapStrToOptions(["Serum Crag"])}},csfResultsAvailable(){return{id:"csf_crag_result_available",helpText:"CSF CrAg Result available?",type:a.TT_SELECT,validation:e=>o.required(e),condition:e=>"Positive"===e.serum_crag_result.value,options:()=>this.yesNoOptions()}},csfCragTestLocation(){return{id:"csf_crag_test_location",helpText:"CSF CrAg test location",type:a.TT_SELECT,validation:e=>o.required(e),condition:e=>"Yes"===e.csf_crag_result_available.value,options:(e,t="")=>r(t),computedValue:e=>({obs:this.service.buildValueText("CSF CrAg test location",e.label)}),config:{showKeyboard:!0,isFilterDataViaApi:!0}}},csfCragTestDate(){return l({id:"csf_test_date",helpText:"CSF CrAg test date",required:!0,minDate:()=>this.minTestDate,maxDate:()=>this.service.date,condition:e=>"Yes"===e.csf_crag_result_available.value,computeValue:(e,t)=>({date:e,obs:this.buildDateObs("CSF CrAg test date",e,t,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:n.MONTH_ESTIMATE_FIELD}})},csfResult(){return{id:"csf_result",helpText:"CSF CrAg result",type:a.TT_SELECT,computedValue:e=>({obs:[this.service.buildValueCoded("CSF CrAg test result",e.value),this.service.buildValueCoded("Cryptococcal Meningitis status",e.value)]}),validation:e=>o.required(e),condition:e=>"Yes"===e.csf_crag_result_available.value,options:()=>this.mapStrToOptions(["Positive","Negative"])}},orderCsfCrag(){return{id:"order_csf_crag",helpText:"CrAg test is required",type:a.TT_HIS_LAB_ORDER_INPUT,computedValue:e=>({orders:e.map((e=>e.other))}),condition:e=>"No"===e.csf_crag_result_available.value,validation:e=>o.required(e),options:()=>this.mapStrToOptions(["CSF CrAg"])}},availableResultsField(){return{id:"available_results",helpText:"Results available from the last six months?",type:a.TT_MULTIPLE_YES_NO,validation:e=>o.anyEmpty(e),options:e=>[{label:"Tuberculosis (TB)",value:(e.available_results||[])[0]?.value||"",other:{values:this.yesNoOptions(),concept:"TB results from last six months available"}},{label:"Cryptococcal Meningitis(CM)",value:(e.available_results||[])[1]?.value||"",other:{values:this.yesNoOptions(),concept:"Cryptococcal Meningitis (CM) results from the last six months available"}}],computedValue:e=>({obs:e.map((({other:e,value:t})=>this.service.buildValueCoded(e.concept,t)))}),onValueUpdate:e=>(this.hasTBresultsWithin6Months=u.some(e,{value:"Yes",label:"Tuberculosis (TB)"}),this.hasCragResultsWithin6Months=u.some(e,{value:"Yes",label:"Cryptococcal Meningitis(CM)"}),e),beforeNext:()=>{if(this.hasTBresultsWithin6Months||this.hasCragResultsWithin6Months){const e=this.patient.getBirthdate(),t=d.subtract(this.service.date,"years",6);this.minTestDate=t.isBefore(e)?e:t.format("YYYY-MM-DD")}return!0}}},labInvestigationsField(){let e=[];const t=async()=>T.formatLabs(await c.get("GET_LAB_ORDERS_WITH_GIVEN_RESULT_STATUS",{patientID:this.patientID}));return{id:"patient_lab_orders",helpText:"Previous Lab orders",type:a.TT_LAB_ORDERS,init:async()=>(e=await t(),!0),unload:async()=>e=await t(),options:()=>[{label:"Lab orders",value:"order trail",other:{values:e}}],config:{printOrder:e=>new h(this.patientID).printLabOrderLbl(e),hiddenFooterBtns:["Clear"]}}},tbTestLocationField(){return{id:"tb_location",helpText:"TB test location",type:a.TT_SELECT,validation:e=>o.required(e),condition:()=>this.hasTBresultsWithin6Months,options:(e,t="")=>r(t),computedValue:e=>({obs:this.service.buildValueText("TB test location",e.label)}),config:{showKeyboard:!0,isFilterDataViaApi:!0}}},cragTestLocationField(){return{id:"serum_crag_location",helpText:"Serum crAg test location",type:a.TT_SELECT,condition:()=>this.hasCragResultsWithin6Months,validation:e=>o.required(e),options:(e,t="")=>r(t),computedValue:e=>({obs:this.service.buildValueText("Serum crAg test location",e.label)}),config:{showKeyboard:!0,isFilterDataViaApi:!0}}},tbTestDateField(){return l({id:"tb_test_date",helpText:"TB Test",required:!0,condition:()=>this.hasTBresultsWithin6Months,minDate:()=>this.minTestDate,maxDate:()=>this.service.date,computeValue:(e,t)=>({date:e,obs:this.buildDateObs("Tuberculosis test date received",e,t,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:n.MONTH_ESTIMATE_FIELD}})},tbTestResultDateField(){return l({id:"tb_test_result_date",helpText:"TB Test Result",required:!0,condition:()=>this.hasTBresultsWithin6Months,minDate:(e,t)=>t.tb_test_date.date,maxDate:()=>this.service.date,computeValue:(e,t)=>({obs:this.buildDateObs("Tuberculosis test result date",e,t,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:n.MONTH_ESTIMATE_FIELD}})},surumCragTestDate(){return l({id:"serum_crag_test_date",helpText:"Serum CrAg Test",required:!0,minDate:()=>this.minTestDate,maxDate:()=>this.service.date,condition:()=>this.hasCragResultsWithin6Months,computeValue:(e,t)=>({obs:this.buildDateObs("Serum crAg test date",e,t,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:n.MONTH_ESTIMATE_FIELD}})},serumCragResult(){return{id:"serum_crag_result",helpText:"Serum CrAg result",type:a.TT_SELECT,condition:()=>this.hasCragResultsWithin6Months,validation:e=>o.required(e),computedValue:e=>({obs:this.service.buildValueCoded("Serum crAg result",e.value)}),options:()=>this.mapStrToOptions(["Positive","Negative"])}},tbTestTypeField(){return{id:"tb_test_type",helpText:"TB Test Type",type:a.TT_SELECT,condition:()=>this.hasTBresultsWithin6Months,validation:e=>o.required(e),options:()=>this.mapStrToOptions([...this.tbTests,"Chest X-Ray","Other"]),computedValue:e=>({obs:this.service.buildValueCoded("Simple tuberculosis test type",e.value)})}},tbTestResultField(){return{id:"tb_result",helpText:"TB test result",type:a.TT_SELECT,condition:()=>this.hasTBresultsWithin6Months,validation:e=>o.required(e),computedValue:e=>({obs:this.service.buildValueCoded("TB status",e.value)}),options:()=>this.mapStrToOptions(["Positive","Negative","Inconclusive"])}},getTbClassification(){return{id:"tb_classification",helpText:"TB Classification",type:a.TT_SELECT,condition:e=>this.hasTBresultsWithin6Months&&/positive/i.test(e.tb_result?.value),validation:e=>o.required(e),options:()=>this.mapStrToOptions(["Category I TB case","Category II TB case","Category III TB case","Category IV TB case"]),computedValue:e=>({obs:this.service.buildValueCoded("TB classification",e.value)})}},getTbTreatmentStatus(){return{id:"on_tb_treatment",helpText:"On TB Treatment?",type:a.TT_SELECT,condition:e=>this.hasTBresultsWithin6Months&&/positive/i.test(e.tb_result?.value),validation:e=>o.required(e),computedValue:e=>({obs:this.service.buildValueCoded("TB treatment",e.value)}),options:()=>this.yesNoOptions()}},getTbTreatmentStartDate(){return l({id:"tb_treatment_start_date",helpText:"TB Treatment Start",condition:e=>this.hasTBresultsWithin6Months&&/Yes/i.test(e.on_tb_treatment?.value),minDate:()=>this.minTestDate,maxDate:()=>this.service.date,computeValue:(e,t)=>({obs:this.buildDateObs("TB treatment start date",e,t,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:n.MONTH_ESTIMATE_FIELD}})},getTbTreatmentPeriod(){return{id:"tb_treatment_period",helpText:"TB Treatment period (In months)",type:a.TT_NUMBER,validation:e=>o.validateSeries([()=>o.required(e),()=>o.isNumber(e),()=>o.rangeOf(e,3,9)]),condition:e=>this.hasTBresultsWithin6Months&&/Yes/i.test(e.on_tb_treatment?.value),computedValue:e=>({obs:this.service.buildValueNumber("TB treatment period",e.value)})}},ksSymptomsField(){return{id:"ks_symptoms",helpText:"Kaposi Sarcoma (KS) associated symptoms",type:a.TT_MULTIPLE_YES_NO,validation:e=>o.required(e),computedValue:e=>({obs:e.map((e=>this.service.buildValueCoded(e.label,e.value)))}),options:e=>e.ks_symptoms?e.ks_symptoms:[this.toYesNoOption("Enlarged Lymph Nodes on Neck"),this.toYesNoOption("Enlarged Lymph Nodes on Armpits"),this.toYesNoOption("Enlarged Lymph Nodes on Groin"),this.toYesNoOption("Patches or Nodes on Neck"),this.toYesNoOption("Patches or Nodes on Armpits"),this.toYesNoOption("Patches or Nodes on Groin")]}},orderBiopsyForKs(){return{id:"ks_lab",helpText:"Order Biopsy (Optional)",type:a.TT_HIS_LAB_ORDER_INPUT,computedValue:e=>{if(e)return{orders:e.map((e=>e.other))}},options:()=>this.mapStrToOptions(["Biopsy"])}},ksDiagnosisField(){return{id:"ks_diagnosis",helpText:"KS diagnosis",type:a.TT_SELECT,computedValue:e=>({obs:this.service.buildValueCoded("KS clinical exam findings",e.value)}),validation:e=>o.required(e),options:()=>this.mapStrToOptions(["Positive","Negative"])}},ksStagingField(){return{id:"ks_staging",helpText:"Ks staging",type:a.TT_MULTIPLE_SELECT,validation:e=>o.required(e),computedValue:e=>({obs:e.map((e=>this.service.buildValueCoded(`${e.value}`,"Yes")))}),condition:e=>"Positive"===e.ks_diagnosis.value,options:()=>this.mapStrToOptions(["KS stage T0","KS stage T1"]),config:{buildOptionsOnce:!0}}},summary:()=>({id:"summary",helpText:"AHD Summary",type:a.TT_SUMMARY,options:e=>{const t=[];return t.push({label:"TB",value:e.tb_result?.value?`${e.tb_test_type?.value} ${e.tb_result?.value}`:"N/A"}),t.push({label:"CM",value:e.crag_result?.value?`Serum CrAg ${e.crag_result?.value}`:"N/A"}),t.push({label:"KS",value:e.ks_symptoms.every((e=>"No"===e.value))?"No symptoms":`${e.ks_symptoms.filter((e=>"Yes"===e.value)).length} symptom(s) recorded`}),t}}),getFields(){return[this.labInvestigationsField(),this.availableResultsField(),this.tbTestLocationField(),...this.tbTestDateField(),this.tbTestTypeField(),...this.tbTestResultDateField(),this.tbTestResultField(),this.getTbClassification(),this.getTbTreatmentStatus(),...this.getTbTreatmentStartDate(),this.getTbTreatmentPeriod(),this.orderTbTest(),this.cragTestLocationField(),...this.surumCragTestDate(),this.serumCragResult(),this.orderSerumCrag(),this.csfResultsAvailable(),this.csfCragTestLocation(),...this.csfCragTestDate(),this.csfResult(),this.orderCsfCrag(),this.ksSymptomsField(),this.orderBiopsyForKs(),this.ksDiagnosisField(),this.ksStagingField(),this.resultsAvailableToday(),this.summary()]}}});e("default",p(t,[["render",function(e,t,s,i,a,o){const r=m("his-standard-form");return b(),_(r,{skipSummary:!0,fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}]]))}}}));
