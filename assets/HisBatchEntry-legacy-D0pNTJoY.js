System.register(["./ViewPort-legacy-BdWinx1S.js","./FieldMixin.vue_vue_type_script_lang-legacy-DIF6qnJ3.js","./index-legacy-rttSvejT.js","./dynamic-import-helper-legacy-DYK5bIOV.js","./BaseTextInput-legacy-b28UU1f8.js","./PopupKeyboard-legacy-BOgFzgjz.js","./SIngleTouchField-legacy-CsZFin28.js","./TouchScreenForm-legacy-Bt9NJZEE.js","./ToolbarMediumCard-legacy-Bi2VVsZ_.js","./Transformers-legacy-DhNYVLaS.js","./HisKeypad-legacy-CTeETJ49.js","./BaseKeyboard-legacy-CJP1DHRk.js","./KbLayouts-legacy-BKvPSxzZ.js","./KbHandler-legacy-De8o5nTq.js"],(function(e,t){"use strict";var l,a,i,s,u,n,r,d,o,c,h,g,p,y,f,b,m,_,D,v,k,T,x,E,S,w,C,V,z,N,I,j,P,B,M,$;return{setters:[e=>{l=e.V},e=>{a=e._},e=>{i=e.d,s=e.bb,u=e.C,n=e.g,r=e.h,d=e.ai,o=e.ak,c=e.aj,h=e.f,g=e.S,p=e.cm,y=e.cb,f=e.ab,b=e.O,m=e.V,_=e.H,D=e.a$,v=e.cq,k=e._,T=e.r,x=e.o,E=e.c,S=e.w,w=e.b,C=e.x,V=e.F,z=e.y,N=e.u,I=e.v,j=e.z},e=>{P=e.F},e=>{B=e.default},e=>{M=e.M,$=e.P},null,null,null,null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent="ion-label[data-v-e9c2b14d]{font-weight:700}.border-right[data-v-e9c2b14d]{border-right:solid 1px #ccc}.scroll-list[data-v-e9c2b14d]{height:70vh;overflow:auto}.input_display[data-v-e9c2b14d]{font-size:1.3em}\n",document.head.appendChild(t);const F=i({components:{HisTextInput:B,ViewPort:l,IonInput:s,IonLabel:u,IonList:n,IonItem:r,IonGrid:d,IonCol:o,IonRow:c,IonButton:h},mixins:[a],data:()=>({drugs:[],allDrugsByName:[],selectedDrug:null,entryDate:g.getSessionDate()}),mounted(){this.init()},async activated(){this.init()},methods:{fmtNumber:e=>p(e),fmtDate:e=>y(e),async init(){this.$emit("onFieldActivated",this),await this.setDefaultValue()},async setDefaultValue(){const e=await this.options();this.drugs=this.drugs.filter((t=>e.map((e=>e.label)).includes(t.label))),e.forEach((e=>{const t={tabs:null,tins:null,expiry:null,batchNumber:null},l={label:e.label,entries:[{...t},{...t},{...t}],...e.value};f.find(this.drugs,{label:e.label})||this.drugs.push(l)})),this.drugs.length>=1&&this.selectDrug(0),"function"==typeof this.config.entryDate&&(this.entryDate=this.config.entryDate(this.fdata,this.cdata))},getModalTitle(e){return`${e} (${this.drugs[this.selectedDrug].short_name})`},getDrugValue(e,t){return this.drugs[this.selectedDrug].entries[e][t]},setDrugValue(e,t,l){this.drugs[this.selectedDrug].entries[e][t]=l?l.value:""},useCustomPackSize(e){return f.isEmpty(this.packSizes)||e.standard_pack_size.label.includes("Other")},async selectPackSize(e){await M([{id:"standard_pack_size",helpText:"Select Pack Size",type:P.TT_SELECT,condition:()=>!f.isEmpty(this.packSizes),defaultValue:()=>this.getDrugValue(e,"tabs"),options:()=>[...this.packSizes.map((e=>({label:`${e}`,value:e}))),{label:"Other (specify)",value:"Other"}]},{id:"custom_pack_size",helpText:"Input quantity",type:P.TT_NUMBER,defaultValue:()=>this.getDrugValue(e,"tabs"),validation:e=>m.required(e),condition:e=>this.useCustomPackSize(e),config:{showKeyboard:!0}}],(async t=>{this.setDrugValue(e,"tabs",this.useCustomPackSize(t)?t.custom_pack_size:t.standard_pack_size),await b.dismiss()}))},enterTins(e){$({id:"tins",helpText:this.getModalTitle("Enter number of tins/pallets"),type:P.TT_NUMBER,defaultValue:()=>this.getDrugValue(e,"tins"),validation:e=>!e||e&&!e.value?null:m.validateSeries([()=>m.isNumber(e),()=>e.value<=0?["Number of tins must be greater than 1"]:null])},(t=>this.setDrugValue(e,"tins",t)))},enterBatch(e){$({id:"batch",helpText:this.getModalTitle("Enter batch number"),type:P.TT_TEXT,config:{initialkb:"qwerty"},defaultValue:()=>this.getDrugValue(e,"batchNumber")},(t=>{const l={...t},a=`${l.value}`.toUpperCase();l.label=a,l.value=a,this.setDrugValue(e,"batchNumber",l)}))},enterExpiry(e){$({id:"expiry",helpText:this.getModalTitle("Enter expiry date")+` (Delivery Date: ${_.toStandardHisDisplayFormat(this.entryDate)})`,type:P.TT_FULL_DATE,defaultValue:()=>this.getDrugValue(e,"expiry"),validation:e=>{if(e&&e.value)return D(e.value).isBefore(D(this.entryDate).add(30,"day"))?["You are not allowed to enter drugs that are expiring within the next 30 days from the delivery date"]:null}},(t=>this.setDrugValue(e,"expiry",t)))},addRow(){this.drugs[this.selectedDrug].entries.push({tabs:null,tins:null,expiry:null,batchNumber:null})},selectDrug(e){this.selectedDrug=e},validateEntry:e=>!(f.isEmpty(e.tins)||f.isEmpty(e.expiry)||f.isEmpty(e.batchNumber)||f.isEmpty(e.tabs.toString()))},computed:{packSizes(){return null===this.selectedDrug?[]:v.getPackSizes(this.drugs[this.selectedDrug].drug_inventory_id)},fullSelectedDrugName(){try{return this.drugs[this.selectedDrug].fullName}catch(e){return"N/A"}},enteredDrugs(){const e=[];return this.drugs.forEach((t=>{t.entries.filter((e=>this.validateEntry(e))).forEach((l=>{e.push({label:t.short_name,value:{...t,...l,tabs:l.tabs}})}))})),e}},watch:{clear(){this.drugs=this.drugs.map((e=>(e.entries=e.entries.map((e=>(e.tins=null,e.expiry=null,e.batchNumber=null,e))),e)))},drugs:{handler(){this.$emit("onValue",this.enteredDrugs)},immediate:!0,deep:!0}}});e("default",k(F,[["render",function(e,t,l,a,i,s){const u=T("his-text-input"),n=T("ion-item"),r=T("ion-list"),d=T("ion-col"),o=T("ion-label"),c=T("ion-input"),h=T("ion-row"),g=T("ion-button"),p=T("ion-grid"),y=T("view-port");return x(),E(y,null,{default:S((()=>[w(u,{readonly:"",value:e.fullSelectedDrugName},null,8,["value"]),w(p,{style:{background:"white"}},{default:S((()=>[w(h,null,{default:S((()=>[w(d,{size:"4",class:"border-right scroll-list"},{default:S((()=>[(x(!0),C(V,null,z(e.drugs,((t,l)=>(x(),E(r,{key:l},{default:S((()=>[w(n,{detail:"",color:l===e.selectedDrug?"secondary":"",onClick:t=>e.selectDrug(l)},{default:S((()=>[N(I(`${t.short_name} (${t.code})`),1)])),_:2},1032,["color","onClick"])])),_:2},1024)))),128))])),_:1}),w(d,null,{default:S((()=>[null!==e.selectedDrug?(x(),E(p,{key:0,class:"scroll-list"},{default:S((()=>[(x(!0),C(V,null,z(e.drugs[e.selectedDrug].entries,((t,l)=>(x(),E(h,{key:l},{default:S((()=>[w(d,null,{default:S((()=>[w(n,null,{default:S((()=>[w(o,{position:"floating"},{default:S((()=>[N("Pack Size")])),_:1}),w(c,{readonly:"",placeholder:"0",value:e.fmtNumber(t.tabs),onClick:t=>e.selectPackSize(l)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024),w(d,null,{default:S((()=>[w(n,null,{default:S((()=>[w(o,{position:"floating"},{default:S((()=>[N("Tins/Pallets")])),_:1}),w(c,{readonly:"",placeholder:"0",value:e.fmtNumber(t.tins),onClick:t=>e.enterTins(l)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024),w(d,null,{default:S((()=>[w(n,null,{default:S((()=>[w(o,{position:"floating"},{default:S((()=>[N("Expiry Date")])),_:1}),w(c,{readonly:"",placeholder:"DD/MM/YYYY",value:e.fmtDate(t.expiry),onClick:t=>e.enterExpiry(l)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024),w(d,null,{default:S((()=>[w(n,null,{default:S((()=>[w(o,{position:"floating"},{default:S((()=>[N("Batch Number")])),_:1}),w(c,{readonly:"",placeholder:"e.g. 'ABC-123'",value:t.batchNumber,onClick:t=>e.enterBatch(l)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),w(h,null,{default:S((()=>[w(d,null,{default:S((()=>[w(g,{onClick:e.addRow,siz:"large"},{default:S((()=>[N("Add row")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):j("",!0)])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-e9c2b14d"]]))}}}));
