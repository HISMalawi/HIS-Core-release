const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-BXxGfRHs.js","assets/index-BqchvINe.js","assets/index-DxMuvVt8.js","assets/index-BzpIK3mx.css"])))=>i.map(i=>d[i]);
import{bB as B,d as L,r as l,at as N,o as S,cJ as w,a as _,E as x,C as o,K as d,a2 as E,b as p,w as m,u as f,a8 as y,cK as K,M,ah as $,R as F,W as n,aa as T}from"./index-DxMuvVt8.js";import{r as W,F as i,D as q}from"./index-BqchvINe.js";const R=W("CapacitorAppInstaller",{web:()=>B(()=>import("./web-BXxGfRHs.js"),__vite__mapDeps([0,1,2,3])).then(u=>new u.CapacitorAppInstallerWeb)}),z={key:0,id:"update-notification"},G=L({__name:"ApkUpdateNotification",props:{checkInterval:{type:Number,default:36e5}},setup(u){const b=u,r=l(!1),s=l(""),t=l(""),c=new $,v=N(()=>!!t.value&&t.value!="-"&&t.value!==s.value),g=l("");S(h);function h(){w("mobile")&&w("android")&&setInterval(async()=>{v.value||(t.value=await c.getApkVersion(),s.value=c.getHeadVersion())},b.checkInterval)}function k(){t.value=s.value}async function P(){try{if(await I()){r.value=!0,C();const e=await A();if(r.value=!1,!e)throw new Error("Unable to download the app");F("Download completed. Installing the app..."),await U(e),s.value=t.value}}catch(e){r.value=!1,console.error(e),n("Unable to update the app")}}async function I(){try{const{publicStorage:e}=await i.checkPermissions();if(e!=="granted"){const{publicStorage:a}=await i.requestPermissions();if(a!=="granted")return n("Permission to access storage is required to download the app."),!1}return!0}catch(e){return console.error(e),n("Unable to download the app. Please try again later"),!1}}async function A(){try{return(await i.downloadFile({url:await c.getApkDownloadLink(t.value),path:"Download/emr-".concat(t.value,".apk"),directory:q.ExternalStorage,recursive:!0,progress:!0})).path}catch(e){console.error(e),n(e.toString())}}function C(){i.addListener("progress",e=>{const a=Math.round(e.contentLength/1024),V=Math.round(e.bytes/1024),D=Math.round(e.bytes/e.contentLength*100);g.value="Downloading... ".concat(V,"KB / ").concat(a,"KB (").concat(D,"%)")})}async function U(e){try{await R.install({file:e})}catch(a){console.error(a),n("Unable to install the app. Please try again later")}}return(e,a)=>v.value?(_(),x("div",z,[a[2]||(a[2]=o(" New version (")),d("strong",null,E(t.value),1),a[3]||(a[3]=o(") update is available ")),a[4]||(a[4]=d("br",null,null,-1)),a[5]||(a[5]=d("br",null,null,-1)),p(f(y),{onClick:P,color:"success"},{default:m(()=>a[0]||(a[0]=[o(" Download Update ")])),_:1}),a[6]||(a[6]=o("     ")),p(f(y),{onClick:k,color:"danger"},{default:m(()=>a[1]||(a[1]=[o(" Cancel ")])),_:1}),p(f(K),{"is-open":r.value,message:g.value},null,8,["is-open","message"])])):M("",!0)}}),O=T(G,[["__scopeId","data-v-70fe1068"]]);export{O as default};
