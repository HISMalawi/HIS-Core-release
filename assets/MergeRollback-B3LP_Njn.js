import{al as R,d as H,am as F,a5 as S,S as A,Q as L,O as P,a4 as z,R as G,$ as V,U as E,a0 as J,a3 as U,an as j,ao as q,ap as O,r as d,aq as o,ar as Q,t as Y,aj as x,ai as K,af as W,a8 as X,ad as n,u as v,v as C,w as e,x as t,z as l,Y as g,a1 as T,B as Z,C as ee,E as te}from"./index-BXYGQb-P.js";class w extends R{static getMergeHistory(r){return this.getJson("/rollback/merge_history",{identifier:r})}static rollback(r){return this.postJson("/rollback/rollback_patient",{patient_id:r,program_id:this.getProgramID()})}}const ae=H({components:{IonText:F,IonPage:S,IonContent:A,IonToolbar:L,IonHeader:P,IonFooter:z,IonTitle:G,IonList:V,IonItem:E,IonLabel:J,IonButton:U,ReportTable:j},setup(){const s=q(),r=O(),u=d(-1),h=d([]),_=d([]),i="".concat(s.params.id).toUpperCase(),p=d("N/A"),c=d([{label:"Birthdate",value:"N/A"},{label:"Gender",value:"N/A"}]),m=[[o.thTxt("Merge type"),o.thTxt("Merge date"),o.thTxt("First Name"),o.thTxt("Last name"),o.thTxt("Birthdate"),o.thTxt("Gender")]],y=Q(()=>_.value.length>0);Y(async()=>{if(!i){r.back();return}try{_.value=await w.getMergeHistory(i)||[]}catch(a){x("Merge history not found for ".concat(i))}h.value=_.value.map(a=>(u.value===-1&&(u.value=a.secondary_id,p.value="".concat(a.secondary_first_name," ").concat(a.secondary_surname),c.value=[{label:"Birthdate",value:K.toStandardHisDisplayFormat(a.secondary_birthdate)},{label:"Gender",value:a.secondary_gender}]),[o.td(a.merge_type),o.tdDate(a.merge_date),o.td(a.primary_first_name),o.td(a.primary_surname),o.tdDate(a.primary_birthdate),o.td(a.primary_gender)]))});function f(){r.back()}async function b(){await W("Are you sure you want to merge transactions")&&(await w.rollback(u.value)?r.back():x("Failed to rollback"))}return{cancel:f,holderName:p,isReversible:y,patientInfo:c,rollback:b,columns:m,rows:h,npid:i}}});function oe(s,r,u,h,_,i){const p=n("ion-text"),c=n("ion-title"),m=n("ion-toolbar"),y=n("ion-header"),f=n("ion-label"),b=n("ion-item"),a=n("ion-list"),N=n("report-table"),B=n("ion-content"),k=n("ion-button"),D=n("ion-footer"),M=n("ion-page");return v(),C(M,null,{default:e(()=>[t(y,null,{default:e(()=>[t(m,null,{default:e(()=>[t(c,{class:"his-lg-text"},{default:e(()=>[t(p,{color:"danger"},{default:e(()=>[l(g(s.npid),1)]),_:1}),l(" Merge history ")]),_:1})]),_:1})]),_:1}),t(B,null,{default:e(()=>[t(c,{class:"his-md-text his-card"},{default:e(()=>[l("NPID Holder: ")]),_:1}),t(a,null,{default:e(()=>[t(b,{lines:"none",class:"his-md-text"},{default:e(()=>[t(f,null,{default:e(()=>[l(" Person name ")]),_:1}),T("b",null,g(s.holderName),1)]),_:1}),(v(!0),Z(te,null,ee(s.patientInfo,(I,$)=>(v(),C(b,{lines:"none",class:"his-md-text",key:$},{default:e(()=>[t(f,null,{default:e(()=>[l(g(I.label)+": ",1)]),_:2},1024),T("b",null,g(I.value),1)]),_:2},1024))),128))]),_:1}),t(c,{class:"his-md-text his-card"},{default:e(()=>[l("Transactions:")]),_:1}),t(N,{config:{tableCssTheme:"art-report-theme"},columns:s.columns,rows:s.rows},null,8,["columns","rows"])]),_:1}),t(D,null,{default:e(()=>[t(m,{color:"dark"},{default:e(()=>[t(k,{onClick:s.cancel,color:"danger",size:"large",slot:"start"},{default:e(()=>[l(" Cancel ")]),_:1},8,["onClick"]),t(k,{onClick:s.rollback,disabled:!s.isReversible,color:"success",size:"large",slot:"end"},{default:e(()=>[l(" Reverse ")]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})}const se=X(ae,[["render",oe],["__scopeId","data-v-f5608659"]]);export{se as default};
