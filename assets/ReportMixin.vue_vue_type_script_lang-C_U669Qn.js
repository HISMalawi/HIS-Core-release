import{d as T,H as f,aN as y,as as a,au as d,ad as h,ae as u,bC as p,ao as x,aV as D,al as c}from"./index-CMZASHAR.js";import{D as w}from"./BasicReportTemplate-CbJ_oMga.js";import{O as b}from"./opd_report_service-56DRmHjV.js";import{a as g}from"./MOHReportHeader-CX05ZO2I.js";const Y=T({data:()=>({fields:[],report:{},reportReady:!1,period:"",startDate:"",endDate:"",customFileName:"",drillDownCache:{}}),methods:{toDate(t){return f.toStandardHisDisplayFormat(t)},confirmPatient(t){return this.$router.push("/patients/confirm?person_id=".concat(t))},async exportToCustomPDF(t){const n=open("","","width:1024px, height:768px"),e=document.getElementById("report-content");e&&n&&(n.document.write("\n                    <html>\n                    <head>\n                        <title>".concat(t,'</title>\n                        <link rel="stylesheet" media="print" href="/assets/css/cohort.css" />\n                    </head>\n                    <body>\n                        ').concat(e.innerHTML,"\n                    </body>\n                    </html>\n                ")),setTimeout(()=>{n.print(),n.close()},3500))},async onDrillDown(t,n){if(y.isEmpty(n))return;const e=[[a.thTxt("First name"),a.thTxt("Last name"),a.thTxt("Gender"),a.thTxt("Age"),a.thTxt("Phone"),a.thTxt("Address"),a.thTxt("Action")]],i=async l=>await Promise.all(l.map(async r=>{const s=await c.findByID(r),o=new c(s);return[a.td(o.getGivenName()),a.td(o.getFamilyName()),a.td(o.getGender()),a.td(o.getAge()),a.td(o.getPhoneNumber()),a.td("".concat(o.getCurrentDistrict(),", ").concat(o.getCurrentVillage(),", ").concat(o.getClosestLandmark())),a.tdBtn("Select",async()=>{await d.dismiss({}),this.$router.push({path:"/patient/dashboard/".concat(r)})})]}));return this.drilldownData(t,e,n,i)},async drilldownAsyncRows(t,n,e){(await d.create({component:w,cssClass:"large-modal",componentProps:{title:t,columns:n,asyncRows:e,showFilters:!0,rowsPerPage:50,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>d.dismiss()}})).present()},async drilldownData(t,n,e,i){(await d.create({component:w,cssClass:"large-modal",componentProps:{title:t,columns:n,rows:e,rowParser:i,rowsPerPage:50,showFilters:!0,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>d.dismiss()}})).present()},getDefaultDrillDownTable(){const t=[[a.thTxt("ARV number"),a.thTxt("Gender"),a.thTxt("Birth Date"),a.thTxt("Actions")]];return{rowParser:e=>e.map(async i=>{const[l,r]=i;if(r in this.drillDownCache)return[l];const s=await c.findByID(r),o=new c(s),m=[l,a.td(o.getArvNumber()),a.td(o.getGender()),a.tdDate(o.getBirthdate().toString()),a.tdBtn("Show",async()=>{await d.dismiss({}),this.$router.push({path:"/patient/dashboard/".concat(r)})})];return this.drillDownCache[r]=m,m}),columns:t}},runTableDrill(t,n="Drilldown patients"){const{columns:e,rowParser:i}=this.getDefaultDrillDownTable();this.drilldownData(n,e,t,i)},drill(t,n="Drill table"){return t&&t.length>0?a.tdLink(t.length,()=>this.runTableDrill(t,n)):a.td(0)},getEpiweeksFields(){return[{id:"epiweek",helpText:"Select EPI week",type:h.TT_SELECT,validation:t=>u.required(t),options:async()=>(await g.getReportEpiWeeks()).map(e=>({label:e.name+" - ("+p(e.start).format("DD/MMM/YYYY")+" - "+p(e.end).format("DD/MMM/YYYY")+")",value:e.start,other:e}))}]},getMonthlyFields(){return[{id:"idsrmonth",helpText:"Select Month",type:h.TT_SELECT,validation:t=>u.required(t),options:async()=>(await g.getReportMonths()).map(e=>({label:e.name+" - ("+p(e.start).format("DD/MMM/YYYY")+" - "+p(e.end).format("DD/MMM/YYYY")+")",value:e.start,other:e}))}]},getDateDurationFields(t=!1,n=!1,e=5){const i="2001-01-01",l=x.getSessionDate();return[{id:"quarter",helpText:"Select Quarter",type:h.TT_SELECT,condition:()=>t,validation:r=>u.required(r),options:()=>{let s=b.getReportQuarters(e).map(o=>({label:o.name,value:o.start,other:o}));return n&&(s=[{label:"Set custom period",value:"custom_period",other:{}},...s]),s}},...D({id:"start_date",helpText:"Start",required:!0,condition:r=>r.quarter&&r.quarter.value==="custom_period"||!t,minDate:()=>i,maxDate:()=>l,estimation:{allowUnknown:!1},computeValue:r=>r}),...D({id:"end_date",helpText:"End",required:!0,condition:r=>r.quarter&&r.quarter.value==="custom_period"||!t,unload:(r,s,o,m)=>{s==="next"&&(this.endDate=m.end_date)},minDate:(r,s)=>s.start_date,maxDate:()=>l,estimation:{allowUnknown:!1},computeValue:r=>r})]}}});export{Y as _};
