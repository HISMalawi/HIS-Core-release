System.register(["./dynamic-import-helper-legacy-BhGHTWZn.js","./HisStandardForm-legacy-2zAvTkZI.js","./index-legacy-T5lWkeko.js","./EncounterMixin.vue_vue_type_script_lang-legacy-EriMg7OJ.js","./TouchScreenForm-legacy-oE84DcYP.js","./ToolbarMediumCard-legacy-uJ0c_iri.js","./Transformers-legacy-PbfCTy2a.js","./ViewPort-legacy-EDL_vLSV.js","./encounter_guidelines-legacy-JyoANzWg.js","./GuidelineEngine-legacy--xbEVG44.js"],(function(e,t){"use strict";var i,r,n,a,s,o,u,p,l,c,d,h,m,v,g,y,b,f;return{setters:[e=>{i=e.F},e=>{r=e.H},e=>{n=e.b2,a=e.Q,s=e.aI,o=e.d,u=e.t,p=e.R,l=e.T,c=e.ab,d=e.V,h=e.aX,m=e.aJ,v=e._,g=e.r,y=e.o,b=e.c},e=>{f=e._},null,null,null,null,null,null],execute:function(){class t extends n{sitePrefix;constructor(e,t){super(e,51,t),this.sitePrefix=""}getSitePrefix(){return this.sitePrefix}async loadSitePrefix(){this.sitePrefix=await a.sitePrefix()}createArvNumber(e){return s.postJson("/patient_identifiers/",{patient_id:this.patientID,identifier_type:4,identifier:e})}buildArvNumber(e){return`${this.sitePrefix}-ARV-${e}`}}const _=o({mixins:[f],components:{HisStandardForm:r},data:()=>({reception:{},activeField:"",hasARVNumber:!0,suggestedNumber:"",patientType:{}}),watch:{ready:{handler(e){e&&(this.reception=new t(this.patientID,this.providerID),this.fields=this.getFields())},immediate:!0}},methods:{async onFinish(e,t){if(!(await this.reception.createEncounter()))return u("Unable to create encounter");const i=await this.resolveObs(t,"obs");if(!(await this.reception.saveObservationList(i)))return u("Unable to create Obs");if(e.capture_arv&&"Yes"===e.capture_arv.value){if(!(await this.reception.createArvNumber(t.arv_number)))return u("Unable to save Arv number");p.invalidate("ACTIVE_PATIENT")}if(l("Encounter created"),c.find(e.who_is_present,{value:"Yes",label:"Guardian present?"})&&c.isEmpty(await this.patient.getGuardian()))return this.$router.push(`/guardian/registration/${this.patientID}`);this.nextTask()},getFields(){return[{id:"who_is_present",helpText:"HIV reception",type:i.TT_MULTIPLE_YES_NO,validation:e=>d.required(e)||d.neitherOr(e)||d.anyEmpty(e),computedValue:e=>({tag:"obs",obs:e.map((({other:e,value:t})=>this.reception.buildValueCoded(e.concept,t)))}),options:e=>e.who_is_present?e.who_is_present:[{label:"Patient present?",value:"",other:{concept:"Patient Present",property:"patient_present",values:this.yesNoOptions()}},{label:"Guardian present?",value:"",other:{concept:"Guardian Present",property:"guardian_present",values:this.yesNoOptions()}}]},{id:"capture_arv",helpText:"Capture ARV Number?",type:i.TT_SELECT,requireNext:!0,init:async()=>(""===this.patient.getPatientIdentifier(4)&&(this.hasARVNumber=!1),this.patientType=new h(this.patientID,this.providerID),await this.patientType.loadPatientType(),!0),condition:()=>!this.hasARVNumber&&"New patient"===this.patientType.getType(),validation:e=>d.required(e),options:()=>this.yesNoOptions()},{id:"arv_number",helpText:"ART number",type:i.TT_TEXT,init:async()=>{if(await this.reception.loadSitePrefix(),!this.hasARVNumber){const e=await s.getNextSuggestedARVNumber();this.suggestedNumber=e.arv_number.replace(/^\D+|\s/g,"")}return!0},computedValue:({value:e})=>e,validation:e=>d.required(e),condition:e=>!this.hasARVNumber&&"Yes"===e.capture_arv.value,defaultValue:()=>this.suggestedNumber,config:{prependValue:()=>{const e=m.getActiveApp();return e&&e.programPatientIdentifiers?e.programPatientIdentifiers["ARV Number"].prefix():""}}}]}}});e("default",v(_,[["render",function(e,t,i,r,n,a){const s=g("his-standard-form");return y(),b(s,{fields:e.fields,activeField:e.activeField,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","activeField","onFinishAction","cancelDestinationPath"])}]]))}}}));
