System.register(["./index-legacy-Dg5P6bX-.js","./ReportDateSelectionPrompt-legacy-CYILbQs6.js","./tb_report_service-legacy-DSn6dSK5.js","./TableView-legacy-D9drx_2x.js","./ArtDrilldown-legacy-CkY34QnR.js","./dynamic-import-helper-legacy-arUa2LZV.js","./MultiFieldDateHelper-legacy-DBQBHUfA.js","./KbLayouts-legacy-BKvPSxzZ.js","./HisKbConfigurations-legacy-vrLd9Pgz.js","./PopupKeyboard-legacy-Cz-tBZHa.js","./SIngleTouchField-legacy-SRHCPnWv.js","./TouchScreenForm-legacy-Bqug27CT.js","./ToolbarMediumCard-legacy-DWokgyDV.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-D3j1oaCn.js","./HisKeypad-legacy-CAj098_i.js","./BaseKeyboard-legacy-DbTjgoKo.js","./KbHandler-legacy-De8o5nTq.js","./fuse-legacy-CQoBB3MK.js","./Export-legacy-3ZHnhIid.js","./HisKeyboard-legacy-C-8xTqW8.js"],(function(e,a){"use strict";var r,n,t,l,o,s,c,g,u,i,d,p,y,f,b,m,j,v,w,_,R;return{setters:[e=>{r=e.d,n=e.I,t=e.c4,l=e.K,o=e.N,s=e.a9,c=e.O,g=e.n,u=e.t,i=e.ab,d=e.q,p=e._,y=e.r,f=e.o,b=e.c,m=e.w,j=e.b},e=>{v=e.D},e=>{w=e.T},e=>{_=e.v},e=>{R=e.A},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){const a=r({components:{IonPage:n,IonLoading:t,v2Datatable:_},setup(){const e=l([]),a=l(""),r=l(!1),n=new w,t=l(void 0),p=l(void 0),y=(e,r)=>({ref:r,label:e,toValue:e=>e.length,tdClick:async e=>{e.refData.length&&(await c.create({component:R,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:a,patientIdentifiers:e.refData,title:`${e.data.ageGroup} ${e.data.gender} ${e.column.label}`,onFinish:()=>c.getTop().then((e=>e&&c.dismiss()))}})).present()}}),f=[[{label:"#",ref:"index"},{label:"Age group",ref:"ageGroup"},{label:"Gender",ref:"gender"},y("TX_CURR","tx_curr"),y("Symptom Screen (alone)","symptom_screen_alone"),y("CXR screen","cxr_screen"),y("mWRD screen","mwrd_screen"),y("New on ART/Screen Positive","sceen_pos_new"),y("New on ART/Screen Negative","sceen_neg_new"),y("Already on ART/Screen Positive","sceen_pos_prev"),y("Already on ART/Screen Negative","sceen_neg_prev"),y("TB RX_New on ART","started_tb_new"),y("TB RX_Prev on ART","started_tb_prev")]],b=async(a=!1)=>{if(!t.value||!p.value)return u("Start date and end date required!");r.value=!0,e.value=[];try{const r=await n.getTxTbReport(a,"pepfar"),t={F:"Female",M:"Male"},l=Object.keys(r).reduce(((e,a)=>{if("Unknown"===a)return e;const n=r[a];return Object.keys(n).forEach((r=>{e[r].rows.push({ageGroup:a,gender:t[r],...n[r]}),e[r].aggregate=Object.keys(n[r]).reduce(((e,a)=>Array.isArray(n[r][a])?{...e,[a]:[...e[a]||[],...n[r][a]]}:e),e[r].aggregate)})),e}),{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...l.F.rows,...l.M.rows,{ageGroup:"All",gender:"Male",...l.M.aggregate}];const o=Object.values(l.F.aggregate).reduce(((e,a)=>e.concat(a)),[]),s=await n.getMaternalStatus(i.uniq(o)),c=s.FBf.concat(s.FP);["FP","FNP","FBf"].forEach((a=>{e.value.push(Object.keys(l.F.aggregate).reduce(((e,r)=>({...e,[r]:l.F.aggregate[r].filter((e=>"FNP"===a?!c.includes(e):s[a].includes(e)))})),{ageGroup:"All",gender:a}))})),e.value=e.value.map(((e,a)=>({index:a+1,...e})))}catch(l){console.error(l),d("Unable to generate report!")}r.value=!1},m=()=>v({onFinish:(e,r,t,l)=>{a.value=`Period: ${t}`,n.startDate=e,n.endDate=r,l&&n.setOccupation(l),b()}});return o((()=>m())),{Img:s,reportData:e,isLoading:r,onRefreshReport:async()=>b(await g("Do you want to rebuild report?")),configure:m,generate:b,columns:f,period:a}}});e("default",p(a,[["render",function(e,a,r,n,t,l){const o=y("ion-loading"),s=y("v2Datatable"),c=y("ion-page");return f(),b(c,null,{default:m((()=>[j(o,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),j(s,{title:"Tx TB Report","icon-url":e.Img("login-logos/PEPFAR.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRefreshReport,"report-prefix":"Pepfar"},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh"])])),_:1})}]]))}}}));
