System.register(["./index-legacy-Dg5P6bX-.js","./dynamic-import-helper-legacy-arUa2LZV.js","./HisStandardForm-legacy-BXV61qjj.js","./useEncounter-legacy-Bp6E5sCN.js","./commons-legacy-CiEua9CM.js","./util-legacy-CjANJSja.js","./TouchScreenForm-legacy-Bqug27CT.js","./ToolbarMediumCard-legacy-DWokgyDV.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-D3j1oaCn.js","./isEmpty-legacy-rdjCNuhy.js","./_Set-legacy-BL8ow4HL.js","./_setToArray-legacy-jEwcQpqP.js","./encounter_guidelines-legacy-mRSBdMQj.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,n,r,o,i,l,d,u,s,c,m,p,_,g,v,y,T,h,E,D;return{setters:[e=>{a=e.d,n=e.K,r=e.b5,o=e.cV,i=e.ad,l=e.V,d=e.o,u=e.c,s=e.w,c=e.b,m=e.cl,p=e.a$,_=e.b0,g=e.I},e=>{v=e.F},e=>{y=e.H},e=>{T=e.u},e=>{h=e.m,E=e.r},e=>{D=e.g},null,null,null,null,null,null,null,null,null],execute:function(){e("default",a({__name:"Treatment",setup(e){const t=n(""),a=n([]),b=new r(-1,o.TREATMENT),S=n("standard"),N=n();function O(e){return[...Array.isArray(e.selectedDrugs)?e.selectedDrugs.map((e=>e.other)):[e.selectedDrugs.other],...e.mdrSupplements?.value&&"NONE"!=e.mdrSupplements?.value?[e.mdrSupplements.other]:[]]}const{goToNextTask:R,patientDashboardUrl:I}=T(((e,n)=>{b.patientID=n,b.providerID=e,a.value=[(()=>{let e=[];return{id:"regimenShortCode",helpText:"DR regimen",type:v.TT_DR_PRESCRIPTION_INPUT,proxyID:"selectedDrugs",dynamicHelpText:()=>N.value.regimen_title,computedValue:e=>e.map((e=>({concept_id:D("MEDICAL_ORDERS"),value_coded:e.value,obs_datetime:b.date}))),beforeNext:async e=>{if(!e.every((e=>!!e.other))){const t=e.filter((e=>!e.other)).map((e=>e.label));return await i("System ERROR","Please report this issue to resume using the system:",`Some drugs are missing weight band information: ${t}`,[{name:"Ok",slot:"start",color:"danger"}]),!1}return!0},init:async()=>{if(N.value=await r.getJson("mdr/regimen/status",{patient_id:b.patientID,program_id:b.programID,date:b.date}),N.value?.mdr_status&&(N.value?.regimen_drugs||[]).length){const t=N.value.regimen_drugs.reduce(((e,t)=>({...e,[t.abbreviation]:t})),{});e=N.value.regimen_composition.split("-").reduce(((e,a)=>[...e,{label:a,value:a.split("/")[0],other:a.split("/").map((e=>t[e]))}]),[])}return!0},condition:()=>N.value.mdr_status,options:()=>e}})(),(()=>{let e=[];return{id:"regimens",helpText:"Recommended regimens (weight-band adjusted):",type:v.TT_SELECT,requireNext:!1,proxyID:"selectedDrugs",init:async()=>{const t=await r.getJson(`programs/${b.programID}/regimens`,{patient_id:n,date:b.date});return e=t.map((e=>({label:e.drug.name,value:e.drug_id,other:e}))),!0},computedValue:e=>[{concept_id:D("MEDICAL_ORDERS"),value_coded:e?.other?.drug?.concept_id,obs_datetime:b.date}],onload:()=>S.value="standard",validation:e=>l.required(e),condition:()=>!N.value?.mdr_status,options:()=>e,config:{hiddenFooterBtns:["Back"],footerBtns:[{name:"Custom Regimen",slot:"end",onClick:()=>{S.value="custom",t.value="customRegimen"}}]}}})(),(()=>{let e=[];return{id:"customRegimen",helpText:"Custom regimens:",type:v.TT_MULTIPLE_SELECT,proxyID:"selectedDrugs",validation:e=>l.required(e),condition:()=>"custom"===S.value,computedValue:e=>e.map((e=>({concept_id:D("MEDICAL_ORDERS"),value_coded:e.other.drug.concept_id,obs_datetime:b.date}))),options:async()=>{if(!e.length){const t=await r.getJson(`programs/${b.programID}/custom_tb_ingredients`,{patient_id:n});e=t.map((e=>({label:e.drug.name,value:e.drug_id,other:e})))}return e}}})(),(()=>{let e=[];return{id:"mdrSupplements",helpText:"Supplements:",requireNext:!0,type:v.TT_SELECT,init:async()=>{try{const t=await r.getJson(`programs/${b.programID}/tb_regimen_group`,{patient:n,regimen_group:"secondline-supplements"});e=t.map((e=>({label:e.drug.name,value:e.drug_id,other:e})))}catch(t){console.error(t)}return!0},computedValue:e=>{if("NONE"!=e.value)return{concept_id:D("MEDICAL_ORDERS"),value_coded:e.other.drug.concept_id,obs_datetime:b.date}},validation:e=>l.required(e),condition:e=>e.regimenShortCode.length>=1,options:()=>[{label:"NONE",value:"NONE"},...e]}})(),{id:"drugsView",helpText:"Dosages:",type:v.TT_TABLE_VIEWER,options:e=>[{label:"",value:"",other:{columns:["Name","AM","NOON","PM"],rows:O(e).map((e=>[e.name||e?.drug?.name,e.am_dose,e.noon_dose,e.pm_dose]))}}]},{id:"recommendedNumberOfDays",helpText:"Duration of Drug Supply in Days:",type:v.TT_SELECT,validation:e=>l.required(e),computedValue:e=>{if("Other"!=e.value)return{concept_id:D("REGIMEN_SUPPLY_DAYS"),value_numeric:parseInt(`${e.value}`),obs_datetime:b.date}},options:()=>[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:14,label:"14"},{value:28,label:"28"},{value:56,label:"56"},{value:84,label:"84"},{value:"Other",label:"Other"}],requireNext:!1},{id:"otherDays",helpText:"Custom Duration of Drug Supply in Days:",type:v.TT_NUMBER,computedValue:e=>({concept_id:D("REGIMEN_SUPPLY_DAYS"),value_numeric:parseInt(`${e.value}`),obs_datetime:b.date}),validation:e=>l.required(e),condition:e=>"Other"===e.recommendedNumberOfDays.value},(()=>{let e=!1;return{id:"useHangingPills",helpText:"Use Hanging Pills:",type:v.TT_SELECT,init:async()=>{const t=await r.getObs({person_id:n,date:b.date,page_size:1,concept_id:D("TB_ADHERENCE")});return e=!!(t||[]).length,!0},condition:()=>e,validation:e=>l.required(e),computedValue:(e,t)=>{"Yes"===e.value&&O(t).map((e=>({concept_id:D("APPOINTMENT_REASON"),value_drug:e.drug_id,value_text:"Optimize - including hanging pills",obs_datetime:b.date})))},options:()=>h(["Yes","No"])}})(),{id:"dot",helpText:"DOT and Adherence Support Technique",type:v.TT_SELECT,validation:e=>l.required(e),computedValue:e=>({concept_id:D("TYPE_OF_SUPPORT"),value_coded:D(`${e.value}`),obs_datetime:b.date}),options:()=>[{value:"GUARDIAN",label:"Guardian"},{value:"HEALTH_CARE_WORKER",label:"Health Care Worker"},{value:"VOLUNTEER",label:"Volunteer"},{value:"HSA",label:"Health Surveillance Assistant"}]}]}));async function f(e,t){await b.createEncounter(),await b.saveObservationList(await E(t)),await r.postJson("drug_orders",{encounter_id:b.encounterID,drug_orders:O(e).map((t=>({drug_inventory_id:t?.drug_id||t?.id||t?.drug?.drug_id,start_date:b.date,am_dose:t.am_dose,noon_dose:t.noon_dose,pm_dose:t.pm_dose,auto_expire_date:p(b.date).add("Other"!=e.recommendedNumberOfDays.value?e.recommendedNumberOfDays.value:e.otherDays.value,"days").format(_),name:t.drug.name,concept_id:t.drug.concept_id,equivalent_daily_dose:t.am_dose+t.noon_dose+t.pm_dose})))}),R()}return(e,n)=>(d(),u(m(g),null,{default:s((()=>[c(y,{cancelDestinationPath:m(I),onFinishAction:f,activeField:t.value,onOnIndex:n[0]||(n[0]=e=>t.value=""),fields:a.value,skipSummary:!0},null,8,["cancelDestinationPath","activeField","fields"])])),_:1}))}}))}}}));
