import{d as A,q as $,x,r as b,o as B,y as k,l as E,as as q,aR as P,d9 as I,z as u,v as N,da as O,db as S,D as j,ak as U,b as L,w as G,ap as F,a as V,e as R}from"./index-CJleCCtM.js";import{T as z}from"./tx_report_service-DF81Csi1.js";import{v as W}from"./TableView-CMbHc5dx.js";import{A as y}from"./v2utils-Czfb_0FR.js";import"./Export-CXTwynHo.js";import"./index-DC9jnrfb.js";const X=A({components:{IonPage:$,IonLoading:x,v2Datatable:W},setup(){const e=b([]),m=b(""),f=b(!1),c=b([]),o=new z;function r(d,p){return{ref:p,label:d,toValue:a=>a.length,tdClick:async a=>{a.refData.length&&(await u.create({component:y,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"".concat(a.data.age_group," ").concat(a.data.gender," ").concat(a.column.label),patientIdentifiers:a.refData,onFinish:()=>u.getTop().then(i=>i&&u.dismiss())}})).present()}}}const D=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},r("CD4 <200","cd4_less_than_200"),r("CD4 >=200","cd4_greater_than_or_equal_to_200"),r("Unknown CD4","unknown_cd4_count"),r("Not Eligible for CD4","not_eligible_for_cd4"),r("Returned <3 mo","returned_less_than_3_months"),r("Returned 3-5 mo","returned_greater_than_3_months_and_less_than_6_months"),r("Returned 6+ mo","returned_greater_than_or_equal_to_6_months")]],_=async(d=!1)=>{o.startDate&&o.endDate||E("Start date and end date required!");const p=d&&await q("Do you want to rebuild report?");f.value=!0;try{const a=await o.getTxRttReport(p),i={F:"Female",M:"Male"},s=a.reduce((n,t)=>(t.age_group!="Unknown"&&(n[t.gender].rows.push({...t,gender:i[t.gender]}),n[t.gender].aggregate=Object.keys(t).reduce((g,l)=>Array.isArray(t[l])?{...g,[l]:[...g[l]||[],...t[l]]}:g,n[t.gender].aggregate)),n),{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...s.F.rows,...s.M.rows,{age_group:"All",gender:"Male",...s.M.aggregate}];const C=Object.values(s.F.aggregate).flat(1),v=await o.getMaternalStatus(P.uniq(C)),M=v.FBf.concat(v.FP);["FP","FNP","FBf"].forEach(n=>{e.value.push(Object.keys(s.F.aggregate).reduce((t,g)=>({...t,[g]:s.F.aggregate[g].filter(l=>n==="FNP"?!M.includes(l):v[n].includes(l))}),{age_group:"All",gender:n}))}),e.value=e.value.map((n,t)=>({index:t+1,...n}));const T=Object.values(s.M.aggregate).flat(1),w=P.uniq([...C,...T]);c.value=[{id:"stats",text:"Total <b>".concat(w.length,"</b>"),icon:I,color:"primary",action:async()=>{(await u.create({component:y,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"Total Clients",subtitle:m.value,patientIdentifiers:w,onFinish:()=>u.getTop().then(n=>n&&u.dismiss())}})).present()}}]}catch(a){console.error(a),N("Unable to generate report!"),c.value=[{text:"Unable to generate report!",color:"danger",icon:O,action:function(){c.value=[{text:"Exception occured: <b>".concat(a,"</b>"),color:"danger",icon:S}]}}]}f.value=!1},h=()=>j({onFinish:(d,p,a,i)=>{m.value=a,o.startDate=d,o.endDate=p,i&&o.setOccupation(i),_()}});return B(()=>h()),{headerBadge:c,reportData:e,isLoading:f,Img:k,configure:h,generate:_,columns:D,period:m}}});function H(e,m,f,c,o,r){const D=F("ion-loading"),_=F("v2Datatable"),h=F("ion-page");return V(),L(h,null,{default:G(()=>[R(D,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),R(_,{title:"TX RTT Report","report-prefix":"Pepfar","icon-url":e.Img("login-logos/PEPFAR.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,headerBadge:e.headerBadge,onConfigure:e.configure,onRefresh:()=>e.generate(!0)},null,8,["icon-url","subtitle","columns","columnData","headerBadge","onConfigure","onRefresh"])]),_:1})}const ae=U(X,[["render",H]]);export{ae as default};
