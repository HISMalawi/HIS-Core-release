import{d as $,a5 as A,cm as x,r as b,t as B,aH as E,O as k,ad as q,aJ as P,c$ as I,aq as c,ah as O,d0 as N,d1 as S,cP as j,a6 as U,v as L,w as G,ab as F,u as V,x as R}from"./index-NAoeW21C.js";import{T as H}from"./tx_report_service-CnOm0QCF.js";import{v as J}from"./TableView-CAkie2ET.js";import{A as M}from"./v2utils-DrZa3lEx.js";import"./Export-BP7xcPGq.js";import"./index-C0WsZfbb.js";const W=$({components:{IonPage:A,IonLoading:x,v2Datatable:J},setup(){const e=b([]),m=b(""),f=b(!1),u=b([]),o=new H;function r(d,p){return{ref:p,label:d,toValue:a=>a.length,tdClick:async a=>{a.refData.length&&(await c.create({component:M,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"".concat(a.data.age_group," ").concat(a.data.gender," ").concat(a.column.label),patientIdentifiers:a.refData,onFinish:()=>c.getTop().then(i=>i&&c.dismiss())}})).present()}}}const D=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},r("CD4 <200","cd4_less_than_200"),r("CD4 >=200","cd4_greater_than_or_equal_to_200"),r("Unknown CD4","unknown_cd4_count"),r("Not Eligible for CD4","not_eligible_for_cd4"),r("Returned <3 mo","returned_less_than_3_months"),r("Returned 3-5 mo","returned_greater_than_3_months_and_less_than_6_months"),r("Returned 6+ mo","returned_greater_than_or_equal_to_6_months")]],_=async(d=!1)=>{o.startDate&&o.endDate||k("Start date and end date required!");const p=d&&await q("Do you want to rebuild report?");f.value=!0;try{const a=await o.getTxRttReport(p),i={F:"Female",M:"Male"},s=a.reduce((n,t)=>(t.age_group!="Unknown"&&(n[t.gender].rows.push({...t,gender:i[t.gender]}),n[t.gender].aggregate=Object.keys(t).reduce((g,l)=>Array.isArray(t[l])?{...g,[l]:[...g[l]||[],...t[l]]}:g,n[t.gender].aggregate)),n),{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...s.F.rows,...s.M.rows,{age_group:"All",gender:"Male",...s.M.aggregate}];const C=Object.values(s.F.aggregate).flat(1),v=await o.getMaternalStatus(P.uniq(C)),T=v.FBf.concat(v.FP);["FP","FNP","FBf"].forEach(n=>{e.value.push(Object.keys(s.F.aggregate).reduce((t,g)=>({...t,[g]:s.F.aggregate[g].filter(l=>n==="FNP"?!T.includes(l):v[n].includes(l))}),{age_group:"All",gender:n}))}),e.value=e.value.map((n,t)=>({index:t+1,...n}));const y=Object.values(s.M.aggregate).flat(1),w=P.uniq([...C,...y]);u.value=[{id:"stats",text:"Total <b>".concat(w.length,"</b>"),icon:I,color:"primary",action:async()=>{(await c.create({component:M,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"Total Clients",subtitle:m.value,patientIdentifiers:w,onFinish:()=>c.getTop().then(n=>n&&c.dismiss())}})).present()}}]}catch(a){console.error(a),O("Unable to generate report!"),u.value=[{text:"Unable to generate report!",color:"danger",icon:N,action:function(){u.value=[{text:"Exception occured: <b>".concat(a,"</b>"),color:"danger",icon:S}]}}]}f.value=!1},h=()=>j({onFinish:(d,p,a,i)=>{m.value=a,o.startDate=d,o.endDate=p,i&&o.setOccupation(i),_()}});return B(()=>h()),{headerBadge:u,reportData:e,isLoading:f,Img:E,configure:h,generate:_,columns:D,period:m}}});function X(e,m,f,u,o,r){const D=F("ion-loading"),_=F("v2Datatable"),h=F("ion-page");return V(),L(h,null,{default:G(()=>[R(D,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),R(_,{title:"TX RTT Report","report-prefix":"Pepfar","icon-url":e.Img("login-logos/PEPFAR.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,headerBadge:e.headerBadge,onConfigure:e.configure,onRefresh:()=>e.generate(!0)},null,8,["icon-url","subtitle","columns","columnData","headerBadge","onConfigure","onRefresh"])]),_:1})}const ae=U(W,[["render",X]]);export{ae as default};
