import{R as h}from"./TableReportTemplate-vw3YSnxU.js";import{d as _,I as v,K as l,V as p,O as s,t as f,L as i,_ as b,r as c,o as g,c as T,w as y,b as w}from"./index-BCTN_bnC.js";import{F as u}from"./dynamic-import-helper-BkBZiFw5.js";import{T as C}from"./tb_report_service-9cn-NYpY.js";import{_ as P}from"./ReportMixin.vue_vue_type_script_lang-DHsaLvda.js";import{T as x}from"./TBDrilldown-DUdE2mjU.js";import"./Export-nPQsqN2_.js";import"./HisStandardForm-CaDwl-hA.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./ReportErrors-Dkeo3N9I.js";import"./MultiFieldDateHelper-CQ4seieZ.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./BasicReportTemplate-ARrW1sF6.js";import"./SIngleTouchField-DeaPtOu6.js";import"./Pagination-141LZS_a.js";import"./TableView-Dtifi8zd.js";import"./PopupKeyboard-DWLNjJL8.js";import"./HisKeypad-iWtx_mcq.js";import"./BaseKeyboard-BdU8h7Jm.js";import"./KbHandler-BuQ4TFU6.js";import"./fuse-YdZE3OCN.js";import"./HisKeyboard-COmBOOo8.js";const B=_({mixins:[P],components:{IonPage:v,ReportTemplate:h},data:()=>({rows:[],reportIndicators:[],columns:l([[]]),subtitle:l("-"),data:l([]),yearValue:l(""),quarterValue:l(1),indicatorsValue:l([]),casesIndicators:[{label:"New Smear positive",value:"new_smear_positive"},{label:"New MTB Detected Xpert",value:"new_mtb_detected_xpert"},{label:"New Pulmonary Clinically Diagnosed",value:"new_pulmonary_clinically_diagnosed"},{label:"New EPTB",value:"new_eptb"},{label:"Relapse Bacteriologically Confirmed",value:"relapse_bacteriologically_confirmed"},{label:"Treatment Failure Bacteriologically Confirmed",value:"treatment_failure_bacteriologically_confirmed"},{label:"Treatment LTF Bacteriologically Confirmed",value:"treatment_ltf_bacteriologically_confirmed"},{label:"Treatment LTF Clinically Diagnosed Pulmonary",value:"treatment_ltf_clinically_diagnosed_pulmonary"},{label:"Treatment LTF EPTB",value:"treatment_ltf_eptb"},{label:"Relapse Clinical Pulmonary",value:"relapse_clinical_pulmonary"},{label:"Relapse EPTB",value:"relapse_eptb"},{label:"Other Previously Treated Bacteriologically Confirmed",value:"other_previously_treated_bacteriologically_confirmed"},{label:"Other Previously Treated Clinical Pulmonary",value:"other_previously_treated_clinical_pulmonary"},{label:"Other Previously Treated EPTB",value:"other_previously_treated_eptb"},{label:"Unknown Previous Treatment History Bacteriological",value:"unknown_previous_treatment_history_bacteriological"},{label:"Unknown Previous Treatment History EPTB",value:"unknown_previous_treatment_history_eptb"}],presumptiveIndicators:[{label:"Patients with Presumptive TB Undergoing Bacteriological Examination Via Xpert",value:"patients_with_presumptive_tb_undergoing_bacteriological_examination_via_xpert"},{label:"Patients with Presumptive TB Undergoing Bacteriological Examination Via Microscopy",value:"patients_with_presumptive_tb_undergoing_bacteriological_examination_via_microscopy"},{label:"Patients with Presumptive TB with Positive Bacteriological Examination Via Xpert",value:"patients_with_presumptive_tb_with_positive_bacteriological_examination_via_xpert"},{label:"Patients with Presumptive TB with Positive Bacteriological Examination Via Microscopy",value:"patients_with_presumptive_tb_with_positive_bacteriological_examination_via_microscopy"}],reportConfig:[],age_groups:["0-4","5-14","15-24","25-34","35-44","45-54","55-64","65+"]}),mounted(){this.init()},methods:{init(){this.reportIndicators=[...this.casesIndicators,...this.presumptiveIndicators],this.reportConfig=[{id:"year",helpText:"Year",type:u.TT_NUMBER,validation:e=>p.required(e),computedValue:e=>e.value},{id:"quater",helpText:"Quater",type:u.TT_SELECT,requireNext:!1,options:()=>[{label:"First",value:1},{label:"Second",value:2},{label:"Third",value:3},{label:"Fourth",value:4}],validation:e=>p.required(e),computedValue:e=>e.value},{id:"indicators",helpText:"Indicators",type:u.TT_MULTIPLE_SELECT,options:()=>this.reportIndicators,validation:e=>p.required(e),computedValue:e=>e.map(t=>t.value),config:{footerBtns:[{name:"Cases",slot:"end",onClickComponentEvents:{refreshOptions:()=>{const e=this.casesIndicators.map(t=>t.value);return this.reportIndicators.map(t=>(e.includes(t.value)?t.isChecked=!0:t.isChecked=!1,t))}},onClick:()=>"None"},{name:"Presumptives",slot:"end",onClickComponentEvents:{refreshOptions:()=>{const e=this.presumptiveIndicators.map(t=>t.value);return this.reportIndicators.map(t=>(e.includes(t.value)?t.isChecked=!0:t.isChecked=!1,t))}},onClick:()=>"None"}]}}]},async generate(e){try{this.rows=[],this.columns=this.buildColumns(e.indicators.map(a=>a.label)),this.indicatorsValue=e.indicators.map(a=>a.value),this.yearValue=e.year.value,this.quarterValue=e.quater.value;const t=new C;this.data=await t.getTBCaseFindingReport(this.yearValue,this.quarterValue,this.indicatorsValue),this.pushGenderAggregatedHeaders(),this.populateRows(),this.addTotals(),s.getTop().then(a=>a&&s.dismiss())}catch(t){console.error(t),f("Unable to generate report")}},addTotals(){let e=this.data.flatMap(t=>{const a=Object.values(t).reduce((n,o)=>o&&o.male&&o.male.length>0?o.male:n,[]),r=Object.values(t).reduce((n,o)=>o&&o.female&&o.female.length>0?o.female:n,[]);return[a,r]});e=e.map(t=>this.toDrillColumn("total",{total:t,indicator:""})),e.unshift(i.td("Totals")),this.rows.push(e)},populateRows(){this.rows=this.age_groups.map(e=>{const t=[];return t.push(i.td(e)),this.data.forEach(a=>{const r=a[e];t.push(r?this.toDrillColumn("male",r):i.td(0)),t.push(r?this.toDrillColumn("female",r):i.td(0))}),t})},pushGenderAggregatedHeaders(){this.columns[1]=[],this.columns[1].push(i.thTxt("",{sortable:!1,exportable:!1}));for(let e=0;e<this.indicatorsValue.length;e++)this.columns[1].push(i.thTxt("M",{sortable:!1,exportable:!1}),i.thTxt("F",{sortable:!1,exportable:!1}))},toDrillColumn(e,t){return t[e].length==0?i.td(0):i.tdLink(t[e].length,()=>{this.drilldown({indicator:t.indicator,ids:[t[e]]})})},async drilldown(e){(await s.create({component:x,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e.indicator,patientIdentifiers:e.ids,subtitle:"Period: ".concat(this.period," Q").concat(this.quarterValue),onFinish:()=>s.getTop().then(t=>t&&s.dismiss())}})).present()},buildColumns(e){const t=[[i.thTxt("",{sortable:!1,exportable:!1}),i.thTxt("Age Category",{sortable:!1,exportable:!1})]];return e.forEach(a=>{t[0].push(i.thTxt(a,{colspan:2,sortable:!1,exportable:!0}))}),t}}});function I(e,t,a,r,n,o){const m=c("report-template"),d=c("ion-page");return g(),T(d,null,{default:y(()=>[w(m,{title:"TB Case Finding Report",period:"Period",rows:e.rows,fields:e.reportConfig,columns:e.columns,reportPrefix:"NTP",config:{showIndex:!0},onReportConfiguration:e.generate},null,8,["rows","fields","columns","onReportConfiguration"])]),_:1})}const ee=b(B,[["render",I]]);export{ee as default};
