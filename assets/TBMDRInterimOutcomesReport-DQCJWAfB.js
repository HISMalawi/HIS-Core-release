import{R as h}from"./TableReportTemplate-CRKA8rFt.js";import{d as f,I as T,r as s,ad as u,ae as d,au as i,W as b,as as a,aa as _,c as v,w as g,af as p,a as C,b as x}from"./index-CMZASHAR.js";import{T as w}from"./tb_report_service-ieivoNuZ.js";import{_ as V}from"./ReportMixin.vue_vue_type_script_lang-CqLvuQmv.js";import{T as I}from"./TBDrilldown-3mkfgdTt.js";import"./Export-CpyT9Gk1.js";import"./index-_zuoFVCp.js";import"./HisStandardForm-BCjM4-bc.js";import"./ReportErrors-JbEvJfLt.js";import"./BasicReportTemplate-CbJ_oMga.js";import"./Pagination-D_B_LriE.js";import"./TableView-DhTjQT8r.js";const D=f({mixins:[V],components:{IonPage:T,ReportTemplate:h},data:()=>({rows:[],columns:s([[]]),subtitle:s("-"),data:s([]),yearValue:s(""),quarterValue:s(1),indicatorsValue:s([]),footerText:s("Select All"),reportIndicators:[{label:"Culture positive",value:"culture_positive"},{label:"Culture negative",value:"culture_negative"},{label:"Culture and smear not done",value:"culture_and_smear_not_done"},{label:"Transfer out",value:"transfer_out"},{label:"Died",value:"died"},{label:"Lost to follow up",value:"lost_to_follow_up"}],reportConfig:[],age_groups:["0-4","5-14","15-24","25-34","35-44","45-54","55-64","65+"]}),mounted(){this.init()},methods:{init(){this.reportConfig=[{id:"year",helpText:"Year",type:u.TT_NUMBER,validation:e=>d.required(e),computedValue:e=>e.value},{id:"quater",helpText:"Quater",type:u.TT_SELECT,requireNext:!1,options:()=>[{label:"First",value:1},{label:"Second",value:2},{label:"Third",value:3},{label:"Fourth",value:4}],validation:e=>d.required(e),computedValue:e=>e.value},{id:"indicators",helpText:"Indicators",type:u.TT_MULTIPLE_SELECT,options:()=>this.reportIndicators,validation:e=>d.required(e),computedValue:e=>e.map(t=>t.value),config:{footerBtns:[{name:this.footerText,slot:"end",onClickComponentEvents:{refreshOptions:()=>this.footerText==="Select All"?this.selectAll():this.deSelectAll()},onClick:()=>"None"}]}}]},async generate(e){try{this.rows=[],this.columns=this.buildColumns(e.indicators.map(o=>o.label)),this.indicatorsValue=e.indicators.map(o=>o.value),this.yearValue=e.year.value,this.quarterValue=e.quater.value;const t=new w;this.data=await t.getTBDRInterimOutcomesReport(this.yearValue,this.quarterValue,this.indicatorsValue),this.pushGenderAggregatedHeaders(),this.populateRows(),this.addTotals(),i.getTop().then(o=>o&&i.dismiss())}catch(t){console.error(t),b("Unable to generate report")}},addTotals(){let e=this.data.flatMap(t=>{const o=Object.values(t).reduce((n,r)=>r&&r.male&&r.male.length>0?r.male:n,[]),l=Object.values(t).reduce((n,r)=>r&&r.female&&r.female.length>0?r.female:n,[]);return[o,l]});e=e.map(t=>this.toDrillColumn("total",{total:t,indicator:""})),e.unshift(a.td("Totals")),this.rows.push(e)},populateRows(){this.rows=this.age_groups.map(e=>{const t=[];return t.push(a.td(e)),this.data.forEach(o=>{const l=o[e];t.push(l?this.toDrillColumn("male",l):a.td(0)),t.push(l?this.toDrillColumn("female",l):a.td(0))}),t})},pushGenderAggregatedHeaders(){this.columns[1]=[],this.columns[1].push(a.thTxt("",{sortable:!1,exportable:!1}));for(let e=0;e<this.indicatorsValue.length;e++)this.columns[1].push(a.thTxt("M",{sortable:!1,exportable:!1}),a.thTxt("F",{sortable:!1,exportable:!1}))},toDrillColumn(e,t){return t[e].length==0?a.td(0):a.tdLink(t[e].length,()=>{this.drilldown({indicator:t.indicator,ids:[t[e]]})})},async drilldown(e){(await i.create({component:I,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e.indicator,patientIdentifiers:e.ids,subtitle:"Period: ".concat(this.period," Q").concat(this.quarterValue),onFinish:()=>i.getTop().then(t=>t&&i.dismiss())}})).present()},buildColumns(e){const t=[[a.thTxt("",{sortable:!1,exportable:!1}),a.thTxt("Age Category",{sortable:!1,exportable:!1})]];return e.forEach(o=>{t[0].push(a.thTxt(o,{colspan:2,sortable:!1,exportable:!0}))}),t},deSelectAll(){const e=this.reportIndicators;return this.footerText="Select All",e.map(t=>({...t,isChecked:!1}))},selectAll(){const e=this.reportIndicators;return this.footerText="Deselect All",e.map(t=>({...t,isChecked:!0}))}}});function R(e,t,o,l,n,r){const c=p("report-template"),m=p("ion-page");return C(),v(m,null,{default:g(()=>[x(c,{title:"MDR Interim Outcomes",period:"Period",rows:e.rows,fields:e.reportConfig,columns:e.columns,reportPrefix:"NTP",config:{showIndex:!0},onReportConfiguration:e.generate},null,8,["rows","fields","columns","onReportConfiguration"])]),_:1})}const F=_(D,[["render",R]]);export{F as default};
