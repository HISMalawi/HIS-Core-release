import{d as M,r as c,t as I,u as q,v as V,w as N,x as O,y as S,dQ as U,a9 as F,aa as $,a5 as A,aJ as X,O as j,c$ as f,aq as b}from"./index-BY8l3Vlw.js";import{v as H}from"./TableView-JK_S0K3F.js";import{T as Q}from"./tb_report_service-dmWiDKNP.js";import{w as G,d as J}from"./v2utils-CzhqV1Lq.js";import{T as W}from"./TBDrilldown-B-i76HW8.js";import"./Export-BUNiM-87.js";import"./index-BK3yxlfM.js";const se=M({__name:"TBCaseFindingReport",setup(Y){const R=new Q,_=c([]),y=c(""),u=c(""),p=c(""),r=c([]),h=c([]),T=c([]),k=["0-4","5-14","15-24","25-34","35-44","45-54","55-64","65+"],n=[{label:"New Smear positive",ref:"new_smear_positive",tags:["cases"]},{label:"New MTB Detected Xpert",ref:"new_mtb_detected_xpert",tags:["cases"]},{label:"New Pulmonary Clinically Diagnosed",ref:"new_pulmonary_clinically_diagnosed",tags:["cases"]},{label:"New EPTB",ref:"new_eptb",tags:["cases"]},{label:"Relapse Bacteriologically Confirmed",ref:"relapse_bacteriologically_confirmed",tags:["cases"]},{label:"Treatment Failure Bacteriologically Confirmed",ref:"treatment_failure_bacteriologically_confirmed",tags:["cases"]},{label:"Treatment LTF Bacteriologically Confirmed",ref:"treatment_ltf_bacteriologically_confirmed",tags:["cases"]},{label:"Treatment LTF Clinically Diagnosed Pulmonary",ref:"treatment_ltf_clinically_diagnosed_pulmonary",tags:["cases"]},{label:"Treatment LTF EPTB",ref:"treatment_ltf_eptb",tags:["cases"]},{label:"Relapse Clinical Pulmonary",ref:"relapse_clinical_pulmonary",tags:["cases"]},{label:"Relapse EPTB",ref:"relapse_eptb",tags:["cases"]},{label:"Other Previously Treated Bacteriologically Confirmed",ref:"other_previously_treated_bacteriologically_confirmed",tags:["cases"]},{label:"Other Previously Treated Clinical Pulmonary",ref:"other_previously_treated_clinical_pulmonary",tags:["cases"]},{label:"Other Previously Treated EPTB",ref:"other_previously_treated_eptb",tags:["cases"]},{label:"Unknown Previous Treatment History Bacteriological",ref:"unknown_previous_treatment_history_bacteriological",tags:["cases"]},{label:"Unknown Previous Treatment History EPTB",ref:"unknown_previous_treatment_history_eptb",tags:["cases"]},{label:"Patients with Presumptive TB Undergoing Bacteriological Examination Via Xpert",ref:"patients_with_presumptive_tb_undergoing_bacteriological_examination_via_xpert",tags:["presumptives"]},{label:"Patients with Presumptive TB Undergoing Bacteriological Examination Via Microscopy",ref:"patients_with_presumptive_tb_undergoing_bacteriological_examination_via_microscopy",tags:["presumptives"]},{label:"Patients with Presumptive TB with Positive Bacteriological Examination Via Xpert",ref:"patients_with_presumptive_tb_with_positive_bacteriological_examination_via_xpert",tags:["presumptives"]},{label:"Patients with Presumptive TB with Positive Bacteriological Examination Via Microscopy",ref:"patients_with_presumptive_tb_with_positive_bacteriological_examination_via_microscopy",tags:["presumptives"]}];async function L(e,s){(await b.create({component:W,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e,patientIdentifiers:s,onFinish:()=>b.getTop().then(o=>o&&b.dismiss())}})).present()}function m(){const e=[{label:"#",ref:"index",span:{thRowspan:2}},{label:"Age Category",ref:"age_group",span:{thRowspan:2}},...r.value.map(o=>({...o,ref:"",span:{thColspan:2}}))],s=r.value.reduce((o,a)=>{const i=l=>({label:l,ref:"".concat(a.ref,"_").concat(l.toLowerCase()),secondaryLabel:"".concat(a.label," (").concat(l==="M"?"Male":"Female",")"),toValue:t=>"".concat(t.length),tdClick:t=>t.refData.length&&L(a.label,t.refData)});return[...o,i("F"),i("M")]},[]);T.value=[e,s]}const g=()=>G(async()=>{if(!(u.value&&p.value))return j("Year and quarter are required!");const s=(await R.getTBCaseFindingReport(u.value,parseInt("".concat(p.value)),r.value.map(a=>a.ref))).reduce((a,i)=>{const{indicator:l,...t}=i;return{...a,[l]:t}},{}),o=k.reduce((a,i)=>{const l={age_group:i};return Object.keys(s).forEach(t=>{var B,x,E,D;const d="".concat(t,"_m"),v="".concat(t,"_f"),C=s[t][i].male,P=s[t][i].female;l[d]=C,l[v]=P,a.aggregates={...a.aggregates,[d]:[...(x=(B=a.aggregates)==null?void 0:B[d])!=null?x:[],...C],[v]:[...(D=(E=a.aggregates)==null?void 0:E[v])!=null?D:[],...P]}}),a.rows.push(l),a},{aggregates:{},rows:[]});return _.value=J([...o.rows,{age_group:"Totals",...o.aggregates}]),h.value=[{text:"All",icon:f,color:"primary",action:()=>{r.value=n,m(),g()}},{text:"Show Presumptives",icon:f,color:"primary",action:()=>{r.value=n.filter(a=>a.tags.includes("presumptives")),m(),g()}},{text:"Cases",icon:f,color:"primary",action:()=>{r.value=n.filter(a=>a.tags.includes("cases")),m(),g()}}],!0}),w=()=>U([{id:"indicator",helpText:"Indicators",type:F.TT_SELECT,validation:e=>$.required(e),options:()=>[{label:"All",value:"all",other:()=>n},{label:"Cases",value:"cases",other:()=>n.filter(e=>e.tags.includes("cases"))},{label:"Presumptives",value:"presumptives",other:()=>n.filter(e=>e.tags.includes("presumptives"))},{label:"Custom Indicators",value:"custom"}]},{id:"custom",helpText:"Custom indicators",type:F.TT_MULTIPLE_SELECT,validation:e=>$.required(e),condition:e=>e.indicator.value==="custom",options:()=>n.map(e=>({label:e.label,value:e.ref,other:e}))}],e=>{_.value=[],r.value=[],u.value=e.year.value,p.value=e.quarter.value,y.value="Q".concat(p.value," ").concat(u.value),typeof e.indicator.other=="function"?r.value=e.indicator.other():X.isEmpty(e.custom)||(r.value=e.custom.map(s=>s.other)),r.value.length&&(m(),g())});return I(()=>w()),(e,s)=>(q(),V(S(A),null,{default:N(()=>[O(H,{title:"TB Case Finding Report",subtitle:y.value,columns:T.value,columnData:_.value,headerBadge:h.value,rowsPerPage:100,onConfigure:w},null,8,["subtitle","columns","columnData","headerBadge"])]),_:1}))}});export{se as default};
