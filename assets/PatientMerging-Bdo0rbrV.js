import{d as R,ak as F,h as k,b as d,g as i,j as u,t as p,bb as v,b$ as z,a5 as K,b0 as L,c0 as U,a4 as j,l as q,ad as G,ac as O,I as W,k as Z,ai as J,n as Q,b4 as X,at as C,aZ as b,au as Y,E as x,bq as tt,y as et,ap as o,a as c,w as n,e as s,a6 as P,a9 as w,aa as D}from"./index-DO7Erl4-.js";const it=R({props:{patient:{type:Object,required:!0},isActive:{type:Boolean}},computed:{stateClass(){return{"active-card-color":this.isActive,"inactive-card-color":!this.isActive}}}});function nt(e,t,r,y,f,g){return d(),k("div",{class:v(["his-card clickable",e.stateClass])},[i("li",null,[i("ul",null,[t[0]||(t[0]=u(" NPID : ",-1)),i("b",null,p(e.patient.npid),1)]),i("ul",null,[t[1]||(t[1]=u(" Arv# : ",-1)),i("b",null,p(e.patient.arvNum),1)]),i("ul",null,[t[2]||(t[2]=u(" Name : ",-1)),i("b",null,p(e.patient.name),1)]),i("ul",null,[t[3]||(t[3]=u(" Birth date : ",-1)),i("b",null,p(e.patient.birthdate),1)]),i("ul",null,[t[4]||(t[4]=u(" Gender : ",-1)),i("b",null,p(e.patient.gender),1)]),i("ul",null,[t[5]||(t[5]=u(" Home District : ",-1)),i("b",null,p(e.patient.homeDistrict),1)]),i("ul",null,[t[6]||(t[6]=u(" Home Village : ",-1)),i("b",null,p(e.patient.homeVillage),1)]),i("ul",null,[t[7]||(t[7]=u(" Current District : ",-1)),i("b",null,p(e.patient.currentDistrict),1)]),i("ul",null,[t[8]||(t[8]=u(" Current Village : ",-1)),i("b",null,p(e.patient.currentVillage),1)])])],2)}const st=F(it,[["render",nt],["__scopeId","data-v-aae064fb"]]),at=R({components:{PatientCard:st,IonPage:Q,IonInput:J,IonButton:Z,IonContent:W,IonRow:O,IonCol:G,IonFooter:q,IonHeader:j,ViewPort:U,HisKeyboard:L,IonTitle:K},data:()=>({inputA:"",inputB:"",isSubmitting:!1,inputFocus:"inputA",inputASearchResults:[],inputBSearchResults:[],activeInputACard:{},keyboard:[z,[["","Hide"],["Space","Delete"],["inputA","inputB"],["Search","Clear"]]]}),computed:{canMerge(){return!b.isEmpty(this.activeInputACard)&&!b.isEmpty(this.inputBSearchResults.filter(e=>e.isChecked))}},methods:{async onMerge(){if(await Y("Are you sure you want to merge selected Persons?")){try{this.isSubmitting=!0;const e=await C.mergePatients({primary:{patient_id:this.activeInputACard.id,doc_id:this.activeInputACard.docID},secondary:this.inputBSearchResults.filter(r=>r.isChecked).map(r=>({patient_id:r.id,doc_id:r.docID}))});await x(e.patient_id),this.inputBSearchResults=this.inputBSearchResults.filter(r=>!r.isChecked);const t=await tt.getNextTaskParams(e.patient_id);this.$router.push(t.name?t:"/patient/dashboard/".concat(e.patient_id))}catch(e){et("".concat(e))}this.isSubmitting=!1}},onPrimaryPatient(e){this.inputBSearchResults.forEach(t=>{t.id===e.id&&(this.inputBSearchResults[t.index].isChecked=!1)}),this.activeInputACard=e},onSecondaryPatient(e){if(e.isChecked)return this.inputBSearchResults[e.index].isChecked=!1;!b.isEmpty(this.activeInputACard)&&e.id!=this.activeInputACard.id&&(this.inputBSearchResults[e.index].isChecked=!0)},async searchPatient(e){const[t,r]=e.split(" ");return(await C.search({given_name:t,family_name:r})).map((f,g)=>{const a=new C(f);return{index:g,id:a.getID(),name:a.getFullName(),docID:a.getDocID(),birthdate:a.getBirthdate(),arvNum:a.getArvNumber(),npid:a.getNationalID(),gender:a.getGender(),homeDistrict:a.getHomeDistrict(),homeVillage:a.getHomeVillage(),currentDistrict:a.getCurrentDistrict(),currentVillage:a.getCurrentVillage(),isChecked:!1}})},async keypress(e){if(!this.inputFocus)return;let t=X(e,this[this.inputFocus]);t.match(/hide/i)?this.inputFocus="":t.match(/search/i)?(t=t.replace("Search",""),this.inputFocus==="inputA"?(this.inputASearchResults=await this.searchPatient(t),this.activeInputACard={}):this.inputBSearchResults=await this.searchPatient(t),this.inputFocus=""):t.match(/inputA/i)?this.inputFocus="inputA":t.match(/inputB/i)?this.inputFocus="inputB":t.match(/clear/i)?(this[this.inputFocus]="",this.inputFocus==="inputA"?this.inputASearchResults=[]:this.inputBSearchResults=[]):this[this.inputFocus]=t}}}),ot={class:"result-section"},lt={class:"result-section"};function ut(e,t,r,y,f,g){const a=o("ion-title"),A=o("ion-toolbar"),V=o("ion-header"),S=o("ion-input"),m=o("ion-col"),_=o("ion-row"),I=o("patient-card"),$=o("view-port"),N=o("his-keyboard"),E=o("ion-content"),B=o("ion-button"),H=o("ion-footer"),M=o("ion-page");return d(),c(M,null,{default:n(()=>[s(V,null,{default:n(()=>[s(A,null,{default:n(()=>[s(a,{class:"his-lg-text"},{default:n(()=>[...t[4]||(t[4]=[u("Merge Clients",-1)])]),_:1})]),_:1})]),_:1}),s(E,null,{default:n(()=>[s($,null,{default:n(()=>[s(_,null,{default:n(()=>[s(m,null,{default:n(()=>[s(S,{onClick:t[0]||(t[0]=l=>e.inputFocus="inputA"),placeholder:"Primary patient",class:v(["input_display",{"input-focused":e.inputFocus==="inputA"}]),modelValue:e.inputA,"onUpdate:modelValue":t[1]||(t[1]=l=>e.inputA=l)},null,8,["modelValue","class"])]),_:1}),s(m,null,{default:n(()=>[s(S,{onClick:t[2]||(t[2]=l=>e.inputFocus="inputB"),class:v(["input_display",{"input-focused":e.inputFocus==="inputB"}]),placeholder:"Secondary patient",modelValue:e.inputB,"onUpdate:modelValue":t[3]||(t[3]=l=>e.inputB=l)},null,8,["modelValue","class"])]),_:1})]),_:1}),s(_,null,{default:n(()=>[s(m,null,{default:n(()=>[i("div",ot,[(d(!0),k(w,null,D(e.inputASearchResults,(l,h)=>(d(),c(I,{onClick:T=>e.onPrimaryPatient(l),key:h,patient:l,isActive:e.activeInputACard.index===h},null,8,["onClick","patient","isActive"]))),128))])]),_:1}),s(m,null,{default:n(()=>[i("div",lt,[(d(!0),k(w,null,D(e.inputBSearchResults,(l,h)=>(d(),c(I,{onClick:T=>e.onSecondaryPatient(l),key:h,patient:l,isActive:l.isChecked},null,8,["onClick","patient","isActive"]))),128))])]),_:1})]),_:1})]),_:1}),e.inputFocus?(d(),c(N,{key:0,kbConfig:e.keyboard,onKeyPress:e.keypress},null,8,["kbConfig","onKeyPress"])):P("",!0)]),_:1}),s(H,null,{default:n(()=>[s(A,{color:"dark"},{default:n(()=>[s(B,{color:"danger",size:"large","router-link":"/"},{default:n(()=>[...t[5]||(t[5]=[u(" Cancel ",-1)])]),_:1}),e.canMerge?(d(),c(B,{key:0,disabled:e.isSubmitting,color:"success",size:"large",slot:"end",onClick:e.onMerge},{default:n(()=>[...t[6]||(t[6]=[u(" Merge ",-1)])]),_:1},8,["disabled","onClick"])):P("",!0)]),_:1})]),_:1})]),_:1})}const pt=F(at,[["render",ut],["__scopeId","data-v-c94412aa"]]);export{pt as default};
