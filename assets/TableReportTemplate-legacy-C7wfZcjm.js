System.register(["./index-legacy-D2iCn0VZ.js","./Export-legacy-DnoNrSHG.js","./HisStandardForm-legacy-DWEtuKgE.js","./ReportErrors-legacy-qIji0wgd.js"],(function(t,e){"use strict";var o,i,r,s,a,n,l,c,h,u,p,d,m,f,y,g,w,b,v,C,D,F,S,P,R,k,E,I,x,A,_,B,L,V,T,H,$,M,O,U,j,z,N,q;return{setters:[t=>{o=t.d,i=t.S,r=t.c8,s=t.a7,a=t.c9,n=t.ah,l=t.l,c=t.b8,h=t.m,u=t.I,p=t.n,d=t.cv,m=t.aw,f=t.a4,y=t.cw,g=t.aZ,w=t.au,b=t.aY,v=t.bq,C=t.y,D=t.cj,F=t.B,S=t.z,P=t.x,R=t.ak,k=t.h,E=t.aL,I=t.a,x=t.a6,A=t.cx,_=t.e,B=t.w,L=t.ap,V=t.g,T=t.j,H=t.t,$=t.a9,M=t.aa,O=t.b,U=t.cy},t=>{j=t.a,z=t.t},t=>{N=t.H},t=>{q=t.R}],execute:function(){var e=document.createElement("style");e.textContent=".logo[data-v-6ccbfe61]{width:60px;margin:auto}.header-text-list[data-v-6ccbfe61]{list-style:none}.report-content[data-v-6ccbfe61]{margin:auto;width:99.9%;height:99%;overflow:auto}a[data-v-6ccbfe61]{text-decoration:none;font-weight:600;font-size:1em}\n/*$vite$:1*/",document.head.appendChild(e);const Y=o({components:{HisStandardForm:N,IonHeader:f,ReportTable:m,HisFooter:d,IonPage:p,IonContent:u,IonToolbar:h,IonChip:c,IonFooter:l,IonLabel:n,IonThumbnail:a,IonItem:s,IonImg:r},props:{encryptPDF:{type:Boolean,default:!1},showValidationStatus:{type:Boolean,default:!1},validationErrors:{type:Array,default:()=>[]},config:{type:Object},headerInfoList:{type:Array,default:()=>[]},reportPrefix:{type:String,default:""},reportLogo:{type:String},showtitleOnly:{type:Boolean,default:!1},title:{type:String,required:!0},period:{type:String},showFilters:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},columns:{type:Object,required:!0},rows:{type:Object,required:!0},customBtns:{type:Array,default:()=>[]},hasServerSideCaching:{type:Boolean,default:!1},canExportPDf:{type:Boolean,default:!0},canExportCsv:{type:Boolean,default:!0},enabledPDFHorizontalPageBreak:{type:Boolean,default:!1},onFinishBtnAction:{type:Function},onReportConfiguration:{type:Function,required:!0},onDefaultConfiguration:{type:Function},customFileName:{type:String,default:""}},data:()=>({date:"",formData:{},btns:[],computeFormData:{},activeColumns:[],activeRows:[],isLoadingData:!1,canShowReport:!1,siteUUID:i.getSiteUUID(),apiVersion:i.getApiVersion(),coreVersion:i.getCoreVersion(),artVersion:i.getAppVersion(),tableCssTheme:"art-report-theme"}),watch:{validationErrors:{handler(t){b.isEmpty(t)||this.showErrors()},deep:!0,immediate:!0},fields:{handler(t){b.isEmpty(t)?(this.canShowReport=!0,this.refreshTimeStamp()):(this.canShowReport=!1,this.btns.forEach((t=>{"Back"===t.name&&(t.visible=!0)})))},immediate:!0}},computed:{logo(){if(!this.reportLogo&&"string"==typeof this.reportPrefix){if(this.reportPrefix.match(/pepfar/i))return P("login-logos/PEPFAR.png");if(this.reportPrefix.match(/moh/i))return P("login-logos/Malawi-Coat_of_arms_of_arms.png")}return P("reports.png")},hasErrors(){return!b.isEmpty(this.validationErrors)},errorCount(){return this.validationErrors?this.validationErrors.length:0},footerRows(){const t=[[`Date Created: ${this.date}`]];return this.period&&t.push([`Quarter: ${this.period}`]),t.push([`HIS-Core Version: ${this.coreVersion}`]),t.push([`API Version: ${this.apiVersion}`]),t.push([`Site UUID: ${this.siteUUID}`]),t.push([`Generated by: ${i.getUserName()}`]),t}},methods:{async showErrors(){(await S.create({component:q,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:this.validationErrors}})).present()},pdfEncryptionData(){const t=i.getUserName();return{encryption:{userPassword:t,ownerPassword:t,userPermissions:["print"]}}},refreshTimeStamp(){this.date=F().format("DD/MMM/YYYY HH:MM:ss")},onActiveColumns(t){this.activeColumns=t},onActiveRows(t){this.activeRows=t},getFileName(){return this.customFileName||`${this.reportPrefix} ${i.getLocationName()} ${D(this.title).replace(this.reportPrefix,"")} ${this.period??this.date}`},async onLoadDefault(){this.canShowReport=!0,await this.presentLoading();try{this.refreshTimeStamp(),this.onDefaultConfiguration&&await this.onDefaultConfiguration(),v.dismiss()}catch(t){C(`${t}`),console.error(t),v.dismiss()}},async onFinish(t,e,o=!1){this.formData=t,this.computeFormData=e,this.canShowReport=!0,await this.presentLoading();try{this.refreshTimeStamp(),await this.onReportConfiguration(this.formData,this.computeFormData,o),v.dismiss()}catch(i){C(`${i}`),console.error(i),v.dismiss()}},async reloadReport(t=!1){b.isEmpty(this.formData)&&b.isEmpty(this.computeFormData)?this.onDefaultConfiguration&&await this.onLoadDefault():await this.onFinish(this.formData,this.computeFormData,t)},async presentLoading(){const t=await v.create({message:"Please wait...",backdropDismiss:!1});await t.present()}},created(){this.onDefaultConfiguration&&this.onLoadDefault(),this.btns=this.customBtns,this.btns.push({name:"CSV",size:"large",slot:"start",color:"primary",visible:this.canExportCsv,onClick:async()=>{const{columns:t,rows:e}=y(this.activeColumns,this.activeRows,"csvMode");j(t,[...e,...this.footerRows],this.getFileName())}}),this.btns.push({name:"PDF",size:"large",slot:"start",color:"primary",visible:this.canExportPDf,onClick:async()=>{let t="pdfMode";this.encryptPDF&&(t="Secure PDF"===await g("Security warning","PDF may contain private data that will require a password to unlock","To access private data choose Secure PDF over Regular PDF",[{name:"Secure PDF",slot:"start",color:"success"},{name:"Regular PDF",slot:"start",color:"success"}],"his-danger-color")?"pdfMode":"ignorePDFColumnexport");const{columns:e,rows:o}=y(this.activeColumns,this.activeRows,t);z(e,o,this.getFileName(),this.enabledPDFHorizontalPageBreak,this.encryptPDF&&"ignorePDFColumnexport"!=t?this.pdfEncryptionData():{})}}),this.btns.push({name:"Refresh/Rebuild",size:"large",slot:"end",color:"warning",visible:!0,onClick:async()=>{let t=!1;this.hasServerSideCaching&&(t=await w("Do you want to rebuild report cache?",{header:"Rebuild Report"})),this.reloadReport(t)}}),this.btns.push({name:"Back",size:"large",slot:"end",color:"primary",visible:!b.isEmpty(this.fields),onClick:()=>this.canShowReport=!1}),this.btns.push({name:"Finish",size:"large",slot:"end",color:"success",visible:!0,onClick:()=>{this.onFinishBtnAction?this.onFinishBtnAction():this.$router.push({path:"/"})}})}}),G=["innerHTML"],Q={class:"header-text-list"},Z=["onClick"],J={key:1},K=["innerHTML"],W={key:0},X={class:"report-content"};t("R",R(Y,[["render",function(t,e,o,i,r,s){const a=L("his-standard-form"),n=L("ion-title"),l=L("ion-img"),c=L("ion-thumbnail"),h=L("ion-chip"),u=L("ion-label"),p=L("ion-item"),d=L("ion-toolbar"),m=L("ion-header"),f=L("report-table"),y=L("ion-content"),g=L("ion-footer"),w=L("his-footer"),b=L("ion-page");return O(),k($,null,[E(_(a,{onOnFinish:t.onFinish,skipSummary:!0,fields:t.fields},null,8,["onOnFinish","fields"]),[[A,!t.canShowReport]]),t.canShowReport?(O(),I(b,{key:0},{default:B((()=>[_(m,null,{default:B((()=>[_(d,null,{default:B((()=>[t.showtitleOnly?(O(),I(n,{key:0},{default:B((()=>[V("span",{innerHTML:t.title},null,8,G)])),_:1})):x("",!0),t.showtitleOnly?x("",!0):(O(),I(p,{key:1},{default:B((()=>[_(c,{slot:"start"},{default:B((()=>[_(l,{src:t.logo},null,8,["src"])])),_:1}),_(u,null,{default:B((()=>[V("ul",Q,[V("li",null,[e[0]||(e[0]=T("Title ",-1)),V("b",null,H(t.title),1)]),V("li",null,[e[1]||(e[1]=T("Period ",-1)),V("b",null,H(t.period),1)]),(O(!0),k($,null,M(t.headerInfoList,((t,e)=>(O(),k("li",{key:e},[T(H(t.label)+" ",1),t&&t?.other?.onclick?(O(),k("a",{key:0,href:"#",onClick:U((e=>t.other.onclick()),["prevent"])},H(t.value),9,Z)):x("",!0),t&&!t?.other?.onclick?(O(),k("b",J,[V("span",{innerHTML:t.value},null,8,K)])):x("",!0)])))),128)),t.showValidationStatus?(O(),k("li",W,[t.hasErrors?(O(),I(h,{key:0,onClick:t.showErrors,color:"danger"},{default:B((()=>[V("b",null,H(t.errorCount),1),e[2]||(e[2]=T(" Error(s) found. Click for more ",-1))])),_:1},8,["onClick"])):x("",!0),t.hasErrors?x("",!0):(O(),I(h,{key:1,color:"success"},{default:B((()=>[...e[3]||(e[3]=[T(" Report is Consistent ",-1)])])),_:1}))])):x("",!0)])])),_:1})])),_:1}))])),_:1})])),_:1}),_(y,null,{default:B((()=>[V("div",X,[_(f,{rows:t.rows,columns:t.columns,showFilters:t.showFilters,config:{...t.config,tableCssTheme:t.tableCssTheme},onOnActiveColumns:t.onActiveColumns,onOnActiveRows:t.onActiveRows},null,8,["rows","columns","showFilters","config","onOnActiveColumns","onOnActiveRows"])])])),_:1}),_(g,null,{default:B((()=>[_(d,null,{default:B((()=>[_(h,{color:"primary"},{default:B((()=>[e[4]||(e[4]=T("Date Created: ",-1)),V("b",null,H(t.date),1)])),_:1}),_(h,{color:"primary"},{default:B((()=>[e[5]||(e[5]=T("His-Core Version: ",-1)),V("b",null,H(t.coreVersion),1)])),_:1}),_(h,{color:"primary"},{default:B((()=>[e[6]||(e[6]=T("API Version: ",-1)),V("b",null,H(t.apiVersion),1)])),_:1})])),_:1})])),_:1}),_(w,{btns:t.btns},null,8,["btns"])])),_:1})):x("",!0)],64)}],["__scopeId","data-v-6ccbfe61"]]))}}}));
