System.register(["./index-legacy-CA6M7ipO.js","./HisStandardForm-legacy-a9YJRGaH.js","./EncounterMixin.vue_vue_type_script_lang-legacy-qUwf12Yn.js","./appointment_service-legacy-C2qV7ECG.js","./encounter_guidelines-legacy-Bcz_Mw7r.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(t,e){"use strict";var n,a,i,s,o,l,r,p,d,u,c,m,h;return{setters:[t=>{n=t.d,a=t.ad,i=t.bF,s=t.aj,o=t.ae,l=t.H,r=t.aa,p=t.af,d=t.a,u=t.c},t=>{c=t.H},t=>{m=t._},t=>{h=t.A},null,null],execute:function(){const e=n({mixins:[m],components:{HisStandardForm:c},data:()=>({appointment:{}}),watch:{ready:{handler(t){t&&(this.appointment=new h(this.patientID,this.providerID),this.fields=[this.getAppointmentField()])},immediate:!0}},methods:{async onFinish(t,e){await this.appointment.createEncounter(),await this.appointment.saveObservationList(await this.resolveObs(e)),this.nextTask()},getAppointmentField(){const t=t=>l.toStandardHisDisplayFormat(t);let e=this.appointment.date,n=null;const r={};return{id:"set_appointment",helpText:"Appointments booking",type:a.TT_DATE_PICKER,init:async()=>{try{const t=await this.appointment.getNextAppointment();e=t.appointment_date,n=t.drugs_run_out_date}catch(t){if(console.warn(t),await i(400),!(await s("Next appointment/drug-runout date is not available, do you want to proceed anyway?")))return this.gotoPatientDashboard(),!0}return!0},onValue:async t=>{if(void 0===r[t]){const e=await h.getDailiyAppointments(t);r[t]=Array.isArray(e)?e.length:0}return!0},validation:t=>o.required(t),defaultValue:()=>e,computedValue:t=>[this.appointment.buildValueDate("Appointment date",t),this.appointment.buildValueDate("Estimated date",e)],config:{hiddenFooterBtns:["Clear"],minDate:()=>this.appointment.date,maxDate:()=>n,supValue:t=>`${r[t]}`,infoItems:e=>[{label:"Medication Run out Date",value:n?t(n):"Not available"},{label:"User set appointment date",value:t(e)},{label:"Appointments",value:r[e]}]}}}}});t("default",r(e,[["render",function(t,e,n,a,i,s){const o=p("his-standard-form");return d(),u(o,{fields:t.fields,onFinishAction:t.onFinish,skipSummary:!0,cancelDestinationPath:t.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}]]))}}}));
