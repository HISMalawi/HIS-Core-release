System.register(["./index-legacy-zV5Jd_xD.js","./HisStandardForm-legacy-DUG6a-9J.js","./useEncounter-legacy-CjSSj0Ri.js","./commons-legacy-BHY0ulwn.js","./isEmpty-legacy-B03tgnL3.js","./encounter_guidelines-legacy-D0nfkYrS.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,a){"use strict";var t,l,n,s,o,u,i,d,c,r,v,f,_,p,g,h,m,E,I,y,S,N,O,b,A,C,R,T,k,D,j,P,L,x,H,U,w,Y,V,$,F,G,M,W;return{setters:[e=>{t=e.d,l=e.r,n=e.c,s=e.o,o=e.h,u=e.e,i=e.w,d=e.f,c=e.m,r=e.a5,v=e.j,f=e.a4,_=e.b5,p=e.ac,g=e.ad,h=e.ag,m=e.ds,E=e.a9,I=e.aa,y=e.a6,S=e.a,N=e.g,O=e.t,b=e.a7,A=e.ah,C=e.dy,R=e.I,T=e.k,k=e.l,D=e.z,j=e.b,P=e.ar,L=e.ak,x=e.bV,H=e.bX,U=e.am,w=e.ct,Y=e.al,V=e.e2,$=e.aZ,F=e.n},e=>{G=e.H},e=>{M=e.u},e=>{W=e.r},null,null,null],execute:function(){var a=document.createElement("style");a.textContent="ion-col[data-v-94746907]{border-right:solid 1px #ccc}.side-title[data-v-94746907]{width:100%;padding:.5em;text-align:center;background:#e9e8e8;font-size:1.2em}p[data-v-94746907]{font-weight:700}\n/*$vite$:1*/",document.head.appendChild(a);const B={key:0,class:"side-title"},z=L(t({__name:"SideEffects",props:{prevSideEffectState:{type:Object},sideEffects:{type:Object,required:!0},drugs:{type:Array,default:()=>[]}},setup(e){const a=l(""),t=l({}),L=e,x=n((()=>Object.keys(t.value).every((e=>{const a=t.value[e];return Object.keys(a.drugReason).some((e=>a.drugReason[e].isChecked))||`${a.otherReason}`.length>0}))));function H(){D.dismiss()}function U(){const e=[];Object.keys(t.value).forEach((a=>{Object.keys(t.value[a].drugReason).forEach((l=>{t.value[a].drugReason[l].isChecked&&e.push({concept:t.value[a].concept,drug:t.value[a].drugReason[l].detail})})),t.value[a].otherReason&&e.push({concept:t.value[a].concept,other:t.value[a].otherReason})})),D.dismiss({values:e,state:t.value})}function w(e){e.detail.checked&&(t.value[a.value].otherReason="")}function Y(){Object.keys(t.value[a.value].drugReason).forEach((e=>{t.value[a.value].drugReason[e].isChecked=!1}))}return s((()=>{L.prevSideEffectState?t.value=L.prevSideEffectState:L.sideEffects.forEach((e=>{a.value||(a.value=e.label),t.value[e.label]={concept:e.other.concept,drugReason:L.drugs.reduce(((e,a)=>(e[a.drug.name]={isChecked:!1,detail:a},e)),{}),otherReason:""}}))})),(e,l)=>(j(),o(E,null,[u(d(f),null,{default:i((()=>[u(d(c),null,{default:i((()=>[u(d(r),{class:"his-lg-text"},{default:i((()=>[...l[2]||(l[2]=[v("Suspected causes",-1)])])),_:1})])),_:1})])),_:1}),u(d(R),{style:{overflowY:"hidden",background:"grey"}},{default:i((()=>[u(d(_),null,{default:i((()=>[u(d(p),null,{default:i((()=>[u(d(g),null,{default:i((()=>[u(d(h),{style:{overflowY:"auto",height:"78vh"}},{default:i((()=>[u(d(m),{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value=e)},{default:i((()=>[(j(!0),o(E,null,I(t.value,((e,a)=>(j(),S(d(b),{class:"his-md-text",key:a},{default:i((()=>[u(d(C),{slot:"start",value:a},null,8,["value"]),u(d(A),null,{default:i((()=>[v(O(a),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),u(d(g),{style:{overflowY:"auto",height:"78vh"}},{default:i((()=>[a.value?(j(),o("div",B,[N("b",null,O(a.value),1),l[3]||(l[3]=v(" causes ",-1))])):y("",!0),a.value?(j(),S(d(h),{key:1},{default:i((()=>[u(d(b),{class:"his-lg-text"},{default:i((()=>[u(d(A),null,{default:i((()=>[...l[4]||(l[4]=[v("Current Medication(s)",-1)])])),_:1})])),_:1}),(j(!0),o(E,null,I(t.value[a.value].drugReason,((e,a)=>(j(),S(d(b),{class:"his-md-text",key:a},{default:i((()=>[u(d(A),null,{default:i((()=>[v(O(a),1)])),_:2},1024),u(d(P),{onIonChange:w,slot:"start",modelValue:e.isChecked,"onUpdate:modelValue":a=>e.isChecked=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)))),128))])),_:1})):y("",!0),a.value?(j(),S(d(m),{key:2,onIonChange:Y,modelValue:t.value[a.value].otherReason,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value[a.value].otherReason=e)},{default:i((()=>[u(d(b),{class:"his-lg-text"},{default:i((()=>[u(d(A),null,{default:i((()=>[...l[5]||(l[5]=[v("Previous Medication",-1)])])),_:1})])),_:1}),u(d(b),{class:"his-md-text"},{default:i((()=>[u(d(A),null,{default:i((()=>[...l[6]||(l[6]=[v("Other, not drug related",-1)])])),_:1}),u(d(C),{slot:"start",value:"Other"})])),_:1}),u(d(b),{class:"his-md-text"},{default:i((()=>[u(d(A),null,{default:i((()=>[...l[7]||(l[7]=[v("Drug side effect",-1)])])),_:1}),u(d(C),{slot:"start",value:"Drug side effect"})])),_:1})])),_:1},8,["modelValue"])):y("",!0)])),_:1})])),_:1})])),_:1})])),_:1}),u(d(k),null,{default:i((()=>[u(d(c),null,{default:i((()=>[u(d(T),{onClick:H,slot:"start",size:"large",color:"danger"},{default:i((()=>[...l[8]||(l[8]=[v(" Close ",-1)])])),_:1}),u(d(T),{onClick:U,size:"large",slot:"end",disabled:!x.value},{default:i((()=>[...l[9]||(l[9]=[v(" Save ",-1)])])),_:1},8,["disabled"])])),_:1})])),_:1})],64))}}),[["__scopeId","data-v-94746907"]]);e("default",t({__name:"Complications",setup(e){const a=l([]),t=new x(-1,H.COMPLICATIONS),n=l([]),s=l({}),o={pageOne:{"Abnominal pain":"ABNOMINAL_PAIN",Athralgia:"ATHRALGIA","Colour body fluids":"COLOUR_BODY_FLUIDS",Depression:"DEPRESSION",Fatigue:"FATIGUE",Gastrointestinal:"GASTROINTESTINAL",Headache:"HEADACHE","Hearing Difficulties":"HEARING_DIFFICULTIES",Hematological:"HEMATOLOGICAL",Hepatoxicity:"HEPATOXICITY",Hypothyroidism:"HYPOTHYROIDISM",Itching:"SKIN_ITCHING"},pageTwo:{Jaundice:"JAUNDICE","Lactic Acidosis":"LACTIC_ACIDOSIS",Numbness:"NUMBNESS_IN_HANDS_FEET_LEGS","Optic Neuritis":"OPTIC_NEURITIS",Pancreatitis:"PANCREATITIS","Periferal Neuropathy":"PERIFERAL_NEUROPATHY",Psychosis:"PSYCHOSIS","QT Prolongation":"QT_PROLONGATION","Renal failure":"RENAL_FAILURE","Skin Rash":"SKIN_RASH",Toxicity:"TOXICITY"}},{goToNextTask:c,patientDashboardUrl:r}=M(((e,l)=>{t.patientID=l,t.providerID=e,a.value=[function(){let e=[];return{id:"history",helpText:"Side effects / Contraindications history",type:U.TT_TABLE_VIEWER,init:async()=>{const a=await x.getJson(`programs/${t.programID}/patients/${l}/medication_side_effects`,{date:t.date});return Object.keys(a).forEach((t=>{e.push([w(t),Object.values(a[t]).flat(1).map((e=>`<b>${e.name}</b> ${e.drug_induced?"(Drug-induced)":""} : ${e.drug||"Unknown"} `)).join("<p/>")])})),!0},condition:()=>e.length,options:()=>[{label:"",value:"",other:{columns:["Date","Condition"],rows:e}}]}}(),...Object.keys(o).map(((e,a)=>({id:e,helpText:`Page ${a+1}: Contraindications / Side effects`,type:U.TT_MULTIPLE_YES_NO,init:async()=>($.isEmpty(n.value)&&(n.value=await x.getJson(`patients/${l}/last_drugs_received`,{program_id:t.programID})),!0),beforeNext:async a=>{const t=a.filter((e=>"YES_ANSWER"===e.value));if(t.length){const a=await D.create({component:z,backdropDismiss:!1,cssClass:"large-modal",componentProps:{sideEffects:t,drugs:n.value}});a.present();const{data:l}=await a.onDidDismiss();if(!l)return!1;s.value[e]=l.values}return!0},validation:e=>Y.validateSeries([()=>Y.required(e),()=>Y.anyEmpty(e)]),computedValue:e=>e.map((e=>({concept_id:V("MALAWI_TB_SIDE_EFFECTS"),value_coded:V(`${e.other.concept}`),child:[{concept_id:V(`${e.other.concept}`),value_coded:V(`${e.value}`),obs_datetime:t.date}],obs_datetime:t.date}))),options:a=>Object.keys(o[e]).map((t=>({label:t,value:a[e]?.find((e=>e.label===t))?.value||"",other:{concept:o[e][t],values:[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]}}))),config:{footerBtns:[{name:"None",slot:"end",onClickComponentEvents:{refreshOptions:()=>Object.keys(o[e]).map((a=>({label:a,value:"NO_ANSWER",other:{concept:o[e][a],values:[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]}})))},onClick:()=>"None"}]}})))]}));async function v(e,a){await t.createEncounter(),await t.saveObservationList([...await W(a),...Object.values(s.value).flat(1).map((e=>e.other&&/drug/i.test(e.other)?{concept_id:V("DRUG_INDUCED"),value_coded:V(e.concept),value_text:"Past medication history"}:e.drug?{concept_id:V("DRUG_INDUCED"),value_coded:V(e.concept),value_drug:e.drug.drug.drug_id}:{concept_id:V("CONTRAINDICATIONS"),value_coded:V(e.concept)}))]),c()}return(e,t)=>(j(),S(d(F),null,{default:i((()=>[u(G,{cancelDestinationPath:d(r),onFinishAction:v,fields:a.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
