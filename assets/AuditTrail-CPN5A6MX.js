import{S as _}from"./stock_report_service-rsyJMdlr.js";import{_ as u}from"./ReportMixin.vue_vue_type_script_lang-5B57RLMa.js";import{d as h,L as t,V as s,ck as T,H as g,q as f,_ as y,r as d,o as D,c as w,w as x,b as k}from"./index-ChqjXh1q.js";import{F as p}from"./dynamic-import-helper-Bsjrd6Ro.js";import{R as S}from"./TableReportTemplate-BXc2_KE-.js";import"./MultiFieldDateHelper-BeB1wkpH.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./BasicReportTemplate-Cd6YwWw4.js";import"./Export-C9Hhxwb2.js";import"./SIngleTouchField-BdybEVDH.js";import"./Pagination-CrJFF6Hd.js";import"./HisStandardForm-BfZPxRjA.js";import"./TouchScreenForm-Bp625zJI.js";import"./ToolbarMediumCard-NV07rtjo.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-DBgU2Ffk.js";import"./ReportErrors-CzIGccNx.js";const m={textAlign:"right",paddingRight:".5rem"},$=h({mixins:[u],components:{ReportTemplate:S},data:()=>({title:"Audit Trail",rows:[],columns:[[t.thTxt("Medication"),t.thTxt("Transaction type"),t.thTxt("Transaction date"),t.thTxt("Net Quantity",{style:m})]],fields:[{id:"start_date",helpText:"Start Date",type:p.TT_FULL_DATE,validation:e=>s.required(e),computedValue:e=>e.value},{id:"end_date",helpText:"End Date",type:p.TT_FULL_DATE,validation:e=>s.required(e),computedValue:e=>e.value}]}),methods:{async onPeriod(e,i){this.rows=[],this.report=new _,this.report.setStartDate(i.start_date),this.report.setEndDate(i.end_date),this.period=this.report.getDateIntervalPeriod(),this.report.loadTrail().then(r=>{r.forEach(a=>{this.rows.push([t.td(a.drug_name),t.td(a.transaction_type),t.tdDate(a.transaction_date),t.tdLink(T(Math.trunc(Math.abs(a.cum_per_day_stock_commited))),async()=>{const n=await this.report.getTrailDetails(a.transaction_date,a.drug_id,a.transaction_type);this.drilldownData("".concat(a.drug_name," ").concat(a.transaction_type.toLowerCase()," on ").concat(g.toStandardHisDisplayFormat(a.transaction_date)),[[t.thTxt("Product Code"),t.thTxt("Batch Number"),t.thTxt("Medication"),t.thTxt("Amount Per Unit"),t.thTxt("Total Tins/Pallets",{style:m})]],n.map(o=>[t.td(o.product_code),t.td(o.batch_number),t.td(o.drug_name),t.td(o.pack_size),t.tdNum(Math.abs(Math.trunc(o.amount_committed_to_stock/o.pack_size||1)))]),!1)},{style:{textAlign:"right",paddingRight:".5rem"}})])})}).catch(r=>{f(r)})}}});function b(e,i,r,a,n,o){const l=d("report-template"),c=d("ion-page");return D(),w(c,null,{default:x(()=>[k(l,{title:e.title,rows:e.rows,paginated:!0,period:e.period,fields:e.fields,columns:e.columns,onReportConfiguration:e.onPeriod},null,8,["title","rows","period","fields","columns","onReportConfiguration"])]),_:1})}const j=y($,[["render",b]]);export{j as default};
