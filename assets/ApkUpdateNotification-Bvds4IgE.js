import{d as N,r as l,c as B,o as L,i as g,A as S,h as x,a6 as M,b as K,j as o,g as d,e as c,t as $,w,f as p,k as m,v as q,q as E,s as n,ak as F}from"./index-DO7Erl4-.js";import{F as i,D as T}from"./index-D93MWXf-.js";import{C as j}from"./index-C-ZpBq1J.js";const z={key:0,id:"update-notification"},G=N({__name:"ApkUpdateNotification",props:{checkInterval:{type:Number,default:36e5}},setup(y){const k=y,r=l(!1),s=l(""),a=l(""),u=new S,f=B(()=>!!a.value&&a.value!="-"&&a.value!==s.value),v=l("");L(b);function b(){g("mobile")&&g("android")&&setInterval(async()=>{f.value||(a.value=await u.getApkVersion(),s.value=u.getHeadVersion())},k.checkInterval)}function h(){a.value=s.value}async function P(){try{if(await U()){r.value=!0,A();const e=await V();if(r.value=!1,!e)throw new Error("Unable to download the app");E("Download completed. Installing the app..."),await C(e),s.value=a.value}}catch(e){r.value=!1,console.error(e),n("Unable to update the app")}}async function U(){try{const{publicStorage:e}=await i.checkPermissions();if(e!=="granted"){const{publicStorage:t}=await i.requestPermissions();if(t!=="granted")return n("Permission to access storage is required to download the app."),!1}return!0}catch(e){return console.error(e),n("Unable to download the app. Please try again later"),!1}}async function V(){try{return(await i.downloadFile({url:await u.getApkDownloadLink(a.value),path:"Download/emr-".concat(a.value,".apk"),directory:T.ExternalStorage,recursive:!0,progress:!0})).path}catch(e){console.error(e),n(e.toString())}}function A(){i.addListener("progress",e=>{const t=Math.round(e.contentLength/1024),I=Math.round(e.bytes/1024),D=Math.round(e.bytes/e.contentLength*100);v.value="Downloading... ".concat(I,"KB / ").concat(t,"KB (").concat(D,"%)")})}async function C(e){try{await j.install({file:e})}catch(t){console.error(t),n("Unable to install the app. Please try again later")}}return(e,t)=>f.value?(K(),x("div",z,[t[2]||(t[2]=o(" New version (",-1)),d("strong",null,$(a.value),1),t[3]||(t[3]=o(") update is available ",-1)),t[4]||(t[4]=d("br",null,null,-1)),t[5]||(t[5]=d("br",null,null,-1)),c(p(m),{onClick:P,color:"success"},{default:w(()=>[...t[0]||(t[0]=[o(" Download Update ",-1)])]),_:1}),t[6]||(t[6]=o("     ",-1)),c(p(m),{onClick:h,color:"danger"},{default:w(()=>[...t[1]||(t[1]=[o(" Cancel ",-1)])]),_:1}),c(p(q),{"is-open":r.value,message:v.value},null,8,["is-open","message"])])):M("",!0)}}),O=F(G,[["__scopeId","data-v-70fe1068"]]);export{O as default};
