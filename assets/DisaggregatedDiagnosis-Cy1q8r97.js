import{d as Z,Y as te,$ as oe,ay as ne,a6 as se,Z as ae,X as le,a8 as re,a9 as ie,_ as ce,c3 as ue,ag as de,r as v,at as R,aL as _e,c6 as he,c7 as fe,c8 as pe,c9 as me,ca as ge,dU as ye,bd as be,ao as A,bC as ve,aN as S,aa as x,af as y,a as p,E as b,b as d,w as f,C as V,a2 as P,M as U,K as w,c as H,J as E,G as N,b7 as Ce,I as Me,cJ as Fe,o as De,au as B,aE as we,ci as z,ad as K,ae as W}from"./index-CMZASHAR.js";import{b as $e,a as ke}from"./Export-CpyT9Gk1.js";import{A as Te}from"./aetc_report_service-D99QhQ6O.js";import{D as Ae}from"./DrillPatientIds-CwQBWjf6.js";import"./index-_zuoFVCp.js";import"./TableView-DhTjQT8r.js";const Le=Z({components:{IonToolbar:te,IonItem:oe,IonIcon:ne,IonLabel:se,IonTitle:ae,IonHeader:le,IonButton:re,IonFooter:ie,IonContent:ce,IonButtons:ue},props:{title:{type:String,default:"Report"},subtitle:{type:String},columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},onFinish:{type:Function},onRefresh:{type:Function},onConfigure:{type:Function},csvQuarter:{type:String},headers:{type:Array,default:()=>[]},order:{type:Array,default:()=>[]},csvSpacing:{type:Number},csvSubHeader:{type:Array,default:()=>[]}},setup(o){const _=de(),$=v([]),k=v(""),C=v("desc"),h=R(()=>o.columns.slice(0,2)),M=R(()=>{var a;const n=[];return(a=o.columnData)==null||a.forEach(l=>{const i=o.columns[2].map(r=>{let s="";try{S.isEmpty(l)?s="...":typeof r.value=="function"?s=r.value(l):s=l[r.ref]||""}catch(u){s="_ERROR_",console.error(u)}return{column:r,data:l,value:s,[r.ref||"nada"]:s}});n.push({row:i,data:l,searchIndex:[...i,i.map(r=>r.value).join(" ")]})}),n}),e=R(()=>{var a;const n=[];return(a=o.columnData[1])==null||a.forEach(l=>{const i=o.columns[2].map(r=>{let s="";try{S.isEmpty(l)?s="...":typeof r.value=="function"?s=r.value(l):s=l[r.ref]||""}catch(u){s="_ERROR_",console.error(u)}return{column:r,data:l,value:s,[r.ref||"nada"]:s}});n.push({row:i,data:l,searchIndex:[...i,i.map(r=>r.value).join(" ")]})}),n}),t=R(()=>{var a;const n=[];return(a=o.columnData[2])==null||a.forEach(l=>{const i=o.columns[3].map(r=>{let s="";try{S.isEmpty(l)?s="...":typeof r.value=="function"?s=r.value(l):s=l[r.ref]||""}catch(u){s="_ERROR_",console.error(u)}return{column:r,data:l,value:s,[r.ref||"nada"]:s}});n.push({row:i,data:l,searchIndex:[...i,i.map(r=>r.value).join(" ")]})}),n}),m=R(()=>{var a;const n=[];return(a=o.columnData[3])==null||a.forEach((l,i)=>{const r=o.columns[8+i].map(s=>{let u="";try{S.isEmpty(l)?u="...":typeof s.value=="function"?u=s.value(l):u=l[s.ref]||""}catch(ee){u="_ERROR_",console.error(ee)}return{column:s,data:l,value:u,[s.ref||"nada"]:u}});n.push({row:r,data:l,searchIndex:[...r,r.map(s=>s.value).join(" ")]})}),n}),g=n=>{k.value=n,C.value=C.value==="asc"?"desc":"asc"},F=()=>{typeof o.onFinish=="function"?o.onFinish():_.push("/")},T=n=>{var a,l;try{typeof((a=n.column)==null?void 0:a.tdClick)=="function"&&((l=n.column)==null||l.tdClick(n));return}catch(i){console.error(i)}},Q=()=>o.columns.reduce((n,a)=>n.concat(a),[]).filter(n=>n.value||n.ref),Y=()=>{var a;const n=(a=window==null?void 0:window.document)==null?void 0:a.getElementById("report-content");$e("\n                <html>\n                    <head> \n                        <style> \n                        table {\n                            border-collapse: collapse;\n                        }\n                        th, td {\n                            width: 4%;\n                            text-align: center;\n                            border: solid 1px black;\n                        }\n                        td {\n                            border-bottom: 1px solid rgb(165, 165, 165);\n                            padding: 0.6em;\n                            font-weight: 500;\n                            font-size: .8em;\n                        }\n                        </style>    \n                    </head>\n                <body> \n                 ".concat(n.innerHTML,"    \n                </body>\n                </html>\n            "))},O=n=>{for(const a in n)Array.isArray(n[a])?n[a]=n[a].length:typeof n[a]=="object"&&O(n[a])},D=n=>{const a=[];for(const l in n)if(Object.prototype.hasOwnProperty.call(n,l)){const i=[l],r=Object.values(n[l]);for(const s of r)i.push(s);a.push(i)}return a},L=n=>{const a=[];for(const l of n){const i=[];for(let s=0;s<l.length;s++)typeof l[s]=="object"?(i.push(l[s].M),i.push(l[s].F)):s>0&&i.push(l[s]);const r=i.slice(-2).reduce((s,u)=>s+(typeof u=="number"?u:0),0);i.push(r),a.push(i)}return n.length=0,n.push(...a),n},c=()=>{const a=(i=>{const r=JSON.parse(JSON.stringify(i));O(r);const s=D(r);return L(s)})(o.columnData);console.log("CSV ARRAY  ",a);const l="".concat(A.getLocationName()||"Unknown site","-").concat(o.title,"-").concat(o.subtitle,"-").concat(A.getSessionDate());ke([o.headers],[...a,["Date Created: ".concat(ve().format("DD/MMM/YYYY HH:MM:ss"))],["Quarter: ".concat(o.csvQuarter||o.subtitle)],["HIS-Core Version: ".concat(A.getCoreVersion())],["API Version: ".concat(A.getApiVersion())],["Site UUID: ".concat(A.getSiteUUID())],["Generated by: ".concat(A.getUserName())]],l)},I=n=>{n.forEach(a=>{const l=Q().map(i=>{let r="";try{S.isEmpty(a)?r="...":typeof i.value=="function"?r=i.value(a):r=a[i.ref]||""}catch(s){r="_ERROR_",console.error(s)}return{column:i,data:a,value:r,[i.ref||"nada"]:r}});$.value.push({row:l,data:a,searchIndex:[...l,l.map(i=>i.value).join(" ")]})})};return _e(()=>o.columnData,n=>{$.value=[],Array.isArray(n)&&I(n)},{immediate:!0,deep:!0}),{sortColumn:g,onClickTablecell:T,toPDF:Y,toCSV:c,finish:F,columnsMinusOne:h,sync:he,search:fe,close:pe,arrowUp:me,arrowDown:ge,document:ye,calendar:be,sortOrder:C,reportBody:M,sectionTwo:e,sectionThree:t,sectionTotals:m,columnSorted:k}}}),Ie={key:0},Re={class:"his-sm-text"},Se={id:"report-content"},Ee={class:"art-report-theme"},Oe={class:"stick-report-header"},Ve=["colspan","rowspan","onClick"],Pe=["onClick"],Ue={class:"his-sm-text"};function Ne(o,_,$,k,C,h){const M=y("ion-title"),e=y("ion-icon"),t=y("ion-button"),m=y("ion-buttons"),g=y("ion-toolbar"),F=y("ion-header"),T=y("ion-label"),Q=y("ion-item"),Y=y("ion-content"),O=y("ion-footer");return p(),b(E,null,[d(F,null,{default:f(()=>[d(g,null,{default:f(()=>[d(M,{class:"his-md-text"},{default:f(()=>[V(P(o.title)+" ",1),o.subtitle?(p(),b("br",Ie)):U("",!0),w("span",Re,P(o.subtitle),1)]),_:1}),d(m,{slot:"end"},{default:f(()=>[typeof o.onConfigure=="function"?(p(),H(t,{key:0,onClick:o.onConfigure},{default:f(()=>[d(e,{size:"large",icon:o.calendar},null,8,["icon"])]),_:1},8,["onClick"])):U("",!0),typeof o.onRefresh=="function"?(p(),H(t,{key:1,onClick:o.onRefresh,color:"success",size:"large"},{default:f(()=>[d(e,{size:"large",icon:o.sync},null,8,["icon"])]),_:1},8,["onClick"])):U("",!0)]),_:1})]),_:1})]),_:1}),d(Y,{"scroll-y":"","scroll-x":""},{default:f(()=>[w("div",Se,[w("table",Ee,[w("thead",Oe,[(p(!0),b(E,null,N(o.columnsMinusOne,(D,L)=>(p(),b("tr",{key:L},[(p(!0),b(E,null,N(D,(c,I)=>{var n,a;return p(),b("th",{key:I,colspan:((n=c==null?void 0:c.span)==null?void 0:n.thColspan)||1,rowspan:((a=c==null?void 0:c.span)==null?void 0:a.thRowspan)||1,onClick:l=>o.sortColumn(c.ref)},[d(Q,{lines:"none"},{default:f(()=>[o.columnSorted&&o.columnSorted===c.ref?(p(),H(e,{key:0,icon:o.sortOrder==="asc"?o.arrowUp:o.arrowDown},null,8,["icon"])):U("",!0),d(T,{class:"ion-text-center"},{default:f(()=>[w("b",null,P(c.label),1)]),_:2},1024)]),_:2},1024)],8,Ve)}),128))]))),128))]),w("tbody",null,[(p(!0),b(E,null,N(o.reportBody,(D,L)=>(p(),b("tr",{key:L},[(p(!0),b(E,null,N(D.row||[],(c,I)=>{var n;return p(),b("td",{key:I,onClick:()=>o.onClickTablecell(c),class:Ce({"clickable-cell":(n=c==null?void 0:c.column)==null?void 0:n.tdClick})},[w("b",Ue,P(c.value),1)],10,Pe)}),128))]))),128))])])])]),_:1}),d(O,null,{default:f(()=>[d(g,{color:"dark"},{default:f(()=>[d(t,{onClick:_[0]||(_[0]=D=>o.toCSV()),size:"large"},{default:f(()=>_[2]||(_[2]=[V(" CSV ")])),_:1}),d(t,{onClick:_[1]||(_[1]=D=>o.toPDF()),size:"large"},{default:f(()=>_[3]||(_[3]=[V(" PDF ")])),_:1}),d(t,{onClick:o.finish,color:"success",size:"large",slot:"end"},{default:f(()=>_[4]||(_[4]=[V(" Finish ")])),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const Be=x(Le,[["render",Ne],["__scopeId","data-v-e2910d5b"]]),J=v([]),G=v(""),j=v(""),q=v(""),ze=v(!1),X=v(""),Ge=Z({components:{IonPage:Me,IonLoading:Fe,v2Datatable:Be},setup(){const o=async()=>{const e=new Te;e.startDate=G.value,e.endDate=j.value;try{const t=await e.getClinicReport("DISAGGREGATED_DIAGNOSIS");J.value=k(t)}catch(t){console.log(t)}},_=["Diagnosis","<6 Months> M","<6 Months> F","6 Months to < 5 M","6 Months to < 5 F","5 to 14 F","5 to 14 M",">14 M",">14 F","Total by gender M","Total by gender F","Total"],$=[[{label:"Diagnosis",ref:"",span:{thRowspan:2}},{label:"<6 Months>",ref:"",span:{thColspan:2}},{label:"6 Months to < 5",ref:"",span:{thColspan:2}},{label:"5 to 14",ref:"",span:{thColspan:2}},{label:">14",ref:"",span:{thColspan:2}},{label:"Total by gender",ref:"",span:{thColspan:2}},{label:"Total",ref:"",span:{thRowspan:2}}],[{label:"M",ref:""},{label:"F",ref:""},{label:"M",ref:""},{label:"F",ref:""},{label:"M",ref:""},{label:"F",ref:""},{label:"M",ref:""},{label:"F",ref:""},{label:"M",ref:""},{label:"F",ref:""}],[{label:"Diagnosis",ref:"data.diagnosis",value:e=>e.diagnosis},{label:"< 6 months M",ref:"data.< 6 months.M.length",secondaryLabel:"< 6 months Male diagnosed with",value:e=>e.ls_6_months.M.length,tdClick:({column:e,data:t})=>h("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.ls_6_months.M)},{label:"<6 months F",ref:"data.ls_6_months.F.length",secondaryLabel:"< 6 months Female diagnosed with",value:e=>e.ls_6_months.F.length,tdClick:({column:e,data:t})=>h("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.ls_6_months.F)},{label:"6 months to < 5",ref:"data.i6_months_to_ls_5.M.length",secondaryLabel:"6 months to < 5 Males with",value:e=>e.i6_months_to_ls_5.M.length,tdClick:({column:e,data:t})=>h("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.i6_months_to_ls_5.M)},{label:"6 months to < 5",ref:"data.i6_months_to_ls_5.F.length",secondaryLabel:"6 months to < 5 Females with",value:e=>e.i6_months_to_ls_5.F.length,tdClick:({column:e,data:t})=>h("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.i6_months_to_ls_5.F)},{label:"5 to 14",ref:"data.i5_to_14.M.length",secondaryLabel:"5 to 14 Males with",value:e=>e.i5_to_14.M.length,tdClick:({column:e,data:t})=>h("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.i5_to_14.M)},{label:"5 to 14",ref:"data.i5_to_14.F.length",secondaryLabel:"5 to 14 Females with",value:e=>e.i5_to_14.F.length,tdClick:({column:e,data:t})=>h("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.i5_to_14.F)},{label:">14",ref:"data.gt_14.M.length",secondaryLabel:"Greater than 14 males with",value:e=>e.gt_14.M.length,tdClick:({column:e,data:t})=>h("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.gt_14.M)},{label:">14",ref:"data.gt_14.F.length",secondaryLabel:"Greater than 14 females with",value:e=>e.gt_14.F.length,tdClick:({column:e,data:t})=>h("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.gt_14.F)},{label:"Total by gender",ref:"data.total_by_gender.M.length",secondaryLabel:"Total by gender males",value:e=>e.total_by_gender.M.length,tdClick:({column:e,data:t})=>h("".concat(e.secondaryLabel," "),t.total_by_gender.M)},{label:"5 to 14",ref:"data.total_by_gender.F.length",secondaryLabel:"Total by gender females",value:e=>e.total_by_gender.F.length,tdClick:({column:e,data:t})=>h("".concat(e.secondaryLabel," "),t.total_by_gender.F)},{label:"Total",ref:"Total",value:e=>[...e.ls_6_months.M,...e.ls_6_months.F,...e.i6_months_to_ls_5.M,...e.i6_months_to_ls_5.F,...e.i6_months_to_ls_5.M,...e.i6_months_to_ls_5.F,...e.i6_months_to_ls_5.M,...e.i6_months_to_ls_5.F,...e.i5_to_14.M,...e.i5_to_14.F,...e.gt_14.M,...e.gt_14.F].length,tdClick:({column:e,data:t})=>{const m=[...t.ls_6_months.M,...t.ls_6_months.F,...t.i6_months_to_ls_5.M,...t.i6_months_to_ls_5.F,...t.i6_months_to_ls_5.M,...t.i6_months_to_ls_5.F,...t.i6_months_to_ls_5.M,...t.i6_months_to_ls_5.F,...t.i5_to_14.M,...t.i5_to_14.F,...t.gt_14.M,...t.gt_14.F];h("".concat(e.label," "),m)}}]],k=e=>{const t=[];for(const m of e){const g=C(m);t.push(g)}return t},C=e=>{const t={};for(const m in e)if(Object.prototype.hasOwnProperty.call(e,m)){let g=m.replace(/ /g,"_");const F=e[m];/^\d/.test(g)&&(g="i"+g),g=g.replace(/[<>&]/g,T=>{switch(T){case"<":return"ls";case">":return"gt";case"&":return"amp";default:return T}}),t[g]=typeof F=="object"&&!Array.isArray(F)?C(F):F}return t},h=async(e,t)=>{t.length<=0||(await B.create({component:Ae,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e,subtitle:q,patientIdentifiers:t,onFinish:()=>B.getTop().then(m=>m&&B.dismiss())}})).present()},M=()=>we([{id:"start_date",helpText:"Start Date",type:K.TT_FULL_DATE,validation:e=>W.required(e),computedValue:e=>e.value},{id:"end_date",helpText:"End Date",type:K.TT_FULL_DATE,validation:e=>W.required(e),computedValue:e=>e.value}],(e,t)=>{G.value=t.start_date,j.value=t.end_date,q.value="Period (".concat(z(G.value)," to ").concat(z(j.value),")"),B.dismiss(),X.value="".concat(z(G.value)," to ").concat(z(j.value)),o()});return De(()=>!J.value.length&&M()),{columns:$,isLoading:ze,reportData:J,period:q,csvQuarter:X,csvheaders:_,generate:o,configure:M}}});function je(o,_,$,k,C,h){const M=y("ion-loading"),e=y("v2Datatable"),t=y("ion-page");return p(),H(t,null,{default:f(()=>[d(M,{"is-open":o.isLoading,message:"Please wait..."},null,8,["is-open"]),d(e,{title:"Disaggregated Diagnosis Report",subtitle:o.period,columns:o.columns,columnData:o.reportData,rowsPerPage:25,onConfigure:o.configure,csvQuarter:o.csvQuarter,headers:o.csvheaders,onRefresh:()=>o.generate()},null,8,["subtitle","columns","columnData","onConfigure","csvQuarter","headers","onRefresh"])]),_:1})}const We=x(Ge,[["render",je]]);export{We as default};
