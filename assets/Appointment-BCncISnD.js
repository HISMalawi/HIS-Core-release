import{d as p,ab as m,by as d,af as l,ac as u,ai as c,a8 as h,ad as f,u as _,v as y}from"./index-DrPQ21-i.js";import{H as A}from"./HisStandardForm-rh8Trs2q.js";import{_ as D}from"./EncounterMixin.vue_vue_type_script_lang-_NQuqjHg.js";import{A as s}from"./appointment_service-CVvR4x_-.js";import"./encounter_guidelines-D8L0Wl1z.js";import"./GuidelineEngine-D6V1_Znr.js";const v=p({mixins:[D],components:{HisStandardForm:A},data:()=>({appointment:{}}),watch:{ready:{handler(e){e&&(this.appointment=new s(this.patientID,this.providerID),this.fields=[this.getAppointmentField()])},immediate:!0}},methods:{async onFinish(e,a){await this.appointment.createEncounter(),await this.appointment.saveObservationList(await this.resolveObs(a)),this.nextTask()},getAppointmentField(){const e=t=>c.toStandardHisDisplayFormat(t);let a=this.appointment.date,n=null;const i={};return{id:"set_appointment",helpText:"Appointments booking",type:m.TT_DATE_PICKER,init:async()=>{try{const t=await this.appointment.getNextAppointment();a=t.appointment_date,n=t.drugs_run_out_date}catch(t){if(console.warn(t),await d(400),!await l("Next appointment/drug-runout date is not available, do you want to proceed anyway?"))return this.gotoPatientDashboard(),!0}return!0},onValue:async t=>{if(i[t]===void 0){const o=await s.getDailiyAppointments(t);i[t]=Array.isArray(o)?o.length:0}return!0},validation:t=>u.required(t),defaultValue:()=>a,computedValue:t=>[this.appointment.buildValueDate("Appointment date",t),this.appointment.buildValueDate("Estimated date",a)],config:{hiddenFooterBtns:["Clear"],minDate:()=>this.appointment.date,maxDate:()=>n,supValue:t=>"".concat(i[t]),infoItems:t=>[{label:"Medication Run out Date",value:n?e(n):"Not available"},{label:"User set appointment date",value:e(t)},{label:"Appointments",value:i[t]}]}}}}});function b(e,a,n,i,t,o){const r=f("his-standard-form");return _(),y(r,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!0,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}const $=h(v,[["render",b]]);export{$ as default};
