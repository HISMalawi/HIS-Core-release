import{H as _}from"./HisStandardForm-lonwENLb.js";import{b5 as p,d as T,K as w,V as n,U as u,t as d,n as D,q as x,o as E,c as F,w as C,b as V,c4 as m,I as P,ab as A}from"./index-DTBWhHAq.js";import{F as s}from"./dynamic-import-helper-Bsjrd6Ro.js";import{g as L}from"./LocationFieldOptions-C65wr29G.js";import{r as f}from"./commons-BCgFgo42.js";import{u as O}from"./useEncounter-eKl3gS5R.js";import"./TouchScreenForm-BeJsJnwt.js";import"./ToolbarMediumCard-wr9sTFDK.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-DbAo6hHM.js";import"./isEmpty-BaQ44rii.js";import"./_Set-btDj8MuP.js";import"./_setToArray-DlboZaJz.js";import"./encounter_guidelines-BDvVJmZ6.js";import"./GuidelineEngine-D6V1_Znr.js";class k extends p{constructor(a,o){super(a,114,o)}}class q extends p{constructor(a,o){super(a,40,o)}}const X=T({__name:"DischargePatient",setup(l){let a,o;const c=w([]),{goToNextTask:b,patientDashboardUrl:h}=O((e,i)=>{o=new q(i,e),a=new k(i,e),c.value=[g(),y(),S()]});async function v(e,i){await o.createEncounter();const t=await f({...i},"outcome");await o.saveObservationList(t);const r=await f({...i},"referral");A.isEmpty(r)||(await a.createEncounter(),await a.saveObservationList(r)),b()}function g(){return{id:"outcome_status",helpText:"Select Discharge Outcome",type:s.TT_SELECT,validation:e=>n.required(e),computedValue:e=>({tag:"outcome",obs:o.buildValueCoded("outcome",e.value)}),options:()=>[{label:"Referred (Within the Facility)",value:"Patient transferred internally"},{label:"Dead",value:"Died in treatment"},{label:"Abscorded",value:"Absconded"},{label:"Alive (Discharged home)",value:"Discharged home"},{label:"Transferred (Another health facility)",value:"Discharged to another facility"}]}}function y(){return{id:"facility_name",helpText:"Select Facility name",type:s.TT_SELECT,validation:e=>n.required(e),computedValue:e=>({tag:"referral",obs:a.buildValueText("Referred",e.label)}),condition:e=>e.outcome_status.value==="Discharged to another facility",options:(e,i="")=>L(i),config:{showKeyboard:!0,isFilterDataViaApi:!0}}}function S(){return{id:"internal_sections",helpText:"Select Ward/internal section",type:s.TT_SELECT,validation:e=>n.required(e),computedValue:e=>({tag:"referral",obs:a.buildValueText("Specialist clinic",e.label)}),condition:e=>e.outcome_status.value==="Patient transferred internally",options:()=>u.getInternalSections(),config:{showKeyboard:!0,footerBtns:[{name:"Add Section",slot:"end",color:"success",onClick:async(e,i,t)=>{if(typeof t.filter!="string"||t.filter.length<3)return d("Please enter a valid section name");if(t.filtered.some(r=>r.label.toLowerCase()===t.filter.toLowerCase()))return d("Section already existing");if(await D("Do you want to add internal section?")){const r=await u.createInternalSection(t.filter.toUpperCase());r?(t.filter=r.name,t.listData=[{label:r.name,value:r.id},...t.listData]):x("Unable to add ".concat(t.filter))}}}]}}}return(e,i)=>(E(),F(m(P),null,{default:C(()=>[V(_,{cancelDestinationPath:m(h),fields:c.value,onFinishAction:v,skipSummary:""},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{X as default};
