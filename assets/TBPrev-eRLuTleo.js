import{_ as h}from"./ReportMixin.vue_vue_type_script_lang-Ce5B9pzq.js";import{bD as _,cc as c,d as w,L as t,ab as A,cz as m,_ as R,r as u,o as T,c as H,w as v,b as g}from"./index-BFG-WECc.js";import{R as P}from"./TableReportTemplate-Dty_HdC-.js";import"./MultiFieldDateHelper-CAg9Dfet.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./BasicReportTemplate-SATK8Q6M.js";import"./Export-CRv3Yrt4.js";import"./SIngleTouchField-OvqCQtJi.js";import"./Pagination-wn9n5xfa.js";import"./HisStandardForm-B3aw5EdY.js";import"./TouchScreenForm-DiI3Xfhg.js";import"./ToolbarMediumCard-C3iotOe-.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-0kHLdkku.js";import"./ReportErrors-DZ7hHT6a.js";class y extends _{constructor(){super()}getTBPrevReport(){return this.getReport("/programs/".concat(this.programID,"/reports/tb_prev2"))}getMaternalStatus(s){const e=c.parameterizeObjToString({start_date:this.startDate,end_date:this.endDate,date:this.date,program_id:this.programID,report_definition:"pepfar"});return _.postJson("vl_maternal_status?".concat(e),{patient_ids:s})}}const f=w({mixins:[h],components:{ReportTemplate:P},data:()=>({title:"TB PREV Report",cohort:{},rows:[],columns:[[t.thTxt("",{colspan:3,sortable:!1,exportable:!1}),t.thTxt("Started new on ART",{colspan:2,sortable:!1,exportable:!1}),t.thTxt("Started previously on ART",{colspan:2,sortable:!1,exportable:!1}),t.thTxt("Completed New on ART",{colspan:2,sortable:!1,exportable:!1}),t.thTxt("Completed previously on ART",{colspan:2,sortable:!1,exportable:!1})],[t.thTxt("Age group"),t.thTxt("Gender"),t.thNum("3HP",{value:"3HP(Started New on ART)"}),t.thNum("6H",{value:"6H(Started New on ART)"}),t.thNum("3HP",{value:"3HP(Started Previously on ART)"}),t.thNum("6H",{value:"6H(Started Previously on ART)"}),t.thNum("3H",{value:"3HP(Completed New on ART)"}),t.thNum("6H",{value:"6H(Completed New on ART)"}),t.thNum("3H",{value:"3HP(Completed Previously on ART)"}),t.thNum("6H",{value:"6H(Completed Previously on ART)"})]]}),created(){this.fields=this.getDateDurationFields()},methods:{async onPeriod(r,s){this.rows=[],this.report=new y,this.report.setOccupation(s.occupation),this.report.setStartDate(s.start_date),this.report.setEndDate(s.end_date),this.period=this.report.getDateIntervalPeriod(),this.cohort=await this.report.getTBPrevReport(),this.setRows("F"),this.setRows("M"),this.setTotalMaleRow(),this.setMaternityRows()},makeDrilldown(r,s){if(r.length){const e=[[t.thTxt("ARV#"),t.thTxt("Birthdate"),t.thTxt("TPT Initiation Date"),t.thTxt("Outcome")]],o=()=>this.sortByArvNumber(r,"arv_number").map(a=>[t.td(a.arv_number),t.tdDate(a.birthdate),t.tdDate(a.tpt_initiation_date),t.td(a.outcome)]);return t.tdLink(r.length,()=>this.drilldownAsyncRows(s,e,o))}return t.td(0)},aggregate(r,s,e){return Object.values(this.cohort).reduce((o,a)=>[...a[r][s][e],...o],[])},async setMaternityRows(){const r=["started_new_on_art","started_previously_on_art","completed_new_on_art","completed_previously_on_art"].reduce((l,n)=>[...l,{group:"3HP",indicator:n,data:this.aggregate("F","3HP",n)},{group:"6H",indicator:n,data:this.aggregate("F","6H",n)}],[]),s=await this.report.getMaternalStatus(A.uniq(r.reduce((l,n)=>[...l,...n.data],[]).map(l=>l.patient_id))),e=(l,n)=>r.reduce((i,p)=>p.indicator===l&&n===p.group?[...i,...p.data]:i,[]),o=(l,n,i)=>[this.makeDrilldown(e(n,"3HP").filter(p=>s[l].includes(p.patient_id)),"All ".concat(i," (3HP)")),this.makeDrilldown(e(n,"6H").filter(p=>s[l].includes(p.patient_id)),"All ".concat(i," (6H)"))],a=s.FBf.concat(s.FP),d=(l,n)=>[this.makeDrilldown(e(l,"3HP").filter(i=>!a.includes(i.patient_id)),"All ".concat(n," (3HP)")),this.makeDrilldown(e(l,"6H").filter(i=>!a.includes(i.patient_id)),"All ".concat(n," (6H)"))];this.rows.push([t.td("All"),t.td("FP"),...o("FP","started_new_on_art","Started new on ART"),...o("FP","started_previously_on_art","Started previously on ART"),...o("FP","completed_new_on_art","Completed new on ART"),...o("FP","completed_previously_on_art","Completed previously on ART")]),this.rows.push([t.td("All"),t.td("FNP"),...d("started_new_on_art","Started new on ART"),...d("started_previously_on_art","Started previously on ART"),...d("completed_new_on_art","Completed new on ART"),...d("completed_previously_on_art","Completed previously on ART")]),this.rows.push([t.td("All"),t.td("FBF"),...o("FBf","started_new_on_art","Started new on ART"),...o("FBf","started_previously_on_art","Started previously on ART"),...o("FBf","completed_new_on_art","Completed new on ART"),...o("FBf","completed_previously_on_art","Completed previously on ART")])},setTotalMaleRow(){this.rows.push([t.td("All"),t.td("Male"),this.makeDrilldown(this.aggregate("M","3HP","started_new_on_art"),"All male started new on 3HP"),this.makeDrilldown(this.aggregate("M","6H","started_new_on_art"),"All male started new on ART 6H"),this.makeDrilldown(this.aggregate("M","3HP","started_previously_on_art"),"All male started previously on ART 3HP"),this.makeDrilldown(this.aggregate("M","6H","started_previously_on_art"),"All male started previously on ART 6H"),this.makeDrilldown(this.aggregate("M","3HP","completed_new_on_art"),"All male completed new on ART 3HP"),this.makeDrilldown(this.aggregate("M","6H","completed_new_on_art"),"All male completed new on ART 6H"),this.makeDrilldown(this.aggregate("M","3HP","completed_previously_on_art"),"All male completed previously on ART 3HP"),this.makeDrilldown(this.aggregate("M","6H","completed_previously_on_art"),"All male completed previously on ART 6H")])},async setRows(r){for(const s in m){const e=m[s],o=this.cohort[e][r],a=this.formatGender(r);this.rows.push([t.td(e),t.td(a),this.makeDrilldown(o["3HP"].started_new_on_art,"".concat(e," started new on ART 3HP (").concat(a,"s)")),this.makeDrilldown(o["6H"].started_new_on_art,"".concat(e," started new on ART 6H (").concat(a,"s)")),this.makeDrilldown(o["3HP"].started_previously_on_art,"".concat(e," started previously on ART 3HP (").concat(a,"s)")),this.makeDrilldown(o["6H"].started_previously_on_art,"".concat(e," started previously on ART 6H (").concat(a,"s)")),this.makeDrilldown(o["3HP"].completed_new_on_art,"".concat(e," completed new on ART 3HP (").concat(a,"s)")),this.makeDrilldown(o["6H"].completed_new_on_art,"".concat(e," completed new on ART 6H (").concat(a,"s)")),this.makeDrilldown(o["3HP"].completed_previously_on_art,"".concat(e," completed previously on ART 3HP (").concat(a,"s)")),this.makeDrilldown(o["6H"].completed_previously_on_art,"".concat(e," completed previously on ART 6H (").concat(a,"s)"))])}}}});function D(r,s,e,o,a,d){const l=u("report-template"),n=u("ion-page");return T(),H(n,null,{default:v(()=>[g(l,{title:r.title,period:r.period,rows:r.rows,fields:r.fields,columns:r.columns,reportPrefix:"PEPFAR",config:{showIndex:!0},onReportConfiguration:r.onPeriod},null,8,["title","period","rows","fields","columns","onReportConfiguration"])]),_:1})}const L=R(f,[["render",D]]);export{L as default};
