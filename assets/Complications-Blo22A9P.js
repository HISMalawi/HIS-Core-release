import{d as B,K as C,M as J,N as z,o as _,x as y,b as o,w as s,cl as e,u as f,F as D,y as V,c as S,v as k,A as K,z as L,O as H,i as w,k as q,j as Q,ai as X,aj as Z,ak as j,g as Y,ct as G,h as I,cw as x,C as E,e as ee,l as te,f as M,m as ae,_ as oe,b5 as F,cV as se,cb as le,ab as ne,V as P,I as ue}from"./index-BCTN_bnC.js";import{F as $}from"./dynamic-import-helper-BkBZiFw5.js";import{H as ie}from"./HisStandardForm-CaDwl-hA.js";import{u as re}from"./useEncounter-CDUT-p5Y.js";import{g as p}from"./util-CyjuS_4X.js";import{r as ce}from"./commons-BDvZ1JFN.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./isEmpty-OXtHK5dz.js";import"./_Set-VKtKUQAI.js";import"./_setToArray-BLmuRUHx.js";import"./encounter_guidelines-DZpIPlYY.js";import"./GuidelineEngine-D6V1_Znr.js";const de={key:0,class:"side-title"},fe=B({__name:"SideEffects",props:{prevSideEffectState:{type:Object},sideEffects:{type:Object,required:!0},drugs:{type:Array,default:()=>[]}},setup(U){const n=C(""),t=C({}),v=U,R=J(()=>Object.keys(t.value).every(u=>{const l=t.value[u];return Object.keys(l.drugReason).some(d=>l.drugReason[d].isChecked)||"".concat(l.otherReason).length>0}));function m(){H.dismiss()}function T(){const u=[];Object.keys(t.value).forEach(l=>{Object.keys(t.value[l].drugReason).forEach(a=>{t.value[l].drugReason[a].isChecked&&u.push({concept:t.value[l].concept,drug:t.value[l].drugReason[a].detail})}),t.value[l].otherReason&&u.push({concept:t.value[l].concept,other:t.value[l].otherReason})}),H.dismiss({values:u,state:t.value})}function A(u){u.detail.checked&&(t.value[n.value].otherReason="")}function N(){Object.keys(t.value[n.value].drugReason).forEach(u=>{t.value[n.value].drugReason[u].isChecked=!1})}return z(()=>{v.prevSideEffectState?t.value=v.prevSideEffectState:v.sideEffects.forEach(u=>{n.value||(n.value=u.label),t.value[u.label]={concept:u.other.concept,drugReason:v.drugs.reduce((l,a)=>(l[a.drug.name]={isChecked:!1,detail:a},l),{}),otherReason:""}})}),(u,l)=>(_(),y(D,null,[o(e(Q),null,{default:s(()=>[o(e(w),null,{default:s(()=>[o(e(q),{class:"his-lg-text"},{default:s(()=>[f("Suspected causes")]),_:1})]),_:1})]),_:1}),o(e(te),{style:{overflowY:"hidden",background:"grey"}},{default:s(()=>[o(e(X),null,{default:s(()=>[o(e(Z),null,{default:s(()=>[o(e(j),null,{default:s(()=>[o(e(Y),{style:{overflowY:"auto",height:"78vh"}},{default:s(()=>[o(e(G),{modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=a=>n.value=a)},{default:s(()=>[(_(!0),y(D,null,V(t.value,(a,d)=>(_(),S(e(I),{class:"his-md-text",key:d},{default:s(()=>[o(e(x),{slot:"start",value:d},null,8,["value"]),o(e(E),null,{default:s(()=>[f(k(d),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(e(j),{style:{overflowY:"auto",height:"78vh"}},{default:s(()=>[n.value?(_(),y("div",de,[K("b",null,k(n.value),1),f(" causes ")])):L("",!0),n.value?(_(),S(e(Y),{key:1},{default:s(()=>[o(e(I),{class:"his-lg-text"},{default:s(()=>[o(e(E),null,{default:s(()=>[f("Current Medication(s)")]),_:1})]),_:1}),(_(!0),y(D,null,V(t.value[n.value].drugReason,(a,d)=>(_(),S(e(I),{class:"his-md-text",key:d},{default:s(()=>[o(e(E),null,{default:s(()=>[f(k(d),1)]),_:2},1024),o(e(ee),{onIonChange:A,slot:"start",modelValue:a.isChecked,"onUpdate:modelValue":b=>a.isChecked=b},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1})):L("",!0),n.value?(_(),S(e(G),{key:2,onIonChange:N,modelValue:t.value[n.value].otherReason,"onUpdate:modelValue":l[1]||(l[1]=a=>t.value[n.value].otherReason=a)},{default:s(()=>[o(e(I),{class:"his-lg-text"},{default:s(()=>[o(e(E),null,{default:s(()=>[f("Previous Medication")]),_:1})]),_:1}),o(e(I),{class:"his-md-text"},{default:s(()=>[o(e(E),null,{default:s(()=>[f("Other, not drug related")]),_:1}),o(e(x),{slot:"start",value:"Other"})]),_:1}),o(e(I),{class:"his-md-text"},{default:s(()=>[o(e(E),null,{default:s(()=>[f("Drug side effect")]),_:1}),o(e(x),{slot:"start",value:"Drug side effect"})]),_:1})]),_:1},8,["modelValue"])):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),o(e(ae),null,{default:s(()=>[o(e(w),null,{default:s(()=>[o(e(M),{onClick:m,slot:"start",size:"large",color:"danger"},{default:s(()=>[f(" Close ")]),_:1}),o(e(M),{onClick:T,size:"large",slot:"end",disabled:!R.value},{default:s(()=>[f(" Save ")]),_:1},8,["disabled"])]),_:1})]),_:1})],64))}}),pe=oe(fe,[["__scopeId","data-v-feb7a6c4"]]),be=B({__name:"Complications",setup(U){const n=C([]),t=new F(-1,se.COMPLICATIONS),v=C([]),R=C({}),m={pageOne:{"Abnominal pain":"ABNOMINAL_PAIN",Athralgia:"ATHRALGIA","Colour body fluids":"COLOUR_BODY_FLUIDS",Depression:"DEPRESSION",Fatigue:"FATIGUE",Gastrointestinal:"GASTROINTESTINAL",Headache:"HEADACHE","Hearing Difficulties":"HEARING_DIFFICULTIES",Hematological:"HEMATOLOGICAL",Hepatoxicity:"HEPATOXICITY",Hypothyroidism:"HYPOTHYROIDISM",Itching:"SKIN_ITCHING"},pageTwo:{Jaundice:"JAUNDICE","Lactic Acidosis":"LACTIC_ACIDOSIS",Numbness:"NUMBNESS_IN_HANDS_FEET_LEGS","Optic Neuritis":"OPTIC_NEURITIS",Pancreatitis:"PANCREATITIS","Periferal Neuropathy":"PERIFERAL_NEUROPATHY",Psychosis:"PSYCHOSIS","QT Prolongation":"QT_PROLONGATION","Renal failure":"RENAL_FAILURE","Skin Rash":"SKIN_RASH",Toxicity:"TOXICITY"}},{goToNextTask:T,patientDashboardUrl:A}=re((l,a)=>{t.patientID=a,t.providerID=l;function d(){let c=[];return{id:"history",helpText:"Side effects / Contraindications history",type:$.TT_TABLE_VIEWER,init:async()=>{const O=await F.getJson("programs/".concat(t.programID,"/patients/").concat(a,"/medication_side_effects"),{date:t.date});return Object.keys(O).forEach(i=>{c.push([le(i),Object.values(O[i]).flat(1).map(r=>"<b>".concat(r.name,"</b> ").concat(r.drug_induced?"(Drug-induced)":""," : ").concat(r.drug||"Unknown"," ")).join("<p/>")])}),!0},condition:()=>c.length,options:()=>[{label:"",value:"",other:{columns:["Date","Condition"],rows:c}}]}}function b(){return Object.keys(m).map((c,O)=>({id:c,helpText:"Page ".concat(O+1,": Contraindications / Side effects"),type:$.TT_MULTIPLE_YES_NO,init:async()=>(ne.isEmpty(v.value)&&(v.value=await F.getJson("patients/".concat(a,"/last_drugs_received"),{program_id:t.programID})),!0),beforeNext:async i=>{const r=i.filter(h=>h.value==="YES_ANSWER");if(r.length){const h=await H.create({component:pe,backdropDismiss:!1,cssClass:"large-modal",componentProps:{sideEffects:r,drugs:v.value}});h.present();const{data:g}=await h.onDidDismiss();if(!g)return!1;R.value[c]=g.values}return!0},validation:i=>P.validateSeries([()=>P.required(i),()=>P.anyEmpty(i)]),computedValue:i=>i.map(r=>({concept_id:p("MALAWI_TB_SIDE_EFFECTS"),value_coded:p("".concat(r.other.concept)),child:[{concept_id:p("".concat(r.other.concept)),value_coded:p("".concat(r.value)),obs_datetime:t.date}],obs_datetime:t.date})),options:i=>Object.keys(m[c]).map(r=>{var h,g;return{label:r,value:((g=(h=i[c])==null?void 0:h.find(W=>W.label===r))==null?void 0:g.value)||"",other:{concept:m[c][r],values:[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]}}}),config:{footerBtns:[{name:"None",slot:"end",onClickComponentEvents:{refreshOptions:()=>Object.keys(m[c]).map(i=>({label:i,value:"NO_ANSWER",other:{concept:m[c][i],values:[{value:"YES_ANSWER",label:"Yes"},{value:"NO_ANSWER",label:"No"}]}}))},onClick:()=>"None"}]}}))}n.value=[d(),...b()]});function N(){return Object.values(R.value).flat(1).map(a=>a.other&&/drug/i.test(a.other)?{concept_id:p("DRUG_INDUCED"),value_coded:p(a.concept),value_text:"Past medication history"}:a.drug?{concept_id:p("DRUG_INDUCED"),value_coded:p(a.concept),value_drug:a.drug.drug.drug_id}:{concept_id:p("CONTRAINDICATIONS"),value_coded:p(a.concept)})}async function u(l,a){await t.createEncounter(),await t.saveObservationList([...await ce(a),...N()]),T()}return(l,a)=>(_(),S(e(ue),null,{default:s(()=>[o(ie,{cancelDestinationPath:e(A),onFinishAction:u,fields:n.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{be as default};
