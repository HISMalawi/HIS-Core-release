System.register(["./index-legacy-BMlbNY-s.js","./index-legacy-D3Ffs9hJ.js"],(function(e,a){"use strict";var t,n,o,r,l,i,s,c,u,d,p,v,g,w,f,h,y,b,m,k,C,x,I,D;return{setters:[e=>{t=e.bB,n=e.d,o=e.r,r=e.at,l=e.o,i=e.cJ,s=e.a,c=e.E,u=e.C,d=e.K,p=e.a2,v=e.b,g=e.w,w=e.u,f=e.a8,h=e.cK,y=e.M,b=e.ah,m=e.R,k=e.W,C=e.aa},e=>{x=e.r,I=e.F,D=e.D}],execute:function(){var P=document.createElement("style");P.textContent="#update-notification[data-v-70fe1068]{opacity:.95;position:absolute;background:#e1fef2;color:#000;width:100vw;margin:auto;padding:1.6em;font-size:1.8rem;top:10%;left:50%;transform:translate(-50%,-50%);text-align:center;z-index:40}\n/*$vite$:1*/",document.head.appendChild(P);const U=x("CapacitorAppInstaller",{web:()=>t((()=>a.import("./web-legacy-BwQSkKlg.js")),void 0).then((e=>new e.CapacitorAppInstallerWeb))}),$={key:0,id:"update-notification"};e("default",C(n({__name:"ApkUpdateNotification",props:{checkInterval:{type:Number,default:36e5}},setup(e){const a=e,t=o(!1),n=o(""),C=o(""),x=new b,P=r((()=>!!C.value&&"-"!=C.value&&C.value!==n.value)),_=o("");function A(){C.value=n.value}async function S(){try{if(await async function(){try{const{publicStorage:e}=await I.checkPermissions();if("granted"!==e){const{publicStorage:e}=await I.requestPermissions();if("granted"!==e)return k("Permission to access storage is required to download the app."),!1}return!0}catch(e){return console.error(e),k("Unable to download the app. Please try again later"),!1}}()){t.value=!0,I.addListener("progress",(e=>{const a=Math.round(e.contentLength/1024),t=Math.round(e.bytes/1024),n=Math.round(e.bytes/e.contentLength*100);_.value=`Downloading... ${t}KB / ${a}KB (${n}%)`}));const e=await async function(){try{return(await I.downloadFile({url:await x.getApkDownloadLink(C.value),path:`Download/emr-${C.value}.apk`,directory:D.ExternalStorage,recursive:!0,progress:!0})).path}catch(e){console.error(e),k(e.toString())}}();if(t.value=!1,!e)throw new Error("Unable to download the app");m("Download completed. Installing the app..."),await async function(e){try{await U.install({file:e})}catch(a){console.error(a),k("Unable to install the app. Please try again later")}}(e),n.value=C.value}}catch(e){t.value=!1,console.error(e),k("Unable to update the app")}}return l((function(){i("mobile")&&i("android")&&setInterval((async()=>{P.value||(C.value=await x.getApkVersion(),n.value=x.getHeadVersion())}),a.checkInterval)})),(e,a)=>P.value?(s(),c("div",$,[a[2]||(a[2]=u(" New version (")),d("strong",null,p(C.value),1),a[3]||(a[3]=u(") update is available ")),a[4]||(a[4]=d("br",null,null,-1)),a[5]||(a[5]=d("br",null,null,-1)),v(w(f),{onClick:S,color:"success"},{default:g((()=>a[0]||(a[0]=[u(" Download Update ")]))),_:1}),a[6]||(a[6]=u("     ")),v(w(f),{onClick:A,color:"danger"},{default:g((()=>a[1]||(a[1]=[u(" Cancel ")]))),_:1}),v(w(h),{"is-open":t.value,message:_.value},null,8,["is-open","message"])])):y("",!0)}}),[["__scopeId","data-v-70fe1068"]]))}}}));
