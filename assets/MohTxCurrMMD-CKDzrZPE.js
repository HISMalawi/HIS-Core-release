import{_ as c}from"./ReportMixin.vue_vue_type_script_lang-CWVQISd9.js";import{T as f}from"./tx_report_service-Chxgcnmu.js";import{R as u}from"./TableReportTemplate-BuIqEVhG.js";import{d as w,I as M,L as i,cz as v,ab as A,_ as g,r as d,o as R,c as F,w as T,b as _}from"./index-BCfs_J-V.js";import{M as S}from"./moh_cohort_service-DTBN0wzb.js";import"./MultiFieldDateHelper-CW6lfYIk.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./BasicReportTemplate-Cx8Bs2Je.js";import"./Export-Ckt7Z8Mq.js";import"./SIngleTouchField-UCxZk0Bs.js";import"./Pagination-CEBNEafk.js";import"./HisStandardForm-DASCGMaQ.js";import"./TouchScreenForm-BEQyavf9.js";import"./ToolbarMediumCard-DFqt8bLl.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-CUJ1kut7.js";import"./ReportErrors-CN9j2LPZ.js";const C=w({mixins:[c],components:{ReportTemplate:u,IonPage:M},data:()=>({title:"Moh TX CURR MMD Report",cohort:{},rows:[],headerInfoList:[],totals:new Set,mohCohort:{},errors:[],showStatus:!1,aggregate:{Male:{},Female:{}},columns:[[i.thTxt("Age group"),i.thTxt("Gender"),i.thNum("# of clients on <3 months of ARVs"),i.thNum("# of clients on 3 - 5 months of ARVs"),i.thNum("# of clients on >= 6 months of ARVs")]],canValidate:!1}),created(){this.fields=this.getDateDurationFields()},watch:{async canValidate(t){t&&await this.validateReport()}},methods:{async onPeriod(t,e){this.canValidate=!1,this.rows=[],this.errors=[],this.showStatus=!1,this.report=new f,this.mohCohort=new S,this.mohCohort.setStartDate(e.start_date),this.mohCohort.setEndDate(e.end_date),this.mohCohort.setOccupation(e.occupation),this.report.setOrg("moh"),this.report.setOccupation(e.occupation),this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period=this.report.getDateIntervalPeriod(),await this.setMaleFemaleRows(),this.setTotalMalesRows(),await this.setTotalFemaleRows(),this.setHeaderInfoList(),this.canValidate=!0,this.showStatus=!0},setHeaderInfoList(){this.headerInfoList=[{label:"Total clients",value:this.totals.size,other:{onclick:()=>this.runTableDrill(Array.from(this.totals),"Total Clients")}}]},buildRow(t,e,s){const a={underThreeMonths:{check:o=>o<90,data:[]},betweenThreeAndFiveMonths:{check:o=>o>=90&&o<=150,data:[]},overSixMonths:{check:o=>o>150,data:[]}},n=t[s]||{};for(const o in n){const r=parseInt(o);this.totals.add(r),Object.keys(a).forEach(h=>{this.aggregate[s][h]||(this.aggregate[s][h]=[]),a[h].check(n[o].prescribed_days)&&(a[h].data.push(r),this.aggregate[s][h].push(r))})}return[i.td(e),i.td(s),this.drill(a.underThreeMonths.data,"".concat(e," (").concat(s,"s) < 3 months of Arvs")),this.drill(a.betweenThreeAndFiveMonths.data,"".concat(e," (").concat(s,"s) 3-5 months of Arvs")),this.drill(a.overSixMonths.data,"".concat(e," (").concat(s,"s) > 6 months months of Arvs"))]},async setMaleFemaleRows(){const t=[],e=[];for(const s of v){const[a,n]=this.parseAgeGroup(s),o=await this.report.getTxCurrMMDReport(a,n);this.report.initArvRefillPeriod(!1),e.push(this.buildRow(o,s,"Female")),t.push(this.buildRow(o,s,"Male")),this.rows=[...e,...t]}},setTotalMalesRows(){this.rows.push([i.td("All"),i.td("Male"),this.drill(this.aggregate.Male.underThreeMonths,"All (Males) < 3 months of Arvs"),this.drill(this.aggregate.Male.betweenThreeAndFiveMonths,"All (Males) 3-5 months of Arvs"),this.drill(this.aggregate.Male.overSixMonths,"All (Males) > 6 months months of Arvs")])},async setTotalFemaleRows(){const t=A.uniq(Object.values(this.aggregate.Female).flat(1)),e=await this.report.getMaternalStatus(t),s=e.FBf.concat(e.FP),a=(o,r,h)=>{const p=o.filter(m=>{const l=parseInt(m.toString());return r==="FNP"?!s.includes(l):e[r].includes(l)});return this.drill(p,h)},n=(o,r)=>{this.rows.push([i.td("All"),i.td(o),a(this.aggregate.Female.underThreeMonths,r,"All (".concat(o,"s) < 3 months of Arvs")),a(this.aggregate.Female.betweenThreeAndFiveMonths,r,"All (".concat(o,"s) 3-5 months of Arvs")),a(this.aggregate.Female.overSixMonths,r,"All (".concat(o,"s) > 6 months of Arvs"))])};n("FP","FP"),n("FNP","FNP"),n("FBF","FBf")},validateReport(){const t={total_alive_and_on_art:{param:this.totals.size,check:(s,a)=>s!=a,error:(s,a)=>"\n                        MoH cohort Alive and on ART clients <b>(".concat(s,")</b> is not\n                        matching with total TX MMD clients <b(").concat(a,").</b>\n                    ")}};this.mohCohort.validateIndicators(t,s=>this.errors=s)===-1&&(this.errors=["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])}}});function b(t,e,s,a,n,o){const r=d("report-template"),h=d("ion-page");return R(),F(h,null,{default:T(()=>[_(r,{title:t.title,period:t.period,rows:t.rows,fields:t.fields,columns:t.columns,reportPrefix:"MoH",config:{showIndex:!0},validationErrors:t.errors,showValidationStatus:t.showStatus,headerInfoList:t.headerInfoList,onReportConfiguration:t.onPeriod},null,8,["title","period","rows","fields","columns","validationErrors","showValidationStatus","headerInfoList","onReportConfiguration"])]),_:1})}const G=g(C,[["render",b]]);export{G as default};
