import{d as _,I as v,R as c,Y as n,q as m,V as u,aJ as h,_ as y,r as d,o as f,c as T,w as A,b as S}from"./index-CEHwIYqs.js";import{F as p}from"./dynamic-import-helper-Bsjrd6Ro.js";import{H as C}from"./HisStandardForm-CG-mBCAJ.js";import"./TouchScreenForm-CoH4BwNu.js";import"./ToolbarMediumCard-C9Oru3Lp.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-CUJZqAQw.js";const E=_({components:{HisStandardForm:C,IonPage:v},data:()=>({fields:[]}),created(){this.fields=[this.selectUser(),this.selectUserActivity(),this.limitUserSelection()]},methods:{onFinish(e,t){c.invalidate("CAN_EDIT_ACTIVITIES"),c.invalidate("ART_USER_SELECTED_ACTIVITIES");const a=Object.values(t).map(o=>n.postJson("user_properties",o));Promise.all(a).then(()=>this.$router.back()).catch(()=>m("Unable to update user activities"))},selectUser(){let e=[];return{id:"user_id",helpText:"Select Username",type:p.TT_SELECT,validation:t=>u.required(t),init:async()=>(e=await n.getAllUsers(),!0),options:()=>e.map(t=>({label:t.username,value:t.user_id,other:t})),config:{showKeyboard:!0}}},selectUserActivity(){var a,o;const e={},t=((o=(a=h)==null?void 0:a.getActiveApp())==null?void 0:o.primaryPatientActivites)||[];return{id:"activities",helpText:"Preset user activities",type:p.TT_MULTIPLE_SELECT,computedValue:(i,r)=>({user_id:r.user_id.value,property:"activities",property_value:i.map(s=>s.value).join(",")}),validation:i=>u.required(i),options:async i=>{if(!e[i.user_id.value])try{e[i.user_id.value]=(await n.getJson("user_properties",{user_id:i.user_id.value,property:"activities"})).property_value}catch(r){console.warn(r)}return t.map(r=>{const s=r.workflowID||r.name;return{value:s,label:"".concat(r.name).toUpperCase(),isChecked:"".concat(e[i.user_id.value]).split(",").some(l=>l.toLowerCase()===s.toLowerCase()),disabled:typeof r.availableOnActivitySelection=="boolean"?!r.availableOnActivitySelection:!1}})}}},limitUserSelection(){return{id:"lock_user_to_art_activities",helpText:"Can user modify activities?",type:p.TT_SELECT,computedValue:(e,t)=>({user_id:t.user_id.value,property:"lock_user_to_art_activities",property_value:e.value}),defaultValue:async e=>{try{return(await n.getJson("user_properties",{user_id:e.user_id.value,property:"lock_user_to_art_activities"})).property_value}catch(t){console.log(t)}},validation:e=>u.required(e),options:()=>[{label:"Yes",value:"Yes"},{label:"No",value:"No"}]}}}});function U(e,t,a,o,i,r){const s=d("his-standard-form"),l=d("ion-page");return f(),T(l,null,{default:A(()=>[S(s,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!0},null,8,["fields","onFinishAction"])]),_:1})}const F=y(E,[["render",U]]);export{F as default};
