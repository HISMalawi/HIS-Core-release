System.register(["./index-legacy-fdrleUji.js","./disaggregated_service-legacy-n9qCJh5d.js","./TableView-legacy-BPhMTcNP.js","./ArtDrilldown-legacy-BD2smx_i.js","./regimen_report_service-legacy-2KgABuLN.js","./moh_cohort_service-legacy-BgfmMYXB.js","./ReportErrors-legacy-BlsraabJ.js","./fuse-legacy-CQoBB3MK.js","./Export-legacy-B7nxS8zC.js","./HisKeyboard-legacy-C_C_WURj.js"],(function(e,t){"use strict";var a,r,o,n,l,s,g,i,c,u,d,p,b,v,y,f,m,h,_,D,w,x,A,F,P,R,$,j,q,G,k;return{setters:[e=>{a=e.d,r=e.I,o=e.cg,n=e.K,l=e.E,s=e.N,g=e.cn,i=e.ac,c=e.n,u=e.q,d=e.cQ,p=e.t,b=e.ci,v=e.O,y=e.ae,f=e.ch,m=e.cj,h=e.cl,_=e.ck,D=e._,w=e.r,x=e.o,A=e.c,F=e.w,P=e.b},e=>{R=e.D},e=>{$=e.v},e=>{j=e.A},e=>{q=e.R},e=>{G=e.M},e=>{k=e.R},null,null,null],execute:function(){const t=a({components:{IonPage:r,IonLoading:o,v2Datatable:$},setup(){const e=n(!1),t=n([]),a=n(""),r=n(""),o=n(!1),D=new R,w=new G,x=n([]),A=l(),F=async e=>{(await v.create({component:j,backdropDismiss:!1,cssClass:"large-modal",componentProps:{...e,subtitle:a.value,onFinish:()=>v.getTop().then((e=>e&&v.dismiss()))}})).present()},P=(e,t)=>({ref:t,label:e,defaultValue:"0",toValue:e=>e.length,tdClick:async e=>{e.refData.length&&F({patientIdentifiers:e.refData,title:`${e.data.age_group} ${e.data.gender} ${e.column.label}`})}}),$=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},P("TX curr (receiving ART)","tx_curr"),...q.reduce(((e,t)=>[...e,P(t,t)]),[]),P("Unknown","N/A"),P("Total (regimen)","regimen_total")]],O=[...q,"N/A"].reduce(((e,t)=>({...e,[t]:[]})),{}),B=function(e){const t=x.value.findIndex((t=>t.id===e.id));-1!==t?x.value[t]=e:x.value.push(e)},M=async function(e){const t="validationErrors";(await v.create({id:t,component:k,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:e}})).present(),B({id:t,text:`<b>${e.length}</b> validation errors detected`,icon:h,color:"danger",action:()=>M(e)})},T=async(a=!1)=>{if(!e.value)return u("Unable to generate report, return to cohort report");o.value=!0;const n=["Pregnant","Breastfeeding"],l={F:{label:"Female",rows:[],aggregate:{},excludedAgeGroups:n},M:{label:"Male",rows:[],aggregate:{},excludedAgeGroups:n},FP:{label:"Pregnant",rows:[],aggregate:{},gender:"F",ageGroup:"All",genderDisplay:"FP",excludedAgeGroups:[...d,"Breastfeeding"]},FBF:{label:"Breastfeeding",rows:[],aggregate:{},gender:"F",ageGroup:"All",genderDisplay:"FBF",excludedAgeGroups:[...d,"Pregnant"]}},s=(e=!1)=>{const a=Object.keys(l.FP.aggregate).reduce(((e,t)=>({...e,[t]:[...l.FP.aggregate[t]||[],...l.FBF.aggregate[t]||[]]})),{}),o=Object.keys(l.F.aggregate).reduce(((e,t)=>({...e,[t]:e[t].filter((e=>!Array.isArray(a[t])||!a[t].includes(e)))})),l.F.aggregate);t.value=[...l.F.rows,...l.M.rows,{age_group:"All",gender:"Male",...l.M.aggregate},...l.FP.rows,{age_group:"All",gender:"FNP",...o},...l.FBF.rows];const n=y.uniq([...l.M.aggregate.tx_curr||[],...l.F.aggregate.tx_curr||[]]),s={text:`Total alive and on ART: <b>${n.length}</b>`,icon:f,color:"primary",action:()=>F({patientIdentifiers:n,title:`Total alive and on ART: ${n.length}`})};e?(x.value=[s],(async e=>{const t={total_alive_and_on_art:{param:e.length,check:(e,t)=>e!=t,error:(e,t)=>`\n                        Total alive of <b>${t}</b>\n                        Does not match total alive of <b>${e}</b> on MOH report\n                    `}};-1===w.validateIndicators(t,(e=>{e.length?M(e):B({id:"reportOk",text:"<b>Report is consistent</b>",icon:_,color:"success"})}))&&M(["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])})(n)):x.value=[s,{text:r.value,icon:m,color:"dark"}]};try{if(D.setRebuildOutcome(a),!(await D.init()))return p("Unable to initialise report");for(const e of[...d,...n]){r.value=`Processing <b>${e}</b>`,D.setAgeGroup(e);const t=await D.getCohort();D.setRebuildOutcome(!1);for(const a of Object.keys(l)){if((l[a].excludedAgeGroups||[]).includes(e))continue;D.setGender(a),l[a].ageGroup&&D.setAgeGroup(l[a].ageGroup);const r=await D.getRegimenDistribution(),o={age_group:l[a]?.ageGroup||e,gender:l[a]?.genderDisplay||l[a].label,...t[e]?t[e][l[a]?.gender||a]:{},...O,...r,regimen_total:Object.values(r).flat(1)};l[a].rows.push(o),l[a].aggregate=Object.keys(o).reduce(((e,t)=>Array.isArray(o[t])?{...e,[t]:[...e[t]||[],...o[t]]}:e),l[a].aggregate),s(!1)}}s(!0),t.value=t.value.map(((e,t)=>({index:t+1,...e})))}catch(g){const e="Unable to generate report!";u(e),x.value=[{text:e,color:"danger",icon:b,action:function(){x.value=[{text:`Exception occured: <b>${g}</b>`,color:"danger",icon:b}]}}]}o.value=!1,r.value=""};return s((()=>{e.value=!!(A.query.start_date&&A.query.end_date&&A.query.quarter),e.value&&(D.setStartDate(`${A.query.start_date}`),D.setEndDate(`${A.query.end_date}`),D.setOccupation(`${A.query.occupation}`),w.setOccupation(D.occupation),w.setStartDate(D.startDate),w.setEndDate(D.endDate),a.value=`${g(D.startDate)} to ${g(D.endDate)}`,A.query.quarter&&(D.setQuarter(`${A.query.quarter}`),w.setQuarter(D.quarter),a.value=`${"Custom"===D.quarter?a.value:D.quarter}`),T())})),{Img:i,onRegenerate:async()=>T(await c("Do you want to rebuild report?")),headerBadge:x,reportData:t,isLoading:o,generate:T,columns:$,period:a}}});e("default",D(t,[["render",function(e,t,a,r,o,n){const l=w("ion-loading"),s=w("v2Datatable"),g=w("ion-page");return x(),A(g,null,{default:F((()=>[P(l,{"is-open":e.isLoading,message:"Please wait.."},null,8,["is-open"]),P(s,{"icon-url":e.Img("login-logos/Malawi-Coat_of_arms_of_arms.png"),title:"Disaggregated report","report-prefix":"MoH",subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onRefresh:e.onRegenerate,headerBadge:e.headerBadge},null,8,["icon-url","subtitle","columns","columnData","onRefresh","headerBadge"])])),_:1})}]]))}}}));
