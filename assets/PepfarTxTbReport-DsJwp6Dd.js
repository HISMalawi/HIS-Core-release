import{bB as T,ca as y,d as S,I as C,c2 as M,K as v,N,a9 as x,O as D,n as B,t as $,ab as O,q as I,_ as j,r as h,o as E,c as k,w as G,b as A}from"./index-ChqjXh1q.js";import{D as U}from"./ReportDateSelectionPrompt-Ct3nveNn.js";import{v as X}from"./TableView-D5d-HKAd.js";import{A as q}from"./ArtDrilldown-DTjYjRbw.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./MultiFieldDateHelper-BeB1wkpH.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./PopupKeyboard-h_Nt-BNV.js";import"./SIngleTouchField-BdybEVDH.js";import"./TouchScreenForm-Bp625zJI.js";import"./ToolbarMediumCard-NV07rtjo.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-DBgU2Ffk.js";import"./HisKeypad-WzzlrmYQ.js";import"./BaseKeyboard-pj9TNcmG.js";import"./KbHandler-BuQ4TFU6.js";import"./fuse-YdZE3OCN.js";import"./Export-C9Hhxwb2.js";import"./HisKeyboard-BFJHNqBd.js";import"./person_service-Cs2QGgAe.js";class L extends T{constructor(){super()}getTxTbReport(c){return this.getReport("programs/1/reports/tx_tb",{rebuild_outcome:c})}getMaternalStatus(c){const u={start_date:this.startDate,end_date:this.endDate,date:this.date,program_id:this.programID,report_definition:"pepfar"};this.occupation&&(u.occupation=this.occupation);const s=y.parameterizeObjToString(u);return T.postJson("vl_maternal_status?".concat(s),{patient_ids:c})}}const V=S({components:{IonPage:C,IonLoading:M,v2Datatable:X},setup(){const e=v([]),c=v(""),u=v(!1),s=new L,a=(g,l)=>({ref:l,label:g,toValue:r=>r.length,tdClick:async r=>{r.refData.length&&(await D.create({component:q,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:c,patientIdentifiers:r.refData,title:"".concat(r.data.ageGroup," ").concat(r.data.gender," ").concat(r.column.label),onFinish:()=>D.getTop().then(o=>o&&D.dismiss())}})).present()}}),w=[[{label:"#",ref:"index"},{label:"Age group",ref:"ageGroup"},{label:"Gender",ref:"gender"},a("TX_CURR","tx_curr"),a("Symptom Screen (alone)","symptom_screen_alone"),a("CXR screen","cxr_screen"),a("mWRD screen","mwrd_screen"),a("New on ART/Screen Positive","sceen_pos_new"),a("New on ART/Screen Negative","sceen_neg_new"),a("Already on ART/Screen Positive","sceen_pos_prev"),a("Already on ART/Screen Negative","sceen_neg_prev"),a("TB RX_New on ART","started_tb_new"),a("TB RX_Prev on ART","started_tb_prev")]],_=async()=>m(await B("Do you want to rebuild report?")),m=async(g=!1)=>{if(!(s.startDate&&s.endDate))return $("Start date and end date required!");u.value=!0,e.value=[];try{const l=await s.getTxTbReport(g),r={F:"Female",M:"Male"},o=Object.keys(l).reduce((t,i)=>{if(i==="Unknown")return t;const p=l[i];return Object.keys(p).forEach(n=>{t[n].rows.push({ageGroup:i,gender:r[n],...p[n]}),t[n].aggregate=Object.keys(p[n]).reduce((R,f)=>Array.isArray(p[n][f])?{...R,[f]:[...R[f]||[],...p[n][f]]}:R,t[n].aggregate)}),t},{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...o.F.rows,...o.M.rows,{ageGroup:"All",gender:"Male",...o.M.aggregate}];const F=Object.values(o.F.aggregate).reduce((t,i)=>t.concat(i),[]),b=await s.getMaternalStatus(O.uniq(F)),P=b.FBf.concat(b.FP);["FP","FNP","FBf"].forEach(t=>{e.value.push(Object.keys(o.F.aggregate).reduce((i,p)=>({...i,[p]:o.F.aggregate[p].filter(n=>t==="FNP"?!P.includes(n):b[t].includes(n))}),{ageGroup:"All",gender:t}))}),e.value=e.value.map((t,i)=>({index:i+1,...t}))}catch(l){console.error(l),I("Unable to generate report!")}u.value=!1},d=()=>U({onFinish:(g,l,r,o)=>{c.value="Period: ".concat(r),s.startDate=g,s.endDate=l,o&&s.setOccupation(o),m()}});return N(()=>d()),{Img:x,reportData:e,isLoading:u,onRefreshReport:_,configure:d,generate:m,columns:w,period:c}}});function W(e,c,u,s,a,w){const _=h("ion-loading"),m=h("v2Datatable"),d=h("ion-page");return E(),k(d,null,{default:G(()=>[A(_,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),A(m,{title:"Tx TB Report","icon-url":e.Img("login-logos/PEPFAR.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRefreshReport,"report-prefix":"Pepfar"},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh"])]),_:1})}const de=j(V,[["render",W]]);export{de as default};
