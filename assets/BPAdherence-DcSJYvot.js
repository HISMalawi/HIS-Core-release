import{d as K,bW as O,Y as z,X as F,_ as R,a3 as M,a7 as j,a8 as J,a4 as L,a9 as U,I as Y,ai as G,aN as W,aM as X,au as q,dl as x,aa as Q,c as y,w as s,af as u,a as o,b as r,K as n,E as a,J as p,G as m,M as b,C as w,a2 as C}from"./index-CMZASHAR.js";import{_ as Z}from"./EncounterMixin.vue_vue_type_script_lang-v2aYCq6R.js";import{B as v,H as B}from"./htn_service-B9DGYTze.js";import"./encounter_guidelines-CJXpBOk4.js";import"./GuidelineEngine-D6V1_Znr.js";import"./HisStandardForm-BCjM4-bc.js";const tt=K({mixins:[Z],components:{ViewPort:O,IonToolbar:z,IonHeader:F,IonContent:R,IonRow:M,IonInput:j,IonButton:J,IonCol:L,IonFooter:U,IonPage:Y,IonCheckbox:G},watch:{ready:{async handler(e){e&&(this.HTN=new v(this.patientID,this.providerID),this.drugs=this.HTN.getDrugs(),await this.getCurrentDrugs())},immediate:!0}},data:()=>({HTN:{},drugs:null}),methods:{onFinish(){this.selectNextAction()},goToPrescription(){this.$router.push("/art/encounters/bp_prescription/".concat(this.patientID))},gotoTreatment(){const e=this.selectedDrugs.map(h=>W.find(v.htnDrugReferences(),{drug_id:h.drugID})),t={};t[this.patientID]=e,sessionStorage.setItem(B.Prescription,JSON.stringify(t)),this.$router.push("/art/encounters/prescriptions/".concat(this.patientID))},async selectNextAction(){const e=await X("Action confirmation","Please specify how to proceed with patient",["Continue with current BP Drugs","Continue without BP Drugs","Change BP drugs"],[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(e.selection&&e.action!="Cancel")switch(e.selection){case"Continue without BP Drugs":return sessionStorage.removeItem(B.Prescription),this.nextTask();case"Continue with current BP Drugs":return this.gotoTreatment();case"Change BP drugs":this.goToPrescription()}},async getCurrentDrugs(){const e=await this.HTN.getCurrentDrugs(),t=await this.HTN.getLastDrugs();e.drugs.forEach(h=>{for(const i in this.drugs)this.drugs[i].drugs.forEach((k,_)=>{h.drug_id===k.drugID&&(this.drugs[i].drugs[_].current=!0,this.drugs[i].drugs[_].selected=!0,this.drugs[i].selected=h.drug_id);const c=this.drugs[i].drugs[_].drugName;Object.prototype.hasOwnProperty.call(t,c)&&(this.drugs[i].drugs[_].expectedRemaining=t[c].remaining,this.drugs[i].drugs[_].dispensed=t[c].value_numeric)})})},async launchKeyPad(e,t){(await q.create({component:x,backdropDismiss:!1,cssClass:"keypad-modal",componentProps:{strictNumbers:!0,onKeyPress:async i=>{const k=await this.HTN.getAdherence(this.drugs[e].drugs[t].drugID,i);this.drugs[e].drugs[t].adherence=k.adherence,this.drugs[e].drugs[t].remaining=i}}})).present()}},computed:{selectedDrugs(){return Object.values(this.drugs).map(e=>e.drugs).reduce((e,t)=>e.concat(t),[]).filter(e=>e.dispensed)}}}),et={key:0,class:"view-port-content"},nt={id:"main-table",style:{width:"100%"}},st={id:"table-notes",style:{width:"100%"}},ot={class:"date-td today-td"},rt={class:"date-td today-td"},at={class:"date-td today-td"},it={class:"date-td today-td"};function lt(e,t,h,i,k,_){const c=u("ion-col"),D=u("ion-row"),I=u("ion-toolbar"),T=u("ion-header"),$=u("ion-checkbox"),H=u("ion-input"),A=u("view-port"),S=u("ion-content"),P=u("ion-button"),V=u("ion-footer"),E=u("ion-page");return o(),y(E,null,{default:s(()=>[r(T,null,{default:s(()=>[r(I,null,{default:s(()=>[r(D,null,{default:s(()=>[r(c,null,{default:s(()=>t[0]||(t[0]=[n("label",{class:"his-title"}," BP Drug management ",-1)])),_:1})]),_:1})]),_:1})]),_:1}),r(S,null,{default:s(()=>[r(A,null,{default:s(()=>[e.drugs?(o(),a("div",et,[n("table",nt,[n("tr",null,[t[1]||(t[1]=n("th",null,"Â ",-1)),(o(!0),a(p,null,m(e.drugs,(l,d)=>(o(),a("th",{key:d},[w(C(d)+" ",1),r(D,null,{default:s(()=>[(o(!0),a(p,null,m(l.drugs,(g,f)=>(o(),y(c,{class:"col-borders",key:f},{default:s(()=>[w(C(g.amount||"0mg"),1)]),_:2},1024))),128))]),_:2},1024)]))),128))]),n("tr",null,[t[2]||(t[2]=n("td",{class:"td-current td-title"},[n("span",null,"Current")],-1)),(o(!0),a(p,null,m(e.drugs,(l,d)=>(o(),a("td",{class:"td-current td-value",key:d},[r(D,null,{default:s(()=>[(o(!0),a(p,null,m(l.drugs,(g,f)=>(o(),y(c,{key:f},{default:s(()=>[g.current?(o(),y($,{key:0,checked:g.current,disabled:""},null,8,["checked"])):b("",!0)]),_:2},1024))),128))]),_:2},1024)]))),128))]),n("tr",null,[t[3]||(t[3]=n("td",{class:"td-remaining td-title"},[n("span",null,"Pills remaining")],-1)),(o(!0),a(p,null,m(e.drugs,(l,d)=>(o(),a("td",{key:d,class:"td-current td-value"},[r(D,null,{default:s(()=>[(o(!0),a(p,null,m(l.drugs,(g,f)=>(o(),y(c,{key:f},{default:s(()=>[g.dispensed?(o(),y(H,{key:0,type:"number",modelValue:g.remaining,"onUpdate:modelValue":N=>g.remaining=N,onClick:N=>e.launchKeyPad(d,f)},null,8,["modelValue","onUpdate:modelValue","onClick"])):b("",!0)]),_:2},1024))),128))]),_:2},1024)]))),128))])]),t[7]||(t[7]=n("p",null,null,-1)),n("table",st,[t[4]||(t[4]=n("caption",{style:{"font-size":"1.4em"}}," Adherence summary ",-1)),t[5]||(t[5]=n("p",null,null,-1)),t[6]||(t[6]=n("tr",null,[n("th",{style:{width:"25%"}},[n("span",null,"Drug")]),n("th",{style:{width:"25%"}},[n("span",null,"Pills dispensed during last visit")]),n("th",{style:{width:"25%"}},[n("span",null,"Expected pills remaining")]),n("th",{style:{width:"25%"}},[n("span",null,"Adherence for drug")])],-1)),(o(!0),a(p,null,m(e.selectedDrugs,(l,d)=>(o(),a("tr",{key:d,class:"dispensation-row"},[n("td",ot,C(l.drugName),1),n("td",rt,C(l.dispensed),1),n("td",at,C(l.expectedRemaining),1),n("td",it,C(l.adherence?"".concat(l.adherence," %"):"?"),1)]))),128))])])):b("",!0)]),_:1})]),_:1}),r(V,null,{default:s(()=>[r(I,{color:"dark"},{default:s(()=>[r(P,{size:"large",color:"danger",slot:"start",onClick:e.gotoPatientDashboard},{default:s(()=>t[8]||(t[8]=[w(" cancel ")])),_:1},8,["onClick"]),r(P,{size:"large",color:"primary",slot:"end",onClick:e.goToPrescription},{default:s(()=>t[9]||(t[9]=[w(" Change drugs ")])),_:1},8,["onClick"]),r(P,{size:"large",color:"success",slot:"end",onClick:e.onFinish},{default:s(()=>t[10]||(t[10]=[w(" Continue ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const ht=Q(tt,[["render",lt],["__scopeId","data-v-2e3ec445"]]);export{ht as default};
