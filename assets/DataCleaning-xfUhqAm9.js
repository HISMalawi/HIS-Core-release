import{C as r,D as l}from"./data_cleaning_report_service-wYKFrdKB.js";import{_ as f}from"./ReportMixin.vue_vue_type_script_lang-BFLFjbJ1.js";import{R as T}from"./TableReportTemplate-DTUeDl0J.js";import{d as g,m as w,aA as t,dD as d,z as u,cw as m,a_ as b,an as x,ao as R,b0 as p,S as c,am as v,a as S,w as I,ar as D,b as A,e as C}from"./index-qFt4YszW.js";import{v as E}from"./TableView-Dd0ekOnk.js";import"./BasicReportTemplate-Cv5LTxdO.js";import"./Export-CDLTNdY8.js";import"./index-BckLFmVa.js";import"./Pagination-CAVMmFhb.js";import"./HisStandardForm-B3LOSMqB.js";import"./ReportErrors-DWdHzp12.js";const y=g({mixins:[f],components:{ReportTemplate:T,IonPage:w},data:()=>({title:"Data cleaning report",rows:[],columns:[]}),created(){this.fields=[{id:"indicator",helpText:"Select indicator",type:R.TT_SELECT,requireNext:!1,validation:a=>x.required(a),options:()=>this.getIndicatorOptions()},...p({id:"start_date",helpText:"Start",required:!0,condition:a=>!a.indicator.other.skipDateSelection,minDate:()=>"2001-01-01",maxDate:()=>c.getSessionDate(),estimation:{allowUnknown:!1},computeValue:a=>a}),...p({id:"end_date",helpText:"End",required:!0,condition:a=>!a.indicator.other.skipDateSelection,minDate:(a,e)=>e.start_date,maxDate:()=>c.getSessionDate(),estimation:{allowUnknown:!1},computeValue:a=>a})]},methods:{async onPeriod(a,e){this.rows=[],this.title=a.indicator.label;const i=a.indicator;this.columns=i.other.columns,await i.other.setRows(a,e)},masterCardBtn(a){return t.tdBtn("View",()=>this.$router.push("/art/mastercard/".concat(a)))},getDefaultIndicatorColumns(a=[]){return[[t.thTxt("ARV Number"),t.thTxt("Patient Id"),t.thTxt("First Name"),t.thTxt("Last Name"),t.thTxt("Gender"),t.thTxt("Date of birth"),...a,t.thTxt("Action")]]},async setDefaultIndicatorRows(a,e,i,s=null){this.report=new l,this.report.setStartDate(e),this.report.setEndDate(i),this.period=this.report.getDateIntervalPeriod();const n=this.sortByArvNumber(await this.report.getCleaningToolReport(a)||[],"arv_number");b.isEmpty(n)||n.forEach(o=>{const h=typeof s=="function"?s(o):[];this.rows.push([t.td(o.arv_number),t.td(o.patient_id),t.td(o.given_name),t.td(o.family_name),t.td(this.formatGender(o.gender)),t.tdDate(o.birthdate),...h,this.masterCardBtn(o.patient_id)])})},getIndicatorOptions(){return[{label:"DOB > Date enrolled",value:r.DobMoreThanEnrolledDate,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns(),setRows:(a,e)=>this.setDefaultIndicatorRows(r.DobMoreThanEnrolledDate,e.start_date,e.end_date)}},{label:"Date enrolled < Earliest start date",value:r.DateEnrolledLessThanEarliestStartDate,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns([t.thTxt("Earliest start date"),t.thTxt("Date enrolled")]),setRows:(a,e)=>this.setDefaultIndicatorRows(r.DateEnrolledLessThanEarliestStartDate,e.start_date,e.end_date,i=>[t.tdDate(i.earliest_start_date),t.tdDate(i.date_enrolled)])}},{label:"Encounters after Death",value:r.ClientsWithEncountersAfterDeath,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns(),setRows:(a,e)=>this.setDefaultIndicatorRows(r.ClientsWithEncountersAfterDeath,e.start_date,e.end_date)}},{label:"Incomplete visits",value:"Incomplete visits",other:{skipDateSelection:!1,columns:[[t.thTxt("ARV#"),t.thTxt("NHID"),t.thTxt("First name"),t.thTxt("Last name"),t.thTxt("Gender"),t.thTxt("Birthdate"),t.thTxt("Date(s)"),t.thTxt("Action")]],setRows:async(a,e)=>{this.report=new l,this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period=this.report.getDateIntervalPeriod();const i=await this.report.getIncompleteVisits();for(const s in i){const n=i[s];this.rows.push([t.td(n.arv_number),t.td(n.national_id),t.td(n.given_name),t.td(n.family_name),t.td(this.formatGender(n.gender)),t.tdDate(n.birthdate),t.td(n.dates.map(o=>this.toDate(o)).join("<br/>")),this.masterCardBtn(parseInt(s.toString()))])}}}},{label:"Enrolled on ART before birth",value:"Enrolled on ART before birth",other:{skipDateSelection:!0,columns:[[t.thTxt("ARV number"),t.thTxt("Name"),t.thTxt("Earliest start date"),t.thTxt("Date enrolled"),t.thTxt("Gender"),t.thTxt("Birth Date"),t.thTxt("Action")]],setRows:async()=>{try{this.report=new l,(await this.report.getEnrolledOnArtBeforeBirth()).forEach(e=>{this.rows.push([t.td(e.identifier),t.td(e.name),t.tdDate(e.earliest_start_date),t.tdDate(e.date_enrolled),t.td(this.formatGender(e.gender)),t.tdDate(e.birthdate),this.masterCardBtn(e.patient_id)])})}catch(a){if(!(a instanceof d))throw a}}}},{label:"Missing VL Results",value:"Missing VL Results",other:{columns:[[t.thTxt("ARV number"),t.thTxt("First name"),t.thTxt("Last name"),t.thTxt("Gender"),t.thTxt("Accession number"),t.thTxt("Order date"),t.thTxt("Action")]],setRows:async(a,e)=>{try{this.report=new l,this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period=this.report.getDateIntervalPeriod(),(await this.report.getCleaningToolReport(r.MissingVlResults)).forEach(s=>{this.rows.push([t.td(s.arv_number),t.td(s.given_name),t.td(s.family_name),t.td(this.formatGender(s.gender)),t.td(s.accession_number),t.tdDate(s.order_date),this.masterCardBtn(s.patient_id)])})}catch(i){if(!(i instanceof d))throw i}}}},{label:"Male patients with female observations",value:r.MalesWithFemaleObs,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns([t.thTxt("Visit date")]),setRows:(a,e)=>this.setDefaultIndicatorRows(r.MalesWithFemaleObs,e.start_date,e.end_date,i=>[(()=>{const s="".concat(i.visit_date).split(",");return s.length<=1?t.tdDate(i.visit_date):t.tdLink("".concat(s.length," visits dates"),async()=>{(await u.create({component:E,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"".concat(s.length," visit dates"),columns:[[{label:"ARV",ref:"arv_number"},{label:"Given name",ref:"given_name"},{label:"Family name",ref:"family_name"},{label:"Visit date",ref:"visit_date"}]],columnData:s.map(n=>({...i,visit_date:m(n)})),onFinish:()=>u.dismiss()}})).present()})})()])}},{label:"Missing important demographics elements",value:r.MissingDemographics,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns(),setRows:(a,e)=>this.setDefaultIndicatorRows(r.MissingDemographics,e.start_date,e.end_date)}},{label:"Missing start reason",value:r.MissingStartReasons,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns(),setRows:(a,e)=>this.setDefaultIndicatorRows(r.MissingStartReasons,e.start_date,e.end_date)}},{label:"Missing ART start date",value:r.MissingArtStartDate,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns(),setRows:(a,e)=>this.setDefaultIndicatorRows(r.MissingArtStartDate,e.start_date,e.end_date)}},{label:"Multiple start reasons",value:r.MultipleStartReasons,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns([t.thTxt("Reasons"),t.thTxt("Visits")]),setRows:(a,e)=>this.setDefaultIndicatorRows(r.MultipleStartReasons,e.start_date,e.end_date,i=>[t.td("".concat(i.reasons).split(",").join("<p/>")),t.td(i.visits.split(",").map(s=>m(s)).join("<p/>"))])}},{label:"Patients with Pre-ART / Unknown outcome",value:r.PreArtOrUnknownOutcomes,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns(),setRows:(a,e)=>this.setDefaultIndicatorRows(r.PreArtOrUnknownOutcomes,e.start_date,e.end_date)}},{label:"Prescriptions without dispensations",value:r.PrescriptionWithoutDispensation,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns([t.thTxt("Visit Date")]),setRows:(a,e)=>this.setDefaultIndicatorRows(r.PrescriptionWithoutDispensation,e.start_date,e.end_date,i=>[t.tdDate(i.visit_date)])}},{label:"Different pregnancy value on same date",value:r.DifferentPregnancyValueOnSameDate,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns([t.thTxt("Visit Date")]),setRows:(a,e)=>this.setDefaultIndicatorRows(r.DifferentPregnancyValueOnSameDate,e.start_date,e.end_date,i=>[t.tdDate(i.visit_date)])}},{label:"Active Clients with Adverse Outcomes",value:r.ActiveClientsWithAdverseOutcomes,other:{skipDateSelection:!1,columns:[[t.thTxt("ARV number"),t.thTxt("Filling Number"),t.thTxt("Outcome"),t.thTxt("Outcome Date"),t.thTxt("Last Dispensation Date"),t.thTxt("Action")]],setRows:async(a,e)=>{try{this.report=new l,this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period=this.report.getDateIntervalPeriod(),(await this.report.getCleaningToolReport(r.ActiveClientsWithAdverseOutcomes)).forEach(s=>{this.rows.push([t.td(s.arv_number),t.td(s.filling_number),t.td(s.outcome),t.td(this.toDate(s.outcome_date)),t.td(this.toDate(s.dispensation_visit_date)),this.masterCardBtn(s.patient_id)])})}catch(i){if(!(i instanceof d))throw i}}}},{label:"DOB >= ART Start Date",value:r.StartDateBeforeDob,other:{skipDateSelection:!1,columns:this.getDefaultIndicatorColumns([t.thTxt("Earliest Start Date")]),setRows:(a,e)=>this.setDefaultIndicatorRows(r.StartDateBeforeDob,e.start_date,e.end_date,i=>[t.tdDate(i.art_start_date)])}},{label:"Clients on ART without HIV Program",value:r.ClientsOnArtWithoutHivProgram,other:{columns:[[t.thTxt("#"),t.thTxt("ART Number"),t.thTxt("Date of Birth (DOB)"),t.thTxt("ART Start Date"),t.thTxt("Last ART Dispensation"),t.thTxt("Action")]],setRows:async(a,e)=>{try{this.report=new l,this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period=this.report.getDateIntervalPeriod(),(await this.report.getCleaningToolReport(r.ClientsOnArtWithoutHivProgram)).forEach((s,n)=>{this.rows.push([t.td(n+1),t.td(s.arv_number),t.tdDate(s.birthdate),t.tdDate(s.art_start_date),t.tdDate(s.last_art_dispensation_date),t.tdBtn("View",()=>this.$router.push("/patient/programs/".concat(s.patient_id)))])})}catch(i){if(!(i instanceof d))throw i}}}},{label:"Dispensed Implausible Amounts",value:r.DipensationImplausibleAmounts,other:{columns:[[t.thTxt("#"),t.thTxt("ART Number"),t.thTxt("Gender"),t.thTxt("Date of Birth (DOB)"),t.thTxt("ART Start Date"),t.thTxt("Regimen"),t.thTxt("Amount dispensed"),t.thTxt("Date Dispensed"),t.thTxt("User"),t.thTxt("Next appointment"),t.thTxt("Action")]],setRows:async(a,e)=>{try{this.report=new l,this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period=this.report.getDateIntervalPeriod(),(await this.report.getCleaningToolReport(r.DipensationImplausibleAmounts)).forEach((s,n)=>{this.rows.push([t.td(n+1),t.td(s.arv_number),t.td(s.gender),t.tdDate(s.birthdate),t.tdDate(s.start_date),t.td(s.regimen),t.td(s.amount_dispensed),t.tdDate(s.date_dispensed),t.td(s.dispensing_user),t.tdDate(s.next_appointment),this.masterCardBtn(s.patient_id)])})}catch(i){if(!(i instanceof d))throw i}}}}]}}});function k(a,e,i,s,n,o){const h=D("report-template"),_=D("ion-page");return A(),S(_,null,{default:I(()=>[C(h,{title:a.title,period:a.period,rows:a.rows,fields:a.fields,columns:a.columns,showFilters:!0,onReportConfiguration:a.onPeriod},null,8,["title","period","rows","fields","columns","onReportConfiguration"])]),_:1})}const U=v(y,[["render",k]]);export{U as default};
