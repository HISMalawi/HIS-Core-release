import{d as D,r as l,c as N,o as B,s as g,A as L,h as x,a6 as M,b as K,j as n,g as f,e as d,t as $,w,f as p,i as m,v as q,ak as E,al as F,p as T,q as s,am as j}from"./index-qFt4YszW.js";import{F as c,D as z}from"./index-BckLFmVa.js";import{C as G}from"./index-D3Br_Sz6.js";const y=o=>(E("data-v-70fe1068"),o=o(),F(),o),H={key:0,id:"update-notification"},W=y(()=>f("br",null,null,-1)),J=y(()=>f("br",null,null,-1)),O=D({__name:"ApkUpdateNotification",props:{checkInterval:{type:Number,default:36e5}},setup(o){const _=o,r=l(!1),i=l(""),a=l(""),u=new L,v=N(()=>!!a.value&&a.value!="-"&&a.value!==i.value),h=l("");B(b);function b(){g("mobile")&&g("android")&&setInterval(async()=>{v.value||(a.value=await u.getApkVersion(),i.value=u.getHeadVersion())},_.checkInterval)}function k(){a.value=i.value}async function I(){try{if(await P()){r.value=!0,S();const e=await U();if(r.value=!1,!e)throw new Error("Unable to download the app");T("Download completed. Installing the app..."),await V(e),i.value=a.value}}catch(e){r.value=!1,console.error(e),s("Unable to update the app")}}async function P(){try{const{publicStorage:e}=await c.checkPermissions();if(e!=="granted"){const{publicStorage:t}=await c.requestPermissions();if(t!=="granted")return s("Permission to access storage is required to download the app."),!1}return!0}catch(e){return console.error(e),s("Unable to download the app. Please try again later"),!1}}async function U(){try{return(await c.downloadFile({url:await u.getApkDownloadLink(a.value),path:"Download/emr-".concat(a.value,".apk"),directory:z.ExternalStorage,recursive:!0,progress:!0})).path}catch(e){console.error(e),s(e.toString())}}function S(){c.addListener("progress",e=>{const t=Math.round(e.contentLength/1024),A=Math.round(e.bytes/1024),C=Math.round(e.bytes/e.contentLength*100);h.value="Downloading... ".concat(A,"KB / ").concat(t,"KB (").concat(C,"%)")})}async function V(e){try{await G.install({file:e})}catch(t){console.error(t),s("Unable to install the app. Please try again later")}}return(e,t)=>v.value?(K(),x("div",H,[n(" New version ("),f("strong",null,$(a.value),1),n(") update is available "),W,J,d(p(m),{onClick:I,color:"success"},{default:w(()=>[n(" Download Update ")]),_:1}),n("     "),d(p(m),{onClick:k,color:"danger"},{default:w(()=>[n(" Cancel ")]),_:1}),d(p(q),{"is-open":r.value,message:h.value},null,8,["is-open","message"])])):M("",!0)}}),Y=j(O,[["__scopeId","data-v-70fe1068"]]);export{Y as default};
