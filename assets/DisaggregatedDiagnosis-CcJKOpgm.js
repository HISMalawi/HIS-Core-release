import{d as X,Q as te,U as oe,aZ as ne,a0 as se,R as ae,O as le,a3 as re,a4 as ie,S as ce,cL as ue,ap as _e,r as v,ar as I,aI as de,cQ as he,cR as fe,cS as pe,cT as me,cU as ge,dL as ye,b6 as be,al as L,bw as ve,aL as S,a8 as x,ad as g,u as f,B as y,x as _,w as h,z as V,Y as P,G as U,a1 as w,v as j,E,C as B,b0 as Ce,a5 as Fe,cn as Me,t as De,as as N,aA as we,c$ as z,ab as J,ac as K}from"./index-B-uGcoDO.js";import{b as $e,t as ke}from"./Export-BZxxduDX.js";import{A as Te}from"./aetc_report_service-DLeg0BTh.js";import{D as Le}from"./DrillPatientIds-x6UB8wdq.js";import"./index-BPDmfKXx.js";import"./TableView-AP427VQ3.js";const Ae=X({components:{IonToolbar:te,IonItem:oe,IonIcon:ne,IonLabel:se,IonTitle:ae,IonHeader:le,IonButton:re,IonFooter:ie,IonContent:ce,IonButtons:ue},props:{title:{type:String,default:"Report"},subtitle:{type:String},columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},onFinish:{type:Function},onRefresh:{type:Function},onConfigure:{type:Function},csvQuarter:{type:String},headers:{type:Array,default:()=>[]},order:{type:Array,default:()=>[]},csvSpacing:{type:Number},csvSubHeader:{type:Array,default:()=>[]}},setup(o){const b=_e(),$=v([]),k=v(""),C=v("desc"),d=I(()=>o.columns.slice(0,2)),F=I(()=>{var a;const n=[];return(a=o.columnData)==null||a.forEach(l=>{const i=o.columns[2].map(r=>{let s="";try{S.isEmpty(l)?s="...":typeof r.value=="function"?s=r.value(l):s=l[r.ref]||""}catch(u){s="_ERROR_",console.error(u)}return{column:r,data:l,value:s,[r.ref||"nada"]:s}});n.push({row:i,data:l,searchIndex:[...i,i.map(r=>r.value).join(" ")]})}),n}),e=I(()=>{var a;const n=[];return(a=o.columnData[1])==null||a.forEach(l=>{const i=o.columns[2].map(r=>{let s="";try{S.isEmpty(l)?s="...":typeof r.value=="function"?s=r.value(l):s=l[r.ref]||""}catch(u){s="_ERROR_",console.error(u)}return{column:r,data:l,value:s,[r.ref||"nada"]:s}});n.push({row:i,data:l,searchIndex:[...i,i.map(r=>r.value).join(" ")]})}),n}),t=I(()=>{var a;const n=[];return(a=o.columnData[2])==null||a.forEach(l=>{const i=o.columns[3].map(r=>{let s="";try{S.isEmpty(l)?s="...":typeof r.value=="function"?s=r.value(l):s=l[r.ref]||""}catch(u){s="_ERROR_",console.error(u)}return{column:r,data:l,value:s,[r.ref||"nada"]:s}});n.push({row:i,data:l,searchIndex:[...i,i.map(r=>r.value).join(" ")]})}),n}),p=I(()=>{var a;const n=[];return(a=o.columnData[3])==null||a.forEach((l,i)=>{const r=o.columns[8+i].map(s=>{let u="";try{S.isEmpty(l)?u="...":typeof s.value=="function"?u=s.value(l):u=l[s.ref]||""}catch(ee){u="_ERROR_",console.error(ee)}return{column:s,data:l,value:u,[s.ref||"nada"]:u}});n.push({row:r,data:l,searchIndex:[...r,r.map(s=>s.value).join(" ")]})}),n}),m=n=>{k.value=n,C.value=C.value==="asc"?"desc":"asc"},M=()=>{typeof o.onFinish=="function"?o.onFinish():b.push("/")},T=n=>{var a,l;try{typeof((a=n.column)==null?void 0:a.tdClick)=="function"&&((l=n.column)==null||l.tdClick(n));return}catch(i){console.error(i)}},H=()=>o.columns.reduce((n,a)=>n.concat(a),[]).filter(n=>n.value||n.ref),Y=()=>{var a;const n=(a=window==null?void 0:window.document)==null?void 0:a.getElementById("report-content");$e("\n                <html>\n                    <head> \n                        <style> \n                        table {\n                            border-collapse: collapse;\n                        }\n                        th, td {\n                            width: 4%;\n                            text-align: center;\n                            border: solid 1px black;\n                        }\n                        td {\n                            border-bottom: 1px solid rgb(165, 165, 165);\n                            padding: 0.6em;\n                            font-weight: 500;\n                            font-size: .8em;\n                        }\n                        </style>    \n                    </head>\n                <body> \n                 ".concat(n.innerHTML,"    \n                </body>\n                </html>\n            "))},O=n=>{for(const a in n)Array.isArray(n[a])?n[a]=n[a].length:typeof n[a]=="object"&&O(n[a])},D=n=>{const a=[];for(const l in n)if(Object.prototype.hasOwnProperty.call(n,l)){const i=[l],r=Object.values(n[l]);for(const s of r)i.push(s);a.push(i)}return a},A=n=>{const a=[];for(const l of n){const i=[];for(let s=0;s<l.length;s++)typeof l[s]=="object"?(i.push(l[s].M),i.push(l[s].F)):s>0&&i.push(l[s]);const r=i.slice(-2).reduce((s,u)=>s+(typeof u=="number"?u:0),0);i.push(r),a.push(i)}return n.length=0,n.push(...a),n},c=()=>{const a=(i=>{const r=JSON.parse(JSON.stringify(i));O(r);const s=D(r);return A(s)})(o.columnData);console.log("CSV ARRAY  ",a);const l="".concat(L.getLocationName()||"Unknown site","-").concat(o.title,"-").concat(o.subtitle,"-").concat(L.getSessionDate());ke([o.headers],[...a,["Date Created: ".concat(ve().format("DD/MMM/YYYY HH:MM:ss"))],["Quarter: ".concat(o.csvQuarter||o.subtitle)],["HIS-Core Version: ".concat(L.getCoreVersion())],["API Version: ".concat(L.getApiVersion())],["Site UUID: ".concat(L.getSiteUUID())],["Generated by: ".concat(L.getUserName())]],l)},R=n=>{n.forEach(a=>{const l=H().map(i=>{let r="";try{S.isEmpty(a)?r="...":typeof i.value=="function"?r=i.value(a):r=a[i.ref]||""}catch(s){r="_ERROR_",console.error(s)}return{column:i,data:a,value:r,[i.ref||"nada"]:r}});$.value.push({row:l,data:a,searchIndex:[...l,l.map(i=>i.value).join(" ")]})})};return de(()=>o.columnData,n=>{$.value=[],Array.isArray(n)&&R(n)},{immediate:!0,deep:!0}),{sortColumn:m,onClickTablecell:T,toPDF:Y,toCSV:c,finish:M,columnsMinusOne:d,sync:he,search:fe,close:pe,arrowUp:me,arrowDown:ge,document:ye,calendar:be,sortOrder:C,reportBody:F,sectionTwo:e,sectionThree:t,sectionTotals:p,columnSorted:k}}}),Re={key:0},Ie={class:"his-sm-text"},Se={id:"report-content"},Ee={class:"art-report-theme"},Oe={class:"stick-report-header"},Ve=["colspan","rowspan","onClick"],Pe=["onClick"],Ue={class:"his-sm-text"};function Be(o,b,$,k,C,d){const F=g("ion-title"),e=g("ion-icon"),t=g("ion-button"),p=g("ion-buttons"),m=g("ion-toolbar"),M=g("ion-header"),T=g("ion-label"),H=g("ion-item"),Y=g("ion-content"),O=g("ion-footer");return f(),y(E,null,[_(M,null,{default:h(()=>[_(m,null,{default:h(()=>[_(F,{class:"his-md-text"},{default:h(()=>[V(P(o.title)+" ",1),o.subtitle?(f(),y("br",Re)):U("",!0),w("span",Ie,P(o.subtitle),1)]),_:1}),_(p,{slot:"end"},{default:h(()=>[typeof o.onConfigure=="function"?(f(),j(t,{key:0,onClick:o.onConfigure},{default:h(()=>[_(e,{size:"large",icon:o.calendar},null,8,["icon"])]),_:1},8,["onClick"])):U("",!0),typeof o.onRefresh=="function"?(f(),j(t,{key:1,onClick:o.onRefresh,color:"success",size:"large"},{default:h(()=>[_(e,{size:"large",icon:o.sync},null,8,["icon"])]),_:1},8,["onClick"])):U("",!0)]),_:1})]),_:1})]),_:1}),_(Y,{"scroll-y":"","scroll-x":""},{default:h(()=>[w("div",Se,[w("table",Ee,[w("thead",Oe,[(f(!0),y(E,null,B(o.columnsMinusOne,(D,A)=>(f(),y("tr",{key:A},[(f(!0),y(E,null,B(D,(c,R)=>{var n,a;return f(),y("th",{key:R,colspan:((n=c==null?void 0:c.span)==null?void 0:n.thColspan)||1,rowspan:((a=c==null?void 0:c.span)==null?void 0:a.thRowspan)||1,onClick:l=>o.sortColumn(c.ref)},[_(H,{lines:"none"},{default:h(()=>[o.columnSorted&&o.columnSorted===c.ref?(f(),j(e,{key:0,icon:o.sortOrder==="asc"?o.arrowUp:o.arrowDown},null,8,["icon"])):U("",!0),_(T,{class:"ion-text-center"},{default:h(()=>[w("b",null,P(c.label),1)]),_:2},1024)]),_:2},1024)],8,Ve)}),128))]))),128))]),w("tbody",null,[(f(!0),y(E,null,B(o.reportBody,(D,A)=>(f(),y("tr",{key:A},[(f(!0),y(E,null,B(D.row||[],(c,R)=>{var n;return f(),y("td",{key:R,onClick:()=>o.onClickTablecell(c),class:Ce({"clickable-cell":(n=c==null?void 0:c.column)==null?void 0:n.tdClick})},[w("b",Ue,P(c.value),1)],10,Pe)}),128))]))),128))])])])]),_:1}),_(O,null,{default:h(()=>[_(m,{color:"dark"},{default:h(()=>[_(t,{onClick:b[0]||(b[0]=D=>o.toCSV()),size:"large"},{default:h(()=>[V(" CSV ")]),_:1}),_(t,{onClick:b[1]||(b[1]=D=>o.toPDF()),size:"large"},{default:h(()=>[V(" PDF ")]),_:1}),_(t,{onClick:o.finish,color:"success",size:"large",slot:"end"},{default:h(()=>[V(" Finish ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const Ne=x(Ae,[["render",Be],["__scopeId","data-v-e2910d5b"]]),q=v([]),Q=v(""),G=v(""),W=v(""),ze=v(!1),Z=v(""),Qe=X({components:{IonPage:Fe,IonLoading:Me,v2Datatable:Ne},setup(){const o=async()=>{const e=new Te;e.startDate=Q.value,e.endDate=G.value;try{const t=await e.getClinicReport("DISAGGREGATED_DIAGNOSIS");q.value=k(t)}catch(t){console.log(t)}},b=["Diagnosis","<6 Months> M","<6 Months> F","6 Months to < 5 M","6 Months to < 5 F","5 to 14 F","5 to 14 M",">14 M",">14 F","Total by gender M","Total by gender F","Total"],$=[[{label:"Diagnosis",ref:"",span:{thRowspan:2}},{label:"<6 Months>",ref:"",span:{thColspan:2}},{label:"6 Months to < 5",ref:"",span:{thColspan:2}},{label:"5 to 14",ref:"",span:{thColspan:2}},{label:">14",ref:"",span:{thColspan:2}},{label:"Total by gender",ref:"",span:{thColspan:2}},{label:"Total",ref:"",span:{thRowspan:2}}],[{label:"M",ref:""},{label:"F",ref:""},{label:"M",ref:""},{label:"F",ref:""},{label:"M",ref:""},{label:"F",ref:""},{label:"M",ref:""},{label:"F",ref:""},{label:"M",ref:""},{label:"F",ref:""}],[{label:"Diagnosis",ref:"data.diagnosis",value:e=>e.diagnosis},{label:"< 6 months M",ref:"data.< 6 months.M.length",secondaryLabel:"< 6 months Male diagnosed with",value:e=>e.ls_6_months.M.length,tdClick:({column:e,data:t})=>d("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.ls_6_months.M)},{label:"<6 months F",ref:"data.ls_6_months.F.length",secondaryLabel:"< 6 months Female diagnosed with",value:e=>e.ls_6_months.F.length,tdClick:({column:e,data:t})=>d("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.ls_6_months.F)},{label:"6 months to < 5",ref:"data.i6_months_to_ls_5.M.length",secondaryLabel:"6 months to < 5 Males with",value:e=>e.i6_months_to_ls_5.M.length,tdClick:({column:e,data:t})=>d("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.i6_months_to_ls_5.M)},{label:"6 months to < 5",ref:"data.i6_months_to_ls_5.F.length",secondaryLabel:"6 months to < 5 Females with",value:e=>e.i6_months_to_ls_5.F.length,tdClick:({column:e,data:t})=>d("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.i6_months_to_ls_5.F)},{label:"5 to 14",ref:"data.i5_to_14.M.length",secondaryLabel:"5 to 14 Males with",value:e=>e.i5_to_14.M.length,tdClick:({column:e,data:t})=>d("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.i5_to_14.M)},{label:"5 to 14",ref:"data.i5_to_14.F.length",secondaryLabel:"5 to 14 Females with",value:e=>e.i5_to_14.F.length,tdClick:({column:e,data:t})=>d("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.i5_to_14.F)},{label:">14",ref:"data.gt_14.M.length",secondaryLabel:"Greater than 14 males with",value:e=>e.gt_14.M.length,tdClick:({column:e,data:t})=>d("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.gt_14.M)},{label:">14",ref:"data.gt_14.F.length",secondaryLabel:"Greater than 14 females with",value:e=>e.gt_14.F.length,tdClick:({column:e,data:t})=>d("".concat(e.secondaryLabel," ").concat(t.diagnosis," "),t.gt_14.F)},{label:"Total by gender",ref:"data.total_by_gender.M.length",secondaryLabel:"Total by gender males",value:e=>e.total_by_gender.M.length,tdClick:({column:e,data:t})=>d("".concat(e.secondaryLabel," "),t.total_by_gender.M)},{label:"5 to 14",ref:"data.total_by_gender.F.length",secondaryLabel:"Total by gender females",value:e=>e.total_by_gender.F.length,tdClick:({column:e,data:t})=>d("".concat(e.secondaryLabel," "),t.total_by_gender.F)},{label:"Total",ref:"Total",value:e=>[...e.ls_6_months.M,...e.ls_6_months.F,...e.i6_months_to_ls_5.M,...e.i6_months_to_ls_5.F,...e.i6_months_to_ls_5.M,...e.i6_months_to_ls_5.F,...e.i6_months_to_ls_5.M,...e.i6_months_to_ls_5.F,...e.i5_to_14.M,...e.i5_to_14.F,...e.gt_14.M,...e.gt_14.F].length,tdClick:({column:e,data:t})=>{const p=[...t.ls_6_months.M,...t.ls_6_months.F,...t.i6_months_to_ls_5.M,...t.i6_months_to_ls_5.F,...t.i6_months_to_ls_5.M,...t.i6_months_to_ls_5.F,...t.i6_months_to_ls_5.M,...t.i6_months_to_ls_5.F,...t.i5_to_14.M,...t.i5_to_14.F,...t.gt_14.M,...t.gt_14.F];d("".concat(e.label," "),p)}}]],k=e=>{const t=[];for(const p of e){const m=C(p);t.push(m)}return t},C=e=>{const t={};for(const p in e)if(Object.prototype.hasOwnProperty.call(e,p)){let m=p.replace(/ /g,"_");const M=e[p];/^\d/.test(m)&&(m="i"+m),m=m.replace(/[<>&]/g,T=>{switch(T){case"<":return"ls";case">":return"gt";case"&":return"amp";default:return T}}),t[m]=typeof M=="object"&&!Array.isArray(M)?C(M):M}return t},d=async(e,t)=>{t.length<=0||(await N.create({component:Le,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e,subtitle:W,patientIdentifiers:t,onFinish:()=>N.getTop().then(p=>p&&N.dismiss())}})).present()},F=()=>we([{id:"start_date",helpText:"Start Date",type:J.TT_FULL_DATE,validation:e=>K.required(e),computedValue:e=>e.value},{id:"end_date",helpText:"End Date",type:J.TT_FULL_DATE,validation:e=>K.required(e),computedValue:e=>e.value}],(e,t)=>{Q.value=t.start_date,G.value=t.end_date,W.value="Period (".concat(z(Q.value)," to ").concat(z(G.value),")"),N.dismiss(),Z.value="".concat(z(Q.value)," to ").concat(z(G.value)),o()});return De(()=>!q.value.length&&F()),{columns:$,isLoading:ze,reportData:q,period:W,csvQuarter:Z,csvheaders:b,generate:o,configure:F}}});function Ge(o,b,$,k,C,d){const F=g("ion-loading"),e=g("v2Datatable"),t=g("ion-page");return f(),j(t,null,{default:h(()=>[_(F,{"is-open":o.isLoading,message:"Please wait..."},null,8,["is-open"]),_(e,{title:"Disaggregated Diagnosis Report",subtitle:o.period,columns:o.columns,columnData:o.reportData,rowsPerPage:25,onConfigure:o.configure,csvQuarter:o.csvQuarter,headers:o.csvheaders,onRefresh:()=>o.generate()},null,8,["subtitle","columns","columnData","onConfigure","csvQuarter","headers","onRefresh"])]),_:1})}const Ke=x(Qe,[["render",Ge]]);export{Ke as default};
