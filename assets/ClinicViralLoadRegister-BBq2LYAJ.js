import{d as w,r as d,cc as A,ar as C,t as S,u as V,v as N,w as P,x,y as g,cZ as m,ai as T,cN as $,a5 as B,aJ as F,d5 as j,d6 as I,aK as M}from"./index-C85Md6LK.js";import{v as H}from"./TableView-DuV9STC_.js";import{a as W,w as k,b as L}from"./v2utils-D1YZNy09.js";import"./Export-Cri1P0hz.js";import"./index-CBYRP2AJ.js";const z=w({__name:"ClinicViralLoadRegister",setup(E){const D=F("reports.png"),n=d(""),r=d([]),l=d("All"),u=d([]),s=new A,h=[[W(),{label:"Accession #",ref:"accession_number"},{label:"Status",ref:"order_status"},{label:"Order Date",ref:"date_ordered",toValue:e=>"".concat(m(e))},{label:"Result",ref:"result",toValue:e=>e?e.replace(/</g,"&lt;"):""},{label:"Date received",ref:"date_received",toValue:e=>{var t;return"".concat((t=m(e))!=null?t:"")}},{label:"Mode of Delivery",ref:"result_delivery_mode",toValue:e=>e=="test_results_delivered_to_site_electronically"?"Electronic":e=="test_results_delivered_to_site_manually"?"Manual":""},{label:"Test reason",ref:"test_reason"},{label:"TAT(Days)",ref:"tat",value:e=>e.date_received&&e.date_ordered?T.dateDiffInDays(e.date_received,e.date_ordered):""}]],i={All:()=>!0,"No results":e=>!e.result,"With Results":e=>e.result,Rejected:e=>e.order_status==="test-rejected",Drawn:e=>e.order_status==="drawn",Pending:e=>e.order_status==="pending",Started:e=>e.order_status==="started",Failed:e=>e.order_status==="failed","Not-done":e=>e.order_status==="not-done",Completed:e=>e.order_status==="completed","Targeted orders":e=>/target/i.test("".concat(e.test_reason)),"Targeted orders with results":e=>/target/i.test("".concat(e.test_reason))&&e.result},v=e=>i[e]?r.value.filter(t=>i[e](t)):[],y=C(()=>v(l.value)),R=async()=>{const e=a=>v(a).length||"0",t=[[{label:"Indicator",ref:"label"},{label:"Count",ref:"value"}]],c=[{label:"Total Orders",value:e("All")},{label:"Total Orders With Results",value:e("With Results")},{label:"Total Orders No Results",value:e("No results")},{label:"Total Orders Rejected",value:e("Rejected")},{label:"Total Targeted Orders",value:e("Targeted orders")},{label:"Total Targeted Orders With Results",value:e("Targeted orders with results")},{label:"Total Orders Drawn",value:e("Drawn")},{label:"Total Orders Pending",value:e("Pending")},{label:"Total Orders Started",value:e("Started")},{label:"Total Orders Failed",value:e("Failed")},{label:"Total Orders Not-done",value:e("Not-done")},{label:"Total Orders Completed",value:e("Completed")},{label:"Average TAT (days)",value:(()=>{let a=0;const O=r.value.reduce((b,o)=>o.date_received&&o.date_ordered?(++a,b+parseInt("".concat(T.dateDiffInDays(o.date_received,o.date_ordered)))):b,0);return Math.floor(O/a)})()}];L({title:"Register Summary",columns:t,columnData:c,subtitle:n.value,rowsPerPage:50})},_=()=>{u.value=[{text:"<b>High level view</b>",icon:j,color:"primary",action:()=>R()},{text:"<b>Report filter: <i>".concat(l.value,"</i></b>"),icon:I,color:"primary",action:async()=>{const e=await M("Select report filter","",Object.keys(i),[{name:"Cancel",slot:"start"},{name:"Select",slot:"end",role:"action"}]);l.value=(e==null?void 0:e.selection)||l.value,_()}}]},f=()=>k(async()=>{r.value=[],u.value=[],r.value=await s.getClinicElectronicAlerts(),_()}),p=()=>$({onFinish:(e,t,c,a)=>{a&&s.setOccupation(a),n.value="".concat(c),s.startDate=e,s.endDate=t,f()}});return S(()=>!r.value.length&&p()),(e,t)=>(V(),N(g(B),null,{default:P(()=>[x(H,{"default-sort-order":"asc","default-sorted-column":"arv_number","icon-url":g(D),subtitle:n.value,title:"Viral Load Register","report-prefix":"Clinic",columns:h,onConfigure:p,headerBadge:u.value,columnData:y.value,rowsPerPage:50,onRefresh:f},null,8,["icon-url","subtitle","headerBadge","columnData"])]),_:1}))}});export{z as default};
