import{g as D}from"./MultiFieldDateHelper-CfR-mt6e.js";import{d as f,H as T,ab as y,L as r,O as d,V as h,a$ as p,S as x,P as c}from"./index-BF3WrZAg.js";import{D as w}from"./BasicReportTemplate-CMHlfMRv.js";import{O as S}from"./opd_report_service-CledGsEf.js";import{a as g}from"./MOHReportHeader-E2KsEvdN.js";import{F as u}from"./dynamic-import-helper-Bsjrd6Ro.js";const _=f({data:()=>({fields:[],report:{},reportReady:!1,period:"",startDate:"",endDate:"",customFileName:"",drillDownCache:{}}),methods:{toDate(t){return T.toStandardHisDisplayFormat(t)},confirmPatient(t){return this.$router.push("/patients/confirm?person_id=".concat(t))},async exportToCustomPDF(t){const o=open("","","width:1024px, height:768px"),e=document.getElementById("report-content");e&&o&&(o.document.write("\n                    <html>\n                    <head>\n                        <title>".concat(t,'</title>\n                        <link rel="stylesheet" media="print" href="/assets/css/cohort.css" />\n                    </head>\n                    <body>\n                        ').concat(e.innerHTML,"\n                    </body>\n                    </html>\n                ")),setTimeout(()=>{o.print(),o.close()},3500))},async onDrillDown(t,o){if(y.isEmpty(o))return;const e=[[r.thTxt("First name"),r.thTxt("Last name"),r.thTxt("Gender"),r.thTxt("Age"),r.thTxt("Phone"),r.thTxt("Address"),r.thTxt("Action")]],i=async l=>await Promise.all(l.map(async a=>{const s=await c.findByID(a),n=new c(s);return[r.td(n.getGivenName()),r.td(n.getFamilyName()),r.td(n.getGender()),r.td(n.getAge()),r.td(n.getPhoneNumber()),r.td("".concat(n.getCurrentDistrict(),", ").concat(n.getCurrentVillage(),", ").concat(n.getClosestLandmark())),r.tdBtn("Select",async()=>{await d.dismiss({}),this.$router.push({path:"/patient/dashboard/".concat(a)})})]}));return this.drilldownData(t,e,o,i)},async drilldownAsyncRows(t,o,e){(await d.create({component:w,cssClass:"large-modal",componentProps:{title:t,columns:o,asyncRows:e,showFilters:!0,rowsPerPage:50,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>d.dismiss()}})).present()},async drilldownData(t,o,e,i){(await d.create({component:w,cssClass:"large-modal",componentProps:{title:t,columns:o,rows:e,rowParser:i,rowsPerPage:50,showFilters:!0,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>d.dismiss()}})).present()},getDefaultDrillDownTable(){const t=[[r.thTxt("ARV number"),r.thTxt("Gender"),r.thTxt("Birth Date"),r.thTxt("Actions")]];return{rowParser:e=>e.map(async i=>{const[l,a]=i;if(a in this.drillDownCache)return[l];const s=await c.findByID(a),n=new c(s),m=[l,r.td(n.getArvNumber()),r.td(n.getGender()),r.tdDate(n.getBirthdate().toString()),r.tdBtn("Show",async()=>{await d.dismiss({}),this.$router.push({path:"/patient/dashboard/".concat(a)})})];return this.drillDownCache[a]=m,m}),columns:t}},runTableDrill(t,o="Drilldown patients"){const{columns:e,rowParser:i}=this.getDefaultDrillDownTable();this.drilldownData(o,e,t,i)},drill(t,o="Drill table"){return t&&t.length>0?r.tdLink(t.length,()=>this.runTableDrill(t,o)):r.td(0)},getEpiweeksFields(){return[{id:"epiweek",helpText:"Select EPI week",type:u.TT_SELECT,validation:t=>h.required(t),options:async()=>(await g.getReportEpiWeeks()).map(e=>({label:e.name+" - ("+p(e.start).format("DD/MMM/YYYY")+" - "+p(e.end).format("DD/MMM/YYYY")+")",value:e.start,other:e}))}]},getMonthlyFields(){return[{id:"idsrmonth",helpText:"Select Month",type:u.TT_SELECT,validation:t=>h.required(t),options:async()=>(await g.getReportMonths()).map(e=>({label:e.name+" - ("+p(e.start).format("DD/MMM/YYYY")+" - "+p(e.end).format("DD/MMM/YYYY")+")",value:e.start,other:e}))}]},getDateDurationFields(t=!1,o=!1,e=5){const i="2001-01-01",l=x.getSessionDate();return[{id:"quarter",helpText:"Select Quarter",type:u.TT_SELECT,condition:()=>t,validation:a=>h.required(a),options:()=>{let s=S.getReportQuarters(e).map(n=>({label:n.name,value:n.start,other:n}));return o&&(s=[{label:"Set custom period",value:"custom_period",other:{}},...s]),s}},...D({id:"start_date",helpText:"Start",required:!0,condition:a=>a.quarter&&a.quarter.value==="custom_period"||!t,minDate:()=>i,maxDate:()=>l,estimation:{allowUnknown:!1},computeValue:a=>a}),...D({id:"end_date",helpText:"End",required:!0,condition:a=>a.quarter&&a.quarter.value==="custom_period"||!t,unload:(a,s,n,m)=>{s==="next"&&(this.endDate=m.end_date)},minDate:(a,s)=>s.start_date,maxDate:()=>l,estimation:{allowUnknown:!1},computeValue:a=>a})]}}});export{_};
