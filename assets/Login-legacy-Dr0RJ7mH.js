System.register(["./index-legacy-Lddj3iK3.js","./main-legacy-ni36BnsZ.js"],(function(e,t){"use strict";var a,o,s,n,i,r,l,d,u,c,p,f,h,g,w,m,y,b,k,v,I,x,_,C,P,T,S,B,O,$,V,z,L,N,A,D,U,E,F,R,j,q,H,M,Q,K,W,Y,G,X,J,Z,ee,te,ae,oe,se,ne,ie,re,le,de,ue,ce,pe,fe;return{setters:[e=>{a=e.d,o=e.r,s=e.t,n=e.aw,i=e.ax,r=e.u,l=e.v,d=e.w,u=e.x,c=e.y,p=e.z,f=e.B,h=e.C,g=e.E,w=e.Q,m=e.R,y=e.S,b=e.ay,k=e.U,v=e.a0,I=e.W,x=e.a1,_=e.G,C=e.Z,P=e.H,T=e.a5,S=e.a2,B=e.a3,O=e.az,$=e.aA,V=e.aB,z=e.aC,L=e.aD,N=e.aE,A=e.ar,D=e.aF,U=e.aq,E=e.aG,F=e.aH,R=e.a9,j=e.O,q=e.aa,H=e.aI,M=e.aJ,Q=e.ah,K=e.a6,W=e.ab,Y=e.aK,G=e.aL,X=e.aM,J=e.a4,Z=e.X,ee=e.Y,te=e.aN,ae=e.ap,oe=e.aO,se=e.aP,ne=e.aQ,ie=e.at,re=e.aR,le=e.aS,de=e.aT,ue=e.aU,ce=e.aV,pe=e.aW},e=>{fe=e.p}],execute:function(){var t=document.createElement("style");t.textContent=".input-boxes[data-v-3d7ae8f6]{height:70px;border:1px solid #ccc;border-radius:5px;width:50%;font-family:Nimbus Sans L,Arial Narrow,sans-serif;font-size:2.2em;background-color:#dcdcdc;color:#000;padding:8px}.main[data-v-3d7ae8f6]{width:100%;text-align:center;margin-top:5%;display:table}.keyboard[data-v-3d7ae8f6]{z-index:100;text-align:center;position:absolute;background-color:#fff;width:100%;border:1px solid rgb(204,204,204);word-wrap:normal!important;margin:0 auto;max-width:300px;left:0;right:0}.rows[data-v-3d7ae8f6]{display:table-row;line-height:1px}.cells[data-v-3d7ae8f6]{display:table-cell}.keyboard-btn[data-v-3d7ae8f6]{border:1px solid #7eb9d0;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:5px!important;font-size:1.6vw!important;font-family:arial,helvetica,sans-serif;text-decoration:none;display:inline-block;text-shadow:-1px -1px 0 rgba(0,0,0,.3);font-weight:700;color:#fff;background-color:#a7cfdf;background-image:-webkit-gradient(linear,left top,left bottom,from(#a7cfdf),to(#23538a));background-image:-webkit-linear-gradient(top,#a7cfdf,#23538a);background-image:-moz-linear-gradient(top,#a7cfdf,#23538a);background-image:-ms-linear-gradient(top,#a7cfdf,#23538a);background-image:-o-linear-gradient(top,#a7cfdf,#23538a);background-image:linear-gradient(to bottom,#a7cfdf,#23538a);filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=#a7cfdf,endColorstr=#23538a);max-width:85px;max-height:85px;cursor:pointer;text-align:center;margin:3px;width:8vw;height:8vh;overflow:hidden;white-space:nowrap}@media screen and (max-width: 600px){.keyboard-btn[data-v-3d7ae8f6]{font-size:10px!important}}@media screen and (min-width: 1020px){.keyboard-btn[data-v-3d7ae8f6]{font-size:25px!important}}.login-btn[data-v-3d7ae8f6]{background-image:-webkit-gradient(linear,left top,left bottom,from(green),to green);background-image:-webkit-linear-gradient(top,green,green);background-image:-moz-linear-gradient(top,green,green);background-image:-ms-linear-gradient(top,green,green);background-image:-o-linear-gradient(top,green,green);background-image:linear-gradient(to bottom,green,green);filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=green,endColorstr=green)}.input-rows[data-v-3d7ae8f6]{line-height:140px}#coat[data-v-09ea2fc8]{width:8vw;height:8vw}#pepfar[data-v-09ea2fc8]{width:6vw;height:6vw}.devices[data-v-09ea2fc8]{background-color:var(--ion-color-primary);color:#fff;border:1px solid lightblue;font-size:1.3em;padding:1rem;margin-right:.5rem}.devices>option[data-v-09ea2fc8]{background:#fff;color:#000}\n/*$vite$:1*/",document.head.appendChild(t);const he={key:0},ge={key:1},we=a({__name:"OfflineSync",props:{onFinish:Object},setup(e){const t=e,a=o({});return s((()=>{n().then((e=>{Object.keys(e).forEach((async t=>{a.value[t]=!1,e[t].then((e=>a.value[t]=e))}))}))})),i(a,(e=>{e&&Object.keys(e).every((t=>e[t]))&&t.onFinish&&t.onFinish()}),{deep:!0}),(e,t)=>(r(),l(c(T),null,{default:d((()=>[u(c(w),null,{default:d((()=>[u(c(m),null,{default:d((()=>[u(c(y),null,{default:d((()=>t[0]||(t[0]=[p("Please wait.......")]))),_:1}),u(c(b),{type:"indeterminate"})])),_:1})])),_:1}),u(c(k),null,{default:d((()=>[u(c(v),null,{default:d((()=>[(r(!0),f(g,null,h(a.value,((e,t)=>(r(),l(c(I),{key:t,class:"his-md-text"},{default:d((()=>[u(c(x),null,{default:d((()=>[_("b",null,C(t),1)])),_:2},1024),u(c(x),null,{default:d((()=>[e?P("",!0):(r(),f("i",he,"Downloading...")),e?(r(),f("i",ge,"Done")):P("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}))}}),me=a({components:{IonInput:S,IonButton:B,IonIcon:O},props:{useVirtualInput:{type:Boolean}},data:function(){return{eye:$,eyeOff:V,passwordTimeout:null,showPasswordButtonTimeout:null,showPassword:!1,showPasswordButton:!1,keyboard:z,auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new L,N.clearScreenTimeout()},setup(){const{facility:e}=A();return{facility:e}},methods:{async syncOffline(){await D()&&(await U.create({component:we,backdropDismiss:!1,componentProps:{onFinish:()=>U.dismiss()}})).present()},onShowPassword(){this.showPassword=!0,this.showPasswordButton=!0,this.passwordTimeout&&clearTimeout(this.passwordTimeout),this.passwordTimeout=setTimeout((()=>this.showPassword=!1),1e4)},renderKeyBoard(e){this.focusInput=e.currentTarget,"password"==this.focusInput.id?this.btnCaption="Login":this.btnCaption="Next";let t=e.currentTarget.getBoundingClientRect().top;t=parseInt(t),this.keyboardTop=t+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(e){const t=e.currentTarget.id;let a;try{t.match(/@#/i)?this.keyboard=E:t.match(/qwerty/i)?this.keyboard=z:t.match(/Del/i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):t.match(/Next/i)?(this.display="none",a=this.$refs.password,a.$el.click()):t.match(/Login/i)?(this.display="none",this.doLogin()):t.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",a="username"===this.focusInput.id?this.$refs.username:this.$refs.password,a.click()):t.match(/Hide/i)?this.display="none":this.focusInput.value+=t,"username"==this.focusInput.id?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(o){console.warn("input error")}},doLogin:async function(){if(this.showPasswordButtonTimeout&&clearTimeout(this.showPasswordButtonTimeout),this.showPasswordButton=!1,this.showPassword=!1,this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!(await this.auth.checkTimeIntegrity()))throw"Local date does not match API date. Please Update your device's date";await this.auth.login(this.userInput.password),this.auth.startSession();const e=await Promise.all([this.auth.passwordPolicyEnabled(),this.auth.passwordExpired()]),t=(()=>{let e=0;return e+=fe(this.userInput.password).score,/^(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])/i.test(this.userInput.password)&&(e+=2),e<3})();if(t||e.every(Boolean)){const e=e=>`${e.value}`.toLowerCase();return F([{id:"new_password",proxyID:"password",helpText:"Change your password",type:R.TT_PASSWORD,init:()=>(setTimeout((()=>{t?j("Your password is weak, please change it below"):j("Your password has expired, please change it below",6e3)}),500),!0),computedValue:t=>e(t),validation:t=>q.validateSeries([()=>q.required(t),()=>q.hasLengthRangeOf(t,4,15),()=>{if(`${this.userInput.password}`.toLowerCase()===e(t))return["New password should not match old password"]}]),config:{inputType:"password"}},{id:"verify_password",proxyID:"password",helpText:"Confirm Password",type:R.TT_PASSWORD,computedValue:t=>e(t),validation:(t,a)=>q.validateSeries([()=>q.required(t),()=>{if(e(a.verify_password)!=e(a.new_password))return["New password does not match current password"]}]),config:{inputType:"password"}}],(async(e,t)=>{await H.updateUser(this.auth.userID,t)?(await this.auth.resetUserPasswordChangeCheck(),this.$router.push("/select_hc_location")):j("Unable to update user")}))}await this.syncOffline(),this.$router.push("/select_hc_location")}catch(e){e instanceof M?(j("Invalid username or password"),this.showPasswordButton=!0,this.showPasswordButtonTimeout=setTimeout((()=>this.showPasswordButton=!1),3e4)):Q(`${e}`,5e4)}}else j("Complete form to log in")}},computed:{btnStyles(){return`display: ${this.display}; top: ${this.keyboardTop};`}}}),ye={class:"main",ref:"main"},be={class:"cells ion-padding-bottom"},ke={key:0},ve={style:{color:"#cd853f"}},Ie={class:"rows"},xe={class:"cells"},_e=["readonly"],Ce={class:"rows input-rows"},Pe={class:"cells"},Te={class:"rows"},Se=["id"],Be=["id"],Oe=a({components:{IonIcon:O,IonItem:I,Inputs:K(me,[["render",function(e,t,a,o,s,n){const i=W("ion-text"),c=W("ion-icon"),w=W("ion-button"),m=W("ion-input");return r(),f(g,null,[_("div",ye,[_("div",be,[e.facility?(r(),f("h3",ke,[t[7]||(t[7]=_("b",{style:{color:"#8b4513"}},"Facility: ",-1)),_("b",ve,C(e.facility.name)+" ("+C(e.facility.district)+")",1)])):(r(),l(i,{key:1,color:"danger"},{default:d((()=>t[8]||(t[8]=[p("Facility Configuration is not set")]))),_:1}))]),_("div",Ie,[_("div",xe,[Y(_("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":t[0]||(t[0]=t=>e.userInput.username=t),onClick:t[1]||(t[1]=t=>e.renderKeyBoard(t)),class:"input-boxes ion-padding",readonly:e.useVirtualInput},null,8,_e),[[G,e.userInput.username]])])]),_("div",Ce,[_("div",Pe,[u(m,{style:{margin:"0px auto","margin-top":"15px","text-align":"left"},modelValue:e.userInput.password,"onUpdate:modelValue":t[3]||(t[3]=t=>e.userInput.password=t),type:e.showPassword?"text":"password",name:"password",ref:"password",id:"password",onClick:t[4]||(t[4]=t=>e.renderKeyBoard(t)),class:"input-boxes ion-padding",placeholder:"Password",readonly:e.useVirtualInput},{default:d((()=>[!e.showPassword&&e.showPasswordButton?(r(),l(w,{key:0,onClick:e.onShowPassword,color:"light",size:"large",slot:"end"},{default:d((()=>[u(c,{size:"large",icon:e.eye},null,8,["icon"])])),_:1},8,["onClick"])):P("",!0),e.showPassword&&e.showPasswordButton?(r(),l(w,{key:1,onClick:t[2]||(t[2]=t=>e.showPassword=!1),color:"light",size:"large",slot:"end"},{default:d((()=>[u(c,{size:"large",icon:e.eyeOff},null,8,["icon"])])),_:1})):P("",!0)])),_:1},8,["modelValue","type","readonly"])])])],512),_("div",{id:"keyboard",style:X(e.btnStyles),class:"keyboard"},[(r(!0),f(g,null,h(e.keyboard,((a,o)=>(r(),f("span",{key:o},[_("div",Te,[(r(!0),f(g,null,h(a,(a=>(r(),f("div",{class:"cells",key:a},["Next"===a||"Login"===a?(r(),f("button",{key:0,id:e.btnCaption,class:"keyboard-btn login-btn",onClick:t[5]||(t[5]=t=>e.keyPress(t))},C(e.btnCaption),9,Se)):P("",!0),"Login"!=a&&"Next"!=a?(r(),f("button",{key:1,id:e.Caps.on?a.toUpperCase():a.toLowerCase(),class:"keyboard-btn",onClick:t[6]||(t[6]=t=>e.keyPress(t))},C("Del."===a||"Caps"===a?a:e.Caps.on?a.toUpperCase():a.toLowerCase()),9,Be)):P("",!0)])))),128))])])))),128))],4)],64)}],["__scopeId","data-v-3d7ae8f6"]]),IonButton:B,IonTitle:y,IonLabel:x,IonPage:T,IonHeader:w,IonToolbar:m,IonContent:k,IonFooter:J,IonSelect:Z,IonSelectOption:ee},setup(){const e=o([]),{activePlatformProfile:t,platformProfiles:a}=te(),n=o(""),r=o(""),l=ae((()=>t.value.keyboard===pe.HIS_KEYBOARD_ONLY)),d=Object.keys(a.value).map((e=>({label:e,value:{profileName:e,...a.value[e]}})));return i(r,(e=>{t.value=(ce.find(d,{label:e})||{}).value})),s((async()=>{const a=new L;e.value=(await a.loadConfig())?.otherApps||[];const o=a.getHeadVersion();a.setActiveVersion(o);const s=await a.getApiVersion();n.value=`${o} / ${s}`,r.value=t.value?.profileName||""})),{showNetworkQr:oe,qrCode:se,version:n,profile:r,otherApps:e,deviceProfiles:d,useVirtualInputOnly:l,activePlatformProfile:t,coatImg:ne("login-logos/Malawi-Coat_of_arms_of_arms.png"),pepfarImg:ne("login-logos/PEPFAR.png"),showConfig:"true"===localStorage.getItem("useLocalStorage"),openSelect:async()=>{const t=await ue("Application Selection","Please specify the application you wish to use",e.value.map((e=>e.name)),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(t.selection&&"Cancel"!=t.action){const a=e.value.find((e=>e.name===t.selection));window.open(`${a.protocol||"http"}://${a.IP}:${a.port||80}`,"_blank")}},showQrNetworkScanner:ie,settingsOutline:re,pin:le,albums:de}}}),$e={slot:"start"},Ve=["src"],ze=["src"];e("default",K(Oe,[["render",function(e,t,a,o,s,n){const i=W("ion-label"),c=W("ion-title"),w=W("ion-toolbar"),m=W("ion-header"),y=W("inputs"),b=W("ion-content"),k=W("ion-button"),v=W("ion-icon"),I=W("ion-item"),x=W("ion-popover"),T=W("ion-list"),S=W("ion-footer"),B=W("ion-page");return r(),l(B,null,{default:d((()=>[u(m,null,{default:d((()=>[u(w,null,{default:d((()=>[u(c,null,{default:d((()=>[u(i,{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:d((()=>t[1]||(t[1]=[_("b",{style:{color:"#8b4513"}},"National ",-1),_("b",{style:{color:"#cd853f"}},"EMR",-1)]))),_:1})])),_:1}),u(i,{class:"ion-padding",slot:"end"},{default:d((()=>[t[2]||(t[2]=p(" Version: ")),_("b",null,C(e.version),1)])),_:1})])),_:1})])),_:1}),u(b,{fullscreen:!1,style:{width:"100%"}},{default:d((()=>[u(y,{useVirtualInput:e.useVirtualInputOnly},null,8,["useVirtualInput"])])),_:1}),u(S,null,{default:d((()=>[u(w,null,{default:d((()=>[_("span",$e,[_("img",{id:"coat",src:e.coatImg,alt:"Malawi Coat of Arms logo"},null,8,Ve),_("img",{id:"pepfar",src:e.pepfarImg,alt:"PEPFAR logo"},null,8,ze)]),u(k,{color:"dark",fill:"outline",size:"large",slot:"end",id:"configuration"},{default:d((()=>t[3]||(t[3]=[p(" Configuration ")]))),_:1}),e.otherApps.length?(r(),l(k,{key:0,color:"dark",fill:"outline",size:"large",slot:"end",onClick:e.openSelect},{default:d((()=>t[4]||(t[4]=[p(" Other Applications ")]))),_:1},8,["onClick"])):P("",!0),u(x,{trigger:"configuration","dismiss-on-select":""},{default:d((()=>[u(b,null,{default:d((()=>[u(T,null,{default:d((()=>[u(I,{button:"","router-link":"/settings/host",class:"his-sm-text"},{default:d((()=>[u(v,{icon:e.settingsOutline,slot:"start"},null,8,["icon"]),u(i,null,{default:d((()=>t[5]||(t[5]=[p("Network Settings")]))),_:1})])),_:1}),u(I,{button:"","router-link":"/location/update/site",class:"his-sm-text"},{default:d((()=>[u(v,{icon:e.pin,slot:"start"},null,8,["icon"]),u(i,null,{default:d((()=>t[6]||(t[6]=[p("Facility Settings")]))),_:1})])),_:1}),u(I,{button:"",onClick:t[0]||(t[0]=()=>e.showQrNetworkScanner((()=>e.$router.back()))),class:"his-sm-text"},{default:d((()=>[u(v,{icon:e.qrCode,slot:"start"},null,8,["icon"]),u(i,null,{default:d((()=>t[7]||(t[7]=[p("Scan Settings")]))),_:1})])),_:1}),u(I,{button:"",onClick:e.showNetworkQr,class:"his-sm-text"},{default:d((()=>[u(v,{icon:e.qrCode,slot:"start"},null,8,["icon"]),u(i,null,{default:d((()=>t[8]||(t[8]=[p("Share Settings")]))),_:1})])),_:1},8,["onClick"]),u(I,{button:"",detail:"",id:"devices",class:"his-sm-text"},{default:d((()=>[u(v,{icon:e.albums,slot:"start"},null,8,["icon"]),u(i,null,{default:d((()=>t[9]||(t[9]=[p("Device Profile")]))),_:1})])),_:1}),u(x,{trigger:"devices","dismiss-on-select":"",side:"end"},{default:d((()=>[(r(!0),f(g,null,h(e.deviceProfiles,(t=>(r(),l(I,{key:t.label,color:t.label===e.profile?"primary":"light",button:"",onClick:()=>e.profile=t.label},{default:d((()=>[u(i,null,{default:d((()=>[p(C(t.label),1)])),_:2},1024)])),_:2},1032,["color","onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-09ea2fc8"]]))}}}));
