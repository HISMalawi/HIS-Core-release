import{d as N,a2 as K,a3 as O,au as M,av as W,aw as Y,ax as B,ay as E,az as q,aA as G,aB as j,a9 as L,O as _,aa as b,aC as Q,aD as J,ah as X,aE as Z,a6 as D,ab as d,u as p,B as w,G as l,Z as g,aF as x,aG as ee,x as u,w as i,v as P,H as C,E as T,C as $,aH as se,W as oe,S as te,a1 as ae,a5 as ne,Q as ie,R as le,U as re,a4 as ue,X as de,Y as pe,r as S,aI as ce,ap as he,aJ as fe,t as we,aK as A,aL as me,aM as ye,aN as ge,z as v}from"./index-5HNeqEZr.js";import{p as Ie}from"./main-CzCw0cnl.js";const _e=N({components:{IonInput:K,IonButton:O,IonIcon:M},props:{useVirtualInput:{type:Boolean}},data:function(){return{eye:W,eyeOff:Y,passwordTimeout:null,showPasswordButtonTimeout:null,showPassword:!1,showPasswordButton:!1,keyboard:B,auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new E,q.clearScreenTimeout()},setup(){const{facilityName:e,district:s}=Z();return{facilityName:e,district:s}},methods:{onShowPassword(){this.showPassword=!0,this.showPasswordButton=!0,this.passwordTimeout&&clearTimeout(this.passwordTimeout),this.passwordTimeout=setTimeout(()=>this.showPassword=!1,1e4)},renderKeyBoard(e){this.focusInput=e.currentTarget,this.focusInput.id=="password"?this.btnCaption="Login":this.btnCaption="Next";let s=e.currentTarget.getBoundingClientRect().top;s=parseInt(s),this.keyboardTop=s+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(e){const s=e.currentTarget.id;let o;try{s.match(/@#/i)?this.keyboard=G:s.match(/qwerty/i)?this.keyboard=B:s.match(/Del/i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):s.match(/Next/i)?(this.display="none",o=this.$refs.password,o.$el.click()):s.match(/Login/i)?(this.display="none",this.doLogin()):s.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",this.focusInput.id==="username"?o=this.$refs.username:o=this.$refs.password,o.click()):s.match(/Hide/i)?this.display="none":this.focusInput.value+=s,this.focusInput.id=="username"?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(a){console.warn("input error")}},doLogin:async function(){if(this.showPasswordButtonTimeout&&clearTimeout(this.showPasswordButtonTimeout),this.showPasswordButton=!1,this.showPassword=!1,this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!await this.auth.checkTimeIntegrity())throw"Local date does not match API date. Please Update your device's date";await this.auth.login(this.userInput.password),this.auth.startSession();const e=await Promise.all([this.auth.passwordPolicyEnabled(),this.auth.passwordExpired()]),s=(()=>{let o=0;const a=Ie(this.userInput.password);return o+=a.score,/^(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])/i.test(this.userInput.password)&&(o+=2),o<3})();if(s||e.every(Boolean)){const o=a=>"".concat(a.value).toLowerCase();return j([{id:"new_password",proxyID:"password",helpText:"Change your password",type:L.TT_PASSWORD,init:()=>(setTimeout(()=>{s?_("Your password is weak, please change it below"):_("Your password has expired, please change it below",6e3)},500),!0),computedValue:a=>o(a),validation:a=>b.validateSeries([()=>b.required(a),()=>b.hasLengthRangeOf(a,4,15),()=>{if("".concat(this.userInput.password).toLowerCase()===o(a))return["New password should not match old password"]}]),config:{inputType:"password"}},{id:"verify_password",proxyID:"password",helpText:"Confirm Password",type:L.TT_PASSWORD,computedValue:a=>o(a),validation:(a,c)=>b.validateSeries([()=>b.required(a),()=>{if(o(c.verify_password)!=o(c.new_password))return["New password does not match current password"]}]),config:{inputType:"password"}}],async(a,c)=>{await Q.updateUser(this.auth.userID,c)?(await this.auth.resetUserPasswordChangeCheck(),this.$router.push("/select_hc_location")):_("Unable to update user")})}this.$router.push("/select_hc_location")}catch(e){e instanceof J?(_("Invalid username or password"),this.showPasswordButton=!0,this.showPasswordButtonTimeout=setTimeout(()=>this.showPasswordButton=!1,3e4)):X("".concat(e),5e4)}}else _("Complete form to log in")}},computed:{btnStyles(){return"display: ".concat(this.display,"; top: ").concat(this.keyboardTop,";")}}}),be={class:"main",ref:"main"},ve={class:"cells ion-padding-bottom"},Ce={style:{color:"#cd853f"}},Pe={class:"rows"},ke={class:"cells"},Te=["readonly"],Se={class:"rows input-rows"},$e={class:"cells"},Ve={class:"rows"},Be=["id"],Le=["id"];function Ae(e,s,o,a,c,I){const h=d("ion-icon"),m=d("ion-button"),n=d("ion-input");return p(),w(T,null,[l("div",be,[l("div",ve,[l("h3",null,[s[7]||(s[7]=l("b",{style:{color:"#8b4513"}},"Facility: ",-1)),l("b",Ce,g(e.facilityName)+" ("+g(e.district)+")",1)])]),l("div",Pe,[l("div",ke,[x(l("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":s[0]||(s[0]=t=>e.userInput.username=t),onClick:s[1]||(s[1]=t=>e.renderKeyBoard(t)),class:"input-boxes ion-padding",readonly:e.useVirtualInput},null,8,Te),[[ee,e.userInput.username]])])]),l("div",Se,[l("div",$e,[u(n,{style:{margin:"0px auto","margin-top":"15px","text-align":"left"},modelValue:e.userInput.password,"onUpdate:modelValue":s[3]||(s[3]=t=>e.userInput.password=t),type:e.showPassword?"text":"password",name:"password",ref:"password",id:"password",onClick:s[4]||(s[4]=t=>e.renderKeyBoard(t)),class:"input-boxes ion-padding",placeholder:"Password",readonly:e.useVirtualInput},{default:i(()=>[!e.showPassword&&e.showPasswordButton?(p(),P(m,{key:0,onClick:e.onShowPassword,color:"light",size:"large",slot:"end"},{default:i(()=>[u(h,{size:"large",icon:e.eye},null,8,["icon"])]),_:1},8,["onClick"])):C("",!0),e.showPassword&&e.showPasswordButton?(p(),P(m,{key:1,onClick:s[2]||(s[2]=t=>e.showPassword=!1),color:"light",size:"large",slot:"end"},{default:i(()=>[u(h,{size:"large",icon:e.eyeOff},null,8,["icon"])]),_:1})):C("",!0)]),_:1},8,["modelValue","type","readonly"])])])],512),l("div",{id:"keyboard",style:se(e.btnStyles),class:"keyboard"},[(p(!0),w(T,null,$(e.keyboard,(t,y)=>(p(),w("span",{key:y},[l("div",Ve,[(p(!0),w(T,null,$(t,r=>(p(),w("div",{class:"cells",key:r},[r==="Next"||r==="Login"?(p(),w("button",{key:0,id:e.btnCaption,class:"keyboard-btn login-btn",onClick:s[5]||(s[5]=f=>e.keyPress(f))},g(e.btnCaption),9,Be)):C("",!0),r!="Login"&&r!="Next"?(p(),w("button",{key:1,id:e.Caps.on?r.toUpperCase():r.toLowerCase(),class:"keyboard-btn",onClick:s[6]||(s[6]=f=>e.keyPress(f))},g(r==="Del."||r==="Caps"?r:e.Caps.on?r.toUpperCase():r.toLowerCase()),9,Le)):C("",!0)]))),128))])]))),128))],4)],64)}const Ne=D(_e,[["render",Ae],["__scopeId","data-v-5581b3d6"]]),Oe=N({components:{IonItem:oe,Inputs:Ne,IonButton:O,IonTitle:te,IonLabel:ae,IonPage:ne,IonHeader:ie,IonToolbar:le,IonContent:re,IonFooter:ue,IonSelect:de,IonSelectOption:pe},setup(){const e=S([]),s=async()=>{const n=await me("Application Selection","Please specify the application you wish to use",e.value.map(t=>t.name),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(n.selection&&n.action!="Cancel"){const t=e.value.find(y=>y.name===n.selection);window.open("".concat(t.protocol||"http","://").concat(t.IP,":").concat(t.port||80),"_blank")}},{activePlatformProfile:o,platformProfiles:a}=ce(),c=S(""),I=S(""),h=he(()=>o.value.keyboard===ge.HIS_KEYBOARD_ONLY),m=Object.keys(a.value).map(n=>({label:n,value:{profileName:n,...a.value[n]}}));return fe(I,n=>{o.value=(ye.find(m,{label:n})||{}).value}),we(async()=>{var r,f;const n=new E;e.value=((r=await n.loadConfig())==null?void 0:r.otherApps)||[];const t=n.getHeadVersion();n.setActiveVersion(t);const y=await n.getApiVersion();c.value="".concat(t," / ").concat(y),I.value=((f=o.value)==null?void 0:f.profileName)||""}),{version:c,profile:I,otherApps:e,deviceProfiles:m,useVirtualInputOnly:h,activePlatformProfile:o,coatImg:A("login-logos/Malawi-Coat_of_arms_of_arms.png"),pepfarImg:A("login-logos/PEPFAR.png"),showConfig:localStorage.getItem("useLocalStorage")==="true",openSelect:s}}}),Ee={slot:"start"},De=["src"],Ue=["src"];function Re(e,s,o,a,c,I){const h=d("ion-label"),m=d("ion-title"),n=d("ion-toolbar"),t=d("ion-header"),y=d("inputs"),r=d("ion-content"),f=d("ion-select-option"),U=d("ion-select"),V=d("ion-button"),R=d("ion-item"),z=d("ion-footer"),F=d("ion-page");return p(),P(F,null,{default:i(()=>[u(t,null,{default:i(()=>[u(n,null,{default:i(()=>[u(m,null,{default:i(()=>[u(h,{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:i(()=>s[1]||(s[1]=[l("b",{style:{color:"#8b4513"}},"National ",-1),l("b",{style:{color:"#cd853f"}},"EMR",-1)])),_:1})]),_:1}),u(h,{class:"ion-padding",slot:"end"},{default:i(()=>[s[2]||(s[2]=v(" Version: ")),l("b",null,g(e.version),1)]),_:1})]),_:1})]),_:1}),u(r,{fullscreen:!1,style:{width:"100%"}},{default:i(()=>[u(y,{useVirtualInput:e.useVirtualInputOnly},null,8,["useVirtualInput"])]),_:1}),u(z,null,{default:i(()=>[u(n,null,{default:i(()=>[l("span",Ee,[l("img",{id:"coat",src:e.coatImg,alt:"Malawi Coat of Arms logo"},null,8,De),l("img",{id:"pepfar",src:e.pepfarImg,alt:"PEPFAR logo"},null,8,Ue)]),u(R,{class:"his-sm-text",style:{width:"75%"},slot:"end"},{default:i(()=>[u(h,null,{default:i(()=>s[3]||(s[3]=[v("Device Profile")])),_:1}),u(U,{modelValue:e.profile,"onUpdate:modelValue":s[0]||(s[0]=k=>e.profile=k),value:e.profile},{default:i(()=>[(p(!0),w(T,null,$(e.deviceProfiles,(k,H)=>(p(),P(f,{key:H,value:k.label},{default:i(()=>[v(g(k.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","value"]),u(V,{color:"dark",fill:"outline",size:"large",slot:"end","router-link":"/settings/host"},{default:i(()=>s[4]||(s[4]=[v(" Network ")])),_:1}),e.otherApps.length?(p(),P(V,{key:0,color:"dark",fill:"outline",size:"large",slot:"end",onClick:e.openSelect},{default:i(()=>s[5]||(s[5]=[v(" Other Applications ")])),_:1},8,["onClick"])):C("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}const He=D(Oe,[["render",Re],["__scopeId","data-v-f474746d"]]);export{He as default};
