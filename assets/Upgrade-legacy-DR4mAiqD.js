System.register(["./index-legacy-D3AimR5c.js","./HelpdeskFlyer-legacy-DZX2heWw.js","./index-legacy-C8IfrPJu.js","./index-legacy-BaWv28zv.js"],(function(e,t){"use strict";var n,a,l,o,s,i,r,c,u,d,p,g,h,y,f,w,v,b,k,m,x,S,_,C,M,R,U,j;return{setters:[e=>{n=e.d,a=e.r,l=e.u,o=e.c,s=e.o,i=e.a,r=e.b,c=e.w,u=e.e,d=e.f,p=e.g,g=e.h,h=e.i,y=e.t,f=e.j,w=e.A,v=e.k,b=e.l,k=e.I,m=e.m,x=e.n,S=e.p,_=e.q,C=e.s},e=>{M=e.H},e=>{R=e.F,U=e.D},e=>{j=e.C}],execute:function(){const t={key:0,style:{"margin-top":"1%"},class:"ion-padding"},q={style:{"font-size":"2.5rem"},class:"ion-text-center"},D={class:"ion-text-center"},E={key:1,style:{"margin-top":"1%"},class:"ion-padding"},P={class:"ion-text-center"},$={style:{"margin-top":"10px"},class:"ion-text-center"};e("default",n({__name:"Upgrade",setup(e){const n=a(!1),z=l(),F=o((()=>`${z.query.version}`)),H=a("-"),L=o((()=>C("android"))),A=new w,B=a("");function I(){f.push("/"),setTimeout((()=>location.reload()),150)}async function K(){try{if(await async function(){try{const{publicStorage:e}=await R.checkPermissions();if("granted"!==e){const{publicStorage:e}=await R.requestPermissions();if("granted"!==e)return b("Permission to access storage is required to download the app."),!1}return!0}catch(e){return console.error(e),b("Unable to download the app. Please try again later"),!1}}()){n.value=!0,R.addListener("progress",(e=>{const t=Math.round(e.contentLength/1024),n=Math.round(e.bytes/1024),a=Math.round(e.bytes/e.contentLength*100);B.value=`Downloading... ${n}KB / ${t}KB (${a}%)`}));const e=await async function(){try{return(await R.downloadFile({url:await A.getApkDownloadLink(F.value),path:`Download/emr-${F.value}.apk`,directory:U.ExternalStorage,recursive:!0,progress:!0})).path}catch(e){console.error(e),b(e.toString())}}();if(n.value=!1,!e)throw new Error("Unable to download the app");v("Download completed. Installing the app..."),await async function(e){try{await j.install({file:e})}catch(t){console.error(t),b("Unable to install the app. Please try again later")}}(e)}}catch(e){n.value=!1,console.error(e),b("Unable to update the app")}}return s((()=>async function(){H.value=await(new w).getApiVersion()}())),(e,n)=>(i(),r(h(_),null,{default:c((()=>[u(h(k),null,{default:c((()=>[n[7]||(n[7]=d("div",{class:"ion-text-center ion-padding",style:{"font-weight":"bold","font-size":"2.0rem"}}," This EMR needs an update. ",-1)),n[8]||(n[8]=d("div",{class:"ion-text-center"}," Follow the steps below to update. ",-1)),L.value?(i(),p("div",t,[d("div",q,[d("div",null,[n[1]||(n[1]=d("h1",null,[d("b",null,"Step 1:"),g(" Click below to update EMR ")],-1)),u(h(m),{onClick:K,size:"large",color:"success"},{default:c((()=>n[0]||(n[0]=[g("Update EMR")]))),_:1})])]),d("div",D,[n[2]||(n[2]=d("h3",null,[d("b",null,"Step 2:"),g(" Contact Helpdesk if update is not possible "),d("b",null,"(Optional)")],-1)),u(M)])])):(i(),p("div",E,[d("div",P,[n[3]||(n[3]=d("h1",null,[d("b",null,"Step 1:"),g(" Contact the Helpdesk")],-1)),u(M),n[4]||(n[4]=d("p",null,null,-1)),n[5]||(n[5]=d("h2",null,[d("b",null,"Step 2:"),g(" Click Reload when an officer tells you to")],-1))])])),d("div",$,[u(h(m),{onClick:I,size:"large"},{default:c((()=>n[6]||(n[6]=[g("Reload")]))),_:1})])])),_:1}),u(h(x),null,{default:c((()=>[u(h(S),{class:"ion-text-center"},{default:c((()=>[n[9]||(n[9]=g(" Required version: ")),d("b",null,y(F.value)+"/"+y(H.value),1)])),_:1})])),_:1})])),_:1}))}}))}}}));
