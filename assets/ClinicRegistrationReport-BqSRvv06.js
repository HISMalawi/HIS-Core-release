import{O as u}from"./opd_report_service-sSYP80o_.js";import{R as c}from"./BaseTableReport-ctgX6onn.js";import{d as h,a5 as v,ao as i,ag as p,aj as f,e2 as g,a6 as _,ab as d,u as w,v as y,w as R,x as D}from"./index-CyYd6aWW.js";import{_ as B}from"./ReportMixin.vue_vue_type_script_lang-bNARcyGN.js";import"./HisStandardForm-CuX9K_Ib.js";const C=h({components:{ReportTemplate:c,IonPage:v},mixins:[B],data:()=>({title:"Clinic Registration",rows:[],reportData:[],columns:[[i.thTxt("Reg"),i.thTxt("First Name"),i.thTxt("Last Name"),i.thTxt("Gender"),i.thTxt("DOB"),i.thTxt("Date reg.")]],customBtns:[]}),created(){this.fields=this.getDateDurationFields(),this.customBtns.push({name:"High level view",size:"large",slot:"start",color:"primary",visible:!0,onClick:async()=>this.showModal()})},methods:{async init(t,e){const a=new u;a.setStartDate(e.start_date),a.setEndDate(e.end_date),this.period=a.getDateIntervalPeriod();const s=await a.getClinicRegistrations();this.reportData=s.sort((r,o)=>r.visit_type>o.visit_type?1:r.visit_type<o.visit_type?-1:0),this.rows=this.buildRows(this.reportData)},buildRows(t){return t.length?t.map(e=>[i.td(e.visit_type),i.td(e.given_name),i.td(e.family_name),i.td(e.gender),i.td(p.toStandardHisDisplayFormat(e.birthdate)),i.td(p.toStandardHisDisplayFormat(e.visit_date))]):[]},filterBy(t,e){return this.reportData.filter(a=>{const s=p.calculateAge(a.birthdate,f.getSessionDate());return a.visit_type===t&&(e==="under5"?s<=5:s>6)})},modalData(){const t=[...this.filterBy("New patient","under5")].length,e=[...this.filterBy("New patient","over5")].length,a=t+e,s=[...this.filterBy("Referral","under5")].length,r=[...this.filterBy("Referral","over5")].length,o=s+r,n=[...this.filterBy("Revisiting","under5")].length,l=[...this.filterBy("Revisiting","over5")].length,m=n+l;return[{label:"New patient",under5:t,over5:e,value:a},{label:"Referral",under5:s,over5:r,value:o},{label:"Revisiting",under5:n,over5:l,value:m}]},async showModal(){await g([...this.modalData()])}}});function b(t,e,a,s,r,o){const n=d("report-template"),l=d("ion-page");return w(),y(l,null,{default:R(()=>[D(n,{title:t.title,rows:t.rows,fields:t.fields,columns:t.columns,itemsPerPage:10,period:t.period,reportPrefix:"Clinic",onReportConfiguration:t.init,customBtns:t.customBtns,paginated:""},null,8,["title","rows","fields","columns","period","onReportConfiguration","customBtns"])]),_:1})}const $=_(C,[["render",b]]);export{$ as default};
