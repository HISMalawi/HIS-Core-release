import{H as d}from"./HisStandardForm-CxcKR3FF.js";import{_ as c}from"./EncounterMixin.vue_vue_type_script_lang-CFt8Lh3d.js";import{b2 as v,d as m,t as o,V as n,_ as p,r as h,o as b,c as f}from"./index-BPESSmpp.js";import{F as r}from"./dynamic-import-helper-Bsjrd6Ro.js";import{g as T}from"./LocationFieldOptions-CCEPt1U2.js";import{g as _,E as V}from"./MultiFieldDateHelper-9oePsxGD.js";import"./TouchScreenForm-BjDI66hA.js";import"./ToolbarMediumCard-DnRdVW_r.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-DixuDTZA.js";import"./encounter_guidelines-ilvUE8mV.js";import"./GuidelineEngine-D6V1_Znr.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";class s extends v{constructor(t,a){super(t,39,a)}}const S=m({components:{HisStandardForm:d},mixins:[c],data:()=>({hivService:{}}),watch:{ready:{async handler(e){e&&(this.hivService=new s(this.patient.getID(),this.providerID),this.fields=this.getFields())},immediate:!0,deep:!0}},methods:{async onSubmit(e,t){if(!await this.hivService.createEncounter())return o("Unable to create encounter");const i=await this.resolveObs({...t});if(!await this.hivService.saveObservationList(i))return o("Unable to save observations");this.nextTask()},buildDateObs(e,t,a){let i={};return t.match(/unknown/i)?i=this.hivService.buildValueText(e,"Unknown"):a?i=this.hivService.buildValueDateEstimated(e,t):i=this.hivService.buildValueDate(e,t),i},getFields(){return[{id:"hiv_status",helpText:"HIV status",type:r.TT_SELECT,validation:e=>n.required(e),computedValue:({value:e})=>({obs:this.hivService.buildValueText("HIV status",e)}),options:()=>[{label:"Positive not ART",value:"Positive not ART"},{label:"Posititve on ART",value:"Positive on ART"},{label:"Previous negative",value:"Previous negative"},{label:"New positive",value:"New positive"},{label:"New negative",value:"New negative"},{label:"Never tested",value:"Never tested"}]},..._({id:"hiv_test_date",helpText:"HIV Test",required:!0,minDate:()=>this.patient.getBirthdate(),maxDate:()=>s.getSessionDate(),condition:e=>e.hiv_status.value!=="Never tested",summaryLabel:"HIV test date",estimation:{allowUnknown:!0,estimationFieldType:V.MONTH_ESTIMATE_FIELD},computeValue:(e,t)=>this.buildDateObs("HIV test date",e,t)}),{id:"test_location",helpText:"HIV test location",type:r.TT_SELECT,validation:e=>n.required(e),defaultValue:()=>s.getLocationName(),computedValue:({label:e})=>({obs:this.hivService.buildValueText("HIV test location",e)}),condition:e=>e.hiv_status.value!=="Never tested",options:(e,t="")=>T(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}}]}}});function g(e,t,a,i,l,D){const u=h("his-standard-form");return b(),f(u,{cancelDestinationPath:e.cancelDestination,fields:e.fields,onFinishAction:e.onSubmit},null,8,["cancelDestinationPath","fields","onFinishAction"])}const C=p(S,[["render",g]]);export{C as default};
