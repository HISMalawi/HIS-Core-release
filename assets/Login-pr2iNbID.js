import{d as z,aC as g,k as K,ai as W,aD as Y,al as P,am as D,s as C,U as j,aE as q,y as Q,aF as G,aG as E,aH as J,A as M,aI as X,aJ as Z,aK as ss,ak as x,ap as B,h,b as p,g as r,t as I,aL as es,aM as ts,e as o,w as i,a as $,a6 as S,a9 as V,aa as A,aN as os,r as L,aO as as,c as ns,aP as is,aQ as ls,o as rs,f as e,a4 as us,m as U,a5 as ds,ah as w,j as m,I as R,l as ps,x as F,aR as cs,aS as H,ag as hs,a7 as k,aT as fs,aU as ws,aV as ms,aW as ys,n as gs,aX as Is,aY as bs}from"./index-y6JY22M4.js";import{p as vs}from"./main-Du4i2-ge.js";import{H as Ps}from"./HelpdeskFlyer-CFRiMzWS.js";const Cs=z({components:{IonInput:W,IonButton:K,IonIcon:g},props:{useVirtualInput:{type:Boolean}},data:function(){return{eye:ss,eyeOff:Z,passwordTimeout:null,showPasswordButtonTimeout:null,showPassword:!1,showPasswordButton:!1,keyboard:E,auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new M,X.clearScreenTimeout()},setup(){const{facilityName:s,district:t}=J();return{facilityName:s,district:t}},methods:{onShowPassword(){this.showPassword=!0,this.showPasswordButton=!0,this.passwordTimeout&&clearTimeout(this.passwordTimeout),this.passwordTimeout=setTimeout(()=>this.showPassword=!1,1e4)},renderKeyBoard(s){this.focusInput=s.currentTarget,this.focusInput.id=="password"?this.btnCaption="Login":this.btnCaption="Next";let t=s.currentTarget.getBoundingClientRect().top;t=parseInt(t),this.keyboardTop=t+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(s){const t=s.currentTarget.id;let u;try{t.match(/@#/i)?this.keyboard=G:t.match(/qwerty/i)?this.keyboard=E:t.match(/Del/i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):t.match(/Next/i)?(this.display="none",u=this.$refs.password,u.$el.click()):t.match(/Login/i)?(this.display="none",this.doLogin()):t.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",this.focusInput.id==="username"?u=this.$refs.username:u=this.$refs.password,u.click()):t.match(/Hide/i)?this.display="none":this.focusInput.value+=t,this.focusInput.id=="username"?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(l){console.warn("input error")}},doLogin:async function(){if(this.showPasswordButtonTimeout&&clearTimeout(this.showPasswordButtonTimeout),this.showPasswordButton=!1,this.showPassword=!1,this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!await this.auth.checkTimeIntegrity())throw"Local date does not match API date. Please Update your device's date";await this.auth.login(this.userInput.password),this.auth.startSession();const s=await Promise.all([this.auth.passwordPolicyEnabled(),this.auth.passwordExpired()]),t=(()=>{let u=0;const l=vs(this.userInput.password);return u+=l.score,/^(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])/i.test(this.userInput.password)&&(u+=2),u<3})();if(t||s.every(Boolean)){const u=l=>"".concat(l.value).toLowerCase();return Y([{id:"new_password",proxyID:"password",helpText:"Change your password",type:D.TT_PASSWORD,init:()=>(setTimeout(()=>{t?C("Your password is weak, please change it below"):C("Your password has expired, please change it below",6e3)},500),!0),computedValue:l=>u(l),validation:l=>P.validateSeries([()=>P.required(l),()=>P.hasLengthRangeOf(l,4,15),()=>{if("".concat(this.userInput.password).toLowerCase()===u(l))return["New password should not match old password"]}]),config:{inputType:"password"}},{id:"verify_password",proxyID:"password",helpText:"Confirm Password",type:D.TT_PASSWORD,computedValue:l=>u(l),validation:(l,f)=>P.validateSeries([()=>P.required(l),()=>{if(u(f.verify_password)!=u(f.new_password))return["New password does not match current password"]}]),config:{inputType:"password"}}],async(l,f)=>{await j.updateUser(this.auth.userID,f)?(await this.auth.resetUserPasswordChangeCheck(),this.$router.push("/select_hc_location")):C("Unable to update user")})}this.$router.push("/select_hc_location")}catch(s){s instanceof q?(C("Invalid username or password"),this.showPasswordButton=!0,this.showPasswordButtonTimeout=setTimeout(()=>this.showPasswordButton=!1,3e4)):Q("".concat(s),5e4)}}else C("Complete form to log in")}},computed:{btnStyles(){return"display: ".concat(this.display,"; top: ").concat(this.keyboardTop,";")}}}),ks={class:"main",ref:"main"},_s={class:"cells ion-padding-bottom"},Ts={style:{color:"#cd853f"}},Ss={class:"rows"},Vs={class:"cells"},$s=["readonly"],Bs={class:"rows input-rows"},Ls={class:"cells"},As={class:"rows"},Ns=["id"],Os=["id"];function Ds(s,t,u,l,f,_){const b=B("ion-icon"),v=B("ion-button"),y=B("ion-input");return p(),h(V,null,[r("div",ks,[r("div",_s,[r("h3",null,[t[7]||(t[7]=r("b",{style:{color:"#8b4513"}},"Facility: ",-1)),r("b",Ts,I(s.facilityName)+" ("+I(s.district)+")",1)])]),r("div",Ss,[r("div",Vs,[es(r("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":t[0]||(t[0]=d=>s.userInput.username=d),onClick:t[1]||(t[1]=d=>s.renderKeyBoard(d)),class:"input-boxes ion-padding",readonly:s.useVirtualInput},null,8,$s),[[ts,s.userInput.username]])])]),r("div",Bs,[r("div",Ls,[o(y,{style:{margin:"0px auto","margin-top":"15px","text-align":"left"},modelValue:s.userInput.password,"onUpdate:modelValue":t[3]||(t[3]=d=>s.userInput.password=d),type:s.showPassword?"text":"password",name:"password",ref:"password",id:"password",onClick:t[4]||(t[4]=d=>s.renderKeyBoard(d)),class:"input-boxes ion-padding",placeholder:"Password",readonly:s.useVirtualInput},{default:i(()=>[!s.showPassword&&s.showPasswordButton?(p(),$(v,{key:0,onClick:s.onShowPassword,color:"light",size:"large",slot:"end"},{default:i(()=>[o(b,{size:"large",icon:s.eye},null,8,["icon"])]),_:1},8,["onClick"])):S("",!0),s.showPassword&&s.showPasswordButton?(p(),$(v,{key:1,onClick:t[2]||(t[2]=d=>s.showPassword=!1),color:"light",size:"large",slot:"end"},{default:i(()=>[o(b,{size:"large",icon:s.eyeOff},null,8,["icon"])]),_:1})):S("",!0)]),_:1},8,["modelValue","type","readonly"])])])],512),r("div",{id:"keyboard",style:os(s.btnStyles),class:"keyboard"},[(p(!0),h(V,null,A(s.keyboard,(d,T)=>(p(),h("span",{key:T},[r("div",As,[(p(!0),h(V,null,A(d,a=>(p(),h("div",{class:"cells",key:a},[a==="Next"||a==="Login"?(p(),h("button",{key:0,id:s.btnCaption,class:"keyboard-btn login-btn",onClick:t[5]||(t[5]=n=>s.keyPress(n))},I(s.btnCaption),9,Ns)):S("",!0),a!="Login"&&a!="Next"?(p(),h("button",{key:1,id:s.Caps.on?a.toUpperCase():a.toLowerCase(),class:"keyboard-btn",onClick:t[6]||(t[6]=n=>s.keyPress(n))},I(a==="Del."||a==="Caps"?a:s.Caps.on?a.toUpperCase():a.toLowerCase()),9,Os)):S("",!0)]))),128))])]))),128))],4)],64)}const Es=x(Cs,[["render",Ds],["__scopeId","data-v-5581b3d6"]]),Us={slot:"start"},Rs=["src"],Fs=["src"],Hs=z({__name:"Login",setup(s){const t=F("login-logos/Malawi-Coat_of_arms_of_arms.png"),u=F("login-logos/PEPFAR.png"),l=L([]),f=async()=>{const a=await Is("Application Selection","Please specify the application you wish to use",l.value.map(n=>n.name),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(a.selection&&a.action!="Cancel"){const n=l.value.find(c=>c.name===a.selection);window.open("".concat(n.protocol||"http","://").concat(n.IP,":").concat(n.port||80),"_blank")}},{activePlatformProfile:_,platformProfiles:b}=as(),v=L(""),y=L(""),d=ns(()=>_.value.keyboard===is.HIS_KEYBOARD_ONLY),T=Object.keys(b.value).map(a=>({label:a,value:{profileName:a,...b.value[a]}}));return ls(y,a=>{_.value=(bs.find(T,{label:a})||{}).value}),rs(async()=>{var N,O;const a=new M;l.value=((N=await a.loadConfig())==null?void 0:N.otherApps)||[];const n=a.getHeadVersion();a.setActiveVersion(n);const c=await a.getApiVersion();v.value="".concat(n," / ").concat(c),y.value=((O=_.value)==null?void 0:O.profileName)||""}),(a,n)=>(p(),$(e(gs),null,{default:i(()=>[o(e(us),null,{default:i(()=>[o(e(U),null,{default:i(()=>[o(e(ds),null,{default:i(()=>[o(e(w),{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:i(()=>[...n[0]||(n[0]=[r("b",{style:{color:"#8b4513"}},"National ",-1),r("b",{style:{color:"#cd853f"}},"EMR",-1)])]),_:1})]),_:1}),o(e(w),{class:"ion-padding",slot:"end"},{default:i(()=>[n[1]||(n[1]=m(" Version: ",-1)),r("b",null,I(v.value),1)]),_:1})]),_:1})]),_:1}),o(e(R),{fullscreen:!1,style:{width:"100%"}},{default:i(()=>[o(Es,{useVirtualInput:d.value},null,8,["useVirtualInput"]),r("p",null,[o(Ps)])]),_:1}),o(e(ps),null,{default:i(()=>[o(e(U),null,{default:i(()=>[r("span",Us,[r("img",{id:"coat",src:e(t),alt:"Malawi Coat of Arms logo"},null,8,Rs),r("img",{id:"pepfar",src:e(u),alt:"PEPFAR logo"},null,8,Fs)]),o(e(K),{color:"dark",fill:"outline",size:"large",slot:"end",id:"configuration"},{default:i(()=>[o(e(g),{slot:"end",icon:e(cs)},null,8,["icon"]),n[2]||(n[2]=m(" Quick Actions ",-1))]),_:1}),o(e(H),{trigger:"configuration","dismiss-on-select":"",style:{"--width":"300px"}},{default:i(()=>[o(e(R),null,{default:i(()=>[o(e(hs),null,{default:i(()=>[o(e(k),{button:"","router-link":"/reset_password",class:"his-sm-text"},{default:i(()=>[o(e(g),{icon:e(fs),slot:"start"},null,8,["icon"]),o(e(w),null,{default:i(()=>[...n[3]||(n[3]=[m("Reset Password",-1)])]),_:1})]),_:1}),o(e(k),{button:"","router-link":"/settings/host",class:"his-sm-text"},{default:i(()=>[o(e(g),{icon:e(ws),slot:"start"},null,8,["icon"]),o(e(w),null,{default:i(()=>[...n[4]||(n[4]=[m("Network Settings",-1)])]),_:1})]),_:1}),o(e(k),{button:"",detail:"",id:"devices",class:"his-sm-text"},{default:i(()=>[o(e(g),{icon:e(ms),slot:"start"},null,8,["icon"]),o(e(w),null,{default:i(()=>[...n[5]||(n[5]=[m("Device Profile",-1)])]),_:1})]),_:1}),o(e(H),{trigger:"devices","dismiss-on-select":"",side:"end"},{default:i(()=>[(p(!0),h(V,null,A(e(T),c=>(p(),$(e(k),{key:c.label,color:c.label===y.value?"primary":"light",button:"",onClick:()=>y.value=c.label},{default:i(()=>[o(e(w),null,{default:i(()=>[m(I(c.label),1)]),_:2},1024)]),_:2},1032,["color","onClick"]))),128))]),_:1}),o(e(k),{button:"",onClick:f,class:"his-sm-text"},{default:i(()=>[o(e(g),{icon:e(ys),slot:"start"},null,8,["icon"]),o(e(w),null,{default:i(()=>[...n[6]||(n[6]=[m("Other Applications",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),xs=x(Hs,[["__scopeId","data-v-b23d751a"]]);export{xs as default};
