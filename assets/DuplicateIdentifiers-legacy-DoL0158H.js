System.register(["./TableReportTemplate-legacy-Duu1WlWk.js","./dynamic-import-helper-legacy-DYK5bIOV.js","./index-legacy-DzF0J2nr.js","./identifier_service-legacy-xVsf-kof.js","./DrillTableModal-legacy-B4L1LBLv.js","./Export-legacy-nGdXEsf9.js","./HisStandardForm-legacy-DHvPmsWP.js","./TouchScreenForm-legacy-CDzY5o9b.js","./ToolbarMediumCard-legacy-BDSK2XWR.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-BcrZm7RF.js","./ReportErrors-legacy-ChlvZs0b.js"],(function(e,t){"use strict";var i,s,n,r,a,l,o,d,c,p,u,m,y,g,h,f;return{setters:[e=>{i=e.R},e=>{s=e.F},e=>{n=e.d,r=e.L,a=e.s,l=e.V,o=e.H,d=e.O,c=e.P,p=e.q,u=e._,m=e.r,y=e.o,g=e.c},e=>{h=e.I},e=>{f=e.D},null,null,null,null,null,null,null],execute:function(){const t=n({components:{ReportTemplate:i},data:()=>({service:{},dde:{},title:"Duplicate Identifiers",fields:[],rows:[],columns:[[r.thTxt("Identifier"),r.thTxt("Count"),r.thTxt("View"),r.thTxt("Resolve")]]}),async created(){this.fields=this.getFormFields(),this.dde=new a,await this.dde.loadDDEStatus()},methods:{async onPeriod({identifier:e}){const t=parseInt(e.value.toString());this.title=e.label+" Duplicates",this.service=new h,this.service.setIdentifierType(t),this.rows=await this.getRows()},getFormFields:()=>[{id:"identifier",helpText:"Select Identifier type",type:s.TT_SELECT,validation:e=>l.required(e),options:async()=>(await h.getIdentifierTypes()).map((e=>({label:e.name,value:e.patient_identifier_type_id})))}],toDate:e=>o.toStandardHisDisplayFormat(e),async drillDuplicates(e){(await d.create({component:f,cssClass:"custom-modal",componentProps:{title:`Persons using identifier ${e}`,columns:["Given name","Family name","Gender","Birth date","Action"],onRows:async()=>(await this.service.getPatientsByIdentifier(e)).map((e=>{try{const t=new c(e);return[t.getGivenName(),t.getFamilyName(),t.getGender(),this.toDate(t.getBirthdate()),{type:"button",name:"View",action:()=>{d.dismiss().then((()=>{this.$router.push(`/patient/dashboard/${t.getID()}`)}))}}]}catch(t){return p("Unable to load patient details"),["N/A","N/A","N/A","N/A","N/A"]}}))}})).present()},async getRows(){return(await this.service.getDuplicateIndentifiers()).map((e=>[r.td(e.identifier),r.td(e.count),r.tdBtn("Select",(()=>this.drillDuplicates(e.identifier))),r.tdBtn("Resolve",(()=>{this.$router.push(`/npid/duplicates/${e.identifier}`)}),{event:{disabled:3!=this.service.getIdentifierType()}},"danger")]))}}});e("default",u(t,[["render",function(e,t,i,s,n,r){const a=m("report-template");return y(),g(a,{title:e.title,period:e.period,rows:e.rows,fields:e.fields,columns:e.columns,canExportCsv:!1,canExportPDf:!1,onReportConfiguration:e.onPeriod},null,8,["title","period","rows","fields","columns","onReportConfiguration"])}]]))}}}));
