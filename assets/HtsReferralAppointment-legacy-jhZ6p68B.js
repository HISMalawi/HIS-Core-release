System.register(["./index-legacy-B-IGLekl.js","./HisStandardForm-legacy-zrsmj5en.js"],(function(e,t){"use strict";var n,a,i,o,s,l,r,u,d,c,f,g,p,m,v,b,T,h;return{setters:[e=>{n=e.bQ,a=e.d,i=e.a5,o=e.r,s=e.ei,l=e.a9,r=e.bY,u=e.bn,d=e.bo,c=e.d8,f=e.bF,g=e.a6,p=e.v,m=e.w,v=e.ab,b=e.u,T=e.x},e=>{h=e.H}],execute:function(){class t extends n{constructor(e,t=-1){super(e,7,t)}nextAppointment(){return n.getJson(`/programs/${this.programID}/patients/${this.patientID}/next_appointment_date`,{date:this.date})}}const y=a({components:{IonPage:i,HisStandardForm:h},setup(){const e=o([]),n=new t(-1),a=o(!1),{visitID:i,htsClient:g,getEncounter:p,patientDashboardUrl:m,saveEncounter:v,toOption:b}=s({onInitVisit:()=>{e.value=[T(),{id:"referral_location",helpText:"Intended site for retesting",type:l.TT_SELECT,isRequired:()=>!0,finalComputedValue:({label:e})=>({obs:n.buildValueText("Referral location",e)}),defaultValue:()=>t.getLocationName(),condition:e=>"Not done"!=e.re_test.value,options:(e,t="")=>r(t),config:{footerBtns:[{name:"Here",slot:"end",onClickComponentEvents:{setValue:()=>t.getLocationName()},onClick:()=>null}],showKeyboard:!0,isFilterDataViaApi:!0}},h()]}});function T(){let e=null;return{id:"re_test",helpText:"Referral for Re-Testing",type:l.TT_TEXT_BANNER,init:async()=>{let n="",o="",s="";const l=new t(i.value),r=p("Testing");if(r?(n=r["HIV status"]||"N/A",o=r["client risk category"]||"N/A"):u().isOfflineMode.value||(o=await l.getFirstValueCoded("client risk category")||"N/A",n=await l.getFirstValueCoded("HIV Status")||"N/A"),"F"===g.gender){const e=p("PREGNANCY STATUS");e?s=e["Pregnancy status"]:u().isOfflineMode.value||(s=await l.getFirstValueCoded("Pregnancy status")||"N/A")}return/Negative/i.test(n)&&"BREASTFEEDING"===s?(a.value=!0,e={label:"Book a Re-Test for Female Breastfeeding Client",value:"Re-test"}):/Negative/i.test(n)&&"Pregnant woman"==s?(a.value=!0,e={label:"Book a Re-Test for Female Pregnant Client",value:"Re-test"}):e=/Positive Initial Professional/i.test(n)?{label:"Confirmatory test is needed for Positive result",value:"Confirmatory HIV test"}:/high risk|High risk event|on-going/i.test(`${o}`)?{label:`Retesting is required due to "${o}"`,value:"Re-test"}:{label:"No re-test required",value:"Not done"},!0},defaultValue:()=>(console.log(e.value),b(e.value)),condition:()=>null!=e,finalComputedValue:e=>({obs:n.buildValueCoded("Referral for Re-Testing",e.value)}),options:()=>[b(e.label)]}}function h(){let e="",t="";return{id:"set_appointment",helpText:"Select Appointment Date for Re-testing",type:l.TT_DATE_PICKER,init:async()=>{if(t=n.date,a.value)e=d(t).add(365,"day").format("YYYY-MM-DD");else try{t=function(){const e=p("Testing");if(!e)return n.date;const t={14:["Positive Initial Professional"===e["HIV status"],"Inconclusive"===e["HIV status"]],28:[/negative/i.test(e["HIV status"])&&/High risk event in last 3 months|not done/i.test(e["client risk category"])],365:[/negative/i.test(e["HIV status"])&&/On-going risk/i.test(e["client risk category"])]};return Object.keys(t).reduce(((e,a)=>!e&&t[a].some(Boolean)?d(n.date).add(a,"days").format(f):e),"")}(),e=d(t).add(15,"day").format("YYYY-MM-DD")}catch(i){}return!0},isRequired:()=>!0,condition:e=>e.referral_location.value,defaultValue:()=>t,finalComputedValue:e=>({obs:n.buildValueDate("Appointment date",`${e.value}`)}),config:{minDate:()=>t,maxDate:()=>e,infoItems:e=>[{label:"System set appointment",value:c(t)},{label:"User set appointment",value:c(e)}],hiddenFooterBtns:["Clear"]}}}return{patientDashboardUrl:m,onFinish:function(e,t){v({encounterName:"APPOINTMENT",encounterTypeID:n.encounterTypeID,computedData:t})},fields:e}}});e("default",g(y,[["render",function(e,t,n,a,i,o){const s=v("his-standard-form"),l=v("ion-page");return b(),p(l,null,{default:m((()=>[T(s,{formLabel:"Appointment",fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:e.patientDashboardUrl()},null,8,["fields","onFinishAction","cancelDestinationPath"])])),_:1})}]]))}}}));
