function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/MinimalToolbar-Dr6VdN75.js","assets/index-BFVcutZq.js","assets/index-C_lTp8f9.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{d as V,aq as de,ar as F,as as W,m as G,i as q,f as K,j as J,k as ce,ah as k,G as ke,af as ue,O as Q,t as H,n as De,_ as A,r as s,o as r,x as _,b as i,w as o,u as h,v as g,B as P,y as L,c as f,at as pe,g as X,l as ie,h as Y,q as he,A as m,au as $e,D as me,av as fe,aw as oe,ax as we,ay as _e,z as C,az as ne,K as ge,N as Te,aA as Pe,aB as Ee,aC as Le,I as Oe,aD as Ve,ae as Ae,aE as Se,aF as U,aG as Ne,aH as ze,aI as Me,aJ as Be,aK as He,aL as qe,aM as Ue,aN as je,aO as Re,aP as Fe,aQ as We,aR as Ge,aS as Ke,aT as S,aU as j,T as B,aV as z,$ as x,aW as Je,H as R,aX as ee,aY as Qe,a0 as te,P as Xe,aZ as Ye,a_ as Ze,a$ as xe,b0 as et,b1 as tt,b2 as nt,U as it,b3 as ot,b4 as at,b5 as st,b6 as lt,b7 as le,a8 as rt,a9 as dt}from"./index-BFVcutZq.js";import{D as ct}from"./drug_order_service-ColPpc1E.js";import{T as ut}from"./TaskCard-Cgy7YQVb.js";import{p as pt}from"./VoidReason-Dn4DqE0H.js";import ht from"./DashboardAppIcon-zjvo2ufh.js";const mt=V({components:{IonGrid:de,IonRow:F,IonCol:W,TaskCard:ut,IonFooter:G,IonToolbar:q,IonButton:K,IonHeader:J,IonTitle:ce},props:{title:{type:String,default:"Select Activity"},items:{type:Object,required:!0},taskParams:{type:Object,required:!1}},data:()=>({filteredItems:[]}),watch:{items:{async handler(e){if(!(!e||k.isEmpty(e)))for(const t in e){const n=e[t];n.globalProperty&&!await ke.isProp(n.globalProperty)||n.condition&&!await n.condition(this.taskParams)||this.filteredItems.push(n)}},deep:!0,immediate:!0}},methods:{img(e){return ue(e)},isDisabled(e){return typeof e=="function"?e(this.taskParams):!1},closeModal(){Q.dismiss({})},async doTask(e){var t,n;if(this.isDisabled(e.disabled))return H("This task is disabled");typeof e.taskCompleted=="boolean"&&(e!=null&&e.taskCompleted)&&!await De("This task was already completed. Do you want to continue?")||(e.action?e.action(this.taskParams,this.$router):e.url?this.$router.push({path:e.url}):e.patientUrl?this.$router.push("".concat(e.patientUrl,"/").concat((t=this.taskParams)==null?void 0:t.patientID)):this.$router.push({name:e.id,params:{patient_id:(n=this.taskParams)==null?void 0:n.patientID}}),this.closeModal())}}});function ft(e,t,n,a,p,y){const c=s("ion-title"),l=s("ion-toolbar"),d=s("ion-header"),b=s("task-card"),D=s("ion-col"),$=s("ion-row"),v=s("ion-grid"),w=s("ion-button"),T=s("ion-footer");return r(),_(P,null,[i(d,null,{default:o(()=>[i(l,null,{default:o(()=>[i(c,null,{default:o(()=>[h(g(e.title),1)]),_:1})]),_:1})]),_:1}),i(v,{class:"selector"},{default:o(()=>[i($,null,{default:o(()=>[(r(!0),_(P,null,L(e.filteredItems,(I,N)=>(r(),f(D,{"size-lg":"4","size-sm":"6",key:N},{default:o(()=>[i(b,{onClick:E=>e.doTask(I),title:I.name.toUpperCase(),description:I.description,taskCompleted:I.taskCompleted,taskDisabled:e.isDisabled(I.disabled),icon:e.img(I.icon)},null,8,["onClick","title","description","taskCompleted","taskDisabled","icon"])]),_:2},1024))),128))]),_:1})]),_:1}),i(T,null,{default:o(()=>[i(l,null,{default:o(()=>[i(w,{class:"close-btn",color:"danger",size:"large",onClick:e.closeModal,slot:"end"},{default:o(()=>[h(" Close ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const re=A(mt,[["render",ft],["__scopeId","data-v-e1afb1d9"]]),_t=V({components:{HisBasicTable:pe,IonButton:K,IonToolbar:q,IonList:X,IonFooter:G,IonContent:ie,IonRow:F,IonCol:W,IonTitle:ce,IonHeader:J,IonItem:Y},data:()=>({active:{id:-1,name:"",provider:"",rows:[],columns:[]},encounters:[]}),computed:{canVoid(){return!k.isEmpty(this.active)}},watch:{items:{handler(e){k.isEmpty(e)||(this.encounters=e,this.showDetails(this.encounters[0]))},immediate:!0,deep:!0}},props:{title:{type:String,required:!0},items:{type:Object,required:!0}},methods:{closeModal(){Q.dismiss({})},removeEncounter(e){this.encounters=this.encounters.filter(t=>t.other.id!=e)},voidActiveItem(){pt(async e=>{try{await this.active.onVoid(e),this.removeEncounter(this.active.id),this.active={},k.isEmpty(this.encounters)||this.showDetails(this.encounters[0])}catch(t){he("".concat(t))}},"void-modal custom-modal-backdrop")},async showDetails(e){this.active.id=e.other.id,this.active.name=e.label,this.active.columns=e.other.columns,this.active.onVoid=e.other.onVoid,this.active.rows=await e.other.getRows(),this.active.provider=await e.other.provider}}}),gt={style:{float:"right"}},bt={class:"tb"};function vt(e,t,n,a,p,y){const c=s("ion-title"),l=s("ion-toolbar"),d=s("ion-header"),b=s("ion-item"),D=s("ion-list"),$=s("ion-col"),v=s("his-basic-table"),w=s("ion-row"),T=s("ion-content"),I=s("ion-button"),N=s("ion-footer");return r(),_(P,null,[i(d,null,{default:o(()=>[i(l,null,{default:o(()=>[i(c,{class:"his-md-text"},{default:o(()=>[m("span",null,g(e.title),1),m("span",gt,"Provider: "+g(e.active.provider),1)]),_:1})]),_:1})]),_:1}),i(T,null,{default:o(()=>[i(w,null,{default:o(()=>[i($,{size:"4"},{default:o(()=>[i(D,null,{default:o(()=>[(r(!0),_(P,null,L(e.encounters,(E,M)=>(r(),f(b,{class:"his-sm-text",key:M,color:E.other.id===e.active.id?"primary":"",detail:!0,onClick:()=>e.showDetails(E)},{default:o(()=>[h(g(E.label.toUpperCase()),1)]),_:2},1032,["color","onClick"]))),128))]),_:1})]),_:1}),i($,{size:"8"},{default:o(()=>[m("div",bt,[i(v,{columns:e.active.columns,rows:e.active.rows},null,8,["columns","rows"])])]),_:1})]),_:1})]),_:1}),i(N,null,{default:o(()=>[i(l,null,{default:o(()=>[i(I,{color:"danger",onClick:e.voidActiveItem,disabled:!e.canVoid,size:"large"},{default:o(()=>[h(" Void encounter")]),_:1},8,["onClick","disabled"]),i(I,{onClick:e.closeModal,size:"large",slot:"end"},{default:o(()=>[h(" Close ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const Ct=A(_t,[["render",vt],["__scopeId","data-v-c0afd11b"]]),yt=V({components:{HisBasicTable:pe,IonHeader:J,IonToolbar:q,IonContent:ie,IonFooter:G,IonButton:K},props:{title:{type:String,required:!0},columns:{type:Array,required:!0},rows:{type:Array,default:()=>[]}},methods:{async closeModal(){await Q.dismiss({})}}});function It(e,t,n,a,p,y){const c=s("ion-title"),l=s("ion-toolbar"),d=s("ion-header"),b=s("his-basic-table"),D=s("ion-content"),$=s("ion-button"),v=s("ion-footer");return r(),_(P,null,[i(d,null,{default:o(()=>[i(l,null,{default:o(()=>[i(c,{class:"his-md-text"},{default:o(()=>[h(g(e.title),1)]),_:1})]),_:1})]),_:1}),i(D,null,{default:o(()=>[i(b,{columns:e.columns,rows:e.rows},null,8,["columns","rows"])]),_:1}),i(v,null,{default:o(()=>[i(l,null,{default:o(()=>[i($,{size:"large",onClick:e.closeModal,slot:"end"},{default:o(()=>[h(" Close ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const kt=A(yt,[["render",It]]),Dt=V({components:{TextSkeleton:$e,IonLabel:me,IonList:X,IonItem:Y,IonChip:fe,IonIcon:oe,IonBadge:we},data:()=>({time:_e}),props:{isEnabled:{type:Boolean,default:()=>!0},counter:{type:Number,required:!1},isLoading:{type:Boolean},icon:{type:Object},title:{type:String,required:!0},items:{type:Object},titleColor:{type:String,required:!1,default:()=>"#337ab7"}}});function $t(e,t,n,a,p,y){const c=s("ion-badge"),l=s("ion-label"),d=s("ion-item"),b=s("text-skeleton"),D=s("ion-icon"),$=s("ion-chip"),v=s("ion-list");return r(),_("div",{class:ne(["card",{inactive:!e.isEnabled,clickable:e.isEnabled}])},[i(d,{color:e.titleColor,lines:"none",class:"his-md-text title-card"},{default:o(()=>[i(c,{slot:"start",class:"his-sm-text",color:"light"},{default:o(()=>[m("b",null,g(e.counter),1)]),_:1}),i(l,null,{default:o(()=>[h(g(e.title),1)]),_:1})]),_:1},8,["color"]),e.isLoading?(r(),f(b,{key:0,itemCount:5})):C("",!0),e.isLoading?C("",!0):(r(),f(v,{key:1},{default:o(()=>[(r(!0),_(P,null,L(e.items,(w,T)=>(r(),f(d,{key:T},{default:o(()=>{var I;return[i(l,{class:ne((I=w==null?void 0:w.other)!=null&&I.wrapTxt?"ion-text-wrap":""),innerHTML:w.label},null,8,["class","innerHTML"]),w.value?(r(),f($,{key:0,class:"his-sm-text",slot:"end"},{default:o(()=>[i(D,{icon:e.icon},null,8,["icon"]),i(l,null,{default:o(()=>[h(g(w.value),1)]),_:2},1024)]),_:2},1024)):C("",!0)]}),_:2},1024))),128))]),_:1}))],2)}const wt=A(Dt,[["render",$t],["__scopeId","data-v-3db6edee"]]),Tt=V({components:{IonList:X,IonItem:Y},props:{title:{type:String,default:()=>"Visits"},items:{type:Object,required:!0}},data:()=>({active:{},activeListItems:[],paginatedListItems:[],index:-1,perPage:6,btnSize:45}),computed:{listAlignmentClass(){return this.activeListItems&&this.activeListItems.length===this.perPage?"vertically-align":""},upbuttonImg(){return"/assets/images/drop-up-arrow.svg"},downbuttonImg(){return"/assets/images/drop-down-arrow.svg"},showNextButton(){return this.index+1<this.paginatedListItems.length},showPrevButton(){return this.index>=1}},watch:{items:{handler(e){if(!k.isEmpty(e)){this.index=0,this.paginatedListItems=k.chunk(e,this.perPage),this.activeListItems=this.paginatedListItems[0],this.active=this.activeListItems[0];for(const t in this.paginatedListItems){const n=k.findIndex(this.paginatedListItems[t],a=>a.other.isActive===!0,0);if(n!=-1){this.index=parseInt(t),this.activeListItems=this.paginatedListItems[t],this.active=this.activeListItems[n];break}}}},deep:!0,immediate:!0},index:{handler(e){this.activeListItems=this.paginatedListItems[e]},immediate:!0},active(e){this.$emit("onselect",e)}},methods:{onselect(e){this.active=e},isActive(e){return e.label===this.active.label},goNext(){const e=this.index+1;e<=this.paginatedListItems.length&&(this.index=e)},goPrev(){this.paginatedListItems.length>=1&&(this.index-=1)}}}),Pt={class:"card his-card"},Et={class:"his-md-text header-section"},Lt=["disabled"],Ot=["src","width"],Vt={class:"bottom-section"},At=["disabled"],St=["src","width"];function Nt(e,t,n,a,p,y){const c=s("ion-item"),l=s("ion-list");return r(),_("div",Pt,[m("div",Et,g(e.title),1),m("button",{class:"nav-btn nav-btn-top clickable",disabled:!e.showPrevButton,onClick:t[0]||(t[0]=(...d)=>e.goPrev&&e.goPrev(...d))},[m("img",{src:e.upbuttonImg,width:e.btnSize},null,8,Ot)],8,Lt),m("div",{class:ne(e.listAlignmentClass)},[i(l,null,{default:o(()=>[(r(!0),_(P,null,L(e.activeListItems,(d,b)=>(r(),f(c,{class:"his-md-text",key:b,onClick:D=>e.onselect(d),detail:!0,color:e.isActive(d)?"primary":""},{default:o(()=>[h(g(d.label),1)]),_:2},1032,["onClick","color"]))),128))]),_:1})],2),m("div",Vt,[m("button",{class:"nav-btn nav-btn-bottom clickable",disabled:!e.showNextButton,onClick:t[1]||(t[1]=(...d)=>e.goNext&&e.goNext(...d))},[m("img",{src:e.downbuttonImg,width:e.btnSize},null,8,St)],8,At)])])}const zt=A(Tt,[["render",Nt],["__scopeId","data-v-751691ca"]]);function Mt(){const e=ge({width:window.innerWidth,height:window.innerHeight});function t(n){e.value={height:n.currentTarget.innerHeight,width:n.currentTarget.innerWidth}}return Te(()=>{addEventListener("resize",t)}),Pe(()=>{removeEventListener("resize",t)}),{resolution:e}}const Bt=V({name:"HisResultCard",components:{IonIcon:oe},props:{icon:{required:!1},items:{type:Object,required:!0}},methods:{hasIcon(e){return"other"in e&&"icon"in e.other}}}),Ht={class:"tool-bar-medium-card"};function qt(e,t,n,a,p,y){const c=s("ion-icon");return r(),_("div",Ht,[(r(!0),_(P,null,L(e.items,(l,d)=>(r(),_("div",{key:d},[e.hasIcon(l)?(r(),f(c,{key:0,icon:l.other.icon},null,8,["icon"])):C("",!0),h(" "+g(l.label)+": ",1),m("b",null,g(l.value),1)]))),128))])}const Ut=A(Bt,[["render",qt],["__scopeId","data-v-f304e49e"]]),jt=V({name:"PatientToolbar",components:{IonHeader:J,IonToolbar:q,IonCol:W,IonRow:F,InfoCard:Ut,IconCard:ht},props:{app:{type:Object},appVersion:{type:String},patientCardInfo:{type:Array,required:!0},programCardInfo:{type:Array,required:!0},appIcon:{type:String,required:!0}},computed:{logo(){return ue(this.appIcon)}}});function Rt(e,t,n,a,p,y){const c=s("info-card"),l=s("ion-col"),d=s("icon-card"),b=s("ion-row"),D=s("ion-toolbar"),$=s("ion-header");return r(),f($,{translucent:!0},{default:o(()=>[i(D,null,{default:o(()=>[i(b,null,{default:o(()=>[i(l,{size:"5"},{default:o(()=>[i(c,{items:e.patientCardInfo},null,8,["items"])]),_:1}),i(l,{size:"5"},{default:o(()=>[i(c,{items:e.programCardInfo},null,8,["items"])]),_:1}),i(l,{size:"2"},{default:o(()=>[i(d,{app:e.app,version:e.appVersion,icon:e.logo},null,8,["app","version","icon"])]),_:1})]),_:1})]),_:1})]),_:1})}const Ft=A(jt,[["render",Rt]]),Wt=V({components:{IonList:X,IonLabel:me,IonItem:Y,IonSegment:Ee,IonSegmentButton:Le,IonChip:fe,IonPage:Oe,IonIcon:oe,IonFooter:G,IonContent:ie,IonButton:K,IonToolbar:q,IonGrid:de,IonRow:F,IonCol:W,FullToolbar:Ft,PrimaryCard:wt,VisitDatesCard:zt,MinimalToolbar:Ve(()=>lt(()=>import("./MinimalToolbar-Dr6VdN75.js"),__vite__mapDeps([0,1,2])))},setup(){const e=ge("lg"),{resolution:t}=Mt();return Ae(()=>t.value,n=>{n&&n.width<=900?e.value="sm":e.value="lg"},{immediate:!0,deep:!0}),{sync:Se,time:_e,timeOutline:U,person:Ne,calendar:ze,medical:Me,clipboard:Be,apps:He,folder:qe,logOut:Ue,clipboardOutline:je,appsOutline:Re,folderOutline:Fe,logOutOutline:We,alertCircle:Ge,screenBreakPoint:e}},data:()=>({online:Ke,initMode:"",activeTab:1,app:{},dashboardComponent:{},isBDE:!1,currentDate:"",sessionDate:"",nextTask:{},programId:0,patientId:0,patient:{},patientProgram:{},patientCardInfo:[],programCardInfo:[],visitDates:[],activeVisitDate:"",patientCards:[],appVersion:S.getFullVersion(),sessionEncounterMap:{},savedEncounters:[]}),computed:{patientIsset(){return!k.isEmpty(this.patient)},patientName(){return k.isEmpty(this.patient)?"N/A":this.patient.name},appHasCustomContent(){return!k.isEmpty(this.app.customPatientDashboardContentComponent)},customDashboardContent(){return this.app.customPatientDashboardContentComponent},visitDatesTitle(){return"".concat(this.visitDates.length," Visits")},hasOfflineObs(){const{offlineData:e}=z();return e.value.some(t=>"".concat(t.id)==="".concat(this.patientId)&&(t.obsToSave||[]).some(n=>n.uploadStatus!="Success")&&t.programID===S.getProgramID())}},watch:{online:{handler(e){e&&this.init()}},activeVisitDate(e){this.appHasCustomContent||this.updateCardVisitData(e)}},created(){this.app=j.getActiveApp(),this.setPatientCards()},mounted(){this.$route.params.id&&(this.patientId=this.$route.params.id,j.doAppManagementTasks().then(()=>{var e;this.app=j.getActiveApp(),typeof((e=this.app)==null?void 0:e.overridePatientDashboardCards)=="function"&&this.setPatientCards(),this.programId=this.app.programID,this.appHasCustomContent&&(this.patientCards=[]),this.init()}))},methods:{async initSynchronization(){const{synchronizeRecord:e,findByID:t}=z();await this.showLoader("Synchronization has started. this may take a while");try{const a=(await e(this.patientId)).personID;if(!a)return this.clearLoader(),this.patientId;if("".concat(a)!="".concat(this.patientId)){const p=t(this.patientId);p.id=a,p.personID=a,p.generatedIDs=[...p.generatedIDs||[],a],document.location="/patient/dashboard/".concat(a)}return this.clearLoader(),parseInt("".concat(a))}catch(n){console.error("Error synchronizing data "+n)}this.clearLoader()},async initOnline(){const e=parseInt("".concat(this.patientId));try{let t=await B.get("ACTIVE_PATIENT",{patientID:e});if(k.isEmpty(t)||this.hasOfflineObs){const n=await this.initSynchronization();if(t=await B.get("ACTIVE_PATIENT",{patientID:parseInt("".concat(n))}),k.isEmpty(t))return!1}this.patient={patient_id:t.getID(),birthdate:t.getBirthdate(),name:t.getFullName(),currentVillage:t.getCurrentVillage(),age:t.getAge(),nationalID:t.getNationalID(),gender:t.getGender(),phone:t.getPhoneNumber()},z().cachePatient(t)}catch(t){return console.error("".concat(t)),H("Unable to initialise client online"),!1}return this.patientCardInfo=this.getPatientCardInfo(this.patient),this.getNextTask().then(t=>this.nextTask=t),this.getPatientVisitDates(e).then(t=>{this.visitDates=t,this.loadSavedEncounters()}).catch(t=>{console.error(t)}),this.buildProgramInfoData(e),x.value=!1,!0},initOffline(){var n;const e=z().findByID(this.patientId),t=(n=e==null?void 0:e.personParams)==null?void 0:n.person;return t?(this.patient={patient_id:t.personID,birthdate:t.birthdate,name:"".concat(t.given_name," ").concat(t.family_name),currentVillage:t.current_village||"N/A",age:(t==null?void 0:t.age)||Je(S.getSessionDate()).diff(t.birthdate,"years"),gender:t.gender,phone:t.phone||"N/A",nationalID:t.npid||"No npid"},this.getNextTask().then(a=>this.nextTask=a),this.patientCardInfo=this.getPatientCardInfo(this.patient),this.buildProgramInfoData(this.patientId),!0):!1},async init(){this.currentDate=R.currentDisplayDate(),this.sessionDate=this.toDate(S.getSessionDate()),this.isBDE=S.isBDE()||!1,this.initMode="",await this.initOnline()?this.initMode="online":this.initOffline()&&(this.initMode="offline"),this.initMode?this.initMode==="offline"&&this.launchSyncDialog():H("Unable to initialise dashboard")},async buildProgramInfoData(e){var t,n;this.programCardInfo=typeof((t=this.app)==null?void 0:t.patientProgramInfoData)=="function"?(n=this.app)==null?void 0:n.patientProgramInfoData(e):[];for(const a of this.programCardInfo)try{typeof a.init=="function"&&await a.init(),typeof a.asyncValue=="function"?a.asyncValue().then(p=>a.value=p):typeof a.staticValue=="function"&&(a.value=a.staticValue())}catch(p){console.error("".concat(p))}},setPatientCards(){var t;const e=[{id:"c1",items:[],cache:{},label:"Activities",color:"primary",isLoading:!1,icon:U,isEnabled:this.isCardEnabled("activitiesEnabled"),onVisitDate:({card:n,date:a,allCards:p})=>{n.isLoading=!0;const y=p.filter(c=>c.subscription&&c.subscription.c1);y.forEach(c=>c.isLoading=!0),ee.getEncounters(parseInt("".concat(this.patientId)),{date:a}).then(c=>{this.sessionEncounterMap={},y.forEach(l=>{l.subscription&&l.subscription.c1&&(l.isLoading=!1,l.subscription.c1({encounters:c,card:l,date:a}))}),n.items=this.getActivitiesCardInfo(c),n.cache&&(n.cache[a]=n.items),a===S.getSessionDate()&&!k.isEmpty(c)&&(this.sessionEncounterMap=c.reduce((l,d)=>(l[d.type.name.toLowerCase()]=d.observations.reduce((b,D)=>b.concat(D.concept.concept_names),[]).map(b=>b.name.toLowerCase()),l),{})),n.isLoading=!1}).catch(c=>{console.error(c),n.items=[],n.isLoading=!1,n.cache&&(n.cache[a]=n.items),y.forEach(l=>l.isLoading=!1)})},onClick:n=>{n.isEnabled&&(n.isLoading?H("Please wait..."):this.openModal(n.items,"Select Activities",Ct))}},{id:"c2",items:[],cache:{},color:"success",isLoading:!1,label:"Lab Orders",icon:U,isEnabled:this.isCardEnabled("labEnabled"),onVisitDate:({card:n,date:a})=>{n.isLoading=!0,this.getLabOrderCardInfo(a).then(p=>{n.items=p,n.cache[a]=n.items,n.isLoading=!1}).catch(()=>{n.items=[],n.cache[a]=n.items,n.isLoading=!1})},onClick:n=>n.isEnabled&&this.$router.push("/art/encounters/lab/".concat(this.patientId))},{id:"c3",items:[],label:"Alerts",color:"danger",icon:Qe,isLoading:!1,isInit:!1,isEnabled:this.isCardEnabled("alertsEnabled"),onVisitDate:({card:n})=>{if(n.isInit)return;const a=this.getPatientAlertCardInfo();typeof a=="object"&&typeof a.then=="function"&&(n.isLoading=!0,this.getPatientAlertCardInfo().then(p=>{p&&(n.items=p),n.isInit=!0,n.isLoading=!1}).catch(()=>{n.items=[],n.isInit=!0,n.isLoading=!1})),a&&(n.items=a)},onClick:()=>{}},{id:"c4",items:[],cache:{},label:"Medications",color:"warning",icon:U,isLoading:!1,isEnabled:this.isCardEnabled("medicationsEnabled"),onVisitDate:({card:n,date:a})=>{n.isLoading=!0,ct.getOrderByPatient(parseInt("".concat(this.patientId)),{start_date:a}).then(p=>{n.items=this.getMedicationCardInfo(p),n.cache&&(n.cache[a]=n.items),n.isLoading=!1}).catch(()=>{n.items=[],n.cache&&(n.cache[a]=n.items),n.isLoading=!1})},onClick:n=>{if(!n.isEnabled)return;if(n.isLoading)return H("Please wait..");const a=["Medication","Start date","End date","Amount given"],p=n.items.map(y=>[y.other.drug.name,this.toDate(y.other.order.start_date),this.toDate(y.other.order.auto_expire_date),y.other.quantity]);this.openTableModal(a,p,"Medication History")}}];if(typeof((t=this.app)==null?void 0:t.overridePatientDashboardCards)=="function")for(const n of this.app.overridePatientDashboardCards()){const a=k.findIndex(e,{id:n.id});a>=0&&(e[a]=n)}this.patientCards=e},launchSyncDialog(){z().launchObservationDialog(this.patientId,{onDeleteEncounter:()=>this.init()})},isCardEnabled(e){var n;const t=(n=this.app)==null?void 0:n.configDefaultPatientDashboardCards;return t&&e in t?t[e]||!1:!0},async showLoader(e="Please wait...."){(await te.create({message:e,backdropDismiss:!1})).present()},clearLoader(){te.getTop().then(e=>e?te.dismiss():null)},toDate(e){return R.toStandardHisDisplayFormat(e)},toTime(e){return R.toStandardHisTimeFormat(e)},loadSavedEncounters(){ee.getSavedEncounters(parseInt("".concat(this.patientId))).then(e=>this.savedEncounters=e)},updateCardVisitData(e,t=!1,n=""){this.patientCards.forEach(a=>{typeof a.cache=="object"&&a.cache[e]&&!t?a.items=a.cache[e]:a.isEnabled&&typeof a.onVisitDate=="function"?a.onVisitDate({card:a,invalidateCache:t,date:e,allCards:this.patientCards,patient:this.patient}):a.items=[]})},async getPatientVisitDates(e){return(await Xe.getPatientVisits(e,!1)).map(t=>({label:this.toDate(t),value:t,other:{isActive:t===S.getSessionDate()}}))},async getNextTask(){return x.value?z().nextPatientWorkflowActivity(this.patientId)||{}:Ye.getNextTaskParams(parseInt("".concat(this.patientId)))},goToNextTask(){var e,t,n;if((e=this.nextTask)!=null&&e.patientUrl&&x.value)return this.$router.push("".concat((t=this.nextTask)==null?void 0:t.patientUrl,"/").concat(this.patientId));Ze((n=this.nextTask)==null?void 0:n.name,this.patientId)},onActiveVisitDate(e){this.activeVisitDate=e.value},getPatientCardInfo(e){const t=e.gender==="M"?xe:et;return[{label:"Name",value:e.name,other:{icon:t}},{label:"Birthdate",value:"\n                    ".concat(this.toDate(e.birthdate),"\n                    (").concat(e.age,") \n                    (").concat(e.nationalID,")")},{label:"Current Village",value:e.currentVillage},{label:"Phone#",value:e.phone}]},getActivitiesCardInfo(e){return e.map(t=>({label:"".concat(t.type.name).toUpperCase(),value:this.toTime(t.encounter_datetime),other:{provider:tt.getPersonFullName(t.provider_id),id:t.encounter_id,columns:["Observation","Value","Time"],onVoid:async n=>{await this.showLoader(),ee.voidEncounter(t.encounter_id,n).then(()=>{this.clearLoader(),this.loadSavedEncounters(),this.updateCardVisitData(this.activeVisitDate,!0),nt.emit("EncounterVoided",t.encounter_id),this.getNextTask().then(a=>this.nextTask=a),it("Encounter has been voided!",2e3)}).catch(a=>{this.clearLoader(),he("".concat(a),32e3)})},getRows:async()=>{var p;const n=[],{observations:a}=t;for(const y in a){let c="<UNKNOWN CONCEPT>";const l=a[y];try{(p=l==null?void 0:l.concept)!=null&&p.concept_names?c=l.concept.concept_names[0].name:c=await ot.getConceptName(l.concept_id)}catch(D){console.error(l,D)}const d=await at.resolvePrimaryValue(l),b=R.toStandardHisTimeFormat(l.date_created);n.push([c,d,b])}return n}}}))},getMedicationCardInfo(e){return e.map(t=>({label:t.drug.name,value:this.toTime(t.order.start_date),other:t}))},async getLabOrderCardInfo(e){return typeof this.app.getPatientDashboardLabOrderCardItems=="function"?this.app.getPatientDashboardLabOrderCardItems(this.patientId,e):(await st.getOrders(parseInt("".concat(this.patientId)),{date:e})).map(n=>({label:n.specimen.name,value:this.toTime(n.order_date)}))},async getPatientAlertCardInfo(){if("getPatientDashboardAlerts"in this.app)return this.app.getPatientDashboardAlerts(this.patient)},async changeApp(){const e=await j.selectApplication("PatientDashboard",!0);e&&(e.programID!=this.programId?(this.programId=e.programID,this.$router.push("/patients/confirm?patient_barcode=".concat(this.patient.nationalID))):this.init())},async showTasks(){if("primaryPatientActivites"in this.app){const e=[...this.app.primaryPatientActivites].map(t=>{const n=(t.encounterTypeName||t.name).toLowerCase();return typeof t.taskCompletionChecklist=="object"&&!k.isEmpty(this.sessionEncounterMap)?t.taskCompleted=t.taskCompletionChecklist.every(a=>k.isArray(this.sessionEncounterMap[n])&&this.sessionEncounterMap[n].includes(a.toLowerCase())):t.taskCompleted=!k.isEmpty(this.sessionEncounterMap[n]),t});this.openModal(e,"Tasks for",re,this.sessionDate)}},showOptions(){if("secondaryPatientActivites"in this.app){const e=this.app.secondaryPatientActivites;this.openModal(e,"Select Activity",re)}},async startModal(e,t){(await Q.create({component:e,backdropDismiss:!1,cssClass:"large-modal",componentProps:t})).present()},openModal(e,t,n,a=""){this.startModal(n,{items:e,title:"".concat(t,": ").concat(a||this.toDate(this.activeVisitDate.toString())),taskParams:{patient:this.patient,gender:this.patient.gender,program:this.patientProgram,visitDate:this.activeVisitDate,patientID:this.patientId,savedEncounters:this.savedEncounters}})},openTableModal(e,t,n){this.startModal(kt,{columns:e,rows:t,title:"".concat(n,": ").concat(this.toDate(this.activeVisitDate.toString()))})},onCancel(){B.invalidate("ACTIVE_PATIENT"),B.invalidate("PATIENT_PROGRAM"),B.invalidate("PATIENT_LAB_ORDERS"),this.$router.push({path:"/"})}}}),be=e=>(rt("data-v-b14f13a2"),e=e(),dt(),e),Gt={key:0},Kt=be(()=>m("p",null,null,-1)),Jt={class:"his-card info-card-item"},Qt={class:"his-card info-card-item"},Xt={class:"his-card info-card-item"},Yt={class:"his-sm-text his-card"},Zt={key:0},xt={key:1},en=be(()=>m("b",null,"NONE",-1)),tn={key:0},nn={key:1},on={key:1};function an(e,t,n,a,p,y){const c=s("minimal-toolbar"),l=s("ion-icon"),d=s("ion-label"),b=s("ion-segment-button"),D=s("ion-segment"),$=s("ion-toolbar"),v=s("ion-button"),w=s("primary-card"),T=s("ion-col"),I=s("ion-row"),N=s("ion-grid"),E=s("ion-item"),M=s("ion-list"),ae=s("ion-content"),ve=s("ion-footer"),se=s("ion-page"),Ce=s("full-toolbar"),ye=s("visit-dates-card"),Z=s("ion-chip");return r(),_(P,null,[e.screenBreakPoint==="sm"?(r(),f(se,{key:0},{default:o(()=>[i(c,{title:e.patientName,menuTitle:e.visitDatesTitle,menuItems:e.visitDates,appIcon:e.app.applicationIcon,onOnClickMenuItem:e.onActiveVisitDate},null,8,["title","menuTitle","menuItems","appIcon","onOnClickMenuItem"]),e.screenBreakPoint==="sm"?(r(),f($,{key:0},{default:o(()=>[i(D,{value:e.activeTab,class:"ion-justify-content-center"},{default:o(()=>[i(b,{value:"1",onClick:t[0]||(t[0]=u=>e.activeTab=1)},{default:o(()=>[i(l,{icon:e.calendar},null,8,["icon"]),i(d,null,{default:o(()=>[h("Visits")]),_:1})]),_:1}),i(b,{value:"2",onClick:t[1]||(t[1]=u=>e.activeTab=2)},{default:o(()=>[i(l,{icon:e.person},null,8,["icon"]),i(d,null,{default:o(()=>[h("Patient")]),_:1})]),_:1}),i(b,{value:"3",onClick:t[2]||(t[2]=u=>e.activeTab=3)},{default:o(()=>[i(l,{icon:e.medical},null,8,["icon"]),i(d,null,{default:o(()=>[h("Program")]),_:1})]),_:1}),i(b,{value:"4",onClick:t[3]||(t[3]=u=>e.activeTab=4)},{default:o(()=>[i(l,{icon:e.time},null,8,["icon"]),i(d,null,{default:o(()=>[h("Dates")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})):C("",!0),e.nextTask.name&&e.screenBreakPoint==="sm"?(r(),f($,{key:1},{default:o(()=>[i(v,{style:{width:"100%"},color:"success",onClick:e.goToNextTask},{default:o(()=>[i(d,null,{default:o(()=>[m("b",null,"Next Task: "+g(e.nextTask.name.toUpperCase()),1)]),_:1}),i(l,{icon:e.alertCircle},null,8,["icon"])]),_:1},8,["onClick"])]),_:1})):C("",!0),i(ae,{id:"main-content"},{default:o(()=>[e.screenBreakPoint==="sm"?(r(),_("div",Gt,[e.appHasCustomContent&&e.activeTab===1&&e.patientIsset?(r(),f(le(e.customDashboardContent),{key:0,patient:e.patient,visitDate:e.activeVisitDate},null,8,["patient","visitDate"])):C("",!0),!e.appHasCustomContent&&e.activeTab===1?(r(),f(N,{key:1},{default:o(()=>[i(I,null,{default:o(()=>[(r(!0),_(P,null,L(e.patientCards,(u,O)=>(r(),f(T,{size:"12",key:O},{default:o(()=>[(r(),f(w,{key:"mcard".concat(O),isEnabled:u.isEnabled,counter:u.items.length,icon:u.icon,title:u.label,titleColor:u.color,items:u.items,isLoading:u.isLoading,onClick:Ie=>u.onClick(u)},null,8,["isEnabled","counter","icon","title","titleColor","items","isLoading","onClick"]))]),_:2},1024))),128))]),_:1})]),_:1})):C("",!0),e.activeTab===2?(r(),f(M,{key:2},{default:o(()=>[(r(!0),_(P,null,L(e.patientCardInfo,(u,O)=>(r(),_("div",{class:"his-card info-card-item",key:O},[i(E,{lines:"none"},{default:o(()=>[i(d,null,{default:o(()=>[h(g(u.label),1)]),_:2},1024),i(d,{slot:"end"},{default:o(()=>[m("b",null,g(u.value),1)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})):C("",!0),e.activeTab===3?(r(),f(M,{key:3},{default:o(()=>[(r(!0),_(P,null,L(e.programCardInfo,(u,O)=>(r(),_("div",{class:"his-card info-card-item",key:O},[i(E,{lines:"none"},{default:o(()=>[i(d,null,{default:o(()=>[h(g(u.label),1)]),_:2},1024),i(d,{slot:"end"},{default:o(()=>[m("b",null,g(u.value),1)]),_:2},1024)]),_:2},1024),Kt]))),128))]),_:1})):C("",!0),e.activeTab===4?(r(),f(M,{key:4},{default:o(()=>[m("div",Jt,[i(E,{lines:"none"},{default:o(()=>[i(d,null,{default:o(()=>[h(" Today ")]),_:1}),i(d,{slot:"end"},{default:o(()=>[m("b",null,g(e.currentDate),1)]),_:1})]),_:1})]),m("div",Qt,[i(E,{lines:"none"},{default:o(()=>[i(d,null,{default:o(()=>[h(" Session ")]),_:1}),i(d,{slot:"end"},{default:o(()=>[m("b",null,g(e.sessionDate),1)]),_:1})]),_:1})]),m("div",Xt,[i(E,{lines:"none"},{default:o(()=>[i(d,null,{default:o(()=>[h(" Current visit date ")]),_:1}),i(d,{slot:"end"},{default:o(()=>[m("b",null,g(e.activeVisitDate),1)]),_:1})]),_:1})])]),_:1})):C("",!0)])):C("",!0)]),_:1}),i(ve,null,{default:o(()=>[e.screenBreakPoint==="sm"?(r(),f($,{key:0,color:"dark"},{default:o(()=>[e.hasOfflineObs?(r(),f(v,{key:0,color:"success",size:"large",slot:"start",onClick:e.launchSyncDialog},{default:o(()=>[i(l,{icon:e.sync},null,8,["icon"])]),_:1},8,["onClick"])):C("",!0),i(v,{color:"light",size:"medium",slot:"start","router-link":"/session/date"},{default:o(()=>[i(l,{icon:e.timeOutline},null,8,["icon"])]),_:1}),i(v,{color:"primary",size:"medium",slot:"end",onClick:e.showTasks},{default:o(()=>[i(l,{icon:e.clipboard},null,8,["icon"])]),_:1},8,["onClick"]),i(v,{color:"primary",size:"medium",slot:"end",onClick:e.showOptions},{default:o(()=>[i(l,{icon:e.folder},null,8,["icon"])]),_:1},8,["onClick"]),i(v,{color:"primary",size:"medium",slot:"end",onClick:e.changeApp},{default:o(()=>[i(l,{icon:e.apps},null,8,["icon"])]),_:1},8,["onClick"]),i(v,{color:"success",size:"medium",slot:"end",onClick:e.onCancel},{default:o(()=>[i(l,{icon:e.logOut},null,8,["icon"])]),_:1},8,["onClick"])]),_:1})):C("",!0)]),_:1})]),_:1})):C("",!0),e.screenBreakPoint==="lg"?(r(),f(se,{key:1},{default:o(()=>[i(Ce,{app:e.app,appVersion:e.appVersion,appIcon:e.app.applicationIcon,patientCardInfo:e.patientCardInfo,programCardInfo:e.programCardInfo},null,8,["app","appVersion","appIcon","patientCardInfo","programCardInfo"]),i(ae,{id:"main-content"},{default:o(()=>[i(N,{class:"grid-custom vertically-align"},{default:o(()=>[i(I,null,{default:o(()=>[i(T,{size:"2.4"},{default:o(()=>[i(ye,{title:e.visitDatesTitle,items:e.visitDates,onOnselect:e.onActiveVisitDate},null,8,["title","items","onOnselect"])]),_:1}),i(T,{size:"9.6"},{default:o(()=>[m("div",Yt,[i(I,null,{default:o(()=>[i(T,{"size-md":"4","size-sm":"6"},{default:o(()=>[h(" Today's Date: "),m("b",null,g(e.currentDate),1)]),_:1}),i(T,{"size-md":"4","size-sm":"6"},{default:o(()=>[e.nextTask.name?(r(),_("span",Zt,[i(Z,{class:"next-task",color:"success",onClick:e.goToNextTask},{default:o(()=>[h("Next Task: "+g(e.nextTask.name.toUpperCase()),1)]),_:1},8,["onClick"])])):(r(),_("span",xt,[h(" Next Task: "),en]))]),_:1}),i(T,{"size-md":"4","size-sm":"12"},{default:o(()=>[e.isBDE?(r(),_("span",tn,[i(Z,{style:{marginTop:"-8px"},color:"danger",onClick:t[4]||(t[4]=u=>e.$router.push({name:"Session Date"}))},{default:o(()=>[m("b",null," BDE: "+g(e.sessionDate.toUpperCase()),1)]),_:1})])):(r(),_("span",nn,[i(Z,{style:{marginTop:"-8px"},color:"dark",onClick:t[5]||(t[5]=u=>e.$router.push({name:"Session Date"}))},{default:o(()=>[m("b",null,"Set Date: "+g(e.sessionDate.toUpperCase()),1)]),_:1})]))]),_:1})]),_:1}),e.appHasCustomContent&&e.patientIsset?(r(),f(le(e.customDashboardContent),{key:0,patient:e.patient,visitDate:e.activeVisitDate},null,8,["patient","visitDate"])):C("",!0),e.appHasCustomContent?C("",!0):(r(),_("div",on,[i(I,null,{default:o(()=>[(r(!0),_(P,null,L(e.patientCards,(u,O)=>(r(),f(T,{size:"6",key:O},{default:o(()=>[(r(),f(w,{key:u.label,isEnabled:u.isEnabled,counter:u.items.length,icon:u.icon,title:u.label,titleColor:u.color,items:u.items,isLoading:u.isLoading,onClick:Ie=>u.onClick(u)},null,8,["isEnabled","counter","icon","title","titleColor","items","isLoading","onClick"]))]),_:2},1024))),128))]),_:1})]))])]),_:1})]),_:1})]),_:1})]),_:1}),i($,{color:"dark"},{default:o(()=>[e.hasOfflineObs?(r(),f(v,{key:0,color:"light",size:"large",slot:"start",onClick:e.launchSyncDialog},{default:o(()=>[i(l,{icon:e.sync},null,8,["icon"])]),_:1},8,["onClick"])):C("",!0),i(v,{color:"primary",size:"large",slot:"end",onClick:e.showTasks},{default:o(()=>[i(l,{icon:e.clipboardOutline},null,8,["icon"]),h(" Tasks ")]),_:1},8,["onClick"]),i(v,{color:"primary",size:"large",slot:"end",onClick:e.showOptions},{default:o(()=>[i(l,{icon:e.folderOutline},null,8,["icon"]),h(" Printouts/Other ")]),_:1},8,["onClick"]),i(v,{color:"primary",size:"large",slot:"end",onClick:e.changeApp},{default:o(()=>[i(l,{icon:e.appsOutline},null,8,["icon"]),h(" Applications ")]),_:1},8,["onClick"]),i(v,{onClick:e.onCancel,color:"success",size:"large",slot:"end"},{default:o(()=>[i(l,{icon:e.logOutOutline},null,8,["icon"]),h(" Finish ")]),_:1},8,["onClick"])]),_:1})]),_:1})):C("",!0)],64)}const un=A(Wt,[["render",an],["__scopeId","data-v-b14f13a2"]]);export{un as default};
