System.register(["./index-legacy-BiNmSRfH.js","./HisStandardForm-legacy-Bllf5xqT.js","./useEncounter-legacy-2TnVgeIB.js","./commons-legacy-iFb7BPgF.js","./isEmpty-legacy-COGu-skn.js","./encounter_guidelines-legacy-Ct5w19z6.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,n,r,i,o,d,u,l,s,m,c,p,_,g,v,T,E,h,y,D,b;return{setters:[e=>{a=e.d,n=e.r,r=e.bV,i=e.bX,o=e.am,d=e.a_,u=e.e2,l=e.al,s=e.a,m=e.w,c=e.e,p=e.f,_=e.n,g=e.b,v=e.B,T=e.bK,E=e.bZ},e=>{h=e.H},e=>{y=e.u},e=>{D=e.m,b=e.r},null,null,null],execute:function(){e("default",a({__name:"Treatment",setup(e){const t=n(""),a=n([]),S=new r(-1,i.TREATMENT),O=n("standard"),N=n();function R(e){return[...Array.isArray(e.selectedDrugs)?e.selectedDrugs.map((e=>e.other)):[e.selectedDrugs.other],...e.mdrSupplements?.value&&"NONE"!=e.mdrSupplements?.value?[e.mdrSupplements.other]:[]]}const{goToNextTask:I,patientDashboardUrl:f,facts:x}=y(((e,n)=>{S.patientID=n,S.providerID=e,a.value=[(()=>{let e=[];return{id:"regimenShortCode",helpText:"DR regimen",type:o.TT_DR_PRESCRIPTION_INPUT,proxyID:"selectedDrugs",dynamicHelpText:()=>N.value.regimen_title,computedValue:e=>e.map((e=>({concept_id:u("MEDICAL_ORDERS"),value_coded:e.value,obs_datetime:S.date}))),beforeNext:async e=>{if(!e.every((e=>!!e.other))){const t=e.filter((e=>!e.other)).map((e=>e.label));return await d("System ERROR","Please report this issue to resume using the system:",`Some drugs are missing weight band information: ${t}`,[{name:"Ok",slot:"start",color:"danger"}]),!1}return!0},init:async()=>{if(N.value=await r.getJson("mdr/regimen/status",{patient_id:S.patientID,program_id:S.programID,date:S.date}),N.value?.mdr_status&&(N.value?.regimen_drugs||[]).length){const t=N.value.regimen_drugs.reduce(((e,t)=>({...e,[t.abbreviation]:t})),{});e=N.value.regimen_composition.split("-").reduce(((e,a)=>[...e,{label:a,value:a.split("/")[0],other:a.split("/").map((e=>t[e]))}]),[])}return!0},condition:()=>N.value.mdr_status,options:()=>e}})(),(()=>{let e=[];return{id:"regimens",helpText:"Recommended regimens (weight-band adjusted):",type:o.TT_SELECT,requireNext:!1,proxyID:"selectedDrugs",init:async()=>{const t=await r.getJson(`programs/${S.programID}/regimens`,{patient_id:n,date:S.date});return e=t.map((e=>({label:e.drug.name,value:e.drug_id,other:e}))),!0},computedValue:e=>[{concept_id:u("MEDICAL_ORDERS"),value_coded:e?.other?.drug?.concept_id,obs_datetime:S.date}],onload:()=>O.value="standard",validation:e=>l.required(e),condition:()=>!N.value?.mdr_status,options:()=>e,config:{hiddenFooterBtns:["Back"],footerBtns:[{name:"Custom Regimen",slot:"end",onClick:()=>{O.value="custom",t.value="customRegimen"}}]}}})(),(()=>{let e=[];return{id:"customRegimen",helpText:"Custom regimens:",type:o.TT_MULTIPLE_SELECT,proxyID:"selectedDrugs",validation:e=>l.required(e),condition:()=>"custom"===O.value,computedValue:e=>e.map((e=>({concept_id:u("MEDICAL_ORDERS"),value_coded:e.other.drug.concept_id,obs_datetime:S.date}))),options:async()=>{if(!e.length){const t=await r.getJson(`programs/${S.programID}/custom_tb_ingredients`,{patient_id:n});e=t.map((e=>({label:e.drug.name,value:e.drug_id,other:e})))}return e}}})(),(()=>{let e=[];return{id:"mdrSupplements",helpText:"Supplements:",requireNext:!0,type:o.TT_SELECT,init:async()=>{try{const t=await r.getJson(`programs/${S.programID}/tb_regimen_group`,{patient:n,regimen_group:"secondline-supplements"});e=t.map((e=>({label:e.drug.name,value:e.drug_id,other:e})))}catch(t){console.error(t)}return!0},computedValue:e=>{if("NONE"!=e.value)return{concept_id:u("MEDICAL_ORDERS"),value_coded:e.other.drug.concept_id,obs_datetime:S.date}},validation:e=>l.required(e),condition:e=>e.regimenShortCode.length>=1,options:()=>[{label:"NONE",value:"NONE"},...e]}})(),{id:"drugsView",helpText:"Dosages:",type:o.TT_TABLE_VIEWER,options:e=>[{label:"",value:"",other:{columns:["Name","AM","NOON","PM"],rows:R(e).map((e=>[e.name||e?.drug?.name,e.am_dose,e.noon_dose,e.pm_dose]))}}]},{id:"recommendedNumberOfDays",helpText:"Duration of Drug Supply in Days:",type:o.TT_SELECT,validation:e=>l.required(e),computedValue:e=>{if("Other"!=e.value)return{concept_id:u("REGIMEN_SUPPLY_DAYS"),value_numeric:parseInt(`${e.value}`),obs_datetime:S.date}},options:()=>[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:14,label:"14"},{value:28,label:"28"},{value:56,label:"56"},{value:84,label:"84"},{value:"Other",label:"Other"}],requireNext:!1},{id:"otherDays",helpText:"Custom Duration of Drug Supply in Days:",type:o.TT_NUMBER,computedValue:e=>({concept_id:u("REGIMEN_SUPPLY_DAYS"),value_numeric:parseInt(`${e.value}`),obs_datetime:S.date}),validation:e=>l.required(e),condition:e=>"Other"===e.recommendedNumberOfDays.value},(()=>{let e=!1;return{id:"useHangingPills",helpText:"Use Hanging Pills:",type:o.TT_SELECT,init:async()=>{const t=await r.getObs({person_id:n,date:S.date,page_size:1,concept_id:u("TB_ADHERENCE")});return e=!!(t||[]).length,!0},condition:()=>e,validation:e=>l.required(e),computedValue:(e,t)=>{"Yes"===e.value&&R(t).map((e=>({concept_id:u("APPOINTMENT_REASON"),value_drug:e.drug_id,value_text:"Optimize - including hanging pills",obs_datetime:S.date})))},options:()=>D(["Yes","No"])}})(),{id:"dot",helpText:"DOT and Adherence Support Technique",type:o.TT_SELECT,validation:e=>l.required(e),computedValue:e=>({concept_id:u("TYPE_OF_SUPPORT"),value_coded:u(`${e.value}`),obs_datetime:S.date}),options:()=>[{value:"GUARDIAN",label:"Guardian"},{value:"HEALTH_CARE_WORKER",label:"Health Care Worker"},{value:"VOLUNTEER",label:"Volunteer"},{value:"HSA",label:"Health Surveillance Assistant"}]}]}));async function A(e,t){await S.createEncounter(),await S.saveObservationList(await b(t)),await r.postJson("drug_orders",{encounter_id:S.encounterID,drug_orders:R(e).map((t=>({drug_inventory_id:t?.drug_id||t?.id||t?.drug?.drug_id,start_date:S.date,am_dose:t.am_dose,noon_dose:t.noon_dose,pm_dose:t.pm_dose,auto_expire_date:v(S.date).add("Other"!=e.recommendedNumberOfDays.value?e.recommendedNumberOfDays.value:e.otherDays.value,"days").format(T),name:t.drug.name,concept_id:t.drug.concept_id,equivalent_daily_dose:t.am_dose+t.noon_dose+t.pm_dose})))}),E.isOnTreatment(x.outcome)||await E.enrollTb(S.patientID),I()}return(e,n)=>(g(),s(p(_),null,{default:m((()=>[c(h,{cancelDestinationPath:p(f),onFinishAction:A,activeField:t.value,onOnIndex:n[0]||(n[0]=e=>t.value=""),fields:a.value,skipSummary:!0},null,8,["cancelDestinationPath","activeField","fields"])])),_:1}))}}))}}}));
