const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-CspTcHd8.js","assets/index-NAoeW21C.js","assets/index-CFPp1uVm.css"])))=>i.map(i=>d[i]);
import{c7 as B,bt as L,d as N,r as l,ap as x,t as S,cl as w,u as _,B as E,z as n,G as d,Z as K,x as p,w as m,y as f,a3 as y,cm as M,H as $,av as F,K as T,O as o,a6 as q}from"./index-NAoeW21C.js";import{F as i,D as z}from"./index-C0WsZfbb.js";const G=B("CapacitorAppInstaller",{web:()=>L(()=>import("./web-CspTcHd8.js"),__vite__mapDeps([0,1,2])).then(u=>new u.CapacitorAppInstallerWeb)}),H={key:0,id:"update-notification"},O=N({__name:"ApkUpdateNotification",props:{checkInterval:{type:Number,default:36e5}},setup(u){const b=u,r=l(!1),s=l(""),a=l(""),c=new F,v=x(()=>!!a.value&&a.value!="-"&&a.value!==s.value),g=l("");S(h);function h(){w("mobile")&&w("android")&&setInterval(async()=>{v.value||(a.value=await c.getApkVersion(),s.value=c.getHeadVersion())},b.checkInterval)}function k(){a.value=s.value}async function P(){try{if(await I()){r.value=!0,U();const e=await A();if(r.value=!1,!e)throw new Error("Unable to download the app");T("Download completed. Installing the app..."),await V(e),s.value=a.value}}catch(e){r.value=!1,console.error(e),o("Unable to update the app")}}async function I(){try{const{publicStorage:e}=await i.checkPermissions();if(e!=="granted"){const{publicStorage:t}=await i.requestPermissions();if(t!=="granted")return o("Permission to access storage is required to download the app."),!1}return!0}catch(e){return console.error(e),o("Unable to download the app. Please try again later"),!1}}async function A(){try{return(await i.downloadFile({url:await c.getApkDownloadLink(a.value),path:"Download/emr-".concat(a.value,".apk"),directory:z.ExternalStorage,recursive:!0,progress:!0})).path}catch(e){console.error(e),o(e.toString())}}function U(){i.addListener("progress",e=>{const t=Math.round(e.contentLength/1024),C=Math.round(e.bytes/1024),D=Math.round(e.bytes/e.contentLength*100);g.value="Downloading... ".concat(C,"KB / ").concat(t,"KB (").concat(D,"%)")})}async function V(e){try{await G.install({file:e})}catch(t){console.error(t),o("Unable to install the app. Please try again later")}}return(e,t)=>v.value?(_(),E("div",H,[t[2]||(t[2]=n(" New version (")),d("strong",null,K(a.value),1),t[3]||(t[3]=n(") update is available ")),t[4]||(t[4]=d("br",null,null,-1)),t[5]||(t[5]=d("br",null,null,-1)),p(f(y),{onClick:P,color:"success"},{default:m(()=>t[0]||(t[0]=[n(" Download Update ")])),_:1}),t[6]||(t[6]=n("     ")),p(f(y),{onClick:k,color:"danger"},{default:m(()=>t[1]||(t[1]=[n(" Cancel ")])),_:1}),p(f(M),{"is-open":r.value,message:g.value},null,8,["is-open","message"])])):$("",!0)}}),Z=q(O,[["__scopeId","data-v-70fe1068"]]);export{Z as default};
