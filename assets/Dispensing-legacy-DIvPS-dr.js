System.register(["./index-legacy-CA6M7ipO.js","./dispensation_service-legacy-DUs2I-Wm.js","./EncounterMixin.vue_vue_type_script_lang-legacy-qUwf12Yn.js","./drug_order_service-legacy-3VUXkHbj.js","./encounter_guidelines-legacy-Bcz_Mw7r.js","./GuidelineEngine-legacy-KsvQuFdF.js","./HisStandardForm-legacy-a9YJRGaH.js"],(function(e,t){"use strict";var i,s,a,n,r,o,d,l,u,p,c;return{setters:[e=>{i=e.d,s=e.H,a=e.aj,n=e.ad,r=e.W,o=e.aa,d=e.af,l=e.a,u=e.c},e=>{p=e.D},e=>{c=e._},null,null,null,null],execute:function(){const t=i({mixins:[c],data:()=>({dispensation:{}}),watch:{patient:{async handler(e){this.dispensation=new p(e.getID(),this.providerID),await this.dispensation.loadCurrentDrugOrder(),await this.dispensation.loadDrugHistory(),this.fields=this.getFields()},deep:!0}},methods:{saveDispensations(e){const t=this.buildDispensations(e);return this.dispensation.saveDispensations(t)},buildDispensations(e){return this.dispensation.buildDispensations(e.other.order_id,e.value)},buildMedicationHistory(){return this.dispensation.getDrugHistory().sort(((e,t)=>{const i=new Date(e.order.start_date);return new Date(t.order.start_date)-i})).map((e=>({medication:e.drug.name,date:s.toStandardHisDisplayFormat(e.order.start_date),amount:e.quantity})))},buildOrderOptions(){return this.dispensation.getCurrentOrder().map((e=>({label:e.drug.name,value:e.quantity||0,other:{drug_id:e.drug.drug_id,order_id:e.order.order_id,amount_needed:this.calculateCompletePack(e)}})))},getPackSizesRows(e,t){return this.dispensation.getDrugPackSizes(e).map((e=>[e,t>0?t/e:"-",0,0]))},calculateCompletePack(e){const t=parseFloat(e.amount_needed)-(e.quantity||0),i=this.dispensation.calcCompletePack(e,t);return i<0?0:i},isDoneDispensing:e=>e.map((e=>0!=e.value)).every(Boolean),async isValidDispensation(e){let t=!0;const i=parseInt(e.value.toString())/e.other.amount_needed*100;return i>110&&(t=await a("Are you sure you want to dispense over 110% of the prescribed pill count?")),i<100&&(t=await a("Are you sure you want to dispense less than 100% of the prescribe amount?")),t},getFields(){return[{id:"dispenses",helpText:"Dispensation",type:n.TT_DRUG_DISPENSER,onValueUpdate:async(e,t)=>-1!=e.value&&this.isDoneDispensing(t)?this.gotoPatientDashboard():(e.other.amount_needed=0,await this.dispensation.loadCurrentDrugOrder(),this.buildOrderOptions()),onValue:async(e,t)=>-1===e.value?!!(await this.dispensation.voidOrder(e.other.order_id)):!(!t&&!(await this.isValidDispensation(e)))&&(!!(await this.saveDispensations(e))||(r("Unable to save dispensation"),!1)),config:{medicationHistory:this.buildMedicationHistory(),toolbarInfo:[{label:"Name",value:this.patient.getFullName()},{label:"Gender",value:this.patient.getGender()},{label:"Date Of Birth",value:s.toStandardHisDisplayFormat(this.patient.getBirthdate())}],hiddenFooterBtns:["Clear","Finish"]},options:()=>this.buildOrderOptions()}]}}});e("default",o(t,[["render",function(e,t,i,s,a,n){const r=d("his-standard-form");return l(),u(r,{skipSummary:!0,cancelDestinationPath:e.cancelDestination,fields:e.fields},null,8,["cancelDestinationPath","fields"])}]]))}}}));
