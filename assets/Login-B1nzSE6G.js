import{d as E,a2 as M,a3 as R,aw as U,ax as Q,ay as W,az as A,aA as F,aB as Y,ar as G,aC as j,aq as O,aD as J,aE as X,aF as Z,a9 as N,O as v,aa as P,aG as x,aH as ss,ah as es,a6 as z,ab as r,u as p,B as y,G as u,Z as _,v as C,w as t,z as h,aI as os,aJ as ts,x as o,H as S,E as $,C as V,aK as ns,W as as,S as is,a1 as ls,a5 as rs,Q as us,R as ds,U as ps,a4 as cs,X as fs,Y as hs,r as B,aL as ms,ap as ws,aM as ys,t as gs,aN as bs,aO as Is,aP as D,at as _s,aQ as Cs,aR as ks,aS as vs,aT as Ps,aU as Ss,aV as Ts}from"./index-ii3Qn3XY.js";import{p as $s}from"./main-C3CvCLwN.js";const Bs=E({components:{IonInput:M,IonButton:R,IonIcon:U},props:{useVirtualInput:{type:Boolean}},data:function(){return{eye:Q,eyeOff:W,passwordTimeout:null,showPasswordButtonTimeout:null,showPassword:!1,showPasswordButton:!1,keyboard:A,auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new F,Y.clearScreenTimeout()},setup(){const{facility:s}=G();return{facility:s}},methods:{async syncOffline(){await j()&&(await O.create({component:J,backdropDismiss:!1,componentProps:{onFinish:()=>O.dismiss()}})).present()},onShowPassword(){this.showPassword=!0,this.showPasswordButton=!0,this.passwordTimeout&&clearTimeout(this.passwordTimeout),this.passwordTimeout=setTimeout(()=>this.showPassword=!1,1e4)},renderKeyBoard(s){this.focusInput=s.currentTarget,this.focusInput.id=="password"?this.btnCaption="Login":this.btnCaption="Next";let e=s.currentTarget.getBoundingClientRect().top;e=parseInt(e),this.keyboardTop=e+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(s){const e=s.currentTarget.id;let n;try{e.match(/@#/i)?this.keyboard=X:e.match(/qwerty/i)?this.keyboard=A:e.match(/Del/i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):e.match(/Next/i)?(this.display="none",n=this.$refs.password,n.$el.click()):e.match(/Login/i)?(this.display="none",this.doLogin()):e.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",this.focusInput.id==="username"?n=this.$refs.username:n=this.$refs.password,n.click()):e.match(/Hide/i)?this.display="none":this.focusInput.value+=e,this.focusInput.id=="username"?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(a){console.warn("input error")}},doLogin:async function(){if(this.showPasswordButtonTimeout&&clearTimeout(this.showPasswordButtonTimeout),this.showPasswordButton=!1,this.showPassword=!1,this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!await this.auth.checkTimeIntegrity())throw"Local date does not match API date. Please Update your device's date";await this.auth.login(this.userInput.password),this.auth.startSession();const s=await Promise.all([this.auth.passwordPolicyEnabled(),this.auth.passwordExpired()]),e=(()=>{let n=0;const a=$s(this.userInput.password);return n+=a.score,/^(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])/i.test(this.userInput.password)&&(n+=2),n<3})();if(e||s.every(Boolean)){const n=a=>"".concat(a.value).toLowerCase();return Z([{id:"new_password",proxyID:"password",helpText:"Change your password",type:N.TT_PASSWORD,init:()=>(setTimeout(()=>{e?v("Your password is weak, please change it below"):v("Your password has expired, please change it below",6e3)},500),!0),computedValue:a=>n(a),validation:a=>P.validateSeries([()=>P.required(a),()=>P.hasLengthRangeOf(a,4,15),()=>{if("".concat(this.userInput.password).toLowerCase()===n(a))return["New password should not match old password"]}]),config:{inputType:"password"}},{id:"verify_password",proxyID:"password",helpText:"Confirm Password",type:N.TT_PASSWORD,computedValue:a=>n(a),validation:(a,m)=>P.validateSeries([()=>P.required(a),()=>{if(n(m.verify_password)!=n(m.new_password))return["New password does not match current password"]}]),config:{inputType:"password"}}],async(a,m)=>{await x.updateUser(this.auth.userID,m)?(await this.auth.resetUserPasswordChangeCheck(),this.$router.push("/select_hc_location")):v("Unable to update user")})}await this.syncOffline(),this.$router.push("/select_hc_location")}catch(s){s instanceof ss?(v("Invalid username or password"),this.showPasswordButton=!0,this.showPasswordButtonTimeout=setTimeout(()=>this.showPasswordButton=!1,3e4)):es("".concat(s),5e4)}}else v("Complete form to log in")}},computed:{btnStyles(){return"display: ".concat(this.display,"; top: ").concat(this.keyboardTop,";")}}}),Vs={class:"main",ref:"main"},Ls={class:"cells ion-padding-bottom"},As={key:0},Os={style:{color:"#cd853f"}},Ns={class:"rows"},Ds={class:"cells"},Es=["readonly"],Rs={class:"rows input-rows"},Us={class:"cells"},Fs={class:"rows"},zs=["id"],qs=["id"];function Hs(s,e,n,a,m,k){const c=r("ion-text"),g=r("ion-icon"),i=r("ion-button"),f=r("ion-input");return p(),y($,null,[u("div",Vs,[u("div",Ls,[s.facility?(p(),y("h3",As,[e[7]||(e[7]=u("b",{style:{color:"#8b4513"}},"Facility: ",-1)),u("b",Os,_(s.facility.name)+" ("+_(s.facility.district)+")",1)])):(p(),C(c,{key:1,color:"danger"},{default:t(()=>e[8]||(e[8]=[h("Facility Configuration is not set")])),_:1}))]),u("div",Ns,[u("div",Ds,[os(u("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":e[0]||(e[0]=d=>s.userInput.username=d),onClick:e[1]||(e[1]=d=>s.renderKeyBoard(d)),class:"input-boxes ion-padding",readonly:s.useVirtualInput},null,8,Es),[[ts,s.userInput.username]])])]),u("div",Rs,[u("div",Us,[o(f,{style:{margin:"0px auto","margin-top":"15px","text-align":"left"},modelValue:s.userInput.password,"onUpdate:modelValue":e[3]||(e[3]=d=>s.userInput.password=d),type:s.showPassword?"text":"password",name:"password",ref:"password",id:"password",onClick:e[4]||(e[4]=d=>s.renderKeyBoard(d)),class:"input-boxes ion-padding",placeholder:"Password",readonly:s.useVirtualInput},{default:t(()=>[!s.showPassword&&s.showPasswordButton?(p(),C(i,{key:0,onClick:s.onShowPassword,color:"light",size:"large",slot:"end"},{default:t(()=>[o(g,{size:"large",icon:s.eye},null,8,["icon"])]),_:1},8,["onClick"])):S("",!0),s.showPassword&&s.showPasswordButton?(p(),C(i,{key:1,onClick:e[2]||(e[2]=d=>s.showPassword=!1),color:"light",size:"large",slot:"end"},{default:t(()=>[o(g,{size:"large",icon:s.eyeOff},null,8,["icon"])]),_:1})):S("",!0)]),_:1},8,["modelValue","type","readonly"])])])],512),u("div",{id:"keyboard",style:ns(s.btnStyles),class:"keyboard"},[(p(!0),y($,null,V(s.keyboard,(d,b)=>(p(),y("span",{key:b},[u("div",Fs,[(p(!0),y($,null,V(d,l=>(p(),y("div",{class:"cells",key:l},[l==="Next"||l==="Login"?(p(),y("button",{key:0,id:s.btnCaption,class:"keyboard-btn login-btn",onClick:e[5]||(e[5]=w=>s.keyPress(w))},_(s.btnCaption),9,zs)):S("",!0),l!="Login"&&l!="Next"?(p(),y("button",{key:1,id:s.Caps.on?l.toUpperCase():l.toLowerCase(),class:"keyboard-btn",onClick:e[6]||(e[6]=w=>s.keyPress(w))},_(l==="Del."||l==="Caps"?l:s.Caps.on?l.toUpperCase():l.toLowerCase()),9,qs)):S("",!0)]))),128))])]))),128))],4)],64)}const Ks=z(Bs,[["render",Hs],["__scopeId","data-v-3d7ae8f6"]]),Ms=E({components:{IonIcon:U,IonItem:as,Inputs:Ks,IonButton:R,IonTitle:is,IonLabel:ls,IonPage:rs,IonHeader:us,IonToolbar:ds,IonContent:ps,IonFooter:cs,IonSelect:fs,IonSelectOption:hs},setup(){const s=B([]),e=async()=>{const i=await Ps("Application Selection","Please specify the application you wish to use",s.value.map(f=>f.name),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(i.selection&&i.action!="Cancel"){const f=s.value.find(d=>d.name===i.selection);window.open("".concat(f.protocol||"http","://").concat(f.IP,":").concat(f.port||80),"_blank")}},{activePlatformProfile:n,platformProfiles:a}=ms(),m=B(""),k=B(""),c=ws(()=>n.value.keyboard===Ts.HIS_KEYBOARD_ONLY),g=Object.keys(a.value).map(i=>({label:i,value:{profileName:i,...a.value[i]}}));return ys(k,i=>{n.value=(Ss.find(g,{label:i})||{}).value}),gs(async()=>{var b,l;const i=new F;s.value=((b=await i.loadConfig())==null?void 0:b.otherApps)||[];const f=i.getHeadVersion();i.setActiveVersion(f);const d=await i.getApiVersion();m.value="".concat(f," / ").concat(d),k.value=((l=n.value)==null?void 0:l.profileName)||""}),{showNetworkQr:bs,qrCode:Is,version:m,profile:k,otherApps:s,deviceProfiles:g,useVirtualInputOnly:c,activePlatformProfile:n,coatImg:D("login-logos/Malawi-Coat_of_arms_of_arms.png"),pepfarImg:D("login-logos/PEPFAR.png"),showConfig:localStorage.getItem("useLocalStorage")==="true",openSelect:e,showQrNetworkScanner:_s,settingsOutline:Cs,pin:ks,albums:vs}}}),Qs={slot:"start"},Ws=["src"],Ys=["src"];function Gs(s,e,n,a,m,k){const c=r("ion-label"),g=r("ion-title"),i=r("ion-toolbar"),f=r("ion-header"),d=r("inputs"),b=r("ion-content"),l=r("ion-button"),w=r("ion-icon"),I=r("ion-item"),L=r("ion-popover"),q=r("ion-list"),H=r("ion-footer"),K=r("ion-page");return p(),C(K,null,{default:t(()=>[o(f,null,{default:t(()=>[o(i,null,{default:t(()=>[o(g,null,{default:t(()=>[o(c,{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:t(()=>e[1]||(e[1]=[u("b",{style:{color:"#8b4513"}},"National ",-1),u("b",{style:{color:"#cd853f"}},"EMR",-1)])),_:1})]),_:1}),o(c,{class:"ion-padding",slot:"end"},{default:t(()=>[e[2]||(e[2]=h(" Version: ")),u("b",null,_(s.version),1)]),_:1})]),_:1})]),_:1}),o(b,{fullscreen:!1,style:{width:"100%"}},{default:t(()=>[o(d,{useVirtualInput:s.useVirtualInputOnly},null,8,["useVirtualInput"])]),_:1}),o(H,null,{default:t(()=>[o(i,null,{default:t(()=>[u("span",Qs,[u("img",{id:"coat",src:s.coatImg,alt:"Malawi Coat of Arms logo"},null,8,Ws),u("img",{id:"pepfar",src:s.pepfarImg,alt:"PEPFAR logo"},null,8,Ys)]),o(l,{color:"dark",fill:"outline",size:"large",slot:"end",id:"configuration"},{default:t(()=>e[3]||(e[3]=[h(" Configuration ")])),_:1}),s.otherApps.length?(p(),C(l,{key:0,color:"dark",fill:"outline",size:"large",slot:"end",onClick:s.openSelect},{default:t(()=>e[4]||(e[4]=[h(" Other Applications ")])),_:1},8,["onClick"])):S("",!0),o(L,{trigger:"configuration","dismiss-on-select":""},{default:t(()=>[o(b,null,{default:t(()=>[o(q,null,{default:t(()=>[o(I,{button:"","router-link":"/settings/host",class:"his-sm-text"},{default:t(()=>[o(w,{icon:s.settingsOutline,slot:"start"},null,8,["icon"]),o(c,null,{default:t(()=>e[5]||(e[5]=[h("Network Settings")])),_:1})]),_:1}),o(I,{button:"","router-link":"/location/update/site",class:"his-sm-text"},{default:t(()=>[o(w,{icon:s.pin,slot:"start"},null,8,["icon"]),o(c,null,{default:t(()=>e[6]||(e[6]=[h("Facility Settings")])),_:1})]),_:1}),o(I,{button:"",onClick:e[0]||(e[0]=()=>s.showQrNetworkScanner(()=>s.$router.back())),class:"his-sm-text"},{default:t(()=>[o(w,{icon:s.qrCode,slot:"start"},null,8,["icon"]),o(c,null,{default:t(()=>e[7]||(e[7]=[h("Scan Settings")])),_:1})]),_:1}),o(I,{button:"",onClick:s.showNetworkQr,class:"his-sm-text"},{default:t(()=>[o(w,{icon:s.qrCode,slot:"start"},null,8,["icon"]),o(c,null,{default:t(()=>e[8]||(e[8]=[h("Share Settings")])),_:1})]),_:1},8,["onClick"]),o(I,{button:"",detail:"",id:"devices",class:"his-sm-text"},{default:t(()=>[o(w,{icon:s.albums,slot:"start"},null,8,["icon"]),o(c,null,{default:t(()=>e[9]||(e[9]=[h("Device Profile")])),_:1})]),_:1}),o(L,{trigger:"devices","dismiss-on-select":"",side:"end"},{default:t(()=>[(p(!0),y($,null,V(s.deviceProfiles,T=>(p(),C(I,{key:T.label,color:T.label===s.profile?"primary":"light",button:"",onClick:()=>s.profile=T.label},{default:t(()=>[o(c,null,{default:t(()=>[h(_(T.label),1)]),_:2},1024)]),_:2},1032,["color","onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const Xs=z(Ms,[["render",Gs],["__scopeId","data-v-09ea2fc8"]]);export{Xs as default};
