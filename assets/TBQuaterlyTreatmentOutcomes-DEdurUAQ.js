import{d as B,n as E,r,o as k,aE as F,aR as N,p as R,z as u,br as v,s as S,al as f,am as _,ak as V,ap as h,a as $,b as q,w as x,e as I}from"./index-Ds0zDBhU.js";import{v as A}from"./TableView-N12LtehS.js";import{T as Q}from"./tb_report_service-CGp9EU8Q.js";import{T as L}from"./TBDrilldown-DKfZDNxn.js";import"./Export-DFDKXGhs.js";import"./index-DZD2XSQD.js";const M=B({components:{IonPage:E,v2Datatable:A},setup(){const l=r("-"),d=r([]),i=r(""),c=r(1),p=r([]),s=r("Select All"),o=(e,a)=>({label:e,ref:a,toValue:t=>t.length,tdClick:t=>m(t)}),m=async e=>{(console.log(e),await u.create({component:L,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e.column.label,patientIdentifiers:e.refData,subtitle:"Period: ".concat(i.value," Q").concat(c.value),onFinish:()=>u.getTop().then(a=>a&&u.dismiss())}})).present()},n=r([{label:"New Smear positive",value:"new_smear_positive"},{label:"New MTB Detected Xpert",value:"new_mtb_detected_xpert"},{label:"New Pulmonary Clinically Diagnosed",value:"new_pulmonary_clinically_diagnosed"},{label:"New EPTB",value:"new_eptb"},{label:"Relapse Bacteriologically Confirmed",value:"relapse_bacteriologically_confirmed"},{label:"Relapse Clinical Pulmonary",value:"relapse_clinical_pulmonary"},{label:"Relapse EPTB",value:"relapse_eptb"},{label:"Retreatment Excluding Relapse",value:"retreatment_excluding_relapse"},{label:"HIV Positive New and Relapse",value:"hiv_positive_new_and_relapse"},{label:"Children aged Zero to Four",value:"children_aged_zero_to_four"},{label:"Children aged Five to Fourteen",value:"children_aged_five_to_fourteen"}]),C=[[{label:"Indicator",ref:"indicator",value:e=>{var a;return"".concat((a=n.value.find(t=>t.value===e.indicator))==null?void 0:a.label)}},o("Cases","cases"),o("Cured","cured"),o("Complete","complete"),o("Failed","failed"),o("Died","died"),o("Lost","lost"),o("NE","ne")]],b=async()=>{(await v.create({backdropDismiss:!1,message:"Generating report, Please wait..."})).present();try{const a=await new Q().getTBQuateryTreatmentOutcomes(i.value,c.value,p.value);d.value=a.map(t=>({indicator:t.indicator,cases:t.cases,cured:t.cured,complete:t.complete,failed:t.failed,died:t.died,lost:t.lost,ne:t.ne}))}catch(e){console.error(e),S("Unable to generate report")}v.getTop().then(e=>e&&v.dismiss())},g=()=>F([{id:"year",helpText:"Year",type:_.TT_NUMBER,validation:e=>f.required(e),computedValue:e=>e.value},{id:"quater",helpText:"Quater",type:_.TT_SELECT,requireNext:!1,options:()=>[{label:"First",value:1},{label:"Second",value:2},{label:"Third",value:3},{label:"Fourth",value:4}],validation:e=>f.required(e),computedValue:e=>e.value},{id:"indicators",helpText:"Indicators",type:_.TT_MULTIPLE_SELECT,options:()=>n.value,validation:e=>f.required(e),computedValue:e=>e.map(a=>a.value),config:{footerBtns:[{name:s,slot:"end",onClickComponentEvents:{refreshOptions:()=>s.value==="Select All"?(n.value=P(),n):(n.value=w(),n)},onClick:()=>"None"}]}}],async(e,a)=>{const{year:t,quater:T,indicators:D}=a;i.value=t,c.value=T,p.value=D,l.value="Period: ".concat(t," Q").concat(T),u.dismiss(),b()},()=>{});k(()=>{g()}),N(n.value,e=>{e.every(a=>a.isChecked)?s.value="Deselect All":s.value="Select All"});const y=()=>R.push("/"),w=()=>n.value.map(a=>({...a,isChecked:!1})),P=()=>n.value.map(a=>({...a,isChecked:!0}));return{data:d,columns:C,subtitle:l,configure:g,generate:b,onFinish:y}}});function O(l,d,i,c,p,s){const o=h("v2Datatable"),m=h("ion-page");return q(),$(m,null,{default:x(()=>[I(o,{title:"TB Quarterly Treatment Outcomes Report",subtitle:l.subtitle,columnData:l.data,columns:l.columns,"on-finish":l.onFinish,"on-refresh":l.generate,"on-configure":l.configure,rowsPerPage:20,"report-prefix":"NTP"},null,8,["subtitle","columnData","columns","on-finish","on-refresh","on-configure"])]),_:1})}const Y=V(M,[["render",O]]);export{Y as default};
