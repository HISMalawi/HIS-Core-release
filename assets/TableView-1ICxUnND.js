import{d as te,i as ne,h as ae,ao as re,C as se,k as le,j as ie,f as ue,m as ce,l as de,bd as fe,an as pe,bk as he,bl as me,J as ye,K as $,M as B,a8 as ke,cb as ve,cc as ge,cd as Ce,ce as be,cf as Pe,cg as we,aZ as Se,S as K,ch as Ie,ab as Z,bm as Ve,ci as _e,_ as De,r as f,o as n,x as v,b as r,w as t,c as h,z as m,u as g,v as V,A as T,F,y as N,ar as $e}from"./index-LcKkVeBi.js";import{n as Te}from"./PopupKeyboard-iGZRraXb.js";import{F as Fe}from"./fuse-lCMBsAWg.js";import{a as ze,t as Re}from"./Export-6ZtfPpq7.js";import{H as Ee}from"./HisKeyboard-eull0vVi.js";import{Q as Be}from"./HisKbConfigurations-a7K7dizM.js";import{k as Ke}from"./KbHandler-oqPdZ1-Q.js";const Ne=te({components:{IonToolbar:ne,IonItem:ae,IonIcon:re,IonLabel:se,IonTitle:le,IonHeader:ie,IonButton:ue,IonFooter:ce,IonContent:de,IonButtons:fe,IonChip:pe,HisKeyboard:Ee,IonThumbnail:he,IonImg:me},props:{title:{type:String,default:"Report"},headerBadge:{type:Object},iconUrl:{type:String},subtitle:{type:String},columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},enablePagination:{type:Boolean,default:!0},rowsPerPage:{type:Number,default:10},onFinish:{type:Function},onRefresh:{type:Function},onConfigure:{type:Function},csvQuarter:{type:String},reportPrefix:{type:String,default:""}},setup(e){const c=ye(),_=$([]),y=$(0),P=$(""),D=$(""),w=$("desc"),L=$(!1),U=B(()=>{let o=_.value;return w.value&&D.value&&(o=Ie(_.value)[w.value](a=>a.data[D.value])),P.value?new Fe(o,{threshold:.3,keys:["searchIndex"],useExtendedSearch:!0}).search(P.value,{limit:e.rowsPerPage}).map(d=>d.item):o}),k=B(()=>Z.chunk(U.value,e.rowsPerPage).length),p=B(()=>y.value+2<=k.value),z=B(()=>y.value>0),H=B(()=>Z.chunk(U.value,e.rowsPerPage)[y.value]),Q=o=>{D.value=o,w.value=w.value==="asc"?"desc":"asc"},R=()=>Te(o=>{const a=parseInt(o);parseInt(o)<=k.value&&(y.value=a)},{title:"Select page"}),j=()=>y.value=0,Y=()=>y.value=k.value-1||0,W=()=>y.value+=1,q=()=>y.value-=1,G=()=>{typeof e.onFinish=="function"?e.onFinish():c.push("/")},s=o=>{var a,d;try{typeof((a=o.column)==null?void 0:a.tdClick)=="function"&&((d=o.column)==null||d.tdClick(o));return}catch(u){console.error(u)}},C=()=>e.columns.reduce((o,a)=>o.concat(a),[]).filter(o=>o.value||o.ref),l=o=>{var A,X,x;const a=C().filter(i=>[i.canExport?i==null?void 0:i.canExport[o]:!0,typeof i.exportable=="boolean"?i.exportable:!0].every(Boolean)),d=a.map(i=>i.exportedValue&&i.exportedValue.column?i.exportedValue.column(i):i.secondaryLabel||i.label),u=a.map(i=>i.ref),b=_.value.reduce((i,ee)=>{const oe=ee.row.filter(({column:I})=>u.includes(I.ref)).map(I=>I.column.exportedValue&&I.column.exportedValue.dataValue?I.column.exportedValue.dataValue(I):I.value);return[...i,oe]},[]),O="".concat(e.reportPrefix," ").concat((A=K.getLocationName())!=null?A:""," ").concat(Ve(e.title).replace(e.reportPrefix,"")," ").concat(_e((x=(X=e.csvQuarter)!=null?X:e.subtitle)!=null?x:""));return{headers:d,rows:b,filename:O}},E=()=>{const{headers:o,rows:a,filename:d}=l("pdf");ze([o],a,d,!0)},S=()=>{const{headers:o,rows:a,filename:d}=l("csv");Re([o],[...a,["Date Created: ".concat(Se().format("DD/MMM/YYYY HH:MM:ss"))],["Quarter: ".concat(e.csvQuarter||e.subtitle)],["HIS-Core Version: ".concat(K.getCoreVersion())],["API Version: ".concat(K.getApiVersion())],["Site UUID: ".concat(K.getSiteUUID())],["Generated by: ".concat(K.getUserName())]],d)},M=o=>{P.value=Ke(o,P.value),y.value=0},J=o=>{o.forEach(a=>{const d=C().map(u=>{let b="";const O=a[u.ref];try{Z.isEmpty(a)?b="...":typeof u.toValue=="function"?b="".concat(u.toValue(O)):typeof u.value=="function"?b=u.value(a):b=a[u.ref]||""}catch(A){b=(u==null?void 0:u.defaultValue)||"_ERROR_",console.error(A)}return{column:u,refData:O,value:b,data:a}});_.value.push({row:d,data:a,searchIndex:[...d,d.map(u=>u.value).join(" ")]})})};return ke(()=>e.columnData,o=>{if(_.value=[],!Array.isArray(o)||!o.length){y.value=0,P.value="",D.value="",J(Array.from({length:e.rowsPerPage}).map(()=>({})));return}J(o)},{immediate:!0,deep:!0}),{first:j,last:Y,next:W,prev:q,selectPage:R,sortColumn:Q,onClickTablecell:s,toPDF:E,toCSV:S,finish:G,filterTable:M,sync:ve,search:ge,close:Ce,arrowUp:be,arrowDown:Pe,funnelOutline:we,page:H,canNext:p,searchTerm:P,totalPages:k,sortOrder:w,canPrev:z,currentPage:y,columnSorted:D,QWERTY:Be,showSearchKeyboard:L}}}),Ue={key:0},He={class:"his-sm-text"},Me={class:"art-report-theme"},Oe={class:"stick-report-header"},Ae=["colspan","rowspan","onClick"],Le=["onClick"],Qe={class:"his-sm-text"};function je(e,c,_,y,P,D){const w=f("ion-img"),L=f("ion-thumbnail"),U=f("ion-title"),k=f("ion-icon"),p=f("ion-button"),z=f("ion-label"),H=f("ion-chip"),Q=f("ion-buttons"),R=f("ion-toolbar"),j=f("ion-header"),Y=f("ion-item"),W=f("ion-content"),q=f("his-keyboard"),G=f("ion-footer");return n(),v(F,null,[r(j,null,{default:t(()=>[r(R,null,{default:t(()=>[e.iconUrl?(n(),h(L,{key:0,slot:"start"},{default:t(()=>[r(w,{src:e.iconUrl},null,8,["src"])]),_:1})):m("",!0),r(U,{slot:"start",class:"his-md-text"},{default:t(()=>[g(V(e.title)+" ",1),e.subtitle?(n(),v("br",Ue)):m("",!0),T("span",He,V(e.subtitle),1)]),_:1}),r(Q,{slot:"end"},{default:t(()=>[typeof e.onConfigure=="function"?(n(),h(p,{key:0,onClick:c[0]||(c[0]=()=>e.onConfigure?e.onConfigure():null)},{default:t(()=>[r(k,{size:"large",icon:e.funnelOutline},null,8,["icon"])]),_:1})):m("",!0),e.searchTerm?(n(),h(H,{key:1,onClick:c[1]||(c[1]=()=>{e.searchTerm="",e.showSearchKeyboard=!1}),class:"his-md-text",color:"primary"},{default:t(()=>[r(z,null,{default:t(()=>[g(V(e.searchTerm?"Search: ".concat(e.searchTerm):""),1)]),_:1}),r(k,{icon:e.close},null,8,["icon"])]),_:1})):m("",!0),r(p,{color:e.showSearchKeyboard?"primary":"dark",onClick:c[2]||(c[2]=()=>e.showSearchKeyboard=!e.showSearchKeyboard),size:"large"},{default:t(()=>[r(k,{size:"large",icon:e.search},null,8,["icon"])]),_:1},8,["color"]),typeof e.onRefresh=="function"?(n(),h(p,{key:2,onClick:c[3]||(c[3]=()=>e.onRefresh?e.onRefresh():null),color:"success",size:"large"},{default:t(()=>[r(k,{size:"large",icon:e.sync},null,8,["icon"])]),_:1})):m("",!0)]),_:1})]),_:1}),(e.headerBadge||[]).length?(n(),h(R,{key:0,color:"light"},{default:t(()=>[(n(!0),v(F,null,N(e.headerBadge,(s,C)=>(n(),h(H,{onClick:l=>typeof s.action=="function"?s.action():null,key:C,color:(s==null?void 0:s.color)||"dark"},{default:t(()=>[r(k,{icon:(s==null?void 0:s.icon)||e.search},null,8,["icon"]),r(z,{innerHTML:s==null?void 0:s.text},null,8,["innerHTML"])]),_:2},1032,["onClick","color"]))),128))]),_:1})):m("",!0)]),_:1}),r(W,{"scroll-y":"","scroll-x":""},{default:t(()=>[T("table",Me,[T("thead",Oe,[(n(!0),v(F,null,N(e.columns,(s,C)=>(n(),v("tr",{key:C},[(n(!0),v(F,null,N(s,(l,E)=>{var S,M;return n(),v("th",{key:E,colspan:((S=l==null?void 0:l.span)==null?void 0:S.thColspan)||1,rowspan:((M=l==null?void 0:l.span)==null?void 0:M.thRowspan)||1,onClick:J=>e.sortColumn(l.ref)},[r(Y,{lines:"none"},{default:t(()=>[e.columnSorted&&e.columnSorted===l.ref?(n(),h(k,{key:0,icon:e.sortOrder==="asc"?e.arrowUp:e.arrowDown},null,8,["icon"])):m("",!0),r(z,{class:"ion-text-center"},{default:t(()=>[T("b",null,V(l.label),1)]),_:2},1024)]),_:2},1024)],8,Ae)}),128))]))),128))]),T("tbody",null,[(n(!0),v(F,null,N(e.page,(s,C)=>(n(),v("tr",{key:C},[(n(!0),v(F,null,N(s.row,(l,E)=>{var S;return n(),v("td",{key:E,onClick:()=>e.onClickTablecell(l),class:$e({"clickable-cell":(S=l==null?void 0:l.column)==null?void 0:S.tdClick})},[T("span",Qe,V(l.value),1)],10,Le)}),128))]))),128))])])]),_:1}),r(G,null,{default:t(()=>[e.showSearchKeyboard?(n(),h(q,{key:0,kbConfig:e.QWERTY,onKeyPress:e.filterTable},null,8,["kbConfig","onKeyPress"])):m("",!0),r(R,{color:"dark"},{default:t(()=>[r(p,{onClick:c[4]||(c[4]=s=>e.toCSV()),size:"large"},{default:t(()=>[g(" CSV ")]),_:1}),r(p,{onClick:c[5]||(c[5]=s=>e.toPDF()),size:"large"},{default:t(()=>[g(" PDF ")]),_:1}),e.totalPages>1?(n(),h(p,{key:0,onClick:e.first,disabled:e.currentPage===0||e.totalPages<=2,size:"large",slot:"end"},{default:t(()=>[g(" First ")]),_:1},8,["onClick","disabled"])):m("",!0),e.totalPages>1?(n(),h(p,{key:1,onClick:e.prev,disabled:!e.canPrev,color:"light",size:"large",slot:"end"},{default:t(()=>[g(" Prev ")]),_:1},8,["onClick","disabled"])):m("",!0),e.totalPages>1?(n(),h(p,{key:2,onClick:e.selectPage,size:"large",slot:"end",color:"light"},{default:t(()=>[g(V(e.currentPage)+" / "+V(e.totalPages-1),1)]),_:1},8,["onClick"])):m("",!0),e.totalPages>1?(n(),h(p,{key:3,onClick:e.next,disabled:!e.canNext,color:"light",size:"large",slot:"end"},{default:t(()=>[g(" Next ")]),_:1},8,["onClick","disabled"])):m("",!0),e.totalPages>1?(n(),h(p,{key:4,onClick:e.last,disabled:e.currentPage+1>=e.totalPages||e.totalPages<=2,size:"large",slot:"end"},{default:t(()=>[g(" Last ")]),_:1},8,["onClick","disabled"])):m("",!0),r(p,{onClick:e.finish,color:"success",size:"large",slot:"end"},{default:t(()=>[g(" Finish ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const xe=De(Ne,[["render",je],["__scopeId","data-v-540e223c"]]);export{xe as v};
