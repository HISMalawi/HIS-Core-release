import{d as D,ao as t,aV as h,ad as u,ae as p,H as r,aW as m,aw as f,R as c,W as d,ak as S,aa as y,c as _,af as w,a as B}from"./index-CMZASHAR.js";import{H as $}from"./HisStandardForm-BCjM4-bc.js";const b=D({components:{HisStandardForm:$},data:()=>({apiDate:"",fields:[]}),async created(){this.apiDate=await t.getApiDate(),this.fields=h({id:"session_date",helpText:"Session Date",required:!0,minDate:()=>"2000-01-01",maxDate:()=>this.apiDate,estimation:{allowUnknown:!1},computeValue:e=>e,config:{footerBtns:[{name:"Reset",slot:"end",color:"success",state:{visible:{default:()=>t.isBDE()}},onClick:async()=>{await this.resetSessionDate()}}]}}),this.fields=[...this.fields,{id:"reason_for_bde",helpText:"Please select a reason for changing session date",type:u.TT_SELECT,validation:e=>p.required(e),computedValue:e=>e.value,options:()=>[{label:"Backlog clearance",value:"Backlog clearance"},{label:"System was down",value:"System was down"},{label:"Data error correction",value:"Data error correction"}]}]},async mounted(){await this.showBdeNotice()},methods:{async showBdeNotice(){if(!t.isBDE())return;const e=r.toStandardHisDisplayFormat(t.getCachedApiDate()||""),s=r.toStandardHisDisplayFormat(t.getSessionDate()),a=await m("BDE Notice","The system is currently in Back Data Entry Mode(BDE).                 Do you wish to reset the date to ".concat(e,"?"),"BDE Date: ".concat(s),[{name:"Reset Date",slot:"start",color:"success"},{name:"Keep BDE Date",slot:"end",color:"danger"},{name:"New date",slot:"end"}]);if(a==="Reset Date")return await this.resetSessionDate();a==="Keep BDE Date"&&this.redirect()},async resetSessionDate(){try{await t.resetSessionDate(),f.invalidate("PROVIDERS"),c("Session date has been reset to ".concat(this.formatDate(this.apiDate))),this.redirect()}catch(e){d("".concat(e))}},redirect(){const e=this.$route.query.patient_dashboard_redirection_id;e?this.$router.push("/patient/dashboard/".concat(e)):this.$router.back()},async onSubmit(e,s){var o,n;const a=s.session_date;try{await t.setSessionDate(a,s.reason_for_bde),c("Successfully Back dated to ".concat(this.formatDate(a)));const i=(n=(o=this.$route)==null?void 0:o.query)==null?void 0:n.patient_id;i?S(i,this.$router):this.redirect()}catch(i){d("".concat(i))}},formatDate(e){return r.toStandardHisDisplayFormat(e)}}});function k(e,s,a,o,n,i){const l=w("his-standard-form");return B(),_(l,{skipSummary:!0,fields:e.fields,onOnFinish:e.onSubmit},null,8,["fields","onOnFinish"])}const v=y(b,[["render",k]]);export{v as default};
