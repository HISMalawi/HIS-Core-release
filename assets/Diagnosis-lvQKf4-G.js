import{d as P,K as A,b5 as I,cV as f,V as r,o as g,c as O,w as Y,b as h,cl as R,b9 as B,ad as v,cW as U,cX as y,cY as C,ag as M,I as D}from"./index-BCTN_bnC.js";import{F as l}from"./dynamic-import-helper-BkBZiFw5.js";import{H as X}from"./HisStandardForm-CaDwl-hA.js";import{u as w}from"./useEncounter-CDUT-p5Y.js";import{g as t,a as V}from"./util-CyjuS_4X.js";import{r as x}from"./commons-BDvZ1JFN.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./isEmpty-OXtHK5dz.js";import"./_Set-VKtKUQAI.js";import"./_setToArray-BLmuRUHx.js";import"./encounter_guidelines-DZpIPlYY.js";import"./GuidelineEngine-D6V1_Znr.js";const oe=P({__name:"Diagnosis",setup(F){const _=A([]),a=new I(-1,f.DIAGNOSIS),m=A(),{goToNextTask:b,patientDashboardUrl:E,facts:N}=w((i,c,p)=>{a.patientID=c,a.providerID=i,m.value=p;const u=()=>{const e=[["Infiltration","PULMONARY_TB"],["Tuberculosis Miliary","PULMONARY_TB"],["Opacification","PULMONARY_TB"],["Consolidation","PULMONARY_TB"],["Cavitation","PULMONARY_TB"],["Hilar Lymphadenopathy","EXTRA_PULMONARY_TB"],["Tuberculosis Meningitis","EXTRA_PULMONARY_TB"],["Lymphadenitis","EXTRA_PULMONARY_TB"],["Osteoarticular","EXTRA_PULMONARY_TB"],["Gastrointestinal","EXTRA_PULMONARY_TB"],["Pleural Effusion","EXTRA_PULMONARY_TB"],["Tuberculosis Spine","EXTRA_PULMONARY_TB"]];return{id:"procedureType",helpText:"Procedure Type:",requireNext:!1,type:l.TT_SELECT,validation:o=>r.required(o),computedValue:o=>[{concept_id:t("PROCEDURE_TYPE"),value_coded:t("".concat(o.value)),obs_datetime:a.date},{concept_id:t("CLINICALLY_DIAGNOSED"),value_coded:t("YES_ANSWER"),obs_datetime:a.date}],options:()=>[{value:"ULTRASOUND",label:"Ultrasound Scanning",other:{procedures:[["Pleural Effusion","EXTRA_PULMONARY_TB"],["Pericardial Effusion","EXTRA_PULMONARY_TB"],["Abdominal Tuberculosis","EXTRA_PULMONARY_TB"],["Tuberculosis Ascites","EXTRA_PULMONARY_TB"]]}},{value:"X_RAY",label:"X-Ray",other:{procedures:e}},{value:"CLINICAL",label:"Clinical",other:{procedures:e}}]}},d=()=>({id:"tbStatus",helpText:"TB Present?",type:l.TT_SELECT,computedValue:e=>({concept_id:t("TB_STATUS"),value_coded:t(e.value),obs_datetime:a.date}),validation:e=>r.required(e),options:()=>[{value:"POSITIVE",label:"Yes"},{value:"NEGATIVE",label:"No"}],requireNext:!1}),s=()=>({id:"tbStrain",helpText:"Type of TB:",type:l.TT_MULTIPLE_SELECT,computedValue:e=>[...e.map(n=>({concept_id:t("TUBERCULOSIS_CLASS"),value_coded:t("".concat(n.label)),obs_datetime:a.date})),{concept_id:t("TB_TYPE"),value_coded:t("".concat(e[0].value)),obs_datetime:a.date}],validation:e=>r.required(e),condition:e=>e.tbStatus.value==="POSITIVE"&&e.procedureType.other.procedures.length,options:e=>e.procedureType.other.procedures.map(([o,n])=>({label:o,value:n}))}),S=()=>({id:"drugResistance",helpText:"Clinically enroll patient for:",type:l.TT_SELECT,validation:e=>r.required(e),condition:e=>e.tbStatus.value==="POSITIVE",options:()=>[{value:"NO_ANSWER",label:"Firstline treatment"},{value:"YES_ANSWER",label:"DR TB treatment"}]}),T=()=>({id:"resistantTo",helpText:"Suspected drug resistance to:",type:l.TT_MULTIPLE_SELECT,computedValue:e=>{const o=e.map(n=>({concept_id:t("TB_DRUG_RESISTANT"),value_coded:V("".concat(n.value)),obs_datetime:a.date}));return o.length>1?o.push({concept_id:t("Resistance classification"),value_coded:t("Multi drug resistant"),obs_datetime:a.date}):o.length===1&&o.push({concept_id:t("Resistance classification"),value_coded:t("Mono drug resistant"),obs_datetime:a.date}),o},validation:e=>r.required(e),condition:e=>e.drugResistance.value==="YES_ANSWER",options:()=>[{value:"Rifampicin",label:"Rifampicin"},{value:"Isoniazid",label:"Isoniazid"}]});_.value=[u(),d(),s(),S(),T()]});async function L(i,c){var u,d;if(((u=i==null?void 0:i.drugResistance)==null?void 0:u.value)=="YES_ANSWER"){const s=new B(a.patientID);if(await v("Drug resistance detected","Client is resistant to one or more standard TB drugs","Do you want to enroll client in the Drug resistance program?",[{name:"Yes",slot:"start",color:"success"},{name:"No",slot:"end",color:"danger"}])==="Yes"){try{await s.enrollProgram()}catch(T){console.warn("".concat(T))}s.setStateDate(a.date),s.setStateId(U.MDR),await s.updateState()}}const p=await x(c);if(await a.createEncounter(),await a.saveObservationList(p),((d=i.tbStatus)==null?void 0:d.value)==="NEGATIVE"&&!y.isOnTreatment(N.outcome)&&m.value.getAge()>C)return await v("Notice","Client is TB Negative!","Would you like to retest client?",[{name:"Yes",slot:"start",color:"success"},{name:"No",slot:"end",color:"danger"}])==="No"?M.push(E.value):location.reload();b()}return(i,c)=>(g(),O(R(D),null,{default:Y(()=>[h(X,{cancelDestinationPath:R(E),onFinishAction:L,fields:_.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{oe as default};
