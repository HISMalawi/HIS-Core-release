System.register(["./index-legacy-D1EyWbyq.js","./disaggregated_service-legacy-MlobubUf.js","./TableView-legacy-NwqRzvee.js","./ArtDrilldown-legacy-CzSNtMg3.js","./regimen_report_service-legacy-VHyTIMHt.js","./moh_cohort_service-legacy-WDLCn8sj.js","./ReportErrors-legacy-CTsWmVCa.js","./PopupKeyboard-legacy-CRDw2Fsm.js","./SIngleTouchField-legacy-25qOOxkK.js","./dynamic-import-helper-legacy-DYK5bIOV.js","./TouchScreenForm-legacy-Cz0UXr2y.js","./ToolbarMediumCard-legacy-DG4P2wyL.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-Dt6qML7b.js","./HisKeypad-legacy-CAd1Sv_G.js","./BaseKeyboard-legacy-DNjRE9bC.js","./KbLayouts-legacy-BKvPSxzZ.js","./KbHandler-legacy-De8o5nTq.js","./fuse-legacy-CQoBB3MK.js","./Export-legacy-dCfnaBFd.js","./HisKeyboard-legacy-y6nW788Z.js","./HisKbConfigurations-legacy-vrLd9Pgz.js"],(function(e,a){"use strict";var r,t,o,n,l,s,g,c,u,i,d,p,y,b,m,f,v,h,_,j,D,w,F,A,x,P,$,q,R,G,T;return{setters:[e=>{r=e.d,t=e.I,o=e.c4,n=e.K,l=e.E,s=e.N,g=e.cb,c=e.a9,u=e.n,i=e.q,d=e.cz,p=e.t,y=e.c6,b=e.O,m=e.ab,f=e.c5,v=e.c7,h=e.c9,_=e.c8,j=e._,D=e.r,w=e.o,F=e.c,A=e.w,x=e.b},e=>{P=e.D},e=>{$=e.v},e=>{q=e.A},e=>{R=e.R},e=>{G=e.M},e=>{T=e.R},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){const a=r({components:{IonPage:t,IonLoading:o,v2Datatable:$},setup(){const e=n(!1),a=n([]),r=n(""),t=n(""),o=n(!1),j=new P,D=new G,w=n([]),F=l(),A=async e=>{(await b.create({component:q,backdropDismiss:!1,cssClass:"large-modal",componentProps:{...e,subtitle:r.value,onFinish:()=>b.getTop().then((e=>e&&b.dismiss()))}})).present()},x=(e,a)=>({ref:a,label:e,defaultValue:"0",toValue:e=>e.length,tdClick:async e=>{e.refData.length&&A({patientIdentifiers:e.refData,title:`${e.data.age_group} ${e.data.gender} ${e.column.label}`})}}),$=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},x("TX curr (receiving ART)","tx_curr"),...R.reduce(((e,a)=>[...e,x(a,a)]),[]),x("Unknown","N/A"),x("Total (regimen)","regimen_total")]],B=[...R,"N/A"].reduce(((e,a)=>({...e,[a]:[]})),{}),M=function(e){const a=w.value.findIndex((a=>a.id===e.id));-1!==a?w.value[a]=e:w.value.push(e)},O=async function(e){const a="validationErrors";(await b.create({id:a,component:T,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:e}})).present(),M({id:a,text:`<b>${e.length}</b> validation errors detected`,icon:h,color:"danger",action:()=>O(e)})},k=async(r=!1)=>{if(!e.value)return i("Unable to generate report, return to cohort report");o.value=!0;const n=["Pregnant","Breastfeeding"],l={F:{label:"Female",rows:[],aggregate:{},excludedAgeGroups:n},M:{label:"Male",rows:[],aggregate:{},excludedAgeGroups:n},FP:{label:"Pregnant",rows:[],aggregate:{},gender:"F",ageGroup:"All",genderDisplay:"FP",excludedAgeGroups:[...d,"Breastfeeding"]},FBF:{label:"Breastfeeding",rows:[],aggregate:{},gender:"F",ageGroup:"All",genderDisplay:"FBF",excludedAgeGroups:[...d,"Pregnant"]}},s=(e=!1)=>{const r=Object.keys(l.FP.aggregate).reduce(((e,a)=>({...e,[a]:[...l.FP.aggregate[a]||[],...l.FBF.aggregate[a]||[]]})),{}),o=Object.keys(l.F.aggregate).reduce(((e,a)=>({...e,[a]:e[a].filter((e=>!Array.isArray(r[a])||!r[a].includes(e)))})),l.F.aggregate);a.value=[...l.F.rows,...l.M.rows,{age_group:"All",gender:"Male",...l.M.aggregate},...l.FP.rows,{age_group:"All",gender:"FNP",...o},...l.FBF.rows];const n=m.uniq([...l.M.aggregate.tx_curr||[],...l.F.aggregate.tx_curr||[]]),s={text:`Total alive and on ART: <b>${n.length}</b>`,icon:f,color:"primary",action:()=>A({patientIdentifiers:n,title:`Total alive and on ART: ${n.length}`})};e?(w.value=[s],(async e=>{const a={total_alive_and_on_art:{param:e.length,check:(e,a)=>e!=a,error:(e,a)=>`\n                        Total alive of <b>${a}</b>\n                        Does not match total alive of <b>${e}</b> on MOH report\n                    `}};-1===D.validateIndicators(a,(e=>{e.length?O(e):M({id:"reportOk",text:"<b>Report is consistent</b>",icon:_,color:"success"})}))&&O(["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])})(n)):w.value=[s,{text:t.value,icon:v,color:"dark"}]};try{if(j.setRebuildOutcome(r),!(await j.init()))return p("Unable to initialise report");for(const e of[...d,...n]){t.value=`Processing <b>${e}</b>`,j.setAgeGroup(e);const a=await j.getCohort();j.setRebuildOutcome(!1);for(const r of Object.keys(l)){if((l[r].excludedAgeGroups||[]).includes(e))continue;j.setGender(r),l[r].ageGroup&&j.setAgeGroup(l[r].ageGroup);const t=await j.getRegimenDistribution(),o={age_group:l[r]?.ageGroup||e,gender:l[r]?.genderDisplay||l[r].label,...a[e]?a[e][l[r]?.gender||r]:{},...B,...t,regimen_total:Object.values(t).flat(1)};l[r].rows.push(o),l[r].aggregate=Object.keys(o).reduce(((e,a)=>Array.isArray(o[a])?{...e,[a]:[...e[a]||[],...o[a]]}:e),l[r].aggregate),s(!1)}}s(!0),a.value=a.value.map(((e,a)=>({index:a+1,...e})))}catch(g){const e="Unable to generate report!";i(e),w.value=[{text:e,color:"danger",icon:y,action:function(){w.value=[{text:`Exception occured: <b>${g}</b>`,color:"danger",icon:y}]}}]}o.value=!1,t.value=""};return s((()=>{e.value=!!(F.query.start_date&&F.query.end_date&&F.query.quarter),e.value&&(j.setStartDate(`${F.query.start_date}`),j.setEndDate(`${F.query.end_date}`),j.setOccupation(`${F.query.occupation}`),D.setOccupation(j.occupation),D.setStartDate(j.startDate),D.setEndDate(j.endDate),r.value=`${g(j.startDate)} to ${g(j.endDate)}`,F.query.quarter&&(j.setQuarter(`${F.query.quarter}`),D.setQuarter(j.quarter),r.value=`${"Custom"===j.quarter?r.value:j.quarter}`),k())})),{Img:c,onRegenerate:async()=>k(await u("Do you want to rebuild report?")),headerBadge:w,reportData:a,isLoading:o,generate:k,columns:$,period:r}}});e("default",j(a,[["render",function(e,a,r,t,o,n){const l=D("ion-loading"),s=D("v2Datatable"),g=D("ion-page");return w(),F(g,null,{default:A((()=>[x(l,{"is-open":e.isLoading,message:"Please wait.."},null,8,["is-open"]),x(s,{"icon-url":e.Img("login-logos/Malawi-Coat_of_arms_of_arms.png"),title:"Disaggregated report","report-prefix":"MoH",subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onRefresh:e.onRegenerate,headerBadge:e.headerBadge},null,8,["icon-url","subtitle","columns","columnData","onRefresh","headerBadge"])])),_:1})}]]))}}}));
