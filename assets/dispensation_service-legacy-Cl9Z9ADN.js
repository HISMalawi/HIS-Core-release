System.register(["./index-legacy-CFSeLXed.js","./drug_order_service-legacy-NpBaoKJh.js"],(function(r,t){"use strict";var e,s,n,a,i;return{setters:[r=>{e=r.S,s=r.ae,n=r.bd,a=r.cB},r=>{i=r.D}],execute:function(){class t extends e{constructor(){super()}static async fetchAvailableDrugStock(r){const t=await this.getJson("pharmacy/items",{drug_id:r});if(!s.isEmpty(t))return t.map((r=>({quantity:r.current_quantity,packSize:r.pack_size})))}}const u={11:[30],21:[25],22:[60],24:[30,60,90,100],30:[90],39:[60],73:[120],74:[60],76:[1e3],297:[30,60,90],576:[30,60,90],613:[60],731:[60],732:[60],733:[60],734:[30],735:[30],736:[60],738:[60],931:[12,30,60],932:[30],954:[60],963:[30,60,90],968:[60],969:[30],971:[30,60,90],976:[60],977:[30],982:[30],983:[30,90],1039:[30,60,90],1043:[60],1044:[30],1056:[24],1216:[3,6,8,12]};r("D",class extends n{drugHistory;currentDrugOrder;useDrugManagement;constructor(r,t){super(r,54,t),this.drugHistory=[],this.currentDrugOrder=[],this.useDrugManagement=!1}setIsDrugManagementEnabled(r){this.useDrugManagement=r}async loadDrugManagementEnabled(){this.useDrugManagement=await a.drugManagementEnabled()}getDrugHistory(){return this.drugHistory}getCurrentOrder(){return this.currentDrugOrder}buildDispensations(r,t,e){const s=[];for(let n=0;n<e;n++)s.push({drug_order_id:r,date:this.date,quantity:t/e});return s}saveDispensations(r){return n.postJson("/dispensations",{dispensations:r,program_id:n.getProgramID()})}async voidOrder(r){return n.void(`/dispensations/${r}`,{})}async loadDrugHistory(){try{this.drugHistory=await i.getDrugOrderHistory(this.patientID)||[]}catch(r){console.warn(r)}}async loadCurrentDrugOrder(){if(this.currentDrugOrder=await i.getDrugOrders(this.patientID)||[],this.useDrugManagement)for(const r of this.currentDrugOrder)r.stocks=await t.fetchAvailableDrugStock(r.drug.drug_id)}getDrugPackSizes(r){return r in u?u[r]:[30,60,90]}calcCompletePack(r,t){const e=r.barcodes.sort(((r,t)=>r.tabs-t.tabs));if(0==e.length||0==t)return t;for(const s in e){const{tabs:r}=e[s];if(parseInt(r)>=t)return r}return parseInt(e[e.length-1].tabs)}})}}}));
