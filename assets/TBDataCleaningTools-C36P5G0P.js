var _=Object.defineProperty;var D=(t,e,a)=>e in t?_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var i=(t,e,a)=>D(t,typeof e!="symbol"?e+"":e,a);import{S as n,d as N,I as R,L as o,ag as d,ae as u,H as w,_ as E,r as h,o as I,c as f,w as O,b as U}from"./index-C-Wf7IuL.js";import{_ as b}from"./ReportMixin.vue_vue_type_script_lang-CpdduB4B.js";import{R as A}from"./TableReportTemplate-Cz1KFSL9.js";import"./BasicReportTemplate-Cc49lyqN.js";import"./Export-DKDjU6pH.js";import"./Pagination-B9dk3trL.js";import"./HisStandardForm-zCup__or.js";import"./ReportErrors-IEoA-8zb.js";class p extends n{constructor(){super();i(this,"programID");i(this,"startDate");i(this,"endDate");i(this,"date");this.startDate="",this.endDate="",this.date=n.getSessionDate(),this.programID=n.getProgramID()}setStartDate(a){this.startDate=a}setEndDate(a){this.endDate=a}buildRequestParams(a){const s={};return this.startDate&&(s.start_date=this.startDate),this.endDate&&(s.end_date=this.endDate),this.date&&(s.date=this.date),this.programID&&(s.program_id=this.programID),{...s,...a}}}var r=(t=>(t.WITHOUT_PROGRAM="WITHOUT PROGRAM",t.WITHOUT_TB_NUMBER="WITHOUT TB NUMBER",t.BAD_TB_NUMBER="BAD TB NUMBER",t.IN_TREATMENT_BUT_COMPLETED="IN TREATMENT BUT COMPLETED",t.WITH_DISPENSATION_ANOMALIES="WITH DISPENSATION ANOMALIES",t.WITH_UNKNOWN_OUTCOME="WITH UNKNOWN OUTCOME",t.WITH_DUPLICATE_TB_NUMBER="WITH DUPLICATE TB NUMBER",t))(r||{});class B extends p{constructor(){super()}getDataToolReport(e){return p.getJson("tb_data_cleaning_tools",this.buildRequestParams({context:e}))}}const M=N({mixins:[b],components:{ReportTemplate:A,IonPage:R},data:()=>({title:"Data cleaning report",rows:[],columns:[[o.thTxt("National ID"),o.thTxt("TB Number"),o.thTxt("Name"),o.thTxt("Gender"),o.thTxt("Birthdate"),o.thTxt("Residence"),o.thTxt("State")]],defaultIndicator:{}}),created(){this.fields=[...d({id:"start_date",helpText:"Start",required:!0,minDate:()=>"2000-01-01",maxDate:()=>n.getSessionDate(),computeValue:t=>t,estimation:{allowUnknown:!1}}),...d({id:"end_date",helpText:"End",required:!0,minDate:()=>"2000-01-01",maxDate:()=>n.getSessionDate(),computeValue:t=>t,estimation:{allowUnknown:!1}})],this.defaultIndicator=u.find(this.getIndicatorOptions(),{label:this.$route.query.case})||null},methods:{async onPeriod(t,e){const a=m=>w.toStandardHisDisplayFormat(m);this.rows=[];const s=this.defaultIndicator;this.title=s.label,this.columns=s.other.columns,this.report=new B,this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period="".concat(a(e.start_date)," - ").concat(a(e.end_date));const l=await this.report.getDataToolReport(s.value);console.log(s,l),u.isNull(l)||(this.rows=await Promise.all(l.map(m=>s.other.formatRow(m))))},mapRow(t){return[o.td(t.identifier||"N/A"),o.td(t.tb_number||"N/A"),o.tdLink(t.name,()=>this.$router.push({path:"/patient/dashboard/".concat(t.patient_id)})),o.td(t.gender||"N/A"),o.td(t.birthdate||"N/A"),o.td(t.residence||"N/A"),o.td(t.state||"N/A")]},getIndicatorOptions(){return[{label:"without program",value:r.WITHOUT_PROGRAM,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"with duplicate tb number",value:r.WITH_DUPLICATE_TB_NUMBER,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"with unknown outcome",value:r.WITH_UNKNOWN_OUTCOME,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"with dispensation anomalies",value:r.WITH_DISPENSATION_ANOMALIES,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"in treatment but completed",value:r.IN_TREATMENT_BUT_COMPLETED,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"bad tb number",value:r.BAD_TB_NUMBER,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"without tb number",value:r.WITHOUT_TB_NUMBER,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}}]}}});function S(t,e,a,s,l,m){const T=h("report-template"),c=h("ion-page");return I(),f(c,null,{default:O(()=>[U(T,{title:t.title,period:t.period,rows:t.rows,fields:t.fields,columns:t.columns,showFilters:!0,onReportConfiguration:t.onPeriod},null,8,["title","period","rows","fields","columns","onReportConfiguration"])]),_:1})}const k=E(M,[["render",S]]);export{k as default};
