import{H as E}from"./HisStandardForm-tUhdyeHF.js";import{b5 as I,d as A,K as D,V as n,t as l,o as R,c as S,cl as h,R as w,P as x,cB as V}from"./index-DxdybAew.js";import{F as o}from"./dynamic-import-helper-Bsjrd6Ro.js";import{g as C}from"./LocationFieldOptions-B2-r49Wv.js";import{C as F}from"./KbLayouts-VRA-vjeH.js";import{u as P}from"./useEncounter-CpOWiVP9.js";import{y as u,r as L}from"./commons-0sI1CNDl.js";import"./TouchScreenForm-CWGDOcQm.js";import"./ToolbarMediumCard-DpQmY2Av.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-Bxq2iSVB.js";import"./isEmpty-BePHYv51.js";import"./_Set-CstwZxlv.js";import"./_setToArray-CTPwtLZz.js";import"./encounter_guidelines-C9OjyTHu.js";import"./GuidelineEngine-D6V1_Znr.js";class O extends I{constructor(i,a){super(i,104,a)}}const ee=A({__name:"Registration",setup(c){let i,a;const s=D([]),{goToNextTask:p,patientDashboardUrl:d}=P((e,t,r)=>{a=r,i=new O(t,e),s.value=[T(),_(),g(),b(),y()]});async function f(e,t){if(await m(e),!await i.createEncounter())return l("Unable to create registration encounter");const N=await L({...t});if(!await i.saveObservationList(N))return l("Unable to save observations");p()}async function m(e){const t=e.national_id_available,r=e.national_id;t&&t.value==="Yes"&&(await a.updateMWNationalId(r.value),w.invalidate("ACTIVE_PATIENT"))}async function v(e){return e?(await x.findByOtherID(V,e)).length>0:!1}function T(){return{id:"visit_type",helpText:"Type of visit",type:o.TT_SELECT,validation:e=>n.required(e),computedValue:e=>({obs:i.buildValueCoded("Type of visit",e.value)}),options:()=>[{label:"New",value:"New patient"},{label:"Referral",value:"Referral"},{label:"Re-visiting",value:"Re-visiting"}]}}function _(){return{id:"referring_facility_name",helpText:"Referred from",type:o.TT_SELECT,validation:e=>n.required(e),computedValue:({label:e})=>({obs:i.buildValueText("Referred from",e)}),condition:e=>e.visit_type.value==="Referral",options:(e,t="")=>C(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}}}function g(){return{id:"national_id_available",helpText:"National ID Available",type:o.TT_SELECT,validation:e=>n.required(e),condition:()=>a.getMWNationalID()==="Unknown",options:()=>u(),appearInSummary:()=>!1}}function b(){return{id:"national_id",helpText:"Enter National ID",type:o.TT_TEXT,validation:e=>n.isMWNationalID(e),condition:e=>e.national_id_available.value==="Yes",beforeNext:async e=>e.value&&await v(e.value.toString())?(l("National ID already exists"),!1):!0,summaryMapValue:({value:e})=>({value:e,label:"National ID"}),config:{casing:"uppercase",customKeyboard:[F,[["Delete"]]]}}}function y(){return{id:"patient_pregnant",helpText:"Patient pregnant",type:o.TT_SELECT,validation:e=>n.required(e),computedValue:({value:e})=>({obs:i.buildValueCoded("PATIENT PREGNANT",e)}),condition:()=>a.isChildBearing(),options:()=>u()}}return(e,t)=>(R(),S(E,{cancelDestinationPath:h(d),fields:s.value,onFinishAction:f},null,8,["cancelDestinationPath","fields"]))}});export{ee as default};
