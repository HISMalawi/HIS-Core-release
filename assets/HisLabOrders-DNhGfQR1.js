import{d as $,H as d,et as C,eu as I,ev as T,aE as B,i as F,c1 as H,dG as P,p as z,y as A,q as y,z as E,a_ as L,cw as c,S as g,aw as V,am as N,ar as f,a as R,b as l,w as u,g as t,h as m,a9 as w,aa as b,t as n,j as x,aP as G,e as a,ak as j,al as q}from"./index-qFt4YszW.js";import{L as M}from"./LabOrderModal-DuBLHloA.js";import{_ as W}from"./FieldMixin.vue_vue_type_script_lang-BY_wT7wI.js";import{p as Y}from"./VoidReason-DKlt9liP.js";import"./lab_order_service-EUN9C6_8.js";const J=$({components:{ViewPort:H,IonButton:F,IonIcon:B},mixins:[W],data:()=>({trash:T,print:I,pencil:C,HisDate:d,rows:[],fetchingOrders:!1,ordersToday:{}}),methods:{async init(){this.$emit("onFieldActivated",this),this.fetchingOrders=!0;let e=[];try{e=await this.options(this.fdata)}catch(s){console.error("".concat(s))}this.fetchingOrders=!1;const r=e[0].other.values;this.ordersToday=r.reduce((s,i)=>(c(i.ordered)===c(g.getSessionDate())&&!i.result.length&&(s[i.test_name]=!0),s),{}),this.rows=r.map(s=>(s.id=s.order_id,s.ordered&&(s.ordered=d.toStandardHisDisplayFormat(s.ordered)),s.released&&(s.released=d.toStandardHisDisplayFormat(s.released)),s))},async printOrder(e){var r;if(c(e.ordered)!=c(g.getSessionDate()))return y("Printing order #".concat(e.accession_number," is restricted to today. Consider using BDE mode/set session date to the order date"));typeof((r=this.config)==null?void 0:r.printOrder)=="function"&&await V("Do you want to print order with accession number ".concat(e.accession_number,"?"))&&this.config.printOrder(e.id)},formatOrders(e){return e.map(r=>({id:r.order_id,encounter_id:r.encounter_id,result_given:r.result_given,accession_number:r.accession_number,test_name:r.tests[0].name,specimen:r.specimen.name,ordered:d.toStandardHisDisplayFormat(r.order_date),result:[],release:""}))},async launchOrderSelection(e=null){if(this.fetchingOrders)return y("Please wait....");const r=await E.create({component:M,backdropDismiss:!1,cssClass:"large-modal",componentProps:{testFilters:e,ordersToday:this.ordersToday,onOrderAdded:i=>this.ordersToday[i]=!0}});r.present();const{data:s}=await r.onDidDismiss();L.isEmpty(s)||(this.rows=[...this.formatOrders(s),...this.rows])},voidOrder(e){Y(async r=>{new P(-1).voidOrder(e.order_id,r).then(()=>{this.rows=this.rows.filter(s=>s.order_id!=e.order_id),z("Record has been voided successfully!")}).catch(s=>{A("An error has occured while deleting order: ".concat(s))})})}},mounted(){this.init()},activated(){this.init()}}),O=e=>(j("data-v-07fd4d82"),e=e(),q(),e),K={class:"view-port-content"},Q={class:"his-sm-text"},U=O(()=>t("tr",null,[t("th",null,"Accession #"),t("th",null,"Test Name"),t("th",null,"Specimen"),t("th",null,"Ordered"),t("th",null,"Result"),t("th",null,"Released"),t("th",null,"Given"),t("th",null,"Action")],-1)),X=O(()=>t("br",null,null,-1));function Z(e,r,s,i,ee,se){const _=f("ion-icon"),p=f("ion-button"),S=f("view-port");return l(),R(S,null,{default:u(()=>[t("div",K,[t("table",Q,[U,(l(!0),m(w,null,b(e.rows,(o,k)=>{var v;return l(),m("tr",{key:k},[t("td",null,n(o.accession_number),1),t("td",null,n(o.test_name),1),t("td",null,n(o.specimen),1),t("td",null,n(o.ordered),1),t("td",null,[(l(!0),m(w,null,b(o.result,(h,D)=>(l(),m("span",{key:D},[x(n(h)+" ",1),X]))),128))]),t("td",null,n(o.released),1),t("td",null,[t("span",{style:G("color: ".concat(o.result_given==="Yes"?"green;":"black;"))},n(o.result_given),5)]),t("td",null,[a(p,{onClick:h=>e.printOrder(o)},{default:u(()=>[a(_,{size:"large",icon:e.print},null,8,["icon"])]),_:2},1032,["onClick"]),a(p,{disabled:o.delivery_mode?o.delivery_mode!="test_results_delivered_to_site_manually":!1,color:"success"},{default:u(()=>[a(_,{size:"large",icon:e.pencil},null,8,["icon"])]),_:2},1032,["disabled"]),a(p,{disabled:o.delivery_mode!="test_results_delivered_to_site_manually"&&((v=o.result)!=null?v:[]).length>=1,onClick:h=>e.voidOrder(o),color:"danger"},{default:u(()=>[a(_,{size:"large",icon:e.trash},null,8,["icon"])]),_:2},1032,["disabled","onClick"])])])}),128))])])]),_:1})}const ae=N(J,[["render",Z],["__scopeId","data-v-07fd4d82"]]);export{ae as default};
