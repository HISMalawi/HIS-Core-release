const __vite__fileDeps=["assets/MinimalToolbar-Bersmf3o.js","assets/index-ox16Qeox.js","assets/index-Blgwp1h6.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{d as O,ao as ct,ap as R,aq as j,m as F,i as B,f as U,j as G,k as dt,ae as w,G as yt,ac as ut,O as W,t as X,n as kt,_ as S,r as s,o as l,x as h,b as e,w as n,u as p,v as _,B as E,y as L,c as f,ar as pt,g as x,l as tt,h as et,q as Y,A as m,as as It,D as Dt,at as mt,au as nt,av as wt,aw as ht,z as k,ax as Z,K as ft,N as $t,ay as Tt,az as Et,aA as Pt,I as Lt,aB as At,ab as Vt,aC as Ot,aD as St,aE as Nt,aF as zt,aG as Mt,aH as Bt,aI as Ht,aJ as qt,aK as Rt,aL as jt,aM as Ft,aN as Ut,aO as z,aP as H,aQ as K,aR as J,T as M,aS as Gt,H as q,aT as Q,P as Wt,aU as Kt,p as Jt,aV as Qt,aW as Xt,aX as Yt,U as Zt,aY as xt,aZ as at,a_ as te,a$ as ee,b0 as ne,b1 as lt,a6 as ie,a7 as oe}from"./index-ox16Qeox.js";import{D as se}from"./drug_order_service-BZrdcVwE.js";import{T as ae}from"./TaskCard-BvdohQmE.js";import{p as le}from"./VoidReason-BVLraEFN.js";import re from"./DashboardAppIcon-qllfzGI9.js";const ce=O({components:{IonGrid:ct,IonRow:R,IonCol:j,TaskCard:ae,IonFooter:F,IonToolbar:B,IonButton:U,IonHeader:G,IonTitle:dt},props:{title:{type:String,default:"Select Activity"},items:{type:Object,required:!0},taskParams:{type:Object,required:!1}},data:()=>({filteredItems:[]}),watch:{items:{async handler(t){if(!(!t||w.isEmpty(t)))for(const i in t){const o=t[i];o.globalProperty&&!await yt.isProp(o.globalProperty)||o.condition&&!await o.condition(this.taskParams)||this.filteredItems.push(o)}},deep:!0,immediate:!0}},methods:{img(t){return ut(t)},isDisabled(t){return typeof t=="function"?t(this.taskParams):!1},closeModal(){W.dismiss({})},async doTask(t){var i;if(this.isDisabled(t.disabled))return X("This task is disabled");typeof t.taskCompleted=="boolean"&&(t!=null&&t.taskCompleted)&&!await kt("This task was already completed. Do you want to continue?")||(t.action?t.action(this.taskParams,this.$router):t.url?this.$router.push({path:t.url}):this.$router.push({name:t.id,params:{patient_id:(i=this.taskParams)==null?void 0:i.patient.patient_id}}),this.closeModal())}}});function de(t,i,o,a,y,$){const v=s("ion-title"),r=s("ion-toolbar"),c=s("ion-header"),b=s("task-card"),T=s("ion-col"),C=s("ion-row"),d=s("ion-grid"),I=s("ion-button"),D=s("ion-footer");return l(),h(E,null,[e(c,null,{default:n(()=>[e(r,null,{default:n(()=>[e(v,null,{default:n(()=>[p(_(t.title),1)]),_:1})]),_:1})]),_:1}),e(d,{class:"selector"},{default:n(()=>[e(C,null,{default:n(()=>[(l(!0),h(E,null,L(t.filteredItems,(g,A)=>(l(),f(T,{"size-lg":"4","size-sm":"6",key:A},{default:n(()=>[e(b,{onClick:P=>t.doTask(g),title:g.name.toUpperCase(),description:g.description,taskCompleted:g.taskCompleted,taskDisabled:t.isDisabled(g.disabled),icon:t.img(g.icon)},null,8,["onClick","title","description","taskCompleted","taskDisabled","icon"])]),_:2},1024))),128))]),_:1})]),_:1}),e(D,null,{default:n(()=>[e(r,null,{default:n(()=>[e(I,{class:"close-btn",color:"danger",size:"large",onClick:t.closeModal,slot:"end"},{default:n(()=>[p(" Close ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const rt=S(ce,[["render",de],["__scopeId","data-v-701ae879"]]),ue=O({components:{HisBasicTable:pt,IonButton:U,IonToolbar:B,IonList:x,IonFooter:F,IonContent:tt,IonRow:R,IonCol:j,IonTitle:dt,IonHeader:G,IonItem:et},data:()=>({active:{id:-1,name:"",provider:"",rows:[],columns:[]},encounters:[]}),computed:{canVoid(){return!w.isEmpty(this.active)}},watch:{items:{handler(t){w.isEmpty(t)||(this.encounters=t,this.showDetails(this.encounters[0]))},immediate:!0,deep:!0}},props:{title:{type:String,required:!0},items:{type:Object,required:!0}},methods:{closeModal(){W.dismiss({})},removeEncounter(t){this.encounters=this.encounters.filter(i=>i.other.id!=t)},voidActiveItem(){le(async t=>{try{await this.active.onVoid(t),this.removeEncounter(this.active.id),this.active={},w.isEmpty(this.encounters)||this.showDetails(this.encounters[0])}catch(i){Y("".concat(i))}},"void-modal custom-modal-backdrop")},async showDetails(t){this.active.id=t.other.id,this.active.name=t.label,this.active.columns=t.other.columns,this.active.onVoid=t.other.onVoid,this.active.rows=await t.other.getRows(),this.active.provider=await t.other.provider}}}),pe={style:{float:"right"}},me={class:"tb"};function he(t,i,o,a,y,$){const v=s("ion-title"),r=s("ion-toolbar"),c=s("ion-header"),b=s("ion-item"),T=s("ion-list"),C=s("ion-col"),d=s("his-basic-table"),I=s("ion-row"),D=s("ion-content"),g=s("ion-button"),A=s("ion-footer");return l(),h(E,null,[e(c,null,{default:n(()=>[e(r,null,{default:n(()=>[e(v,{class:"his-md-text"},{default:n(()=>[m("span",null,_(t.title),1),m("span",pe,"Provider: "+_(t.active.provider),1)]),_:1})]),_:1})]),_:1}),e(D,null,{default:n(()=>[e(I,null,{default:n(()=>[e(C,{size:"4"},{default:n(()=>[e(T,null,{default:n(()=>[(l(!0),h(E,null,L(t.encounters,(P,N)=>(l(),f(b,{class:"his-sm-text",key:N,color:P.other.id===t.active.id?"primary":"",detail:!0,onClick:()=>t.showDetails(P)},{default:n(()=>[p(_(P.label),1)]),_:2},1032,["color","onClick"]))),128))]),_:1})]),_:1}),e(C,{size:"8"},{default:n(()=>[m("div",me,[e(d,{columns:t.active.columns,rows:t.active.rows},null,8,["columns","rows"])])]),_:1})]),_:1})]),_:1}),e(A,null,{default:n(()=>[e(r,null,{default:n(()=>[e(g,{color:"danger",onClick:t.voidActiveItem,disabled:!t.canVoid,size:"large"},{default:n(()=>[p(" Void encounter")]),_:1},8,["onClick","disabled"]),e(g,{onClick:t.closeModal,size:"large",slot:"end"},{default:n(()=>[p(" Close ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const fe=S(ue,[["render",he],["__scopeId","data-v-512607ac"]]),_e=O({components:{HisBasicTable:pt,IonHeader:G,IonToolbar:B,IonContent:tt,IonFooter:F,IonButton:U},props:{title:{type:String,required:!0},columns:{type:Array,required:!0},rows:{type:Array,default:()=>[]}},methods:{async closeModal(){await W.dismiss({})}}});function ge(t,i,o,a,y,$){const v=s("ion-title"),r=s("ion-toolbar"),c=s("ion-header"),b=s("his-basic-table"),T=s("ion-content"),C=s("ion-button"),d=s("ion-footer");return l(),h(E,null,[e(c,null,{default:n(()=>[e(r,null,{default:n(()=>[e(v,{class:"his-md-text"},{default:n(()=>[p(_(t.title),1)]),_:1})]),_:1})]),_:1}),e(T,null,{default:n(()=>[e(b,{columns:t.columns,rows:t.rows},null,8,["columns","rows"])]),_:1}),e(d,null,{default:n(()=>[e(r,null,{default:n(()=>[e(C,{size:"large",onClick:t.closeModal,slot:"end"},{default:n(()=>[p(" Close ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const ve=S(_e,[["render",ge]]),be=O({components:{TextSkeleton:It,IonLabel:Dt,IonList:x,IonItem:et,IonChip:mt,IonIcon:nt,IonBadge:wt},data:()=>({time:ht}),props:{isEnabled:{type:Boolean,default:()=>!0},counter:{type:Number,required:!1},isLoading:{type:Boolean},icon:{type:Object},title:{type:String,required:!0},items:{type:Object},titleColor:{type:String,required:!1,default:()=>"#337ab7"}}});function Ce(t,i,o,a,y,$){const v=s("ion-badge"),r=s("ion-label"),c=s("ion-item"),b=s("text-skeleton"),T=s("ion-icon"),C=s("ion-chip"),d=s("ion-list");return l(),h("div",{class:Z(["card",{inactive:!t.isEnabled,clickable:t.isEnabled}])},[e(c,{color:t.titleColor,lines:"none",class:"his-md-text title-card"},{default:n(()=>[e(v,{slot:"start",class:"his-sm-text",color:"light"},{default:n(()=>[m("b",null,_(t.counter),1)]),_:1}),e(r,null,{default:n(()=>[p(_(t.title),1)]),_:1})]),_:1},8,["color"]),t.isLoading?(l(),f(b,{key:0,itemCount:5})):k("",!0),t.isLoading?k("",!0):(l(),f(d,{key:1},{default:n(()=>[(l(!0),h(E,null,L(t.items,(I,D)=>(l(),f(c,{key:D},{default:n(()=>{var g;return[e(r,{class:Z((g=I==null?void 0:I.other)!=null&&g.wrapTxt?"ion-text-wrap":""),innerHTML:I.label},null,8,["class","innerHTML"]),I.value?(l(),f(C,{key:0,class:"his-sm-text",slot:"end"},{default:n(()=>[e(T,{icon:t.icon},null,8,["icon"]),e(r,null,{default:n(()=>[p(_(I.value),1)]),_:2},1024)]),_:2},1024)):k("",!0)]}),_:2},1024))),128))]),_:1}))],2)}const ye=S(be,[["render",Ce],["__scopeId","data-v-3db6edee"]]),ke=O({components:{IonList:x,IonItem:et},props:{title:{type:String,default:()=>"Visits"},items:{type:Object,required:!0}},data:()=>({active:{},activeListItems:[],paginatedListItems:[],index:-1,perPage:6,btnSize:45}),computed:{listAlignmentClass(){return this.activeListItems&&this.activeListItems.length===this.perPage?"vertically-align":""},upbuttonImg(){return"/assets/images/drop-up-arrow.svg"},downbuttonImg(){return"/assets/images/drop-down-arrow.svg"},showNextButton(){return this.index+1<this.paginatedListItems.length},showPrevButton(){return this.index>=1}},watch:{items:{handler(t){if(!w.isEmpty(t)){this.index=0,this.paginatedListItems=w.chunk(t,this.perPage),this.activeListItems=this.paginatedListItems[0],this.active=this.activeListItems[0];for(const i in this.paginatedListItems){const o=w.findIndex(this.paginatedListItems[i],a=>a.other.isActive===!0,0);if(o!=-1){this.index=parseInt(i),this.activeListItems=this.paginatedListItems[i],this.active=this.activeListItems[o];break}}}},deep:!0,immediate:!0},index:{handler(t){this.activeListItems=this.paginatedListItems[t]},immediate:!0},active(t){this.$emit("onselect",t)}},methods:{onselect(t){this.active=t},isActive(t){return t.label===this.active.label},goNext(){const t=this.index+1;t<=this.paginatedListItems.length&&(this.index=t)},goPrev(){this.paginatedListItems.length>=1&&(this.index-=1)}}}),Ie={class:"card his-card"},De={class:"his-md-text header-section"},we=["disabled"],$e=["src","width"],Te={class:"bottom-section"},Ee=["disabled"],Pe=["src","width"];function Le(t,i,o,a,y,$){const v=s("ion-item"),r=s("ion-list");return l(),h("div",Ie,[m("div",De,_(t.title),1),m("button",{class:"nav-btn nav-btn-top clickable",disabled:!t.showPrevButton,onClick:i[0]||(i[0]=(...c)=>t.goPrev&&t.goPrev(...c))},[m("img",{src:t.upbuttonImg,width:t.btnSize},null,8,$e)],8,we),m("div",{class:Z(t.listAlignmentClass)},[e(r,null,{default:n(()=>[(l(!0),h(E,null,L(t.activeListItems,(c,b)=>(l(),f(v,{class:"his-md-text",key:b,onClick:T=>t.onselect(c),detail:!0,color:t.isActive(c)?"primary":""},{default:n(()=>[p(_(c.label),1)]),_:2},1032,["onClick","color"]))),128))]),_:1})],2),m("div",Te,[m("button",{class:"nav-btn nav-btn-bottom clickable",disabled:!t.showNextButton,onClick:i[1]||(i[1]=(...c)=>t.goNext&&t.goNext(...c))},[m("img",{src:t.downbuttonImg,width:t.btnSize},null,8,Pe)],8,Ee)])])}const Ae=S(ke,[["render",Le],["__scopeId","data-v-751691ca"]]);function Ve(){const t=ft({width:window.innerWidth,height:window.innerHeight});function i(o){t.value={height:o.currentTarget.innerHeight,width:o.currentTarget.innerWidth}}return $t(()=>{addEventListener("resize",i)}),Tt(()=>{removeEventListener("resize",i)}),{resolution:t}}const Oe=O({name:"HisResultCard",components:{IonIcon:nt},props:{icon:{required:!1},items:{type:Object,required:!0}},methods:{hasIcon(t){return"other"in t&&"icon"in t.other}}}),Se={class:"tool-bar-medium-card"};function Ne(t,i,o,a,y,$){const v=s("ion-icon");return l(),h("div",Se,[(l(!0),h(E,null,L(t.items,(r,c)=>(l(),h("div",{key:c},[t.hasIcon(r)?(l(),f(v,{key:0,icon:r.other.icon},null,8,["icon"])):k("",!0),p(" "+_(r.label)+": ",1),m("b",null,_(r.value),1)]))),128))])}const ze=S(Oe,[["render",Ne],["__scopeId","data-v-f304e49e"]]),Me=O({name:"PatientToolbar",components:{IonHeader:G,IonToolbar:B,IonCol:j,IonRow:R,InfoCard:ze,IconCard:re},props:{app:{type:Object},appVersion:{type:String},patientCardInfo:{type:Array,required:!0},programCardInfo:{type:Array,required:!0},appIcon:{type:String,required:!0}},computed:{logo(){return ut(this.appIcon)}}});function Be(t,i,o,a,y,$){const v=s("info-card"),r=s("ion-col"),c=s("icon-card"),b=s("ion-row"),T=s("ion-toolbar"),C=s("ion-header");return l(),f(C,{translucent:!0},{default:n(()=>[e(T,null,{default:n(()=>[e(b,null,{default:n(()=>[e(r,{size:"5"},{default:n(()=>[e(v,{items:t.patientCardInfo},null,8,["items"])]),_:1}),e(r,{size:"5"},{default:n(()=>[e(v,{items:t.programCardInfo},null,8,["items"])]),_:1}),e(r,{size:"2"},{default:n(()=>[e(c,{app:t.app,version:t.appVersion,icon:t.logo},null,8,["app","version","icon"])]),_:1})]),_:1})]),_:1})]),_:1})}const He=S(Me,[["render",Be]]),qe=O({components:{IonSegment:Et,IonSegmentButton:Pt,IonChip:mt,IonPage:Lt,IonIcon:nt,IonFooter:F,IonContent:tt,IonButton:U,IonToolbar:B,IonGrid:ct,IonRow:R,IonCol:j,FullToolbar:He,PrimaryCard:ye,VisitDatesCard:Ae,MinimalToolbar:At(()=>ne(()=>import("./MinimalToolbar-Bersmf3o.js"),__vite__mapDeps([0,1,2])))},setup(){const t=ft("lg"),{resolution:i}=Ve();return Vt(()=>i.value,o=>{o&&o.width<=900?t.value="sm":t.value="lg"},{immediate:!0,deep:!0}),{time:ht,person:Ot,calendar:St,medical:Nt,clipboard:zt,apps:Mt,folder:Bt,logOut:Ht,clipboardOutline:qt,appsOutline:Rt,folderOutline:jt,logOutOutline:Ft,alertCircle:Ut,screenBreakPoint:t}},data:()=>({activeTab:1,app:{},dashboardComponent:{},isBDE:!1,currentDate:"",sessionDate:"",nextTask:{},programId:0,patientId:0,patient:{},patientProgram:{},patientCardInfo:[],programCardInfo:[],visitDates:[],activeVisitDate:"",patientCards:[],appVersion:z.getFullVersion(),sessionEncounterMap:{},savedEncounters:[]}),computed:{patientIsset(){return!w.isEmpty(this.patient)},patientName(){return w.isEmpty(this.patient)?"N/A":this.patient.getFullName()},appHasCustomContent(){return!w.isEmpty(this.app.customPatientDashboardContentComponent)},customDashboardContent(){return this.app.customPatientDashboardContentComponent},visitDatesTitle(){return"".concat(this.visitDates.length," Visits")}},watch:{activeVisitDate(t){this.appHasCustomContent||this.updateCardVisitData(t)}},created(){this.app=H.getActiveApp(),this.patientCards=[{items:[],cache:{},label:"Activities",color:"primary",isLoading:!1,icon:K,isEnabled:this.isCardEnabled("activitiesEnabled"),onVisitDate:(t,i)=>{t.isLoading=!0,J.getEncounters(this.patientId,{date:i}).then(o=>{t.items=this.getActivitiesCardInfo(o),t.cache[i]=t.items,t.isLoading=!1,this.sessionEncounterMap={},i===z.getSessionDate()&&!w.isEmpty(o)&&(this.sessionEncounterMap=o.reduce((a,y)=>(a[y.type.name.toLowerCase()]=y.observations.reduce(($,v)=>$.concat(v.concept.concept_names),[]).map($=>$.name.toLowerCase()),a),{}))}).catch(()=>{t.items=[],t.cache[i]=t.items,t.isLoading=!1})},onClick:t=>{t.isEnabled&&(t.isLoading?X("Please wait..."):this.openModal(t.items,"Select Activities",fe))}},{items:[],cache:{},color:"success",isLoading:!1,label:"Lab Orders",icon:K,isEnabled:this.isCardEnabled("labEnabled"),onVisitDate:(t,i,o,a)=>{o&&a==="LAB ORDERS"&&M.invalidate("PATIENT_LAB_ORDERS"),t.isLoading=!0,this.getLabOrderCardInfo(i).then(y=>{t.items=y,t.cache[i]=t.items,t.isLoading=!1}).catch(()=>{t.items=[],t.cache[i]=t.items,t.isLoading=!1})},onClick:t=>t.isEnabled&&this.$router.push("/art/encounters/lab/".concat(this.patient.getID()))},{items:[],label:"Alerts and Clinic Notes",color:"danger",icon:Gt,isLoading:!1,isInit:!1,isEnabled:this.isCardEnabled("alertsEnabled"),onVisitDate:t=>{if(t.isInit)return;const i=this.getPatientAlertCardInfo();typeof i=="object"&&typeof i.then=="function"&&(t.isLoading=!0,this.getPatientAlertCardInfo().then(o=>{o&&(t.items=o),this.getClinicNotes().then(a=>{a&&t.items.push(a)}).catch(a=>console.error(a)),t.isInit=!0,t.isLoading=!1}).catch(()=>{t.items=[],t.isInit=!0,t.isLoading=!1})),i&&(t.items=i)},onClick:()=>{}},{items:[],cache:{},label:"Medications",color:"warning",icon:K,isLoading:!1,isEnabled:this.isCardEnabled("medicationsEnabled"),onVisitDate:(t,i)=>{t.isLoading=!0,se.getOrderByPatient(this.patientId,{start_date:i}).then(o=>{t.items=this.getMedicationCardInfo(o),t.cache[i]=t.items,t.isLoading=!1}).catch(()=>{t.data,t.items=[],t.cache[i]=t.items,t.isLoading=!1})},onClick:t=>{if(!t.isEnabled)return;if(t.isLoading)return X("Please wait..");const i=["Medication","Start date","End date","Amount given"],o=t.items.map(a=>[a.other.drug.name,this.toDate(a.other.order.start_date),this.toDate(a.other.order.auto_expire_date),a.other.quantity]);this.openTableModal(i,o,"Medication History")}}]},mounted(){this.patientId=parseInt("".concat(this.$route.params.id)),this.patientId&&H.doAppManagementTasks().then(()=>{this.app=H.getActiveApp(),this.programId=this.app.programID,this.appHasCustomContent&&(this.patientCards=[]),this.initData()})},methods:{initData(){var t,i;this.programCardInfo=typeof((t=this.app)==null?void 0:t.patientProgramInfoData)=="function"?(i=this.app)==null?void 0:i.patientProgramInfoData(this.patientId):[],this.currentDate=q.currentDisplayDate(),this.sessionDate=this.toDate(z.getSessionDate()),this.isBDE=z.isBDE()||!1,M.get("ACTIVE_PATIENT",{patientID:this.patientId}).then(async o=>{this.patient=o,this.patientCardInfo=this.getPatientCardInfo(o),this.getNextTask().then(a=>this.nextTask=a),this.getPatientVisitDates(this.patientId).then(a=>{this.visitDates=a,this.loadSavedEncounters()}).catch(a=>{console.error(a)});for(const a of this.programCardInfo)typeof a.init=="function"&&await a.init(),typeof a.asyncValue=="function"?a.asyncValue().then(y=>a.value=y):typeof a.staticValue=="function"&&(a.value=a.staticValue())}).catch(o=>Y("".concat(o)))},isCardEnabled(t){var o;const i=(o=this.app)==null?void 0:o.configDefaultPatientDashboardCards;return i&&t in i?i[t]||!1:!0},async showLoader(){(await Q.create({message:"Please wait....",backdropDismiss:!1})).present()},clearLoader(){Q.getTop().then(t=>t?Q.dismiss():null)},toDate(t){return q.toStandardHisDisplayFormat(t)},toTime(t){return q.toStandardHisTimeFormat(t)},loadSavedEncounters(){J.getSavedEncounters(this.patientId).then(t=>{this.savedEncounters=t})},updateCardVisitData(t,i=!1,o=""){this.patientCards.forEach(a=>{if(a.isEnabled&&typeof a.onVisitDate=="function"){if(typeof a.cache=="object"&&a.cache[t]&&!i){a.items=a.cache[t];return}a.onVisitDate(a,t,i,o)}})},async getPatientVisitDates(t){return(await Wt.getPatientVisits(t,!1)).map(i=>({label:this.toDate(i),value:i,other:{isActive:i===z.getSessionDate()}}))},getNextTask(){return Kt.getNextTaskParams(this.patientId)},goToNextTask(){Jt(this.patientId,this.$router)},onActiveVisitDate(t){this.activeVisitDate=t.value},getPatientCardInfo(t){const i=t.getBirthdate(),o=t.getGender()==="M"?Qt:Xt;return[{label:"Name",value:t.getFullName(),other:{icon:o}},{label:"Birthdate",value:"\n                    ".concat(this.toDate(i),"\n                    (").concat(t.getAge(),") \n                    (").concat(t.getNationalID(),")")},{label:"Current Village",value:t.getCurrentVillage()},{label:"Phone#",value:t.getPhoneNumber()}]},getActivitiesCardInfo(t){return t.map(i=>({label:i.type.name,value:this.toTime(i.encounter_datetime),other:{provider:Yt.getPersonFullName(i.provider_id),id:i.encounter_id,columns:["Observation","Value","Time"],onVoid:async o=>{await this.showLoader(),J.voidEncounter(i.encounter_id,o).then(()=>{this.clearLoader(),this.loadSavedEncounters(),this.updateCardVisitData(this.activeVisitDate,!0,i.type.name),this.getNextTask().then(a=>this.nextTask=a),Zt("Encounter has been voided!",2e3)}).catch(a=>{this.clearLoader(),Y("".concat(a),32e3)})},getRows:async()=>{var y,$,v,r,c,b;const o=[],{observations:a}=i;for(const T in a){let C="<UNKNOWN CONCEPT>";const d=a[T];try{if((y=d==null?void 0:d.concept)!=null&&y.concept_names){const g=(b=(c=(v=($=d==null?void 0:d.drug)==null?void 0:$.drug_cms)==null?void 0:v.short_name)!=null?c:(r=d==null?void 0:d.drug)==null?void 0:r.name)!=null?b:"",A=g?"(".concat(g,")"):"";C="".concat(d.concept.concept_names[0].name," ").concat(A).trim()}else C=await xt.getConceptName(d.concept_id)}catch(g){console.error(d,g)}const I=await at.resolvePrimaryValue(d),D=q.toStandardHisTimeFormat(d.date_created);o.push([C,I,D])}return o}}}))},getMedicationCardInfo(t){return t.map(i=>({label:i.drug.name,value:this.toTime(i.order.start_date),other:i}))},async getLabOrderCardInfo(t){return typeof this.app.getPatientDashboardLabOrderCardItems=="function"?this.app.getPatientDashboardLabOrderCardItems(this.patientId,t):(await te.getOrders(this.patientId,{date:t})).map(o=>({label:o.specimen.name,value:this.toTime(o.order_date)}))},async getPatientAlertCardInfo(){if("getPatientDashboardAlerts"in this.app)return this.app.getPatientDashboardAlerts(this.patient)},async getClinicNotes(){const t=await at.getFirstObs(this.patient.getID(),"Clinical notes construct");if(t)return{label:"Notes",value:t.value_text}},async changeApp(){const t=await H.selectApplication("PatientDashboard",!0);t&&(t.programID!=this.programId?(this.programId=t.programID,this.$router.push("/patients/confirm?patient_barcode=".concat(this.patient.getNationalID()))):this.initData())},async showTasks(){if("primaryPatientActivites"in this.app){const t=[...this.app.primaryPatientActivites].map(i=>{const o=(i.encounterTypeName||i.name).toLowerCase();return typeof i.taskCompletionChecklist=="object"&&!w.isEmpty(this.sessionEncounterMap)?i.taskCompleted=i.taskCompletionChecklist.every(a=>w.isArray(this.sessionEncounterMap[o])&&this.sessionEncounterMap[o].includes(a.toLowerCase())):i.taskCompleted=!w.isEmpty(this.sessionEncounterMap[o]),i});this.openModal(t,"Tasks for",rt,this.sessionDate)}},showOptions(){if("secondaryPatientActivites"in this.app){const t=this.app.secondaryPatientActivites;this.openModal(t,"Select Activity",rt)}},async startModal(t,i){(await W.create({component:t,backdropDismiss:!1,cssClass:"large-modal",componentProps:i})).present()},async openModal(t,i,o,a=""){w.isEmpty(this.patientProgram)&&(this.patientProgram=await new ee(this.patientId).getProgram()),this.startModal(o,{items:t,title:"".concat(i,": ").concat(a||this.toDate(this.activeVisitDate.toString())),taskParams:{patient:this.patient.getObj(),program:this.patientProgram,visitDate:this.activeVisitDate,patientID:this.patientId,savedEncounters:this.savedEncounters}})},openTableModal(t,i,o){this.startModal(ve,{columns:t,rows:i,title:"".concat(o,": ").concat(this.toDate(this.activeVisitDate.toString()))})},onCancel(){M.invalidate("ACTIVE_PATIENT"),M.invalidate("PATIENT_PROGRAM"),M.invalidate("PATIENT_LAB_ORDERS"),this.$router.push({path:"/"})}}}),_t=t=>(ie("data-v-2f7ca192"),t=t(),oe(),t),Re={key:0},je=_t(()=>m("p",null,null,-1)),Fe={class:"his-card info-card-item"},Ue={class:"his-card info-card-item"},Ge={class:"his-card info-card-item"},We={class:"his-sm-text his-card"},Ke={key:0},Je={key:1},Qe=_t(()=>m("b",null,"NONE",-1)),Xe={key:0},Ye={key:1},Ze={key:1};function xe(t,i,o,a,y,$){const v=s("minimal-toolbar"),r=s("ion-icon"),c=s("ion-label"),b=s("ion-segment-button"),T=s("ion-segment"),C=s("ion-toolbar"),d=s("ion-button"),I=s("primary-card"),D=s("ion-col"),g=s("ion-row"),A=s("ion-grid"),P=s("ion-item"),N=s("ion-list"),it=s("ion-content"),gt=s("ion-footer"),ot=s("ion-page"),vt=s("full-toolbar"),bt=s("visit-dates-card"),st=s("ion-chip");return l(),h(E,null,[t.screenBreakPoint==="sm"?(l(),f(ot,{key:0},{default:n(()=>[e(v,{title:t.patientName,menuTitle:t.visitDatesTitle,menuItems:t.visitDates,appIcon:t.app.applicationIcon,onOnClickMenuItem:t.onActiveVisitDate},null,8,["title","menuTitle","menuItems","appIcon","onOnClickMenuItem"]),t.screenBreakPoint==="sm"?(l(),f(C,{key:0},{default:n(()=>[e(T,{value:t.activeTab,class:"ion-justify-content-center"},{default:n(()=>[e(b,{value:"1",onClick:i[0]||(i[0]=u=>t.activeTab=1)},{default:n(()=>[e(r,{icon:t.calendar},null,8,["icon"]),e(c,null,{default:n(()=>[p("Visits")]),_:1})]),_:1}),e(b,{value:"2",onClick:i[1]||(i[1]=u=>t.activeTab=2)},{default:n(()=>[e(r,{icon:t.person},null,8,["icon"]),e(c,null,{default:n(()=>[p("Patient")]),_:1})]),_:1}),e(b,{value:"3",onClick:i[2]||(i[2]=u=>t.activeTab=3)},{default:n(()=>[e(r,{icon:t.medical},null,8,["icon"]),e(c,null,{default:n(()=>[p("Program")]),_:1})]),_:1}),e(b,{value:"4",onClick:i[3]||(i[3]=u=>t.activeTab=4)},{default:n(()=>[e(r,{icon:t.time},null,8,["icon"]),e(c,null,{default:n(()=>[p("Dates")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})):k("",!0),t.nextTask.name&&t.screenBreakPoint==="sm"?(l(),f(C,{key:1},{default:n(()=>[e(d,{style:{width:"100%"},color:"success",onClick:t.goToNextTask},{default:n(()=>[e(c,null,{default:n(()=>[m("b",null,"Next Task: "+_(t.nextTask.name.toUpperCase()),1)]),_:1}),e(r,{icon:t.alertCircle},null,8,["icon"])]),_:1},8,["onClick"])]),_:1})):k("",!0),e(it,{id:"main-content"},{default:n(()=>[t.screenBreakPoint==="sm"?(l(),h("div",Re,[t.appHasCustomContent&&t.activeTab===1&&t.patientIsset?(l(),f(lt(t.customDashboardContent),{key:0,patient:t.patient,visitDate:t.activeVisitDate},null,8,["patient","visitDate"])):k("",!0),!t.appHasCustomContent&&t.activeTab===1?(l(),f(A,{key:1},{default:n(()=>[e(g,null,{default:n(()=>[(l(!0),h(E,null,L(t.patientCards,(u,V)=>(l(),f(D,{size:"12",key:V},{default:n(()=>[(l(),f(I,{key:"mcard".concat(V),isEnabled:u.isEnabled,counter:u.items.length,icon:u.icon,title:u.label,titleColor:u.color,items:u.items,isLoading:u.isLoading,onClick:Ct=>u.onClick(u)},null,8,["isEnabled","counter","icon","title","titleColor","items","isLoading","onClick"]))]),_:2},1024))),128))]),_:1})]),_:1})):k("",!0),t.activeTab===2?(l(),f(N,{key:2},{default:n(()=>[(l(!0),h(E,null,L(t.patientCardInfo,(u,V)=>(l(),h("div",{class:"his-card info-card-item",key:V},[e(P,{lines:"none"},{default:n(()=>[e(c,null,{default:n(()=>[p(_(u.label),1)]),_:2},1024),e(c,{slot:"end"},{default:n(()=>[m("b",null,_(u.value),1)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})):k("",!0),t.activeTab===3?(l(),f(N,{key:3},{default:n(()=>[(l(!0),h(E,null,L(t.programCardInfo,(u,V)=>(l(),h("div",{class:"his-card info-card-item",key:V},[e(P,{lines:"none"},{default:n(()=>[e(c,null,{default:n(()=>[p(_(u.label),1)]),_:2},1024),e(c,{slot:"end"},{default:n(()=>[m("b",null,_(u.value),1)]),_:2},1024)]),_:2},1024),je]))),128))]),_:1})):k("",!0),t.activeTab===4?(l(),f(N,{key:4},{default:n(()=>[m("div",Fe,[e(P,{lines:"none"},{default:n(()=>[e(c,null,{default:n(()=>[p(" Today ")]),_:1}),e(c,{slot:"end"},{default:n(()=>[m("b",null,_(t.currentDate),1)]),_:1})]),_:1})]),m("div",Ue,[e(P,{lines:"none"},{default:n(()=>[e(c,null,{default:n(()=>[p(" Session ")]),_:1}),e(c,{slot:"end"},{default:n(()=>[m("b",null,_(t.sessionDate),1)]),_:1})]),_:1})]),m("div",Ge,[e(P,{lines:"none"},{default:n(()=>[e(c,null,{default:n(()=>[p(" Current visit date ")]),_:1}),e(c,{slot:"end"},{default:n(()=>[m("b",null,_(t.activeVisitDate),1)]),_:1})]),_:1})])]),_:1})):k("",!0)])):k("",!0)]),_:1}),e(gt,null,{default:n(()=>[t.screenBreakPoint==="sm"?(l(),f(C,{key:0,color:"dark"},{default:n(()=>[e(d,{color:"primary",size:"medium",slot:"end",onClick:t.showTasks},{default:n(()=>[e(r,{icon:t.clipboard},null,8,["icon"])]),_:1},8,["onClick"]),e(d,{color:"primary",size:"medium",slot:"end",onClick:t.showOptions},{default:n(()=>[e(r,{icon:t.folder},null,8,["icon"])]),_:1},8,["onClick"]),e(d,{color:"primary",size:"medium",slot:"end",onClick:t.changeApp},{default:n(()=>[e(r,{icon:t.apps},null,8,["icon"])]),_:1},8,["onClick"]),e(d,{color:"success",size:"medium",slot:"end",onClick:t.onCancel},{default:n(()=>[e(r,{icon:t.logOut},null,8,["icon"])]),_:1},8,["onClick"])]),_:1})):k("",!0)]),_:1})]),_:1})):k("",!0),t.screenBreakPoint==="lg"?(l(),f(ot,{key:1},{default:n(()=>[e(vt,{app:t.app,appVersion:t.appVersion,appIcon:t.app.applicationIcon,patientCardInfo:t.patientCardInfo,programCardInfo:t.programCardInfo},null,8,["app","appVersion","appIcon","patientCardInfo","programCardInfo"]),e(it,{id:"main-content"},{default:n(()=>[e(A,{class:"grid-custom vertically-align"},{default:n(()=>[e(g,null,{default:n(()=>[e(D,{size:"2.4"},{default:n(()=>[e(bt,{title:t.visitDatesTitle,items:t.visitDates,onOnselect:t.onActiveVisitDate},null,8,["title","items","onOnselect"])]),_:1}),e(D,{size:"9.6"},{default:n(()=>[m("div",We,[e(g,null,{default:n(()=>[e(D,{"size-md":"4","size-sm":"6"},{default:n(()=>[p(" Today's Date: "),m("b",null,_(t.currentDate),1)]),_:1}),e(D,{"size-md":"4","size-sm":"6"},{default:n(()=>[t.nextTask.name?(l(),h("span",Ke,[e(st,{class:"next-task",color:"success",onClick:t.goToNextTask},{default:n(()=>[p("Next Task: "+_(t.nextTask.name.toUpperCase()),1)]),_:1},8,["onClick"])])):(l(),h("span",Je,[p(" Next Task: "),Qe]))]),_:1}),e(D,{"size-md":"4","size-sm":"12"},{default:n(()=>[t.isBDE?(l(),h("span",Xe,[e(st,{style:{marginTop:"-8px"},color:"danger",onClick:i[4]||(i[4]=u=>t.$router.push({name:"Session Date"}))},{default:n(()=>[m("b",null," BDE: "+_(t.sessionDate.toUpperCase()),1)]),_:1})])):(l(),h("span",Ye,[p(" Set Date: "),m("b",null,_(t.sessionDate),1)]))]),_:1})]),_:1}),t.appHasCustomContent&&t.patientIsset?(l(),f(lt(t.customDashboardContent),{key:0,patient:t.patient,visitDate:t.activeVisitDate},null,8,["patient","visitDate"])):k("",!0),t.appHasCustomContent?k("",!0):(l(),h("div",Ze,[e(g,null,{default:n(()=>[(l(!0),h(E,null,L(t.patientCards,(u,V)=>(l(),f(D,{size:"6",key:V},{default:n(()=>[(l(),f(I,{key:u.label,isEnabled:u.isEnabled,counter:u.items.length,icon:u.icon,title:u.label,titleColor:u.color,items:u.items,isLoading:u.isLoading,onClick:Ct=>u.onClick(u)},null,8,["isEnabled","counter","icon","title","titleColor","items","isLoading","onClick"]))]),_:2},1024))),128))]),_:1})]))])]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{color:"dark"},{default:n(()=>[e(d,{color:"primary",size:"large",slot:"end",onClick:t.showTasks},{default:n(()=>[e(r,{icon:t.clipboardOutline},null,8,["icon"]),p(" Tasks ")]),_:1},8,["onClick"]),e(d,{color:"primary",size:"large",slot:"end",onClick:t.showOptions},{default:n(()=>[e(r,{icon:t.folderOutline},null,8,["icon"]),p(" Printouts/Other ")]),_:1},8,["onClick"]),e(d,{color:"primary",size:"large",slot:"end",onClick:t.changeApp},{default:n(()=>[e(r,{icon:t.appsOutline},null,8,["icon"]),p(" Applications ")]),_:1},8,["onClick"]),e(d,{onClick:t.onCancel,color:"success",size:"large",slot:"end"},{default:n(()=>[e(r,{icon:t.logOutOutline},null,8,["icon"]),p(" Finish ")]),_:1},8,["onClick"])]),_:1})]),_:1})):k("",!0)],64)}const an=S(qe,[["render",xe],["__scopeId","data-v-2f7ca192"]]);export{an as default};
