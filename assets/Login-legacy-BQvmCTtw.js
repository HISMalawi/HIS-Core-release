System.register(["./index-legacy-DR3-kJVE.js","./main-legacy-DzsgIklA.js"],(function(e,t){"use strict";var o,a,s,n,i,r,l,d,u,p,c,h,f,g,w,m,b,y,v,I,k,x,C,P,_,T,S,B,V,$,L,z,A,N,O,D,U,E,R,M,K,F,H,Y,j,G,W,q,X,J,Z,Q,ee,te;return{setters:[e=>{o=e.d,a=e.a7,s=e.a8,n=e.ax,i=e.ay,r=e.az,l=e.aA,d=e.aB,u=e.aC,p=e.aD,c=e.aE,h=e.ad,f=e.W,g=e.ae,w=e.U,m=e.aF,b=e.ak,y=e.aG,v=e.aa,I=e.af,k=e.a,x=e.E,C=e.K,P=e.a2,_=e.aH,T=e.aI,S=e.b,B=e.w,V=e.c,$=e.M,L=e.J,z=e.G,A=e.aJ,N=e.$,O=e.Z,D=e.a6,U=e.I,E=e.X,R=e.Y,M=e._,K=e.a9,F=e.a0,H=e.a1,Y=e.r,j=e.aK,G=e.as,W=e.aL,q=e.o,X=e.i,J=e.aM,Z=e.aN,Q=e.aO,ee=e.C},e=>{te=e.p}],execute:function(){var t=document.createElement("style");t.textContent=".input-boxes[data-v-5581b3d6]{height:70px;border:1px solid #ccc;border-radius:5px;width:50%;font-family:Nimbus Sans L,Arial Narrow,sans-serif;font-size:2.2em;background-color:#dcdcdc;color:#000;padding:8px}.main[data-v-5581b3d6]{width:100%;text-align:center;margin-top:5%;display:table}.keyboard[data-v-5581b3d6]{z-index:100;text-align:center;position:absolute;background-color:#fff;width:100%;border:1px solid rgb(204,204,204);word-wrap:normal!important;margin:0 auto;max-width:300px;left:0;right:0}.rows[data-v-5581b3d6]{display:table-row;line-height:1px}.cells[data-v-5581b3d6]{display:table-cell}.keyboard-btn[data-v-5581b3d6]{border:1px solid #7eb9d0;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:5px!important;font-size:1.6vw!important;font-family:arial,helvetica,sans-serif;text-decoration:none;display:inline-block;text-shadow:-1px -1px 0 rgba(0,0,0,.3);font-weight:700;color:#fff;background-color:#a7cfdf;background-image:-webkit-gradient(linear,left top,left bottom,from(#a7cfdf),to(#23538a));background-image:-webkit-linear-gradient(top,#a7cfdf,#23538a);background-image:-moz-linear-gradient(top,#a7cfdf,#23538a);background-image:-ms-linear-gradient(top,#a7cfdf,#23538a);background-image:-o-linear-gradient(top,#a7cfdf,#23538a);background-image:linear-gradient(to bottom,#a7cfdf,#23538a);filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=#a7cfdf,endColorstr=#23538a);max-width:85px;max-height:85px;cursor:pointer;text-align:center;margin:3px;width:8vw;height:8vh;overflow:hidden;white-space:nowrap}@media screen and (max-width: 600px){.keyboard-btn[data-v-5581b3d6]{font-size:10px!important}}@media screen and (min-width: 1020px){.keyboard-btn[data-v-5581b3d6]{font-size:25px!important}}.login-btn[data-v-5581b3d6]{background-image:-webkit-gradient(linear,left top,left bottom,from(green),to green);background-image:-webkit-linear-gradient(top,green,green);background-image:-moz-linear-gradient(top,green,green);background-image:-ms-linear-gradient(top,green,green);background-image:-o-linear-gradient(top,green,green);background-image:linear-gradient(to bottom,green,green);filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=green,endColorstr=green)}.input-rows[data-v-5581b3d6]{line-height:140px}#coat[data-v-f474746d]{width:8vw;height:8vw}#pepfar[data-v-f474746d]{width:6vw;height:6vw}.devices[data-v-f474746d]{background-color:var(--ion-color-primary);color:#fff;border:1px solid lightblue;font-size:1.3em;padding:1rem;margin-right:.5rem}.devices>option[data-v-f474746d]{background:#fff;color:#000}\n/*$vite$:1*/",document.head.appendChild(t);const oe=o({components:{IonInput:a,IonButton:s,IonIcon:n},props:{useVirtualInput:{type:Boolean}},data:function(){return{eye:i,eyeOff:r,passwordTimeout:null,showPasswordButtonTimeout:null,showPassword:!1,showPasswordButton:!1,keyboard:l,auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new d,u.clearScreenTimeout()},setup(){const{facilityName:e,district:t}=y();return{facilityName:e,district:t}},methods:{onShowPassword(){this.showPassword=!0,this.showPasswordButton=!0,this.passwordTimeout&&clearTimeout(this.passwordTimeout),this.passwordTimeout=setTimeout((()=>this.showPassword=!1),1e4)},renderKeyBoard(e){this.focusInput=e.currentTarget,"password"==this.focusInput.id?this.btnCaption="Login":this.btnCaption="Next";let t=e.currentTarget.getBoundingClientRect().top;t=parseInt(t),this.keyboardTop=t+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(e){const t=e.currentTarget.id;let o;try{t.match(/@#/i)?this.keyboard=p:t.match(/qwerty/i)?this.keyboard=l:t.match(/Del/i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):t.match(/Next/i)?(this.display="none",o=this.$refs.password,o.$el.click()):t.match(/Login/i)?(this.display="none",this.doLogin()):t.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",o="username"===this.focusInput.id?this.$refs.username:this.$refs.password,o.click()):t.match(/Hide/i)?this.display="none":this.focusInput.value+=t,"username"==this.focusInput.id?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(a){console.warn("input error")}},doLogin:async function(){if(this.showPasswordButtonTimeout&&clearTimeout(this.showPasswordButtonTimeout),this.showPasswordButton=!1,this.showPassword=!1,this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!(await this.auth.checkTimeIntegrity()))throw"Local date does not match API date. Please Update your device's date";await this.auth.login(this.userInput.password),this.auth.startSession();const e=await Promise.all([this.auth.passwordPolicyEnabled(),this.auth.passwordExpired()]),t=(()=>{let e=0;return e+=te(this.userInput.password).score,/^(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])/i.test(this.userInput.password)&&(e+=2),e<3})();if(t||e.every(Boolean)){const e=e=>`${e.value}`.toLowerCase();return c([{id:"new_password",proxyID:"password",helpText:"Change your password",type:h.TT_PASSWORD,init:()=>(setTimeout((()=>{t?f("Your password is weak, please change it below"):f("Your password has expired, please change it below",6e3)}),500),!0),computedValue:t=>e(t),validation:t=>g.validateSeries([()=>g.required(t),()=>g.hasLengthRangeOf(t,4,15),()=>{if(`${this.userInput.password}`.toLowerCase()===e(t))return["New password should not match old password"]}]),config:{inputType:"password"}},{id:"verify_password",proxyID:"password",helpText:"Confirm Password",type:h.TT_PASSWORD,computedValue:t=>e(t),validation:(t,o)=>g.validateSeries([()=>g.required(t),()=>{if(e(o.verify_password)!=e(o.new_password))return["New password does not match current password"]}]),config:{inputType:"password"}}],(async(e,t)=>{await w.updateUser(this.auth.userID,t)?(await this.auth.resetUserPasswordChangeCheck(),this.$router.push("/select_hc_location")):f("Unable to update user")}))}this.$router.push("/select_hc_location")}catch(e){e instanceof m?(f("Invalid username or password"),this.showPasswordButton=!0,this.showPasswordButtonTimeout=setTimeout((()=>this.showPasswordButton=!1),3e4)):b(`${e}`,5e4)}}else f("Complete form to log in")}},computed:{btnStyles(){return`display: ${this.display}; top: ${this.keyboardTop};`}}}),ae={class:"main",ref:"main"},se={class:"cells ion-padding-bottom"},ne={style:{color:"#cd853f"}},ie={class:"rows"},re={class:"cells"},le=["readonly"],de={class:"rows input-rows"},ue={class:"cells"},pe={class:"rows"},ce=["id"],he=["id"],fe=o({components:{IonItem:N,Inputs:v(oe,[["render",function(e,t,o,a,s,n){const i=I("ion-icon"),r=I("ion-button"),l=I("ion-input");return k(),x(L,null,[C("div",ae,[C("div",se,[C("h3",null,[t[7]||(t[7]=C("b",{style:{color:"#8b4513"}},"Facility: ",-1)),C("b",ne,P(e.facilityName)+" ("+P(e.district)+")",1)])]),C("div",ie,[C("div",re,[_(C("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":t[0]||(t[0]=t=>e.userInput.username=t),onClick:t[1]||(t[1]=t=>e.renderKeyBoard(t)),class:"input-boxes ion-padding",readonly:e.useVirtualInput},null,8,le),[[T,e.userInput.username]])])]),C("div",de,[C("div",ue,[S(l,{style:{margin:"0px auto","margin-top":"15px","text-align":"left"},modelValue:e.userInput.password,"onUpdate:modelValue":t[3]||(t[3]=t=>e.userInput.password=t),type:e.showPassword?"text":"password",name:"password",ref:"password",id:"password",onClick:t[4]||(t[4]=t=>e.renderKeyBoard(t)),class:"input-boxes ion-padding",placeholder:"Password",readonly:e.useVirtualInput},{default:B((()=>[!e.showPassword&&e.showPasswordButton?(k(),V(r,{key:0,onClick:e.onShowPassword,color:"light",size:"large",slot:"end"},{default:B((()=>[S(i,{size:"large",icon:e.eye},null,8,["icon"])])),_:1},8,["onClick"])):$("",!0),e.showPassword&&e.showPasswordButton?(k(),V(r,{key:1,onClick:t[2]||(t[2]=t=>e.showPassword=!1),color:"light",size:"large",slot:"end"},{default:B((()=>[S(i,{size:"large",icon:e.eyeOff},null,8,["icon"])])),_:1})):$("",!0)])),_:1},8,["modelValue","type","readonly"])])])],512),C("div",{id:"keyboard",style:A(e.btnStyles),class:"keyboard"},[(k(!0),x(L,null,z(e.keyboard,((o,a)=>(k(),x("span",{key:a},[C("div",pe,[(k(!0),x(L,null,z(o,(o=>(k(),x("div",{class:"cells",key:o},["Next"===o||"Login"===o?(k(),x("button",{key:0,id:e.btnCaption,class:"keyboard-btn login-btn",onClick:t[5]||(t[5]=t=>e.keyPress(t))},P(e.btnCaption),9,ce)):$("",!0),"Login"!=o&&"Next"!=o?(k(),x("button",{key:1,id:e.Caps.on?o.toUpperCase():o.toLowerCase(),class:"keyboard-btn",onClick:t[6]||(t[6]=t=>e.keyPress(t))},P("Del."===o||"Caps"===o?o:e.Caps.on?o.toUpperCase():o.toLowerCase()),9,he)):$("",!0)])))),128))])])))),128))],4)],64)}],["__scopeId","data-v-5581b3d6"]]),IonButton:s,IonTitle:O,IonLabel:D,IonPage:U,IonHeader:E,IonToolbar:R,IonContent:M,IonFooter:K,IonSelect:F,IonSelectOption:H},setup(){const e=Y([]),{activePlatformProfile:t,platformProfiles:o}=j(),a=Y(""),s=Y(""),n=G((()=>t.value.keyboard===Q.HIS_KEYBOARD_ONLY)),i=Object.keys(o.value).map((e=>({label:e,value:{profileName:e,...o.value[e]}})));return W(s,(e=>{t.value=(Z.find(i,{label:e})||{}).value})),q((async()=>{const o=new d;e.value=(await o.loadConfig())?.otherApps||[];const n=o.getHeadVersion();o.setActiveVersion(n);const i=await o.getApiVersion();a.value=`${n} / ${i}`,s.value=t.value?.profileName||""})),{version:a,profile:s,otherApps:e,deviceProfiles:i,useVirtualInputOnly:n,activePlatformProfile:t,coatImg:X("login-logos/Malawi-Coat_of_arms_of_arms.png"),pepfarImg:X("login-logos/PEPFAR.png"),showConfig:"true"===localStorage.getItem("useLocalStorage"),openSelect:async()=>{const t=await J("Application Selection","Please specify the application you wish to use",e.value.map((e=>e.name)),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(t.selection&&"Cancel"!=t.action){const o=e.value.find((e=>e.name===t.selection));window.open(`${o.protocol||"http"}://${o.IP}:${o.port||80}`,"_blank")}}}}}),ge={slot:"start"},we=["src"],me=["src"];e("default",v(fe,[["render",function(e,t,o,a,s,n){const i=I("ion-label"),r=I("ion-title"),l=I("ion-toolbar"),d=I("ion-header"),u=I("inputs"),p=I("ion-content"),c=I("ion-select-option"),h=I("ion-select"),f=I("ion-button"),g=I("ion-item"),w=I("ion-footer"),m=I("ion-page");return k(),V(m,null,{default:B((()=>[S(d,null,{default:B((()=>[S(l,null,{default:B((()=>[S(r,null,{default:B((()=>[S(i,{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:B((()=>t[1]||(t[1]=[C("b",{style:{color:"#8b4513"}},"National ",-1),C("b",{style:{color:"#cd853f"}},"EMR",-1)]))),_:1})])),_:1}),S(i,{class:"ion-padding",slot:"end"},{default:B((()=>[t[2]||(t[2]=ee(" Version: ")),C("b",null,P(e.version),1)])),_:1})])),_:1})])),_:1}),S(p,{fullscreen:!1,style:{width:"100%"}},{default:B((()=>[S(u,{useVirtualInput:e.useVirtualInputOnly},null,8,["useVirtualInput"])])),_:1}),S(w,null,{default:B((()=>[S(l,null,{default:B((()=>[C("span",ge,[C("img",{id:"coat",src:e.coatImg,alt:"Malawi Coat of Arms logo"},null,8,we),C("img",{id:"pepfar",src:e.pepfarImg,alt:"PEPFAR logo"},null,8,me)]),S(g,{class:"his-sm-text",style:{width:"75%"},slot:"end"},{default:B((()=>[S(i,null,{default:B((()=>t[3]||(t[3]=[ee("Device Profile")]))),_:1}),S(h,{modelValue:e.profile,"onUpdate:modelValue":t[0]||(t[0]=t=>e.profile=t),value:e.profile},{default:B((()=>[(k(!0),x(L,null,z(e.deviceProfiles,((e,t)=>(k(),V(c,{key:t,value:e.label},{default:B((()=>[ee(P(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue","value"]),S(f,{color:"dark",fill:"outline",size:"large",slot:"end","router-link":"/settings/host"},{default:B((()=>t[4]||(t[4]=[ee(" Network ")]))),_:1}),e.otherApps.length?(k(),V(f,{key:0,color:"dark",fill:"outline",size:"large",slot:"end",onClick:e.openSelect},{default:B((()=>t[5]||(t[5]=[ee(" Other Applications ")]))),_:1},8,["onClick"])):$("",!0)])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-f474746d"]]))}}}));
