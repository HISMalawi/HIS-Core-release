import{_ as w}from"./ReportMixin.vue_vue_type_script_lang-BUZJnrGJ.js";import{T as g}from"./tx_report_service-DgMsGf3a.js";import{R as A}from"./TableReportTemplate-Dfnljex-.js";import{bv as _,d as M,L as l,cz as R,_ as F,r as m,o as I,c as T,w as b,b as S}from"./index-CEHwIYqs.js";import{M as $}from"./moh_cohort_service-zbNsJO3I.js";import{_ as C,a as v,b as x,c as P}from"./_setToArray-f8stGPED.js";import{_ as N}from"./_Set-rDWlm_eg.js";import"./MultiFieldDateHelper-3uh31nyF.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./BasicReportTemplate-C1LCpIKe.js";import"./Export-BQ97ckzh.js";import"./SIngleTouchField-l8pjEMFV.js";import"./Pagination-BZcHKApi.js";import"./HisStandardForm-CG-mBCAJ.js";import"./TouchScreenForm-CoH4BwNu.js";import"./ToolbarMediumCard-C9Oru3Lp.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-CUJZqAQw.js";import"./ReportErrors-uaWLdTQ5.js";function D(t){return t!==t}var O=D;function E(t,e,s){for(var o=s-1,a=t.length;++o<a;)if(t[o]===e)return o;return-1}var V=E,k=C,q=O,y=V;function H(t,e,s){return e===e?y(t,e,s):k(t,q,s)}var L=H,B=L;function U(t,e){var s=t==null?0:t.length;return!!s&&B(t,e,0)>-1}var j=U;function z(t,e,s){for(var o=-1,a=t==null?0:t.length;++o<a;)if(s(e,t[o]))return!0;return!1}var W=z;function G(){}var X=G,u=N,Y=X,Z=v,J=1/0,K=u&&1/Z(new u([,-0]))[1]==J?function(t){return new u(t)}:Y,Q=K,tt=x,et=j,st=W,ot=P,rt=Q,at=v,it=200;function nt(t,e,s){var o=-1,a=et,r=t.length,i=!0,n=[],h=n;if(s)i=!1,a=st;else if(r>=it){var f=e?null:rt(t);if(f)return at(f);i=!1,a=ot,h=new tt}else h=e?[]:n;t:for(;++o<r;){var c=t[o],d=e?e(c):c;if(c=s||c!==0?c:0,i&&d===d){for(var p=h.length;p--;)if(h[p]===d)continue t;e&&h.push(d),n.push(c)}else a(h,d,s)||(h!==n&&h.push(d),n.push(c))}return n}var lt=nt,ht=lt;function ct(t){return t&&t.length?ht(t):[]}var dt=ct;const ft=_(dt),ut=M({mixins:[w],components:{ReportTemplate:A},data:()=>({title:"TX Curr MMD Report",cohort:{},rows:[],totals:new Set,errors:[],showStatus:!1,aggregate:{Male:{},Female:{}},columns:[[l.thTxt("Age group"),l.thTxt("Gender"),l.thNum("# of clients on <3 months of ARVs"),l.thNum("# of clients on 3 - 5 months of ARVs"),l.thNum("# of clients on >= 6 months of ARVs")]],headerInfoList:[],mohCohort:{},canValidate:!1}),watch:{async canValidate(t){t&&await this.validateReport()}},created(){this.fields=this.getDateDurationFields()},methods:{async onPeriod(t,e){this.canValidate=!1,this.totals.clear(),this.errors=[],this.showStatus=!1,this.rows=[],this.report=new g,this.mohCohort=new $,this.mohCohort.setOccupation(e.occupation),this.mohCohort.setStartDate(e.start_date),this.mohCohort.setEndDate(e.end_date),this.report.setOccupation(e.occupation),this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period=this.report.getDateIntervalPeriod(),this.report.initArvRefillPeriod(!0),await this.setMaleFemaleRows(),this.setTotalMalesRows(),await this.setTotalFemaleRows(),this.canValidate=!0,this.showStatus=!0,this.setHeaderInfoList()},buildRow(t,e,s){const o={underThreeMonths:{check:r=>r<90,data:[]},betweenThreeAndFiveMonths:{check:r=>r>=90&&r<=150,data:[]},overSixMonths:{check:r=>r>150,data:[]}},a=t[s]||{};for(const r in a){const i=parseInt(r);this.totals.add(i),Object.keys(o).forEach(n=>{this.aggregate[s][n]||(this.aggregate[s][n]=[]),o[n].check(a[r].prescribed_days)&&(o[n].data.push(i),this.aggregate[s][n].push(i))})}return[l.td(e),l.td(s),this.drill(o.underThreeMonths.data,"".concat(e," (").concat(s,"s) < 3 months of Arvs")),this.drill(o.betweenThreeAndFiveMonths.data,"".concat(e," (").concat(s,"s) 3-5 months of Arvs")),this.drill(o.overSixMonths.data,"".concat(e," (").concat(s,"s) > 6 months months of Arvs"))]},async setMaleFemaleRows(){const t=[],e=[];for(const s of R){const[o,a]=this.parseAgeGroup(s),r=await this.report.getTxCurrMMDReport(o,a);this.report.initArvRefillPeriod(!1),e.push(this.buildRow(r,s,"Female")),t.push(this.buildRow(r,s,"Male")),this.rows=[...e,...t]}},setTotalMalesRows(){this.rows.push([l.td("All"),l.td("Male"),this.drill(this.aggregate.Male.underThreeMonths,"All (Males) < 3 months of Arvs"),this.drill(this.aggregate.Male.betweenThreeAndFiveMonths,"All (Males) 3-5 months of Arvs"),this.drill(this.aggregate.Male.overSixMonths,"All (Males) > 6 months months of Arvs")])},async setTotalFemaleRows(){const t=ft(Object.values(this.aggregate.Female).flat(1)),e=await this.report.getMaternalStatus(t),s=e.FBf.concat(e.FP),o=(r,i,n)=>{const h=r.filter(f=>{const c=parseInt(f.toString());return i==="FNP"?!s.includes(c):e[i].includes(c)});return this.drill(h,n)},a=(r,i)=>{this.rows.push([l.td("All"),l.td(r),o(this.aggregate.Female.underThreeMonths,i,"All (".concat(r,"s) < 3 months of Arvs")),o(this.aggregate.Female.betweenThreeAndFiveMonths,i,"All (".concat(r,"s) 3-5 months of Arvs")),o(this.aggregate.Female.overSixMonths,i,"All (".concat(r,"s) > 6 months of Arvs"))])};a("FP","FP"),a("FNP","FNP"),a("FBF","FBf")},setHeaderInfoList(){this.headerInfoList=[{label:"Total clients",value:this.totals.size,other:{onclick:()=>this.runTableDrill(Array.from(this.totals),"Total Clients")}}]},validateReport(){const t={total_alive_and_on_art:{param:this.totals.size,check:(s,o)=>o>s,error:(s,o)=>"\n                        MoH cohort Alive and on ART clients <b>(".concat(s,")</b> is not\n                        matching with total TX MMD clients <b>(").concat(o,")</b>.\n                    ")}};this.mohCohort.validateIndicators(t,s=>this.errors=s)===-1&&(this.errors=["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])}}});function pt(t,e,s,o,a,r){const i=m("report-template"),n=m("ion-page");return I(),T(n,null,{default:b(()=>[S(i,{title:t.title,period:t.period,rows:t.rows,fields:t.fields,columns:t.columns,reportPrefix:"PEPFAR",config:{showIndex:!0},validationErrors:t.errors,showValidationStatus:t.showStatus,headerInfoList:t.headerInfoList,onReportConfiguration:t.onPeriod},null,8,["title","period","rows","fields","columns","validationErrors","showValidationStatus","headerInfoList","onReportConfiguration"])]),_:1})}const Vt=F(ut,[["render",pt]]);export{Vt as default};
