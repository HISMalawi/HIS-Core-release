import{d as h,I as _,K as C,dF as g,t as v,ai as F,aV as s,_ as b,r as f,o as D,c as y,w as H,b as P}from"./index-BFVcutZq.js";import{H as $}from"./HisStandardForm-DO3sZVdL.js";import{P as t}from"./PersonFieldHelper-ByV868UO.js";import"./LocationFieldOptions-C8xpWQA4.js";import"./storage-DBvOSj8j.js";const k=h({components:{IonPage:_,HisStandardForm:$},setup(){const i=C([]),{htsClient:a}=g(),{visitData:u,visitID:o,nextTask:c,patientDashboardUrl:d}=g({onInitVisit:async()=>{if("".concat(a.givenName," ").concat(a.familyName).toLowerCase()!="unknown unknown")return v("Client already registered");i.value=[t.getGivenNameField(),t.getFamilyNameField(),...F(t.getDobConfig()),t.getHomeRegionField(),t.getHomeDistrictField(),t.getHomeTaField(),t.getHomeVillageField(),{...t.getCurrentRegionField(),summaryMapValue:(n,m,r)=>{if(/use home/i.test("".concat(n.value))){const e=r.person;return[{label:"Current region",value:e==null?void 0:e.current_region},{label:"Current District/Country",value:e==null?void 0:e.current_district},{label:"Current Traditional Authority",value:e==null?void 0:e.current_traditional_authority},{label:"Current village",value:e==null?void 0:e.current_village}]}return{label:"Current Region",value:n.label}}},{...t.getCurrentDistrictField(),condition:n=>!n.current_region.label.match(/foreign|use home/i)},{...t.getCurrentTAfield(),condition:n=>!n.current_region.label.match(/foreign|use home/i)},{...t.getCurrentVillageField(),condition:n=>!n.current_region.label.match(/foreign|use home/i)},...t.getLandmarkFields(),t.getCellNumberField()]}});async function l(n,m){var r,e;s().saveOffline({id:o.value,label:"HTS Full Client Registration",personParams:{npid:a.npid,person:{...((e=(r=u.value)==null?void 0:r.personParams)==null?void 0:e.person)||{},...t.resolvePerson(m)}}}),c(),s().synchronizeRecord(o.value).then(p=>s().saveOffline(p))}return{patientDashboardUrl:d,onFinish:l,fields:i}}});function N(i,a,u,o,c,d){const l=f("his-standard-form"),n=f("ion-page");return D(),y(n,null,{default:H(()=>[P(l,{formLabel:"Additional client information",cancelDestinationPath:i.patientDashboardUrl(),"on-finish-action":i.onFinish,fields:i.fields},null,8,["cancelDestinationPath","on-finish-action","fields"])]),_:1})}const A=b(k,[["render",N]]);export{A as default};
