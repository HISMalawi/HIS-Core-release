System.register(["./index-legacy-Dg5P6bX-.js","./dynamic-import-helper-legacy-arUa2LZV.js","./HisStandardForm-legacy-BXV61qjj.js","./useEncounter-legacy-Bp6E5sCN.js","./util-legacy-CjANJSja.js","./commons-legacy-CiEua9CM.js","./lab_service-legacy-B78INX4z.js","./LocationFieldOptions-legacy-dM5Ij6EC.js","./TouchScreenForm-legacy-Bqug27CT.js","./ToolbarMediumCard-legacy-DWokgyDV.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-D3j1oaCn.js","./isEmpty-legacy-rdjCNuhy.js","./_Set-legacy-BL8ow4HL.js","./_setToArray-legacy-jEwcQpqP.js","./encounter_guidelines-legacy-mRSBdMQj.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,l,n,o,i,r,s,u,c,d,_,m,T,p,h,y,v,g,L,R,b,E,M,U,O,S;return{setters:[e=>{a=e.d,l=e.K,n=e.b5,o=e.cV,i=e.E,r=e.S,s=e.t,u=e.V,c=e.G,d=e.a$,_=e.cZ,m=e.o,T=e.c,p=e.w,h=e.b,y=e.cl,v=e.I,g=e.cX},e=>{L=e.F},e=>{R=e.H},e=>{b=e.u},e=>{E=e.g},e=>{M=e.m,U=e.r},e=>{O=e.L},e=>{S=e.e},null,null,null,null,null,null,null,null,null],execute:function(){e("default",a({__name:"Lab",setup(e){const t=l([]),a=new n(-1,o.LAB_ORDER),f=i(),{goToNextTask:D,patientDashboardUrl:A}=b(((e,l,n,o)=>{a.patientID=l,a.providerID=e,t.value=[(()=>{let e=[];return{id:"sample_type",helpText:"TB Test Specimens Types",type:L.TT_SELECT,requireNext:!1,init:async()=>{try{e=await r.getJson(`/programs/${r.getProgramID()}/lab_tests/panels?test_type=TB Tests`)}catch(t){return s("Unable to load samples!"),!1}return!0},computedValue:e=>({concept_id:E("SAMPLE"),value_coded:E(`${e.value}`),obs_datetime:a.date}),validation:e=>u.required(e),options:()=>M(e)}})(),(()=>{const e={};return{id:"examination",helpText:"Examination",type:L.TT_SELECT,beforeNext:async t=>{if(!e[t.other])try{const[l,n]=(await c.get(t.other)).split("_");e[t.other]=d(`${a.date} ${d().format("HH:mm:ss")}`).add(parseInt(l),n).format("YYYY-MM-DD HH:mm:ss")}catch(l){console.warn(`${l}`)}return!0},defaultValue:()=>f?.query?.test,computedValue:t=>[{concept_id:E("TEST_REQUESTED"),value_coded:E(`${t.value}`),obs_datetime:a.date},...e[t.other]?[{concept_id:E("Estimated turnaround time for result"),value_datetime:e[t.other],obs_datetime:a.date}]:[]],validation:e=>u.required(e),options:()=>[{value:"MICROSCOPY",label:"Microscopy",other:_.MICROSCOPY_RESULT_TURN_AROUND},{value:"XPERT_MTB_RIF",label:"Xpert MTB/RIF",other:_.XPERT_MTB_RIF_RESULT_TURN_AROUND},{value:"XPERT_MTB_RIF_ULTRA",label:"Xpert MTB/RIF Ultra",other:_.XPERT_MTB_RIF_ULTRA_RESULT_TURN_AROUND},{value:"CULTURE_AND_DST",label:"Culture and DST",other:_.CULTURE_AND_DST_RESULT_TURN_AROUND},{value:"LPA",label:"LPA",other:_.LPA_RESULT_TURN_AROUND},{value:"LAM",label:"LAM",other:_.LAM_RESULT_TURN_AROUND}]}})(),{id:"target_lab",helpText:"Select Lab:",type:L.TT_SELECT,computedValue:e=>({concept_id:E("LAB"),value_text:`${e.value}`,obs_datetime:a.date}),validation:e=>u.required(e),defaultValue:()=>r.getLocationName(),options:async(e,t="")=>{try{return await S(t)}catch(a){return M([`${r.getLocationName()}`])}},config:{showKeyboard:!0,isFilterDataViaApi:!0}},(()=>{let e=!1;return{id:"time_line",helpText:"Follow Up Lab Order Month for Month",type:L.TT_SELECT,init:async()=>{const t=await O.getRecentOrders(l);if(t){const l=d(t.encounter_datetime).format("YYYY-MM-DD"),n=d(a.date).diff(l,"days",!0);e=n>=28}return!0},defaultValue:()=>{const e=d(a.date).diff(o.outcomeStartDate||a.date,"months");if(!(o.isBdeMode||e<=0))return`Month ${e}`},condition:()=>e,validation:e=>u.required(e),computedValue:e=>{if("Other"!=e.value)return[{concept_id:E("FOLLOW_UP"),value_text:e.value,obs_datetime:a.date}]},options:()=>[{value:"Month 2",label:"Month 2"},{value:"Month 3",label:"Month 3"},{value:"Month 4",label:"Month 4"},{value:"Month 6",label:"Month 6"},{value:"Other",label:"Other"}]}})(),{id:"otherTimeLine",helpText:"Other Follow Up Lab Order Month for Month:",type:L.TT_NUMBER,computedValue:e=>({concept_id:E("FOLLOW_UP"),value_text:`Month ${e.value}`,obs_datetime:a.date}),validation:e=>u.required(e),condition:e=>"Other"===e.time_line.value}]}));function N(e){return f?.query?.reason?`${f?.query?.reason}`:e.time_line?.value?"FOLLOW_UP":"DIAGNOSIS"}async function w(e,t){var l;await a.createEncounter(),await a.saveObservationList([...(l=e,[{concept_id:E("TEST_TYPE"),value_coded:E("TB"),obs_datetime:a.date},{concept_id:E("REASON_FOR_TEST"),value_coded:E(N(l)),obs_datetime:a.date}]),...await U(t)]),await async function(e,t){const l={tests:[{test_type:"TB",sample_status:"N/A",target_lab:e.target_lab.value,sample_type:e.sample_type.value,recommended_examination:e.examination.value,sample_date:a.date,sending_facility:r.getLocationName(),time_line:"Other"===e.time_line?.value?`Month ${e.otherTimeLine?.value}`:e.time_line?.value||"N/A",treatment_history:"N/A",reason:e.time_line?.value?"Follow up":"Diagnosis"}],encounter_id:t,requesting_clinician:r.getUserName()};await r.postJson(`programs/${r.getProgramID()}/lab_tests/orders`,l),await g.printLabOrder(a.patientID,l.tests[0])}(e,a.encounterID),D()}return(e,a)=>(m(),T(y(v),null,{default:p((()=>[h(R,{cancelDestinationPath:y(A),onFinishAction:w,fields:t.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
