System.register(["./index-legacy-DaDUPm0b.js","./MultiFieldDateHelper-legacy-DbDPqams.js","./BasicReportTemplate-legacy-Cb7UOeAq.js","./dynamic-import-helper-legacy-DYK5bIOV.js"],(function(t,e){"use strict";var r,a,i,n,s,o,l,u,d,p,c,h,m,w,g;return{setters:[t=>{r=t.d,a=t.aJ,i=t.bA,n=t.H,s=t.L,o=t.O,l=t.bB,u=t.V,d=t.R,p=t.S,c=t.ab,h=t.P},t=>{m=t.g},t=>{w=t.D},t=>{g=t.F}],execute:function(){t("_",r({data:()=>({app:a.getActiveApp(),fields:[],report:{},reportReady:!1,period:"",startDate:"",endDate:"",customFileName:"",isMilitarySite:!1,drillDownCache:{}}),methods:{formatGender:t=>i(t),toDate:t=>n.toStandardHisDisplayFormat(t),sortByArvNumber(t,e="arv_number"){try{return t.sort(((t,r)=>this.getArvInt(t[e])>this.getArvInt(r[e])?1:-1))}catch(r){return console.error(r),t}},getArvInt(t){if("string"==typeof t){const e=t.split("-")[2],r=parseInt(e);return"number"==typeof r?r:0}return 0},parseAgeGroup:t=>"<1 year"===t?[0,0]:"90 plus years"===t?[90,1e3]:t.split("-").map((t=>parseInt(t,10))),tdARV(t,e={}){return s.td(t,{sortValue:this.getArvInt(t),...e})},confirmPatient(t){return this.$router.push(`/patients/confirm?person_id=${t}`)},async drilldownAsyncRows(t,e,r,a=!0){(await o.create({component:w,cssClass:"large-modal",componentProps:{title:t,columns:e,asyncRows:r,canExport:a,showFilters:!0,rowsPerPage:50,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>o.dismiss()}})).present()},async drilldownData(t,e,r,a){(await o.create({component:w,cssClass:"large-modal",componentProps:{title:t,columns:e,rows:r,rowParser:a,rowsPerPage:50,showFilters:!0,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>o.dismiss()}})).present()},getDefaultDrillDownTable(){return{rowParser:async t=>{let e=0;const r=t.map((async t=>{let r=null,a=null;if(c.isArray(t)){const[e,r]=t;if(a=e,r in this.drillDownCache)return[a,...this.drillDownCache[r].slice(1)]}else if(r=t,r in this.drillDownCache)return this.drillDownCache[r];const i=await h.findByID(r),n=new h(i),l=[];return a&&(e=1,l.push(a)),l.push(this.tdARV(n.getArvNumber())),l.push(s.td(this.formatGender(n.getGender()))),l.push(s.tdDate(n.getBirthdate().toString())),l.push(s.tdBtn("Show",(async()=>{await o.dismiss({}),this.$router.push({path:`/patient/dashboard/${r}`})}))),this.drillDownCache[r]=l,l}));return(await Promise.all(r)).sort(((t,r)=>t[e].sortValue>r[e].sortValue?1:-1))},columns:[[s.thTxt("ARV number"),s.thTxt("Gender"),s.thTxt("Birth Date"),s.thTxt("Actions")]]}},runTableDrill(t,e="Drilldown patients"){const{columns:r,rowParser:a}=this.getDefaultDrillDownTable();this.drilldownData(e,r,t,a)},drill(t,e="Drill table"){return t&&t.length>0?s.tdLink(t.length,(()=>this.runTableDrill(t,e))):s.td(0)},getQuaterOptions:()=>l.getReportQuarters().map((t=>({label:t.name,value:t.start,other:t}))),getDateDurationFields(t=!1,e=!1,r=5,a=p.getSessionDate()){return[{id:"quarter",helpText:"Select Quarter",type:g.TT_SELECT,condition:()=>t,validation:t=>u.required(t),options:()=>{let t=l.getReportQuarters(r).map((t=>({label:t.name,value:t.start,other:t})));return e&&(t=[{label:"Set custom period",value:"custom_period",other:{}},...t]),t}},...m({id:"start_date",helpText:"Start",required:!0,condition:e=>e.quarter&&"custom_period"===e.quarter.value||!t,minDate:()=>"2000-01-01",maxDate:()=>a,estimation:{allowUnknown:!1},computeValue:t=>t}),...m({id:"end_date",helpText:"End",required:!0,condition:e=>e.quarter&&"custom_period"===e.quarter.value||!t,unload:(t,e,r,a)=>{"next"===e&&(this.endDate=a.end_date)},minDate:(t,e)=>e.start_date,maxDate:()=>a,estimation:{allowUnknown:!1},computeValue:t=>t}),{id:"occupation",helpText:"Report Group",type:g.TT_SELECT,init:async()=>(this.isMilitarySite=await d.get("IS_MILITARY_SITE"),!0),computedValue:t=>t.value,condition:()=>"ART"===this.app?.applicationName&&this.isMilitarySite,validation:t=>u.required(t),options:()=>[{label:"All",value:"All"},{label:"Military",value:"Military"},{label:"Civilian",value:"Civilian"}]}]}}}))}}}));
