System.register(["./index-legacy-B5_bWIZW.js"],(function(t,e){"use strict";var i,a,s,r,n;return{setters:[t=>{i=t.a_,a=t.T,s=t.H,r=t.a$,n=t.ae}],execute:function(){t("A",class extends i{patientID;patientAge=-1;artDuration=0;currentOutcome="";isTransferIn=!1;whoStage="";hasHighVl=!1;constructor(t){super(),this.patientID=t}generatePatientCategory(){const t={"New Positive":()=>this.isNewHivPositive(),"Return after lost to follow up":()=>this.isReturnToCare(),"Children < 5 years":()=>this.isLessThanFive(),"High viral load":()=>this.hasHighVl,"WHO stage":()=>this.isWhoStageThreeOrFour()};for(const e in t)if(t[e]())return e;return""}isLessThanFive(){return this.patientAge<5}isNewHivPositive(){return!this.isTransferIn&&this.artDuration<=3&&!this.isReturnToCare()}isReturnToCare(){return/defaulted|stopped/i.test(this.currentOutcome)}isWhoStageThreeOrFour(){return/who stage III|who stage iv/i.test(this.whoStage)}getTreatmentStatus(){return i.getJson(`programs/1/patients/${this.patientID}`)}async isPositiveForCryptococcalMeningitis(){return"Positive"===await i.getFirstValueCoded(this.patientID,"Cryptococcal Meningitis status")}async getHighVlStatus(){const t=await a.get("PATIENT_LAB_ORDERS",{patientID:this.patientID}),e=await i.getFirstObs(this.patientID,"HIV viral load")||{},o=e?.obs_datetime?s.toStandardHisFormat(e.obs_datetime):"",u=t.reduce(((t,e)=>(e.tests.forEach((e=>{t[e.name]||(e.result||[]).forEach((i=>{(!o||new Date(s.toStandardHisFormat(i.date))>=new Date(o))&&(t[e.name]=i)}))})),t)),{});return!!(this.artDuration>12&&u["HIV viral load"]&&r.isHighViralLoadResult(u["HIV viral load"]))||!n.isEmpty(e)&&"LDL"!==e.value_text&&r.detectHighVl(e.value_numeric,e.value_modifier)}async loadTreatmentDetails(){const t=await this.getTreatmentStatus();this.artDuration=isNaN(t.art_duration)?0:t.art_duration,this.hasHighVl=await this.getHighVlStatus(),this.currentOutcome=t.current_outcome,this.isTransferIn=/yes/i.test(`${t.is_transfer_in}`)}})}}}));
