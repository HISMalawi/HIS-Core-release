System.register(["./index-legacy-DtHsTz02.js","./TableView-legacy-vT4Y8Ct5.js","./tb_report_service-legacy-CchLltIi.js","./v2utils-legacy-Dfr4nivu.js","./TBDrilldown-legacy-0q9RfDt9.js","./Export-legacy-MFuHIWtb.js","./index-legacy-ChfhFQZo.js"],(function(e,a){"use strict";var t,l,i,r,s,o,n,c,u,p,g,_,m,v,d,f,b,y,h,T,w;return{setters:[e=>{t=e.d,l=e.r,i=e.t,r=e.u,s=e.v,o=e.w,n=e.x,c=e.y,u=e.dV,p=e.a9,g=e.aa,_=e.a5,m=e.aM,v=e.O,d=e.d3,f=e.aq},e=>{b=e.v},e=>{y=e.T},e=>{h=e.w,T=e.d},e=>{w=e.T},null,null],execute:function(){e("default",t({__name:"TBCaseFindingReport",setup(e){const a=new y,t=l([]),P=l(""),B=l(""),x=l(""),C=l([]),E=l([]),F=l([]),L=["0-4","5-14","15-24","25-34","35-44","45-54","55-64","65+"],$=[{label:"New Smear positive",ref:"new_smear_positive",tags:["cases"]},{label:"New MTB Detected Xpert",ref:"new_mtb_detected_xpert",tags:["cases"]},{label:"New Pulmonary Clinically Diagnosed",ref:"new_pulmonary_clinically_diagnosed",tags:["cases"]},{label:"New EPTB",ref:"new_eptb",tags:["cases"]},{label:"Relapse Bacteriologically Confirmed",ref:"relapse_bacteriologically_confirmed",tags:["cases"]},{label:"Treatment Failure Bacteriologically Confirmed",ref:"treatment_failure_bacteriologically_confirmed",tags:["cases"]},{label:"Treatment LTF Bacteriologically Confirmed",ref:"treatment_ltf_bacteriologically_confirmed",tags:["cases"]},{label:"Treatment LTF Clinically Diagnosed Pulmonary",ref:"treatment_ltf_clinically_diagnosed_pulmonary",tags:["cases"]},{label:"Treatment LTF EPTB",ref:"treatment_ltf_eptb",tags:["cases"]},{label:"Relapse Clinical Pulmonary",ref:"relapse_clinical_pulmonary",tags:["cases"]},{label:"Relapse EPTB",ref:"relapse_eptb",tags:["cases"]},{label:"Other Previously Treated Bacteriologically Confirmed",ref:"other_previously_treated_bacteriologically_confirmed",tags:["cases"]},{label:"Other Previously Treated Clinical Pulmonary",ref:"other_previously_treated_clinical_pulmonary",tags:["cases"]},{label:"Other Previously Treated EPTB",ref:"other_previously_treated_eptb",tags:["cases"]},{label:"Unknown Previous Treatment History Bacteriological",ref:"unknown_previous_treatment_history_bacteriological",tags:["cases"]},{label:"Unknown Previous Treatment History EPTB",ref:"unknown_previous_treatment_history_eptb",tags:["cases"]},{label:"Patients with Presumptive TB Undergoing Bacteriological Examination Via Xpert",ref:"patients_with_presumptive_tb_undergoing_bacteriological_examination_via_xpert",tags:["presumptives"]},{label:"Patients with Presumptive TB Undergoing Bacteriological Examination Via Microscopy",ref:"patients_with_presumptive_tb_undergoing_bacteriological_examination_via_microscopy",tags:["presumptives"]},{label:"Patients with Presumptive TB with Positive Bacteriological Examination Via Xpert",ref:"patients_with_presumptive_tb_with_positive_bacteriological_examination_via_xpert",tags:["presumptives"]},{label:"Patients with Presumptive TB with Positive Bacteriological Examination Via Microscopy",ref:"patients_with_presumptive_tb_with_positive_bacteriological_examination_via_microscopy",tags:["presumptives"]}];function j(){const e=[{label:"#",ref:"index",span:{thRowspan:2}},{label:"Age Category",ref:"age_group",span:{thRowspan:2}},...C.value.map((e=>({...e,ref:"",span:{thColspan:2}})))],a=C.value.reduce(((e,a)=>{const t=e=>({label:e,ref:`${a.ref}_${e.toLowerCase()}`,secondaryLabel:`${a.label} (${"M"===e?"Male":"Female"})`,toValue:e=>`${e.length}`,tdClick:e=>e.refData.length&&async function(e,a){(await f.create({component:w,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e,patientIdentifiers:a,onFinish:()=>f.getTop().then((e=>e&&f.dismiss()))}})).present()}(a.label,e.refData)});return[...e,t("F"),t("M")]}),[]);F.value=[e,a]}const D=()=>h((async()=>{if(!B.value||!x.value)return v("Year and quarter are required!");const e=(await a.getTBCaseFindingReport(B.value,parseInt(`${x.value}`),C.value.map((e=>e.ref)))).reduce(((e,a)=>{const{indicator:t,...l}=a;return{...e,[t]:l}}),{}),l=L.reduce(((a,t)=>{const l={age_group:t};return Object.keys(e).forEach((i=>{const r=`${i}_m`,s=`${i}_f`,o=e[i][t].male,n=e[i][t].female;l[r]=o,l[s]=n,a.aggregates={...a.aggregates,[r]:[...a.aggregates?.[r]??[],...o],[s]:[...a.aggregates?.[s]??[],...n]}})),a.rows.push(l),a}),{aggregates:{},rows:[]});return t.value=T([...l.rows,{age_group:"Totals",...l.aggregates}]),E.value=[{text:"All",icon:d,color:"primary",action:()=>{C.value=$,j(),D()}},{text:"Show Presumptives",icon:d,color:"primary",action:()=>{C.value=$.filter((e=>e.tags.includes("presumptives"))),j(),D()}},{text:"Cases",icon:d,color:"primary",action:()=>{C.value=$.filter((e=>e.tags.includes("cases"))),j(),D()}}],!0})),M=()=>u([{id:"indicator",helpText:"Indicators",type:p.TT_SELECT,validation:e=>g.required(e),options:()=>[{label:"All",value:"all",other:()=>$},{label:"Cases",value:"cases",other:()=>$.filter((e=>e.tags.includes("cases")))},{label:"Presumptives",value:"presumptives",other:()=>$.filter((e=>e.tags.includes("presumptives")))},{label:"Custom Indicators",value:"custom"}]},{id:"custom",helpText:"Custom indicators",type:p.TT_MULTIPLE_SELECT,validation:e=>g.required(e),condition:e=>"custom"===e.indicator.value,options:()=>$.map((e=>({label:e.label,value:e.ref,other:e})))}],(e=>{t.value=[],C.value=[],B.value=e.year.value,x.value=e.quarter.value,P.value=`Q${x.value} ${B.value}`,"function"==typeof e.indicator.other?C.value=e.indicator.other():m.isEmpty(e.custom)||(C.value=e.custom.map((e=>e.other))),C.value.length&&(j(),D())}));return i((()=>M())),(e,a)=>(r(),s(c(_),null,{default:o((()=>[n(b,{title:"TB Case Finding Report",subtitle:P.value,columns:F.value,columnData:t.value,headerBadge:E.value,rowsPerPage:100,onConfigure:M},null,8,["subtitle","columns","columnData","headerBadge"])])),_:1}))}}))}}}));
