System.register(["./index-legacy-3d5L0hak.js","./FieldMixin.vue_vue_type_script_lang-legacy-BG5_20pC.js","./BaseTextInput-legacy-4kw_Xb1l.js"],(function(e,t){"use strict";var l,a,i,s,u,n,r,d,o,c,h,g,p,f,y,b,m,_,D,v,k,x,T,E,C,z,N,S,w,V,I,$,B,M,P,Y;return{setters:[e=>{l=e.d,a=e.bY,i=e.a7,s=e.a6,u=e.a5,n=e.$,r=e.b1,d=e.a4,o=e.a3,c=e.a8,h=e.ao,g=e.dg,p=e.ck,f=e.aN,y=e.aE,b=e.au,m=e.ad,_=e.ae,D=e.dz,v=e.H,k=e.bC,x=e.dp,T=e.aa,E=e.af,C=e.a,z=e.c,N=e.w,S=e.b,w=e.E,V=e.J,I=e.G,$=e.C,B=e.a2,M=e.M},e=>{P=e._},e=>{Y=e.default}],execute:function(){var t=document.createElement("style");t.textContent="ion-label[data-v-e9c2b14d]{font-weight:700}.border-right[data-v-e9c2b14d]{border-right:solid 1px #ccc}.scroll-list[data-v-e9c2b14d]{height:70vh;overflow:auto}.input_display[data-v-e9c2b14d]{font-size:1.3em}\n/*$vite$:1*/",document.head.appendChild(t);const A=l({components:{HisTextInput:Y,ViewPort:a,IonInput:i,IonLabel:s,IonList:u,IonItem:n,IonGrid:r,IonCol:d,IonRow:o,IonButton:c},mixins:[P],data:()=>({drugs:[],allDrugsByName:[],selectedDrug:null,entryDate:h.getSessionDate()}),mounted(){this.init()},async activated(){this.init()},methods:{fmtNumber:e=>g(e),fmtDate:e=>p(e),async init(){this.$emit("onFieldActivated",this),await this.setDefaultValue()},async setDefaultValue(){const e=await this.options();this.drugs=this.drugs.filter((t=>e.map((e=>e.label)).includes(t.label))),e.forEach((e=>{const t={tabs:null,tins:null,expiry:null,batchNumber:null},l={label:e.label,entries:[{...t},{...t},{...t}],...e.value};f.find(this.drugs,{label:e.label})||this.drugs.push(l)})),this.drugs.length>=1&&this.selectDrug(0),"function"==typeof this.config.entryDate&&(this.entryDate=this.config.entryDate(this.fdata,this.cdata))},getModalTitle(e){return`${e} (${this.drugs[this.selectedDrug].short_name})`},getDrugValue(e,t){return this.drugs[this.selectedDrug].entries[e][t]},setDrugValue(e,t,l){this.drugs[this.selectedDrug].entries[e][t]=l?l.value:""},useCustomPackSize(e){return f.isEmpty(this.packSizes)||e.standard_pack_size.label.includes("Other")},async selectPackSize(e){await y([{id:"standard_pack_size",helpText:"Select Pack Size",type:m.TT_SELECT,condition:()=>!f.isEmpty(this.packSizes),defaultValue:()=>this.getDrugValue(e,"tabs"),options:()=>[...this.packSizes.map((e=>({label:`${e}`,value:e}))),{label:"Other (specify)",value:"Other"}]},{id:"custom_pack_size",helpText:"Input quantity",type:m.TT_NUMBER,defaultValue:()=>this.getDrugValue(e,"tabs"),validation:e=>_.required(e),condition:e=>this.useCustomPackSize(e),config:{showKeyboard:!0}}],(async t=>{this.setDrugValue(e,"tabs",this.useCustomPackSize(t)?t.custom_pack_size:t.standard_pack_size),await b.dismiss()}))},enterTins(e){D({id:"tins",helpText:this.getModalTitle("Enter number of tins/pallets"),type:m.TT_NUMBER,defaultValue:()=>this.getDrugValue(e,"tins"),validation:e=>!e||e&&!e.value?null:_.validateSeries([()=>_.isNumber(e),()=>e.value<=0?["Number of tins must be greater than 1"]:null])},(t=>this.setDrugValue(e,"tins",t)))},enterBatch(e){D({id:"batch",helpText:this.getModalTitle("Enter batch number"),type:m.TT_TEXT,config:{initialkb:"qwerty"},defaultValue:()=>this.getDrugValue(e,"batchNumber")},(t=>{const l={...t},a=`${l.value}`.toUpperCase();l.label=a,l.value=a,this.setDrugValue(e,"batchNumber",l)}))},enterExpiry(e){D({id:"expiry",helpText:this.getModalTitle("Enter expiry date")+` (Delivery Date: ${v.toStandardHisDisplayFormat(this.entryDate)})`,type:m.TT_FULL_DATE,defaultValue:()=>this.getDrugValue(e,"expiry"),validation:e=>{if(e&&e.value)return k(e.value).isBefore(k(this.entryDate).add(30,"day"))?["You are not allowed to enter drugs that are expiring within the next 30 days from the delivery date"]:null}},(t=>this.setDrugValue(e,"expiry",t)))},addRow(){this.drugs[this.selectedDrug].entries.push({tabs:null,tins:null,expiry:null,batchNumber:null})},selectDrug(e){this.selectedDrug=e},validateEntry:e=>!(f.isEmpty(e.tins)||f.isEmpty(e.expiry)||f.isEmpty(e.batchNumber)||f.isEmpty(e.tabs.toString()))},computed:{packSizes(){return null===this.selectedDrug?[]:x.getPackSizes(this.drugs[this.selectedDrug].drug_inventory_id)},fullSelectedDrugName(){try{return this.drugs[this.selectedDrug].fullName}catch(e){return"N/A"}},enteredDrugs(){const e=[];return this.drugs.forEach((t=>{t.entries.filter((e=>this.validateEntry(e))).forEach((l=>{e.push({label:t.short_name,value:{...t,...l,tabs:l.tabs}})}))})),e}},watch:{clear(){this.drugs=this.drugs.map((e=>(e.entries=e.entries.map((e=>(e.tins=null,e.expiry=null,e.batchNumber=null,e))),e)))},drugs:{handler(){this.$emit("onValue",this.enteredDrugs)},immediate:!0,deep:!0}}});e("default",T(A,[["render",function(e,t,l,a,i,s){const u=E("his-text-input"),n=E("ion-item"),r=E("ion-list"),d=E("ion-col"),o=E("ion-label"),c=E("ion-input"),h=E("ion-row"),g=E("ion-button"),p=E("ion-grid"),f=E("view-port");return C(),z(f,null,{default:N((()=>[S(u,{readonly:"",value:e.fullSelectedDrugName},null,8,["value"]),S(p,{style:{background:"white"}},{default:N((()=>[S(h,null,{default:N((()=>[S(d,{size:"4",class:"border-right scroll-list"},{default:N((()=>[(C(!0),w(V,null,I(e.drugs,((t,l)=>(C(),z(r,{key:l},{default:N((()=>[S(n,{detail:"",color:l===e.selectedDrug?"secondary":"",onClick:t=>e.selectDrug(l)},{default:N((()=>[$(B(`${t.short_name} (${t.code})`),1)])),_:2},1032,["color","onClick"])])),_:2},1024)))),128))])),_:1}),S(d,null,{default:N((()=>[null!==e.selectedDrug?(C(),z(p,{key:0,class:"scroll-list"},{default:N((()=>[(C(!0),w(V,null,I(e.drugs[e.selectedDrug].entries,((l,a)=>(C(),z(h,{key:a},{default:N((()=>[S(d,null,{default:N((()=>[S(n,null,{default:N((()=>[S(o,{position:"floating"},{default:N((()=>t[0]||(t[0]=[$("Pack Size")]))),_:1}),S(c,{readonly:"",placeholder:"0",value:e.fmtNumber(l.tabs),onClick:t=>e.selectPackSize(a)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024),S(d,null,{default:N((()=>[S(n,null,{default:N((()=>[S(o,{position:"floating"},{default:N((()=>t[1]||(t[1]=[$("Tins/Pallets")]))),_:1}),S(c,{readonly:"",placeholder:"0",value:e.fmtNumber(l.tins),onClick:t=>e.enterTins(a)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024),S(d,null,{default:N((()=>[S(n,null,{default:N((()=>[S(o,{position:"floating"},{default:N((()=>t[2]||(t[2]=[$("Expiry Date")]))),_:1}),S(c,{readonly:"",placeholder:"DD/MM/YYYY",value:e.fmtDate(l.expiry),onClick:t=>e.enterExpiry(a)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024),S(d,null,{default:N((()=>[S(n,null,{default:N((()=>[S(o,{position:"floating"},{default:N((()=>t[3]||(t[3]=[$("Batch Number")]))),_:1}),S(c,{readonly:"",placeholder:"e.g. 'ABC-123'",value:l.batchNumber,onClick:t=>e.enterBatch(a)},null,8,["value","onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),S(h,null,{default:N((()=>[S(d,null,{default:N((()=>[S(g,{onClick:e.addRow,siz:"large"},{default:N((()=>t[4]||(t[4]=[$("Add row")]))),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):M("",!0)])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-e9c2b14d"]]))}}}));
