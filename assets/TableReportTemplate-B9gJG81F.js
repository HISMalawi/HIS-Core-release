import{d as O,O as N,an as U,b_ as z,a5 as Y,S as j,Q as q,aY as G,a4 as Q,a0 as J,b$ as K,U as W,c0 as X,al as p,aL as u,aJ as _,as as Z,bw as x,c1 as ee,bm as f,aj as v,c2 as F,aO as te,af as oe,a8 as se,ad as o,u as i,B as d,aE as re,c3 as ae,x as s,v as g,w as t,a1 as a,G as l,z as c,Y as h,E as S,C as ie,c4 as ne}from"./index-CG6KEPsv.js";import{t as le,a as ce}from"./Export-ngX2Az_3.js";import{H as he}from"./HisStandardForm-CWpBcokh.js";import{R as pe}from"./ReportErrors-CnbOzUh9.js";const ue=O({components:{HisStandardForm:he,IonHeader:N,ReportTable:U,HisFooter:z,IonPage:Y,IonContent:j,IonToolbar:q,IonChip:G,IonFooter:Q,IonLabel:J,IonThumbnail:K,IonItem:W,IonImg:X},props:{encryptPDF:{type:Boolean,default:!1},showValidationStatus:{type:Boolean,default:!1},validationErrors:{type:Array,default:()=>[]},config:{type:Object},headerInfoList:{type:Array,default:()=>[]},reportPrefix:{type:String,default:""},reportLogo:{type:String},showtitleOnly:{type:Boolean,default:!1},title:{type:String,required:!0},period:{type:String},showFilters:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},columns:{type:Object,required:!0},rows:{type:Object,required:!0},customBtns:{type:Array,default:()=>[]},hasServerSideCaching:{type:Boolean,default:!1},canExportPDf:{type:Boolean,default:!0},canExportCsv:{type:Boolean,default:!0},enabledPDFHorizontalPageBreak:{type:Boolean,default:!1},onFinishBtnAction:{type:Function},onReportConfiguration:{type:Function,required:!0},onDefaultConfiguration:{type:Function},customFileName:{type:String,default:""}},data:()=>({date:"",formData:{},btns:[],computeFormData:{},activeColumns:[],activeRows:[],isLoadingData:!1,canShowReport:!1,siteUUID:p.getSiteUUID(),apiVersion:p.getApiVersion(),coreVersion:p.getCoreVersion(),artVersion:p.getAppVersion(),tableCssTheme:"art-report-theme"}),watch:{validationErrors:{handler(e){u.isEmpty(e)||this.showErrors()},deep:!0,immediate:!0},fields:{handler(e){u.isEmpty(e)?(this.canShowReport=!0,this.refreshTimeStamp()):(this.canShowReport=!1,this.btns.forEach(n=>{n.name==="Back"&&(n.visible=!0)}))},immediate:!0}},computed:{logo(){if(!this.reportLogo&&typeof this.reportPrefix=="string"){if(this.reportPrefix.match(/pepfar/i))return _("login-logos/PEPFAR.png");if(this.reportPrefix.match(/moh/i))return _("login-logos/Malawi-Coat_of_arms_of_arms.png")}return _("reports.png")},hasErrors(){return!u.isEmpty(this.validationErrors)},errorCount(){return this.validationErrors?this.validationErrors.length:0},footerRows(){const e=[["Date Created: ".concat(this.date)]];return this.period&&e.push(["Quarter: ".concat(this.period)]),e.push(["HIS-Core Version: ".concat(this.coreVersion)]),e.push(["API Version: ".concat(this.apiVersion)]),e.push(["Site UUID: ".concat(this.siteUUID)]),e.push(["Generated by: ".concat(p.getUserName())]),e}},methods:{async showErrors(){(await Z.create({component:pe,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:this.validationErrors}})).present()},pdfEncryptionData(){const e=p.getUserName();return{encryption:{userPassword:e,ownerPassword:e,userPermissions:["print"]}}},refreshTimeStamp(){this.date=x().format("DD/MMM/YYYY HH:MM:ss")},onActiveColumns(e){this.activeColumns=e},onActiveRows(e){this.activeRows=e},getFileName(){var e;return this.customFileName||"".concat(this.reportPrefix," ").concat(p.getLocationName()," ").concat(ee(this.title).replace(this.reportPrefix,"")," ").concat((e=this.period)!=null?e:this.date)},async onLoadDefault(){this.canShowReport=!0,await this.presentLoading();try{this.refreshTimeStamp(),this.onDefaultConfiguration&&await this.onDefaultConfiguration(),f.dismiss()}catch(e){v("".concat(e)),console.error(e),f.dismiss()}},async onFinish(e,n,y=!1){this.formData=e,this.computeFormData=n,this.canShowReport=!0,await this.presentLoading();try{this.refreshTimeStamp(),await this.onReportConfiguration(this.formData,this.computeFormData,y),f.dismiss()}catch(w){v("".concat(w)),console.error(w),f.dismiss()}},async reloadReport(e=!1){if(!u.isEmpty(this.formData)||!u.isEmpty(this.computeFormData)){await this.onFinish(this.formData,this.computeFormData,e);return}this.onDefaultConfiguration&&await this.onLoadDefault()},async presentLoading(){await(await f.create({message:"Please wait...",backdropDismiss:!1})).present()}},created(){this.onDefaultConfiguration&&this.onLoadDefault(),this.btns=this.customBtns,this.btns.push({name:"CSV",size:"large",slot:"start",color:"primary",visible:this.canExportCsv,onClick:async()=>{const{columns:e,rows:n}=F(this.activeColumns,this.activeRows,"csvMode");le(e,[...n,...this.footerRows],this.getFileName())}}),this.btns.push({name:"PDF",size:"large",slot:"start",color:"primary",visible:this.canExportPDf,onClick:async()=>{let e="pdfMode";this.encryptPDF&&(e=await te("Security warning","PDF may contain private data that will require a password to unlock","To access private data choose Secure PDF over Regular PDF",[{name:"Secure PDF",slot:"start",color:"success"},{name:"Regular PDF",slot:"start",color:"success"}],"his-danger-color")==="Secure PDF"?"pdfMode":"ignorePDFColumnexport");const{columns:n,rows:y}=F(this.activeColumns,this.activeRows,e);ce(n,y,this.getFileName(),this.enabledPDFHorizontalPageBreak,this.encryptPDF&&e!="ignorePDFColumnexport"?this.pdfEncryptionData():{})}}),this.btns.push({name:"Refresh/Rebuild",size:"large",slot:"end",color:"warning",visible:!0,onClick:async()=>{let e=!1;this.hasServerSideCaching&&(e=await oe("Do you want to rebuild report cache?",{header:"Rebuild Report"})),this.reloadReport(e)}}),this.btns.push({name:"Back",size:"large",slot:"end",color:"primary",visible:!u.isEmpty(this.fields),onClick:()=>this.canShowReport=!1}),this.btns.push({name:"Finish",size:"large",slot:"end",color:"success",visible:!0,onClick:()=>{this.onFinishBtnAction?this.onFinishBtnAction():this.$router.push({path:"/"})}})}}),de=["innerHTML"],me={class:"header-text-list"},fe=["onClick"],ge={key:1},ye=["innerHTML"],we={key:0},_e={class:"report-content"};function be(e,n,y,w,Ce,De){const P=o("his-standard-form"),R=o("ion-title"),k=o("ion-img"),E=o("ion-thumbnail"),m=o("ion-chip"),B=o("ion-label"),I=o("ion-item"),b=o("ion-toolbar"),A=o("ion-header"),V=o("report-table"),T=o("ion-content"),L=o("ion-footer"),$=o("his-footer"),H=o("ion-page");return i(),d(S,null,[re(s(P,{onOnFinish:e.onFinish,skipSummary:!0,fields:e.fields},null,8,["onOnFinish","fields"]),[[ae,!e.canShowReport]]),e.canShowReport?(i(),g(H,{key:0},{default:t(()=>[s(A,null,{default:t(()=>[s(b,null,{default:t(()=>[e.showtitleOnly?(i(),g(R,{key:0},{default:t(()=>[a("span",{innerHTML:e.title},null,8,de)]),_:1})):l("",!0),e.showtitleOnly?l("",!0):(i(),g(I,{key:1},{default:t(()=>[s(E,{slot:"start"},{default:t(()=>[s(k,{src:e.logo},null,8,["src"])]),_:1}),s(B,null,{default:t(()=>[a("ul",me,[a("li",null,[c("Title "),a("b",null,h(e.title),1)]),a("li",null,[c("Period "),a("b",null,h(e.period),1)]),(i(!0),d(S,null,ie(e.headerInfoList,(r,M)=>{var C,D;return i(),d("li",{key:M},[c(h(r.label)+" ",1),r&&((C=r==null?void 0:r.other)!=null&&C.onclick)?(i(),d("a",{key:0,href:"#",onClick:ne(ve=>r.other.onclick(),["prevent"])},h(r.value),9,fe)):l("",!0),r&&!((D=r==null?void 0:r.other)!=null&&D.onclick)?(i(),d("b",ge,[a("span",{innerHTML:r.value},null,8,ye)])):l("",!0)])}),128)),e.showValidationStatus?(i(),d("li",we,[e.hasErrors?(i(),g(m,{key:0,onClick:e.showErrors,color:"danger"},{default:t(()=>[a("b",null,h(e.errorCount),1),c(" Error(s) found. Click for more ")]),_:1},8,["onClick"])):l("",!0),e.hasErrors?l("",!0):(i(),g(m,{key:1,color:"success"},{default:t(()=>[c(" Report is Consistent ")]),_:1}))])):l("",!0)])]),_:1})]),_:1}))]),_:1})]),_:1}),s(T,null,{default:t(()=>[a("div",_e,[s(V,{rows:e.rows,columns:e.columns,showFilters:e.showFilters,config:{...e.config,tableCssTheme:e.tableCssTheme},onOnActiveColumns:e.onActiveColumns,onOnActiveRows:e.onActiveRows},null,8,["rows","columns","showFilters","config","onOnActiveColumns","onOnActiveRows"])])]),_:1}),s(L,null,{default:t(()=>[s(b,null,{default:t(()=>[s(m,{color:"primary"},{default:t(()=>[c("Date Created: "),a("b",null,h(e.date),1)]),_:1}),s(m,{color:"primary"},{default:t(()=>[c("His-Core Version: "),a("b",null,h(e.coreVersion),1)]),_:1}),s(m,{color:"primary"},{default:t(()=>[c("API Version: "),a("b",null,h(e.apiVersion),1)]),_:1})]),_:1})]),_:1}),s($,{btns:e.btns},null,8,["btns"])]),_:1})):l("",!0)],64)}const ke=se(ue,[["render",be],["__scopeId","data-v-6ccbfe61"]]);export{ke as R};
