import{bk as y,d as b,I as E,K as D,dF as k,F as p,aV as h,aW as m,ct as A,ba as P,_ as H,r as R,o as S,c as x,w as B,b as w}from"./index-BFVcutZq.js";import{g as Y}from"./LocationFieldOptions-C8xpWQA4.js";import{H as $}from"./HisStandardForm-DO3sZVdL.js";import"./storage-DBvOSj8j.js";class l extends y{constructor(a,s=-1){super(a,7,s)}nextAppointment(){return y.getJson("/programs/".concat(this.programID,"/patients/").concat(this.patientID,"/next_appointment_date"),{date:this.date})}}const M=b({components:{IonPage:E,HisStandardForm:$},setup(){const i=D([]),a=new l(-1),s=D(!1),{visitID:g,htsClient:v,getEncounter:r,patientDashboardUrl:u,saveEncounter:c,toOption:T}=k({onInitVisit:()=>{i.value=[F(),V(),I()]}});function V(){return{id:"referral_location",helpText:"Intended site for retesting",type:p.TT_SELECT,isRequired:()=>!0,finalComputedValue:({label:e})=>({obs:a.buildValueText("Referral location",e)}),defaultValue:()=>l.getLocationName(),condition:e=>e.re_test.value!="Not done",options:(e,t="")=>Y(t),config:{footerBtns:[{name:"Here",slot:"end",onClickComponentEvents:{setValue:()=>l.getLocationName()},onClick:()=>null}],showKeyboard:!0,isFilterDataViaApi:!0}}}function C(){const e=r("Testing");if(!e)return a.date;const t={14:[e["HIV status"]==="Positive Initial Professional",e["HIV status"]==="Inconclusive"],28:[/negative/i.test(e["HIV status"])&&/High risk event in last 3 months|not done/i.test(e["client risk category"])],365:[/negative/i.test(e["HIV status"])&&/On-going risk/i.test(e["client risk category"])]};return Object.keys(t).reduce((n,o)=>!n&&t[o].some(Boolean)?m(a.date).add(o,"days").format(P):n,"")}function F(){let e=null;return{id:"re_test",helpText:"Referral for Re-Testing",type:p.TT_TEXT_BANNER,init:async()=>{let t="",n="",o="";const d=new l(g.value),f=r("Testing");if(f?(t=f["HIV status"]||"N/A",n=f["client risk category"]||"N/A"):h().isOfflineMode.value||(n=await d.getFirstValueCoded("client risk category")||"N/A",t=await d.getFirstValueCoded("HIV Status")||"N/A"),v.gender==="F"){const _=r("PREGNANCY STATUS");_?o=_["Pregnancy status"]:h().isOfflineMode.value||(o=await d.getFirstValueCoded("Pregnancy status")||"N/A")}return/Negative/i.test(t)&&o==="BREASTFEEDING"?(s.value=!0,e={label:"Book a Re-Test for Female Breastfeeding Client",value:"Re-test"}):/Negative/i.test(t)&&o=="Pregnant woman"?(s.value=!0,e={label:"Book a Re-Test for Female Pregnant Client",value:"Re-test"}):/Positive Initial Professional/i.test(t)?e={label:"Confirmatory test is needed for Positive result",value:"Confirmatory HIV test"}:/high risk|High risk event|on-going/i.test("".concat(n))?e={label:'Retesting is required due to "'.concat(n,'"'),value:"Re-test"}:e={label:"No re-test required",value:"Not done"},!0},defaultValue:()=>(console.log(e.value),T(e.value)),condition:()=>e!=null,finalComputedValue:t=>({obs:a.buildValueCoded("Referral for Re-Testing",t.value)}),options:()=>[T(e.label)]}}function I(){let e="",t="";return{id:"set_appointment",helpText:"Select Appointment Date for Re-testing",type:p.TT_DATE_PICKER,init:async()=>{if(t=a.date,s.value)e=m(t).add(365,"day").format("YYYY-MM-DD");else try{t=C(),e=m(t).add(15,"day").format("YYYY-MM-DD")}catch(n){}return!0},isRequired:()=>!0,condition:n=>n.referral_location.value,defaultValue:()=>t,finalComputedValue:n=>({obs:a.buildValueDate("Appointment date","".concat(n.value))}),config:{minDate:()=>t,maxDate:()=>e,infoItems:n=>[{label:"System set appointment",value:A(t)},{label:"User set appointment",value:A(n)}],hiddenFooterBtns:["Clear"]}}}function N(e,t){c({encounterName:"APPOINTMENT",encounterTypeID:a.encounterTypeID,computedData:t})}return{patientDashboardUrl:u,onFinish:N,fields:i}}});function O(i,a,s,g,v,r){const u=R("his-standard-form"),c=R("ion-page");return S(),x(c,null,{default:B(()=>[w(u,{formLabel:"Appointment",fields:i.fields,onFinishAction:i.onFinish,cancelDestinationPath:i.patientDashboardUrl()},null,8,["fields","onFinishAction","cancelDestinationPath"])]),_:1})}const j=H(M,[["render",O]]);export{j as default};
