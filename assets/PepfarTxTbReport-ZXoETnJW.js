import{d as C,I as S,c4 as N,K as u,N as M,a9 as B,O as D,n as $,t as O,ab as x,q as E,_ as I,r as w,o as j,c as k,w as G,b as h}from"./index-BCTN_bnC.js";import{D as X}from"./ReportDateSelectionPrompt-kHKFUn_h.js";import{T as q}from"./tb_report_service-9cn-NYpY.js";import{v as L}from"./TableView-Dtifi8zd.js";import{A as U}from"./ArtDrilldown--_TF04Lx.js";import"./dynamic-import-helper-BkBZiFw5.js";import"./MultiFieldDateHelper-CQ4seieZ.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./PopupKeyboard-DWLNjJL8.js";import"./SIngleTouchField-DeaPtOu6.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./HisKeypad-iWtx_mcq.js";import"./BaseKeyboard-BdU8h7Jm.js";import"./KbHandler-BuQ4TFU6.js";import"./fuse-YdZE3OCN.js";import"./Export-nPQsqN2_.js";import"./HisKeyboard-COmBOOo8.js";const V=C({components:{IonPage:S,IonLoading:N,v2Datatable:L},setup(){const e=u([]),m=u(""),g=u(!1),c=new q,F=u(void 0),P=u(void 0),o=(p,i)=>({ref:i,label:p,toValue:a=>a.length,tdClick:async a=>{a.refData.length&&(await D.create({component:U,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:m,patientIdentifiers:a.refData,title:"".concat(a.data.ageGroup," ").concat(a.data.gender," ").concat(a.column.label),onFinish:()=>D.getTop().then(r=>r&&D.dismiss())}})).present()}}),f=[[{label:"#",ref:"index"},{label:"Age group",ref:"ageGroup"},{label:"Gender",ref:"gender"},o("TX_CURR","tx_curr"),o("Symptom Screen (alone)","symptom_screen_alone"),o("CXR screen","cxr_screen"),o("mWRD screen","mwrd_screen"),o("New on ART/Screen Positive","sceen_pos_new"),o("New on ART/Screen Negative","sceen_neg_new"),o("Already on ART/Screen Positive","sceen_pos_prev"),o("Already on ART/Screen Negative","sceen_neg_prev"),o("TB RX_New on ART","started_tb_new"),o("TB RX_Prev on ART","started_tb_prev")]],_=async()=>v(await $("Do you want to rebuild report?")),v=async(p=!1)=>{if(!(F.value&&P.value))return O("Start date and end date required!");g.value=!0,e.value=[];try{const i=await c.getTxTbReport(p,"pepfar"),a={F:"Female",M:"Male"},r=Object.keys(i).reduce((t,s)=>{if(s==="Unknown")return t;const l=i[s];return Object.keys(l).forEach(n=>{t[n].rows.push({ageGroup:s,gender:a[n],...l[n]}),t[n].aggregate=Object.keys(l[n]).reduce((R,d)=>Array.isArray(l[n][d])?{...R,[d]:[...R[d]||[],...l[n][d]]}:R,t[n].aggregate)}),t},{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...r.F.rows,...r.M.rows,{ageGroup:"All",gender:"Male",...r.M.aggregate}];const A=Object.values(r.F.aggregate).reduce((t,s)=>t.concat(s),[]),b=await c.getMaternalStatus(x.uniq(A)),y=b.FBf.concat(b.FP);["FP","FNP","FBf"].forEach(t=>{e.value.push(Object.keys(r.F.aggregate).reduce((s,l)=>({...s,[l]:r.F.aggregate[l].filter(n=>t==="FNP"?!y.includes(n):b[t].includes(n))}),{ageGroup:"All",gender:t}))}),e.value=e.value.map((t,s)=>({index:s+1,...t}))}catch(i){console.error(i),E("Unable to generate report!")}g.value=!1},T=()=>X({onFinish:(p,i,a,r)=>{m.value="Period: ".concat(a),c.startDate=p,c.endDate=i,r&&c.setOccupation(r),v()}});return M(()=>T()),{Img:B,reportData:e,isLoading:g,onRefreshReport:_,configure:T,generate:v,columns:f,period:m}}});function W(e,m,g,c,F,P){const o=w("ion-loading"),f=w("v2Datatable"),_=w("ion-page");return j(),k(_,null,{default:G(()=>[h(o,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),h(f,{title:"Tx TB Report","icon-url":e.Img("login-logos/PEPFAR.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRefreshReport,"report-prefix":"Pepfar"},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh"])]),_:1})}const de=I(V,[["render",W]]);export{de as default};
