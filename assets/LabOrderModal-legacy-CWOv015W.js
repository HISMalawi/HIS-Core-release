System.register(["./index-legacy-Dg5P6bX-.js","./lab_order_service-legacy-ptXfA6YN.js","./HisKbConfigurations-legacy-vrLd9Pgz.js","./HisKeyboard-legacy-C-8xTqW8.js","./KbHandler-legacy-De8o5nTq.js","./fuse-legacy-CQoBB3MK.js"],(function(e,t){"use strict";var s,a,i,n,d,l,o,r,c,h,u,p,y,b,m,v,f,g,x,I,T,k,w,C,_,O,S,B,L,A,F,E,N,K,$,D,P,R,V,j,H,U,z,M,q,Y;return{setters:[e=>{s=e.d,a=e.cn,i=e.aN,n=e.t,d=e.aU,l=e.q,o=e.ab,r=e.R,c=e.n,h=e.O,u=e.ae,p=e.ce,y=e.f,b=e.l,m=e.j,v=e.k,f=e.bb,g=e.i,x=e.C,I=e.g,T=e.h,k=e.af,w=e.e,C=e.ct,_=e.aj,O=e.ao,S=e._,B=e.r,L=e.o,A=e.x,F=e.b,E=e.w,N=e.u,K=e.F,$=e.y,D=e.c,P=e.v,R=e.A,V=e.z,j=e.a3,H=e.a4},e=>{U=e.L},e=>{z=e.Q},e=>{M=e.H},e=>{q=e.k},e=>{Y=e.F}],execute:function(){var t=document.createElement("style");t.textContent="table[data-v-04cd93d8]{font-family:arial,sans-serif;border-collapse:collapse;width:100%}ion-col[data-v-04cd93d8]{border-right:solid 1px #ccc}.side-title[data-v-04cd93d8]{width:100%;padding:.3em;text-align:center;background:#e9e8e8}td[data-v-04cd93d8],th[data-v-04cd93d8]{border:1px solid #dddddd;text-align:left;padding:8px}tr[data-v-04cd93d8]:nth-child(2n){background-color:#ddd}\n",document.head.appendChild(t);const G=s({name:"Modal",props:{activities:{type:Object,required:!0},testFilters:{type:Array},title:{type:String,default:""}},watch:{activities:{handler(e){e&&(this.appActivities=[...e],this.getActivities())},immediate:!0}},async created(){this.extendedLabsEnabled=await a.extendedLabEnabled(),this.canScanDBS=await a.canScanDBS()},methods:{onFilter(e){this.searchFilter=q(e,this.searchFilter)},async onScanEIDbarcode(e){if(this.verifyingBarcode=!this.verifyingBarcode,!this.verifyingBarcode){if((await i.create({message:`Checking ${e}`})).present(),this.testTypes[this.activeIndex].accessionNumber=null,`${e||""}`.length<=0)return n("Barcode is required"),this.verifyingBarcode=!1,void i.getTop().then((e=>e&&i.dismiss()));try{await d.accessionNumExists(e)?n(`Barcode ${e} was already used`):this.testTypes[this.activeIndex].accessionNumber=e}catch(t){l("Failed to confirm barcode "+e+", Please try again later",8e3)}this.verifyingBarcode=!1,i.getTop().then((e=>e&&i.dismiss()))}},async onSelectTest(e,t,s){this.searchFilter="",this.showKeyboard=!1,this.testTypes[t].isChecked=s.target.checked,this.testTypes[t].isChecked?(this.activeIndex=t,this.specimens=await d.getSpecimens(e)):this.removeOrder(t)},async getActivities(){const e=await d.getTestTypes(),t=o.findIndex(e,{name:"HIV viral load"}),s=-1!==t?e.splice(t,1):null,a=e.sort(((e,t)=>`${e.name}`.toUpperCase()>`${t.name}`.toUpperCase()?1:-1)).filter((e=>!Array.isArray(this.testFilters)||this.testFilters.includes(e.name)));this.testTypes=(s?[...s,...a]:a).map(((e,t)=>({...e,id:t})))},removeOrder(e){this.testTypes[e].isChecked=!1,this.testTypes[e].reason=null,this.testTypes[e].specimen=null,this.testTypes[e].specimenConcept=null,this.testTypes[e].accessionNumber=null,this.activeIndex=null,this.specimens=[]},addSpecimen(e){this.testTypes[this.activeIndex].specimenConcept=e.concept_id},async postActivities(){this.isPostingOrder=!0;try{const e=`${this.$route.params.patient_id}`,t=new U(parseInt(e),-1),s=await t.createEncounter();if(s){const e=await d.buildLabOrders(s,this.finalOrders),t=await d.saveOrdersArray(s.encounter_id,e);if(!t)return n("Unable to save lab orders");r.invalidate("PATIENT_LAB_ORDERS"),await c("Lab orders and encounter created!, print out your last orders?",{confirmBtnLabel:"Yes",cancelBtnLabel:"No"})?await this.printOrders(t):await this.closeModal(t)}}catch(e){n(`Unable to save order: ${e}`)}this.isPostingOrder=!1},async closeModal(e){await h.dismiss(e)},async printOrders(e){const t=new u;await e.forEach((async e=>{const s=`lab/labels/order?order_id=${e.order_id}`;await t.printLbl(s)})),await h.dismiss(e)}},computed:{searchIcon:()=>p,searchColor(){return this.showKeyboard?"primary":"dark"},testTypesOnDisplay(){return this.searchFilter?new Y(this.testTypes,{threshold:.3,keys:["name"],useExtendedSearch:!0}).search(this.searchFilter).map((e=>e.item)):this.testTypes},dbsBarcodeActivated(){return this.canScanDBS&&/dbs/i.test(`${this.testTypes[this.activeIndex]?.specimen}`)&&/hiv viral load/i.test(`${this.testTypes[this.activeIndex]?.name}`)},isOrderComplete(){return"number"==typeof this.activeIndex&&!(this.dbsBarcodeActivated&&!this.testTypes[this.activeIndex].accessionNumber)&&(this.extendedLabsEnabled?!!this.testTypes[this.activeIndex].reason:(this.testTypes[this.activeIndex].specimenConcept||this.testTypes[this.activeIndex].specimen)&&this.testTypes[this.activeIndex].reason)},selectedOrders(){return this.testTypes.filter((e=>!0===e.isChecked))},finalOrders(){return this.selectedOrders.filter((e=>!(this.dbsBarcodeActivated&&!e.accessionNumber)&&e.reason&&(e.specimen&&!this.extendedLabsEnabled||this.extendedLabsEnabled)))},testReasons(){let e=this.reasons;return this.testTypes[this.activeIndex].name.match(/Viral load/i)&&(e=e.filter((e=>"Stat"!==e)),e=e.concat(["Follow up after Low Level Viremia","Follow up after High Viral Load"])),e}},mounted(){this.getActivities()},data:()=>({isPostingOrder:!1,searchFilter:"",showKeyboard:!1,keyboardLayout:z,canScanDBS:!1,verifyingBarcode:!1,content:"Content",extendedLabsEnabled:!1,appActivities:[],testTypes:[],specimens:[],reasons:["Routine","Targeted","Confirmatory","Stat","Repeat / Missing"],activeIndex:null}),components:{IonButton:y,IonContent:b,IonHeader:m,IonTitle:v,IonInput:f,IonToolbar:g,IonLabel:x,IonList:I,IonItem:T,BarcodeInput:k,IonCheckbox:w,IonRadioGroup:C,IonRow:_,HisKeyboard:M,IonIcon:O}}),Q=e=>(j("data-v-04cd93d8"),e=e(),H(),e),X={class:"ion-margin-bottom"},J=Q((()=>R("div",{class:"his-md-text side-title"}," Select specimen ",-1))),W={key:1},Z={class:"his-md-text side-title"},ee=Q((()=>R("div",{class:"his-md-text side-title"}," Main test(s) reason ",-1))),te={style:{background:"lightyellow",height:"34vh"}},se={class:"his-sm-text"},ae=Q((()=>R("thead",null,[R("tr",null,[R("th",null,"Test"),R("th",null,"Specimen"),R("th",null,"Reason"),R("th",null,"Action")])],-1)));e("L",S(G,[["render",function(e,t,s,a,i,n){const d=B("ion-title"),l=B("ion-icon"),o=B("ion-input"),r=B("ion-toolbar"),c=B("ion-header"),h=B("ion-label"),u=B("ion-checkbox"),p=B("ion-item"),y=B("ion-list"),b=B("ion-col"),m=B("ion-radio"),v=B("ion-radio-group"),f=B("ion-text"),g=B("BarcodeInput"),x=B("ion-button"),I=B("ion-row"),T=B("ion-grid"),k=B("his-keyboard"),w=B("ion-content"),C=B("ion-footer");return L(),A(K,null,[F(c,null,{default:E((()=>[F(r,null,{default:E((()=>[F(d,{class:"his-lg-text",slot:"start"},{default:E((()=>[N(" Lab orders ")])),_:1}),F(l,{size:"large",slot:"end",icon:e.searchIcon,color:e.searchColor},null,8,["icon","color"]),F(o,{readonly:!0,value:e.searchFilter,disabled:e.activeIndex&&!e.isOrderComplete,color:e.searchColor,onClick:t[0]||(t[0]=()=>e.showKeyboard=!e.showKeyboard),placeholder:"Search for tests",style:{"text-align":"left",width:"35%"},class:"input_display",slot:"end"},null,8,["value","disabled","color"])])),_:1})])),_:1}),F(w,{style:{overflow:"hidden",background:"grey",height:"70vh"}},{default:E((()=>[F(T,null,{default:E((()=>[F(I,null,{default:E((()=>[F(b,{size:"6"},{default:E((()=>[F(y,{style:{overflowY:"auto",height:"75vh"}},{default:E((()=>[(L(!0),A(K,null,$(e.testTypesOnDisplay,(t=>(L(),D(p,{class:"his-sm-text",key:t.id,disabled:null!=e.activeIndex&&e.activeIndex!==t.id&&!e.isOrderComplete,detail:""},{default:E((()=>[F(h,{"text-wrap":""},{default:E((()=>[N(P(t.name),1)])),_:2},1024),F(u,{slot:"start",checked:t.isChecked,onIonChange:s=>e.onSelectTest(t.name,t.id,s)},null,8,["checked","onIonChange"])])),_:2},1032,["disabled"])))),128))])),_:1})])),_:1}),null!=e.activeIndex&&e.selectedOrders.length>0?(L(),D(b,{key:0,style:{overflowY:"auto",height:"79vh"}},{default:E((()=>[R("div",X,[e.extendedLabsEnabled?V("",!0):(L(),D(y,{key:0},{default:E((()=>[F(v,{modelValue:e.testTypes[e.activeIndex].specimen,"onUpdate:modelValue":t[1]||(t[1]=t=>e.testTypes[e.activeIndex].specimen=t)},{default:E((()=>[J,(L(!0),A(K,null,$(e.specimens,(t=>(L(),D(p,{key:t},{default:E((()=>[F(h,null,{default:E((()=>[N(P(t.name),1)])),_:2},1024),F(m,{slot:"start",value:t.name,onClick:s=>e.addSpecimen(t)},null,8,["value","onClick"])])),_:2},1024)))),128))])),_:1},8,["modelValue"])])),_:1})),e.dbsBarcodeActivated?(L(),A("div",W,[R("div",Z,[N(" Barcode ID: "),F(f,{color:e.testTypes[e.activeIndex].accessionNumber?"success":"dark"},{default:E((()=>[R("b",null,P(e.testTypes[e.activeIndex].accessionNumber||"None"),1)])),_:1},8,["color"])]),F(g,{size:"small",onOnScan:t[2]||(t[2]=t=>e.onScanEIDbarcode(t))})])):V("",!0),F(v,{modelValue:e.testTypes[e.activeIndex].reason,"onUpdate:modelValue":t[3]||(t[3]=t=>e.testTypes[e.activeIndex].reason=t)},{default:E((()=>[ee,(L(!0),A(K,null,$(e.testReasons,(e=>(L(),D(p,{class:"his-sm-text",key:e},{default:E((()=>[F(h,null,{default:E((()=>[N(P(e),1)])),_:2},1024),F(m,{slot:"start",value:e},null,8,["value"])])),_:2},1024)))),128))])),_:1},8,["modelValue"])]),R("div",te,[R("table",se,[ae,R("tbody",null,[(L(!0),A(K,null,$(e.finalOrders,((t,s)=>(L(),A("tr",{key:s},[R("td",null,P(t.name),1),R("td",null,P(t.specimen||"N/A"),1),R("td",null,P(t.reason),1),R("td",null,[F(x,{onClick:s=>e.removeOrder(t.id),slot:"end",color:"danger"},{default:E((()=>[N("X")])),_:2},1032,["onClick"])])])))),128))])])])])),_:1})):V("",!0)])),_:1})])),_:1}),e.showKeyboard?(L(),D(k,{key:0,kbConfig:e.keyboardLayout,onKeyPress:e.onFilter,disabled:!1},null,8,["kbConfig","onKeyPress"])):V("",!0)])),_:1}),F(C,null,{default:E((()=>[F(r,null,{default:E((()=>[F(x,{onClick:e.postActivities,size:"large",slot:"end",disabled:e.isPostingOrder||0===e.finalOrders.length},{default:E((()=>[N(" Place orders ")])),_:1},8,["onClick","disabled"]),F(x,{disabled:e.isPostingOrder,onClick:t[4]||(t[4]=t=>e.closeModal([])),size:"large",slot:"start",color:"danger"},{default:E((()=>[N(" Close ")])),_:1},8,["disabled"])])),_:1})])),_:1})],64)}],["__scopeId","data-v-04cd93d8"]]))}}}));
