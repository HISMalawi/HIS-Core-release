import{H as y}from"./HisStandardForm-D6VlI2F_.js";import{bd as I,d as H,K as C,F as o,V as r,bn as d,ag as s,bm as u,o as R,c as L,w as k,b as O,cz as c,I as U,t as T}from"./index-PKQE-5WY.js";import{u as N}from"./useEncounter-ChmXqjLi.js";import{y as v,m,r as q}from"./commons-CwKvrT9l.js";import"./isEmpty-BEktyy0t.js";import"./_Set-CYUxE81u.js";import"./_setToArray-B0qCPbW-.js";import"./encounter_guidelines-weEpS41h.js";import"./GuidelineEngine-D6V1_Znr.js";class l extends I{constructor(a,n){super(a,39,n)}}const J=H({__name:"HIVStatus",setup(p){let a;const n=C([]),{patientDashboardUrl:_,goToNextTask:b}=N((e,t,i)=>{a=new l(t,e),n.value=[g(),...F(i),x(),A(),E(),...h(i),...S(i),V(),D()]});async function f(e,t){if(!await a.createEncounter())return T("Unable to create encounter");const w=await q({...t});if(!await a.saveObservationList(w))return T("Unable to save observations");b()}function D(){return{id:"advised_to_visit_art",helpText:"Advised to visit ART",type:o.TT_SELECT,options:v,condition:e=>e.received_arvs.value!=="Yes",computedValue:e=>({obs:a.buildValueCoded("Advised to visit ART",e.value)})}}function V(){return{id:"art_clinic_location",helpText:"ART clinic location",type:o.TT_SELECT,computedValue:e=>({obs:a.buildValueText("ART clinic location",e.label)}),validation:e=>r.required(e),condition:e=>/Yes|Defaulter/i.test(e.received_arvs.value),options:(e,t="")=>d(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}}}function h(e){return s({id:"date_started_art",helpText:"Started ART",required:!0,condition:t=>t.received_arvs.value==="Yes",minDate:()=>{var t;return"".concat((t=e==null?void 0:e.getBirthdate())!=null?t:"")},maxDate:()=>a.getDate(),estimation:{allowUnknown:!0,estimationFieldType:u.MONTH_ESTIMATE_FIELD},computeValue:(t,i)=>a.buildDateObs("Date ART started",t,i)})}function S(e){return s({id:"date_defualted_art",helpText:"ART Default",required:!0,condition:t=>t.received_arvs.value==="Defaulter",minDate:()=>{var t;return"".concat((t=e==null?void 0:e.getBirthdate())!=null?t:"")},maxDate:()=>a.getDate(),estimation:{allowUnknown:!0,estimationFieldType:u.MONTH_ESTIMATE_FIELD},computeValue:(t,i)=>a.buildDateObs("ART default date",t,i)})}function A(){return{id:"cpt_started",helpText:"CPT Started",type:o.TT_SELECT,options:v,condition:e=>e.hiv_status.value==="Reactive",computedValue:e=>({obs:a.buildValueCoded("CPT Started",e.value)})}}function E(){return{id:"received_arvs",helpText:"Started ART?",type:o.TT_SELECT,computedValue:({value:e})=>({obs:a.buildValueCoded("ART Started",e)}),validation:e=>r.required(e),options:()=>m(["Yes","No","Defaulter","Unknown"]),condition:e=>e.hiv_status.value==="Reactive"}}function g(){return{id:"hiv_status",helpText:"HIV status",type:o.TT_SELECT,validation:e=>r.required(e),computedValue:e=>({obs:a.buildValueText("HIV status",e.label)}),options:()=>m(["Reactive","Non-reactive","Unknown"])}}function F(e){return s({id:"hiv_test_date",helpText:"HIV Test",required:!0,minDate:()=>{var t;return"".concat((t=e==null?void 0:e.getBirthdate())!=null?t:"")},maxDate:()=>l.getSessionDate(),condition:t=>t.hiv_status.value!=="Unknown",summaryLabel:"HIV test date",estimation:{allowUnknown:!0,estimationFieldType:u.MONTH_ESTIMATE_FIELD},computeValue:(t,i)=>a.buildDateObs("HIV test date",t,i)})}function x(){return{id:"test_location",helpText:"HIV test location",type:o.TT_SELECT,validation:e=>r.required(e),defaultValue:()=>l.getLocationName(),computedValue:({label:e})=>({obs:a.buildValueText("HIV test location",e)}),condition:e=>e.hiv_status.value!=="Unknown",options:(e,t="")=>d(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}}}return(e,t)=>(R(),L(c(U),null,{default:k(()=>[O(y,{cancelDestinationPath:c(_),fields:n.value,onFinishAction:f,skipSummary:""},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{J as default};
