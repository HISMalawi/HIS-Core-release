import{d as D,bl as k,f as $,H as l,ct as d,S as m,t as p,n as C,O as x,ae as B,_ as T,r as h,o as a,c as F,w as _,A as t,x as c,B as f,y,b as H,u as g,v as o,a5 as I,a6 as A,a7 as E}from"./index-ox16Qeox.js";import{L}from"./LabOrderModal-H95snMpt.js";import{_ as N}from"./FieldMixin.vue_vue_type_script_lang-CEgHZvqy.js";import"./lab_order_service-LfO8G9NL.js";import"./HisKeyboard-CtGe8LVP.js";import"./fuse-YdZE3OCN.js";const P=D({components:{ViewPort:k,IonButton:$},mixins:[N],data:()=>({HisDate:l,rows:[],fetchingOrders:!1,ordersToday:{}}),methods:{async init(){this.$emit("onFieldActivated",this),this.fetchingOrders=!0;let s=[];try{s=await this.options(this.fdata)}catch(e){console.error("".concat(e))}this.fetchingOrders=!1;const r=s[0].other.values;this.ordersToday=r.reduce((e,i)=>(d(i.ordered)===d(m.getSessionDate())&&!i.result.length&&(e[i.test_name]=!0),e),{}),this.rows=r.map(e=>(e.id=e.order_id,e.ordered&&(e.ordered=l.toStandardHisDisplayFormat(e.ordered)),e.released&&(e.released=l.toStandardHisDisplayFormat(e.released)),e))},async printOrder(s){var r;if(d(s.ordered)!=d(m.getSessionDate()))return p("Printing order #".concat(s.accession_number," is restricted to today. Consider using BDE mode/set session date to the order date"));typeof((r=this.config)==null?void 0:r.printOrder)=="function"&&await C("Do you want to print order with accession number ".concat(s.accession_number,"?"))&&this.config.printOrder(s.id)},formatOrders(s){return s.map(r=>({id:r.order_id,encounter_id:r.encounter_id,result_given:r.result_given,accession_number:r.accession_number,test_name:r.tests[0].name,specimen:r.specimen.name,ordered:l.toStandardHisDisplayFormat(r.order_date),result:[],release:""}))},async launchOrderSelection(s=null){if(this.fetchingOrders)return p("Please wait....");const r=await x.create({component:L,backdropDismiss:!1,cssClass:"large-modal",componentProps:{testFilters:s,ordersToday:this.ordersToday,onOrderAdded:i=>this.ordersToday[i]=!0}});r.present();const{data:e}=await r.onDidDismiss();B.isEmpty(e)||(this.rows=[...this.formatOrders(e),...this.rows])}},mounted(){this.init()},activated(){this.init()}}),w=s=>(A("data-v-c8e35324"),s=s(),E(),s),V={class:"view-port-content"},R={class:"his-sm-text"},z=w(()=>t("tr",null,[t("th",null,"Accession #"),t("th",null,"Test Name"),t("th",null,"Specimen"),t("th",null,"Ordered"),t("th",null,"Result"),t("th",null,"Released"),t("th",null,"Given")],-1)),G=w(()=>t("br",null,null,-1));function M(s,r,e,i,W,Y){const v=h("ion-button"),b=h("view-port");return a(),F(b,null,{default:_(()=>[t("div",V,[t("table",R,[z,(a(!0),c(f,null,y(s.rows,(n,O)=>(a(),c("tr",{key:O},[t("td",null,[H(v,{color:"light",fill:"none",onClick:u=>s.printOrder(n)},{default:_(()=>[g(o(n.accession_number),1)]),_:2},1032,["onClick"])]),t("td",null,o(n.test_name),1),t("td",null,o(n.specimen),1),t("td",null,o(n.ordered),1),t("td",null,[(a(!0),c(f,null,y(n.result,(u,S)=>(a(),c("span",{key:S},[g(o(u)+" ",1),G]))),128))]),t("td",null,o(n.released),1),t("td",null,[t("span",{style:I("color: ".concat(n.result_given==="Yes"?"green;":"black;"))},o(n.result_given),5)])]))),128))])])]),_:1})}const X=T(P,[["render",M],["__scopeId","data-v-c8e35324"]]);export{X as default};
