import{d as y,I as P,c4 as C,K as R,N as M,a9 as S,O as D,n as N,t as B,ab as O,q as $,_ as x,r as w,o as I,c as j,w as k,b as T}from"./index-L7KBnPzM.js";import{D as E}from"./ReportDateSelectionPrompt-BZ2rSziJ.js";import{T as G}from"./tb_report_service-9ED-dlTD.js";import{v as X}from"./TableView-toGidoAe.js";import{A as q}from"./ArtDrilldown-D2upv8uJ.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./MultiFieldDateHelper-C5td-0Rz.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./PopupKeyboard-BH1Ne41E.js";import"./SIngleTouchField-BYpOdmHo.js";import"./TouchScreenForm-DLhU6o0i.js";import"./ToolbarMediumCard-BO4GFuiT.js";import"./Transformers-BPPLlH12.js";import"./ViewPort--UGxBUFx.js";import"./HisKeypad-D66r9Hla.js";import"./BaseKeyboard-d4rlYFvC.js";import"./KbHandler-BuQ4TFU6.js";import"./fuse-YdZE3OCN.js";import"./Export-DMwHfvYp.js";import"./HisKeyboard-BypDdv5B.js";const L=y({components:{IonPage:P,IonLoading:C,v2Datatable:X},setup(){const e=R([]),u=R(""),g=R(!1),i=new G,o=(m,l)=>({ref:l,label:m,toValue:a=>a.length,tdClick:async a=>{a.refData.length&&(await D.create({component:q,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:u,patientIdentifiers:a.refData,title:"".concat(a.data.ageGroup," ").concat(a.data.gender," ").concat(a.column.label),onFinish:()=>D.getTop().then(r=>r&&D.dismiss())}})).present()}}),h=[[{label:"#",ref:"index"},{label:"Age group",ref:"ageGroup"},{label:"Gender",ref:"gender"},o("TX_CURR","tx_curr"),o("Symptom Screen (alone)","symptom_screen_alone"),o("CXR screen","cxr_screen"),o("mWRD screen","mwrd_screen"),o("New on ART/Screen Positive","sceen_pos_new"),o("New on ART/Screen Negative","sceen_neg_new"),o("Already on ART/Screen Positive","sceen_pos_prev"),o("Already on ART/Screen Negative","sceen_neg_prev"),o("TB RX_New on ART","started_tb_new"),o("TB RX_Prev on ART","started_tb_prev")]],_=async()=>p(await N("Do you want to rebuild report?")),p=async(m=!1)=>{if(!(i.startDate&&i.endDate))return B("Start date and end date required!");g.value=!0,e.value=[];try{const l=await i.getTxTbReport(m,"moh"),a={F:"Female",M:"Male"},r=Object.keys(l).reduce((t,s)=>{if(s==="Unknown")return t;const c=l[s];return Object.keys(c).forEach(n=>{t[n].rows.push({ageGroup:s,gender:a[n],...c[n]}),t[n].aggregate=Object.keys(c[n]).reduce((v,f)=>Array.isArray(c[n][f])?{...v,[f]:[...v[f]||[],...c[n][f]]}:v,t[n].aggregate)}),t},{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...r.F.rows,...r.M.rows,{ageGroup:"All",gender:"Male",...r.M.aggregate}];const F=Object.values(r.F.aggregate).reduce((t,s)=>t.concat(s),[]),b=await i.getMaternalStatus(O.uniq(F)),A=b.FBf.concat(b.FP);["FP","FNP","FBf"].forEach(t=>{e.value.push(Object.keys(r.F.aggregate).reduce((s,c)=>({...s,[c]:r.F.aggregate[c].filter(n=>t==="FNP"?!A.includes(n):b[t].includes(n))}),{ageGroup:"All",gender:t}))}),e.value=e.value.map((t,s)=>({index:s+1,...t}))}catch(l){console.error(l),$("Unable to generate report!")}g.value=!1},d=()=>E({onFinish:(m,l,a,r)=>{u.value="Period: ".concat(a),i.startDate=m,i.endDate=l,r&&i.setOccupation(r),p()}});return M(()=>d()),{Img:S,reportData:e,isLoading:g,onRefreshReport:_,configure:d,generate:p,columns:h,period:u}}});function U(e,u,g,i,o,h){const _=w("ion-loading"),p=w("v2Datatable"),d=w("ion-page");return I(),j(d,null,{default:k(()=>[T(_,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),T(p,{title:"Tx TB Report","icon-url":e.Img("login-logos/Malawi-Coat_of_arms_of_arms.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRefreshReport,"report-prefix":"MOH"},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh"])]),_:1})}const ue=x(L,[["render",U]]);export{ue as default};
