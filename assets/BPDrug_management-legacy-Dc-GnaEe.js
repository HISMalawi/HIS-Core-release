System.register(["./index-legacy-CA6M7ipO.js","./EncounterMixin.vue_vue_type_script_lang-legacy-qUwf12Yn.js","./htn_service-legacy-CIVLkoYj.js","./encounter_guidelines-legacy-Bcz_Mw7r.js","./GuidelineEngine-legacy-KsvQuFdF.js","./HisStandardForm-legacy-a9YJRGaH.js"],(function(e,t){"use strict";var a,s,n,r,o,d,i,l,u,c,g,p,h,m,b,f,v,y,x,_,D,k,w,C,I,P,S,N,T,E,H,B,O,j,z;return{setters:[e=>{a=e.d,s=e.bW,n=e.Y,r=e.X,o=e._,d=e.a3,i=e.a8,l=e.a4,u=e.a9,c=e.I,g=e.ai,p=e.aE,h=e.ad,m=e.aN,b=e.ae,f=e.bn,v=e.W,y=e.au,x=e.cz,_=e.aa,D=e.c,k=e.w,w=e.af,C=e.a,I=e.b,P=e.K,S=e.E,N=e.J,T=e.G,E=e.M,H=e.C,B=e.a2},e=>{O=e._},e=>{j=e.B,z=e.H},null,null,null],execute:function(){var t=document.createElement("style");t.textContent="ion-checkbox[data-v-1e17c62a]{--size: 30px}.col-borders[data-v-1e17c62a]{border:1px dotted lightgray;border-radius:3px}#main-table[data-v-1e17c62a],#table-notes[data-v-1e17c62a]{width:95%;margin:auto}#main-table th[data-v-1e17c62a],#table-notes th[data-v-1e17c62a]{font-size:20px;background-color:#b22222;color:#fff}#main-table th[data-v-1e17c62a],#main-table td[data-v-1e17c62a]{text-align:center;padding:10px}.td-title[data-v-1e17c62a]{font-size:22px;text-shadow:2px 2px white}.td-title[data-v-1e17c62a],.td-current[data-v-1e17c62a],.td-remaining[data-v-1e17c62a]{padding:2px!important}.td-current[data-v-1e17c62a]{background-color:#eed5d2;text-shadow:2px 2px white;height:40px!important}.td-remaining[data-v-1e17c62a]{background-color:#ffe5e5;text-shadow:2px 2px white}.td-value[data-v-1e17c62a]{font-size:22px}caption[data-v-1e17c62a]{font-weight:700;font-size:26px;color:rgba(0,0,0,.8)}#table-notes td[data-v-1e17c62a]{background:rgba(210,220,240,.5);border-radius:5px}.table-inner-notes[data-v-1e17c62a]{width:100%}#table-notes th[data-v-1e17c62a]{background:#d3d3d3;color:rgba(0,0,0,.8)}#table-notes td[data-v-1e17c62a]{padding-left:1px}.date-td[data-v-1e17c62a]{padding-left:4px!important;text-shadow:0 1px 1px rgba(0,0,0,.2);font-size:1em;background:rgba(235,235,240,.5)!important;color:rgba(0,0,0,.9)}.note-td[data-v-1e17c62a]{padding-left:20px!important;color:rgba(0,0,0,.8);text-shadow:2px 2px 3px rgba(255,255,255,.1)}.notes-scroll[data-v-1e17c62a]{height:265px!important;overflow:auto}.today-tr[data-v-1e17c62a]{font-style:italic;font-weight:700;border-radius:10px!important}\n/*$vite$:1*/",document.head.appendChild(t);const M=a({mixins:[O],components:{ViewPort:s,IonToolbar:n,IonHeader:r,IonContent:o,IonRow:d,IonButton:i,IonCol:l,IonFooter:u,IonPage:c,IonCheckbox:g},watch:{ready:{async handler(e){if(e){this.HTN=new j(this.patientID,this.providerID),this.drugs=this.HTN.getDrugs();const{drugs:e,notes:t}=await this.HTN.getCurrentDrugs();this.setPreviousBpDrugs(e),this.setPreviousBpNotes(t),this.canClearHtnSessionPrescription=this.patientHasHtnSessionKey()}},immediate:!0}},data:()=>({HTN:{},drugs:null,otherBpDrugs:[],canClearHtnSessionPrescription:!1}),methods:{clearPrescriptionInSession(){sessionStorage.removeItem(z.Prescription),this.canClearHtnSessionPrescription=!1},showMoreBpDrugs(){p([{id:"drug",helpText:"Select BP drugs",type:h.TT_MULTIPLE_SELECT,init:async()=>{m.isEmpty(this.otherBpDrugs)&&(await j.getAllBpDrugs()).forEach((e=>{this.otherBpDrugs.push({label:e.name,value:e.drug_id,other:e})}));const e=this.getStandardSelectedDrugs().map((e=>e.drug_id));return this.otherBpDrugs=this.otherBpDrugs.map((t=>({...t,isChecked:e.includes(t.value)}))),!0},onValueUpdate:e=>(Object.keys(this.drugs).forEach((t=>this.drugs[t].drugs=this.drugs[t].drugs.map((t=>({...t,selected:e.some((e=>e.value===t.drugID&&e.isChecked))}))))),e),options:()=>this.otherBpDrugs,validation:e=>b.required(e)},{id:"dosage",helpText:"Custom dose",type:h.TT_DOSAGE_INPUT,condition:e=>!m.isEmpty(e.drug),validation:e=>b.required(e)?["Drugs are not available"]:e.some((({other:e})=>e.am<=0&&e.noon<=0&&e.pm<=0))?["Missing dosage configuration on some drugs"]:null,computedValue:e=>e.map((e=>e.other)),options:e=>e.drug.map((e=>({label:e.label,value:e.value,other:{drug_id:e.other.drug_id,drug_name:e.label,barcodes:e.other.barcodes,units:e.other.units,am:0,noon:0,pm:0,frequency:"Daily (QOD)"}})))}],((e,t)=>this.cacheSelectedDrugsAndProceed(t.dosage)))},patientHasHtnSessionKey(){try{const e=sessionStorage.getItem(z.Prescription);if(e)return JSON.parse(e)[this.patientID]}catch(e){console.warn(e)}return!1},removeNote(e,t){this.drugs[e].notes.splice(t,1)},launchNotePad(e){this.showModal({id:"note",helpText:`Add notes for ${e}`,type:h.TT_TEXT},(t=>{t&&this.drugs[e].notes.push({date:f.getSessionDate(),description:t.value||"",drugID:this.drugs[e].drugs[0].drugID,isNewNote:!0})}))},async onFinish(){const e=Object.values(this.drugs).filter((e=>!m.isEmpty(e.notes))).map((e=>e.notes)).reduce(((e,t)=>e.concat(t)),[]).filter((e=>e.isNewNote)).map((e=>this.HTN.buildObs("Clinician notes",{value_text:e.description,value_drug:e.drugID})));if(!m.isEmpty(e))try{await this.HTN.createEncounter(),await this.HTN.saveObservationList(await Promise.all(e))}catch(t){return v(`Unable to save notes ${t}`)}this.cacheSelectedDrugsAndProceed(this.getStandardSelectedDrugs())},getStandardSelectedDrugs(){return this.selectedDrugs.map((e=>m.find(j.htnDrugReferences(),{drug_id:e.drugID})))},cacheSelectedDrugsAndProceed(e){const t={};t[this.patientID]=e,sessionStorage.setItem(z.Prescription,JSON.stringify(t)),this.$router.push(`/art/encounters/prescriptions/${this.patientID}`)},async showModal(e,t){(await y.create({component:x,backdropDismiss:!1,cssClass:"full-modal",componentProps:{dismissType:"modal",currentField:e,onFinish:t}})).present()},setPreviousBpNotes(e){for(const t in e)this.drugs[t].notes=Object.keys(e[t]).map((a=>e[t][a].map((e=>({date:a,description:e,isNewNote:!1}))))).reduce(((e,t)=>e.concat(t)),[])},setPreviousBpDrugs(e){e.forEach((e=>{for(const t in this.drugs)this.drugs[t].drugs.forEach(((a,s)=>{e.drug_id===a.drugID&&(this.drugs[t].drugs[s].current=!0,this.drugs[t].drugs[s].selected=!0,this.drugs[t].selected=e.drug_id)}))}))},selectDrug(e,t,a){this.drugs[e].drugs.forEach(((t,a)=>{this.drugs[e].drugs[a].selected=!1})),this.drugs[e].drugs[t].selected=a.detail.checked}},computed:{selectedDrugs(){return this.drugs?Object.values(this.drugs).map((e=>e.drugs)).reduce(((e,t)=>e.concat(t)),[]).filter((e=>e.selected)):[]}}}),A={key:0,class:"view-port-content"},F={id:"main-table",style:{width:"100%"}},$={id:"table-notes",style:{width:"100%"}},L={class:"table-inner-notes",id:"notes-HCTZ"},U={class:"date-td today-td"},V={class:"date-td today-td"};e("default",_(M,[["render",function(e,t,a,s,n,r){const o=w("ion-col"),d=w("ion-row"),i=w("ion-toolbar"),l=w("ion-header"),u=w("ion-checkbox"),c=w("ion-button"),g=w("view-port"),p=w("ion-content"),h=w("ion-footer"),m=w("ion-page");return C(),D(m,null,{default:k((()=>[I(l,null,{default:k((()=>[I(i,null,{default:k((()=>[I(d,null,{default:k((()=>[I(o,null,{default:k((()=>t[0]||(t[0]=[P("label",{class:"his-title"}," Prescribe BP drugs ",-1)]))),_:1})])),_:1})])),_:1})])),_:1}),I(p,null,{default:k((()=>[I(g,null,{default:k((()=>[e.drugs?(C(),S("div",A,[P("table",F,[P("tr",null,[t[1]||(t[1]=P("th",null," ",-1)),(C(!0),S(N,null,T(e.drugs,((e,t)=>(C(),S("th",{key:t},[H(B(t)+" ",1),I(d,null,{default:k((()=>[(C(!0),S(N,null,T(e.drugs,((e,t)=>(C(),D(o,{class:"col-borders",key:t},{default:k((()=>[H(B(e.amount||"0mg"),1)])),_:2},1024)))),128))])),_:2},1024)])))),128))]),P("tr",null,[t[2]||(t[2]=P("td",{class:"td-remaining td-title"},[P("span",null,"New/Current")],-1)),(C(!0),S(N,null,T(e.drugs,((t,a)=>(C(),S("td",{key:a,class:"td-current td-value"},[I(d,null,{default:k((()=>[(C(!0),S(N,null,T(t.drugs,((t,s)=>(C(),D(o,{key:s},{default:k((()=>[I(u,{checked:t.selected,onIonChange:t=>e.selectDrug(a,s,t)},null,8,["checked","onIonChange"])])),_:2},1024)))),128))])),_:2},1024)])))),128))]),P("tr",null,[t[4]||(t[4]=P("td",{class:"td-remaining td-title"},[P("span",null," ")],-1)),(C(!0),S(N,null,T(Object.keys(e.drugs),((a,s)=>(C(),S("td",{class:"td-remaining td-value",key:s},[I(d,null,{default:k((()=>[I(o,null,{default:k((()=>[I(c,{onClick:t=>e.launchNotePad(a),color:"warning"},{default:k((()=>t[3]||(t[3]=[H(" Add notes ")]))),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])))),128))])]),t[8]||(t[8]=P("p",null,null,-1)),P("table",$,[t[6]||(t[6]=P("caption",{style:{"font-size":"1.2em"}}," Notes ",-1)),t[7]||(t[7]=P("p",null,null,-1)),P("tr",null,[(C(!0),S(N,null,T(e.drugs,((e,t)=>(C(),S("th",{style:{width:"25%"},key:t},[P("span",null,B(t),1)])))),128))]),P("tr",null,[(C(!0),S(N,null,T(Object.keys(e.drugs),((a,s)=>(C(),S("td",{id:"HCTZ",style:{"padding-top":"2px !important"},valign:"top",key:s},[P("table",L,[(C(!0),S(N,null,T(e.drugs[a].notes,((s,n)=>(C(),S("tr",{key:n},[P("td",U,B(s.date),1),P("td",V,B(s.description),1),P("td",null,[s.isNewNote?(C(),D(c,{key:0,color:"danger",onClick:t=>e.removeNote(a,n)},{default:k((()=>t[5]||(t[5]=[H(" X ")]))),_:2},1032,["onClick"])):E("",!0)])])))),128))])])))),128))])])])):E("",!0)])),_:1})])),_:1}),I(h,null,{default:k((()=>[I(i,{color:"dark"},{default:k((()=>[I(c,{size:"large",color:"danger",slot:"start",onClick:e.gotoPatientDashboard},{default:k((()=>t[9]||(t[9]=[H(" Cancel ")]))),_:1},8,["onClick"]),I(c,{onClick:e.showMoreBpDrugs,size:"large",slot:"end"},{default:k((()=>t[10]||(t[10]=[H(" More Drugs ")]))),_:1},8,["onClick"]),e.canClearHtnSessionPrescription?(C(),D(c,{key:0,size:"large",color:"warning",slot:"end",onClick:e.clearPrescriptionInSession},{default:k((()=>t[11]||(t[11]=[H(" Clear Session Prescription ")]))),_:1},8,["onClick"])):E("",!0),e.selectedDrugs&&e.selectedDrugs.length>0?(C(),D(c,{key:1,size:"large",color:"success",slot:"end",onClick:e.onFinish},{default:k((()=>t[12]||(t[12]=[H(" Continue ")]))),_:1},8,["onClick"])):E("",!0)])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-1e17c62a"]]))}}}));
