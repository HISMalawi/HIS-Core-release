import{d as K,l as J,k as Q,ah as z,aC as W,a7 as X,m as Y,r as A,c as O,cm as x,aZ as H,aR as Z,ce as ee,cf as te,cj as ae,ak as le,ap as $,h as y,b as d,g as D,e as f,a9 as B,aa as E,w as i,a as _,a6 as S,t as j,bb as oe,j as k,d7 as se,C as ne,ct as re,f as g,bf as M,b8 as F,bg as ie,bM as ue}from"./index-DWvBcSFv.js";const de=K({components:{IonToolbar:Y,IonItem:X,IonIcon:W,IonLabel:z,IonButton:Q,IonFooter:J},props:{columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},rowsPerPage:{type:Number,default:10},defaultSortedColumn:{type:String},defaultSortOrder:{type:Object}},setup(t){const c=A([]),m=A(0),P=A(""),h=A("desc"),b=O(()=>{let n=c.value;return h.value&&P.value&&(n=x(c.value)[h.value](u=>u.sortData[P.value])),n}),o=O(()=>H.chunk(b.value,t.rowsPerPage).length),R=O(()=>m.value+2<=o.value),w=O(()=>m.value>0),l=O(()=>H.chunk(b.value,t.rowsPerPage)[m.value]),e=n=>{P.value=n,h.value=h.value==="asc"?"desc":"asc"},a=()=>ae(n=>{const u=parseInt(n);parseInt(n)<=o.value&&(m.value=u)},{title:"Select page"}),r=()=>m.value=0,C=()=>m.value=o.value-1||0,s=()=>m.value+=1,V=()=>m.value-=1,v=n=>{var u,N;try{typeof((u=n.column)==null?void 0:u.tdClick)=="function"&&((N=n.column)==null||N.tdClick(n));return}catch(T){console.error(T)}},I=()=>t.columns.reduce((n,u)=>n.concat(u),[]).filter(n=>n.value||n.ref),U=n=>{n.forEach(u=>{const N={...u},T=I().map(p=>{let L="";const q=u[p.ref];try{H.isEmpty(u)?L="":typeof p.toValue=="function"?L="".concat(p.toValue(q)):typeof p.value=="function"?L=p.value(u):L=u[p.ref]||""}catch(G){L=(p==null?void 0:p.defaultValue)||"_ERROR_",console.error(G)}return N[p.ref]=L,typeof p.sortValue=="function"&&(N[p.ref]=p.sortValue(q)),{column:p,refData:q,value:L,data:u}});c.value.push({row:T,data:u,sortData:N,searchIndex:[...T,T.map(p=>p.value).join(" ")]})})};return Z(()=>t.columnData,n=>{var u;if(c.value=[],!Array.isArray(n)||!n.length){m.value=0,P.value=(u=t.defaultSortedColumn)!=null?u:"",h.value=t.defaultSortOrder||"desc",U(Array.from({length:0}).map(()=>({})));return}U(n)},{immediate:!0,deep:!0}),{first:r,last:C,next:s,prev:V,selectPage:a,sortColumn:e,onClickTablecell:v,close,arrowUp:te,arrowDown:ee,page:l,canNext:R,totalPages:o,sortOrder:h,canPrev:w,currentPage:m,columnSorted:P}}}),ce={style:{width:"100%"}},fe={class:"stick-report-header"},pe=["colspan","rowspan","onClick"],ve=["onClick"],ge=["innerHTML"];function me(t,c,m,P,h,b){const o=$("ion-icon"),R=$("ion-label"),w=$("ion-item"),l=$("ion-button"),e=$("ion-toolbar"),a=$("ion-footer");return d(),y(B,null,[D("div",null,[D("table",ce,[D("thead",fe,[(d(!0),y(B,null,E(t.columns,(r,C)=>(d(),y("tr",{key:C},[(d(!0),y(B,null,E(r,(s,V)=>{var v,I;return d(),y("th",{key:V,colspan:((v=s==null?void 0:s.span)==null?void 0:v.thColspan)||1,rowspan:((I=s==null?void 0:s.span)==null?void 0:I.thRowspan)||1,onClick:U=>t.sortColumn(s.ref)},[f(w,{lines:"none"},{default:i(()=>[t.columnSorted&&t.columnSorted===s.ref?(d(),_(o,{key:0,icon:t.sortOrder==="asc"?t.arrowUp:t.arrowDown},null,8,["icon"])):S("",!0),f(R,null,{default:i(()=>[D("b",null,j(s.label),1)]),_:2},1024)]),_:2},1024)],8,pe)}),128))]))),128))]),D("tbody",null,[(d(!0),y(B,null,E(t.page,(r,C)=>(d(),y("tr",{key:C},[(d(!0),y(B,null,E(r.row,(s,V)=>{var v;return d(),y("td",{key:V,onClick:()=>t.onClickTablecell(s),class:oe({"clickable-cell":(v=s==null?void 0:s.column)==null?void 0:v.tdClick})},[D("span",{innerHTML:s.value,class:"his-sm-text"},null,8,ge)],10,ve)}),128))]))),128))])])]),c[4]||(c[4]=D("p",null,null,-1)),f(a,null,{default:i(()=>[f(e,{color:"light"},{default:i(()=>[t.totalPages>1?(d(),_(l,{key:0,onClick:t.first,disabled:t.currentPage===0||t.totalPages<=2,size:"large",slot:"end"},{default:i(()=>[...c[0]||(c[0]=[k(" First ",-1)])]),_:1},8,["onClick","disabled"])):S("",!0),t.totalPages>1?(d(),_(l,{key:1,onClick:t.prev,disabled:!t.canPrev,color:"light",size:"large",slot:"end"},{default:i(()=>[...c[1]||(c[1]=[k(" Prev ",-1)])]),_:1},8,["onClick","disabled"])):S("",!0),t.totalPages>1?(d(),_(l,{key:2,onClick:t.selectPage,size:"large",slot:"end",color:"light"},{default:i(()=>[k(j(t.currentPage)+" / "+j(t.totalPages-1),1)]),_:1},8,["onClick"])):S("",!0),t.totalPages>1?(d(),_(l,{key:3,onClick:t.next,disabled:!t.canNext,color:"light",size:"large",slot:"end"},{default:i(()=>[...c[2]||(c[2]=[k(" Next ",-1)])]),_:1},8,["onClick","disabled"])):S("",!0),t.totalPages>1?(d(),_(l,{key:4,onClick:t.last,disabled:t.currentPage+1>=t.totalPages||t.totalPages<=2,size:"large",slot:"end"},{default:i(()=>[...c[3]||(c[3]=[k(" Last ",-1)])]),_:1},8,["onClick","disabled"])):S("",!0)]),_:1})]),_:1})],64)}const ke=le(de,[["render",me],["__scopeId","data-v-6173022f"]]),be={key:0},ye={key:1,class:"his-card ion-text-center his-lg-text"},Ve=K({__name:"HomeNotifications",setup(t){const{notificationData:c,hasNotifications:m,clearNotification:P,openNotification:h}=se(),b=A("highViraemia"),o=ne({highViraemia:[],rejectedVL:[],lowLevelViraemia:[],suppressed:[],initiatedData:{},stats:{}}),R=O(()=>[[{ref:"arv",label:"ARV #"},{ref:"accession",label:"Accession #"},{ref:"order_date",label:"Order Date",toValue:l=>"".concat(re(l))},...b.value==="rejectedVL"?[{ref:"rejection_reason",label:"Rejection Reason"}]:[],{ref:"id",label:"View",toValue:()=>"View",tdClick:l=>h(l.data)},{ref:"id",label:"Clear",toValue:()=>"Clear",tdClick:l=>P(l.refData,e=>{o[b.value]=o[b.value].filter(a=>a.id!=e)})}]]);async function w(l,e=c.value){var C,s,V;if(e.length&&o.initiatedData[l])return;let a=6e3;const r=H.chunk((V=(s=(C=e==null?void 0:e[0])==null?void 0:C.vlMessageObs)==null?void 0:s[l])!=null?V:{},7);o.initiatedData[l]=e.length>0,o[l]=[];for(const v of r)o[l]=[...o[l],...v],await ue(a),a=30;o[l]=[...o[l]].sort((v,I)=>new Date(v.order_date)>new Date(I.order_date)?-1:1)}return Z(c,async l=>{w(b.value,l),setTimeout(()=>{var a,r,C,s,V,v;const e=(r=(a=l==null?void 0:l[0])==null?void 0:a.vlMessageObs)!=null?r:{};o.stats.highViraemia=((C=e.highViraemia)!=null?C:[]).length,o.stats.lowLevelViraemia=((s=e.lowLevelViraemia)!=null?s:[]).length,o.stats.rejectedVL=((V=e.rejectedVL)!=null?V:[]).length,o.stats.suppressed=((v=e.suppressed)!=null?v:[]).length},50)},{immediate:!0,deep:!0}),(l,e)=>(d(),y("div",null,[g(m)?(d(),y("div",be,[f(g(ie),{mode:"ios",modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=a=>b.value=a),class:"ion-justify-content-center"},{default:i(()=>[f(g(M),{onClick:e[0]||(e[0]=a=>w("suppressed")),value:"suppressed"},{default:i(()=>[f(g(z),{class:"his-sm-text",style:{"font-weight":"bold"}},{default:i(()=>[...e[5]||(e[5]=[k("Suppressed",-1)])]),_:1}),f(g(F),{color:"success"},{default:i(()=>{var a,r;return[k(j((r=(a=o.stats)==null?void 0:a.suppressed)!=null?r:"-"),1)]}),_:1})]),_:1}),f(g(M),{onClick:e[1]||(e[1]=a=>w("lowLevelViraemia")),value:"lowLevelViraemia"},{default:i(()=>[f(g(z),{class:"his-sm-text",style:{"font-weight":"bold"}},{default:i(()=>[...e[6]||(e[6]=[k("Low-level viraemia",-1)])]),_:1}),f(g(F),{color:"warning"},{default:i(()=>{var a,r;return[k(j((r=(a=o.stats)==null?void 0:a.lowLevelViraemia)!=null?r:"-"),1)]}),_:1})]),_:1}),f(g(M),{onClick:e[2]||(e[2]=a=>w("highViraemia")),value:"highViraemia"},{default:i(()=>[f(g(z),{class:"his-sm-text",style:{"font-weight":"bold"}},{default:i(()=>[...e[7]||(e[7]=[k("Viraemia 1000+",-1)])]),_:1}),f(g(F),{color:"danger"},{default:i(()=>{var a,r;return[k(j((r=(a=o.stats)==null?void 0:a.highViraemia)!=null?r:"-"),1)]}),_:1})]),_:1}),f(g(M),{onClick:e[3]||(e[3]=a=>w("rejectedVL")),value:"rejectedVL"},{default:i(()=>[f(g(z),{class:"his-sm-text",style:{"font-weight":"bold"}},{default:i(()=>[...e[8]||(e[8]=[k("Rejected",-1)])]),_:1}),f(g(F),{color:"danger"},{default:i(()=>{var a,r;return[k(j((r=(a=o.stats)==null?void 0:a.rejectedVL)!=null?r:"-"),1)]}),_:1})]),_:1})]),_:1},8,["modelValue"]),e[9]||(e[9]=D("p",null,null,-1)),(d(),_(ke,{key:b.value,columns:R.value,"column-data":o[b.value],"rows-per-page":7},null,8,["columns","column-data"]))])):(d(),y("div",ye," No notifications "))]))}});export{Ve as default};
