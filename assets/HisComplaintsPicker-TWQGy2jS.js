import{d as P,ai as B,ap as x,b4 as E,aY as F,aN as H,aa as U,af as h,a as p,E as u,b as n,w as o,J as k,G as y,C as L,a2 as b,aH as N,c as C,cw as D,K as Y,M as I}from"./index-CMZASHAR.js";import z from"./SelectMixin-DB1clgUW.js";import{P as K}from"./patient_complaints_service-C5sIRiqT.js";import"./BaseTextInput-DJ8sG-L8.js";import"./FieldMixin.vue_vue_type_script_lang-Bg-mZnL5.js";const M=P({components:{IonCheckbox:B,IonText:x,IonChip:E,HisKeyboard:F},name:"HisComplaintsPicker",mixins:[z],data:()=>({complaintsList:{},ActiveCategory:"",allComplainList:{},displayComplainList:{},groupNames:[],showKeyboard:!1,groupData:[]}),methods:{async init(){this.$emit("onFieldActivated",this);const t=await K.getComplaintsList("Presenting complaint group");this.listData=this.mapListToOptions(t),this.groupData=t,this.groupNames=this.listData;for(const e in this.listData){const i=this.listData[e].label;if(/other/i.test(i)){this.allComplainList[i]=this.mapListToOptions([{name:"Other (specify)",concept_id:6408}],i);continue}const l=(await K.getComplaintsList(i)).filter(c=>c.name!=="Other");this.allComplainList[i]=this.mapListToOptions(l,i)}this.$emit("onValue",this.getChecked(this.complaintsList))},async onselect(t,e){this.$nextTick(async()=>{const i={...t};if(i.isChecked=e.target.checked,this.onValue&&i.isChecked&&!await this.onValue(i))return e.target.checked=!1;this.onValueUpdate&&(this.complaintsList=await this.onValueUpdate({...this.complaintsList},i)),this.$emit("onValue",this.getChecked(this.complaintsList))})},async onKBValue(t){if(t!=""){for(const e in this.groupNames)this.groupNames[e].other.display=!1;for(const e in this.listData){let i="";const s=this.listData[e].label,l=[],c=this.allComplainList[s];for(const r in c)c[r].label.toLowerCase().match(t.toLowerCase())&&s?(c[r].other.display=!0,l.push(c[r]),i=s,this.ActiveCategory=s):(c[r].other.display=!1,l.push(c[r]));if(i!="")for(const r in this.groupNames)this.groupNames[r].label==s&&(this.groupNames[r].other.display=!0);this.allComplainList[s]=l}this.complaintsList[this.ActiveCategory]=this.allComplainList[this.ActiveCategory]}else{for(const e in this.listData){const i=this.listData[e].label,s=[],l=this.allComplainList[i];for(const c in l)l[c].other.display=!0,s.push(l[c]);this.allComplainList[i]=s}this.groupNames=this.mapListToOptions(this.groupData),this.ActiveCategory=""}},keyboardStatus(){this.showKeyboard=!this.showKeyboard},async getSpecificComplaints(t){t in this.complaintsList||(this.complaintsList[t]=this.allComplainList[t]),this.ActiveCategory=t},mapListToOptions(t,e=""){if(H.isEmpty(t))return[];const i={display:!0};return t.map(s=>{const l={label:s.name,value:s.name,isChecked:!1,other:{...s,...i}};return e&&(l.other.parent=e),l})},uncheck(t){this.complaintsList[t.other.parent].forEach(e=>{e.label===t.label&&(e.isChecked=!1)})},getChecked(t){const e=[];for(const i in t)e.push(...(t[i]||[]).filter(s=>s.isChecked));return e}},computed:{checkedItems(){return this.getChecked(this.complaintsList)},activeCategoryItems(){return this.complaintsList[this.ActiveCategory]}},watch:{clear(){for(const t in this.complaintsList)this.complaintsList[t]&&(this.complaintsList[t]=this.complaintsList[t].map(e=>({...e,isChecked:!1})))}},mounted(){this.init()},activated(){this.init()}}),G={style:{}};function J(t,e,i,s,l,c){const r=h("his-text-input"),f=h("ion-text"),g=h("ion-label"),A=h("ion-chip"),_=h("ion-col"),v=h("ion-row"),w=h("ion-item"),V=h("ion-list"),$=h("ion-checkbox"),O=h("his-keyboard"),S=h("ion-grid"),T=h("view-port");return p(),u("div",null,[n(T,{showFull:!t.showKeyboard,style:{padding:"0",height:"82vh"}},{default:o(()=>[n(r,{value:t.selected,placeholder:"Search",onOnValue:t.onKBValue,onClick:t.keyboardStatus},null,8,["value","onOnValue","onClick"]),n(S,null,{default:o(()=>[n(v,null,{default:o(()=>[n(_,{size:"12"},{default:o(()=>[(p(!0),u(k,null,y(t.checkedItems,(a,m)=>(p(),u("span",{key:m},[n(A,{color:"danger",onClick:d=>t.uncheck(a)},{default:o(()=>[n(g,null,{default:o(()=>[n(f,{class:"his-md-text"},{default:o(()=>[L(b(a.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]))),128))]),_:1})]),_:1}),n(v,null,{default:o(()=>[n(_,{size:"4"},{default:o(()=>[n(V,{style:{overflowY:"auto",height:"80vh",margin:0}},{default:o(()=>[(p(!0),u(k,null,y(t.groupNames,(a,m)=>N((p(),C(w,{key:m,onClick:d=>t.getSpecificComplaints(a.value),detail:!0,color:t.ActiveCategory===a.label?"light":""},{default:o(()=>[n(g,null,{default:o(()=>[n(f,{class:"his-md-text"},{default:o(()=>[L(b(a.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","color"])),[[D,a.other.display]])),128))]),_:1})]),_:1}),t.ActiveCategory?(p(),C(_,{key:0,style:{overflowY:"auto",height:"75vh"}},{default:o(()=>[Y("div",G,[n(V,{class:"view-port-content"},{default:o(()=>[(p(!0),u(k,null,y(t.activeCategoryItems,(a,m)=>N((p(),C(w,{key:m,color:a.isChecked?"light":""},{default:o(()=>[n(g,null,{default:o(()=>[n(f,{class:"his-md-text"},{default:o(()=>[L(b(a.label),1)]),_:2},1024)]),_:2},1024),n($,{slot:"end",modelValue:a.isChecked,"onUpdate:modelValue":d=>a.isChecked=d,onIonChange:d=>t.onselect(a,d),disabled:a==null?void 0:a.disabled},null,8,["modelValue","onUpdate:modelValue","onIonChange","disabled"])]),_:2},1032,["color"])),[[D,a.other.display]])),128))]),_:1})])]),_:1})):I("",!0),t.showKeyboard?(p(),C(O,{key:1,kbConfig:t.keyboard,onKeyPress:t.keypress},null,8,["kbConfig","onKeyPress"])):I("",!0)]),_:1})]),_:1})]),_:1},8,["showFull"])])}const X=U(M,[["render",J],["__scopeId","data-v-9ddc1996"]]);export{X as default};
