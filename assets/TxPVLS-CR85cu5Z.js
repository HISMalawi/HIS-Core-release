import{_}from"./ReportMixin.vue_vue_type_script_lang-CqLvuQmv.js";import{R as u}from"./TableReportTemplate-CRKA8rFt.js";import{d as c,I as g,as as i,au as d,aN as a,dz as f,aa as D,c as F,w as m,af as w,a as L,b as R}from"./index-CMZASHAR.js";import{V as T}from"./viral_load_report-C5l6NbYt.js";import{A as P}from"./v2utils-DPaBC-nQ.js";import"./BasicReportTemplate-CbJ_oMga.js";import"./Export-CpyT9Gk1.js";import"./index-_zuoFVCp.js";import"./Pagination-D_B_LriE.js";import"./HisStandardForm-BCjM4-bc.js";import"./ReportErrors-JbEvJfLt.js";import"./TableView-DhTjQT8r.js";const v=c({mixins:[_],components:{ReportTemplate:u,IonPage:g},data:()=>({cohort:{},rows:[],totals:{F:{},M:{}},columns:[[i.thTxt("Age group"),i.thTxt("Gender"),i.thTxt("TX_CURR"),i.thTxt("Due for VL"),i.thTxt("Routine (Sample Drawn)"),i.thTxt("Targeted (Sample Drawn)"),i.thTxt("Routine (High VL (>=1000 copies))"),i.thTxt("Targeted High VL (>=1000 copies)"),i.thTxt("Routine (Low VL (<1000 copies))"),i.thTxt("Targeted (Low VL (<1000 copies))")]]}),created(){this.fields=this.getDateDurationFields()},methods:{async onPeriod(t,e,o=!1){this.rows=[],this.totals={F:{},M:{}},this.report=new T,this.report.setOccupation(e.occupation),this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period=this.report.getDateIntervalPeriod(),this.cohort=await this.report.getVLCoverage(o),await this.setRows("F"),await this.setRows("M"),this.setAllMalesTotalsRow(),await this.setFemaleTotalsRow()},setTotals(t,e,o){this.totals[e][t]||(this.totals[e][t]=[]),this.totals[e][t]=this.totals[e][t].concat(o)},drillDown(t,e){return t.length>=1?i.tdLink(t.length,async()=>(await d.create({component:P,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:this.period,patientIdentifiers:t,title:e,viewRef:"person_id",onFinish:()=>d.getTop().then(o=>o&&d.dismiss())}})).present()):i.td(0)},async setFemaleTotalsRow(){const t=this.totals.F,e=a.uniq(Object.values(t).flat(1)),o=await this.report.getMaternalStatus(e),l=o.FBf.concat(o.FP),r=(n,h)=>h.filter(p=>o[n].includes(p)),s=n=>n.filter(h=>!l.includes(h));this.rows.push([i.td("All"),i.td("FP"),this.drillDown(r("FP",t.tx_curr),"TX_CURR FP"),this.drillDown(r("FP",t.due_for_vl),"Due for VL FP"),this.drillDown(r("FP",t.drawn_routine),"Routine (Sample Drawn) FP"),this.drillDown(r("FP",t.drawn_targeted),"Targetted (Sample Drawn) FP"),this.drillDown(r("FP",t.high_vl_routine),"Routine (High VL (>=1000 copies)) FP"),this.drillDown(r("FP",t.high_vl_targeted),"Targeted High VL (>=1000 copies) FP"),this.drillDown(r("FP",t.low_vl_routine),"Routine (Low VL (<1000 copies)) FP"),this.drillDown(r("FP",t.low_vl_targeted),"Targeted (Low VL (<1000 copies)) FP")]),this.rows.push([i.td("All"),i.td("FNP"),this.drillDown(s(t.tx_curr),"TX_CURR FNP"),this.drillDown(s(t.due_for_vl),"Due for VL FNP"),this.drillDown(s(t.drawn_routine),"Routine (Sample Drawn) FNP"),this.drillDown(s(t.drawn_targeted),"Targetted (Sample Drawn) FNP"),this.drillDown(s(t.high_vl_routine),"Routine (High VL (>=1000 copies)) FNP"),this.drillDown(s(t.high_vl_targeted),"Targeted High VL (>=1000 copies) FNP"),this.drillDown(s(t.low_vl_routine),"Routine (Low VL (<1000 copies)) FNP"),this.drillDown(s(t.low_vl_targeted),"Targeted (Low VL (<1000 copies)) FNP")]),this.rows.push([i.td("All"),i.td("FBF"),this.drillDown(r("FBf",t.tx_curr),"TX_CURR FBf"),this.drillDown(r("FBf",t.due_for_vl),"Due for VL FBf"),this.drillDown(r("FBf",t.drawn_routine),"Routine (Sample Drawn) FBf"),this.drillDown(r("FBf",t.drawn_targeted),"Targetted (Sample Drawn) FBf"),this.drillDown(r("FBf",t.high_vl_routine),"Routine (High VL (>=1000 copies)) FBf"),this.drillDown(r("FBf",t.high_vl_targeted),"Targeted High VL (>=1000 copies) FBf"),this.drillDown(r("FBf",t.low_vl_routine),"Routine (Low VL (<1000 copies)) FBf"),this.drillDown(r("FBf",t.low_vl_targeted),"Targeted (Low VL (<1000 copies)) FBf")])},setAllMalesTotalsRow(){const t=this.totals.M;return this.rows.push([i.td("All"),i.td("Male"),this.drillDown(t.tx_curr,"TX_CURR Male"),this.drillDown(t.due_for_vl,"Due for VL Male"),this.drillDown(t.drawn_routine,"Routine (Sample Drawn) Male"),this.drillDown(t.drawn_targeted,"Targetted (Sample Drawn) Male"),this.drillDown(t.high_vl_routine,"Routine (High VL (>=1000 copies)) Male"),this.drillDown(t.high_vl_targeted,"Targeted High VL (>=1000 copies) Male"),this.drillDown(t.low_vl_routine,"Routine (Low VL (<1000 copies)) Male"),this.drillDown(t.low_vl_targeted,"Targeted (Low VL (<1000 copies)) Male")])},async setRows(t){const e=this.formatGender(t);for(const o of f){const l=(r,s,n)=>(this.setTotals(r,t,s),this.drillDown(s,n));this.rows.push([i.td(o),i.td(e),l("tx_curr",a.get(this.cohort,"".concat(o,".").concat(t,".tx_curr"),[]),"".concat(o," TX_CURR (").concat(e,")")),l("due_for_vl",a.get(this.cohort,"".concat(o,".").concat(t,".due_for_vl"),[]),"".concat(o," Due for VL (").concat(e,")")),l("drawn_routine",a.get(this.cohort,"".concat(o,".").concat(t,".drawn.routine"),[]),"".concat(o," Routine (Sample Drawn) (").concat(e,"s)")),l("drawn_targeted",a.get(this.cohort,"".concat(o,".").concat(t,".drawn.targeted"),[]),"".concat(o," Targeted (Sample Drawn) (").concat(e,"s)")),l("high_vl_routine",a.get(this.cohort,"".concat(o,".").concat(t,".high_vl.routine"),[]),"".concat(o," Routine (High VL (>=1000 copies)) (").concat(e,"s)")),l("high_vl_targeted",a.get(this.cohort,"".concat(o,".").concat(t,".high_vl.targeted"),[]),"".concat(o," Targeted High VL (>=1000 copies) (").concat(e,"s)")),l("low_vl_routine",a.get(this.cohort,"".concat(o,".").concat(t,".low_vl.routine"),[]),"".concat(o," Routine (Low VL (<1000 copies)) (").concat(e,"s)")),l("low_vl_targeted",a.get(this.cohort,"".concat(o,".").concat(t,".low_vl.targeted"),[]),"".concat(o," Targeted (Low VL (<1000 copies)) (").concat(e,"s)"))])}}}});function $(t,e,o,l,r,s){const n=w("report-template"),h=w("ion-page");return L(),F(h,null,{default:m(()=>[R(n,{title:"PEPFAR TX_PVLS Report",period:t.period,rows:t.rows,fields:t.fields,columns:t.columns,config:{showIndex:!0},reportPrefix:"PEPFAR",hasServerSideCaching:!0,onReportConfiguration:t.onPeriod},null,8,["period","rows","fields","columns","onReportConfiguration"])]),_:1})}const E=D(v,[["render",$]]);export{E as default};
