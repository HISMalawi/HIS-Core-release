import{O as c}from"./opd_report_service-56DRmHjV.js";import{R as u}from"./BaseTableReport-BkEXrQ18.js";import{d as h,I as f,as as i,H as p,ao as v,dJ as _,aa as g,af as d,a as w,c as y,w as R,b as D}from"./index-CMZASHAR.js";import{_ as B}from"./ReportMixin.vue_vue_type_script_lang-CqLvuQmv.js";import"./Export-CpyT9Gk1.js";import"./index-_zuoFVCp.js";import"./HisStandardForm-BCjM4-bc.js";import"./BasicReportTemplate-CbJ_oMga.js";import"./Pagination-D_B_LriE.js";const C=h({components:{ReportTemplate:u,IonPage:f},mixins:[B],data:()=>({title:"Clinic Registration",rows:[],reportData:[],columns:[[i.thTxt("Reg"),i.thTxt("First Name"),i.thTxt("Last Name"),i.thTxt("Gender"),i.thTxt("DOB"),i.thTxt("Date reg.")]],customBtns:[]}),created(){this.fields=this.getDateDurationFields(),this.customBtns.push({name:"High level view",size:"large",slot:"start",color:"primary",visible:!0,onClick:async()=>this.showModal()})},methods:{async init(t,e){const r=new c;r.setStartDate(e.start_date),r.setEndDate(e.end_date),this.period=r.getDateIntervalPeriod();const a=await r.getClinicRegistrations();this.reportData=a.sort((s,o)=>s.visit_type>o.visit_type?1:s.visit_type<o.visit_type?-1:0),this.rows=this.buildRows(this.reportData)},buildRows(t){return t.length?t.map(e=>[i.td(e.visit_type),i.td(e.given_name),i.td(e.family_name),i.td(e.gender),i.td(p.toStandardHisDisplayFormat(e.birthdate)),i.td(p.toStandardHisDisplayFormat(e.visit_date))]):[]},filterBy(t,e){return this.reportData.filter(r=>{const a=p.calculateAge(r.birthdate,v.getSessionDate());return r.visit_type===t&&(e==="under5"?a<=5:a>6)})},modalData(){const t=[...this.filterBy("New patient","under5")].length,e=[...this.filterBy("New patient","over5")].length,r=t+e,a=[...this.filterBy("Referral","under5")].length,s=[...this.filterBy("Referral","over5")].length,o=a+s,n=[...this.filterBy("Revisiting","under5")].length,l=[...this.filterBy("Revisiting","over5")].length,m=n+l;return[{label:"New patient",under5:t,over5:e,value:r},{label:"Referral",under5:a,over5:s,value:o},{label:"Revisiting",under5:n,over5:l,value:m}]},async showModal(){await _([...this.modalData()])}}});function b(t,e,r,a,s,o){const n=d("report-template"),l=d("ion-page");return w(),y(l,null,{default:R(()=>[D(n,{title:t.title,rows:t.rows,fields:t.fields,columns:t.columns,itemsPerPage:10,period:t.period,reportPrefix:"Clinic",onReportConfiguration:t.init,customBtns:t.customBtns,paginated:""},null,8,["title","rows","fields","columns","period","onReportConfiguration","customBtns"])]),_:1})}const I=g(C,[["render",b]]);export{I as default};
