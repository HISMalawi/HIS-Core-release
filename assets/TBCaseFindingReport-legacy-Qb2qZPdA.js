System.register(["./TableReportTemplate-legacy-CKj3FIGR.js","./index-legacy-Dg5P6bX-.js","./dynamic-import-helper-legacy-arUa2LZV.js","./tb_report_service-legacy-DSn6dSK5.js","./ReportMixin.vue_vue_type_script_lang-legacy-kOBZLM0d.js","./TBDrilldown-legacy-4nbm6Glw.js","./Export-legacy-3ZHnhIid.js","./HisStandardForm-legacy-BXV61qjj.js","./TouchScreenForm-legacy-Bqug27CT.js","./ToolbarMediumCard-legacy-DWokgyDV.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-D3j1oaCn.js","./ReportErrors-legacy-BDEmzxBv.js","./MultiFieldDateHelper-legacy-DBQBHUfA.js","./KbLayouts-legacy-BKvPSxzZ.js","./HisKbConfigurations-legacy-vrLd9Pgz.js","./BasicReportTemplate-legacy-Q043r8R3.js","./SIngleTouchField-legacy-SRHCPnWv.js","./Pagination-legacy-DMKxolpC.js","./TableView-legacy-D9drx_2x.js","./PopupKeyboard-legacy-Cz-tBZHa.js","./HisKeypad-legacy-CAj098_i.js","./BaseKeyboard-legacy-DbTjgoKo.js","./KbHandler-legacy-De8o5nTq.js","./fuse-legacy-CQoBB3MK.js","./HisKeyboard-legacy-C-8xTqW8.js"],(function(e,t){"use strict";var a,l,i,r,o,s,n,u,c,p,d,m,h,g,_,y,v,b;return{setters:[e=>{a=e.R},e=>{l=e.d,i=e.I,r=e.K,o=e.V,s=e.O,n=e.t,u=e.L,c=e._,p=e.r,d=e.o,m=e.c,h=e.w,g=e.b},e=>{_=e.F},e=>{y=e.T},e=>{v=e._},e=>{b=e.T},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){const t=l({mixins:[v],components:{IonPage:i,ReportTemplate:a},data:()=>({rows:[],reportIndicators:[],columns:r([[]]),subtitle:r("-"),data:r([]),yearValue:r(""),quarterValue:r(1),indicatorsValue:r([]),casesIndicators:[{label:"New Smear positive",value:"new_smear_positive"},{label:"New MTB Detected Xpert",value:"new_mtb_detected_xpert"},{label:"New Pulmonary Clinically Diagnosed",value:"new_pulmonary_clinically_diagnosed"},{label:"New EPTB",value:"new_eptb"},{label:"Relapse Bacteriologically Confirmed",value:"relapse_bacteriologically_confirmed"},{label:"Treatment Failure Bacteriologically Confirmed",value:"treatment_failure_bacteriologically_confirmed"},{label:"Treatment LTF Bacteriologically Confirmed",value:"treatment_ltf_bacteriologically_confirmed"},{label:"Treatment LTF Clinically Diagnosed Pulmonary",value:"treatment_ltf_clinically_diagnosed_pulmonary"},{label:"Treatment LTF EPTB",value:"treatment_ltf_eptb"},{label:"Relapse Clinical Pulmonary",value:"relapse_clinical_pulmonary"},{label:"Relapse EPTB",value:"relapse_eptb"},{label:"Other Previously Treated Bacteriologically Confirmed",value:"other_previously_treated_bacteriologically_confirmed"},{label:"Other Previously Treated Clinical Pulmonary",value:"other_previously_treated_clinical_pulmonary"},{label:"Other Previously Treated EPTB",value:"other_previously_treated_eptb"},{label:"Unknown Previous Treatment History Bacteriological",value:"unknown_previous_treatment_history_bacteriological"},{label:"Unknown Previous Treatment History EPTB",value:"unknown_previous_treatment_history_eptb"}],presumptiveIndicators:[{label:"Patients with Presumptive TB Undergoing Bacteriological Examination Via Xpert",value:"patients_with_presumptive_tb_undergoing_bacteriological_examination_via_xpert"},{label:"Patients with Presumptive TB Undergoing Bacteriological Examination Via Microscopy",value:"patients_with_presumptive_tb_undergoing_bacteriological_examination_via_microscopy"},{label:"Patients with Presumptive TB with Positive Bacteriological Examination Via Xpert",value:"patients_with_presumptive_tb_with_positive_bacteriological_examination_via_xpert"},{label:"Patients with Presumptive TB with Positive Bacteriological Examination Via Microscopy",value:"patients_with_presumptive_tb_with_positive_bacteriological_examination_via_microscopy"}],reportConfig:[],age_groups:["0-4","5-14","15-24","25-34","35-44","45-54","55-64","65+"]}),mounted(){this.init()},methods:{init(){this.reportIndicators=[...this.casesIndicators,...this.presumptiveIndicators],this.reportConfig=[{id:"year",helpText:"Year",type:_.TT_NUMBER,validation:e=>o.required(e),computedValue:e=>e.value},{id:"quater",helpText:"Quater",type:_.TT_SELECT,requireNext:!1,options:()=>[{label:"First",value:1},{label:"Second",value:2},{label:"Third",value:3},{label:"Fourth",value:4}],validation:e=>o.required(e),computedValue:e=>e.value},{id:"indicators",helpText:"Indicators",type:_.TT_MULTIPLE_SELECT,options:()=>this.reportIndicators,validation:e=>o.required(e),computedValue:e=>e.map((e=>e.value)),config:{footerBtns:[{name:"Cases",slot:"end",onClickComponentEvents:{refreshOptions:()=>{const e=this.casesIndicators.map((e=>e.value));return this.reportIndicators.map((t=>(e.includes(t.value)?t.isChecked=!0:t.isChecked=!1,t)))}},onClick:()=>"None"},{name:"Presumptives",slot:"end",onClickComponentEvents:{refreshOptions:()=>{const e=this.presumptiveIndicators.map((e=>e.value));return this.reportIndicators.map((t=>(e.includes(t.value)?t.isChecked=!0:t.isChecked=!1,t)))}},onClick:()=>"None"}]}}]},async generate(e){try{this.rows=[],this.columns=this.buildColumns(e.indicators.map((e=>e.label))),this.indicatorsValue=e.indicators.map((e=>e.value)),this.yearValue=e.year.value,this.quarterValue=e.quater.value;const t=new y;this.data=await t.getTBCaseFindingReport(this.yearValue,this.quarterValue,this.indicatorsValue),this.pushGenderAggregatedHeaders(),this.populateRows(),this.addTotals(),s.getTop().then((e=>e&&s.dismiss()))}catch(t){console.error(t),n("Unable to generate report")}},addTotals(){let e=this.data.flatMap((e=>[Object.values(e).reduce(((e,t)=>t&&t.male&&t.male.length>0?t.male:e),[]),Object.values(e).reduce(((e,t)=>t&&t.female&&t.female.length>0?t.female:e),[])]));e=e.map((e=>this.toDrillColumn("total",{total:e,indicator:""}))),e.unshift(u.td("Totals")),this.rows.push(e)},populateRows(){this.rows=this.age_groups.map((e=>{const t=[];return t.push(u.td(e)),this.data.forEach((a=>{const l=a[e];t.push(l?this.toDrillColumn("male",l):u.td(0)),t.push(l?this.toDrillColumn("female",l):u.td(0))})),t}))},pushGenderAggregatedHeaders(){this.columns[1]=[],this.columns[1].push(u.thTxt("",{sortable:!1,exportable:!1}));for(let e=0;e<this.indicatorsValue.length;e++)this.columns[1].push(u.thTxt("M",{sortable:!1,exportable:!1}),u.thTxt("F",{sortable:!1,exportable:!1}))},toDrillColumn(e,t){return 0==t[e].length?u.td(0):u.tdLink(t[e].length,(()=>{this.drilldown({indicator:t.indicator,ids:[t[e]]})}))},async drilldown(e){(await s.create({component:b,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:e.indicator,patientIdentifiers:e.ids,subtitle:`Period: ${this.period} Q${this.quarterValue}`,onFinish:()=>s.getTop().then((e=>e&&s.dismiss()))}})).present()},buildColumns(e){const t=[[u.thTxt("",{sortable:!1,exportable:!1}),u.thTxt("Age Category",{sortable:!1,exportable:!1})]];return e.forEach((e=>{t[0].push(u.thTxt(e,{colspan:2,sortable:!1,exportable:!0}))})),t}}});e("default",c(t,[["render",function(e,t,a,l,i,r){const o=p("report-template"),s=p("ion-page");return d(),m(s,null,{default:h((()=>[g(o,{title:"TB Case Finding Report",period:"Period",rows:e.rows,fields:e.reportConfig,columns:e.columns,reportPrefix:"NTP",config:{showIndex:!0},onReportConfiguration:e.generate},null,8,["rows","fields","columns","onReportConfiguration"])])),_:1})}]]))}}}));
