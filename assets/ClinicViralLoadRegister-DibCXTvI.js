import{d as w,r as d,cy as A,at as C,o as S,a as V,c as P,w as N,b as $,u as g,ci as m,H as T,D as x,I as B,i as F,df as I,dg as M,aM as j}from"./index-CMZASHAR.js";import{v as H}from"./TableView-DhTjQT8r.js";import{b as W,w as k,s as L}from"./v2utils-DPaBC-nQ.js";import"./Export-CpyT9Gk1.js";import"./index-_zuoFVCp.js";const Q=w({__name:"ClinicViralLoadRegister",setup(E){const D=F("reports.png"),n=d(""),r=d([]),l=d("All"),u=d([]),s=new A,h=[[W(),{label:"Accession #",ref:"accession_number"},{label:"Status",ref:"order_status"},{label:"Order Date",ref:"date_ordered",toValue:e=>"".concat(m(e))},{label:"Result",ref:"result",toValue:e=>e?e.replace(/</g,"&lt;"):""},{label:"Date received",ref:"date_received",toValue:e=>{var t;return"".concat((t=m(e))!=null?t:"")}},{label:"Mode of Delivery",ref:"result_delivery_mode",toValue:e=>e=="test_results_delivered_to_site_electronically"?"Electronic":e=="test_results_delivered_to_site_manually"?"Manual":""},{label:"Test reason",ref:"test_reason"},{label:"TAT(Days)",ref:"tat",value:e=>e.date_received&&e.date_ordered?T.dateDiffInDays(e.date_received,e.date_ordered):""}]],i={All:()=>!0,"No results":e=>!e.result,"With Results":e=>e.result,Rejected:e=>e.order_status==="test-rejected",Drawn:e=>e.order_status==="drawn",Pending:e=>e.order_status==="pending",Started:e=>e.order_status==="started",Failed:e=>e.order_status==="failed","Not-done":e=>e.order_status==="not-done",Completed:e=>e.order_status==="completed","Targeted orders":e=>/target/i.test("".concat(e.test_reason)),"Targeted orders with results":e=>/target/i.test("".concat(e.test_reason))&&e.result},v=e=>i[e]?r.value.filter(t=>i[e](t)):[],y=C(()=>v(l.value)),R=async()=>{const e=a=>v(a).length||"0",t=[[{label:"Indicator",ref:"label"},{label:"Count",ref:"value"}]],c=[{label:"Total Orders",value:e("All")},{label:"Total Orders With Results",value:e("With Results")},{label:"Total Orders No Results",value:e("No results")},{label:"Total Orders Rejected",value:e("Rejected")},{label:"Total Targeted Orders",value:e("Targeted orders")},{label:"Total Targeted Orders With Results",value:e("Targeted orders with results")},{label:"Total Orders Drawn",value:e("Drawn")},{label:"Total Orders Pending",value:e("Pending")},{label:"Total Orders Started",value:e("Started")},{label:"Total Orders Failed",value:e("Failed")},{label:"Total Orders Not-done",value:e("Not-done")},{label:"Total Orders Completed",value:e("Completed")},{label:"Average TAT (days)",value:(()=>{let a=0;const O=r.value.reduce((p,o)=>o.date_received&&o.date_ordered?(++a,p+parseInt("".concat(T.dateDiffInDays(o.date_received,o.date_ordered)))):p,0);return Math.floor(O/a)})()}];L({title:"Register Summary",columns:t,columnData:c,subtitle:n.value,rowsPerPage:50})},_=()=>{u.value=[{text:"<b>High level view</b>",icon:I,color:"primary",action:()=>R()},{text:"<b>Report filter: <i>".concat(l.value,"</i></b>"),icon:M,color:"primary",action:async()=>{const e=await j("Select report filter","",Object.keys(i),[{name:"Cancel",slot:"start"},{name:"Select",slot:"end",role:"action"}]);l.value=(e==null?void 0:e.selection)||l.value,_()}}]},f=()=>k(async()=>{r.value=[],u.value=[],r.value=await s.getClinicElectronicAlerts(),_()}),b=()=>x({onFinish:(e,t,c,a)=>{a&&s.setOccupation(a),n.value="".concat(c),s.startDate=e,s.endDate=t,f()}});return S(()=>!r.value.length&&b()),(e,t)=>(V(),P(g(B),null,{default:N(()=>[$(H,{"default-sort-order":"asc","default-sorted-column":"arv_number","icon-url":g(D),subtitle:n.value,title:"Viral Load Register","report-prefix":"Clinic",columns:h,onConfigure:b,headerBadge:u.value,columnData:y.value,rowsPerPage:50,onRefresh:f},null,8,["icon-url","subtitle","headerBadge","columnData"])]),_:1}))}});export{Q as default};
