System.register(["./HisStandardForm-legacy-BpfFI5_j.js","./index-legacy-C29Eb2Qm.js","./dynamic-import-helper-legacy-DYK5bIOV.js","./useEncounter-legacy-BfvNE2Tj.js","./commons-legacy-CVxl4ICy.js","./TouchScreenForm-legacy-BmEuIwWy.js","./ToolbarMediumCard-legacy-CF38wqjC.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-CDi_rmkw.js","./isEmpty-legacy-DuM3tHlb.js","./_Set-legacy-DwoRCLJe.js","./_setToArray-legacy-BoIwo_SZ.js","./encounter_guidelines-legacy-BDiBaLGJ.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,a){"use strict";var t,n,s,i,l,o,c,u,r,g,d,y,m,p,T,w,_,b,v,j;return{setters:[e=>{t=e.H},e=>{n=e.b5,s=e.aS,i=e.d,l=e.K,o=e.aU,c=e.V,u=e.ab,r=e.o,g=e.c,d=e.w,y=e.b,m=e.c4,p=e.I,T=e.S,w=e.n},e=>{_=e.F},e=>{b=e.u},e=>{v=e.a,j=e.r},null,null,null,null,null,null,null,null,null],execute:function(){class a extends n{constructor(e,a){super(e,41,a)}static async getDiagnosis(e="",a=1,t=10){const i=s.getConceptID("Qech outpatient diagnosis list");return n.getJson("diagnosis",{id:i,name:e,page:a,page_size:t})}}class D extends n{constructor(e,a){super(e,105,a)}}e("default",i({__name:"Diagnosis",setup(e){let n,s;const i=l("No"),E=l([]),{goToNextTask:f,patientDashboardUrl:h}=b(((e,t)=>{o.getLatestMalariaTestResult(t).then((e=>i.value=e)),n=new D(t,e),s=new a(t,e),E.value=[x("Primary"),x("Secondary"),{id:"clinical_notes",helpText:"Clinical notes",type:_.TT_TEXT,computedValue:e=>u.isEmpty(e)?null:{tag:"notes",obs:n.buildValueText("Clinical notes construct",e.value)}}]}));async function S(e,a){await s.createEncounter();const t=await j({...a,obs_datetime:T.getSessionDate()},"diagnosis");await s.saveObservationList(t);const i=await j({...a},"notes");u.isEmpty(i)||(await n.createEncounter(),await n.saveObservationList(i)),f()}function x(e){return{id:`${e.toLowerCase()}_diagnosis`,helpText:`${e} Diagnosis`,type:_.TT_INFINITE_SCROLL_MULTIPLE_SELECT,validation:a=>"Primary"===e?c.required(a):null,options:async(e,t="",n=1,s=10)=>{const i=await a.getDiagnosis(t,n,s);return v(i,"name","concept_id")},beforeNext:async e=>await async function(e){return!e.some((({label:e})=>/Malaria/i.test(e)))||"Positive"===i.value||await w(`Patient has ${i.value} malaria test result. Do you want to continue?`)}(e),computedValue:a=>({tag:"diagnosis",obs:a.map((({value:a})=>s.buildValueCoded(`${e} Diagnosis`,a)))}),config:{isFilterDataViaApi:!0,showKeyboard:!0}}}return(e,a)=>(r(),g(m(p),null,{default:d((()=>[y(t,{cancelDestinationPath:m(h),fields:E.value,onFinishAction:S},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
