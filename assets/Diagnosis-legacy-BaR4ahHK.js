System.register(["./index-legacy-Dg5P6bX-.js","./dynamic-import-helper-legacy-arUa2LZV.js","./HisStandardForm-legacy-BXV61qjj.js","./useEncounter-legacy-Bp6E5sCN.js","./util-legacy-CjANJSja.js","./commons-legacy-CiEua9CM.js","./TouchScreenForm-legacy-Bqug27CT.js","./ToolbarMediumCard-legacy-DWokgyDV.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-D3j1oaCn.js","./isEmpty-legacy-rdjCNuhy.js","./_Set-legacy-BL8ow4HL.js","./_setToArray-legacy-jEwcQpqP.js","./encounter_guidelines-legacy-mRSBdMQj.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,i,l,o,n,s,r,u,c,d,T,_,p,E,A,R,S,g,m,v,y,N,b;return{setters:[e=>{a=e.d,i=e.K,l=e.b5,o=e.cV,n=e.V,s=e.o,r=e.c,u=e.w,c=e.b,d=e.cl,T=e.b9,_=e.ad,p=e.cW,E=e.cX,A=e.cY,R=e.ag,S=e.I},e=>{g=e.F},e=>{m=e.H},e=>{v=e.u},e=>{y=e.g,N=e.a},e=>{b=e.r},null,null,null,null,null,null,null,null,null],execute:function(){e("default",a({__name:"Diagnosis",setup(e){const t=i([]),a=new l(-1,o.DIAGNOSIS),L=i(),{goToNextTask:P,patientDashboardUrl:O,facts:Y}=v(((e,i,l)=>{a.patientID=i,a.providerID=e,L.value=l,t.value=[(()=>{const e=[["Infiltration","PULMONARY_TB"],["Tuberculosis Miliary","PULMONARY_TB"],["Opacification","PULMONARY_TB"],["Consolidation","PULMONARY_TB"],["Cavitation","PULMONARY_TB"],["Hilar Lymphadenopathy","EXTRA_PULMONARY_TB"],["Tuberculosis Meningitis","EXTRA_PULMONARY_TB"],["Lymphadenitis","EXTRA_PULMONARY_TB"],["Osteoarticular","EXTRA_PULMONARY_TB"],["Gastrointestinal","EXTRA_PULMONARY_TB"],["Pleural Effusion","EXTRA_PULMONARY_TB"],["Tuberculosis Spine","EXTRA_PULMONARY_TB"]];return{id:"procedureType",helpText:"Procedure Type:",requireNext:!1,type:g.TT_SELECT,validation:e=>n.required(e),computedValue:e=>[{concept_id:y("PROCEDURE_TYPE"),value_coded:y(`${e.value}`),obs_datetime:a.date},{concept_id:y("CLINICALLY_DIAGNOSED"),value_coded:y("YES_ANSWER"),obs_datetime:a.date}],options:()=>[{value:"ULTRASOUND",label:"Ultrasound Scanning",other:{procedures:[["Pleural Effusion","EXTRA_PULMONARY_TB"],["Pericardial Effusion","EXTRA_PULMONARY_TB"],["Abdominal Tuberculosis","EXTRA_PULMONARY_TB"],["Tuberculosis Ascites","EXTRA_PULMONARY_TB"]]}},{value:"X_RAY",label:"X-Ray",other:{procedures:e}},{value:"CLINICAL",label:"Clinical",other:{procedures:e}}]}})(),{id:"tbStatus",helpText:"TB Present?",type:g.TT_SELECT,computedValue:e=>({concept_id:y("TB_STATUS"),value_coded:y(e.value),obs_datetime:a.date}),validation:e=>n.required(e),options:()=>[{value:"POSITIVE",label:"Yes"},{value:"NEGATIVE",label:"No"}],requireNext:!1},{id:"tbStrain",helpText:"Type of TB:",type:g.TT_MULTIPLE_SELECT,computedValue:e=>[...e.map((e=>({concept_id:y("TUBERCULOSIS_CLASS"),value_coded:y(`${e.label}`),obs_datetime:a.date}))),{concept_id:y("TB_TYPE"),value_coded:y(`${e[0].value}`),obs_datetime:a.date}],validation:e=>n.required(e),condition:e=>"POSITIVE"===e.tbStatus.value&&e.procedureType.other.procedures.length,options:e=>e.procedureType.other.procedures.map((([e,t])=>({label:e,value:t})))},{id:"drugResistance",helpText:"Clinically enroll patient for:",type:g.TT_SELECT,validation:e=>n.required(e),condition:e=>"POSITIVE"===e.tbStatus.value,options:()=>[{value:"NO_ANSWER",label:"Firstline treatment"},{value:"YES_ANSWER",label:"DR TB treatment"}]},{id:"resistantTo",helpText:"Suspected drug resistance to:",type:g.TT_MULTIPLE_SELECT,computedValue:e=>{const t=e.map((e=>({concept_id:y("TB_DRUG_RESISTANT"),value_coded:N(`${e.value}`),obs_datetime:a.date})));return t.length>1?t.push({concept_id:y("Resistance classification"),value_coded:y("Multi drug resistant"),obs_datetime:a.date}):1===t.length&&t.push({concept_id:y("Resistance classification"),value_coded:y("Mono drug resistant"),obs_datetime:a.date}),t},validation:e=>n.required(e),condition:e=>"YES_ANSWER"===e.drugResistance.value,options:()=>[{value:"Rifampicin",label:"Rifampicin"},{value:"Isoniazid",label:"Isoniazid"}]}]}));async function h(e,t){if("YES_ANSWER"==e?.drugResistance?.value){const e=new T(a.patientID);if("Yes"===await _("Drug resistance detected","Client is resistant to one or more standard TB drugs","Do you want to enroll client in the Drug resistance program?",[{name:"Yes",slot:"start",color:"success"},{name:"No",slot:"end",color:"danger"}])){try{await e.enrollProgram()}catch(l){console.warn(`${l}`)}e.setStateDate(a.date),e.setStateId(p.MDR),await e.updateState()}}const i=await b(t);if(await a.createEncounter(),await a.saveObservationList(i),"NEGATIVE"===e.tbStatus?.value&&!E.isOnTreatment(Y.outcome)&&L.value.getAge()>A)return"No"===await _("Notice","Client is TB Negative!","Would you like to retest client?",[{name:"Yes",slot:"start",color:"success"},{name:"No",slot:"end",color:"danger"}])?R.push(O.value):location.reload();P()}return(e,a)=>(s(),r(d(S),null,{default:u((()=>[c(m,{cancelDestinationPath:d(O),onFinishAction:h,fields:t.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
