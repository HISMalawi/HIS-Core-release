System.register(["./index-legacy-2OuOZQ1w.js","./TableView-legacy-qKxmf6r2.js"],(function(e,t){"use strict";var n,a,r,i,s,o,l,c,u,d,p,f,m,b,g,h,v,w,y,D;return{setters:[e=>{n=e.d,a=e.m,r=e.r,i=e.aR,s=e.a_,o=e.bm,l=e.cv,c=e.cw,u=e.bN,d=e.am,p=e.a,f=e.w,m=e.e,b=e.ar,g=e.b,h=e.bs,v=e.y,w=e.n,y=e.z},e=>{D=e.v}],execute:function(){e({a:async function(e){e.patientIdentifiers.length&&(await y.create({component:_,backdropDismiss:!1,cssClass:"large-modal",componentProps:{onFinish:()=>y.getTop().then((e=>e&&y.dismiss())),...e}})).present()},b:P,c:A,d:function(e){return e.map(((e,t)=>({...e,index:t+1})))},s:async function(e){(e.columnData??[]).length&&(await y.create({component:D,backdropDismiss:!1,cssClass:"large-modal",componentProps:{onFinish:()=>y.getTop().then((e=>e&&y.dismiss())),...e}})).present()},w:async function(e,t=!0){t&&(await h.create({message:"Please wait...",backdropDismiss:!1})).present();try{const t=await e();return h.getTop().then((e=>e?h.dismiss():null)),t}catch(n){console.error(n),v("Unable to generate report")}h.getTop().then((e=>e?h.dismiss():null))}});const t=n({props:{title:{type:String,default:"Drilldown"},patientIdentifiers:{type:Object},onFinish:{type:Function},viewRef:{type:String,default:"person_id"}},components:{IonPage:a,v2Datatable:D},setup(e){const t=r(!0),n=r("-"),a=r([]),d=[[P("identifier","ARV Number"),{label:"Gender",ref:"gender"},{label:"Birthdate",ref:"birthdate"},{label:"Art start date",ref:"art_start_date"},A(e.viewRef)]];return i((()=>e.patientIdentifiers),(async e=>{if(a.value=[],n.value="Total: 0",!e||!e.length)return;const r=s.chunk(e,1e3);for(const s of r){try{if(!t.value)break;const e=(await o.getPersons(s)).map((e=>({...e,birthdate:c(e.birthdate),art_start_date:c(e.art_start_date),gender:l(e.gender)})));a.value=[...a.value,...e]}catch(i){console.error(i)}n.value=`Total: ${a.value.length} of ${(e||[]).length}`,await u(100)}}),{immediate:!0}),{columns:d,subtitle:n,reportData:a,canLoadData:t,ITEMS_PER_PAGE:25,runFinishAction:function(){t.value=!1,"function"==typeof e.onFinish&&e.onFinish()}}}}),_=e("A",d(t,[["render",function(e,t,n,a,r,i){const s=b("v2Datatable"),o=b("ion-page");return g(),p(o,null,{default:f((()=>[m(s,{title:e.title,subtitle:e.subtitle,columnData:e.reportData,columns:e.columns,"default-sort-order":"asc","default-sorted-column":"identifier","on-finish":e.runFinishAction,rowsPerPage:e.ITEMS_PER_PAGE},null,8,["title","subtitle","columnData","columns","on-finish","rowsPerPage"])])),_:1})}]]));function P(e="arv_number",t="ARV#"){return{ref:e,label:t,sortValue:e=>{const t=`${e}`.match(/\w{2,5}-arv-(?<arvDigit>\d*)/i);return parseInt(t?.groups?.arvDigit||"-1")}}}function A(e="patient_id",t="/patient/dashboard/"){return{ref:e,label:"Actions",exportable:!1,toValue:()=>"View",tdClick:({refData:e})=>w.push(`${t}${e}`)}}}}}));
