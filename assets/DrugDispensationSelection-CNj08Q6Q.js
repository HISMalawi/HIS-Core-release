import{d as A,di as N,z as v,am as V,ar as c,h as u,b as r,e as o,w as d,g as e,t as h,a9 as k,aa as D,bc as M,j as g,ak as I,al as E,ad as O,ac as R,b2 as H,c1 as L,ai as T,a_ as q,y as F,a as Q,a6 as S}from"./index-qFt4YszW.js";import{O as U}from"./ActionSideButton-DfENpE_O.js";import{R as j}from"./ResetButton-CfevH3Db.js";import{_ as G}from"./FieldMixin.vue_vue_type_script_lang-BY_wT7wI.js";const J=A({data:()=>({listData:[],tabsIndex:2,packsIndex:3}),props:{drugName:{type:String,required:!0},tabsNeeded:{type:String,required:!0},items:{type:Array,required:!0},onDispense:{type:Function,required:!0},onClose:{type:Function}},computed:{dispensedValues(){return this.listData.filter(t=>t[this.tabsIndex]>0).map(t=>[t[this.tabsIndex],t[this.packsIndex]])},amountNeededRowSpan(){return this.listData.length+1}},watch:{items:{handler(t){t&&(this.listData=[...t])},deep:!0,immediate:!0}},methods:{async onClose(){await v.dismiss({}),typeof this.onClose=="function"&&this.onClose()},incrementAmount(t){const[n,,i,p]=this.listData[t],a=n+i,m=p+1;this.listData[t][2]=a,this.listData[t][3]=m},decrementAmount(t){const[n,,i,p]=this.listData[t],a=p-1;if(a>=0){const m=i-n;this.listData[t][2]=m,this.listData[t][3]=a}},fmtNumber(t){return/-/i.test(t)?t:N(t)}}}),z=t=>(I("data-v-de39aa22"),t=t(),E(),t),K={colspan:"6"},W=z(()=>e("tr",null,[e("th",null,"Total tab(s) needed "),e("th",{colspan:"2"}," Available stock "),e("th",{colspan:"2"}," Dispensed "),e("th")],-1)),X=z(()=>e("tr",null,[e("th"),e("th",null," Pack size "),e("th",null," Packs "),e("th",null," Total Tab(s)"),e("th",null," Packs "),e("th")],-1)),Y=["rowspan"],Z={class:"btn-list"};function x(t,n,i,p,a,m){const l=c("ion-button"),b=c("ion-content"),w=c("ion-toolbar"),C=c("ion-footer");return r(),u(k,null,[o(b,null,{default:d(()=>[e("table",null,[e("thead",null,[e("tr",null,[e("th",K,h(t.drugName),1)]),W,X]),e("tbody",null,[e("tr",null,[e("td",{rowspan:t.amountNeededRowSpan},h(t.tabsNeeded)+" tab(s) ",9,Y)]),(r(!0),u(k,null,D(t.listData,(y,_)=>(r(),u("tr",{key:_},[(r(!0),u(k,null,D(y,(f,s)=>(r(),u("td",{key:s,class:M(s>=2?"input-field":"his-md-text")},h(t.fmtNumber(f)),3))),128)),e("td",null,[e("ul",Z,[e("li",null,[o(l,{onClick:f=>t.incrementAmount(_),class:"dispense-btn",size:"large"},{default:d(()=>[g(" + ")]),_:2},1032,["onClick"])]),e("li",null,[o(l,{onClick:f=>t.decrementAmount(_),class:"dispense-btn",size:"large"},{default:d(()=>[g(" - ")]),_:2},1032,["onClick"])])])])]))),128))])])]),_:1}),o(C,null,{default:d(()=>[o(w,null,{default:d(()=>[o(l,{onClick:t.onClose,color:"danger",size:"large",slot:"end"},{default:d(()=>[g(" Close ")]),_:1},8,["onClick"]),o(l,{onClick:n[0]||(n[0]=y=>t.onDispense(t.dispensedValues)),color:"success",size:"large",slot:"end"},{default:d(()=>[g(" Dispense ")]),_:1})]),_:1})]),_:1})],64)}const tt=V(J,[["render",x],["__scopeId","data-v-de39aa22"]]),et=A({components:{IonInput:T,ViewPort:L,Barcode:H,NavButton:U,ResetButton:j,IonRow:R,IonCol:O},mixins:[G],data:()=>({dispensingLockEnabled:!1,tab:"prescribe",listData:[],medicationHistory:[],isStockManagementEnabled:!1}),mounted(){this.init()},activated(){this.init()},watch:{tab:{handler(t){t==="history"&&q.isEmpty(this.medicationHistory)&&typeof this.config.medicationHistory=="function"&&this.config.medicationHistory().then(n=>{n&&(this.medicationHistory=n)}).catch(n=>{F("".concat(n))})}}},methods:{async init(){var t,n;this.$emit("onFieldActivated",this),typeof((t=this.config)==null?void 0:t.isDrugManagementEnabled)=="function"&&(this.isStockManagementEnabled=(n=this.config)==null?void 0:n.isDrugManagementEnabled()),this.listData=await this.options(this.fdata)},async onScan(t){const[n,i]=t.split("-"),p=this.listData.map(async a=>{if(a.other.drug_id===parseInt(n)){const m=parseInt(a.value.toString()),l=parseInt(i);await this.updateOnValue(a,l,[],!0)&&(a.value=l+m)}return a});this.listData=await Promise.all(p)},async onReset(t){await this.updateOnValue(t,-1)},fmtNumber(t){return!this.isStockManagementEnabled||/-/i.test(t)?"-":N(t)},async updateOnValue(t,n,i=[],p=!1){return this.onValue&&!await this.onValue({label:t.label,other:{dispenses:i,...t.other},value:n},p)?!1:(t.value=n<0?0:n,this.$emit("onValue",t),this.onValueUpdate&&(this.listData=await this.onValueUpdate(t,this.listData)),!0)},async launchDispenser(t){this.dispensingLockEnabled=!0,(await v.create({component:tt,backdropDismiss:!1,cssClass:"custom-modal",componentProps:{drugName:t.label,tabsNeeded:t.other.amount_needed,items:t.other.pack_sizes,onClose:async()=>{this.dispensingLockEnabled=!1,await v.dismiss({})},onDispense:async i=>{const a=i.reduce((l,b)=>l+b[0],0);await this.updateOnValue(t,a,i)&&(this.dispensingLockEnabled=!1,await v.dismiss({}))}}})).present()}}}),B=t=>(I("data-v-e0e49e2a"),t=t(),E(),t),nt={class:"view-port-content"},st={key:0,class:"his-card history"},at={class:"his-table"},ot=B(()=>e("tr",null,[e("th",null," Medication"),e("th",null," Date"),e("th",null," Amount dispensed ")],-1)),it={key:1,class:"prescription-tab"},lt={class:"prescription-table-section his-card"},rt={class:"his-table"},ct=B(()=>e("tr",null,[e("th",null," Medication"),e("th",null," Amount in stock"),e("th",null," Amount needed"),e("th",null," Amount dispensed "),e("th",null," Reset ")],-1)),dt={class:"barcode-section"};function ut(t,n,i,p,a,m){const l=c("nav-button"),b=c("ion-col"),w=c("ion-input"),C=c("reset-button"),y=c("barcode"),_=c("ion-row"),f=c("view-port");return r(),Q(f,null,{default:d(()=>[e("div",nt,[o(_,null,{default:d(()=>[o(b,{size:"2"},{default:d(()=>[o(l,{onClick:n[0]||(n[0]=s=>t.tab="prescribe"),isActive:t.tab==="prescribe",image:"prescription/rx",label:"Prescribed"},null,8,["isActive"]),o(l,{onClick:n[1]||(n[1]=s=>t.tab="history"),isActive:t.tab==="history",image:"prescription/history",label:"History"},null,8,["isActive"])]),_:1}),o(b,{size:"10"},{default:d(()=>[t.tab==="history"?(r(),u("div",st,[e("table",at,[ot,(r(!0),u(k,null,D(t.medicationHistory,(s,$)=>(r(),u("tr",{key:$},[e("td",null,h(s.medication),1),e("td",null,h(s.date),1),e("td",null,h(s.amount),1)]))),128))])])):S("",!0),t.tab==="prescribe"?(r(),u("div",it,[e("div",lt,[e("table",rt,[ct,(r(!0),u(k,null,D(t.listData,(s,$)=>(r(),u("tr",{key:$},[e("td",null,h(s.label),1),e("td",null,h(t.fmtNumber(s.other.available_stock)),1),e("td",null,h(s.other.amount_needed),1),e("td",null,[o(w,{disabled:t.dispensingLockEnabled||s.value>0,value:s.value,onClick:P=>s.value<=0&&!t.dispensingLockEnabled?t.launchDispenser(s):null,class:"dosage-input"},null,8,["disabled","value","onClick"])]),e("td",null,[o(C,{label:"",disabled:s.value<=0,onClick:P=>s.value>0?t.onReset(s):null},null,8,["disabled","onClick"])])]))),128))])]),e("div",dt,[o(y,{onOnScan:t.onScan,class:"his-card"},null,8,["onOnScan"])])])):S("",!0)]),_:1})]),_:1})])]),_:1})}const _t=V(et,[["render",ut],["__scopeId","data-v-e0e49e2a"]]);export{_t as default};
