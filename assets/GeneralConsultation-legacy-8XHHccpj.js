System.register(["./HisStandardForm-legacy-CtrLQN93.js","./index-legacy-DXxqm6AG.js","./useEncounter-legacy-Dqnmu7U_.js","./commons-legacy-D9lN6d9I.js","./isEmpty-legacy-dlh1mvS-.js","./encounter_guidelines-legacy-aPDYJoC5.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,n,o,i,s,l,u,r,c,d,m,y,p,g,T,v,b,h,f,_;return{setters:[e=>{a=e.H},e=>{n=e.d,o=e.r,i=e.bK,s=e.a9,l=e.aa,u=e.u,r=e.v,c=e.w,d=e.x,m=e.y,y=e.a5,p=e.O,g=e.aP,T=e.br},e=>{v=e.u},e=>{b=e.y,h=e.m,f=e.r,_=e.a},null,null,null],execute:function(){e("default",n({__name:"GeneralConsultation",setup(e){const t=o(0),n=o(!1);let w;const C=o([]),{patientDashboardUrl:B,goToNextTask:S}=v(((e,a,o)=>{w=new i(a,168,e),C.value=function(e){return[{id:"on_tb_treatment",helpText:"On TB Treatment?",type:s.TT_SELECT,validation:e=>l.required(e),computedValue:e=>{const t=[{tag:"consultation",obs:w.buildValueCoded("TB treatment",e.value)}];return/yes/i.test(e.value)&&t.push({tag:"consultation",obs:w.buildValueCoded("TB Status","Confirmed TB on treatment")}),t},options:b},{id:"tb_side_effects",helpText:"TB Associated symptoms",type:s.TT_MULTIPLE_YES_NO,init:async()=>{const a=await e.getWeightHistory();return t.value=e.getWeightLossPercentageFromTrail(a),n.value=Number(t.value)>=10,!0},onValue:async e=>(await async function(e){if(n.value&&`${e.label}`.match(/malnutrition/i)&&`${e.value}`.match(/no/i)){const a=await g("Recommendation",`Patient's weight has dropped by ${t.value}% , is this controlled weight loss??`,"Please verify",[{name:"Confirm weight loss",slot:"start",color:"success"},{name:"Confirm controlled",slot:"end",color:"primary"}]);e.value="Confirm weight loss"===a?"Yes":"No"}}(e),!0),validation:e=>l.validateSeries([()=>l.required(e),()=>l.anyEmpty(e)]),condition:e=>e.on_tb_treatment.value.match(/no/i),options:(e,t)=>function(e){const t=T.getConceptsByCategory("tb_symptom",!0).map((({name:e})=>e));return _([...t],e)}(t),computedValue:e=>({tag:"consultation",obs:e.map((async e=>({...await w.buildValueCoded("Routine TB Screening",e.label),child:[await w.buildValueCoded(e.label,e.value)]})))})},{id:"tb_status",helpText:"TB Status",type:s.TT_SELECT,validation:e=>l.required(e),condition:e=>e.tb_side_effects.value.some((e=>/yes/i.test(e.value))),options:()=>h(["TB NOT suspected","TB Suspected","Confirmed TB Not on treatment"]),computedValue:e=>({tag:"consultation",obs:w.buildValueCoded("TB Status",e.value)})}]}(o)}));async function E(e,t){try{const e=await f(t,"consultation");await w.createEncounter(),await w.saveObservationList(e),S()}catch(a){console.error(a),p("An error occurred while saving the complaints")}}return(e,t)=>(u(),r(m(y),null,{default:c((()=>[d(a,{cancelDestinationPath:m(B),fields:C.value,onFinishAction:E,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
