System.register(["./index-legacy-CA6M7ipO.js","./HisStandardForm-legacy-a9YJRGaH.js","./EncounterMixin.vue_vue_type_script_lang-legacy-qUwf12Yn.js","./encounter_guidelines-legacy-Bcz_Mw7r.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,s,i,n,o,r,l,u,d,c,h,v,m,p,C,b,f;return{setters:[e=>{a=e.bQ,s=e.d,i=e.by,n=e.bx,o=e.W,r=e.R,l=e.bY,u=e.ad,d=e.ae,c=e.aV,h=e.bZ,v=e.aa,m=e.af,p=e.a,C=e.c},e=>{b=e.H},e=>{f=e._},null,null],execute:function(){class t extends a{hivStatus;artStatus;arvNumber;arvStartDate;constructor(e,t){super(e,181,t),this.hivStatus="",this.artStatus="",this.arvNumber="",this.arvStartDate=""}getHivStatus(){return this.hivStatus}getArtStatus(){return this.artStatus}getArvNumber(){return this.arvNumber}getArvStartDate(){return this.arvStartDate}isHivPositive(){return!!this.hivStatus.match(/positive/i)}async loadArtStatus(){const e=await a.getJson(`programs/12/patients/${this.patientID}/art_hiv_status`);e&&(this.hivStatus=e.hiv_status||this.hivStatus,this.artStatus=e.art_status||"",this.arvNumber=e.arv_number||"",this.arvStartDate=e.arv_start_date||"")}}const T=s({mixins:[f],components:{HisStandardForm:b},data:()=>({assessment:{},obs:[],showHIVQuestions:!0,alreadyOnTreatment:!1,offerCxCa:!1,patientPreviousTreatment:"",patientPreviousVisitHIVStatus:""}),watch:{patient:{async handler(){this.assessment=new t(this.patientID,this.providerID),this.patientPreviousTreatment=await i.getFirstValueCoded(this.patientID,"Treatment"),this.patientPreviousVisitHIVStatus=await i.getFirstValueCoded(this.patientID,"HIV status"),this.alreadyOnTreatment=this.patientAlreadyOnTreatment(),n.getConceptsByCategory("reason_for_no_cxca"),await this.assessment.loadArtStatus(),""!==this.assessment.getHivStatus()&&(this.showHIVQuestions=!1),"Positive"===this.assessment.getHivStatus()&&(this.showHIVQuestions=!1),await this.setOfferCxCa(),this.fields=await this.getFields()},deep:!0}},methods:{skipTreatmentSelection(){const e=["Chemotherapy","Hysterectomy","Palliative Care"];if(this.patientPreviousTreatment){const t=this.patientPreviousTreatment;return e.includes(t)}return!1},skipHIVStatusSelection(){const e=["positive on art","positive not on art"];if(this.patientPreviousVisitHIVStatus){const t=this.patientPreviousVisitHIVStatus.toLowerCase();return e.includes(t.toLowerCase())}return!1},patientAlreadyOnTreatment(){return!this.isNullOrUndefined(this.patientPreviousTreatment)},isNullOrUndefined:e=>null==e,async onFinish(e,t){if(!(await this.assessment.createEncounter()))return o("Unable to create encounter");const a=[];Object.keys(t).forEach((e=>{a.push(t[e].obs)}));const s=await Promise.all([...this.obs,...a]);if(!(await this.assessment.saveObservationList(s)))return o("Unable to save patient observations");r("Observations and encounter created!"),this.nextTask()},async setOfferCxCa(){const e=await this.assessment.getFirstValueCoded("Offer CxCa");return this.offerCxCa=e&&"Yes"===e,this.offerCxCa||this.obs.push(this.assessment.buildValueCoded("Ever had CxCa","No")),!0},hasHIVStatus(){return""!==this.assessment.getHivStatus},enterPreviousCxCaData(e){const t="Yes"===e.ever_had_cxca.value,a="Yes"===e.results_available.value;return t&&a},getFacilities:(e="")=>l(e),getReasonsForNoCxcaOptions:()=>n.getConceptsByCategory("reason_for_no_cxca").map((e=>({label:e.name,value:e.name,other:{c:e}}))),getFields(){return[{id:"reason_for_visit",helpText:"Reason for visit",type:u.TT_SELECT,validation:e=>d.required(e),options:()=>[{label:"Initial screening",value:"Initial screening"},{label:"Postponed treatmment",value:"Postponed treatment"},{label:"One year subsequent check-up after treatment",value:"One year subsequent check-up after treatment"},{label:"Subsequent screening",value:"Subsequent screening"},{label:"Problem visit after treatment",value:"Problem visit after treatment"},{label:"Referral",value:"Referral"}],computedValue:e=>({obs:this.assessment.buildValueCoded("Reason for visit",e.value)})},{id:"hiv_status",helpText:"HIV status",type:u.TT_SELECT,condition:()=>this.showHIVQuestions&&!this.skipHIVStatusSelection(),validation:e=>d.required(e),options:()=>[{label:"Positive on ART",value:"Positive on ART"},{label:"Positive Not on ART",value:"Positive Not on ART"},{label:"Negative",value:"Negative"},{label:"Never tested",value:"Never tested"},{label:"Prefers Not to disclose",value:"Undisclosed"}],computedValue:e=>({obs:this.assessment.buildValueCoded("HIV status",e.value)})},...c({id:"hiv_test_date",helpText:"HIV test result date",required:!0,condition:e=>e.hiv_status.value.match(/Negative|ART/i),minDate:()=>this.patient.getBirthdate(),maxDate:()=>this.assessment.getDate(),estimation:{allowUnknown:!0,estimationFieldType:h.MONTH_ESTIMATE_FIELD},computeValue:(e,t)=>({date:e,tag:"cxca screening",isEstimate:t,obs:this.assessment.buildValueDate("HIV test date",e,t)})}),{id:"ever_had_cxca",helpText:"Ever had CxCa screening",type:u.TT_SELECT,condition:e=>"Initial screening"!==e.reason_for_visit.value&&!this.alreadyOnTreatment,options:()=>this.yesNoOptions(),validation:e=>d.required(e),computedValue:e=>({obs:this.assessment.buildValueCoded("Ever had CxCa",e.value)})},{id:"results_available",helpText:"Results available?",type:u.TT_SELECT,validation:e=>d.required(e),condition:e=>"Initial screening"!==e.reason_for_visit.value&&"No"!==e.ever_had_cxca.value,options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.assessment.buildValueCoded("CxCa test results",e.value)})},{id:"location",helpText:"CxCa screening location",type:u.TT_SELECT,validation:e=>d.required(e),options:(e,t="")=>this.getFacilities(t),config:{showKeyboard:!0,isFilterDataViaApi:!0},condition:e=>this.enterPreviousCxCaData(e),computedValue:e=>({obs:this.assessment.buildValueText("Previous CxCa location",e.value)})},...c({id:"cxca_date",helpText:"Previous CxCa test",required:!0,minDate:()=>this.patient.getBirthdate(),maxDate:()=>this.assessment.getDate(),estimation:{allowUnknown:!1},condition:e=>this.enterPreviousCxCaData(e),computeValue:(e,t)=>({date:e,tag:"cxca screening",isEstimate:t,obs:this.assessment.buildValueDate("cxca test date",e)})}),{id:"previous_screening_method",helpText:"Previous screening method",type:u.TT_SELECT,validation:e=>d.required(e),condition:e=>this.enterPreviousCxCaData(e),options:()=>[{label:"VIA",value:"VIA"},{label:"PAP Smear",value:"PAP Smear"},{label:"HPV DNA",value:"HPV DNA"},{label:"Speculum Exam",value:"Speculum Exam"}],computedValue:e=>({obs:this.assessment.buildValueCoded("Previous CxCa screening method",e.value)})},{id:"offer_CxCa",helpText:"Offer CxCa screening today",type:u.TT_SELECT,condition:this.skipTreatmentSelection(),validation:e=>d.required(e),options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.assessment.buildValueCoded("Offer CxCa",e.value)})},{id:"screening_method",helpText:"Screening method being offered",type:u.TT_SELECT,validation:e=>d.required(e),condition:e=>"Yes"===e.offer_CxCa.value,options:()=>[{label:"VIA",value:"VIA"},{label:"PAP Smear",value:"PAP Smear"},{label:"HPV DNA",value:"HPV DNA"},{label:"Speculum Exam",value:"Speculum Exam"}],computedValue:e=>({obs:this.assessment.buildValueCoded("CxCa screening method",e.value)})},{id:"offer_family_planning",helpText:"Offer Family Planning ?",type:u.TT_SELECT,condition:e=>"No"!==e.offer_CxCa.value,validation:e=>d.required(e),options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.assessment.buildValueCoded("Family planning",e.label)})},{id:"reason_for_no_cxca",helpText:"Reason for NOT offering CxCa screening",type:u.TT_SELECT,validation:e=>d.required(e),condition:e=>"No"===e.offer_CxCa.value,options:()=>this.getReasonsForNoCxcaOptions(),computedValue:e=>({obs:this.assessment.buildValueCoded("Reason for NOT offering CxCa",e.value)})}]}}});e("default",v(T,[["render",function(e,t,a,s,i,n){const o=m("his-standard-form");return p(),C(o,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!1,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}]]))}}}));
