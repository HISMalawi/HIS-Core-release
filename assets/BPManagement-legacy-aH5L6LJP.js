System.register(["./index-legacy-DaDUPm0b.js","./EncounterMixin.vue_vue_type_script_lang-legacy-BDi4Plhg.js","./RiskFactorModal-legacy-D-PwSm-3.js","./htn_service-legacy-Dra0nQbp.js","./vitals_service-legacy-QV_jg0uW.js","./encounter_guidelines-legacy-i6miv9ib.js","./GuidelineEngine-legacy-KsvQuFdF.js","./HisStandardForm-legacy-CturMrfg.js","./TouchScreenForm-legacy-kTjvZFWF.js","./dynamic-import-helper-legacy-DYK5bIOV.js","./ToolbarMediumCard-legacy-TC6u67eT.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-DVkjms5h.js"],(function(t,e){"use strict";var a,n,s,i,r,o,l,c,u,h,d,g,p,m,f,y,b,w,T,I,k,D,v,F,H,P,_,C,N,R,S,O,B,V,j,x,E,$,A,z,Y,G,M,U,L,q,J;return{setters:[t=>{a=t.d,n=t.D,s=t.k,i=t.i,r=t.j,o=t.l,l=t.ai,c=t.aj,u=t.f,h=t.cr,d=t.cu,g=t.ak,p=t.m,m=t.I,f=t.h,y=t.C,b=t.L,w=t.aN,T=t.H,I=t.S,k=t.Y,D=t.t,v=t.aS,F=t.aI,H=t.aR,P=t.O,_=t.ab,C=t.ad,N=t.b7,R=t.T,S=t._,O=t.r,B=t.o,V=t.c,j=t.w,x=t.b,E=t.A,$=t.v,A=t.x,z=t.z,Y=t.u,G=t.y,M=t.F},t=>{U=t._},t=>{L=t.R},t=>{q=t.B},t=>{J=t.V},null,null,null,null,null,null,null,null],execute:function(){const e={background:"#444444"},K=a({mixins:[U],components:{DataTable:n,IonTitle:s,IonToolbar:i,IonHeader:r,IonContent:o,IonGrid:l,IonRow:c,IonButton:u,IonRadioGroup:h,IonRadio:d,IonCol:g,IonFooter:p,IonPage:m,IonItem:f,IonLabel:y},data:()=>({htn:{},hasARVNumber:!0,suggestedNumber:"",columns:[[b.thTxt("Date",{style:e}),b.thTxt("Systolic",{style:e}),b.thTxt("Diastolic",{style:e}),b.thTxt("BP Drugs",{style:e}),b.thTxt("Action / Note",{style:e})]],bpGradeColorMap:{"N/A":"#ffffff",normal:"#ffffff","grade 1":"#FFC3CE","grade 2":"#F20056","grade 3":"#FF3333"},rows:[],riskFactors:[],action:null,trail:[],date:null,patientOnBPDrugs:!1,patientFirstVisit:!1,normatensive:!1,patientHasHyperTensionObs:!1,currentDrugs:[],items:[],isEnrolledInHTN:!1,isAliveOnHTN:!1,HTNProgramID:20,aliveState:160,refer:!1}),watch:{ready:{async handler(t){if(!t)return;const e=await w.create({message:"Please wait...",backdropDismiss:!1});await e.present(),this.htn=new q(this.patientID,this.providerID),this.trail=await this.htn.getBPTrail(),this.rows=this.formatBpTrailRows(this.trail),this.normatensive=q.isBpNormotensive(this.trail),this.riskFactors=await this.getRiskFactors(),this.date=T.toStandardHisDisplayFormat(I.getSessionDate()),await this.isTransfered(),await this.hasHyperTenstion(),await this.getTreatmentStatus(),await this.getProgramStatus(),w.dismiss(),this.patientFirstVisit&&this.patientOnBPDrugs&&await this.alertTransferIn(),this.getItems()},immediate:!0}},computed:{totalRiskFactors(){return this.riskFactors.filter((t=>"Yes"===t.value)).length},showClinicianButton:()=>!(k.isClinician()&&k.isDoctor())},methods:{async onFinish(){if(this.action||this.refer){if(!(await this.htn.createEncounter()))return D("Unable to create encounter");if(this.refer){if(!(await this.htn.saveValueCodedObs("Refer patient to clinician","Yes")))return D("Unable to create Obs");this.gotoPatientDashboard()}else{if(!(await this.htn.saveValueTextObs("Plan",this.action.label)))return D("Unable to create Obs");const t={state:this.action.value};if(await this.htn.enrollPatient(t),"function"==typeof this.action?.other?.action)return this.action.other.action();this.nextTask()}}else D("Please select an action")},referPatient(){this.refer=!0,this.onFinish()},goToDiagnosis(){return this.$router.push({path:`/art/encounters/hypertension_diagnosis/${this.patientID}`})},async hasHyperTenstion(){const t=await v.getFirstValueCoded(this.patientID,"Patient has hypertension");this.patientHasHyperTensionObs=!!`${t}`.match(/yes|no/i)},async isTransfered(){const t=await v.getFirstValueCoded(this.patientID,"Transferred");this.patientFirstVisit=!t},async getTreatmentStatus(){const t=await v.getFirstValueText(this.patientID,"Treatment status");this.patientOnBPDrugs=!(!t||!t.match(/BP Drugs started/i))},async getProgramStatus(){const t=await F.getPatientPrograms(this.patientID);this.isEnrolledInHTN=t.filter((t=>"HYPERTENSION PROGRAM"===t.program.name)).length>0,this.isEnrolledInHTN&&await this.programState()},async programState(){const t=await F.getPatientStates(this.patientID,this.HTNProgramID);this.isAliveOnHTN=t.filter((t=>"Alive"===t.name)).length>0},async getRiskFactors(){const t=H.getConceptsByCategory("risk factors").map((async t=>{const e=await v.getFirstValueCoded(this.patientID,t.name);return{concept:t.name,value:e}}));return Promise.all(t)},formatBpTrailRows(t){return Object.keys(t).map((e=>{const a=T.toStandardHisDisplayFormat(e);this.currentDrugs=this.currentDrugs.concat(t[e].drugs);const n={background:(()=>{const a=q.getBpGrade(parseInt(t[e].sbp),parseInt(t[e].dbp));return this.bpGradeColorMap[a]})()};return[b.tdDate(a,{style:n}),b.td(t[e].sbp,{style:n}),b.td(t[e].dbp,{style:n}),b.td(t[e].drugs.join(", "),{style:n}),b.td(t[e].note,{style:n})]}))},async showRiskFactors(){const t=await P.create({component:L,backdropDismiss:!1,cssClass:"large-modal",componentProps:{factors:this.riskFactors}});t.present();const{data:e}=await t.onDidDismiss();_.isEmpty(e)||(this.riskFactors=e.map((t=>{const e=!0===t.isChecked?"Yes":"No";return{concept:t.concept,value:e}})))},async alertTransferIn(){"Yes"===await C("Transfer in","Does the patient want to transfer in for HTN management?","",[{name:"Yes",slot:"end",color:"success"},{name:"No",slot:"start",color:"danger"}])?(await this.enrollInHTN(),await this.setHtnTransferred("Yes"),this.patientFirstVisit=!1,await this.getItems()):(await this.setHtnTransferred("No"),this.nextTask())},async enrollInHTN(){try{const t=new N(this.patientID);t.setProgramId(this.HTNProgramID),t.setStateDate(F.getSessionDate()),t.setStateId(this.aliveState),await t.enrollProgram(),await t.updateState(),this.isEnrolledInHTN=!0,R("Patient is now enrolled in HTN")}catch(t){console.error(t),D(`${t}`)}},async setHtnTransferred(t){const e=new J(this.patientID,this.providerID);await e.createEncounter()?await e.saveValueCodedObs("Transferred",t)||D("Unable to create observation Transferred for patient"):D("Unable to create patient transfer encounter")},async getItems(){this.currentDrugs.length>0?this.items=[{label:"Did not take prescribed drugs",value:"on treatment",other:{action:()=>this.$router.push(`/art/encounters/bp_adherence/${this.patientID}`)}},{label:"Continue drugs",value:"on treatment",other:{action:()=>this.$router.push(`/art/encounters/bp_adherence/${this.patientID}`)}},{label:"Review drugs",value:"on treatment",other:{action:()=>this.$router.push(`/art/encounters/bp_adherence/${this.patientID}?review=true`)}}]:(this.items=[{label:"Lifestyle advice given",value:"Lifestyle changes only"},{label:"Not yet stable on ART",value:"Symptomatic but not in treatment"},{label:"Patient declining BP drugs ",value:"Symptomatic but not in treatment"}],this.normatensive&&this.items.push({label:"Return to annual screening",value:"Alive"}),this.items.push({label:"Start anti hypertensives",value:"On treatment",other:{action:()=>this.$router.push(`/art/encounters/bp_prescription/${this.patientID}`)}}))}}}),Q={key:0,style:{color:"green"}},W={slot:"end"},X=E("h1",{style:{"text-align":"center"}},"Actions",-1);t("default",S(K,[["render",function(t,e,a,n,s,i){const r=O("ion-title"),o=O("ion-button"),l=O("ion-toolbar"),c=O("ion-header"),u=O("data-table"),h=O("ion-content"),d=O("ion-label"),g=O("ion-radio"),p=O("ion-item"),m=O("ion-col"),f=O("ion-row"),y=O("ion-grid"),b=O("ion-radio-group"),w=O("ion-footer"),T=O("ion-page");return B(),V(T,null,{default:j((()=>[x(c,null,{default:j((()=>[x(l,null,{default:j((()=>[x(r,null,{default:j((()=>[E("span",null,"BP management screening on "+$(t.date),1),t.patientOnBPDrugs?(B(),A("small",Q," (Patient already on BP drugs)")):z("",!0)])),_:1}),E("span",W,[t.totalRiskFactors>0?(B(),V(o,{key:0,color:"danger",onClick:t.showRiskFactors},{default:j((()=>[Y("View/Edit risk factors "+$(t.totalRiskFactors),1)])),_:1},8,["onClick"])):z("",!0),0===t.totalRiskFactors?(B(),V(o,{key:1,onClick:t.showRiskFactors},{default:j((()=>[Y("add riskfactors")])),_:1},8,["onClick"])):z("",!0)])])),_:1})])),_:1}),x(h,null,{default:j((()=>[x(u,{config:{showIndex:!1},columns:t.columns,rows:t.rows},null,8,["columns","rows"])])),_:1}),x(w,null,{default:j((()=>[x(l,null,{default:j((()=>[X,x(b,{modelValue:t.action,"onUpdate:modelValue":e[0]||(e[0]=e=>t.action=e)},{default:j((()=>[x(y,null,{default:j((()=>[x(f,null,{default:j((()=>[(B(!0),A(M,null,G(t.items,((t,e)=>(B(),V(m,{size:"4",key:e},{default:j((()=>[x(p,null,{default:j((()=>[x(d,{style:{"font-size":"1.0rem","font-weight":"bold"}},{default:j((()=>[Y($(t.label),1)])),_:2},1024),x(g,{value:t},null,8,["value"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),x(l,{color:"dark"},{default:j((()=>[x(o,{size:"large",color:"danger",slot:"start",onClick:t.gotoPatientDashboard},{default:j((()=>[Y(" cancel ")])),_:1},8,["onClick"]),t.showClinicianButton?(B(),V(o,{key:0,size:"large",color:"danger",slot:"start",onClick:t.referPatient},{default:j((()=>[Y(" Refer to clinician ")])),_:1},8,["onClick"])):z("",!0),t.patientHasHyperTensionObs?z("",!0):(B(),V(o,{key:1,size:"large",slot:"end",onClick:t.goToDiagnosis},{default:j((()=>[Y(" Hypertension Diagnosis ")])),_:1},8,["onClick"])),t.patientHasHyperTensionObs&&!t.isEnrolledInHTN?(B(),V(o,{key:2,size:"large",slot:"end",onClick:t.enrollInHTN},{default:j((()=>[Y(" Enroll in HTN ")])),_:1},8,["onClick"])):z("",!0),t.patientHasHyperTensionObs?(B(),V(o,{key:3,size:"large",color:"success",slot:"end",onClick:t.onFinish},{default:j((()=>[Y(" Finish ")])),_:1},8,["onClick"])):z("",!0)])),_:1})])),_:1})])),_:1})}]]))}}}));
