import{d as m,I as b,r as l,ag as h,aL as g,aN as v,bw as _,ci as P,cj as w,bF as D,aa as T,af as f,a as y,c as E,w as F,b as $}from"./index-CMZASHAR.js";import{v as k}from"./TableView-DhTjQT8r.js";const A=25,I=m({props:{title:{type:String,default:"Drilldown"},patientIdentifiers:{type:Object},onFinish:{type:Function}},components:{IonPage:b,v2Datatable:k},setup(e){const n=l(!0),o=l("-"),a=l([]),c=h(),u=[[{label:"TB Number",ref:"identifier"},{label:"Name",ref:"name"},{label:"Gender",ref:"gender"},{label:"Age",ref:"age"},{label:"Action",ref:"patient_id",exportable:!1,tdClick:({data:t})=>c.push({path:"/patient/dashboard/".concat(t.person_id)}),value:()=>"View client"}]];function s(){n.value=!1,typeof e.onFinish=="function"&&e.onFinish()}return g(()=>e.patientIdentifiers,async t=>{if(a.value=[],o.value="Total: 0",!(t&&t.length))return;const p=v.chunk(t,1e3);for(const d of p){try{if(!n.value)break;const r=(await _.getTBPersons(d)).map(i=>({...i,birthdate:P(i.birthdate),gender:w(i.gender)}));a.value=[...a.value,...r]}catch(r){console.error(r)}o.value="Total: ".concat(a.value.length," of ").concat((t||[]).length),await D(100)}},{immediate:!0}),{columns:u,subtitle:o,reportData:a,canLoadData:n,ITEMS_PER_PAGE:A,runFinishAction:s}}});function B(e,n,o,a,c,u){const s=f("v2Datatable"),t=f("ion-page");return y(),E(t,null,{default:F(()=>[$(s,{title:e.title,subtitle:e.subtitle,columnData:e.reportData,columns:e.columns,"on-finish":e.runFinishAction,rowsPerPage:e.ITEMS_PER_PAGE},null,8,["title","subtitle","columnData","columns","on-finish","rowsPerPage"])]),_:1})}const N=T(I,[["render",B]]);export{N as T};
