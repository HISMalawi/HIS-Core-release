System.register(["./HisStandardForm-legacy-a9YJRGaH.js","./patient_diagnosis_service-legacy-DkEaydNo.js","./index-legacy-CA6M7ipO.js","./useEncounter-legacy-CgHUO1ZL.js","./useLabResultsManager-legacy-Bq58W8E2.js","./commons-legacy-BqS3TQTP.js","./isEmpty-legacy-cRrH0Hs5.js","./encounter_guidelines-legacy-Bcz_Mw7r.js","./GuidelineEngine-legacy-KsvQuFdF.js","./lab_order_service-legacy-BFyaxW8S.js"],(function(e,a){"use strict";var t,i,s,n,o,l,c,r,u,d,g,y,m,p,b,T;return{setters:[e=>{t=e.H},e=>{i=e.P},e=>{s=e.bQ,n=e.d,o=e.r,l=e.ad,c=e.ae,r=e.aN,u=e.a,d=e.c,g=e.u,y=e.ao,m=e.aj},e=>{p=e.u},e=>{b=e.u},e=>{T=e.r},null,null,null,null],execute:function(){class a extends s{constructor(e,a){super(e,105,a)}}e("default",n({__name:"Diagnosis",setup(e){let s,n;const _=o("No"),v=o([]),E=o(Math.random()),{patientDashboardUrl:w,goToNextTask:h}=p((async(e,t)=>{s=new a(t,e),n=new i(t,e);const{getLabFields:o}=b(t,e,E);v.value=[...o(!0),{id:"primary_diagnosis",helpText:"Select primary diagnosis",type:l.TT_INFINITE_SCROLL_MULTIPLE_SELECT,validation:e=>c.required(e),options:async(e,a="",t=1,s=10)=>f(await i.getDiagnosis(a,t,s)),beforeNext:async e=>await C(e),computedValue:e=>({tag:"diagnosis",obs:e.map((({other:e})=>n.buildValueCodedFromConceptId("Primary diagnosis",e)))}),summaryMapValue:({value:e})=>({value:e,label:"Primary diagnosis"}),config:{isFilterDataViaApi:!0,showKeyboard:!0}},{id:"secondary_diagnosis",helpText:"Select secondary diagnosis",type:l.TT_INFINITE_SCROLL_MULTIPLE_SELECT,options:async(e,a="",t=1,s=10)=>f(await i.getDiagnosis(a,t,s)),beforeNext:async e=>await C(e),computedValue:e=>!r.isEmpty(e)&&{tag:"diagnosis",obs:e.map((({other:e})=>n.buildValueCodedFromConceptId("Secondary diagnosis",e)))},summaryMapValue:({value:e})=>({value:e,label:"Secondary diagnosis"}),config:{showKeyboard:!0,isFilterDataViaApi:!0}},{id:"clinical_notes",helpText:"Clinical notes",type:l.TT_TEXT,computedValue:e=>e&&{tag:"notes",obs:s.buildValueText("Clinical notes construct",e.value)}}]}));async function L(e,a){await n.createEncounter();const t=await T({...a,obs_datetime:y.getSessionDate()},"diagnosis");await n.saveObservationList(t);const i=await T({...a},"notes");r.isEmpty(i)||(await s.createEncounter(),await s.saveObservationList(i)),h()}function f(e){return r.isEmpty(e)?[]:e.map((e=>({label:e.name,value:e.name,other:e.concept_id,isChecked:!1}))).sort(((e,a)=>e.label<a.label?-1:e.label>a.label?1:0))}async function C(e){return!e.find((e=>"Malaria"===e.label))||"Positive"===_.value||await m(`Patient has ${_.value} malaria test result. Do you want to continue?`)}return(e,a)=>(u(),d(t,{key:E.value,cancelDestinationPath:g(w),fields:v.value,onFinishAction:L},null,8,["cancelDestinationPath","fields"]))}}))}}}));
