import{d as m,r as d,ar as T,ad as u,ae as o,bH as N,a as v,c as y,w as D,b as _,u as c,e4 as g,aN as h,W as w,aw as M,I as b}from"./index-BXJohQKw.js";import{H as E}from"./HisStandardForm-BRJuunr9.js";import{u as W}from"./useEncounter-6SffLPm5.js";import{I as x}from"./identifier_service-BeeKsZhH.js";import"./isEmpty-DHS-1Ust.js";import"./encounter_guidelines-B0VbSS_4.js";import"./GuidelineEngine-D6V1_Znr.js";const B=m({__name:"NationalID",setup(S){const r=d([]),i=d(),n=T(),l=()=>!/unknown/i.test(i.value.getMWNationalID()),{goToNextTask:p,patientDashboardUrl:I}=W((t,s,e)=>{i.value=e,r.value=[{id:"currentNationalID",helpText:"Current national identifier:",type:u.TT_TEXT_BANNER,condition:()=>!n.query.reassign&&l(),options:()=>{const a="<b>".concat(e.getMWNationalID(),"</b>");return[{label:a,value:a}]}},{id:"patientIdentifier",helpText:"Malawi National ID",type:u.TT_TEXT,defaultValue:()=>l()?e.getMWNationalID():"",validation:a=>o.validateSeries([()=>o.required(a),()=>o.isMWNationalID(a)]),config:{customKeyboard:N}}]});async function f(t){const s="".concat(t.patientIdentifier.value),e=new x;if(e.identifierType=g.MW,!h.isEmpty(await e.getPatientsByIdentifier(s)))return w("ID was already assigned",15e3);if(n.query.reassign){const a=parseInt("".concat(n.query.reassign));await i.value.changeMwNationalId(a,t.patientIdentifier.value)}else await i.value.updateMWNationalId(t.patientIdentifier.value);M.invalidate("ACTIVE_PATIENT"),p()}return(t,s)=>(v(),y(c(b),null,{default:D(()=>[_(E,{cancelDestinationPath:c(I),onFinishAction:f,fields:r.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{B as default};
