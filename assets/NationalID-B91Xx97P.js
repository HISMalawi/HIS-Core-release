import{d as I,K as d,E as T,V as r,o as v,c as N,w as _,b as y,cl as u,c_ as D,ab as g,t as h,R as w,I as E}from"./index-BCTN_bnC.js";import{F as p}from"./dynamic-import-helper-BkBZiFw5.js";import{H as M}from"./HisStandardForm-CaDwl-hA.js";import{u as b}from"./useEncounter-CDUT-p5Y.js";import{I as x}from"./identifier_service-Gyvt1JKz.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./isEmpty-OXtHK5dz.js";import"./_Set-VKtKUQAI.js";import"./_setToArray-BLmuRUHx.js";import"./encounter_guidelines-DZpIPlYY.js";import"./GuidelineEngine-D6V1_Znr.js";const U=I({__name:"NationalID",setup(W){const s=d([]),i=d(),n=T(),l=()=>!/unknown/i.test(i.value.getMWNationalID()),{goToNextTask:c,patientDashboardUrl:m}=b((t,o,a)=>{i.value=a,s.value=[{id:"currentNationalID",helpText:"Current national identifier:",type:p.TT_TEXT_BANNER,condition:()=>!n.query.reassign&&l(),options:()=>{const e="<b>".concat(a.getMWNationalID(),"</b>");return[{label:e,value:e}]}},{id:"patientIdentifier",helpText:"Malawi National ID",type:p.TT_TEXT,defaultValue:()=>l()?a.getMWNationalID():"",validation:e=>r.validateSeries([()=>r.required(e),()=>r.isMWNationalID(e)])}]});async function f(t){const o="".concat(t.patientIdentifier.value),a=new x;if(a.identifierType=D.MW,!g.isEmpty(await a.getPatientsByIdentifier(o)))return h("ID was already assigned",15e3);if(n.query.reassign){const e=parseInt("".concat(n.query.reassign));await i.value.changeMwNationalId(e,t.patientIdentifier.value)}else await i.value.updateMWNationalId(t.patientIdentifier.value);w.invalidate("ACTIVE_PATIENT"),c()}return(t,o)=>(v(),N(u(E),null,{default:_(()=>[y(M,{cancelDestinationPath:u(m),onFinishAction:f,fields:s.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{U as default};
