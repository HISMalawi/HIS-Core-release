import{F as x}from"./dynamic-import-helper-Bsjrd6Ro.js";import{V as T,H as $,a$ as S,S as V,b0 as F}from"./index-L7KBnPzM.js";import{N as O}from"./KbLayouts-VRA-vjeH.js";import{a as H}from"./HisKbConfigurations-GhFQZvlg.js";const k=[{label:"Jan",value:1},{label:"Feb",value:2},{label:"Mar",value:3},{label:"Apr",value:4},{label:"May",value:5},{label:"Jun",value:6},{label:"Jul",value:7},{label:"Aug",value:8},{label:"Sep",value:9},{label:"Oct",value:10},{label:"Nov",value:11},{label:"Dec",value:12}];var L=(e=>(e.AGE_ESTIMATE_FIELD="age-estimate-field",e.MONTH_ESTIMATE_FIELD="month-period-estimate-field",e))(L||{});function q(e,a,c=!0){const l=[];return c&&l.push("UNKNOWN"),{id:e,helpText:"".concat(a," Year"),appearInSummary:()=>!1,type:x.TT_TEXT,config:{customKeyboard:[O,[l,["DELETE"]]]}}}function R(e,a){return{id:e,helpText:"".concat(a," Month"),appearInSummary:()=>!1,type:x.TT_SELECT,options:()=>k}}function B(e,a){return{id:e,helpText:"".concat(a," Day"),type:x.TT_MONTHLY_DAYS,appearInSummary:()=>!1}}function C(e,a){return{id:e,helpText:"".concat(a," Estimated period"),type:x.TT_SELECT,appearInSummary:()=>!1,options:()=>[{label:"6 months ago",value:180},{label:"12 months ago",value:365},{label:"18 months ago",value:540},{label:"24 months ago",value:730},{label:"Over 2 years ago",value:730}]}}function P(e,a){return{id:e,helpText:"".concat(a," Age Estimate"),type:x.TT_NUMBER,appearInSummary:()=>!1,config:{keypad:H}}}function f(e){return parseInt(e)<10?"0".concat(e):e}async function E(e,a,c){if(a.defaultValue){const l=await a.defaultValue(e);if(l){const[s,v,y]=l.split("-");switch(c){case"Year":return s||"";case"Month":return parseInt(v)||"";case"Day":return parseInt(y)||""}}}return""}function g(e){return $.toStandardHisDisplayFormat(e)}function w(e,a,c,l){if(a.minDate){const s=a.minDate(c,l);if(new Date(e)<new Date(s))return["".concat(g(e)," is less than minimum date of ").concat(g(s))]}if(a.maxDate){const s=a.maxDate(c,l);if(s&&new Date(e)>new Date(s))return["".concat(g(e)," is greater than max date of  ").concat(g(s))]}}function G(e){let a="",c="",l="",s="",v=!1;const y="year_".concat(e.id),b="month_".concat(e.id),U="day_".concat(e.id),Y="age_estimate_".concat(e.id),A="duration_estimate_".concat(e.id),i=q(y,e.helpText,e.estimation.allowUnknown),p=R(b,e.helpText),m=B(U,e.helpText),h=P(Y,e.helpText),D=C(A,e.helpText),N=typeof e.estimation.allowUnknownMonthDay=="boolean"&&e.estimation.allowUnknownMonthDay,I=t=>t[y]&&t[y].value&&["Unknown"].includes(t[y].value)?!1:e.condition?e.condition(t):!0,d=(t,n)=>[{type:"year",value:c,default:"YYYY"},{type:"month",value:l,default:"MM"},{type:"day",value:s,default:"DD"}].reduce((o,r)=>{const _=[null,void 0,"Unknown",""];return n===r.type?_.includes(t)?o.push(r.default):o.push(t):_.includes(r.value)?o.push(r.default):o.push(r.value),o},[]).join("-");typeof e.init=="function"&&(i.init=e.init),i.updateHelpTextOnValue=t=>"".concat(i.helpText," (").concat(d(t==null?void 0:t.label,"year"),")"),i.proxyID=e.id,i.unload=t=>c=t.value.toString(),i.config={...i.config,...e.config},i.defaultValue=t=>E(t,e,"Year"),i.condition=t=>e.condition?e.condition(t):!0,i.validation=(t,n,u)=>{if(e.required&&T.required(t))return["Year cannot be empty"];const o=t?t.value:"";if(!e.estimation.allowUnknown&&o.toString().match(/unknown/i))return["Value unknown is not permitted"];if(o&&!["Unknown"].includes(o)&&isNaN(o)||o<1900)return["Invalid Year"];if(o&&typeof e.minDate=="function"){const r=$.getYear(e.minDate(n,u));if(parseInt(o)<r)return["Year of ".concat(o," is less than Minimum year of ").concat(r)]}if(o&&typeof e.maxDate=="function"){const r=e.maxDate(n,u);if(r&&o>$.getYear(r))return["Year of ".concat(o," exceeds Maximum year of ").concat($.getYear(r))]}return null},i.summaryMapValue=()=>({label:e.summaryLabel||e.helpText,value:a?g(a):"Unknown"}),i.appearInSummary=(t,n)=>n===e.id,i.computedValue=t=>{if(a){const[,n,u]=a.split("-");return a="".concat(t.value,"-").concat(n,"-").concat(u),e.computeValue(a,!1)}if(t&&t.value==="Unknown")return a="",e.computeValue("Unknown",!1)},p.updateHelpTextOnValue=t=>"".concat(p.helpText," (").concat(d(t==null?void 0:t.label,"month"),")"),p.proxyID=e.id,p.unload=t=>l=f(t.value.toString()),p.condition=t=>I(t),p.validation=t=>T.required(t),p.defaultValue=t=>E(t,e,"Month"),N&&(p.options=()=>[...k,{label:"Unknown",value:"Unknown"}]),p.computedValue=(t,n)=>{if("".concat(t.value).match(/unknown/i))return a="".concat(n[y].value,"-07-15"),e.computeValue(a,!0);if(a){const[u,,o]=a.split("-"),r=f("".concat(t.value));return a="".concat(u,"-").concat(r,"-").concat(o),e.computeValue(a,!1)}},m.proxyID=e.id,m.updateHelpTextOnValue=t=>"".concat(m.helpText," (").concat(d(t==null?void 0:t.label,"day"),")"),m.condition=t=>!"".concat(t[b].value).match(/unknown/i)&&I(t),m.validation=(t,n,u)=>T.required(t)?["Day is required for date"]:(v=!!"".concat(t.value).match(/unknown/i),s=v?"15":f("".concat(t.value)),a="".concat(c,"-").concat(l,"-").concat(s),w(a,e,n,u)),m.defaultValue=t=>E(t,e,"Day"),m.computedValue=()=>e.computeValue(a,v),m.unload=(t,n,u,o)=>{e.unload&&e.unload(t,n,u,o)},m.beforeNext=(t,n)=>e.beforeNext?e.beforeNext(a,n):!0,m.config={year:t=>t[y].value,month:t=>t[b].value},N||(m.config.keyboardActions=[]);const M=(t,n)=>[t[y].value==="Unknown",e.condition?e.condition(t):!0,e.estimation.estimationFieldType===n].every(Boolean);return h.proxyID=e.id,h.validation=(t,n,u)=>{if(t&&t.value>300)return["Age estimate is too high and exceeding hard limit of 300"];if(isNaN(parseInt(t.value.toString())))return["Please enter a valid number"];const o=/^(12[0-7]|1[01][0-9]|[1-9]?[0-9])$/;if(!t.value.toString().match(o))return["Not a valid age estimate"];const r=S(V.getSessionDate()).subtract(t.value,"years").year();return a="".concat(r,"-07-15"),w(a,e,n,u)},h.condition=t=>M(t,"age-estimate-field"),h.computedValue=()=>e.computeValue(a,!0),h.beforeNext=(t,n)=>e.beforeNext?e.beforeNext(a,n):!0,D.proxyID=e.id,D.validation=(t,n,u)=>T.required(t)?["Please select an estimate"]:(a=S(V.getSessionDate()).subtract(t.value,"day").format(F),w(a,e,n,u)),D.condition=t=>M(t,"month-period-estimate-field"),D.computedValue=()=>e.computeValue(a,!0),D.beforeNext=(t,n)=>e.beforeNext?e.beforeNext(a,n):!0,[i,p,m,h,D]}export{L as E,G as g};
