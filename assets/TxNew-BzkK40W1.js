import{d as k,I,c4 as F,K as g,N as M,a9 as N,O as d,t as q,ab as x,c5 as E,q as B,c6 as O,c7 as S,c8 as H,c9 as L,_ as U,r as C,o as X,c as j,w as V,b as y}from"./index-DxdybAew.js";import{D as W}from"./ReportDateSelectionPrompt-CLvcGsP1.js";import{T as G}from"./tx_report_service-vvVtweZl.js";import{v as K}from"./TableView-BMP4Cq_5.js";import{A}from"./ArtDrilldown-DrBo8Sms.js";import{R as Q}from"./ReportErrors-D2uc5Tfj.js";import{M as z}from"./moh_cohort_service-C7gwAYf2.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./MultiFieldDateHelper-DcsBf1hV.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./PopupKeyboard-DFLyy2vg.js";import"./SIngleTouchField-Dzrr97X9.js";import"./TouchScreenForm-CWGDOcQm.js";import"./ToolbarMediumCard-DpQmY2Av.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-Bxq2iSVB.js";import"./HisKeypad-CHYdNWl7.js";import"./BaseKeyboard-yRYQiwHX.js";import"./KbHandler-BuQ4TFU6.js";import"./fuse-YdZE3OCN.js";import"./Export-CGhzIHAA.js";import"./HisKeyboard-CZgk3v_8.js";const J=k({components:{IonPage:I,IonLoading:F,v2Datatable:K},setup(){const o=g([]),u=g(""),_=g(!1),l=new G,c=g([]),h=new z,f=g(!0),m=(e,s)=>({ref:s,label:e,toValue:n=>n.length,tdClick:async n=>{n.refData.length&&(await d.create({component:A,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:u,patientIdentifiers:n.refData,title:"".concat(n.data.age_group," ").concat(n.data.gender," ").concat(n.column.label),onFinish:()=>d.getTop().then(t=>t&&d.dismiss())}})).present()}}),v=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},m("Tx new CD4 <200","cd4_less_than_200"),m("Tx new CD4 >=200","cd4_greater_than_equal_to_200"),m("Tx new CD4 Unknown","cd4_unknown_or_not_done"),m("Transfer-ins","transfer_in")]],w=function(e){const s=c.value.findIndex(n=>n.id===e.id);s!==-1?c.value[s]=e:c.value.push(e)},D=async function(e){const s="validationErrors";(await d.create({id:s,component:Q,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:e}})).present(),w({id:s,text:"<b>".concat(e.length,"</b> validation errors detected"),icon:L,color:"danger",action:()=>D(e)})};function P(e){const s={initiated_on_art_first_time:{param:e.total,check:(t,a)=>t!=a,error:(t,a)=>"\n                        MOH cohort initiated on ART first time <b>(".concat(t,")</b> is not matching Tx New <b>(").concat(a,")</b>\n                    ")},initial_pregnant_females_all_ages:{param:e.pregnant,check:(t,a)=>t!=a,error:(t,a)=>"\n                        MOH cohort initial pregnant females all ages \n                        <b>(".concat(t,")</b> is not matching with TX new Pregnant women <b>").concat(a,"</b>\n                    ")},males_initiated_on_art_first_time:{param:e.male,check:(t,a)=>t!=a,error:(t,a)=>"\n                        MoH Cohort males initiated on ART first time <b>(".concat(t,")</b>\n                        is not matching with TX new All male <b>(").concat(a,")</b>\n                    ")},"quarterly_re_initiated_on_art + transfer_in":{param:e.transfer_in,check:(t,a)=>t!=a,error:(t,a)=>"\n                        Quarterly Transfer In + Reinitiated Clients <b>".concat(t,"</b>  does not match Transfer In <b>").concat(a,"</b> clients in TXNEW report\n                    ")}};h.validateIndicators(s,t=>{t.length?D(t):w({id:"reportOk",text:"<b>Report is consistent</b>",icon:H,color:"success"})})===-1&&D(["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])}const $=async()=>{if(!(l.startDate&&l.endDate))return q("Start date and end date required!");_.value=!0,o.value=[];try{let e=null;f.value?e=await l.getTxNewReport(!1):e=await l.getTxNewReport(!0);const n=e.filter(r=>!["All"].includes(r.age_group)).reduce((r,i)=>(r[i.gender]=Object.keys(i).reduce((p,b)=>Array.isArray(i[b])?{...p,[b]:[...p[b]||[],...i[b]]}:p,r[i.gender]||{}),r),{Male:{},Female:{}});o.value=e;const t=e.reduce((r,i)=>{if(i.gender==="FP"){const p=Object.values(i).filter(Array.isArray).flat();return r.concat(p)}return r},[]),a=["cd4_less_than_200","cd4_greater_than_equal_to_200","cd4_unknown_or_not_done"],T=x.uniq(["Female","Male"].reduce((r,i)=>[...r,...a.map(p=>n[i][p]).flat(1)],[]));w({id:"stats",text:"Tx new <b>".concat(T.length,"</b>"),icon:E,color:"primary",action:async()=>{(await d.create({component:A,backdropDismiss:!1,cssClass:"large-modal",componentProps:{title:"All TxNew",subtitle:u.value,patientIdentifiers:T,onFinish:()=>d.getTop().then(r=>r&&d.dismiss())}})).present()}}),P({total:T.length,pregnant:x.uniq(a.map(r=>n.Female[r].filter(i=>t.includes(i))).flat(1)).length,male:x.uniq(a.map(r=>n.Male[r]).flat(1)).length,transfer_in:[...n.Male.transfer_in,...n.Female.transfer_in].length}),o.value=o.value.map((r,i)=>({index:i+1,...r}))}catch(e){console.error("".concat(e)),B("Unable to generate report!"),c.value=[{text:"Unable to generate report!",color:"danger",icon:O,action:function(){c.value=[{text:"Exception occured: <b>".concat(e,"</b>"),color:"danger",icon:S}]}}]}_.value=!1,f.value=!1},R=()=>W({onFinish:(e,s,n,t)=>{u.value=n,l.startDate=e,l.endDate=s,t&&l.setOccupation(t),h.setStartDate(l.startDate),h.setEndDate(l.endDate),$()}});return M(()=>R()),{Img:N,headerBadge:c,reportData:o,isLoading:_,configure:R,generate:$,columns:v,isFirstLoad:f,period:u}}});function Y(o,u,_,l,c,h){const f=C("ion-loading"),m=C("v2Datatable"),v=C("ion-page");return X(),j(v,null,{default:V(()=>[y(f,{"is-open":o.isLoading,message:"Please wait..."},null,8,["is-open"]),y(m,{"icon-url":o.Img("login-logos/PEPFAR.png"),title:"Pepfar Tx New","report-prefix":"Pepfar",subtitle:o.period,columns:o.columns,columnData:o.reportData,rowsPerPage:100,headerBadge:o.headerBadge,onConfigure:o.configure,onRefresh:o.generate},null,8,["icon-url","subtitle","columns","columnData","headerBadge","onConfigure","onRefresh"])]),_:1})}const Te=U(J,[["render",Y]]);export{Te as default};
