System.register(["./ViewPort-legacy-u0ytW13O.js","./index-legacy-HpoRL6sM.js","./ActionSideButton-legacy-DKm8AOn_.js","./ResetButton-legacy-DoLtEUhX.js","./FieldMixin.vue_vue_type_script_lang-legacy-DcdOPo11.js"],(function(t,e){"use strict";var a,n,i,s,l,o,d,c,r,u,h,p,b,m,g,v,f,y,k,w,D,_,C,x,A,z,I,S,V;return{setters:[t=>{a=t.V},t=>{n=t.d,i=t.O,s=t.cm,l=t._,o=t.r,d=t.o,c=t.x,r=t.b,u=t.w,h=t.A,p=t.v,b=t.F,m=t.y,g=t.ar,v=t.u,f=t.a3,y=t.a4,k=t.bb,w=t.af,D=t.aj,_=t.ak,C=t.ab,x=t.q,A=t.c,z=t.z},t=>{I=t.O},t=>{S=t.R},t=>{V=t._}],execute:function(){var e=document.createElement("style");e.textContent="table[data-v-de39aa22]{font-size:var(--his-md-font-size);width:98%;margin:auto}table[data-v-de39aa22],td[data-v-de39aa22],th[data-v-de39aa22]{font-size:var(--his-sm-font-size);border:solid 1px #ccc;text-align:center;vertical-align:middle}td[data-v-de39aa22]{height:120px}.btn-list[data-v-de39aa22]{list-style:none;margin:0;padding:0}.dispense-btn[data-v-de39aa22]{width:60px}.input-field[data-v-de39aa22]{font-weight:700;font-size:1.3em;background-color:#f8f8a7}.view-port-content[data-v-e0e49e2a]{height:100%}.prescription-tab[data-v-e0e49e2a]{position:relative;height:75vh}.prescription-table-section[data-v-e0e49e2a]{position:absolute;top:0;left:0;right:0;height:76%;overflow-x:auto}.barcode-section[data-v-e0e49e2a]{position:absolute;left:0;right:0;bottom:-20px}.dosage-input[data-v-e0e49e2a]{text-align:center;font-weight:700;border:solid 1px #ccc;height:50px;width:80%;margin:auto;background-color:#fff8dd}table[data-v-e0e49e2a]{width:100%}td[data-v-e0e49e2a],th[data-v-e0e49e2a]{border:1px solid #ccc;padding:.6em!important}\n",document.head.appendChild(e);const E=n({data:()=>({listData:[],tabsIndex:2,packsIndex:3}),props:{drugName:{type:String,required:!0},tabsNeeded:{type:String,required:!0},items:{type:Array,required:!0},onDispense:{type:Function,required:!0},onClose:{type:Function}},computed:{dispensedValues(){return this.listData.filter((t=>t[this.tabsIndex]>0)).map((t=>[t[this.tabsIndex],t[this.packsIndex]]))},amountNeededRowSpan(){return this.listData.length+1}},watch:{items:{handler(t){t&&(this.listData=[...t])},deep:!0,immediate:!0}},methods:{async onClose(){await i.dismiss({}),"function"==typeof this.onClose&&this.onClose()},incrementAmount(t){const[e,,a,n]=this.listData[t],i=e+a,s=n+1;this.listData[t][2]=i,this.listData[t][3]=s},decrementAmount(t){const[e,,a,n]=this.listData[t],i=n-1;if(i>=0){const n=a-e;this.listData[t][2]=n,this.listData[t][3]=i}},fmtNumber:t=>/-/i.test(t)?t:s(t)}}),N=t=>(f("data-v-de39aa22"),t=t(),y(),t),R={colspan:"6"},M=N((()=>h("tr",null,[h("th",null,"Total tab(s) needed "),h("th",{colspan:"2"}," Available stock "),h("th",{colspan:"2"}," Dispensed "),h("th")],-1))),O=N((()=>h("tr",null,[h("th"),h("th",null," Pack size "),h("th",null," Packs "),h("th",null," Total Tab(s)"),h("th",null," Packs "),h("th")],-1))),P=["rowspan"],H={class:"btn-list"},j=l(E,[["render",function(t,e,a,n,i,s){const l=o("ion-button"),f=o("ion-content"),y=o("ion-toolbar"),k=o("ion-footer");return d(),c(b,null,[r(f,null,{default:u((()=>[h("table",null,[h("thead",null,[h("tr",null,[h("th",R,p(t.drugName),1)]),M,O]),h("tbody",null,[h("tr",null,[h("td",{rowspan:t.amountNeededRowSpan},p(t.tabsNeeded)+" tab(s) ",9,P)]),(d(!0),c(b,null,m(t.listData,((e,a)=>(d(),c("tr",{key:a},[(d(!0),c(b,null,m(e,((e,a)=>(d(),c("td",{key:a,class:g(a>=2?"input-field":"his-md-text")},p(t.fmtNumber(e)),3)))),128)),h("td",null,[h("ul",H,[h("li",null,[r(l,{onClick:e=>t.incrementAmount(a),class:"dispense-btn",size:"large"},{default:u((()=>[v(" + ")])),_:2},1032,["onClick"])]),h("li",null,[r(l,{onClick:e=>t.decrementAmount(a),class:"dispense-btn",size:"large"},{default:u((()=>[v(" - ")])),_:2},1032,["onClick"])])])])])))),128))])])])),_:1}),r(k,null,{default:u((()=>[r(y,null,{default:u((()=>[r(l,{onClick:t.onClose,color:"danger",size:"large",slot:"end"},{default:u((()=>[v(" Close ")])),_:1},8,["onClick"]),r(l,{onClick:e[0]||(e[0]=e=>t.onDispense(t.dispensedValues)),color:"success",size:"large",slot:"end"},{default:u((()=>[v(" Dispense ")])),_:1})])),_:1})])),_:1})],64)}],["__scopeId","data-v-de39aa22"]]),L=n({components:{IonInput:k,ViewPort:a,Barcode:w,NavButton:I,ResetButton:S,IonRow:D,IonCol:_},mixins:[V],data:()=>({dispensingLockEnabled:!1,tab:"prescribe",listData:[],medicationHistory:[],isStockManagementEnabled:!1}),mounted(){this.init()},activated(){this.init()},watch:{tab:{handler(t){"history"===t&&C.isEmpty(this.medicationHistory)&&"function"==typeof this.config.medicationHistory&&this.config.medicationHistory().then((t=>{t&&(this.medicationHistory=t)})).catch((t=>{x(`${t}`)}))}}},methods:{async init(){this.$emit("onFieldActivated",this),"function"==typeof this.config?.isDrugManagementEnabled&&(this.isStockManagementEnabled=this.config?.isDrugManagementEnabled()),this.listData=await this.options(this.fdata)},async onScan(t){const[e,a]=t.split("-"),n=this.listData.map((async t=>{if(t.other.drug_id===parseInt(e)){const e=parseInt(t.value.toString()),n=parseInt(a);await this.updateOnValue(t,n,[],!0)&&(t.value=n+e)}return t}));this.listData=await Promise.all(n)},async onReset(t){await this.updateOnValue(t,-1)},fmtNumber(t){return!this.isStockManagementEnabled||/-/i.test(t)?"-":s(t)},async updateOnValue(t,e,a=[],n=!1){return!(this.onValue&&!(await this.onValue({label:t.label,other:{dispenses:a,...t.other},value:e},n)))&&(t.value=e<0?0:e,this.$emit("onValue",t),this.onValueUpdate&&(this.listData=await this.onValueUpdate(t,this.listData)),!0)},async launchDispenser(t){this.dispensingLockEnabled=!0,(await i.create({component:j,backdropDismiss:!1,cssClass:"custom-modal",componentProps:{drugName:t.label,tabsNeeded:t.other.amount_needed,items:t.other.pack_sizes,onClose:async()=>{this.dispensingLockEnabled=!1,await i.dismiss({})},onDispense:async e=>{const a=e.reduce(((t,e)=>t+e[0]),0);await this.updateOnValue(t,a,e)&&(this.dispensingLockEnabled=!1,await i.dismiss({}))}}})).present()}}}),q=t=>(f("data-v-e0e49e2a"),t=t(),y(),t),B={class:"view-port-content"},F={key:0,class:"his-card history"},T={class:"his-table"},U=q((()=>h("tr",null,[h("th",null," Medication"),h("th",null," Date"),h("th",null," Amount dispensed ")],-1))),$={key:1,class:"prescription-tab"},G={class:"prescription-table-section his-card"},J={class:"his-table"},K=q((()=>h("tr",null,[h("th",null," Medication"),h("th",null," Amount in stock"),h("th",null," Amount needed"),h("th",null," Amount dispensed "),h("th",null," Reset ")],-1))),Q={class:"barcode-section"};t("default",l(L,[["render",function(t,e,a,n,i,s){const l=o("nav-button"),g=o("ion-col"),v=o("ion-input"),f=o("reset-button"),y=o("barcode"),k=o("ion-row"),w=o("view-port");return d(),A(w,null,{default:u((()=>[h("div",B,[r(k,null,{default:u((()=>[r(g,{size:"2"},{default:u((()=>[r(l,{onClick:e[0]||(e[0]=e=>t.tab="prescribe"),isActive:"prescribe"===t.tab,image:"prescription/rx",label:"Prescribed"},null,8,["isActive"]),r(l,{onClick:e[1]||(e[1]=e=>t.tab="history"),isActive:"history"===t.tab,image:"prescription/history",label:"History"},null,8,["isActive"])])),_:1}),r(g,{size:"10"},{default:u((()=>["history"===t.tab?(d(),c("div",F,[h("table",T,[U,(d(!0),c(b,null,m(t.medicationHistory,((t,e)=>(d(),c("tr",{key:e},[h("td",null,p(t.medication),1),h("td",null,p(t.date),1),h("td",null,p(t.amount),1)])))),128))])])):z("",!0),"prescribe"===t.tab?(d(),c("div",$,[h("div",G,[h("table",J,[K,(d(!0),c(b,null,m(t.listData,((e,a)=>(d(),c("tr",{key:a},[h("td",null,p(e.label),1),h("td",null,p(t.fmtNumber(e.other.available_stock)),1),h("td",null,p(e.other.amount_needed),1),h("td",null,[r(v,{disabled:t.dispensingLockEnabled||e.value>0,value:e.value,onClick:a=>e.value<=0&&!t.dispensingLockEnabled?t.launchDispenser(e):null,class:"dosage-input"},null,8,["disabled","value","onClick"])]),h("td",null,[r(f,{label:"",disabled:e.value<=0,onClick:a=>e.value>0?t.onReset(e):null},null,8,["disabled","onClick"])])])))),128))])]),h("div",Q,[r(y,{onOnScan:t.onScan,class:"his-card"},null,8,["onOnScan"])])])):z("",!0)])),_:1})])),_:1})])])),_:1})}],["__scopeId","data-v-e0e49e2a"]]))}}}));
