System.register(["./index-legacy-CNrLGT3P.js","./HisStandardForm-legacy-OekRIZB_.js","./EncounterMixin.vue_vue_type_script_lang-legacy-B7zjV7nz.js","./appointment_service-legacy-BNwn8pIH.js","./encounter_guidelines-legacy-BxkBj-oZ.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(t,e){"use strict";var a,n,i,o,s,l,p,d,r,c,u,m,h,y,g,w,A,v;return{setters:[t=>{a=t.d,n=t.aU,i=t.bp,o=t.F,s=t.b9,l=t.n,p=t.cH,d=t.ah,r=t.aW,c=t.V,u=t.H,m=t._,h=t.r,y=t.o,g=t.c},t=>{w=t.H},t=>{A=t._},t=>{v=t.A},null,null],execute:function(){const e=a({mixins:[A],components:{HisStandardForm:w},data:()=>({appointment:{}}),watch:{ready:{handler(t){console.log("The Current App calling this encounter  ",n.getActiveApp()?.applicationName),t&&(this.appointment=new v(this.patientID,this.providerID),this.fields=[this.getAppointmentField()])},immediate:!0}},methods:{async onFinish(t,e){await this.appointment.createEncounter(),await this.appointment.saveObservationList(await this.resolveObs(e));const a=new i(this.patientID);["CxCa","ANC"].includes(`${n.getActiveApp()?.applicationName}`)||await a.printVisitSummaryLbl(),this.nextTask()},getAppointmentField(){const t=t=>u.toStandardHisDisplayFormat(t),e=(t,e)=>new RegExp(t,"i").test(`${e}`);let a="",i="",m=-1,h=this.appointment.date,y=null;const g={},w=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return{id:"set_appointment",helpText:"Appointments booking",type:o.TT_DATE_PICKER,init:async()=>{try{const t=await this.appointment.getNextAppointment();h=t.appointment_date,y=t.drugs_run_out_date}catch(e){if(console.warn(e),await s(400),!(await l("Next appointment/drug-runout date is not available, do you want to proceed anyway?")))return this.gotoPatientDashboard(),!0}const t=await p.appointmentLimit();return m=t?parseInt(t):0,!0},onValue:async n=>{if(console.log(this.appointment),void 0===g[n]){const t=await v.getDailiyAppointments(n);g[n]=Array.isArray(t)?t.length:0}return!(m>=1&&g[n]>=m&&await l(`${g[n]} clients were booked on ${t(n)}`,{header:`APPOINTMENT LIMIT (${m}) REACHED`,cancelBtnLabel:"Proceed",confirmBtnLabel:"New date"})||(d.isEmpty(i)&&(i=await p.clinicHolidays()),e(n,i)&&!(await l(`${t(n)} is a clinic holiday, do you want to set an appointment?`))||(d.isEmpty(a)&&(a=this.patient.getAge()>=18?await p.adultClinicDays():await p.peadsClinicDays()),!e(w[r(n).day()],a)&&!(await l(`${t(n)} is not a clinic day. Do you want to proceed with this date?`)))))},validation:t=>c.required(t),defaultValue:()=>h,computedValue:t=>[this.appointment.buildValueDate("Appointment date",t.value),this.appointment.buildValueDate("Estimated date",h)],config:{hiddenFooterBtns:["Clear"],minDate:()=>this.appointment.date,maxDate:()=>y,supValue:t=>`${g[t]}`,infoItems:e=>"CxCa"===n.getActiveApp()?.applicationName?[{label:"User set appointment date",value:t(e)},{label:"Appointments",value:g[e]},{label:"Appointment limit (per/day)",value:m}]:[{label:"Medication Run out Date",value:y?t(y):"Not available"},{label:"User set appointment date",value:t(e)},{label:"Appointments",value:g[e]},{label:"Appointment limit (per/day)",value:m}]}}}}});t("default",m(e,[["render",function(t,e,a,n,i,o){const s=h("his-standard-form");return y(),g(s,{fields:t.fields,onFinishAction:t.onFinish,skipSummary:!0,cancelDestinationPath:t.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}]]))}}}));
