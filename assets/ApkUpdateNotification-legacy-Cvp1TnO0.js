System.register(["./index-legacy-BiNmSRfH.js","./index-legacy-CJn60hmf.js","./index-legacy-DtVOfeP3.js"],(function(e,a){"use strict";var t,n,o,r,l,i,s,c,u,d,p,v,g,f,h,w,y,m,b,k,x,C,D;return{setters:[e=>{t=e.d,n=e.r,o=e.c,r=e.o,l=e.i,i=e.A,s=e.h,c=e.a6,u=e.b,d=e.j,p=e.g,v=e.e,g=e.t,f=e.w,h=e.f,w=e.k,y=e.v,m=e.q,b=e.s,k=e.ak},e=>{x=e.F,C=e.D},e=>{D=e.C}],execute:function(){var a=document.createElement("style");a.textContent="#update-notification[data-v-70fe1068]{opacity:.95;position:absolute;background:#e1fef2;color:#000;width:100vw;margin:auto;padding:1.6em;font-size:1.8rem;top:10%;left:50%;transform:translate(-50%,-50%);text-align:center;z-index:40}\n/*$vite$:1*/",document.head.appendChild(a);const U={key:0,id:"update-notification"};e("default",k(t({__name:"ApkUpdateNotification",props:{checkInterval:{type:Number,default:36e5}},setup(e){const a=e,t=n(!1),k=n(""),$=n(""),_=new i,I=o((()=>!!$.value&&"-"!=$.value&&$.value!==k.value)),P=n("");function S(){$.value=k.value}async function j(){try{if(await async function(){try{const{publicStorage:e}=await x.checkPermissions();if("granted"!==e){const{publicStorage:e}=await x.requestPermissions();if("granted"!==e)return b("Permission to access storage is required to download the app."),!1}return!0}catch(e){return console.error(e),b("Unable to download the app. Please try again later"),!1}}()){t.value=!0,x.addListener("progress",(e=>{const a=Math.round(e.contentLength/1024),t=Math.round(e.bytes/1024),n=Math.round(e.bytes/e.contentLength*100);P.value=`Downloading... ${t}KB / ${a}KB (${n}%)`}));const e=await async function(){try{return(await x.downloadFile({url:await _.getApkDownloadLink($.value),path:`Download/emr-${$.value}.apk`,directory:C.ExternalStorage,recursive:!0,progress:!0})).path}catch(e){console.error(e),b(e.toString())}}();if(t.value=!1,!e)throw new Error("Unable to download the app");m("Download completed. Installing the app..."),await async function(e){try{await D.install({file:e})}catch(a){console.error(a),b("Unable to install the app. Please try again later")}}(e),k.value=$.value}}catch(e){t.value=!1,console.error(e),b("Unable to update the app")}}return r((function(){l("mobile")&&l("android")&&setInterval((async()=>{I.value||($.value=await _.getApkVersion(),k.value=_.getHeadVersion())}),a.checkInterval)})),(e,a)=>I.value?(u(),s("div",U,[a[2]||(a[2]=d(" New version (",-1)),p("strong",null,g($.value),1),a[3]||(a[3]=d(") update is available ",-1)),a[4]||(a[4]=p("br",null,null,-1)),a[5]||(a[5]=p("br",null,null,-1)),v(h(w),{onClick:j,color:"success"},{default:f((()=>[...a[0]||(a[0]=[d(" Download Update ",-1)])])),_:1}),a[6]||(a[6]=d("     ",-1)),v(h(w),{onClick:S,color:"danger"},{default:f((()=>[...a[1]||(a[1]=[d(" Cancel ",-1)])])),_:1}),v(h(y),{"is-open":t.value,message:P.value},null,8,["is-open","message"])])):c("",!0)}}),[["__scopeId","data-v-70fe1068"]]))}}}));
