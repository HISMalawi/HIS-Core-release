import{L as u}from"./lab_report_service-HliUqDYr.js";import{_ as g}from"./ReportMixin.vue_vue_type_script_lang-r1arG92A.js";import{R as f}from"./TableReportTemplate-A4sKSoQg.js";import{d as T,L as e,cx as d,_ as v,r as b,o as _,c as R}from"./index-iM2cGz0p.js";import{F as h}from"./dynamic-import-helper-9HnG3Mif.js";import"./MultiFieldDateHelper-BIZNjBD7.js";import"./KbLayouts-9dqmDWmG.js";import"./HisKbConfigurations-a7K7dizM.js";import"./BasicReportTemplate-Cy-G-sIO.js";import"./Export-VO9zGhWb.js";import"./SIngleTouchField-TVlhbHrr.js";import"./Pagination-nCJl9BUM.js";import"./HisStandardForm-tiWNF5wA.js";import"./TouchScreenForm-hvB0I83y.js";import"./ToolbarMediumCard-ny9gUih7.js";import"./Transformers-XlEF3tgP.js";import"./ViewPort-4mhPlN2U.js";import"./ReportErrors-SvbbPxAT.js";const w=T({mixins:[g],components:{ReportTemplate:f},data:()=>({title:"Lab test result(s)",rows:[],cohort:[],reportType:"",reportReady:!1,columns:[],patientLevelColumns:[[e.thTxt("ARV#"),e.thTxt("Gender"),e.thTxt("Birthdate"),e.thTxt("Ordered"),e.thTxt("Specimen"),e.thTxt("Test"),e.thTxt("Result"),e.thTxt("Released")]],disaggregatedColumns:[e.thTxt("Age group"),e.thTxt("Gender")]}),created(){this.report=new u,this.fields=this.getFormFields()},methods:{async onPeriod({type:r,tests:o},t){this.reportReady=!0,this.rows=[],this.period=this.report.getDateIntervalPeriod(),this.report.setOccupation(t.occupation),this.reportType=r.value,this.reportType==="disaggregated"?this.setDisaggregatedRows(o):this.reportType==="patient_level"&&this.setPatientLevelRows(o)},getFormFields(){return[...this.getDateDurationFields(),{id:"tests",helpText:"Available test(s) results",type:h.TT_MULTIPLE_SELECT,options:async(r,o,t)=>{this.report.setStartDate(t.start_date),this.report.setEndDate(t.end_date);const s=await this.report.getLabResultsReport(),i=this.buildAvailableTests(s);return this.buildAvailableTestOptions(i)}},{id:"type",helpText:"Select report type",type:h.TT_SELECT,options:()=>[{label:"Disaggregated",value:"disaggregated"},{label:"Patient level",value:"patient_level"}]}]},buildAvailableTests(r){const o={};return r.forEach(t=>{t.measures.forEach(s=>{s.name in o||(o[s.name]=[]),o[s.name].push({id:t.patient_id,arv:t.arv_number,gender:t.gender,ageGroup:t.age_group,birthdate:this.toDate(t.birthdate),ordered:this.toDate(t.order_date),specimen:t.test,test:s.name,result:"".concat(s.modifier," ").concat(s.value),released:this.toDate(t.result_date)})})}),o},buildAvailableTestOptions(r){const o=[];for(const t in r){const s=r[t];o.push({label:t,value:s.length,other:s})}return o},setDisaggregatedRows(r){const o=[],t=[];this.columns=[this.disaggregatedColumns.concat(r.map(s=>e.thTxt(s.label)))];for(const s in d){const i=d[s],p=[e.td(i),e.td("Male")],a=[e.td(i),e.td("Female")];r.forEach(({other:m})=>{const l=c=>m.filter(n=>n.gender===c&&n.ageGroup===i).map(n=>n.id);p.push(this.drill(l("M"))),a.push(this.drill(l("F")))}),o.push(p),t.push(a),this.rows=[...t,...o]}},setPatientLevelRows(r){this.columns=this.patientLevelColumns,r.forEach(({other:o})=>{this.sortByArvNumber(o,"arv").forEach(t=>{this.rows.push([this.tdARV(t.arv),e.td(this.formatGender(t.gender)),e.tdDate(t.birthdate),e.tdDate(t.ordered),e.td(t.specimen),e.td(t.test),e.td(t.result),e.tdDate(t.released)])})})}}});function x(r,o,t,s,i,p){const a=b("report-template");return _(),R(a,{title:r.title,period:r.period,rows:r.rows,fields:r.fields,columns:r.columns,onReportConfiguration:r.onPeriod,"report-prefix":"Clinic"},null,8,["title","period","rows","fields","columns","onReportConfiguration"])}const N=v(w,[["render",x]]);export{N as default};
