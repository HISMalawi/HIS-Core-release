var _=Object.defineProperty;var D=(t,e,o)=>e in t?_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var i=(t,e,o)=>(D(t,typeof e!="symbol"?e+"":e,o),o);import{S as n,d as N,I as R,L as a,ab as p,H as w,_ as E,r as d,o as I,c as f,w as O,b as U}from"./index-BCTN_bnC.js";import{_ as b}from"./ReportMixin.vue_vue_type_script_lang-DHsaLvda.js";import{R as A}from"./TableReportTemplate-vw3YSnxU.js";import{g as u}from"./MultiFieldDateHelper-CQ4seieZ.js";import"./BasicReportTemplate-ARrW1sF6.js";import"./Export-nPQsqN2_.js";import"./SIngleTouchField-DeaPtOu6.js";import"./dynamic-import-helper-BkBZiFw5.js";import"./Pagination-141LZS_a.js";import"./HisStandardForm-CaDwl-hA.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./ReportErrors-Dkeo3N9I.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";class h extends n{constructor(){super();i(this,"programID");i(this,"startDate");i(this,"endDate");i(this,"date");this.startDate="",this.endDate="",this.date=n.getSessionDate(),this.programID=n.getProgramID()}setStartDate(o){this.startDate=o}setEndDate(o){this.endDate=o}buildRequestParams(o){const s={};return this.startDate&&(s.start_date=this.startDate),this.endDate&&(s.end_date=this.endDate),this.date&&(s.date=this.date),this.programID&&(s.program_id=this.programID),{...s,...o}}}var r=(t=>(t.WITHOUT_PROGRAM="WITHOUT PROGRAM",t.WITHOUT_TB_NUMBER="WITHOUT TB NUMBER",t.BAD_TB_NUMBER="BAD TB NUMBER",t.IN_TREATMENT_BUT_COMPLETED="IN TREATMENT BUT COMPLETED",t.WITH_DISPENSATION_ANOMALIES="WITH DISPENSATION ANOMALIES",t.WITH_UNKNOWN_OUTCOME="WITH UNKNOWN OUTCOME",t.WITH_DUPLICATE_TB_NUMBER="WITH DUPLICATE TB NUMBER",t))(r||{});class B extends h{constructor(){super()}getDataToolReport(e){return h.getJson("tb_data_cleaning_tools",this.buildRequestParams({context:e}))}}const M=N({mixins:[b],components:{ReportTemplate:A,IonPage:R},data:()=>({title:"Data cleaning report",rows:[],columns:[[a.thTxt("National ID"),a.thTxt("TB Number"),a.thTxt("Name"),a.thTxt("Gender"),a.thTxt("Birthdate"),a.thTxt("Residence"),a.thTxt("State")]],defaultIndicator:{}}),created(){this.fields=[...u({id:"start_date",helpText:"Start",required:!0,minDate:()=>"2000-01-01",maxDate:()=>n.getSessionDate(),computeValue:t=>t,estimation:{allowUnknown:!1}}),...u({id:"end_date",helpText:"End",required:!0,minDate:()=>"2000-01-01",maxDate:()=>n.getSessionDate(),computeValue:t=>t,estimation:{allowUnknown:!1}})],this.defaultIndicator=p.find(this.getIndicatorOptions(),{label:this.$route.query.case})||null},methods:{async onPeriod(t,e){const o=m=>w.toStandardHisDisplayFormat(m);this.rows=[];const s=this.defaultIndicator;this.title=s.label,this.columns=s.other.columns,this.report=new B,this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.period="".concat(o(e.start_date)," - ").concat(o(e.end_date));const l=await this.report.getDataToolReport(s.value);console.log(s,l),p.isNull(l)||(this.rows=await Promise.all(l.map(m=>s.other.formatRow(m))))},mapRow(t){return[a.td(t.identifier||"N/A"),a.td(t.tb_number||"N/A"),a.tdLink(t.name,()=>this.$router.push({path:"/patient/dashboard/".concat(t.patient_id)})),a.td(t.gender||"N/A"),a.td(t.birthdate||"N/A"),a.td(t.residence||"N/A"),a.td(t.state||"N/A")]},getIndicatorOptions(){return[{label:"without program",value:r.WITHOUT_PROGRAM,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"with duplicate tb number",value:r.WITH_DUPLICATE_TB_NUMBER,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"with unknown outcome",value:r.WITH_UNKNOWN_OUTCOME,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"with dispensation anomalies",value:r.WITH_DISPENSATION_ANOMALIES,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"in treatment but completed",value:r.IN_TREATMENT_BUT_COMPLETED,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"bad tb number",value:r.BAD_TB_NUMBER,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}},{label:"without tb number",value:r.WITHOUT_TB_NUMBER,other:{columns:this.columns,formatRow:t=>this.mapRow(t)}}]}}});function S(t,e,o,s,l,m){const T=d("report-template"),c=d("ion-page");return I(),f(c,null,{default:O(()=>[U(T,{title:t.title,period:t.period,rows:t.rows,fields:t.fields,columns:t.columns,showFilters:!0,onReportConfiguration:t.onPeriod},null,8,["title","period","rows","fields","columns","onReportConfiguration"])]),_:1})}const z=E(M,[["render",S]]);export{z as default};
