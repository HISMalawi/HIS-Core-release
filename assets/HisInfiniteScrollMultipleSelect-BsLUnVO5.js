import{d as E,ae as H,am as U,aX as F,bO as N,S as P,$ as O,U as M,a0 as Y,aP as q,dv as z,dw as A,cT as C,aS as G,a8 as Q,ad as s,u as n,B as k,x as l,w as a,v as h,G as _,E as b,C as v,z as w,Y as I,a1 as y}from"./index-BXYGQb-P.js";import R from"./BaseTextInput-DLNj6Y_y.js";import{_ as W}from"./FieldMixin.vue_vue_type_script_lang-Cw9Hfhd7.js";import{u as X}from"./Arrays-CufAqHE9.js";const j=E({name:"HisInfiniteScrollMultipleSelect",mixins:[W],components:{IonCheckbox:H,IonText:U,IonChip:F,ViewPort:N,HisTextInput:R,IonContent:P,IonList:O,IonItem:M,IonLabel:Y,HisKeyboard:q,IonInfiniteScroll:z,IonInfiniteScrollContent:A},data:()=>({showKeyboard:!1,keyboard:C,listData:[],checkedItems:[],disableScroll:!1,filter:"",selected:"",page:1,limit:10}),watch:{clear(){this.checkedItems=[],this.filter="",this.selected=""},checkedItems:{handler(e){this.listData.forEach(t=>{e.find(o=>o.value===t.value)?t.isChecked=!0:t.isChecked=!1}),this.$emit("onValue",e)},deep:!0,immediate:!0},filter:{async handler(){this.page=1,this.disableScroll=!1;const e=await this.getListData();[...this.checkedItems].forEach(t=>{const o=e.findIndex(c=>c.value===t.value);o===-1?e.push(t):e[o].isChecked=!0}),this.listData=e}}},mounted(){this.init()},activated(){this.init()},methods:{async init(){this.$emit("onFieldActivated",this),this.listData=await this.getListData()},async getListData(){return await this.options(this.fdata,this.filter,this.page,this.limit)},async keypress(e){this.filter||(this.selected=""),this.filter=G(e,this.selected),this.selected=this.filter},async onKBValue(e){!this.listData||this.selected===e||(this.filter=e,this.selected=this.filter)},async pushData(e){this.page++;const t=await this.getListData();t.length>0?this.listData=X([...this.listData,...t.filter(o=>!this.listData.find(c=>c.value===o.value))],"label"):this.disableScroll=!0,setTimeout(()=>e.target.complete(),500)},onSelect(e){this.$nextTick(async()=>{e.isChecked?this.checkedItems.findIndex(t=>t.value===e.value)===-1&&this.checkedItems.push(e):this.unCheck(e),typeof this.onValueUpdate=="function"&&(this.checkedItems=await this.onValueUpdate([...this.checkedItems]))})},unCheck(e){this.checkedItems=this.checkedItems.filter(t=>t.value!==e.value)}},created(){var e,t,o,c,f,p,r,u;this.showKeyboard=(t=(e=this.config)==null?void 0:e.showKeyboard)!=null?t:!1,this.keyboard=(c=(o=this.config)==null?void 0:o.keyboard)!=null?c:C,this.page=(p=(f=this.config)==null?void 0:f.page)!=null?p:1,this.limit=(u=(r=this.config)==null?void 0:r.limit)!=null?u:10}});function J(e,t,o,c,f,p){const r=s("his-text-input"),u=s("ion-chip"),g=s("ion-text"),D=s("ion-label"),S=s("ion-checkbox"),V=s("ion-item"),x=s("ion-list"),K=s("ion-infinite-scroll-content"),$=s("ion-infinite-scroll"),B=s("ion-content"),L=s("view-port"),T=s("his-keyboard");return n(),k(b,null,[l(L,{showFull:!e.showKeyboard},{default:a(()=>[e.showKeyboard?(n(),h(r,{key:0,value:e.selected,onOnValue:e.onKBValue},null,8,["value","onOnValue"])):_("",!0),(n(!0),k(b,null,v(e.checkedItems,(i,m)=>(n(),h(u,{color:"danger",key:m,onClick:d=>e.unCheck(i)},{default:a(()=>[w(I(i.label),1)]),_:2},1032,["onClick"]))),128)),l(B,{style:{width:"100%"},class:"ion-padding-bottom view-port-content"},{default:a(()=>[l(x,null,{default:a(()=>[(n(!0),k(b,null,v(e.listData,(i,m)=>(n(),h(V,{key:m,color:i.isChecked?"lightblue":"",lines:i.isChecked?"none":void 0},{default:a(()=>[l(D,null,{default:a(()=>{var d;return[l(g,{class:"his-md-text"},{default:a(()=>[w(I(i.label),1)]),_:2},1024),i.description&&i.isChecked?(n(),h(g,{key:0,color:(d=i.description)==null?void 0:d.color},{default:a(()=>[y("p",null,[y("i",null,I(i.description.text),1)])]),_:2},1032,["color"])):_("",!0)]}),_:2},1024),l(S,{slot:"start",modelValue:i.isChecked,"onUpdate:modelValue":d=>i.isChecked=d,onIonChange:d=>e.onSelect(i),disabled:i.disabled},null,8,["modelValue","onUpdate:modelValue","onIonChange","disabled"])]),_:2},1032,["color","lines"]))),128))]),_:1}),l($,{onIonInfinite:e.pushData,threshold:"100px",disabled:e.disableScroll},{default:a(()=>[l(K,{"loading-spinner":"crescent","loading-text":"Loading more data..."})]),_:1},8,["onIonInfinite","disabled"])]),_:1})]),_:1},8,["showFull"]),e.showKeyboard?(n(),h(T,{key:0,kbConfig:e.keyboard,onKeyPress:e.keypress},null,8,["kbConfig","onKeyPress"])):_("",!0)],64)}const se=Q(j,[["render",J]]);export{se as default};
