import{V as M}from"./ViewPort-0kHLdkku.js";import{d as B,O as V,_ as O,r as s,o as l,x as r,b as e,w as o,A as n,F as y,y as g,u as h,v as u,a3 as P,a4 as R,af as G,aj as U,ak as q,c as K,z as N}from"./index-BFG-WECc.js";import{O as Q}from"./ActionSideButton-Cy7aCvF3.js";import{R as j}from"./ResetButton-DgFPtigM.js";import{_ as L}from"./FieldMixin.vue_vue_type_script_lang-CntTGep4.js";import{b as T}from"./KbLayouts-VRA-vjeH.js";const Y=B({data:()=>({amount:"",keyboard:T}),props:{drugName:{type:String,required:!0},amountNeeded:{type:String,required:!0},onDispense:{type:Function,required:!0}},methods:{async onKeyPress(t){const a=this.amount;t.match(/del/i)?this.amount=a.substring(0,a.length-1):t.match(/clear/i)?this.amount="":t.match(/close/i)?this.onClose():t.match(/reset/i)?this.amount="":t.match(/dispense/i)?(this.amount&&this.onDispense(this.amount),this.onClose()):this.amount+=t},async onClose(){await V.dismiss({})}}}),I=t=>(P("data-v-59c9686c"),t=t(),R(),t),J={class:"",style:{border:".1rem solid #c2c2c2c2"}},W={class:"keypad"},X=I(()=>n("b",null,"Medication: ",-1)),Z=I(()=>n("b",null,"Amount needed: ",-1)),x=I(()=>n("b",null,"Amount Dispensed: ",-1));function tt(t,a,d,m,c,$){const p=s("ion-input"),_=s("ion-button"),k=s("ion-col"),f=s("ion-label"),b=s("ion-item"),D=s("ion-list"),w=s("ion-row"),i=s("ion-grid"),v=s("ion-content"),C=s("ion-toolbar"),H=s("ion-footer");return l(),r(y,null,[e(v,null,{default:o(()=>[e(i,null,{default:o(()=>[e(w,null,{default:o(()=>[e(k,{size:"5"},{default:o(()=>[n("div",J,[e(p,{type:"text",class:"keypad-input",value:t.amount},null,8,["value"]),n("table",W,[(l(!0),r(y,null,g(t.keyboard,(S,E)=>(l(),r("tr",{key:E},[(l(!0),r(y,null,g(S,(A,F)=>(l(),r("td",{class:"his-keyboard-margin",key:"btn-".concat(F)},[e(_,{color:"primary",class:"his-keyboard-btn",onClick:_t=>t.onKeyPress(A)},{default:o(()=>[h(u(A),1)]),_:2},1032,["onClick"])]))),128))]))),128))])])]),_:1}),e(k,{size:"7"},{default:o(()=>[e(D,null,{default:o(()=>[e(b,null,{default:o(()=>[e(f,null,{default:o(()=>[X,h(" "+u(t.drugName),1)]),_:1})]),_:1}),e(b,null,{default:o(()=>[e(f,null,{default:o(()=>[Z,h(u(t.amountNeeded),1)]),_:1})]),_:1}),e(b,null,{default:o(()=>[e(f,null,{default:o(()=>[x,h(u(t.amount.length?t.amount:0),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(H,null,{default:o(()=>[e(C,null,{default:o(()=>[e(_,{onClick:t.onClose,color:"danger",size:"large",slot:"start"},{default:o(()=>[h(" Close ")]),_:1},8,["onClick"]),e(_,{onClick:a[0]||(a[0]=S=>t.onDispense(t.amount)),disabled:t.amount.length<=0,color:"success",size:"large",slot:"end"},{default:o(()=>[h(" Dispense ")]),_:1},8,["disabled"])]),_:1})]),_:1})],64)}const et=O(Y,[["render",tt],["__scopeId","data-v-59c9686c"]]),nt=B({components:{ViewPort:M,Barcode:G,NavButton:Q,ResetButton:j,IonRow:U,IonCol:q},mixins:[L],data:()=>({tab:"prescribe",listData:[]}),mounted(){this.init()},activated(){this.init()},computed:{medicationHistory(){return this.config&&this.config.medicationHistory?this.config.medicationHistory:[]}},methods:{async init(){this.$emit("onFieldActivated",this),this.listData=await this.options(this.fdata)},async onScan(t){const[a,d]=t.split("-"),m=this.listData.map(async c=>{if(c.other.drug_id===parseInt(a)){const $=parseInt(c.value.toString()),p=parseInt(d);await this.updateOnValue(c,p,[],!0)&&(c.value=p+$)}return c});this.listData=await Promise.all(m)},async onReset(t){await this.updateOnValue(t,-1)},async updateOnValue(t,a,d=[],m=!1){return this.onValue&&!await this.onValue({label:t.label,other:{dispenses:d,...t.other},value:a},m)?!1:(t.value=a<0?0:a,this.$emit("onValue",t),this.onValueUpdate&&(this.listData=await this.onValueUpdate(t,this.listData)),!0)},async launchDispenser(t){(await V.create({component:et,backdropDismiss:!1,cssClass:"custom-modal",componentProps:{drugName:t.label,amountNeeded:t.other.amount_needed,onDispense:async d=>{await this.updateOnValue(t,d)&&await V.dismiss({})}}})).present()}}}),z=t=>(P("data-v-d7723e44"),t=t(),R(),t),ot={class:"view-port-content"},st={key:0,class:"his-card history"},at={class:"his-table"},it=z(()=>n("tr",null,[n("th",null," Medication"),n("th",null," Date"),n("th",null," Amount dispensed ")],-1)),lt={key:1,class:"prescription-tab"},rt={class:"prescription-table-section his-card"},ut={class:"his-table"},ct=z(()=>n("tr",null,[n("th",null," Medication"),n("th",null," Amount needed"),n("th",null," Amount dispensed "),n("th",null," Reset ")],-1)),dt={class:"barcode-section"};function pt(t,a,d,m,c,$){const p=s("nav-button"),_=s("ion-col"),k=s("ion-input"),f=s("reset-button"),b=s("barcode"),D=s("ion-row"),w=s("view-port");return l(),K(w,null,{default:o(()=>[n("div",ot,[e(D,null,{default:o(()=>[e(_,{size:"2"},{default:o(()=>[e(p,{onClick:a[0]||(a[0]=i=>t.tab="prescribe"),isActive:t.tab==="prescribe",image:"prescription/rx",label:"Prescribed"},null,8,["isActive"]),e(p,{onClick:a[1]||(a[1]=i=>t.tab="history"),isActive:t.tab==="history",image:"prescription/history",label:"History"},null,8,["isActive"])]),_:1}),e(_,{size:"10"},{default:o(()=>[t.tab==="history"?(l(),r("div",st,[n("table",at,[it,(l(!0),r(y,null,g(t.medicationHistory,(i,v)=>(l(),r("tr",{key:v},[n("td",null,u(i.medication),1),n("td",null,u(i.date),1),n("td",null,u(i.amount),1)]))),128))])])):N("",!0),t.tab==="prescribe"?(l(),r("div",lt,[n("div",rt,[n("table",ut,[ct,(l(!0),r(y,null,g(t.listData,(i,v)=>(l(),r("tr",{key:v},[n("td",null,u(i.label),1),n("td",null,u(i.other.amount_needed),1),n("td",null,[e(k,{disabled:i.value>0,value:i.value,onClick:C=>i.value<=0?t.launchDispenser(i):null,class:"dosage-input"},null,8,["disabled","value","onClick"])]),n("td",null,[e(f,{disabled:i.value<=0,onClick:C=>i.value>0?t.onReset(i):null},null,8,["disabled","onClick"])])]))),128))])]),n("div",dt,[e(b,{onOnScan:t.onScan,class:"his-card"},null,8,["onOnScan"])])])):N("",!0)]),_:1})]),_:1})])]),_:1})}const kt=O(nt,[["render",pt],["__scopeId","data-v-d7723e44"]]);export{kt as default};
