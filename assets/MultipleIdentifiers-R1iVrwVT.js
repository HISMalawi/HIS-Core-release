import{R as c}from"./TableReportTemplate-vw3YSnxU.js";import{F as m}from"./dynamic-import-helper-BkBZiFw5.js";import{d as f,L as t,V as u,H as h,O as n,q as l,_ as y,r as v,o as g,c as w}from"./index-BCTN_bnC.js";import{I as d}from"./identifier_service-Gyvt1JKz.js";import{D as _}from"./DrillTableModal-COI1WyeV.js";import{p as T}from"./VoidReason-BtkcYhr4.js";import"./Export-nPQsqN2_.js";import"./HisStandardForm-CaDwl-hA.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./ReportErrors-Dkeo3N9I.js";const I=f({components:{ReportTemplate:c},data:()=>({service:{},dde:{},title:"Multiple Identifiers",fields:[],rows:[],columns:[[t.thTxt("First Name"),t.thTxt("Last Name"),t.thTxt("Gender"),t.thTxt("Number of identifiers"),t.thTxt("View")]]}),async created(){this.fields=this.getFormFields()},methods:{async onPeriod({identifier:e}){const i=parseInt(e.value.toString());this.title=e.label+" Multiple Identifiers",this.service=new d,this.service.setIdentifierType(i),this.rows=await this.getRows()},getFormFields(){return[{id:"identifier",helpText:"Select Identifier type",type:m.TT_SELECT,validation:e=>u.required(e),options:async()=>(await d.getIdentifierTypes()).map(e=>({label:e.name,value:e.patient_identifier_type_id}))}]},toDate(e){return h.toStandardHisDisplayFormat(e)},async drillDuplicates(e,i){(await n.create({component:_,cssClass:"custom-modal",componentProps:{title:"Identifiers belonging to client",columns:["identifier","date created","void"],onRows:async()=>e.map((o,a)=>{try{return[o.identifier,this.toDate(o.date_created),{type:"button",name:"Void",color:"danger",action:async()=>{await this.voidActiveItem(o.patient_identifier_id,e,a,i)},disabled:!(e.length>1)}]}catch(s){return l("Unable to load patient details"),["N/A","N/A","N/A","N/A","N/A"]}})}})).present()},voidActiveItem(e,i,r,o){T(async a=>{try{n.dismiss().then(async()=>{await this.service.voidMultipleIdentifiers([e],a,i[0].identifier_type);const s=i.splice(r,1);s.length>1?await this.drillDuplicates(s,o):this.rows.splice(o,1)})}catch(s){l("".concat(s))}},"void-modal custom-modal-backdrop")},async getRows(){return(await this.service.getMultipleIdentifiers()).map((e,i)=>[t.td(e.given_name),t.td(e.family_name),t.td(e.gender),t.td(e.identifiers.length),t.tdBtn("Select",()=>this.drillDuplicates(e.identifiers,i))])}}});function D(e,i,r,o,a,s){const p=v("report-template");return g(),w(p,{title:e.title,period:e.period,rows:e.rows,fields:e.fields,columns:e.columns,canExportCsv:!1,canExportPDf:!1,onReportConfiguration:e.onPeriod},null,8,["title","period","rows","fields","columns","onReportConfiguration"])}const k=y(I,[["render",D]]);export{k as default};
