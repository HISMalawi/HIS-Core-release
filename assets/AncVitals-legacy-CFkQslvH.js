System.register(["./dynamic-import-helper-legacy-DYK5bIOV.js","./HisStandardForm-legacy-CturMrfg.js","./vitals_service-legacy-QV_jg0uW.js","./index-legacy-DaDUPm0b.js","./useEncounter-legacy-CnWquunr.js","./TouchScreenForm-legacy-kTjvZFWF.js","./ToolbarMediumCard-legacy-TC6u67eT.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-DVkjms5h.js","./isEmpty-legacy-D7u1z7lS.js","./encounter_guidelines-legacy-i6miv9ib.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,n,i,l,r,o,u,s,c,g,v,d,h;return{setters:[e=>{a=e.F},e=>{n=e.H},e=>{i=e.V},e=>{l=e.d,r=e.K,o=e.M,u=e.o,s=e.c,c=e.cj,g=e.ab,v=e.ad,d=e.n},e=>{h=e.u},null,null,null,null,null,null,null],execute:function(){e("default",l({__name:"AncVitals",setup(e){const t=r(0),l=r(-1),f=r(-1),b=r(-1),m=r([]);let y;const{patientDashboardUrl:p,goToNextTask:w}=h((async function(e,n,r){y=new i(n,e);const o=await i.getFirstObs(n,"Weight");f.value=parseFloat(`${o?.value_numeric??0}`),b.value=parseInt(`${o?.obs_id??-1}`),t.value=r.getAge(),l.value=await r.getRecentHeight(),m.value.push({id:"vitals",helpText:"Vitals entry",type:a.TT_VITALS_ENTRY,validation:A,options:()=>[j,P.value,T,$.value],config:{onUpdateAlertStatus:H,onChangeOption:C,hiddenFooterBtns:["Clear"]}})})),j={label:"Weight",value:"",other:{modifier:"KG",icon:"weight",required:!0}},T={label:"BP",value:"",other:{modifier:"mmHG",icon:"bp"}},$=o((()=>({label:"Age",value:t.value,other:{doNotSave:!0,modifier:"Years old",icon:"",visible:!1}}))),P=o((()=>{const e=l.value>0&&t.value>18;return{label:"Height",value:`${e?l.value:""}`,other:{modifier:"CM",icon:"height",recentHeight:l.value,visible:!e}}}));function A(e){const t=function(e){return e.filter((e=>""===e.value&&!0===e.other.required))}(e);if(t.length>0)return t.map((e=>[`${e.label} can not be empty`]));const a=function(e){return e.filter((e=>("Height"!==e.label||0!=e.other.required)&&""!==e.value&&"Age"!==e.label))}(e);return y.validateAll(a)}function H(e){const t=g.find(e,{label:"BP"});if(t&&""!=t.value){const[e,a]=`${t.value}`.split("/").map((e=>parseInt(e)));if(e>=140&&a>=90)return{status:"Client is at risk of pre-eclampsia, refer for urine protein test.",color:"brown"};if(e<120||e>140)return{status:"Systolic reading is out of normal range",color:"brown"};if(a<80||a>90)return{status:"Diastolic reading is out of normal range",color:"brown"};if(e>=130&&e<=139&&a>=80&&a<=89)return{status:"Prehypertension",color:"brown"}}return{status:"",color:""}}async function S(e){const t=e.value,a=t-f.value;if(100*(Math.abs(a)/f.value||1)>30){const e=`Use ${f.value} Kg`,n=`Use ${t} Kg`;if(await v("Abnormal Weight Change",`Previous Weight "${f.value} Kg". Current Weight "${t} Kg"`,`Weight Reading has been ${a>0?"increased":"decresed"} by more than 30%. Please SELECT the correct Weight.)`,[{name:e,slot:"start",color:"success"},{name:n,slot:"end",color:"danger"}])!==n||!b)return f.value;await d(`Do you want to void Weight observation for ${f.value}`)&&await i.voidObs(b.value)}return t}async function C(e){if(!e.value&&e.other.required)throw`Value for ${e.label} is required`;if(e.value){const t=y.validator(e);if(t&&t.length)throw t}"Weight"===e.label&&f.value>0&&(e.value=await S(e))}async function E(e){return(await Promise.all(e.filter((e=>!(e.other?.doNotSave||g.isEmpty(e.value)))).map((async e=>"BP"===e.label?async function(e){const[t,a]=e.split("/");return[await y.buildValueNumber("Systolic",parseInt(t)),await y.buildValueNumber("Diastolic",parseInt(a))]}(e.value):("Weight"===e.label&&f.value>0&&(e.value=await S(e)),y.buildValueNumber(e.label,e.value)))))).flat()}async function W({vitals:e}){if(!(await async function(e){const t=g.find(e,{label:"Height"});return t?.value>0||!(await d("Patient has no height reading. Do you want to proceed without recording height?",{header:"HEIGHT CONFIRMATION",confirmBtnLabel:"Enter Height",cancelBtnLabel:"Proceed"}))}(e)))return;await y.createEncounter();const t=await E(e);await y.saveObservationList(t),w()}return(e,t)=>(u(),s(n,{fields:m.value,onFinishAction:W,skipSummary:!0,cancelDestinationPath:c(p)},null,8,["fields","cancelDestinationPath"]))}}))}}}));
