var g=Object.defineProperty;var _=(e,i,t)=>i in e?g(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var m=(e,i,t)=>(_(e,typeof i!="symbol"?i+"":i,t),t);import{_ as O}from"./EncounterMixin.vue_vue_type_script_lang-DK6TRcnt.js";import{bd as f,d as k,I as y,aY as S,F as s,V as o,ae as c,n as d,d3 as v,_ as E,r as T,o as w,c as F,w as L,b as V}from"./index-BBbw6-oc.js";import{A as b}from"./anc_current_pregnancy-Dq6h2eDW.js";import"./encounter_guidelines-DqZrhpay.js";import"./GuidelineEngine-D6V1_Znr.js";import"./HisStandardForm-BhUAZgIK.js";const u={12:13,13:14,14:16,15:17,16:18,17:19,18:20,19:21,20:22,21:24,22:25,23:25,24:27,25:28,26:29,27:30,28:32,29:33,30:34,31:35,32:36,33:37,34:38,35:39,36:40,37:42};class x extends f{constructor(t,n){super(t,98,n);m(this,"gestationWeeks");this.gestationWeeks=0}expectedFundalHeightForGestationWeeks(){return this.getEquivalentFundalHeight(this.gestationWeeks)}async loadPregnancyStatus(){const t=await f.getJson("programs/".concat(this.programID,"/patients/").concat(this.patientID));if(t&&t.date_of_lnmp){const a=new b(this.patientID,this.providerID);this.gestationWeeks=a.calculateWeekOfFirstVisit(t.date_of_lnmp)}}getEquivalentFundalWeeks(t){return t<12?u[12]:t>37?u[37]:u[t]}getEquivalentFundalHeight(t){for(const n in u){const a=u[n];if(t<=a)return parseInt(n)}return t>42?37:t<13?12:0}}const C=k({components:{IonPage:y},mixins:[O],data:()=>({service:{},statusService:{},deliveryObs:void 0}),watch:{ready:{async handler(e){e&&(this.service=new x(this.patientID,this.providerID),await this.service.loadPregnancyStatus(),this.fields=this.getFields())},immediate:!0}},methods:{async onFinish(e,i){var t;await this.service.createEncounter(),await this.service.saveObservationList(await this.resolveObs(i)),(t=this.deliveryObs)!=null&&t.length&&(await this.statusService.createEncounter(),await this.statusService.saveObservationList(await Promise.all(this.deliveryObs))),this.nextTask()},diagnosisOptions(e){return[...S.getConceptsByCategory("anc_diagnosis"),{name:"None"}].map(i=>e({...this.toOption(i.name),isChecked:!1}))},getFields(){return[{id:"ultrasound",helpText:"Ultrasound scan results available",type:s.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueCoded("Ultrasound",e.value),options:()=>this.yesNoOptions()},{id:"multiple_gestation",helpText:"Number of fetuses",type:s.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueText("Multiple gestation",e.value),condition:e=>e.ultrasound.value==="Yes",options:()=>[{label:"One",value:1},{label:"Two",value:2},{label:"Three",value:3},{label:"Four",value:4},{label:"Unknown",value:"Unknown"}]},{id:"liquor",helpText:"Liquor",type:s.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueText("LIQUOR",e.value),condition:e=>e.ultrasound.value==="Yes",options:()=>this.mapStrToOptions(["Adequate","Not adequate","Unknown"])},{id:"lie",helpText:"Lie",type:s.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueText("Lie",e.value),condition:e=>e.ultrasound.value==="Yes",options:()=>this.mapStrToOptions(["Longitudinal","Transverse","Unknown"])},{id:"fetal_heart_movement_seen",helpText:"Fetal heart movement seen",type:s.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueCoded("Fetal heart movement seen",e.value),condition:e=>e.ultrasound.value==="Yes",options:()=>this.yesNoOptions()},{id:"presentation",helpText:"Presentation",type:s.TT_GROUP_SELECTOR,validation:e=>this.validateSeries([()=>o.required(e),()=>e&&!e.value?["Presentation cannot be Empty!"]:null,()=>{var i,t,n;return e&&((i=e==null?void 0:e.other)!=null&&i.subGroupOptions)&&c.isEmpty((t=e==null?void 0:e.other)==null?void 0:t.subGroupOptionValue)?["".concat(((n=e==null?void 0:e.other)==null?void 0:n.subgroupTitle)||"Subgroup"," has no value selected")]:null},()=>{var i,t,n,a,r,l,p,h;return e&&!c.isEmpty((i=e==null?void 0:e.other)==null?void 0:i.subGroupOptionValue)&&!c.isEmpty((a=(n=(t=e==null?void 0:e.other)==null?void 0:t.subGroupOptionValue)==null?void 0:n.other)==null?void 0:a.options)&&!((l=(r=e==null?void 0:e.other)==null?void 0:r.subGroupOptionValue)!=null&&l.value)?["".concat((h=(p=e==null?void 0:e.other)==null?void 0:p.subGroupOptionValue)==null?void 0:h.label,"'s value isnt selected")]:null}]),computedValue:e=>{var t,n,a,r;const i=[this.service.buildValueText("Presentation",e.label)];return(n=(t=e==null?void 0:e.other)==null?void 0:t.subGroupOptionValue)!=null&&n.value&&i.push(this.service.buildValueText("Position",(r=(a=e==null?void 0:e.other)==null?void 0:a.subGroupOptionValue)==null?void 0:r.value)),i},options:e=>{const i=(n,a="",r={})=>({label:n,value:a,other:r}),t=[i("Vertex","",{options:this.mapStrToOptions(["Left Occipito Anterior","Left Occipito Transverse","Left Occipito Posterior","Right Occipito Anterior","Right Occipito Transverse","Right Occipito Posterior","Unknown"])}),this.toOption("Oblique"),this.toOption("Transverse"),this.toOption("Breech",{options:this.mapStrToOptions(["Left Sacro Anterior","Left Sacro Transverse","Left Sacro Posterior","Right Sacro Anterior","Right Sacro Transverse","Right Sacro Posterior","Unknown"])}),i("Face","",{concept:"Position",options:this.mapStrToOptions(["Left Mento Anterior","Left Mento Transverse","Left Mento Posterior","Right Mento Anterior","Right Mento Transverse","Right Mento Posterior","Unknown"])}),i("Shoulder","",{options:this.mapStrToOptions(["Left Acromion Dorsal Anterior","Left Acromion Dorsal Transverse","Left Acromion Dorsal Posterior","Right Acromion Dorsal Anterior","Right Acromion Dorsal Transverse","Right Acromion Dorsal Posterior","Unknown"])})];return e.presentation?e.presentation:[i("Cephalic","",{subGroupOptions:t,subgroupTitle:"Cephalic Position",options:this.mapStrToOptions(["Right Occipito Anterior","Left Occipito Anterior","Unknown"])}),i("Breech","",{subGroupOptions:t,subgroupTitle:"Breech Position",options:this.mapStrToOptions(["Right Sacro Anterior","Left Sacro Anterior","Unknown"])}),this.toOption("Ball"),this.toOption("Nil palpable")]}},{id:"enter_fundal_height",helpText:"Fundal height (cm)",type:s.TT_NUMBER,dynamicHelpText:()=>{const e="Fundal height (cm)";return this.service.gestationWeeks?"".concat(e," (").concat(this.service.gestationWeeks,"wks/").concat(this.service.getEquivalentFundalHeight(this.service.gestationWeeks)," cm)"):e},beforeNext:async(e,i)=>{if(e&&"".concat(e.value).match(/unknown/i)&&!["Nil palpable","Ball"].includes(i.presentation.value))return!!await d("Do you want to proceed with Unknown Fundal height?");const t=this.service.expectedFundalHeightForGestationWeeks(),n=parseInt(e.value);if(this.service.gestationWeeks&&(n<t||n>t)){if(!await d("\n                        Fundal height is not equal to expected ".concat(t," cm from gestation weeks of ").concat(this.service.gestationWeeks,".\n                        Are you sure about this value?")))return!1;this.statusService=new b(this.patientID,this.providerID);const r=this.service.getEquivalentFundalWeeks(n),l=this.statusService.estimateLnmpDate(r);this.deliveryObs=this.statusService.buildDelieveryDateObs(l)}return!0},validation:e=>this.validateSeries([()=>o.required(e),()=>e&&!"".concat(e.value).match(/unknown/i)?o.rangeOf(e,10,45):null]),computedValue:e=>e.value!="Unknown"?this.service.buildValueNumber("Fundus",e.value):this.service.buildObs("Fundus",{value_coded:e.value,value_numeric:0}),config:{keypad:v}},{id:"fetal_heart_beat",helpText:"Fetal heart beat",type:s.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueText("Fetal Heart Beat",e.value),options:()=>this.mapStrToOptions(["Heard","Not heard"])},{id:"fetal_heart_rate",helpText:"Fetal heart rate",type:s.TT_NUMBER,validation:e=>o.required(e),beforeNext:async e=>{const n=e?parseInt(e.value):-1;return e&&typeof n=="number"&&(n<120||n>140)?!!await d("\n                            The value is out of Range of 120 - 140.\n                            Are you sure about this value?"):!0},condition:e=>e.fetal_heart_beat.value==="Heard",computedValue:e=>e.value!="Unknown"?this.service.buildValueNumber("Fetal heart movement seen",e.value):this.service.buildObs("Fetal heart movement seen",{value_numeric:0,value_coded:e.value}),config:{keypad:v}},{id:"enter_fetal_movement",helpText:"Fetal movement heard",type:s.TT_SELECT,validation:e=>o.required(e),computedValue:e=>this.service.buildValueCoded("Fetal movement heard","".concat(e.value)),options:()=>this.yesNoOptions()},{id:"fetal_movement_felt",helpText:"Fetal movement felt",type:s.TT_SELECT,validation:e=>o.required(e),condition:e=>!["Ball","Nil palpable"].includes(e.presentation.label),computedValue:e=>this.service.buildValueCoded("Fetal movement felt","".concat(e.value)),options:()=>this.yesNoOptions()},{id:"last_fmf",helpText:"Last fetal movement felt (in Weeks)",type:s.TT_NUMBER,validation:e=>o.validateSeries([()=>o.required(e),()=>o.rangeOf(e,0,42)]),condition:e=>e.fetal_movement_felt.value!="Unknown",computedValue:e=>e.value!="Unknown"?this.service.buildValueNumber("Last Fetal movement felt",e.value):this.service.buildObs("Last Fetal movement felt",{value_numeric:0,value_coded:e.value}),options:()=>this.yesNoUnknownOptions()},{id:"diagnosis",helpText:"Diagnosis",type:s.TT_MULTIPLE_SELECT,validation:e=>o.required(e),computedValue:e=>e&&e.map(i=>i.value).includes("None")?[]:e.map(i=>this.service.buildValueCoded(i.label,"Yes")),onValueUpdate(e,i){return e.map(t=>(i.value==="None"&&t.value!="None"&&(t.isChecked=!1),i.value!="None"&&i.isChecked&&t.value==="None"&&(t.isChecked=!1),t))},options:()=>this.diagnosisOptions(e=>e),config:{footerBtns:[{name:"None",slot:"end",onClickComponentEvents:{refreshOptions:()=>this.diagnosisOptions(e=>(e.isChecked=e.label==="None",e))},onClick:()=>"None"}]}}]}}});function N(e,i,t,n,a,r){const l=T("his-standard-form"),p=T("ion-page");return w(),F(p,null,{default:L(()=>[V(l,{fields:e.fields,skipSummary:!0,onFinishAction:e.onFinish,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])]),_:1})}const W=E(C,[["render",N]]);export{W as default};
