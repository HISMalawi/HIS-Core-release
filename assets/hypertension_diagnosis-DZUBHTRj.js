import{d as u,bn as d,al as p,am as c,B as s,S as h,dr as l,ak as m,a as f,ap as _,b as g}from"./index-3BeNlo1y.js";import{H as y}from"./HisStandardForm-D73p5TNy.js";import{_ as D}from"./EncounterMixin.vue_vue_type_script_lang-CwGN_UQp.js";import"./encounter_guidelines-D8zVYBRP.js";import"./GuidelineEngine-D6V1_Znr.js";const b=u({mixins:[D],components:{HisStandardForm:y},data:()=>({consultation:{}}),watch:{ready:{handler(e){e&&(this.consultation=new l(this.patientID,this.providerID),this.fields=this.getFields())},immediate:!0}},methods:{async onFinish(e,t){await this.consultation.createEncounter();const i=await this.resolveObs(t);await this.consultation.saveObservationList(i),this.$router.back()},getFields(){return[{id:"has_hypertension",helpText:"Does the patient have hypertension",type:c.TT_SELECT,options:()=>this.yesNoOptions(),validation:e=>p.required(e),computedValue:e=>d.buildValueCoded("Patient has hypertension","".concat(e.value))},{id:"hypertension_diagnosis_date",helpText:"Date the patient was diagnosed with hypertension",type:c.TT_FULL_DATE,proxyID:"diagnosis_date",validation:e=>{const t=p.required(e);if(t!=null&&t.length)return t;if(e.value!=="Unknown"){const i=s(e.value),a=s(h.getSessionDate()),n=s(this.patient.getBirthdate());if(i.isAfter(a))return["Diagnosis date cannot be in the future"];if(i.isBefore(n))return["Diagnosis date cannot be before patient was born"]}},condition:e=>e.has_hypertension.value==="Yes",computedValue:e=>d.buildValueDate("Hypertension diagnosis date","".concat(e.value)),config:{allowUnknown:!0}},{id:"years_since_diagnosis",helpText:"How long ago was the patient diagnosed with hypertension?",type:c.TT_AGE_INPUT,proxyID:"diagnosis_date",condition:e=>{var t;return((t=e.hypertension_diagnosis_date)==null?void 0:t.value)==="Unknown"},validation:e=>{var r,o;if(!((r=e==null?void 0:e.other)!=null&&r.timeUnit)||!((o=e==null?void 0:e.other)!=null&&o.value))return["Please enter the time and select the time unit"];const t=parseInt(e.other.value),i=e.other.timeUnit.toLowerCase(),a=s(h.getSessionDate()).subtract(t,i),n=s(this.patient.getBirthdate());if(a.isBefore(n))return["Diagnosis date cannot be before patient was born"]},computedValue:e=>{const t=parseInt(e.other.value),i=e.other.timeUnit.toLowerCase(),n=s(h.getSessionDate()).subtract(t,i).format("YYYY-MM-DD");return d.buildValueDate("Hypertension diagnosis date",n)}}]}}});function w(e,t,i,a,n,r){const o=_("his-standard-form");return g(),f(o,{fields:e.fields,skipSummary:!0,onFinishAction:e.onFinish},null,8,["fields","onFinishAction"])}const V=m(b,[["render",w]]);export{V as default};
