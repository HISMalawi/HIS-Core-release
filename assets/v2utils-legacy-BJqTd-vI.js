System.register(["./index-legacy-Dzpo3D2H.js","./TableView-legacy-B6bff1Ek.js"],(function(t,e){"use strict";var n,a,r,i,s,o,l,c,u,d,p,f,m,b,g,h,v,w,D,y;return{setters:[t=>{n=t.d,a=t.a5,r=t.r,i=t.aG,s=t.aJ,o=t.bo,l=t.cO,c=t.cc,u=t.bx,d=t.a6,p=t.ab,f=t.u,m=t.v,b=t.w,g=t.x,h=t.aQ,v=t.aq,w=t.bk,D=t.ah},t=>{y=t.v}],execute:function(){t({a:P,b:async function(t){(t.columnData??[]).length&&(await v.create({component:y,backdropDismiss:!1,cssClass:"large-modal",componentProps:{onFinish:()=>v.getTop().then((t=>t&&v.dismiss())),...t}})).present()},c:A,d:function(t){return t.map(((t,e)=>({...t,index:e+1})))},s:async function(t){t.patientIdentifiers.length&&(await v.create({component:_,backdropDismiss:!1,cssClass:"large-modal",componentProps:{onFinish:()=>v.getTop().then((t=>t&&v.dismiss())),...t}})).present()},w:async function(t,e=!0){e&&(await w.create({message:"Please wait...",backdropDismiss:!1})).present();try{const e=await t();return w.getTop().then((t=>t?w.dismiss():null)),e}catch(n){console.error(n),D("Unable to generate report")}w.getTop().then((t=>t?w.dismiss():null))}});const e=n({props:{title:{type:String,default:"Drilldown"},patientIdentifiers:{type:Object},onFinish:{type:Function},viewRef:{type:String,default:"person_id"}},components:{IonPage:a,v2Datatable:y},setup(t){const e=r(!0),n=r("-"),a=r([]),d=[[P("identifier","ARV Number"),{label:"Gender",ref:"gender"},{label:"Birthdate",ref:"birthdate"},{label:"Art start date",ref:"art_start_date"},A(t.viewRef)]];return i((()=>t.patientIdentifiers),(async t=>{if(a.value=[],n.value="Total: 0",!t||!t.length)return;const r=s.chunk(t,1e3);for(const s of r){try{if(!e.value)break;const t=(await o.getPersons(s)).map((t=>({...t,birthdate:l(t.birthdate),art_start_date:l(t.art_start_date),gender:c(t.gender)})));a.value=[...a.value,...t]}catch(i){console.error(i)}n.value=`Total: ${a.value.length} of ${(t||[]).length}`,await u(100)}}),{immediate:!0}),{columns:d,subtitle:n,reportData:a,canLoadData:e,ITEMS_PER_PAGE:25,runFinishAction:function(){e.value=!1,"function"==typeof t.onFinish&&t.onFinish()}}}}),_=t("A",d(e,[["render",function(t,e,n,a,r,i){const s=p("v2Datatable"),o=p("ion-page");return f(),m(o,null,{default:b((()=>[g(s,{title:t.title,subtitle:t.subtitle,columnData:t.reportData,columns:t.columns,"default-sort-order":"asc","default-sorted-column":"identifier","on-finish":t.runFinishAction,rowsPerPage:t.ITEMS_PER_PAGE},null,8,["title","subtitle","columnData","columns","on-finish","rowsPerPage"])])),_:1})}]]));function P(t="arv_number",e="ARV#"){return{ref:t,label:e,sortValue:t=>{const e=`${t}`.match(/\w{2,5}-arv-(?<arvDigit>\d*)/i);return parseInt(e?.groups?.arvDigit||"-1")}}}function A(t="patient_id",e="/patient/dashboard/"){return{ref:t,label:"Actions",exportable:!1,toValue:()=>"View",tdClick:({refData:t})=>h.push(`${e}${t}`)}}}}}));
