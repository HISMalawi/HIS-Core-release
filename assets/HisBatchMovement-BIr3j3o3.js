import{d as C,bm as I,ap as w,g as B,ar as z,aq as R,h as S,D as q,bl as E,cB as M,dd as T,F as V,V as _,_ as F,r as o,o as d,c as f,w as s,b as t,x as L,B as A,y as P,u as c,v as k,z as H}from"./index-CtD5m6Vn.js";import{_ as G}from"./FieldMixin.vue_vue_type_script_lang-DA27BMj9.js";import K from"./BaseTextInput-0RTpXsbq.js";const U=C({components:{ViewPort:I,IonGrid:w,IonList:B,IonCol:z,IonRow:R,IonItem:S,IonLabel:q,IonInput:E,HisTextInput:K},mixins:[G],data:()=>({drugs:[],selectedDrug:null}),async activated(){this.init()},methods:{async init(){this.$emit("onFieldActivated",this),this.drugs=await this.options(),this.drugs.length>=1&&this.selectDrug(0)},fmtNumber(e){return M(e)},getModalTitle(e){return"".concat(e," (").concat(this.drugs[this.selectedDrug].label,")")},getDrugValue(e){return this.drugs[this.selectedDrug].other[e]},setDrugValue(e,n){this.drugs[this.selectedDrug].other[e]=n?n.value:""},enterTins(){T({id:"tins",helpText:this.getModalTitle("Enter number of tins"),type:V.TT_NUMBER,defaultValue:()=>this.getDrugValue("tins"),validation:e=>!e||e&&!e.value?null:_.validateSeries([()=>_.isNumber(e),()=>e.value<=0?["Number of tins must be greater than 1"]:null,()=>e.value>this.getDrugValue("quantity")?["You cannot dispose/relocate more than available tins"]:null])},e=>this.setDrugValue("tins",e))},async selectReason(){const e=this.getDrugValue("batch_number");T({id:"reason",helpText:this.getModalTitle("Select reason for disposing/relocating Batch ".concat(e)),type:V.TT_SELECT,defaultValue:()=>this.getDrugValue("reason"),validation:n=>_.required(n),options:()=>{var n;return((n=this.config)==null?void 0:n.getReasons(this.drugs[this.selectedDrug],this.fdata))||[]}},n=>{this.setDrugValue("reason",n)})},selectDrug(e){this.selectedDrug=e}},computed:{fullSelectedDrugName(){var e,n,a;try{const[g,D,,b]=(a=(n=(e=this.drugs[this.selectedDrug])==null?void 0:e.description)==null?void 0:n.text.split("-"))!=null?a:"",h=this.drugs[this.selectedDrug].label;return"".concat(h," (").concat(g,"-").concat(D,"-").concat(b,")")}catch(g){return"N/A"}},updatedDrugs(){return this.drugs.filter(e=>{var n,a;return!!((n=e.other)!=null&&n.tins)&&!!((a=e.other)!=null&&a.reason)})}},watch:{clear(){this.drugs=this.drugs.map(e=>(e.other={...e.other,tins:null,quantity:e.current_quantity/e.pack_size||1,reason:""},e))},drugs:{async handler(){this.$emit("onValue",this.updatedDrugs)},immediate:!0,deep:!0}}});function Y(e,n,a,g,D,b){const h=o("his-text-input"),u=o("ion-item"),$=o("ion-list"),r=o("ion-col"),p=o("ion-label"),m=o("ion-input"),y=o("ion-row"),v=o("ion-grid"),N=o("view-port");return d(),f(N,null,{default:s(()=>[t(h,{readonly:"",value:e.fullSelectedDrugName},null,8,["value"]),t(v,{style:{background:"white"}},{default:s(()=>[t(y,null,{default:s(()=>[t(r,{size:"4",class:"border-right scroll-list"},{default:s(()=>[(d(!0),L(A,null,P(e.drugs,(l,i)=>(d(),f($,{key:i},{default:s(()=>[t(u,{detail:"",color:i===e.selectedDrug?"secondary":"",onClick:j=>e.selectDrug(i)},{default:s(()=>[c(k(l.label),1)]),_:2},1032,["color","onClick"])]),_:2},1024))),128))]),_:1}),t(r,null,{default:s(()=>[e.selectedDrug!==null?(d(),f(v,{key:0,class:"scroll-list"},{default:s(()=>[t(y,null,{default:s(()=>[t(r,{size:"12",class:"ion-margin-bottom"},{default:s(()=>[t(u,null,{default:s(()=>{var l;return[t(p,{position:"floating"},{default:s(()=>{var i;return[c("Available Tins/Pallets (pack size: "+k((i=e.drugs[e.selectedDrug].other)==null?void 0:i.pack_size)+"):",1)]}),_:1}),t(m,{readonly:"",disabled:"",value:e.fmtNumber((l=e.drugs[e.selectedDrug].other)==null?void 0:l.quantity)},null,8,["value"])]}),_:1})]),_:1}),t(r,{size:"12"},{default:s(()=>[t(u,null,{default:s(()=>{var l;return[t(p,{position:"floating"},{default:s(()=>[c("Total Tins Relocated/Disposed")]),_:1}),t(m,{readonly:"",color:"primary",value:e.fmtNumber(((l=e.drugs[e.selectedDrug].other)==null?void 0:l.tins)||0),onClick:e.enterTins},null,8,["value","onClick"])]}),_:1})]),_:1}),t(r,{size:"12"},{default:s(()=>[t(u,null,{default:s(()=>{var l;return[t(p,{position:"floating"},{default:s(()=>[c("Reason for Relocating/Disposing")]),_:1}),t(m,{readonly:"",color:"primary",placeholder:"select reason",value:((l=e.drugs[e.selectedDrug].other)==null?void 0:l.reason)||"",onClick:e.selectReason},null,8,["value","onClick"])]}),_:1})]),_:1})]),_:1})]),_:1})):H("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}const W=F(U,[["render",Y],["__scopeId","data-v-549e1350"]]);export{W as default};
