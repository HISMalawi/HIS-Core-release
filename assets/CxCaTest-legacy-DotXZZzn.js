System.register(["./index-legacy-B837ziyX.js","./HisStandardForm-legacy-CBeq3UhR.js","./useEncounter-legacy-CyeoscVO.js","./commons-legacy-Bkm1k0FB.js","./isEmpty-legacy-BVrNFBaO.js","./encounter_guidelines-legacy-OE9PGsMi.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var a,i,l,n,s,o,u,r,d,v,c,m,b,p,h,C,g,T,_,f;return{setters:[e=>{a=e.bV,i=e.d,l=e.r,n=e.c,s=e.bh,o=e.al,u=e.am,r=e.a$,d=e.c2,v=e.a,c=e.f,m=e.bm,b=e.c1,p=e.b,h=e.s,C=e.q},e=>{g=e.H},e=>{T=e.u},e=>{_=e.y,f=e.r},null,null,null],execute:function(){class t extends a{hivStatus;artStatus;arvNumber;arvStartDate;constructor(e,t){super(e,181,t),this.hivStatus="",this.artStatus="",this.arvNumber="",this.arvStartDate=""}getHivStatus(){return this.hivStatus}getArtStatus(){return this.artStatus}getArvNumber(){return this.arvNumber}getArvStartDate(){return this.arvStartDate}isHivPositive(){return!!this.hivStatus.match(/positive/i)}async loadArtStatus(){const e=await a.getJson(`programs/12/patients/${this.patientID}/art_hiv_status`);e&&(this.hivStatus=e.hiv_status||this.hivStatus,this.artStatus=e.art_status||"",this.arvNumber=e.arv_number||"",this.arvStartDate=e.arv_start_date||"")}}e("default",i({__name:"CxCaTest",setup(e){let a;const i=l([]),x=l(""),S=l(""),V=l([]),y=l([]);let E;const P=n((()=>!(/positive/i.test(S.value)||y.value.some((e=>/hiv/i.test(e.program.name)))))),N=n((()=>!/Chemotherapy|Hysterectomy|Palliative Care/.test(x.value))),{patientDashboardUrl:A,goToNextTask:D}=T((async(e,l,n)=>{E=n,a=new t(l,e),x.value=await a.getFirstValueCoded("Treatment"),S.value=await a.getFirstValueCoded("HIV status");const v=new s(l);y.value=await v.getPrograms(),await async function(){const e=await a.getFirstValueCoded("Offer CxCa");e&&"Yes"===e||a.buildValueCoded("Ever had CxCa","No").then((e=>i.value.push(e)))}(),V.value=function(){const e=String(E.getBirthdate());return[{id:"reason_for_visit",helpText:"Reason for visit",type:u.TT_SELECT,validation:e=>o.required(e),options:()=>[{label:"Initial screening",value:"Initial screening"},{label:"Postponed treatmment",value:"Postponed treatment"},{label:"One year subsequent check-up after treatment",value:"One year subsequent check-up after treatment"},{label:"Subsequent screening",value:"Subsequent screening"},{label:"Problem visit after treatment",value:"Problem visit after treatment"},{label:"Referral",value:"Referral"}],computedValue:e=>({obs:a.buildValueCoded("Reason for visit",e.value)})},{id:"hiv_status",helpText:"HIV status",type:u.TT_SELECT,condition:()=>P.value,validation:e=>o.required(e),options:()=>[{label:"Positive on ART",value:"Positive on ART"},{label:"Positive Not on ART",value:"Positive Not on ART"},{label:"Negative",value:"Negative"},{label:"Never tested",value:"Never tested"},{label:"Prefers Not to disclose",value:"Undisclosed"}],computedValue:e=>({obs:a.buildValueCoded("HIV status",e.value)})},...r({id:"hiv_test_date",helpText:"HIV test result date",required:!0,condition:e=>/Negative|Positive/i.test(e.hiv_status.value),minDate:()=>e,maxDate:()=>a.getDate(),estimation:{allowUnknown:!0,estimationFieldType:b.MONTH_ESTIMATE_FIELD},computeValue:(e,t)=>({date:e,tag:"cxca screening",isEstimate:t,obs:a.buildValueDate("HIV test date",e,t)})}),{id:"ever_had_cxca",helpText:"Ever had CxCa screening",type:u.TT_SELECT,condition:e=>"Initial screening"!==e.reason_for_visit.value&&!x.value,options:()=>_(),validation:e=>o.required(e),computedValue:e=>({obs:a.buildValueCoded("Ever had CxCa",e.value)})},{id:"results_available",helpText:"Results available?",type:u.TT_SELECT,validation:e=>o.required(e),condition:e=>"Initial screening"!==e.reason_for_visit.value&&"No"!==e.ever_had_cxca.value,options:()=>_(),computedValue:e=>({obs:a.buildValueCoded("CxCa test results",e.value)})},{id:"location",helpText:"CxCa screening location",type:u.TT_SELECT,validation:e=>o.required(e),options:(e,t="")=>d(t),config:{showKeyboard:!0,isFilterDataViaApi:!0},condition:e=>w(e),computedValue:e=>({obs:a.buildValueText("Previous CxCa location",e.value)})},...r({id:"cxca_date",helpText:"Previous CxCa test",required:!0,minDate:()=>e,maxDate:()=>a.getDate(),estimation:{allowUnknown:!1},condition:e=>w(e),computeValue:(e,t)=>({date:e,tag:"cxca screening",isEstimate:t,obs:a.buildValueDate("cxca test date",e)})}),{id:"previous_screening_method",helpText:"Previous screening method",type:u.TT_SELECT,validation:e=>o.required(e),condition:e=>w(e),options:()=>[{label:"VIA",value:"VIA"},{label:"PAP Smear",value:"PAP Smear"},{label:"HPV DNA",value:"HPV DNA"},{label:"Speculum Exam",value:"Speculum Exam"}],computedValue:e=>({obs:a.buildValueCoded("Previous CxCa screening method",e.value)})},{id:"offer_CxCa",helpText:"Offer CxCa screening today",type:u.TT_SELECT,condition:()=>N.value,validation:e=>o.required(e),options:()=>_(),computedValue:e=>({obs:a.buildValueCoded("Offer CxCa",e.value)})},{id:"screening_method",helpText:"Screening method being offered",type:u.TT_SELECT,validation:e=>o.required(e),condition:e=>"Yes"===e.offer_CxCa.value,options:()=>[{label:"VIA",value:"VIA"},{label:"PAP Smear",value:"PAP Smear"},{label:"HPV DNA",value:"HPV DNA"},{label:"Speculum Exam",value:"Speculum Exam"}],computedValue:e=>({obs:a.buildValueCoded("CxCa screening method",e.value)})},{id:"offer_family_planning",helpText:"Offer Family Planning ?",type:u.TT_SELECT,condition:e=>"No"!==e.offer_CxCa.value,validation:e=>o.required(e),options:()=>_(),computedValue:e=>({obs:a.buildValueCoded("Family planning",e.label)})},{id:"reason_for_no_cxca",helpText:"Reason for NOT offering CxCa screening",type:u.TT_SELECT,validation:e=>o.required(e),condition:e=>"No"===e.offer_CxCa.value,options:()=>m.getConceptsByCategory("reason_for_no_cxca").map((e=>({label:e.name,value:e.name,other:{c:e}}))),computedValue:e=>({obs:a.buildValueCoded("Reason for NOT offering CxCa",e.value)})}]}()}));async function q(e,t){if(!(await a.createEncounter()))return h("Unable to create encounter");const l=await f(t);if(!(await a.saveObservationList([...l,...i.value])))return h("Unable to save patient observations");C("Observations and encounter created!"),D()}function w(e){const t="Yes"===e.ever_had_cxca.value,a="Yes"===e.results_available.value;return t&&a}return(e,t)=>(p(),v(g,{fields:V.value,onFinishAction:q,skipSummary:!1,cancelDestinationPath:c(A)},null,8,["fields","cancelDestinationPath"]))}}))}}}));
