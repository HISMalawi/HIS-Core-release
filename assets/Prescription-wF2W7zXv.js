import{Q as F}from"./HisKbConfigurations-GhFQZvlg.js";import{V as te}from"./ViewPort--UGxBUFx.js";import{k as L}from"./KbHandler-BuQ4TFU6.js";import se from"./BaseTextInput-DFbbD4f5.js";import{d as O,O as x,j as ne,i as Y,k as oe,l as U,m as z,f as W,_ as E,r as o,o as l,x as m,b as n,w as a,u as h,F as I,y as K,c as b,ar as Q,g as G,h as j,cw as ae,ct as ie,v as $,b5 as M,aU as re,e as le,B as ce,C as de,cD as ue,cE as he,cF as pe,t as q,n as me,T as _e,p as fe,H as be,ba as ge,A as r,z as k,a3 as ye,a4 as ve}from"./index-L7KBnPzM.js";import{_ as De}from"./FieldMixin.vue_vue_type_script_lang-B9JrqYcD.js";import{H as ke}from"./HisKeyboard-BypDdv5B.js";import{B as Ie}from"./BaseKeyboard-d4rlYFvC.js";import{P as Ce}from"./KbLayouts-VRA-vjeH.js";import{D as Se}from"./drug_order_service-D4YswJEc.js";import{D as Ae}from"./drug_service-Bsb2HBYp.js";import{_ as we}from"./EncounterMixin.vue_vue_type_script_lang-BCE85g_3.js";import"./encounter_guidelines-DJZQNSsG.js";import"./GuidelineEngine-D6V1_Znr.js";import"./HisStandardForm-4iY8ramV.js";import"./TouchScreenForm-DLhU6o0i.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./ToolbarMediumCard-BO4GFuiT.js";import"./Transformers-BPPLlH12.js";const $e=O({name:"Modal",props:{items:{type:Object,required:!0},submitData:{type:Function}},async created(){console.log("created modal")},methods:{async closeModal(e){await x.dismiss(e)}},data(){return{content:"Content",artStartDate:"",monthsOnART:"",lastOrder:"",currentRegimen:"",regimenStartDate:""}},components:{IonHeader:ne,IonToolbar:Y,IonTitle:oe,IonContent:U,IonFooter:z,IonButton:W}});function Te(e,t,s,c,y,p){const d=o("ion-title"),f=o("ion-toolbar"),u=o("ion-header"),C=o("ion-label"),v=o("ion-item"),S=o("ion-list"),A=o("ion-content"),g=o("ion-button"),w=o("ion-footer");return l(),m(I,null,[n(u,null,{default:a(()=>[n(f,null,{default:a(()=>[n(d,null,{default:a(()=>[h("Select Malaria Drugs")]),_:1})]),_:1})]),_:1}),n(A,{style:{overflowY:"hidden",background:"grey"}},{default:a(()=>[n(S,{class:"view-port-content"},{default:a(()=>[(l(!0),m(I,null,K(e.items,(_,N)=>(l(),b(v,{key:N,class:"items"},{default:a(()=>{var T;return[n(C,{class:Q((T=_==null?void 0:_.other)!=null&&T.wrapTxt?"ion-text-wrap":""),innerHTML:_.label,onClick:[e.submitData,t[0]||(t[0]=V=>e.closeModal("later"))],value:_.value},null,8,["class","innerHTML","onClick","value"])]}),_:2},1024))),128))]),_:1})]),_:1}),n(w,null,{default:a(()=>[n(f,null,{default:a(()=>[n(g,{slot:"start",color:"danger",size:"large",onClick:t[1]||(t[1]=_=>e.closeModal("later"))},{default:a(()=>[h(" Cancel ")]),_:1})]),_:1})]),_:1})],64)}const Ke=E($e,[["render",Te],["__scopeId","data-v-591a4fbb"]]),Oe=O({components:{IonList:G,IonItem:j,IonRadio:ae,IonRadioGroup:ie},data:()=>({activeLabel:""}),props:{list:{type:Object,required:!0},label:String},methods:{async frequencyKeypress(e){this.$emit("frequencyKeypress",e)}}}),Ee={class:"freq-content"};function Ne(e,t,s,c,y,p){const d=o("snap"),f=o("center"),u=o("ion-radio"),C=o("ion-label"),v=o("ion-item"),S=o("ion-radio-group"),A=o("ion-list");return l(),m("div",Ee,[n(f,{style:{"padding-top":"12px"}},{default:a(()=>[n(d,null,{default:a(()=>[h(" Frequency ")]),_:1})]),_:1}),n(A,null,{default:a(()=>[n(S,{value:e.activeLabel},{default:a(()=>[(l(!0),m(I,null,K(e.list,(g,w)=>(l(),b(v,{class:"his-md-text",key:w,onClick:_=>e.frequencyKeypress(g)},{default:a(()=>[n(u,{slot:"start",value:g},null,8,["value"]),n(C,null,{default:a(()=>[h($(g),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1},8,["value"])]),_:1})])}const Pe=E(Oe,[["render",Ne],["__scopeId","data-v-98e92a7b"]]),Me=O({components:{BaseKeyboard:Ie},props:{title:{type:String},preset:{type:String},onKeyPress:{type:Function,required:!0},strictNumbers:{type:Boolean,default:!1}},data:()=>({value:"",keypad:Ce}),watch:{preset:{handler(e){e&&(this.value=e.toString())},immediate:!0}},methods:{async keypress(e){if(this.strictNumbers){if(e.includes(".")&&this.value.includes("."))return;!e.includes(".")&&this.value==="0"&&(this.value=""),this.value=L(e,this.value),this.value||(this.value=""),"".concat(parseInt(this.value))===this.value?this.onKeyPress(parseInt(this.value)):this.onKeyPress(this.value)}else this.value=L(e,this.value),this.onKeyPress(this.value)}}}),qe={class:"keypad"};function Be(e,t,s,c,y,p){const d=o("snap"),f=o("ion-input"),u=o("base-keyboard");return l(),m("div",qe,[n(d,{class:"ion-text-center"},{default:a(()=>[h($(e.title),1)]),_:1}),n(f,{value:e.value,style:{"text-align":"center",border:"solid 1px #b7b7b7","margin-top":"12px","margin-bottom":"12px"}},null,8,["value"]),n(u,{btnSize:"8.5vw",layout:e.keypad,onKeyPress:e.keypress},null,8,["layout","onKeyPress"])])}const He=E(Me,[["render",Be],["__scopeId","data-v-6f34ea99"]]),B=[{label:"ONCE A DAY (OD)",code:"OD",value:1},{label:"TWICE A DAY (BD)",code:"BD",value:2},{label:"THREE TIMES A DAY (TDS)",code:"TDS",value:3},{label:"FOUR TIMES A DAY (QID)",code:"QID",value:4},{label:"FIVE TIMES A DAY (5X/D)",code:"5X/D",value:5},{label:"SIX TIMES A DAY (Q4HRS)",code:"Q4HRS",value:6},{label:"IN THE MORNING (QAM)",code:"QAM",value:1},{label:"ONCE A DAY AT NOON (QNOON)",code:"QNOON",value:1},{label:"IN THE EVENING (QPM)",code:"QPM",value:1},{label:"ONCE A DAY AT NIGHT (QHS)",code:"QHS",value:1},{label:"EVERY OTHER DAY (QOD)",code:"QOD",value:.5},{label:"ONCE A WEEK (QWK)",code:"QWK",value:.14},{label:"ONCE A MONTH",code:"ONCE A MONTH",value:.03},{label:"TWICE A MONTH",code:"TWICE A MONTH",value:.071},{label:"Unknown",code:"Unknown",value:0}],Le=[{drug_id:236,duration:3,tabs:6,name:"Lumefantrine + Arthemether 1 x 6",dose_strength:1,units:"tabs",frequency:2},{drug_id:237,duration:3,tabs:12,name:"Lumefantrine + Arthemether 2 x 6",dose_strength:2,units:"tabs",frequency:2},{drug_id:238,duration:3,tabs:18,name:"Lumefantrine + Arthemether 3 x 6",dose_strength:3,units:"tabs",frequency:2},{drug_id:239,duration:3,tabs:24,name:"Lumefantrine + Arthemether 4 x 6",dose_strength:4,units:"tabs",frequency:2},{drug_id:311,duration:1,tabs:1,name:"SP (525mg tablet)",dose_strength:1,units:"tabs",frequency:.03},{drug_id:1218,duration:1,tabs:1,name:"Artesunate injenction",dose_strength:1,units:"ml",frequency:1},{drug_id:1219,duration:3,tabs:3,name:"ASAQ 25mg/67.5mg (3 tablets)",dose_strength:1,units:"mg",frequency:1},{drug_id:1220,duration:3,tabs:3,name:"ASAQ 50mg/135mg (3 tablets)",dose_strength:1,units:"mg",frequency:1},{drug_id:1221,duration:3,tabs:3,name:"ASAQ 100mg/270mg (3 tablets)",dose_strength:1,units:"mg",frequency:1},{drug_id:1222,duration:3,tabs:6,name:"ASAQ 100mg/270mg (6 tablets)",dose_strength:2,units:"mg",frequency:1}];class H extends M{constructor(t,s){super(t,25,s)}async loadDrugs(t="",s=1,c=10){return(await Ae.getOPDDrugs({name:t,page:s,page_size:c})).map(p=>({label:p.name,value:p.name,other:p}))}async hasMalaria(){const t=await re.getLatestMalariaTestResult(this.patientID);return t==="No"?!!((await M.getAllValueCoded(this.patientID,"Primary diagnosis")).includes("Malaria")||(await M.getAllValueCoded(this.patientID,"Secondary diagnosis")).includes("Malaria")):t==="Positive"}createDrugOrder(t){return Se.create({encounter_id:this.encounterID,drug_orders:t})}}const Qe=O({name:"HisInfiniteScrollMultipleSelect",mixins:[De,we],components:{PrescriptionKeypad:He,IonCheckbox:le,IonText:ce,IonButton:W,ViewPort:te,HisTextInput:se,IonContent:U,IonList:G,IonItem:j,IonLabel:de,HisKeyboard:ke,IonInfiniteScroll:ue,IonInfiniteScrollContent:he,IonFooter:z,IonToolbar:Y,PrescriptionFrequency:Pe},data:()=>({switchKeyboard:!0,keyboard:F,listData:[],checkedItems:[],disableScroll:!1,filter2:"",selected:"",selectedItems:[],malariaDrug:[],prescriptionService:{},label:String,page:1,limit:10,trash:pe,list:B.map(e=>e.label),showMalariaDrugs:!1,hasMalaria:!1,disableNextBtn:!0,confirmBtn:!1}),watch:{checkedItems:{handler(e){this.listData.forEach(t=>{e.find(s=>s.value===t.value)?t.isChecked=!0:t.isChecked=!1}),this.$emit("onValue",e)},deep:!0,immediate:!0},filter2:{async handler(){this.page=1,this.disableScroll=!1;const e=await this.getListData();[...this.checkedItems].forEach(t=>{const s=e.findIndex(c=>c.value===t.value);s===-1?e.push(t):e[s].isChecked=!0}),this.listData=e}}},mounted(){this.init()},activated(){this.init()},methods:{async init(){this.listData=await this.getListData()},async getListData(){return this.prescriptionService=new H(this.patientID,this.providerID),await this.prescriptionService.loadDrugs(this.filter2,this.page,this.limit)},async dosageKeypress(e){this.checkedItems[0].other.dosage=e},async frequencyKeypress(){this.checkedItems[0].other.frequency=this.label},async durationKeypress(e){e.match(/Confirm/i)?(this.confirmBtn=!0,this.inputFieldType()):this.checkedItems[0].other.duration=e},async keypress(e){this.filter2||(this.selected=""),this.filter2=L(e,this.selected),this.selected=this.filter2},async onKBValue(e){!this.listData||this.selected===e||(this.filter2=e,this.selected=this.filter2)},async pushData(e){this.page++;const t=await this.getListData();t.length>0?this.listData=[...this.listData,...t.filter(s=>!this.listData.find(c=>c.value===s.value))]:this.disableScroll=!0,e.target.complete()},isComplete(){const e=this.checkedItems[0];return!e.other.frequency||!e.other.duration||!e.other.dosage?(this.disableNextBtn=!0,this.confirmBtn&&(q("complete prescription details for ".concat(e.label)),this.confirmBtn=!1),!1):(this.confirmBtn=!1,this.disableNextBtn=!1,!0)},inputFieldType(){return!this.switchKeyboard&&this.isComplete()?(this.switchKeyboard=!0,!0):(this.switchKeyboard=!1,!1)},async predefinedMalariaDrug(){if(this.hasMalaria=await this.prescriptionService.hasMalaria(),!this.hasMalaria&&!await me("Patient has no malaria. Do you still want to prescribe anti malaria drugs?"))return;(await x.create({component:Ke,backdropDismiss:!1,cssClass:"lager-modal",componentProps:{items:Le.map(t=>({label:"".concat(t.name,", ").concat(t.frequency," time(s) a day, for ").concat(t.duration," days"),value:[t.name,t.frequency,t.duration,t.dose_strength,t.units,t.drug_id],other:t})),submitData:async t=>{const s=t.target.attributes.value.nodeValue.split(","),c=B.find(d=>d.value==s[1]),y={isChecked:!0,label:s[0],other:{frequency:c.label,units:s[4],drug_id:s[5],duration:s[2],dosage:s[3]},value:s[0]},p=["Lumefantrine + Arthemether 1 x 6","Lumefantrine + Arthemether 2 x 6","Lumefantrine + Arthemether 3 x 6","Lumefantrine + Arthemether 4 x 6"];p.includes(s[0])&&(this.checkedItems=this.checkedItems.filter(d=>!p.includes(d.value))),this.checkedItems.unshift(y),this.isComplete()&&(this.disableNextBtn=!1)}}})).present()},onSelect(e){this.$nextTick(async()=>{e.isChecked?this.checkedItems.findIndex(t=>t.value===e.value)===-1&&(this.checkedItems.unshift(e),this.selected="",this.inputFieldType(),this.isComplete()):this.unCheck(e)})},unCheck(e){this.checkedItems.length==1&&(this.disableNextBtn=!0,this.switchKeyboard=!0),this.checkedItems=this.checkedItems.filter(t=>t.value!==e.value)},clearPrescription(){this.selected=""},async savePrescription(){try{const e=this.mapToOrders();if(!await this.prescriptionService.createEncounter())return q("Unable to create treatment encounter");if(!await this.prescriptionService.createDrugOrder(e))return q("Unable to create drug orders!");_e("Drug order has been created"),this.printVisitSummary(),fe(this.patientID,this.$router)}catch(e){console.error(e)}},mapToOrders(){return this.checkedItems.map(e=>{const t=H.getSessionDate(),s=B.find(c=>c.label===e.other.frequency);return{drug_inventory_id:e.other.drug_id,equivalent_daily_dose:e.other.dosage=="Unknown"?0:e.other.dosage*((s==null?void 0:s.value)||1),start_date:t,auto_expire_date:this.calculateExpireDate(t,e.other.duration),units:e.other.units,instructions:"".concat(e.label,": ").concat(e.other.dosage," ").concat(e.other.units," ").concat(s==null?void 0:s.code," for ").concat(e.other.duration," days"),dose:e.other.dosage,frequency:s==null?void 0:s.code}})},calculateExpireDate(e,t){const s=new Date(e);return s.setDate(s.getDate()+parseInt(t)),be.toStandardHisFormat(s)},printVisitSummary(){return new ge(this.patientID).printVisitSummaryLbl(H.getSessionDate())}},created(){this.keyboard=F,this.page=1,this.limit=10}}),Ve=e=>(ye("data-v-97b0d4dd"),e=e(),ve(),e),Re={style:{width:"97.8%",margin:"auto"}},Fe={id:"cummulative",class:"cummulative_hight",style:{border:"1px solid #999","border-bottom":"none","background-color":"#f6f2ca",height:"25vh",overflow:"auto",padding:"5px"}},xe={style:{width:"100%"}},Ye=Ve(()=>r("thead",null,[r("tr",null,[r("th",null,"Drug"),r("th",null,"Frequency"),r("th",null,"Dosage"),r("th",null,"Duration"),r("th")])],-1)),Ue={class:"dosage-input"},ze={class:"dosage-input"},We={class:"dosage-input"},Ge={class:"dosage-input"},je=["onClick"],Xe={key:2,class:"content"};function Je(e,t,s,c,y,p){const d=o("ion-input"),f=o("ion-icon"),u=o("ion-button"),C=o("his-text-input"),v=o("ion-text"),S=o("ion-label"),A=o("ion-checkbox"),g=o("ion-item"),w=o("ion-list"),_=o("ion-infinite-scroll-content"),N=o("ion-infinite-scroll"),T=o("ion-content"),V=o("view-port"),X=o("his-keyboard"),J=o("prescription-frequency"),R=o("prescription-keypad"),Z=o("ion-toolbar"),ee=o("ion-footer");return l(),m(I,null,[r("div",null,[r("div",Re,[r("div",Fe,[r("table",xe,[Ye,r("tbody",null,[(l(!0),m(I,null,K(e.checkedItems,(i,P)=>(l(),m("tr",{key:P},[r("td",Ue,[r("b",null,$(i.label),1)]),r("td",ze,[n(d,{readonly:"",placeholder:"Add frequency..",value:i.other.frequency},null,8,["value"])]),r("td",We,[n(d,{readonly:"",placeholder:"Add dosage..",value:i.other.dosage},null,8,["value"])]),r("td",Ge,[n(d,{readonly:"",placeholder:"Add duration..",value:i.other.duration},null,8,["value"])]),r("td",{class:"dosage-input",onClick:D=>e.unCheck(i)},[n(u,{color:"danger"},{default:a(()=>[n(f,{icon:e.trash},null,8,["icon"])]),_:1})],8,je)]))),128))])])])]),e.switchKeyboard?(l(),b(V,{key:0,style:{"margin-top":"0px",height:"37vh"}},{default:a(()=>[n(C,{value:e.selected,onOnValue:e.onKBValue},null,8,["value","onOnValue"]),n(T,{style:{width:"100%"},class:"ion-padding-bottom"},{default:a(()=>[r("div",{class:Q(["ion-content-scroll-host",{"ion-margin-bottom ion-padding-bottom":e.disableScroll}])},[n(w,{class:Q(["view-port-content",{"ion-margin-bottom":e.disableScroll}])},{default:a(()=>[(l(!0),m(I,null,K(e.listData,(i,P)=>(l(),b(g,{key:P,color:i.isChecked?"lightblue":"",lines:i.isChecked?"none":"full"},{default:a(()=>[n(S,null,{default:a(()=>{var D;return[n(v,{class:"his-md-text"},{default:a(()=>[h($(i.label),1)]),_:2},1024),i.description&&i.isChecked?(l(),b(v,{key:0,color:(D=i.description)==null?void 0:D.color},{default:a(()=>[r("p",null,[r("i",null,$(i.description.text),1)])]),_:2},1032,["color"])):k("",!0)]}),_:2},1024),n(A,{slot:"start",modelValue:i.isChecked,"onUpdate:modelValue":D=>i.isChecked=D,onIonChange:D=>e.onSelect(i),disabled:i.disabled},null,8,["modelValue","onUpdate:modelValue","onIonChange","disabled"])]),_:2},1032,["color","lines"]))),128))]),_:1},8,["class"]),n(N,{onIonInfinite:t[0]||(t[0]=i=>e.pushData(i)),threshold:"100px",disabled:e.disableScroll},{default:a(()=>[n(_,{"loading-spinner":"crescent","loading-text":"Loading more data..."})]),_:1},8,["disabled"])],2)]),_:1})]),_:1})):k("",!0),e.switchKeyboard?(l(),b(X,{key:1,kbConfig:e.keyboard,onKeyPress:e.keypress},null,8,["kbConfig","onKeyPress"])):k("",!0),e.switchKeyboard?k("",!0):(l(),m("div",Xe,[n(J,{list:e.list,onFrequencyKeypress:t[1]||(t[1]=i=>e.label=i),onClick:t[2]||(t[2]=i=>e.frequencyKeypress())},null,8,["list"]),n(R,{onKeyPress:e.dosageKeypress,title:"Dosage",onClick:e.isComplete},null,8,["onKeyPress","onClick"]),n(R,{onKeyPress:e.durationKeypress,title:"Duration",onClick:e.isComplete},null,8,["onKeyPress","onClick"])]))]),n(ee,{style:{position:"absolute",bottom:"0"}},{default:a(()=>[n(Z,{color:"dark"},{default:a(()=>[n(u,{"router-link":e.cancelDestination,slot:"start",size:"large",color:"danger"},{default:a(()=>[h(" Cancel ")]),_:1},8,["router-link"]),e.switchKeyboard?(l(),b(u,{key:0,onClick:e.predefinedMalariaDrug,slot:"end",size:"large",color:"primary"},{default:a(()=>[h(" Predefined Malaria Drugs ")]),_:1},8,["onClick"])):k("",!0),e.switchKeyboard?k("",!0):(l(),b(u,{key:1,onClick:t[3]||(t[3]=i=>e.durationKeypress("Confirm")),slot:"end",size:"large",color:"success"},{default:a(()=>[h(" Add Drug ")]),_:1})),n(u,{onClick:e.clearPrescription,slot:"end",size:"large",color:"warning"},{default:a(()=>[h(" Clear ")]),_:1},8,["onClick"]),n(u,{disabled:e.disableNextBtn,onClick:e.savePrescription,slot:"end",size:"large",color:"success"},{default:a(()=>[h(" Finish ")]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})],64)}const gt=E(Qe,[["render",Je],["__scopeId","data-v-97b0d4dd"]]);export{gt as default};
