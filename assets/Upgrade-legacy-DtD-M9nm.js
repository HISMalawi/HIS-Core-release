System.register(["./index-legacy-BiNmSRfH.js","./HelpdeskFlyer-legacy-Dms9dPl1.js","./index-legacy-CJn60hmf.js","./index-legacy-DtVOfeP3.js"],(function(e,t){"use strict";var n,a,l,o,s,i,r,c,u,d,p,g,h,y,f,w,v,b,k,m,x,S,_,C,q,M,R,U;return{setters:[e=>{n=e.d,a=e.r,l=e.u,o=e.c,s=e.i,i=e.o,r=e.a,c=e.b,u=e.w,d=e.e,p=e.f,g=e.I,h=e.g,y=e.h,f=e.j,w=e.k,v=e.l,b=e.m,k=e.t,m=e.n,x=e.p,S=e.A,_=e.q,C=e.s},e=>{q=e.H},e=>{M=e.F,R=e.D},e=>{U=e.C}],execute:function(){const t={key:0,style:{"margin-top":"1%"},class:"ion-padding"},j={style:{"font-size":"2.5rem"},class:"ion-text-center"},D={class:"ion-text-center"},E={key:1,style:{"margin-top":"1%"},class:"ion-padding"},P={class:"ion-text-center"},$={style:{"margin-top":"10px"},class:"ion-text-center"};e("default",n({__name:"Upgrade",setup(e){const n=a(!1),z=l(),F=o((()=>`${z.query.version}`)),H=a("-"),L=o((()=>s("android"))),A=new S,B=a("");function I(){x.push("/"),setTimeout((()=>location.reload()),150)}async function K(){try{if(await async function(){try{const{publicStorage:e}=await M.checkPermissions();if("granted"!==e){const{publicStorage:e}=await M.requestPermissions();if("granted"!==e)return C("Permission to access storage is required to download the app."),!1}return!0}catch(e){return console.error(e),C("Unable to download the app. Please try again later"),!1}}()){n.value=!0,M.addListener("progress",(e=>{const t=Math.round(e.contentLength/1024),n=Math.round(e.bytes/1024),a=Math.round(e.bytes/e.contentLength*100);B.value=`Downloading... ${n}KB / ${t}KB (${a}%)`}));const e=await async function(){try{return(await M.downloadFile({url:await A.getApkDownloadLink(F.value),path:`Download/emr-${F.value}.apk`,directory:R.ExternalStorage,recursive:!0,progress:!0})).path}catch(e){console.error(e),C(e.toString())}}();if(n.value=!1,!e)throw new Error("Unable to download the app");_("Download completed. Installing the app..."),await async function(e){try{await U.install({file:e})}catch(t){console.error(t),C("Unable to install the app. Please try again later")}}(e)}}catch(e){n.value=!1,console.error(e),C("Unable to update the app")}}return i((()=>async function(){H.value=await(new S).getApiVersion()}())),(e,n)=>(c(),r(p(m),null,{default:u((()=>[d(p(g),null,{default:u((()=>[n[7]||(n[7]=h("div",{class:"ion-text-center ion-padding",style:{"font-weight":"bold","font-size":"2.0rem"}}," This EMR needs an update. ",-1)),n[8]||(n[8]=h("div",{class:"ion-text-center"}," Follow the steps below to update. ",-1)),L.value?(c(),y("div",t,[h("div",j,[h("div",null,[n[1]||(n[1]=h("h1",null,[h("b",null,"Step 1:"),f(" Click below to update EMR ")],-1)),d(p(w),{onClick:K,size:"large",color:"success"},{default:u((()=>[...n[0]||(n[0]=[f("Update EMR",-1)])])),_:1})])]),h("div",D,[n[2]||(n[2]=h("h3",null,[h("b",null,"Step 2:"),f(" Contact Helpdesk if update is not possible "),h("b",null,"(Optional)")],-1)),d(q)])])):(c(),y("div",E,[h("div",P,[n[3]||(n[3]=h("h1",null,[h("b",null,"Step 1:"),f(" Contact the Helpdesk")],-1)),d(q),n[4]||(n[4]=h("p",null,null,-1)),n[5]||(n[5]=h("h2",null,[h("b",null,"Step 2:"),f(" Click Reload when an officer tells you to")],-1))])])),h("div",$,[d(p(w),{onClick:I,size:"large"},{default:u((()=>[...n[6]||(n[6]=[f("Reload",-1)])])),_:1})])])),_:1}),d(p(v),null,{default:u((()=>[d(p(b),{class:"ion-text-center"},{default:u((()=>[n[9]||(n[9]=f(" Required version: ",-1)),h("b",null,k(F.value)+"/"+k(H.value),1)])),_:1})])),_:1})])),_:1}))}}))}}}));
