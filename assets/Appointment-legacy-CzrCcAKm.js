System.register(["./index-legacy-pSEoxn3J.js","./HisStandardForm-legacy-CGi-zolz.js","./EncounterMixin.vue_vue_type_script_lang-legacy-B-rKFJn9.js","./appointment_service-legacy-sDc67874.js","./encounter_guidelines-legacy-mYSO8ZN5.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(t,e){"use strict";var a,i,n,s,o,d,l,r,p,u,c,m,h,y,w,f;return{setters:[t=>{a=t.d,i=t.an,n=t.ao,s=t.bj,o=t.H,d=t.B,l=t.aw,r=t.dl,p=t.K,u=t.am,c=t.a,m=t.ar,h=t.b},t=>{y=t.H},t=>{w=t._},t=>{f=t.A},null,null],execute:function(){const e=a({mixins:[w],components:{HisStandardForm:y},data:()=>({appointment:{}}),watch:{ready:{handler(t){t&&(this.appointment=new f(this.patientID,this.providerID),this.fields=[this.getAppointmentField()])},immediate:!0}},methods:{async onFinish(t,e){await this.appointment.createEncounter(),await this.appointment.saveObservationList(await this.resolveObs(e)),["CxCa","ANC"].includes(`${s.getActiveApp()?.applicationName}`)||await p(this.patientID),this.nextTask()},getAppointmentField(){const t=(t,e)=>new RegExp(t,"i").test(`${e}`);let e="",a="",p=-1,u=this.appointment.date,c=null;const m={},h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return{id:"set_appointment",helpText:"Appointments booking",type:n.TT_DATE_PICKER,init:async()=>{try{const t=await this.appointment.getNextAppointment();u=t.appointment_date,c=t.drugs_run_out_date}catch(i){if(console.error(i),!(await l("Next appointment/drug-runout date is not available, do you want to proceed anyway?")))return this.gotoPatientDashboard(),!0}const t=await r.appointmentLimit();return a=await r.clinicHolidays(),e=this.patient.getAge()>=18?await r.adultClinicDays():await r.peadsClinicDays(),p=t?parseInt(t):0,!0},onValue:async i=>{const n=o.toStandardHisDisplayFormat(i),s=d(c).diff(i,"days");if(c&&s>7&&!(await l(`\n              The selected appointment date ${n} is ${s} days earlier than the drug run-out date \n              ${o.toStandardHisDisplayFormat(c)}. \n              The client will have excess medication. \n              Do you want to proceed?\n            `)))return!1;if(m[i]??=(await f.getDailiyAppointments(i)).length,u!==i){if(p>=1&&m[i]>=p&&await l(`${m[i]} clients were booked on ${n}`,{header:`APPOINTMENT LIMIT (${p}) REACHED`,cancelBtnLabel:"Proceed",confirmBtnLabel:"New date"}))return!1;if(t(i,a)&&!(await l(`${n} is a clinic holiday, do you want to set an appointment?`)))return!1;if(!t(h[d(i).day()],e)&&!(await l(`${n} is not a clinic day. Do you want to proceed with this date?`)))return!1}return!0},validation:t=>i.required(t),defaultValue:()=>u,computedValue:t=>[this.appointment.buildValueDate("Appointment date",t),this.appointment.buildValueDate("Estimated date",u)],config:{hiddenFooterBtns:["Clear"],helpText:"The appointment date is the date the patient is scheduled to return for their next visit.<br><br>           The estimated date is the date the patient is scheduled to return based on their current visit interval.<br>           Ensure that the next appointment date at least 2 days before ARVs are finished to allow for the safety buffer.<br>           If the appointment date is not set, the estimated date will be used.",helpTitle:"Appointment Date",minDate:()=>this.appointment.date,maxDate:()=>c,supValue:t=>`${m[t]}`,infoItems:t=>"CxCa"===s.getActiveApp()?.applicationName?[{label:"User set appointment date",value:o.toStandardHisDisplayFormat(t)},{label:"Appointments",value:m[t]},{label:"Appointment limit (per/day)",value:p}]:[{label:"Medication Run out Date",value:c?o.toStandardHisDisplayFormat(c):"Not available"},{label:"User set appointment date",value:o.toStandardHisDisplayFormat(t)},{label:"Appointments",value:m[t]},{label:"Appointment limit (per/day)",value:p}]}}}}});t("default",u(e,[["render",function(t,e,a,i,n,s){const o=m("his-standard-form");return h(),c(o,{fields:t.fields,onFinishAction:t.onFinish,skipSummary:!0,cancelDestinationPath:t.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}]]))}}}));
