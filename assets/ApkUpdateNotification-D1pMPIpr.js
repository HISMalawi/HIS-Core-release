const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-D9bsw2T8.js","assets/index-BlK7Pvm-.js","assets/index-Cpa1Vu_O.js","assets/index-BJIxebzH.css"])))=>i.map(i=>d[i]);
import{bv as D,d as x,r as i,ar as B,t as L,ck as g,u as N,B as M,z as n,a1 as f,Y as E,x as d,w,y as p,a3 as _,cl as K,G as $,ax as F,J as T,M as r,a6 as q,a7 as z,a8 as G}from"./index-Cpa1Vu_O.js";import{r as W,F as c,D as H}from"./index-BlK7Pvm-.js";const J=W("CapacitorAppInstaller",{web:()=>D(()=>import("./web-D9bsw2T8.js"),__vite__mapDeps([0,1,2,3])).then(t=>new t.CapacitorAppInstallerWeb)}),m=t=>(q("data-v-70fe1068"),t=t(),z(),t),O={key:0,id:"update-notification"},R=m(()=>f("br",null,null,-1)),Y=m(()=>f("br",null,null,-1)),j=x({__name:"ApkUpdateNotification",props:{checkInterval:{type:Number,default:36e5}},setup(t){const y=t,s=i(!1),l=i(""),a=i(""),u=new F,v=B(()=>!!a.value&&a.value!="-"&&a.value!==l.value),h=i("");L(b);function b(){g("mobile")&&g("android")&&setInterval(async()=>{v.value||(a.value=await u.getApkVersion(),l.value=u.getHeadVersion())},y.checkInterval)}function k(){a.value=l.value}async function I(){try{if(await P()){s.value=!0,U();const e=await A();if(s.value=!1,!e)throw new Error("Unable to download the app");T("Download completed. Installing the app..."),await V(e),l.value=a.value}}catch(e){s.value=!1,console.error(e),r("Unable to update the app")}}async function P(){try{const{publicStorage:e}=await c.checkPermissions();if(e!=="granted"){const{publicStorage:o}=await c.requestPermissions();if(o!=="granted")return r("Permission to access storage is required to download the app."),!1}return!0}catch(e){return console.error(e),r("Unable to download the app. Please try again later"),!1}}async function A(){try{return(await c.downloadFile({url:await u.getApkDownloadLink(a.value),path:"Download/emr-".concat(a.value,".apk"),directory:H.ExternalStorage,recursive:!0,progress:!0})).path}catch(e){console.error(e),r(e.toString())}}function U(){c.addListener("progress",e=>{const o=Math.round(e.contentLength/1024),C=Math.round(e.bytes/1024),S=Math.round(e.bytes/e.contentLength*100);h.value="Downloading... ".concat(C,"KB / ").concat(o,"KB (").concat(S,"%)")})}async function V(e){try{await J.install({file:e})}catch(o){console.error(o),r("Unable to install the app. Please try again later")}}return(e,o)=>v.value?(N(),M("div",O,[n(" New version ("),f("strong",null,E(a.value),1),n(") update is available "),R,Y,d(p(_),{onClick:I,color:"success"},{default:w(()=>[n(" Download Update ")]),_:1}),n("     "),d(p(_),{onClick:k,color:"danger"},{default:w(()=>[n(" Cancel ")]),_:1}),d(p(K),{"is-open":s.value,message:h.value},null,8,["is-open","message"])])):$("",!0)}}),Z=G(j,[["__scopeId","data-v-70fe1068"]]);export{Z as default};
