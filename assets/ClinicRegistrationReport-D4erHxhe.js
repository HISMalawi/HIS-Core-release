import{O as c}from"./opd_report_service-gCoKwjvt.js";import{R as u}from"./BaseTableReport-D3G2aL5Y.js";import{d as h,I as f,L as i,H as p,S as v,cG as _,_ as g,r as m,o as w,c as y,w as R,b as D}from"./index-L7KBnPzM.js";import{_ as B}from"./ReportMixin.vue_vue_type_script_lang-CdMugi9u.js";import"./Export-DMwHfvYp.js";import"./HisStandardForm-4iY8ramV.js";import"./TouchScreenForm-DLhU6o0i.js";import"./dynamic-import-helper-Bsjrd6Ro.js";import"./ToolbarMediumCard-BO4GFuiT.js";import"./Transformers-BPPLlH12.js";import"./ViewPort--UGxBUFx.js";import"./BasicReportTemplate-BJvPkGk8.js";import"./SIngleTouchField-BYpOdmHo.js";import"./Pagination-DQYhjMaN.js";import"./MultiFieldDateHelper-C5td-0Rz.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";const C=h({components:{ReportTemplate:u,IonPage:f},mixins:[B],data:()=>({title:"Clinic Registration",rows:[],reportData:[],columns:[[i.thTxt("Reg"),i.thTxt("First Name"),i.thTxt("Last Name"),i.thTxt("Gender"),i.thTxt("DOB"),i.thTxt("Date reg.")]],customBtns:[]}),created(){this.fields=this.getDateDurationFields(),this.customBtns.push({name:"High level view",size:"large",slot:"start",color:"primary",visible:!0,onClick:async()=>this.showModal()})},methods:{async init(t,e){const r=new c;r.setStartDate(e.start_date),r.setEndDate(e.end_date),this.period=r.getDateIntervalPeriod();const o=await r.getClinicRegistrations();this.reportData=o.sort((s,a)=>s.visit_type>a.visit_type?1:s.visit_type<a.visit_type?-1:0),this.rows=this.buildRows(this.reportData)},buildRows(t){return t.length?t.map(e=>[i.td(e.visit_type),i.td(e.given_name),i.td(e.family_name),i.td(e.gender),i.td(p.toStandardHisDisplayFormat(e.birthdate)),i.td(p.toStandardHisDisplayFormat(e.visit_date))]):[]},filterBy(t,e){return this.reportData.filter(r=>{const o=p.calculateAge(r.birthdate,v.getSessionDate());return r.visit_type===t&&(e==="under5"?o<=5:o>6)})},modalData(){const t=[...this.filterBy("New patient","under5")].length,e=[...this.filterBy("New patient","over5")].length,r=t+e,o=[...this.filterBy("Referral","under5")].length,s=[...this.filterBy("Referral","over5")].length,a=o+s,n=[...this.filterBy("Revisiting","under5")].length,l=[...this.filterBy("Revisiting","over5")].length,d=n+l;return[{label:"New patient",under5:t,over5:e,value:r},{label:"Referral",under5:o,over5:s,value:a},{label:"Revisiting",under5:n,over5:l,value:d}]},async showModal(){await _([...this.modalData()])}}});function b(t,e,r,o,s,a){const n=m("report-template"),l=m("ion-page");return w(),y(l,null,{default:R(()=>[D(n,{title:t.title,rows:t.rows,fields:t.fields,columns:t.columns,itemsPerPage:10,period:t.period,reportPrefix:"Clinic",onReportConfiguration:t.init,customBtns:t.customBtns,paginated:""},null,8,["title","rows","fields","columns","period","onReportConfiguration","customBtns"])]),_:1})}const V=g(C,[["render",b]]);export{V as default};
