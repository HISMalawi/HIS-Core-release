import{H as T}from"./HisStandardForm-CaDwl-hA.js";import{_ as h}from"./EncounterMixin.vue_vue_type_script_lang-Bfd5amPg.js";import{P as E}from"./patient_complaints_service-D7eZQQJA.js";import{L as D}from"./LabOrderModal-C58uf0w4.js";import{d as g,f as I,l as B,j as k,k as R,i as F,m as V,cC as _,ab as x,O as m,_ as f,r as s,o as y,x as $,b as o,w as n,u as d,F as L,I as A,aT as u,aL as M,H as N,V as H,c as z}from"./index-BCTN_bnC.js";import{P as G}from"./patient_radiology_service-5FG2u3iQ.js";import j from"./HisRadiologyPicker-Bc-tQUF3.js";import{F as c}from"./dynamic-import-helper-BkBZiFw5.js";import"./TouchScreenForm-TKB9q3ZD.js";import"./ToolbarMediumCard-O_J6wu7C.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-BCxYiILf.js";import"./encounter_guidelines-DZpIPlYY.js";import"./GuidelineEngine-D6V1_Znr.js";import"./lab_order_service-0WRc4or6.js";import"./HisKbConfigurations-GhFQZvlg.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKeyboard-COmBOOo8.js";import"./BaseKeyboard-BdU8h7Jm.js";import"./KbHandler-BuQ4TFU6.js";import"./fuse-YdZE3OCN.js";import"./SelectMixin-D-38L_rh.js";import"./BaseTextInput-BVEuzlyj.js";import"./FieldMixin.vue_vue_type_script_lang-BcY4Dt1h.js";const q=g({name:"Modal",components:{IonButton:I,IonContent:B,IonHeader:k,IonTitle:R,IonToolbar:F,IonFooter:V,HisRadiologyPicker:j},mixins:[h],data:()=>({radiologyService:{},isPacsEnabled:!1,emitedSelectedOptions:{}}),watch:{ready:{async handler(e){e&&(this.radiologyService=new G(this.patientID,this.providerID),this.isPacsEnabled=await _.isPACsEnabled())},immediate:!0,deep:!0}},methods:{async onValue(e){this.emitedSelectedOptions=e},async getSelected(){return this.emitedSelectedOptions.map(async e=>({...await this.radiologyService.buildValueCoded("Radiology Orders",e.other.parent),child:[await this.radiologyService.buildValueCodedFromConceptId(e.other.parent,e.other.concept_id)]}))},async onSubmit(){if(!x.isEmpty(this.emitedSelectedOptions)){this.closeModal();let e=await this.getSelected();e=await Promise.all(e),await this.radiologyService.createEncounter();const t=await this.radiologyService.obsObj(e),i=await this.radiologyService.saveObservationList(t);if(await this.radiologyService.printOrders(i,this.patient),this.isPacsEnabled)try{await this.radiologyService.submitToPacs(i,this.patient)}catch(a){console.log(a)}}},async closeModal(){await m.dismiss([])}}});function K(e,t,i,a,b,C){const l=s("ion-title"),r=s("ion-toolbar"),S=s("ion-header"),v=s("his-radiology-picker"),w=s("ion-content"),p=s("ion-button"),P=s("ion-footer");return y(),$(L,null,[o(S,null,{default:n(()=>[o(r,null,{default:n(()=>[o(l,{class:"his-lg-text"},{default:n(()=>[d("Radiology Examination")]),_:1})]),_:1})]),_:1}),o(w,{style:{overflow:"hidden",background:"grey",height:"70vh"}},{default:n(()=>[o(v,{onOnValue:e.onValue},null,8,["onOnValue"])]),_:1}),o(P,null,{default:n(()=>[o(r,null,{default:n(()=>[o(p,{onClick:t[0]||(t[0]=O=>e.onSubmit()),size:"large",slot:"end",disabled:e.emitedSelectedOptions.length===0},{default:n(()=>[d(" Place orders ")]),_:1},8,["disabled"]),o(p,{onClick:t[1]||(t[1]=O=>e.closeModal()),size:"large",slot:"start",color:"danger"},{default:n(()=>[d(" Close ")]),_:1})]),_:1})]),_:1})],64)}const U=f(q,[["render",K]]),W=g({components:{HisStandardForm:T,IonPage:A},mixins:[h],data:()=>({complaintsService:{},todaysDate:u.getSessionDate(),presentingComplaints:"",isPacsEnabled:!1,radiologyBtnName:"Radiology Order",hasTriageComplaints:!1}),watch:{ready:{async handler(e){e&&(this.complaintsService=new E(this.patientID,this.providerID),this.isPacsEnabled=await _.isPACsEnabled(),this.hasTriageComplaints=await this.getTriagePresentingComplaints(),this.fields=this.getFields())},immediate:!0,deep:!0}},methods:{async onSubmit(e,t){const i=await Promise.all(t.complaints);await this.complaintsService.createEncounter(),await this.complaintsService.saveObservationList(i),this.nextTask()},async launchOrderSelection(){const e=await m.create({component:D,backdropDismiss:!1,cssClass:"large-modal"});e.present(),await e.onDidDismiss()},async launchRadiologyOrderSelection(){const e=await m.create({component:U,backdropDismiss:!1,cssClass:"large-modal"});e.present(),await e.onDidDismiss()},async getTriagePresentingComplaints(){if(!((await this.complaintsService.fetchLatestTriageEncounter()).length>0))return!1;const i=(await M.getEncounters(this.patientID,this.todaysDate)).filter(function(a){return a.type.name=="TRIAGE PRESENTING COMPLAINTS"&&N.toStandardHisFormat(a.encounter_datetime)==u.getSessionDate()});return i.length>0?(this.presentingComplaints=i[0].observations,!0):!1},buildResults(){const e=["Group","Presenting complaints"];let t="",i=this.presentingComplaints.map(a=>{if(a.obs_group_id!=null)return[t,a.value_text];t=a.value_text});return i=i.filter(a=>a!=null),this.presentingComplaints=i,[{label:"",value:"",other:{columns:e,rows:i}}]},getFields(){return[{id:"triage_complaints",helpText:"Triaging Complaints",condition:()=>this.hasTriageComplaints,type:c.TT_TABLE_VIEWER,options:()=>this.buildResults(),config:{hiddenFooterBtns:["Clear"]}},{id:"complaints",helpText:"Presenting Complaints",type:c.TT_COMPLAINTS_PICKER,validation:e=>H.required(e),computedValue:e=>e.map(async t=>({...await this.complaintsService.buildValueCoded("Presenting complaint",t.other.parent),child:[await this.complaintsService.buildValueCodedFromConceptId(t.other.parent,t.other.concept_id)]})),config:{hiddenFooterBtns:[this.showRadiologyOdersBtn(),this.disableBackBtn()],footerBtns:[{name:"Lab Order",size:"large",slot:"end",color:"primary",visible:!0,onClick:async()=>await this.launchOrderSelection(),visibleOnStateChange:e=>e.index===1},{name:this.radiologyBtnName,size:"large",slot:"end",color:"primary",visible:!0,onClick:async()=>await this.launchRadiologyOrderSelection(),visibleOnStateChange:e=>e.index===1}]}},{id:"all_presenting_complaints",helpText:"Summary",condition:()=>this.presentingComplaints.length>0,type:c.TT_SUMMARY,options:e=>this.buildSummaryResults(e),config:{hiddenFooterBtns:["Clear"]}}]},showRadiologyOdersBtn(){return this.isPacsEnabled?"":this.radiologyBtnName},buildSummaryResults(e){const t=e.complaints.map(a=>({label:"OPD Complaints",value:a.label})),i=this.presentingComplaints.map(a=>({label:"Triaging Complaints",value:a[1]}));return t.concat(i)},disableBackBtn(){return this.hasTriageComplaints?"":"Back"}}});function Y(e,t,i,a,b,C){const l=s("his-standard-form"),r=s("ion-page");return y(),z(r,null,{default:n(()=>[o(l,{cancelDestinationPath:e.cancelDestination,fields:e.fields,onFinishAction:e.onSubmit,skipSummary:!0},null,8,["cancelDestinationPath","fields","onFinishAction"])]),_:1})}const Ce=f(W,[["render",Y]]);export{Ce as default};
