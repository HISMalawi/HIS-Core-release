System.register(["./ReportErrors-legacy-Bt2Xzdaw.js","./index-legacy-Dzpo3D2H.js","./TableView-legacy-B6bff1Ek.js","./v2utils-legacy-BJqTd-vI.js","./tx_report_service-legacy-DW7zaQpJ.js","./moh_cohort_service-legacy-BmWuVm2Q.js","./Export-legacy-BArZx6zo.js","./index-legacy-CiuX4ELR.js"],(function(e,t){"use strict";var a,n,o,r,l,i,s,c,g,u,d,p,h,m,v,f,b,_,y,D,x,A,M,R,F,w,j;return{setters:[e=>{a=e.R},e=>{n=e.d,o=e.a5,r=e.cm,l=e.r,i=e.t,s=e.aH,c=e.ad,g=e.O,u=e.aJ,d=e.c$,p=e.d2,h=e.ah,m=e.d1,v=e.cP,f=e.aq,b=e.d3,_=e.a6,y=e.v,D=e.w,x=e.ab,A=e.u,M=e.x},e=>{R=e.v},e=>{F=e.A},e=>{w=e.T},e=>{j=e.M},null,null],execute:function(){const t=n({components:{IonPage:o,IonLoading:r,v2Datatable:R},setup(){const e=l([]),t=l(""),n=l(""),o=l(!1),r=new w,_=new j,y=l([]),D=async e=>{(await f.create({component:F,backdropDismiss:!1,cssClass:"large-modal",componentProps:{...e,subtitle:t.value,onFinish:()=>f.getTop().then((e=>e&&f.dismiss()))}})).present()},x=(e,t)=>({ref:t,label:e,defaultValue:"0",toValue:e=>e.length,tdClick:async e=>{e.refData.length&&D({patientIdentifiers:e.refData,title:`${e.data.age_group} ${e.data.gender} ${e.column.label}`})}}),A=[[{label:"#",ref:"index"},{label:"Age group",ref:"age_group"},{label:"Gender",ref:"gender"},x("# of clients on <3 months of ARVs","less_than_three_months"),x("# of clients on 3 - 5 months of ARVs","three_to_five_months"),x("# of clients on >= 6 months of ARVs","greater_than_six_months")]],M=function(e){const t=y.value.findIndex((t=>t.id===e.id));-1!==t?y.value[t]=e:y.value.push(e)},R=async function(e){const t="validation";(await f.create({id:t,component:a,backdropDismiss:!1,cssClass:"large-modal",componentProps:{errors:e}})).present(),M({id:t,text:`<b>${e.length}</b> validation errors detected`,icon:b,color:"danger",action:()=>R(e)})},P=async(t=!1)=>{if(!r.startDate||!r.endDate)return g("Start date and end date required!");o.value=!0;try{y.value=[],e.value=[];const a=await r.getTxCurrMMDReport(t,"moh"),n=Object.keys(a).reduce(((e,t)=>{const n=a[t];return["Male","Female"].forEach((a=>{const o={gender:a,age_group:t};Object.keys(n[a]).forEach((t=>{o[t]=n[a][t],e.totalAlive=[...e.totalAlive,...o[t]],e.aggregate[a][t]=[...e.aggregate[a][t]||[],...o[t]]})),e[a].push(o)})),e}),{Male:[],Female:[],totalAlive:[],aggregate:{Male:{},Female:{}}});e.value=[...n.Female,...n.Male,{age_group:"All",gender:"Male",...n.aggregate.Male}];const o=Object.values(n.aggregate.Female).reduce(((e,t)=>e.concat(t)),[]),l=await r.getMaternalStatus(u.uniq(o)),i=l.FBf.concat(l.FP);["FP","FNP","FBf"].forEach((t=>{e.value.push(Object.keys(n.aggregate.Female).reduce(((e,a)=>({...e,[a]:n.aggregate.Female[a].filter((e=>"FNP"===t?!i.includes(e):l[t].includes(e)))})),{age_group:"All",gender:t}))})),e.value=e.value.map(((e,t)=>({index:t+1,...e}))),y.value=[{text:`Total alive and on ART: <b>${n.totalAlive.length}</b>`,icon:d,color:"primary",action:()=>D({patientIdentifiers:n.totalAlive,title:`Total alive and on ART: ${n.totalAlive.length}`})}],-1===_.validateIndicators({total_alive_and_on_art:{param:n.totalAlive.length,check:(e,t)=>t>e,error:(e,t)=>`\n                            MoH cohort Alive and on ART clients <b>(${e})</b> is not\n                            matching with total TX MMD clients <b>(${t})</b>.\n                        `}},(e=>{e.length?R(e):M({id:"validation",text:"<b>Report is consistent</b>",icon:p,color:"success"})}))&&R(["Report not validated. Run the MoH cohort report for similar reporting period and then run this report"])}catch(a){const e="Unable to generate report!";h(e),y.value=[{text:e,color:"danger",icon:m,action:function(){console.log(a),y.value=[{text:`Exception occured: <b>${a}</b>`,color:"danger",icon:m}]}}]}o.value=!1,n.value=""},T=(e=!1)=>v({onFinish:(a,n,o,l)=>{t.value=o,r.startDate=a,r.endDate=n,r.setQuarter("moh"),_.setStartDate(a),_.setEndDate(n),l&&(_.setOccupation(l),r.setOccupation(l)),P(e)}});return i((()=>T())),{Img:s,onRegenerate:async()=>P(await c("Do you want to rebuild report?")),headerBadge:y,reportData:e,isLoading:o,configure:T,generate:P,columns:A,period:t}}});e("default",_(t,[["render",function(e,t,a,n,o,r){const l=x("ion-loading"),i=x("v2Datatable"),s=x("ion-page");return A(),y(s,null,{default:D((()=>[M(l,{"is-open":e.isLoading,message:"Please wait.."},null,8,["is-open"]),M(i,{"icon-url":e.Img("login-logos/Malawi-Coat_of_arms_of_arms.png"),title:"TX Curr MMD Report","report-prefix":"MOH",subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRegenerate,headerBadge:e.headerBadge},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh","headerBadge"])])),_:1})}]]))}}}));
