import{d as v,I as z,e as H,f as S,g as L,h as U,i as F,j as T,k as x,l as M,m as R,n as f,t as _,p as k,P as I,H as j,q as C,s as q,_ as G,r as a,o as l,c,w as n,b as s,u as r,v as d,x as O,y as W,z as p,A as m,B as J}from"./index-CikWdthK.js";const K=v({components:{IonPage:z,IonCheckbox:H,IonButton:S,IonList:L,IonItem:U,IonToolbar:F,IonHeader:T,IonTitle:x,IonContent:M,IonFooter:R},data:()=>({dde:{},ddeEnabled:!1,items:[],title:"",npid:""}),watch:{$route:{handler({params:e}){e&&(this.npid=e.npid,this.title="Duplicates for NPID (".concat(this.npid,")"),this.init(this.npid))},deep:!0,immediate:!0}},computed:{itemsChecked(){return this.items.filter(e=>e.isChecked)}},methods:{async onAction(e,i="proceed"){if(await f("\n                Are you sure you want to ".concat(i,"?\n            ")))try{await e()}catch(h){_("".concat(h)),console.error(h)}},async mergeSelected(){if(!this.itemsChecked.every(e=>e.isComplete))return _("One or more patients have missing data. Please update them before merging.",5e3);await this.dde.postMerge(this.itemsChecked)&&(await this.dde.printNpid(this.dde.patientID),k(this.dde.patientID,this.$router))},async reassignIdentifier(e){if(!e.isComplete&&this.ddeEnabled){if(await f("Do you want to update missing information?",{header:"Incomplete Demographics"})){let t="edit_person=".concat(e.patientID);t+="&dde_reassign=true",t+="&doc_id=".concat(e.docID),this.$router.push("/patient/registration?".concat(t))}}else this.onAction(async()=>{this.ddeEnabled?await this.dde.reassignNpid(e.docID,e.patientID)&&await this.dde.printNpid(e.patientID):typeof e.assignLocalNpidAndPrint=="function"&&await e.assignLocalNpidAndPrint(),k(e.patientID,this.$router)},"Reassign")},buildItems(e){return e.map(i=>{try{const t=new I(i);return{isChecked:!1,patientID:t.getID(),name:t.getFullName(),gender:t.getGender(),birthdate:j.toStandardHisDisplayFormat(t.getBirthdate()),curDistrict:t.getCurrentDistrict(),homeVillage:t.getHomeVillage(),docID:t.getPatientIdentifier(27),isComplete:t.patientIsComplete(),assignLocalNpidAndPrint:async()=>{await t.assignNpid(),await t.printNationalID()}}}catch(t){C("An error has occured while building data"),console.error(t)}return{isChecked:!1,patientID:"N/A",name:"N/A",gender:"N/A",birthdate:"N/A",curDistrict:"N/A",homeVillage:"N/A",docID:"N/A",isComplete:!1}})},clear(){this.items=this.items.map(e=>(e.isChecked=!1,e))},async init(e){try{if(this.dde=new q,await this.dde.loadDDEStatus(),this.ddeEnabled=this.dde.isEnabled(),this.ddeEnabled){const{locals:i,remotes:t}=await this.dde.findNpid(e);this.items=[...this.buildItems(i),...this.buildItems(t)]}else{const i=await I.findByNpid(e);i&&(this.items=this.buildItems(i))}}catch(i){C("".concat(i),5e3)}}}}),Q=m("br",null,null,-1);function X(e,i,t,h,Y,Z){const D=a("ion-title"),g=a("ion-toolbar"),b=a("ion-header"),w=a("ion-checkbox"),y=a("ion-label"),u=a("ion-button"),N=a("ion-item"),A=a("ion-list"),$=a("ion-content"),V=a("ion-footer"),E=a("ion-page");return l(),c(E,null,{default:n(()=>[s(b,null,{default:n(()=>[s(g,null,{default:n(()=>[s(D,{class:"his-lg-text"},{default:n(()=>[r(d(e.title),1)]),_:1})]),_:1})]),_:1}),s($,null,{default:n(()=>[s(A,null,{default:n(()=>[(l(!0),O(J,null,W(e.items,(o,P)=>(l(),c(N,{class:"his-md-text",key:P},{default:n(()=>[e.ddeEnabled?(l(),c(w,{key:0,slot:"start",modelValue:o.isChecked,"onUpdate:modelValue":B=>o.isChecked=B},null,8,["modelValue","onUpdate:modelValue"])):p("",!0),s(y,{color:o.isComplete?"":"danger"},{default:n(()=>[r(d(o.name)+" ("+d(o.gender)+") "+d(o.birthdate)+" ",1),Q,r(" Current District: "),m("b",null,d(o.curDistrict||"Unknown"),1),r(" Home Village: "),m("b",null,d(o.homeVillage||"Unknown"),1)]),_:2},1032,["color"]),s(u,{size:"medium",onClick:()=>e.reassignIdentifier(o)},{default:n(()=>[r(" Re-Assign ")]),_:2},1032,["onClick"]),o.isComplete?p("",!0):(l(),c(u,{key:1,size:"medium",color:"warning","router-link":"/patient/registration?edit_person=".concat(o.patientID)},{default:n(()=>[r(" Update Missing Data ")]),_:2},1032,["router-link"]))]),_:2},1024))),128))]),_:1})]),_:1}),s(V,null,{default:n(()=>[s(g,{color:"dark"},{default:n(()=>[s(u,{"router-link":"/",color:"danger",slot:"start",size:"large"},{default:n(()=>[r(" Cancel ")]),_:1}),e.itemsChecked.length>0?(l(),c(u,{key:0,onClick:e.clear,color:"warning",slot:"end",size:"large"},{default:n(()=>[r(" Clear ")]),_:1},8,["onClick"])):p("",!0),e.itemsChecked.length>1?(l(),c(u,{key:1,onClick:i[0]||(i[0]=o=>e.onAction(e.mergeSelected,"merge")),color:"primary",size:"large",slot:"end"},{default:n(()=>[r(" Merge ("+d(e.itemsChecked.length)+") ",1)]),_:1})):p("",!0)]),_:1})]),_:1})]),_:1})}const te=G(K,[["render",X]]);export{te as default};
