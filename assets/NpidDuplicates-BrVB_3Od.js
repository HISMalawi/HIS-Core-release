import{d as B,l as H,I as S,a5 as z,a4 as L,m as U,a7 as F,ag as T,k as M,ar as x,n as R,as as j,at as f,y as k,H as G,au as I,av as C,s as _,ak as O,ap as o,a as c,b as l,w as i,e as s,j as r,t as d,h as W,a9 as q,aa as J,a6 as p,g as h}from"./index-Ds0zDBhU.js";const K=B({components:{IonPage:R,IonCheckbox:x,IonButton:M,IonList:T,IonItem:F,IonToolbar:U,IonHeader:L,IonTitle:z,IonContent:S,IonFooter:H},data:()=>({dde:{},ddeEnabled:!1,items:[],title:"",npid:""}),watch:{$route:{handler({params:e}){e&&(this.npid=e.npid,this.title="Duplicates for NPID (".concat(this.npid,")"),this.init(this.npid))},deep:!0,immediate:!0}},computed:{itemsChecked(){return this.items.filter(e=>e.isChecked)}},methods:{async onAction(e,t="proceed"){if(await I("\n                Are you sure you want to ".concat(t,"?\n            ")))try{await e()}catch(m){_("".concat(m)),console.error(m)}},async mergeSelected(){if(!this.itemsChecked.every(e=>e.isComplete))return _("One or more patients have missing data. Please update them before merging.",5e3);await this.dde.postMerge(this.itemsChecked)&&(await this.dde.printNpid(this.dde.patientID),C(this.dde.patientID,this.$router))},async reassignIdentifier(e){if(!e.isComplete&&this.ddeEnabled){if(await I("Do you want to update missing information?",{header:"Incomplete Demographics"})){let n="edit_person=".concat(e.patientID);n+="&dde_reassign=true",n+="&doc_id=".concat(e.docID),this.$router.push("/patient/registration?".concat(n))}}else this.onAction(async()=>{this.ddeEnabled?await this.dde.reassignNpid(e.docID,e.patientID)&&await this.dde.printNpid(e.patientID):typeof e.assignLocalNpidAndPrint=="function"&&await e.assignLocalNpidAndPrint(),C(e.patientID,this.$router)},"Reassign")},buildItems(e){return e.map(t=>{try{const n=new f(t);return{isChecked:!1,patientID:n.getID(),name:n.getFullName(),gender:n.getGender(),birthdate:G.toStandardHisDisplayFormat(n.getBirthdate()),curDistrict:n.getCurrentDistrict(),homeVillage:n.getHomeVillage(),docID:n.getPatientIdentifier(27),isComplete:n.patientIsComplete(),assignLocalNpidAndPrint:async()=>{await n.assignNpid(),await n.printNationalID()}}}catch(n){k("An error has occured while building data"),console.error(n)}return{isChecked:!1,patientID:"N/A",name:"N/A",gender:"N/A",birthdate:"N/A",curDistrict:"N/A",homeVillage:"N/A",docID:"N/A",isComplete:!1}})},clear(){this.items=this.items.map(e=>(e.isChecked=!1,e))},async init(e){try{if(this.dde=new j,await this.dde.loadDDEStatus(),this.ddeEnabled=this.dde.isEnabled(),this.ddeEnabled){const{locals:t,remotes:n}=await this.dde.findNpid(e);this.items=[...this.buildItems(t),...this.buildItems(n)]}else{const t=await f.findByNpid(e);t&&(this.items=this.buildItems(t))}}catch(t){k("".concat(t),5e3)}}}});function Q(e,t,n,m,X,Y){const D=o("ion-title"),g=o("ion-toolbar"),b=o("ion-header"),w=o("ion-checkbox"),y=o("ion-label"),u=o("ion-button"),N=o("ion-item"),$=o("ion-list"),A=o("ion-content"),V=o("ion-footer"),E=o("ion-page");return l(),c(E,null,{default:i(()=>[s(b,null,{default:i(()=>[s(g,null,{default:i(()=>[s(D,{class:"his-lg-text"},{default:i(()=>[r(d(e.title),1)]),_:1})]),_:1})]),_:1}),s(A,null,{default:i(()=>[s($,null,{default:i(()=>[(l(!0),W(q,null,J(e.items,(a,P)=>(l(),c(N,{class:"his-md-text",key:P},{default:i(()=>[e.ddeEnabled?(l(),c(w,{key:0,slot:"start",modelValue:a.isChecked,"onUpdate:modelValue":v=>a.isChecked=v},null,8,["modelValue","onUpdate:modelValue"])):p("",!0),s(y,{color:a.isComplete?"":"danger"},{default:i(()=>[r(d(a.name)+" ("+d(a.gender)+") "+d(a.birthdate)+" ",1),t[1]||(t[1]=h("br",null,null,-1)),t[2]||(t[2]=r(" Current District: ",-1)),h("b",null,d(a.curDistrict||"Unknown"),1),t[3]||(t[3]=r(" Home Village: ",-1)),h("b",null,d(a.homeVillage||"Unknown"),1)]),_:2},1032,["color"]),s(u,{size:"medium",onClick:()=>e.reassignIdentifier(a)},{default:i(()=>[...t[4]||(t[4]=[r(" Re-Assign ",-1)])]),_:1},8,["onClick"]),a.isComplete?p("",!0):(l(),c(u,{key:1,size:"medium",color:"warning","router-link":"/patient/registration?edit_person=".concat(a.patientID)},{default:i(()=>[...t[5]||(t[5]=[r(" Update Missing Data ",-1)])]),_:1},8,["router-link"]))]),_:2},1024))),128))]),_:1})]),_:1}),s(V,null,{default:i(()=>[s(g,{color:"dark"},{default:i(()=>[s(u,{"router-link":"/",color:"danger",slot:"start",size:"large"},{default:i(()=>[...t[6]||(t[6]=[r(" Cancel ",-1)])]),_:1}),e.itemsChecked.length>0?(l(),c(u,{key:0,onClick:e.clear,color:"warning",slot:"end",size:"large"},{default:i(()=>[...t[7]||(t[7]=[r(" Clear ",-1)])]),_:1},8,["onClick"])):p("",!0),e.itemsChecked.length>1?(l(),c(u,{key:1,onClick:t[0]||(t[0]=a=>e.onAction(e.mergeSelected,"merge")),color:"primary",size:"large",slot:"end"},{default:i(()=>[r(" Merge ("+d(e.itemsChecked.length)+") ",1)]),_:1})):p("",!0)]),_:1})]),_:1})]),_:1})}const ee=O(K,[["render",Q]]);export{ee as default};
