System.register(["./index-legacy-Dg5P6bX-.js","./dynamic-import-helper-legacy-arUa2LZV.js","./util-legacy-CjANJSja.js","./HisStandardForm-legacy-BXV61qjj.js","./useEncounter-legacy-Bp6E5sCN.js","./commons-legacy-CiEua9CM.js","./identifier_service-legacy-_ZM-WDy-.js","./TouchScreenForm-legacy-Bqug27CT.js","./ToolbarMediumCard-legacy-DWokgyDV.js","./Transformers-legacy-DhNYVLaS.js","./ViewPort-legacy-D3j1oaCn.js","./isEmpty-legacy-rdjCNuhy.js","./_Set-legacy-BL8ow4HL.js","./_setToArray-legacy-jEwcQpqP.js","./encounter_guidelines-legacy-mRSBdMQj.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var n,a,i,r,l,u,s,c,o,d,p,y,m,T,g,b,v,I,_,f,$,B,N,x,D,E,j,w,P;return{setters:[e=>{n=e.d,a=e.aJ,i=e.K,r=e.b5,l=e.cV,u=e.E,s=e.c_,c=e.aI,o=e.cX,d=e.ad,p=e.cb,y=e.ab,m=e.t,T=e.V,g=e.o,b=e.c,v=e.w,I=e.b,_=e.cl,f=e.c$,$=e.R,B=e.I},e=>{N=e.F},e=>{x=e.g},e=>{D=e.H},e=>{E=e.u},e=>{j=e.m,w=e.r},e=>{P=e.I},null,null,null,null,null,null,null,null,null],execute:function(){e("default",n({__name:"Registration",setup(e){const t=a.getActiveApp(),n=i([]),R=new r(-1,l.TB_REGISTRATION),h=new P,A=i(),M=i(""),q=u();function U(e){const[t,n]=`${e}`.split("/");if(n)return`${M.value}${t}/${n}`;const[a]=`${R.date}`.split("-");return`${M.value}${t}/${a.trim()}`}const S={"Multi drug resistance treatment":{type:s.MDR,label:"Patient DR TB Number",indexID:"DR TB Number",concept:"MDR_NUMBER"},"Tuberculosis Preventive Treatment (TPT)":{type:s.IPT,label:"Patient IPT Number",indexID:"IPT Number",concept:"TB_NUMBER"},"Currently in treatment":{type:s.TB,label:"Patient TB Number",indexID:"TB Number",concept:"TB_NUMBER"},DEFAULT:{type:s.TB,label:"Patient TB Number",indexID:"TB Number",concept:"TB_NUMBER"}},{goToNextTask:C,patientDashboardUrl:F,patientId:V}=E(((e,a,i,r)=>{R.patientID=a,R.providerID=e,n.value=[(()=>{let e={};const t=Object.values(S).find((e=>e.indexID===q.query.type));return{id:"reassign",helpText:`Reassign ${q.query.type}: ${q.query.id}`,proxyID:"patientIdentifier",type:N.TT_NUMBER,init:async()=>{e=await c.getProgramInformation(a),!q.query.id&&o.isOnTreatment(e.current_outcome)&&`${e.tb_number}`.split("/").length>0&&await d("Caution!",`Client is currently using program number ${e.tb_number}`,`Current outcome is ${e.current_outcome} updated on ${p(e.current_outcome_date)}`,[{name:"Ok",color:"primary",slot:"start"}]);const[n,i]=`${q.query.id}`.split("/");return h.setIdentifierType(t?.type),M.value=`${n}/${i}/`,!0},beforeNext:async e=>{const t=U(`${e.value}`),n=await h.getPatientsByIdentifier(t);return!!y.isEmpty(n)||(m(`${t} is already in use!!`),!1)},computedValue:e=>({obs_datetime:R.date,value_text:U(`${e.value}`),concept_id:x(t?.concept)}),condition:()=>q.query.reassign,validation:e=>T.required(e)}})(),{id:"new",helpText:"Identifier:",proxyID:"patientIdentifier",type:N.TT_NUMBER,init:async()=>(S[r.outcome]?A.value=S[r.outcome]:A.value=S.DEFAULT,h.setIdentifierType(A.value?.type),M.value=await(t.programPatientIdentifiers[A.value?.indexID]?.prefix()),!0),beforeNext:async e=>{const t=U(`${e.value}`),n=await h.getPatientsByIdentifier(t);return!!y.isEmpty(n)||(m(`${t} is already in use!!`),!1)},computedValue:e=>({obs_datetime:R.date,value_text:U(`${e.value}`),concept_id:x(A.value?.concept)}),condition:e=>!e.reassign?.value,validation:e=>T.required(e),dynamicHelpText:()=>A.value?.label},{id:"idSummary",helpText:"Identifier",type:N.TT_TEXT_BANNER,options:e=>j([`${A.value?.label}: <br/> <b>${U(e.patientIdentifier.value)}</b>`])}]}));async function O(e,t){await R.createEncounter(),await R.saveObservationList(await w(t)),e.new?await f.create(V.value,h.identifierType,U(e.patientIdentifier.value)):await f.update(parseInt(`${q.query.reassign}`),U(e.patientIdentifier.value)),await o.printTBNumber(R.patientID),$.invalidate("ACTIVE_PATIENT"),C()}return(e,t)=>(g(),b(_(B),null,{default:v((()=>[I(D,{cancelDestinationPath:_(F),onFinishAction:O,fields:n.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
