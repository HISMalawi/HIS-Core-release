import{d as $,aq as V,as as A,ar as G,I as q,k as M,j as O,i as P,l as U,m as j,f as H,al as R,h as W,D as X,C as J,K as w,M as Q,N as Y,S as Z,dG as T,F as S,n as k,t as ee,U as oe,ao as te,q as ae,_ as ne,r as n,o as D,c as b,w as t,b as a,A as i,v,x as re,y as le,az as I,u,z as se,B as ie}from"./index-BFVcutZq.js";import{T as ce}from"./testKits-3Uv8EKdG.js";const ue=$({components:{IonGrid:V,IonCol:A,IonRow:G,IonPage:q,IonTitle:M,IonHeader:O,IonToolbar:P,IonContent:U,IonFooter:j,IonButton:H,BarcodeInput:R,IonItem:W,IonLabel:X,IonText:J},setup(){const{kits:o,initKits:g,saveKits:C}=ce(),c=w(),d=w(!1),x=Q(()=>o.value.some(e=>!e.lotNo&&e.expiryDate||!e.expiryDate&&e.lotNo||o.value.some(l=>l.expiryDateError))),p=()=>{o.value.forEach(e=>(e.expiryDate&&new Date(e.expiryDate)<=new Date(Z.getSessionDate())?e.expiryDateError="Kit has expired!!":e.expiryDateError="",e))};function _(e){T({id:"lot",helpText:o.value[e].kitName+" Lot No.",type:S.TT_TEXT,defaultValue:()=>o.value[e].lotNo},l=>{const m=(l==null?void 0:l.value)||"";o.value[e].lotNo=m})}function h(e){T({id:"expiry",helpText:o.value[e].kitName+" Expiry Date",type:S.TT_FULL_DATE,defaultValue:()=>o.value[e].expiryDate},l=>{const m=(l==null?void 0:l.value)||"";o.value[e].expiryDate=m,p()})}function N(e){o.value[c.value].lotNo=e,o.value[c.value].expiryDate||h(c.value)}async function s(){await k("Are you sure you want to clear everything?")&&(o.value.forEach(e=>{e.expiryDate="",e.lotNo="",e.expiryDateError=""}),c.value=null)}async function f(){if(p(),x.value)return ee("Some kits have errors! please fix them below");if(!(o.value.every(e=>!(e.lotNo&&e.expiryDate))&&!await k("Do you want to continue without updating test kits?"))){d.value=!1;try{return await C(),oe("Testkits updated!"),te.back()}catch(e){console.error("".concat(e)),ae("General error has occured!")}d.value=!0}}return Y(()=>g().then(()=>{p(),d.value=!0})),{kits:o,activeIndex:c,hasErrors:x,canFinish:d,save:f,onScan:N,updateLot:_,updateExpiryDate:h,clear:s}}}),de={class:"his-card"};function pe(o,g,C,c,d,x){const p=n("ion-title"),_=n("ion-toolbar"),h=n("barcode-input"),N=n("ion-header"),s=n("ion-label"),f=n("ion-item"),e=n("ion-col"),l=n("ion-text"),m=n("ion-row"),z=n("ion-grid"),F=n("ion-content"),E=n("ion-button"),K=n("ion-footer"),L=n("ion-page");return D(),b(L,null,{default:t(()=>[a(N,null,{default:t(()=>[a(_,{color:"light"},{default:t(()=>[a(p,{class:"ion-text-center his-md-text"},{default:t(()=>{var r;return[i("b",null,v(((r=o.kits[o.activeIndex])==null?void 0:r.kitName)||"-"),1)]}),_:1})]),_:1}),a(_,null,{default:t(()=>[a(h,{style:{margin:"0px auto",width:"90%"},onOnScan:o.onScan},null,8,["onOnScan"])]),_:1})]),_:1}),a(F,null,{default:t(()=>[a(z,null,{default:t(()=>[(D(!0),re(ie,null,le(o.kits,(r,y)=>(D(),b(m,{onClick:()=>o.activeIndex=y,class:I(o.activeIndex===y?"his-card active":""),key:y},{default:t(()=>[a(e,{size:"4"},{default:t(()=>[i("div",de,[a(f,{lines:"none"},{default:t(()=>[a(s,null,{default:t(()=>[u(" Kit name ")]),_:1}),a(s,{slot:"end"},{default:t(()=>[i("b",null,v(r.kitName),1)]),_:2},1024)]),_:2},1024)])]),_:2},1024),a(e,{size:"4"},{default:t(()=>[i("div",{class:I(["his-card",r.expiryDate&&!r.lotNo?"error":""])},[a(f,{onClick:B=>o.updateLot(y),lines:"none"},{default:t(()=>[a(s,null,{default:t(()=>[u(" Lot No. ")]),_:1}),a(s,{slot:"end"},{default:t(()=>[i("b",null,v(r.lotNo),1)]),_:2},1024)]),_:2},1032,["onClick"])],2)]),_:2},1024),a(e,{size:"4"},{default:t(()=>[i("div",{class:I(["his-card",!r.expiryDate&&r.lotNo?"error":""])},[a(f,{onClick:B=>o.updateExpiryDate(y),lines:"none"},{default:t(()=>[a(s,null,{default:t(()=>[u(" Expiry Date ")]),_:1}),a(s,{color:r.expiryDateError?"danger":"",slot:"end"},{default:t(()=>[i("b",null,v(r.expiryDate),1)]),_:2},1032,["color"])]),_:2},1032,["onClick"]),r.expiryDateError?(D(),b(l,{key:0,color:"danger",class:"ion-text-center"},{default:t(()=>[u(v(r.expiryDateError),1)]),_:2},1024)):se("",!0)],2)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1})]),_:1}),a(K,null,{default:t(()=>[a(_,{color:"light"},{default:t(()=>[a(E,{onClick:o.clear,slot:"end",color:"warning",size:"large"},{default:t(()=>[u(" Clear ")]),_:1},8,["onClick"]),a(E,{onClick:o.save,disabled:!o.canFinish||o.hasErrors,slot:"end",color:"success",size:"large"},{default:t(()=>[u(" Finish ")]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1})}const me=ne(ue,[["render",pe],["__scopeId","data-v-d37657b0"]]);export{me as default};
