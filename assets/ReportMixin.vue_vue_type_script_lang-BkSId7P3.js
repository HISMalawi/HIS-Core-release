import{d as T,ag as c,aV as f,ao as a,aq as d,a9 as u,aa as D,bG as p,aj as y,aX as w,af as h}from"./index-BMVUUxuO.js";import{D as g}from"./BasicReportTemplate-h_wX6S5T.js";const P=T({data:()=>({fields:[],report:{},reportReady:!1,period:"",startDate:"",endDate:"",customFileName:"",drillDownCache:{}}),methods:{toDate(t){return c.toStandardHisDisplayFormat(t)},confirmPatient(t){return this.$router.push("/patients/confirm?person_id=".concat(t))},async exportToCustomPDF(t){const n=open("","","width:1024px, height:768px"),e=document.getElementById("report-content");e&&n&&(n.document.write("\n                    <html>\n                    <head>\n                        <title>".concat(t,'</title>\n                        <link rel="stylesheet" media="print" href="/assets/css/cohort.css" />\n                    </head>\n                    <body>\n                        ').concat(e.innerHTML,"\n                    </body>\n                    </html>\n                ")),setTimeout(()=>{n.print(),n.close()},3500))},async onDrillDown(t,n){if(f.isEmpty(n))return;const e=[[a.thTxt("First name"),a.thTxt("Last name"),a.thTxt("Gender"),a.thTxt("Age"),a.thTxt("Phone"),a.thTxt("Address"),a.thTxt("Action")]],i=async l=>await Promise.all(l.map(async r=>{const o=await h.findByID(r),s=new h(o);return[a.td(s.getGivenName()),a.td(s.getFamilyName()),a.td(s.getGender()),a.td(s.getAge()),a.td(s.getPhoneNumber()),a.td("".concat(s.getCurrentDistrict(),", ").concat(s.getCurrentVillage(),", ").concat(s.getClosestLandmark())),a.tdBtn("Select",async()=>{await d.dismiss({}),this.$router.push({path:"/patient/dashboard/".concat(r)})})]}));return this.drilldownData(t,e,n,i)},async drilldownAsyncRows(t,n,e){(await d.create({component:g,cssClass:"large-modal",componentProps:{title:t,columns:n,asyncRows:e,showFilters:!0,rowsPerPage:50,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>d.dismiss()}})).present()},async drilldownData(t,n,e,i){(await d.create({component:g,cssClass:"large-modal",componentProps:{title:t,columns:n,rows:e,rowParser:i,rowsPerPage:50,showFilters:!0,paginated:!0,showReportStamp:!1,footerColor:"light",onFinish:()=>d.dismiss()}})).present()},getDefaultDrillDownTable(){const t=[[a.thTxt("ARV number"),a.thTxt("Gender"),a.thTxt("Birth Date"),a.thTxt("Actions")]];return{rowParser:e=>e.map(async i=>{const[l,r]=i;if(r in this.drillDownCache)return[l];const o=await h.findByID(r),s=new h(o),m=[l,a.td(s.getArvNumber()),a.td(s.getGender()),a.tdDate(s.getBirthdate().toString()),a.tdBtn("Show",async()=>{await d.dismiss({}),this.$router.push({path:"/patient/dashboard/".concat(r)})})];return this.drillDownCache[r]=m,m}),columns:t}},runTableDrill(t,n="Drilldown patients"){const{columns:e,rowParser:i}=this.getDefaultDrillDownTable();this.drilldownData(n,e,t,i)},drill(t,n="Drill table"){return t&&t.length>0?a.tdLink(t.length,()=>this.runTableDrill(t,n)):a.td(0)},getEpiweeksFields(){return[{id:"epiweek",helpText:"Select EPI week",type:u.TT_SELECT,validation:t=>D.required(t),options:async()=>c.getWeeks().map(e=>({label:e.name+" - ("+p(e.start).format("DD/MMM/YYYY")+" - "+p(e.end).format("DD/MMM/YYYY")+")",value:e.start,other:e}))}]},getMonthlyFields(){return[{id:"idsrmonth",helpText:"Select Month",type:u.TT_SELECT,validation:t=>D.required(t),options:async()=>c.getMonths().map(e=>({label:e.name+" - ("+p(e.start).format("DD/MMM/YYYY")+" - "+p(e.end).format("DD/MMM/YYYY")+")",value:e.start,other:e}))}]},getDateDurationFields(t=!1,n=!1,e=5){const i="2001-01-01",l=y.getSessionDate();return[{id:"quarter",helpText:"Select Quarter",type:u.TT_SELECT,condition:()=>t,validation:r=>D.required(r),options:()=>{let o=c.getQuarters(e).map(s=>({label:s.name,value:s.start,other:s}));return n&&(o=[{label:"Set custom period",value:"custom_period",other:{}},...o]),o}},...w({id:"start_date",helpText:"Start",required:!0,condition:r=>r.quarter&&r.quarter.value==="custom_period"||!t,minDate:()=>i,maxDate:()=>l,estimation:{allowUnknown:!1},computeValue:r=>r}),...w({id:"end_date",helpText:"End",required:!0,condition:r=>r.quarter&&r.quarter.value==="custom_period"||!t,unload:(r,o,s,m)=>{o==="next"&&(this.endDate=m.end_date)},minDate:(r,o)=>o.start_date,maxDate:()=>l,estimation:{allowUnknown:!1},computeValue:r=>r})]}}});export{P as _};
