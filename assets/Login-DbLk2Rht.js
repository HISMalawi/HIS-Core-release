import{d as O,aw as L,ax as D,ay as j,az as q,aA as G,ab as A,M as _,ac as I,aB as Q,aC as J,aj as X,aD as Z,a8 as U,u as d,B as h,a1 as n,Y as m,aE as N,aF as B,E as k,C as $,G as V,aG as x,a6 as R,a7 as F,U as ee,a3 as se,R as te,a0 as oe,a5 as ae,O as ne,Q as ie,S as re,a4 as le,W as ue,X as pe,r as S,aH as de,ar as ce,aI as he,t as fe,aJ as E,aK as me,aL as we,aM as ye,v as P,w as r,ad as p,x as u,z as g}from"./index-CG6KEPsv.js";import{p as _e}from"./main-BTCptkBz.js";const Ie=O({props:{useVirtualInput:{type:Boolean}},data:function(){return{keyboard:L,auth:{},userInput:{type:String,username:"",password:""},focusInput:{type:Object,value:"",id:""},display:"none",keyboardTop:"",btnCaption:"",Caps:{type:Boolean,on:!1}}},created(){this.auth=new D,j.clearScreenTimeout()},setup(){const{facilityName:e,district:s}=Z();return{facilityName:e,district:s}},methods:{renderKeyBoard(e){this.focusInput=e.currentTarget,this.focusInput.id=="password"?this.btnCaption="Login":this.btnCaption="Next";let s=e.currentTarget.getBoundingClientRect().top;s=parseInt(s),this.keyboardTop=s+20+"px;",this.display="table",window.scrollTo(0,9999)},keyPress(e){const s=e.currentTarget.id;let o;try{s.match(/@#/i)?this.keyboard=q:s.match(/qwerty/i)?this.keyboard=L:s.match(/Del/i)?this.focusInput.value=this.focusInput.value.substring(0,this.focusInput.value.length-1):s.match(/Next/i)?(this.display="none",o=this.$refs.password,o.click()):s.match(/Login/i)?(this.display="none",this.doLogin()):s.match(/Caps/i)?(this.Caps.on=!this.Caps.on,this.display="none",this.focusInput.id==="username"?o=this.$refs.username:o=this.$refs.password,o.click()):s.match(/Hide/i)?this.display="none":this.focusInput.value+=s,this.focusInput.id=="username"?this.userInput.username=this.focusInput.value:this.userInput.password=this.focusInput.value}catch(a){console.warn("input error")}},isStrongPassword(){},doLogin:async function(){if(this.userInput.username&&this.userInput.password){this.auth.setUsername(this.userInput.username);try{if(this.auth.versionLockingIsEnabled()&&await this.auth.validateIfCorrectAPIVersion(),!await this.auth.checkTimeIntegrity())throw"Local date does not match API date. Please Update your device's date";await this.auth.login(this.userInput.password),this.auth.startSession();const e=await Promise.all([this.auth.passwordPolicyEnabled(),this.auth.passwordExpired()]),s=(()=>{let o=0;const a=_e(this.userInput.password);return o+=a.score,/^(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])/i.test(this.userInput.password)&&(o+=2),o<3})();if(s||e.every(Boolean)){const o=a=>"".concat(a.value).toLowerCase();return G([{id:"new_password",proxyID:"password",helpText:"Change your password",type:A.TT_PASSWORD,init:()=>(setTimeout(()=>{s?_("Your password is weak, please change it below"):_("Your password has expired, please change it below",6e3)},500),!0),computedValue:a=>o(a),validation:a=>I.validateSeries([()=>I.required(a),()=>I.hasLengthRangeOf(a,4,15),()=>{if("".concat(this.userInput.password).toLowerCase()===o(a))return["New password should not match old password"]}]),config:{inputType:"password"}},{id:"verify_password",proxyID:"password",helpText:"Confirm Password",type:A.TT_PASSWORD,computedValue:a=>o(a),validation:(a,c)=>I.validateSeries([()=>I.required(a),()=>{if(o(c.verify_password)!=o(c.new_password))return["New password does not match current password"]}]),config:{inputType:"password"}}],async(a,c)=>{await Q.updateUser(this.auth.userID,c)?(await this.auth.resetUserPasswordChangeCheck(),this.$router.push("/select_hc_location")):_("Unable to update user")})}this.$router.push("/select_hc_location")}catch(e){e instanceof J?_("Invalid username or password"):X("".concat(e),5e4)}}else _("Complete form to log in")}},computed:{btnStyles(){return"display: ".concat(this.display,"; top: ").concat(this.keyboardTop,";")}}}),ge=e=>(R("data-v-96af8267"),e=e(),F(),e),ve={class:"main",ref:"main"},be={class:"cells ion-padding-bottom"},Ce=ge(()=>n("b",{style:{color:"#8b4513"}},"Facility: ",-1)),ke={style:{color:"#cd853f"}},Se={class:"rows"},Pe={class:"cells"},$e=["readonly"],Ve={class:"rows input-rows"},Te={class:"cells"},Le=["readonly"],Ae={class:"rows"},Ne=["id"],Be=["id"];function Ee(e,s,o,a,c,w){return d(),h(k,null,[n("div",ve,[n("div",be,[n("h3",null,[Ce,n("b",ke,m(e.facilityName)+" ("+m(e.district)+")",1)])]),n("div",Se,[n("div",Pe,[N(n("input",{type:"text",name:"usename",autocomplete:"off",placeholder:"Username",id:"username",ref:"username","onUpdate:modelValue":s[0]||(s[0]=i=>e.userInput.username=i),onClick:s[1]||(s[1]=i=>e.renderKeyBoard(i)),class:"input-boxes",readonly:e.useVirtualInput},null,8,$e),[[B,e.userInput.username]])])]),n("div",Ve,[n("div",Te,[N(n("input",{"onUpdate:modelValue":s[2]||(s[2]=i=>e.userInput.password=i),type:"password",name:"password",ref:"password",id:"password",onClick:s[3]||(s[3]=i=>e.renderKeyBoard(i)),class:"input-boxes",placeholder:"Password",readonly:e.useVirtualInput},null,8,Le),[[B,e.userInput.password]])])])],512),n("div",{id:"keyboard",style:x(e.btnStyles),class:"keyboard"},[(d(!0),h(k,null,$(e.keyboard,(i,f)=>(d(),h("span",{key:f},[n("div",Ae,[(d(!0),h(k,null,$(i,t=>(d(),h("div",{class:"cells",key:t},[t==="Next"||t==="Login"?(d(),h("button",{key:0,id:e.btnCaption,class:"keyboard-btn login-btn",onClick:s[4]||(s[4]=l=>e.keyPress(l))},m(e.btnCaption),9,Ne)):V("",!0),t!="Login"&&t!="Next"?(d(),h("button",{key:1,id:e.Caps.on?t.toUpperCase():t.toLowerCase(),class:"keyboard-btn",onClick:s[5]||(s[5]=l=>e.keyPress(l))},m(t==="Del."||t==="Caps"?t:e.Caps.on?t.toUpperCase():t.toLowerCase()),9,Be)):V("",!0)]))),128))])]))),128))],4)],64)}const Oe=U(Ie,[["render",Ee],["__scopeId","data-v-96af8267"]]),De=O({components:{IonItem:ee,Inputs:Oe,IonButton:se,IonTitle:te,IonLabel:oe,IonPage:ae,IonHeader:ne,IonToolbar:ie,IonContent:re,IonFooter:le,IonSelect:ue,IonSelectOption:pe},setup(){const e=S([]),s=async()=>{const t=await me("Application Selection","Please specify the application you wish to use",e.value.map(l=>l.name),[{name:"Cancel",color:"danger",slot:"start"},{name:"Confirm",color:"primary",slot:"end",role:"action"}]);if(t.selection&&t.action!="Cancel"){const l=e.value.find(y=>y.name===t.selection);window.open("".concat(l.protocol||"http","://").concat(l.IP,":").concat(l.port||80),"_blank")}},{activePlatformProfile:o,platformProfiles:a}=de(),c=S(""),w=S(""),i=ce(()=>o.value.keyboard===ye.HIS_KEYBOARD_ONLY),f=Object.keys(a.value).map(t=>({label:t,value:{profileName:t,...a.value[t]}}));return he(w,t=>{o.value=(we.find(f,{label:t})||{}).value}),fe(async()=>{var v,b;const t=new D;e.value=((v=await t.loadConfig())==null?void 0:v.otherApps)||[];const l=t.getHeadVersion();t.setActiveVersion(l);const y=await t.getApiVersion();c.value="".concat(l," / ").concat(y),w.value=((b=o.value)==null?void 0:b.profileName)||""}),{version:c,profile:w,otherApps:e,deviceProfiles:f,useVirtualInputOnly:i,activePlatformProfile:o,coatImg:E("login-logos/Malawi-Coat_of_arms_of_arms.png"),pepfarImg:E("login-logos/PEPFAR.png"),showConfig:localStorage.getItem("useLocalStorage")==="true",openSelect:s}}}),M=e=>(R("data-v-f474746d"),e=e(),F(),e),Ue=M(()=>n("b",{style:{color:"#8b4513"}},"National ",-1)),Re=M(()=>n("b",{style:{color:"#cd853f"}},"EMR",-1)),Fe={slot:"start"},Me=["src"],Ke=["src"];function ze(e,s,o,a,c,w){const i=p("ion-label"),f=p("ion-title"),t=p("ion-toolbar"),l=p("ion-header"),y=p("inputs"),v=p("ion-content"),b=p("ion-select-option"),K=p("ion-select"),T=p("ion-button"),z=p("ion-item"),H=p("ion-footer"),W=p("ion-page");return d(),P(W,null,{default:r(()=>[u(l,null,{default:r(()=>[u(t,null,{default:r(()=>[u(f,null,{default:r(()=>[u(i,{style:{fontWeight:"bolder",fontSize:"1.9em"}},{default:r(()=>[Ue,Re]),_:1})]),_:1}),u(i,{class:"ion-padding",slot:"end"},{default:r(()=>[g(" Version: "),n("b",null,m(e.version),1)]),_:1})]),_:1})]),_:1}),u(v,{fullscreen:!1,style:{width:"100%"}},{default:r(()=>[u(y,{useVirtualInput:e.useVirtualInputOnly},null,8,["useVirtualInput"])]),_:1}),u(H,null,{default:r(()=>[u(t,null,{default:r(()=>[n("span",Fe,[n("img",{id:"coat",src:e.coatImg,alt:"Malawi Coat of Arms logo"},null,8,Me),n("img",{id:"pepfar",src:e.pepfarImg,alt:"PEPFAR logo"},null,8,Ke)]),u(z,{class:"his-sm-text",style:{width:"75%"},slot:"end"},{default:r(()=>[u(i,null,{default:r(()=>[g("Device Profile")]),_:1}),u(K,{modelValue:e.profile,"onUpdate:modelValue":s[0]||(s[0]=C=>e.profile=C),value:e.profile},{default:r(()=>[(d(!0),h(k,null,$(e.deviceProfiles,(C,Y)=>(d(),P(b,{key:Y,value:C.label},{default:r(()=>[g(m(C.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","value"]),u(T,{color:"dark",fill:"outline",size:"large",slot:"end","router-link":"/settings/host"},{default:r(()=>[g(" Network ")]),_:1}),e.otherApps.length?(d(),P(T,{key:0,color:"dark",fill:"outline",size:"large",slot:"end",onClick:e.openSelect},{default:r(()=>[g(" Other Applications ")]),_:1},8,["onClick"])):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})}const Ye=U(De,[["render",ze],["__scopeId","data-v-f474746d"]]);export{Ye as default};
