System.register(["./index-legacy-D2iCn0VZ.js","./HisStandardForm-legacy-DWEtuKgE.js","./useEncounter-legacy-gpU_wTiI.js","./commons-legacy-Do68XCCC.js","./identifier_service-legacy-Bf-Zf8j_.js","./isEmpty-legacy-C9AhRD8i.js","./encounter_guidelines-legacy-DtASQQT-.js","./GuidelineEngine-legacy-KsvQuFdF.js"],(function(e,t){"use strict";var i,n,a,r,u,l,s,c,o,d,p,y,m,T,b,v,I,f,g,_,$,B,N,x,D,E,w,P,R;return{setters:[e=>{i=e.d,n=e.bh,a=e.r,r=e.bU,u=e.bW,l=e.e6,s=e.u,c=e.al,o=e.am,d=e.e1,p=e.aY,y=e.s,m=e.bc,T=e.bY,b=e.aZ,v=e.cs,I=e.a,f=e.w,g=e.e,_=e.f,$=e.n,B=e.b,N=e.e7,x=e.aB},e=>{D=e.H},e=>{E=e.u},e=>{w=e.m,P=e.r},e=>{R=e.I},null,null,null],execute:function(){e("default",i({__name:"Registration",setup(e){const t=n.getActiveApp(),i=a([]),U=new r(-1,u.TB_REGISTRATION),h=new R,j=a(),q=a(""),A=s();function M(e){const[t,i]=`${e}`.split("/");if(i)return`${q.value}${t}/${i}`;const[n]=`${U.date}`.split("-");return`${q.value}${t}/${n.trim()}`}const S={"Multi drug resistance treatment":{type:l.MDR,label:"Patient DR TB Number",indexID:"DR TB Number",concept:"MDR_NUMBER"},"Tuberculosis Preventive Treatment (TPT)":{type:l.IPT,label:"Patient IPT Number",indexID:"IPT Number",concept:"TB_NUMBER"},"Currently in treatment":{type:l.TB,label:"Patient TB Number",indexID:"TB Number",concept:"TB_NUMBER"},DEFAULT:{type:l.TB,label:"Patient TB Number",indexID:"TB Number",concept:"TB_NUMBER"}},{goToNextTask:C,patientDashboardUrl:O,patientId:F}=E(((e,n,a,r)=>{U.patientID=n,U.providerID=e,i.value=[(()=>{let e={};const t=Object.values(S).find((e=>e.indexID===A.query.type));return{id:"reassign",helpText:`Reassign ${A.query.type}: ${A.query.id}`,proxyID:"patientIdentifier",type:o.TT_NUMBER,init:async()=>{e=await m.getProgramInformation(n),!A.query.id&&T.isOnTreatment(e.current_outcome)&&`${e.tb_number}`.split("/").length>0&&await b("Caution!",`Client is currently using program number ${e.tb_number}`,`Current outcome is ${e.current_outcome} updated on ${v(e.current_outcome_date)}`,[{name:"Ok",color:"primary",slot:"start"}]);const[i,a]=`${A.query.id}`.split("/");return h.setIdentifierType(t?.type),q.value=`${i}/${a}/`,!0},beforeNext:async e=>{const t=M(`${e.value}`),i=await h.getPatientsByIdentifier(t);return!!p.isEmpty(i)||(y(`${t} is already in use!!`),!1)},computedValue:e=>({obs_datetime:U.date,value_text:M(`${e.value}`),concept_id:d(t?.concept)}),condition:()=>A.query.reassign,validation:e=>c.required(e)}})(),{id:"new",helpText:"Identifier:",proxyID:"patientIdentifier",type:o.TT_NUMBER,init:async()=>(S[r.outcome]?j.value=S[r.outcome]:j.value=S.DEFAULT,h.setIdentifierType(j.value?.type),q.value=await(t.programPatientIdentifiers[j.value?.indexID]?.prefix()),!0),beforeNext:async e=>{const t=M(`${e.value}`),i=await h.getPatientsByIdentifier(t);return!!p.isEmpty(i)||(y(`${t} is already in use!!`),!1)},computedValue:e=>({obs_datetime:U.date,value_text:M(`${e.value}`),concept_id:d(j.value?.concept)}),condition:e=>!e.reassign?.value,validation:e=>c.required(e),dynamicHelpText:()=>j.value?.label},{id:"idSummary",helpText:"Identifier",type:o.TT_TEXT_BANNER,options:e=>w([`${j.value?.label}: <br/> <b>${M(e.patientIdentifier.value)}</b>`])}]}));async function L(e,t){await U.createEncounter(),await U.saveObservationList(await P(t)),e.new?await N.create(F.value,h.identifierType,M(e.patientIdentifier.value)):await N.update(parseInt(`${A.query.reassign}`),M(e.patientIdentifier.value)),await T.printTBNumber(U.patientID),x.invalidate("ACTIVE_PATIENT"),C()}return(e,t)=>(B(),I(_($),null,{default:f((()=>[g(D,{cancelDestinationPath:_(O),onFinishAction:L,fields:i.value,skipSummary:!0},null,8,["cancelDestinationPath","fields"])])),_:1}))}}))}}}));
