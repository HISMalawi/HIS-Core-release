var p=Object.defineProperty;var C=(e,t,s)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var o=(e,t,s)=>(C(e,typeof t!="symbol"?t+"":t,s),s);import{bk as u,d as f,b4 as d,b3 as c,t as h,U as b,F as a,V as i,ai as v,bt as T,_,r as x,o as S,c as g}from"./index-BFVcutZq.js";import{H as V}from"./HisStandardForm-DO3sZVdL.js";import{_ as P}from"./EncounterMixin.vue_vue_type_script_lang-BjcFUOZj.js";import{g as y}from"./LocationFieldOptions-C8xpWQA4.js";import"./encounter_guidelines-fEzG7yyD.js";import"./GuidelineEngine-D6V1_Znr.js";import"./storage-DBvOSj8j.js";class E extends u{constructor(s,n){super(s,181,n);o(this,"hivStatus");o(this,"artStatus");o(this,"arvNumber");o(this,"arvStartDate");this.hivStatus="",this.artStatus="",this.arvNumber="",this.arvStartDate=""}getHivStatus(){return this.hivStatus}getArtStatus(){return this.artStatus}getArvNumber(){return this.arvNumber}getArvStartDate(){return this.arvStartDate}isHivPositive(){return!!this.hivStatus.match(/positive/i)}async loadArtStatus(){const s=await u.getJson("programs/12/patients/".concat(this.patientID,"/art_hiv_status"));s&&(this.hivStatus=s.hiv_status||this.hivStatus,this.artStatus=s.art_status||"",this.arvNumber=s.arv_number||"",this.arvStartDate=s.arv_start_date||"")}}const I=f({mixins:[P],components:{HisStandardForm:V},data:()=>({assessment:{},obs:[],showHIVQuestions:!0,alreadyOnTreatment:!1,offerCxCa:!1,patientPreviousTreatment:"",patientPreviousVisitHIVStatus:""}),watch:{patient:{async handler(){this.assessment=new E(this.patientID,this.providerID),this.patientPreviousTreatment=await d.getFirstValueCoded(this.patientID,"Treatment"),this.patientPreviousVisitHIVStatus=await d.getFirstValueCoded(this.patientID,"HIV status"),this.alreadyOnTreatment=this.patientAlreadyOnTreatment(),c.getConceptsByCategory("reason_for_no_cxca"),await this.assessment.loadArtStatus(),this.assessment.getHivStatus()!==""&&(this.showHIVQuestions=!1),this.assessment.getHivStatus()==="Positive"&&(this.showHIVQuestions=!1),await this.setOfferCxCa(),this.fields=await this.getFields()},deep:!0}},methods:{skipTreatmentSelection(){const e=["Chemotherapy","Hysterectomy","Palliative Care"];if(this.patientPreviousTreatment){const t=this.patientPreviousTreatment;return e.includes(t)}else return!1},skipHIVStatusSelection(){const e=["positive on art","positive not on art"];if(this.patientPreviousVisitHIVStatus){const t=this.patientPreviousVisitHIVStatus.toLowerCase();return e.includes(t.toLowerCase())}else return!1},patientAlreadyOnTreatment(){return!this.isNullOrUndefined(this.patientPreviousTreatment)},isNullOrUndefined(e){return typeof e>"u"||e===null},async onFinish(e,t){if(!await this.assessment.createEncounter())return h("Unable to create encounter");const n=[];Object.keys(t).forEach(r=>{n.push(t[r].obs)});const l=await Promise.all([...this.obs,...n]);if(!await this.assessment.saveObservationList(l))return h("Unable to save patient observations");b("Observations and encounter created!"),this.nextTask()},async setOfferCxCa(){const e=await this.assessment.getFirstValueCoded("Offer CxCa");return this.offerCxCa=e&&e==="Yes",this.offerCxCa||this.obs.push(this.assessment.buildValueCoded("Ever had CxCa","No")),!0},hasHIVStatus(){return this.assessment.getHivStatus!==""},enterPreviousCxCaData(e){const t=e.ever_had_cxca.value==="Yes",s=e.results_available.value==="Yes";return t&&s},getFacilities(e=""){return y(e)},getReasonsForNoCxcaOptions(){return c.getConceptsByCategory("reason_for_no_cxca").map(e=>({label:e.name,value:e.name,other:{c:e}}))},getFields(){return[{id:"reason_for_visit",helpText:"Reason for visit",type:a.TT_SELECT,validation:e=>i.required(e),options:()=>[{label:"Initial screening",value:"Initial screening"},{label:"Postponed treatmment",value:"Postponed treatment"},{label:"One year subsequent check-up after treatment",value:"One year subsequent check-up after treatment"},{label:"Subsequent screening",value:"Subsequent screening"},{label:"Problem visit after treatment",value:"Problem visit after treatment"},{label:"Referral",value:"Referral"}],computedValue:e=>({obs:this.assessment.buildValueCoded("Reason for visit",e.value)})},{id:"hiv_status",helpText:"HIV status",type:a.TT_SELECT,condition:()=>this.showHIVQuestions&&!this.skipHIVStatusSelection(),validation:e=>i.required(e),options:()=>[{label:"Positive on ART",value:"Positive on ART"},{label:"Positive Not on ART",value:"Positive Not on ART"},{label:"Negative",value:"Negative"},{label:"Never tested",value:"Never tested"},{label:"Prefers Not to disclose",value:"Undisclosed"}],computedValue:e=>({obs:this.assessment.buildValueCoded("HIV status",e.value)})},...v({id:"hiv_test_date",helpText:"HIV test result date",required:!0,condition:e=>e.hiv_status.value.match(/Negative|ART/i),minDate:()=>this.patient.getBirthdate(),maxDate:()=>this.assessment.getDate(),estimation:{allowUnknown:!0,estimationFieldType:T.MONTH_ESTIMATE_FIELD},computeValue:(e,t)=>({date:e,tag:"cxca screening",isEstimate:t,obs:this.assessment.buildValueDate("HIV test date",e,t)})}),{id:"ever_had_cxca",helpText:"Ever had CxCa screening",type:a.TT_SELECT,condition:e=>e.reason_for_visit.value!=="Initial screening"&&!this.alreadyOnTreatment,options:()=>this.yesNoOptions(),validation:e=>i.required(e),computedValue:e=>({obs:this.assessment.buildValueCoded("Ever had CxCa",e.value)})},{id:"results_available",helpText:"Results available?",type:a.TT_SELECT,validation:e=>i.required(e),condition:e=>e.reason_for_visit.value!=="Initial screening"&&e.ever_had_cxca.value!=="No",options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.assessment.buildValueCoded("CxCa test results",e.value)})},{id:"location",helpText:"CxCa screening location",type:a.TT_SELECT,validation:e=>i.required(e),options:(e,t="")=>this.getFacilities(t),config:{showKeyboard:!0,isFilterDataViaApi:!0},condition:e=>this.enterPreviousCxCaData(e),computedValue:e=>({obs:this.assessment.buildValueText("Previous CxCa location",e.value)})},...v({id:"cxca_date",helpText:"Previous CxCa test",required:!0,minDate:()=>this.patient.getBirthdate(),maxDate:()=>this.assessment.getDate(),estimation:{allowUnknown:!1},condition:e=>this.enterPreviousCxCaData(e),computeValue:(e,t)=>({date:e,tag:"cxca screening",isEstimate:t,obs:this.assessment.buildValueDate("cxca test date",e)})}),{id:"previous_screening_method",helpText:"Previous screening method",type:a.TT_SELECT,validation:e=>i.required(e),condition:e=>this.enterPreviousCxCaData(e),options:()=>[{label:"VIA",value:"VIA"},{label:"PAP Smear",value:"PAP Smear"},{label:"HPV DNA",value:"HPV DNA"},{label:"Speculum Exam",value:"Speculum Exam"}],computedValue:e=>({obs:this.assessment.buildValueCoded("Previous CxCa screening method",e.value)})},{id:"offer_CxCa",helpText:"Offer CxCa screening today",type:a.TT_SELECT,condition:this.skipTreatmentSelection(),validation:e=>i.required(e),options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.assessment.buildValueCoded("Offer CxCa",e.value)})},{id:"screening_method",helpText:"Screening method being offered",type:a.TT_SELECT,validation:e=>i.required(e),condition:e=>e.offer_CxCa.value==="Yes",options:()=>[{label:"VIA",value:"VIA"},{label:"PAP Smear",value:"PAP Smear"},{label:"HPV DNA",value:"HPV DNA"},{label:"Speculum Exam",value:"Speculum Exam"}],computedValue:e=>({obs:this.assessment.buildValueCoded("CxCa screening method",e.value)})},{id:"offer_family_planning",helpText:"Offer Family Planning ?",type:a.TT_SELECT,condition:e=>e.offer_CxCa.value!=="No",validation:e=>i.required(e),options:()=>this.yesNoOptions(),computedValue:e=>({obs:this.assessment.buildValueCoded("Family planning",e.label)})},{id:"reason_for_no_cxca",helpText:"Reason for NOT offering CxCa screening",type:a.TT_SELECT,validation:e=>i.required(e),condition:e=>e.offer_CxCa.value==="No",options:()=>this.getReasonsForNoCxcaOptions(),computedValue:e=>({obs:this.assessment.buildValueCoded("Reason for NOT offering CxCa",e.value)})}]}}});function N(e,t,s,n,l,m){const r=x("his-standard-form");return S(),g(r,{fields:e.fields,onFinishAction:e.onFinish,skipSummary:!1,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}const L=_(I,[["render",N]]);export{L as default};
