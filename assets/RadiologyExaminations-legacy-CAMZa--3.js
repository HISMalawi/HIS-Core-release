System.register(["./EncounterMixin.vue_vue_type_script_lang-legacy-qUwf12Yn.js","./HisStandardForm-legacy-a9YJRGaH.js","./index-legacy-CA6M7ipO.js","./radiology_examination_service-legacy-CRC2JFdy.js","./radiology_global_props-legacy-BZWNN8MT.js","./encounter_guidelines-legacy-Bcz_Mw7r.js","./GuidelineEngine-legacy-KsvQuFdF.js","./RadiologyExaminationLbl-legacy-BdreLl0N.js"],(function(e,i){"use strict";var t,a,n,l,s,o,r,d,u,c,p,h,m,v,y,T,f,E,_,x;return{setters:[e=>{t=e._},e=>{a=e.H},e=>{n=e.ao,l=e.d,s=e.I,o=e.ad,r=e.ae,d=e.aN,u=e.bE,c=e.W,p=e.aj,h=e.am,m=e.aa,v=e.af,y=e.a,T=e.c,f=e.w,E=e.b},e=>{_=e.R},e=>{x=e.a},null,null,null],execute:function(){class i extends n{constructor(){super()}static getInternalSections(){return super.getJson("internal_sections")}static createInternalSection(e){return super.postJson("internal_sections",{name:e})}}const b=l({mixins:[t],components:{IonPage:s,HisStandardForm:a},data:()=>({service:{},examinationOptions:[],defaultExternalLocation:"",detailedExaminationOptions:[]}),watch:{ready:{handler(e){e&&(this.service=new _(this.patientID,this.providerID),this.fields.push(this.listOfRadiologyTestsField()),this.fields.push(this.examinationField()),this.fields.push(this.detailedExaminationField()),this.fields.push(this.referralTypeField()),this.fields.push(this.internalReferralField()),this.fields.push(this.externalReferralField()),this.fields.push(this.payingField()),this.fields.push(this.paymentTypeField()),this.fields.push(this.receiptField()),this.fields.push(this.paymentAmountField()),this.fields.push(this.invoiceField()),this.fields.push(this.invoiceAmountField()))},immediate:!0}},methods:{getTestsOptions:async e=>(await _.getListOfRadiologyTests(e)).map((e=>({label:e.name,value:e.concept_id}))),validateAmount:e=>e.match(/([0-9]+\\.[0-9])|Unknown$/i)?["You must enter a decimal number"]:null,async onFinish(e,i){await this.service.createEncounter();const t=await this.service.createOrder({concept_id:i.list_of_radiology_test.concept,encounter_id:this.service.encounterID,provider_id:this.providerID}),a=(await this.resolveObs(i)).map((e=>(e.order_id=t.order_id,e)));await this.service.saveObservationList(a),this.service.printExamination(t.accession_number),this.gotoPatientDashboard()},listOfRadiologyTestsField(){let e=[],i=-1;return{id:"list_of_radiology_test",helpText:"Please select the type of examination",type:o.TT_SELECT,validation:e=>r.required(e),computedValue:e=>({concept:e.value,obs:this.service.buildValueCoded("RADIOLOGY TEST",e.value)}),beforeNext:async e=>(i!=e.value&&(i=e.value,this.examinationOptions=await this.getTestsOptions(e.value)),!0),options:async()=>(d.isEmpty(e)&&(e=await this.getTestsOptions("LIST OF RADIOLOGY TESTS")),e)}},examinationField(){let e=-1;return{id:"examination",helpText:"Please select the examination",type:o.TT_SELECT,validation:e=>r.required(e),computedValue:e=>({obs:this.service.buildValueCoded("Examination",e.value)}),condition:()=>!d.isEmpty(this.examinationOptions),beforeNext:async(i,t)=>(e!=t.list_of_radiology_test.value&&(e=i.value,this.detailedExaminationOptions=await this.getTestsOptions(e)),!0),options:()=>this.examinationOptions}},detailedExaminationField(){return{id:"detailed_examination",helpText:"Please select the detailed examination",type:o.TT_SELECT,condition:()=>!d.isEmpty(this.detailedExaminationOptions),computedValue:e=>({obs:this.service.buildValueCoded("Detailed examination",e.value)}),validation:e=>r.required(e),options:()=>this.detailedExaminationOptions}},referralTypeField(){return{id:"referral_type",helpText:"Please select the referral type",type:o.TT_SELECT,validation:e=>r.required(e),computedValue:e=>({obs:this.service.buildValueText("Source of referral",e.label)}),options:()=>this.mapStrToOptions(["External","Internal"])}},externalReferralField(){const e=u.getFacilityLocationField();return e.id="external_referral",e.init=async()=>(this.defaultExternalLocation=await x.defaultReferralLocation(),!0),e.defaultValue=()=>this.defaultExternalLocation,e.condition=e=>"External"===e.referral_type.value,e.computedValue=e=>({obs:this.service.buildValueText("REFERRED FROM",e.label)}),e},internalReferralField(){let e=[];return{id:"referred_by",helpText:"Referred from",type:o.TT_SELECT,validation:e=>r.required(e),condition:e=>"Internal"===e.referral_type.value,computedValue:e=>({obs:this.service.buildValueText("REFERRED FROM",e.label)}),options:async()=>(d.isEmpty(e)&&(e=(await i.getInternalSections()).map((e=>({value:e.id,label:`${e?.name}`.toUpperCase()})))),e),config:{showKeyboard:!0,footerBtns:[{name:"Add Referral",slot:"end",color:"success",onClick:async(e,t,a)=>{if("string"!=typeof a.filter||a.filter.length<3)return c("Please enter a valid name");if(a.filtered.some((e=>e.label.toLowerCase()===a.filter.toLowerCase())))return c("Can't add already existing referral location");if(await p("Do you want to add referral location?")){const e=await i.createInternalSection(a.filter.toUpperCase());e?(a.filter=e.name,a.listData=[{label:e.name,value:e.id},...a.listData]):h(`Unable to add ${a.filter}`)}}}]}}},payingField(){return{id:"paying",helpText:"Is this a paying patient?",type:o.TT_SELECT,computedValue:e=>({obs:this.service.buildValueCoded("PAYING",e.value)}),validation:e=>r.required(e),options:()=>this.yesNoOptions()}},paymentTypeField(){return{id:"payment_type",helpText:"Select payment method",type:o.TT_SELECT,validation:e=>r.required(e),condition:e=>"Yes"===e.paying.value,computedValue:e=>({obs:this.service.buildValueCoded("PAYMENT TYPE",e.value)}),options:()=>this.mapStrToOptions(["Cash","Invoice"])}},receiptField(){return{id:"receipt_number",helpText:"Enter receipt number",type:o.TT_TEXT,condition:e=>"Cash"===e.payment_type.value,computedValue:e=>({obs:this.service.buildValueText("RECEIPT NUMBER",e.value)}),validation:e=>r.validateSeries([()=>r.required(e),()=>this.validateAmount(`${e.value}`)])}},invoiceField(){return{id:"invoice_number",helpText:"Enter invoice number",type:o.TT_TEXT,computedValue:e=>({obs:this.service.buildValueText("INVOICE NUMBER",e.value)}),condition:e=>"Invoice"===e.payment_type.value,validation:e=>r.required(e)}},paymentAmountField(){return{id:"payment_amount",helpText:"Enter payment amount",type:o.TT_NUMBER,condition:e=>e.receipt_number.value,computedValue:e=>({obs:this.service.buildValueNumber("PAYMENT AMOUNT",e.value)}),validation:e=>r.validateSeries([()=>r.required(e),()=>this.validateAmount(`${e.value}`)])}},invoiceAmountField(){return{id:"invoice_amount",helpText:"Enter invoice amount",type:o.TT_NUMBER,condition:e=>e.invoice_number.value,computedValue:e=>({obs:this.service.buildValueNumber("INVOICE AMOUNT",e.value)}),validation:e=>r.validateSeries([()=>r.required(e),()=>this.validateAmount(`${e.value}`)])}}}});e("default",m(b,[["render",function(e,i,t,a,n,l){const s=v("his-standard-form"),o=v("ion-page");return y(),T(o,null,{default:f((()=>[E(s,{fields:e.fields,onFinishAction:e.onFinish,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])])),_:1})}]]))}}}));
