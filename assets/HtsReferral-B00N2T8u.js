import{bQ as H,d as N,a5 as R,r as C,ei as V,a9 as T,bn as P,ek as k,a6 as x,v as y,w as F,ab as E,u as $,x as O}from"./index-CyYd6aWW.js";import{H as w}from"./hts_circumcision_service-B9tiD2XK.js";import{H as M}from"./HisStandardForm-CuX9K_Ib.js";class _ extends H{constructor(c,o=-1){super(c,114,o)}}const D=N({components:{IonPage:R,HisStandardForm:M},setup(){const r=new _(-1),c=C([]),o=C(!1),{visitID:l,getEncounter:p,saveEncounter:d,patientDashboardUrl:f,htsClient:u}=V({onInitVisit:()=>{c.value=[I(),b()]}});function g(i,a){d({encounterTypeID:r.encounterTypeID,encounterName:"REFERRAL",computedData:a})}function m(i){return _.getFirstValueCoded(l.value,i)}function I(){let i=!1;const a=[];return{id:"services",helpText:"Refer Client to other Services?",type:T.TT_MULTIPLE_SELECT,isRequired:()=>!0,init:async()=>{const s=u.age;if(u.gender==="M"){const n=p("CIRCUMCISION");n?i=/no/i.test(n["Circumcision status"])&&s>14&&s<64:P().isOfflineMode.value||(i=[await new w(l.value).getRecentCircumcisionStatus()==="No",s>14&&s<64].every(Boolean))}const t=["Hepatitis B Test Result","Syphilis Test Result"],e=p("Testing");if(e)t.forEach(n=>{e[n]==="Positive"&&a.push(n)}),o.value=/positive/i.test("".concat(e["HIV status"]));else if(!P().isOfflineMode.value){for(const n of t)await m(n)==="Positive"&&a.push(n);o.value=["Positive","Positive Initial Professional"].includes(await m("HIV status"))}return!0},finalComputedValue:s=>({obs:s.map(t=>r.buildValueText("Referrals ordered","".concat(t.value)))}),onValueUpdate(s,t){return s.map(e=>(t.value==="None"&&e.value!="None"&&(e.isChecked=!1),t.value!="None"&&t.isChecked&&e.value==="None"&&(e.isChecked=!1),e))},options:s=>{const t=[],e=(n,v={})=>{const h=s.services?s.services.some(S=>S.value===n):!1;return{label:n,value:n,isChecked:h,...v}};return t.push(e("STI",a.length?{description:{text:"Client tested positive for ".concat(k(a),". Please recommend this option if client has not started yet")}}:{})),t.push(e("TB")),u.gender==="M"&&t.push(e("VMMC",i?{description:{text:"Client is not circumcised, please recommend this option"}}:{})),t.push(e("PrEP ",o.value?{disabled:o.value,description:{text:"Client is HIV positive, cannot refer for PrEP"}}:{})),t.push(e("PEP ",o.value?{disabled:o.value,description:{text:"Client is HIV positive, cannot refer for PEP"}}:{})),t.push(e("Other")),t.push(e("None")),t},config:{footerBtns:[{name:"None",slot:"end",onClickComponentEvents:{refreshOptions:(s,t)=>t.map(e=>(e.isChecked=e.label==="None",e))},onClick:()=>"None"}]}}}function b(){return{id:"comment",helpText:"Comments (Optional)",type:T.TT_NOTE,finalComputedValue:i=>i&&!/^\s*$/gi.test("".concat(i.value))?{obs:r.buildValueText("Comments","".concat(i.value))}:null}}return{patientDashboardUrl:f,onFinish:g,fields:c}}});function B(r,c,o,l,p,d){const f=E("his-standard-form"),u=E("ion-page");return $(),y(u,null,{default:F(()=>[O(f,{formLabel:"Referral",skipSummary:!0,fields:r.fields,onFinishAction:r.onFinish,cancelDestinationPath:r.patientDashboardUrl()},null,8,["fields","onFinishAction","cancelDestinationPath"])]),_:1})}const q=x(D,[["render",B]]);export{q as default};
