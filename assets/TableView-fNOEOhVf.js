import{d as ae,c8 as re,c9 as se,a$ as le,b8 as ie,ca as ue,I as ce,l as de,k as fe,a4 as pe,a5 as ye,ah as he,aC as ge,a7 as ke,m as ve,r as $,c as O,aQ as Ce,cb as be,cc as me,cd as Pe,ce as we,cf as Se,cg as De,ch as Ie,ci as Ve,aq as Te,aZ as Fe,B as $e,S as R,b3 as Re,cj as ze,ck as Ee,cl as Be,cm as Ne,aY as X,ak as Ue,h as C,e as l,w as a,a as y,a6 as h,ap as f,j as b,g as z,t as E,a9 as B,aa as L,b as s,ba as He}from"./index-y6JY22M4.js";import{t as Ke,a as Oe}from"./Export-CltTNrmu.js";const Le=ae({components:{IonToolbar:ve,IonItem:ke,IonIcon:ge,IonLabel:he,IonTitle:ye,IonHeader:pe,IonButton:fe,IonFooter:de,IonContent:ce,IonButtons:ue,IonChip:ie,HisKeyboard:le,IonThumbnail:se,IonImg:re},props:{title:{type:String,default:"Report"},headerBadge:{type:Object},iconUrl:{type:String},subtitle:{type:String},columns:{type:Object,required:!0},columnData:{type:Array,default:()=>[]},enablePagination:{type:Boolean,default:!0},rowsPerPage:{type:Number,default:10},onFinish:{type:Function},onRefresh:{type:Function},onConfigure:{type:Function},csvQuarter:{type:String},reportPrefix:{type:String,default:""},defaultSortedColumn:{type:String},defaultSortOrder:{type:String,default:"desc"}},setup(e){const o=Te(),V=$([]),g=$(0),S=$(""),T=$(""),w=$("desc"),Q=$(!1),M=O(()=>{let t=V.value;return w.value&&T.value&&(t=Be(V.value)[w.value](n=>n.sortData[T.value])),S.value?new Ne(t,{threshold:.3,keys:["searchIndex"],useExtendedSearch:!0}).search(S.value,{limit:e.rowsPerPage}).map(d=>d.item):t}),v=O(()=>X.chunk(M.value,e.rowsPerPage).length),p=O(()=>g.value+2<=v.value),N=O(()=>g.value>0),j=O(()=>X.chunk(M.value,e.rowsPerPage)[g.value]),Y=t=>{T.value=t,w.value=w.value==="asc"?"desc":"asc"},U=()=>Ve(t=>{const n=parseInt(t);parseInt(t)<=v.value&&(g.value=n)},{title:"Select page"}),_=()=>g.value=0,q=()=>g.value=v.value-1||0,W=()=>g.value+=1,G=()=>g.value-=1,Z=()=>{typeof e.onFinish=="function"?e.onFinish():o.push("/")},c=t=>{var n,d;try{typeof((n=t.column)==null?void 0:n.tdClick)=="function"&&((d=t.column)==null||d.tdClick(t));return}catch(P){console.error(P)}},m=()=>e.columns.reduce((t,n)=>t.concat(n),[]).filter(t=>t.value||t.ref),u=()=>m().some(t=>t==null?void 0:t.encrypted),F=(t,n=!1)=>{var K,J,te;const d=m().filter(r=>[t==="pdf"&&typeof r.encrypted=="boolean"?(r==null?void 0:r.encrypted)&&!n:!0,t==="csv"?!(r!=null&&r.encrypted):!0,r.canExport?r==null?void 0:r.canExport[t]:!0,typeof r.exportable=="boolean"?r.exportable:!0].every(Boolean)),P=d.map(r=>r.exportedValue&&r.exportedValue.column?r.exportedValue.column(r):r.secondaryLabel||r.label),i=d.map(r=>r.ref),k=V.value.reduce((r,oe)=>{const ne=oe.row.filter(({column:I})=>i.includes(I.ref)).map(I=>I.column.exportedValue&&I.column.exportedValue.dataValue?I.column.exportedValue.dataValue(I):I.value);return[...r,ne]},[]),H="".concat(e.reportPrefix," ").concat((K=R.getLocationName())!=null?K:""," ").concat(ze(e.title).replace(e.reportPrefix,"")," ").concat(Ee((te=(J=e.csvQuarter)!=null?J:e.subtitle)!=null?te:""));return{headers:P,rows:k,filename:H}},D=async()=>{let t;if(u()&&await Fe("Security warning","PDF may contain private data that will require a password to unlock","To access private data choose Secure PDF over Regular PDF",[{name:"Secure PDF",slot:"start",color:"success"},{name:"Regular PDF",slot:"start",color:"success"}],"his-danger-color")==="Secure PDF"){const k=R.getUserName();t={encryption:{userPassword:k,ownerPassword:k,userPermissions:["print"]}}}const{headers:n,rows:d,filename:P}=F("pdf",!t);Ke([n],d,P,!0,t)},A=()=>{const{headers:t,rows:n,filename:d}=F("csv");Oe([t],[...n,["Date Created: ".concat($e().format("DD/MMM/YYYY HH:MM:ss"))],["Quarter: ".concat(e.csvQuarter||e.subtitle)],["HIS-Core Version: ".concat(R.getCoreVersion())],["API Version: ".concat(R.getApiVersion())],["Site UUID: ".concat(R.getSiteUUID())],["Generated by: ".concat(R.getUserName())]],d)},x=t=>{S.value=Re(t,S.value),g.value=0},ee=t=>{t.forEach(n=>{const d={...n},P=m().map(i=>{var K;let k="";const H=n[i.ref];try{X.isEmpty(n)?k="":typeof i.toValue=="function"?k="".concat(i.toValue(H)):typeof i.value=="function"?k=i.value(n):k=n[i.ref]||""}catch(J){k=(K=i==null?void 0:i.defaultValue)!=null?K:"_ERROR_"}return d[i.ref]=k,typeof i.sortValue=="function"&&(d[i.ref]=i.sortValue(H)),{column:i,refData:H,value:k,data:n}});V.value.push({row:P,data:n,sortData:d,searchIndex:[...P,P.map(i=>i.value).join(" ")]})})};return Ce(()=>e.columnData,t=>{var n;if(V.value=[],!Array.isArray(t)||!t.length){g.value=0,S.value="",T.value=(n=e.defaultSortedColumn)!=null?n:"",w.value=e.defaultSortOrder,ee(Array.from({length:0}).map(()=>({})));return}ee(t)},{immediate:!0,deep:!0}),{first:_,last:q,next:W,prev:G,selectPage:U,sortColumn:Y,onClickTablecell:c,toPDF:D,toCSV:A,finish:Z,filterTable:x,sync:Ie,search:De,close:Se,arrowUp:we,arrowDown:Pe,funnelOutline:me,page:j,canNext:p,searchTerm:S,totalPages:v,sortOrder:w,canPrev:N,currentPage:g,columnSorted:T,QWERTY:be,showSearchKeyboard:Q}}}),Me={key:0},je={class:"his-sm-text"},Ae={style:{width:"100%"}},Qe={class:"stick-report-header"},Ye=["colspan","rowspan","onClick"],_e=["onClick"],qe=["innerHTML"];function We(e,o,V,g,S,T){const w=f("ion-img"),Q=f("ion-thumbnail"),M=f("ion-title"),v=f("ion-icon"),p=f("ion-button"),N=f("ion-label"),j=f("ion-chip"),Y=f("ion-buttons"),U=f("ion-toolbar"),_=f("ion-header"),q=f("ion-item"),W=f("ion-content"),G=f("his-keyboard"),Z=f("ion-footer");return s(),C(B,null,[l(_,null,{default:a(()=>[l(U,null,{default:a(()=>[e.iconUrl?(s(),y(Q,{key:0,slot:"start"},{default:a(()=>[l(w,{src:e.iconUrl},null,8,["src"])]),_:1})):h("",!0),l(M,{slot:"start",class:"his-md-text"},{default:a(()=>[b(E(e.title)+" ",1),e.subtitle?(s(),C("br",Me)):h("",!0),z("span",je,E(e.subtitle),1)]),_:1}),l(Y,{slot:"end"},{default:a(()=>[typeof e.onConfigure=="function"?(s(),y(p,{key:0,onClick:o[0]||(o[0]=()=>e.onConfigure?e.onConfigure():null)},{default:a(()=>[l(v,{size:"large",icon:e.funnelOutline},null,8,["icon"])]),_:1})):h("",!0),e.searchTerm?(s(),y(j,{key:1,onClick:o[1]||(o[1]=()=>{e.searchTerm="",e.showSearchKeyboard=!1}),class:"his-md-text",color:"primary"},{default:a(()=>[l(N,null,{default:a(()=>[b(E(e.searchTerm?"Search: ".concat(e.searchTerm):""),1)]),_:1}),l(v,{icon:e.close},null,8,["icon"])]),_:1})):h("",!0),l(p,{color:e.showSearchKeyboard?"primary":"dark",onClick:o[2]||(o[2]=()=>e.showSearchKeyboard=!e.showSearchKeyboard),size:"large"},{default:a(()=>[l(v,{size:"large",icon:e.search},null,8,["icon"])]),_:1},8,["color"]),typeof e.onRefresh=="function"?(s(),y(p,{key:2,onClick:o[3]||(o[3]=()=>e.onRefresh?e.onRefresh():null),color:"success",size:"large"},{default:a(()=>[l(v,{size:"large",icon:e.sync},null,8,["icon"])]),_:1})):h("",!0)]),_:1})]),_:1}),(e.headerBadge||[]).length?(s(),y(U,{key:0,color:"light"},{default:a(()=>[(s(!0),C(B,null,L(e.headerBadge,(c,m)=>(s(),y(j,{onClick:u=>typeof c.action=="function"?c.action():null,key:m,color:(c==null?void 0:c.color)||"dark"},{default:a(()=>[l(v,{icon:(c==null?void 0:c.icon)||e.search},null,8,["icon"]),l(N,{innerHTML:c.text},null,8,["innerHTML"])]),_:2},1032,["onClick","color"]))),128))]),_:1})):h("",!0)]),_:1}),l(W,{"scroll-y":"","scroll-x":""},{default:a(()=>[z("table",Ae,[z("thead",Qe,[(s(!0),C(B,null,L(e.columns,(c,m)=>(s(),C("tr",{key:m},[(s(!0),C(B,null,L(c,(u,F)=>{var D,A;return s(),C("th",{key:F,colspan:((D=u==null?void 0:u.span)==null?void 0:D.thColspan)||1,rowspan:((A=u==null?void 0:u.span)==null?void 0:A.thRowspan)||1,onClick:x=>e.sortColumn(u.ref)},[l(q,{lines:"none"},{default:a(()=>[e.columnSorted&&e.columnSorted===u.ref?(s(),y(v,{key:0,icon:e.sortOrder==="asc"?e.arrowUp:e.arrowDown},null,8,["icon"])):h("",!0),l(N,null,{default:a(()=>[z("b",null,E(u.label),1)]),_:2},1024)]),_:2},1024)],8,Ye)}),128))]))),128))]),z("tbody",null,[(s(!0),C(B,null,L(e.page,(c,m)=>(s(),C("tr",{key:m},[(s(!0),C(B,null,L(c.row,(u,F)=>{var D;return s(),C("td",{key:F,onClick:()=>e.onClickTablecell(u),class:He({"clickable-cell":(D=u==null?void 0:u.column)==null?void 0:D.tdClick})},[z("span",{innerHTML:u.value,class:"his-sm-text"},null,8,qe)],10,_e)}),128))]))),128))])])]),_:1}),l(Z,null,{default:a(()=>[e.showSearchKeyboard?(s(),y(G,{key:0,kbConfig:e.QWERTY,onKeyPress:e.filterTable},null,8,["kbConfig","onKeyPress"])):h("",!0),l(U,{color:"dark"},{default:a(()=>[l(p,{onClick:o[4]||(o[4]=c=>e.toCSV()),size:"large"},{default:a(()=>[...o[6]||(o[6]=[b(" CSV ",-1)])]),_:1}),l(p,{onClick:o[5]||(o[5]=c=>e.toPDF()),size:"large"},{default:a(()=>[...o[7]||(o[7]=[b(" PDF ",-1)])]),_:1}),e.totalPages>1?(s(),y(p,{key:0,onClick:e.first,disabled:e.currentPage===0||e.totalPages<=2,size:"large",slot:"end"},{default:a(()=>[...o[8]||(o[8]=[b(" First ",-1)])]),_:1},8,["onClick","disabled"])):h("",!0),e.totalPages>1?(s(),y(p,{key:1,onClick:e.prev,disabled:!e.canPrev,color:"light",size:"large",slot:"end"},{default:a(()=>[...o[9]||(o[9]=[b(" Prev ",-1)])]),_:1},8,["onClick","disabled"])):h("",!0),e.totalPages>1?(s(),y(p,{key:2,onClick:e.selectPage,size:"large",slot:"end",color:"light"},{default:a(()=>[b(E(e.currentPage)+" / "+E(e.totalPages-1),1)]),_:1},8,["onClick"])):h("",!0),e.totalPages>1?(s(),y(p,{key:3,onClick:e.next,disabled:!e.canNext,color:"light",size:"large",slot:"end"},{default:a(()=>[...o[10]||(o[10]=[b(" Next ",-1)])]),_:1},8,["onClick","disabled"])):h("",!0),e.totalPages>1?(s(),y(p,{key:4,onClick:e.last,disabled:e.currentPage+1>=e.totalPages||e.totalPages<=2,size:"large",slot:"end"},{default:a(()=>[...o[11]||(o[11]=[b(" Last ",-1)])]),_:1},8,["onClick","disabled"])):h("",!0),l(p,{onClick:e.finish,color:"success",size:"large",slot:"end"},{default:a(()=>[...o[12]||(o[12]=[b(" Finish ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const Je=Ue(Le,[["render",We],["__scopeId","data-v-2ab83098"]]);export{Je as v};
