import{F as a}from"./dynamic-import-helper-Bsjrd6Ro.js";import{H as c}from"./HisStandardForm-lonwENLb.js";import{d as m,b5 as b,V as i,ab as T,H as _,ba as v,aU as g,R as y,_ as S,r as F,o as E,c as B}from"./index-DTBWhHAq.js";import{_ as C}from"./EncounterMixin.vue_vue_type_script_lang-DZZc0yNk.js";import{g as p}from"./LocationFieldOptions-C65wr29G.js";import{g as r,E as n}from"./MultiFieldDateHelper-BWKgkEkB.js";import"./TouchScreenForm-BeJsJnwt.js";import"./ToolbarMediumCard-wr9sTFDK.js";import"./Transformers-BPPLlH12.js";import"./ViewPort-DbAo6hHM.js";import"./encounter_guidelines-BDvVJmZ6.js";import"./GuidelineEngine-D6V1_Znr.js";import"./KbLayouts-VRA-vjeH.js";import"./HisKbConfigurations-GhFQZvlg.js";const D=m({mixins:[C],components:{HisStandardForm:c},data:()=>({service:{},labOrderFieldContext:{},tbTests:["Urine Lam","GeneXpert","Culture & Sensitivity","TB Microscopic Exam","FASH"],cmTests:["Serum Crag"],ksTests:["Biopsy"],hasTBresultsWithin6Months:!1,hasCragResultsWithin6Months:!1,minTestDate:""}),watch:{ready:{async handler(t){t&&(this.service=new b(this.patientID,201,this.providerID),this.fields=this.getFields())},immediate:!0}},methods:{async onFinish(t,e){await this.service.createEncounter(),await this.service.saveObservationList(await this.resolveObs(e)),this.nextTask()},availableResultsField(){return{id:"available_results",helpText:"Results available from the last six months?",type:a.TT_MULTIPLE_YES_NO,validation:t=>i.anyEmpty(t),options:t=>{var e,s;return[{label:"Tuberculosis (TB)",value:((e=(t.available_results||[])[0])==null?void 0:e.value)||"",other:{values:this.yesNoOptions(),concept:"TB results from last six months available"}},{label:"Cryptococcal Meningitis(CM)",value:((s=(t.available_results||[])[1])==null?void 0:s.value)||"",other:{values:this.yesNoOptions(),concept:"Cryptococcal Meningitis (CM) results from the last six months available"}}]},computedValue:t=>({tag:"obs",obs:t.map(({other:e,value:s})=>this.service.buildValueCoded(e.concept,s))}),onValueUpdate:t=>(this.hasTBresultsWithin6Months=T.some(t,{value:"Yes",label:"Tuberculosis (TB)"}),this.hasCragResultsWithin6Months=T.some(t,{value:"Yes",label:"Cryptococcal Meningitis(CM)"}),t),beforeNext:()=>{if(this.hasTBresultsWithin6Months||this.hasCragResultsWithin6Months){const t=this.patient.getBirthdate(),e=_.subtract(this.service.date,"years",6);this.minTestDate=e.isBefore(t)?t:e.format("YYYY-MM-DD")}return!0}}},labInvestigationsField(){let t=[];const e=async()=>g.formatLabs(await y.get("GET_LAB_ORDERS_WITH_GIVEN_RESULT_STATUS",{patientID:this.patientID}));return{id:"patient_lab_orders",helpText:"Previous Lab orders",type:a.TT_LAB_ORDERS,init:async()=>(t=await e(),!0),unload:async()=>t=await e(),onload:s=>this.labOrderFieldContext=s,options:()=>[{label:"Lab orders",value:"order trail",other:{values:t}}],config:{printOrder:s=>new v(this.patientID).printLabOrderLbl(s),hiddenFooterBtns:["Clear"]}}},tbTestLocationField(){return{id:"tb_location",helpText:"TB test location",type:a.TT_SELECT,validation:t=>i.required(t),condition:()=>this.hasTBresultsWithin6Months,options:(t,e="")=>p(e),computedValue:t=>({obs:this.service.buildValueText("TB test location",t.label)}),config:{showKeyboard:!0,isFilterDataViaApi:!0}}},cragTestLocationField(){return{id:"crag_location",helpText:"Serum crAg test location",type:a.TT_SELECT,condition:()=>this.hasCragResultsWithin6Months,validation:t=>i.required(t),options:(t,e="")=>p(e),computedValue:t=>({obs:this.service.buildValueText("Serum crAg test location",t.label)}),config:{showKeyboard:!0,isFilterDataViaApi:!0}}},tbTestDateField(){return r({id:"tb_test_date",helpText:"TB Test",required:!0,condition:()=>this.hasTBresultsWithin6Months,minDate:()=>this.minTestDate,maxDate:()=>this.service.date,computeValue:(t,e)=>({date:t,obs:this.buildDateObs("TB Test date",t,e,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:n.MONTH_ESTIMATE_FIELD}})},tbTestResultDateField(){return r({id:"tb_test_result_date",helpText:"TB Test Result",required:!0,condition:()=>this.hasTBresultsWithin6Months,minDate:(t,e)=>e.tb_test_date.date,maxDate:()=>this.service.date,computeValue:(t,e)=>({obs:this.buildDateObs("Tuberculosis test result date",t,e,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:n.MONTH_ESTIMATE_FIELD}})},cragTestDateField(){return r({id:"crag_test_date",helpText:"Serum CrAg Test",required:!0,minDate:()=>this.minTestDate,maxDate:()=>this.service.date,condition:()=>this.hasCragResultsWithin6Months,computeValue:(t,e)=>({obs:this.buildDateObs("Serum crAg test date",t,e,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:n.MONTH_ESTIMATE_FIELD}})},cragResultField(){return{id:"crag_result",helpText:"Serum CrAg result",type:a.TT_SELECT,condition:()=>this.hasCragResultsWithin6Months,validation:t=>i.required(t),computedValue:t=>({obs:this.service.buildValueCoded("Serum crAg result",t.value)}),options:()=>this.mapStrToOptions(["Positive","Negative"])}},tbTestTypeField(){return{id:"tb_test_type",helpText:"TB Test Type",condition:()=>this.hasTBresultsWithin6Months,type:a.TT_SELECT,validation:t=>i.required(t),options:()=>this.mapStrToOptions([...this.tbTests,"Chest X-Ray","Other"]),computedValue:t=>({obs:this.service.buildValueCoded("TB Test type",t.value)})}},tbTestResultField(){return{id:"tb_result",helpText:"TB test result",condition:()=>this.hasTBresultsWithin6Months,type:a.TT_SELECT,validation:t=>i.required(t),computedValue:t=>({obs:this.service.buildValueCoded("TB test result",t.value)}),options:()=>this.mapStrToOptions(["Positive","Negative","Inconclusive"])}},getTbClassification(){return{id:"tb_classification",helpText:"TB Classification",condition:t=>{var e;return this.hasTBresultsWithin6Months&&/positive/i.test((e=t.tb_result)==null?void 0:e.value)},type:a.TT_SELECT,validation:t=>i.required(t),options:()=>this.mapStrToOptions(["Category I TB case","Category II TB case","Category III TB case","Category IV TB case"]),computedValue:t=>({obs:this.service.buildValueCoded("TB classification",t.value)})}},getTbTreatmentStatus(){return{id:"on_tb_treatment",helpText:"On TB Treatment?",type:a.TT_SELECT,condition:t=>{var e;return this.hasTBresultsWithin6Months&&/positive/i.test((e=t.tb_result)==null?void 0:e.value)},validation:t=>i.required(t),computedValue:t=>({obs:this.service.buildValueCoded("TB treatment",t.value)}),options:()=>this.yesNoOptions()}},getTbTreatmentStartDate(){return r({id:"tb_treatment_start_date",helpText:"TB Treatment Start",condition:t=>{var e;return this.hasTBresultsWithin6Months&&/Yes/i.test((e=t.on_tb_treatment)==null?void 0:e.value)},minDate:()=>this.minTestDate,maxDate:()=>this.service.date,computeValue:(t,e)=>({obs:this.buildDateObs("TB treatment start date",t,e,this.service)}),estimation:{allowUnknown:!0,estimationFieldType:n.MONTH_ESTIMATE_FIELD}})},getTbTreatmentPeriod(){return{id:"tb_treatment_period",helpText:"TB Treatment period (In months)",type:a.TT_NUMBER,validation:t=>i.validateSeries([()=>i.required(t),()=>i.isNumber(t),()=>i.rangeOf(t,3,9)]),condition:t=>{var e;return this.hasTBresultsWithin6Months&&/Yes/i.test((e=t.on_tb_treatment)==null?void 0:e.value)},computedValue:t=>({obs:this.service.buildValueNumber("TB treatment period",t.value)})}},ksSymptomsField(){return{id:"ks_symptoms",helpText:"Kaposi Sarcoma (KS) associated symptoms",type:a.TT_MULTIPLE_YES_NO,validation:t=>i.required(t),computedValue:t=>t?t.map(e=>this.service.buildValueCoded(e.label,e.value)):null,options:t=>t.ks_symptoms?t.ks_symptoms:[this.toYesNoOption("Enlarged Lymph Nodes on Neck"),this.toYesNoOption("Enlarged Lymph Nodes on Armpits"),this.toYesNoOption("Enlarged Lymph Nodes on Groin"),this.toYesNoOption("Patches or Nodes on Neck"),this.toYesNoOption("Patches or Nodes on Armpits"),this.toYesNoOption("Patches or Nodes on Groin")]}},ksLabInvestigationField(){return{id:"ks_lab",helpText:"KS Biopsy test",type:a.TT_YES_NO,appearInSummary:()=>!1,validation:t=>i.required(t),options:()=>[{label:"Order Biopsy test?",values:this.yesNoOptions()}]}},ksDiagnosisField(){return{id:"ks_diagnosis",helpText:"KS diagnosis",type:a.TT_SELECT,validation:t=>i.required(t),options:()=>this.mapStrToOptions(["Positive","Negative"])}},ksStagingField(){return{id:"ks_staging",helpText:"Ks staging",type:a.TT_MULTIPLE_SELECT,beforeNext:async(t,e)=>{const s=[];return(!this.hasTBresultsWithin6Months||/Inconclusive/i.test(e.tb_result))&&s.push(...this.tbTests),(!this.hasCragResultsWithin6Months||/Positive/i.test(e.crag_result))&&s.push(...this.cmTests),/Yes/i.test(e.ks_lab)&&s.push(...this.ksTests),T.isEmpty(this.labOrderFieldContext)||await this.labOrderFieldContext.launchOrderSelection(s),!0},validation:t=>i.required(t),options:()=>this.mapStrToOptions(["KS stage T0","KS stage T1"]),config:{buildOptionsOnce:!0}}},summary(){return{id:"summary",helpText:"AHD Summary",type:a.TT_SUMMARY,options:t=>{var s,l,u,h,o;const e=[];return e.push({label:"TB",value:(s=t.tb_result)!=null&&s.value?"".concat((l=t.tb_test_type)==null?void 0:l.value," ").concat((u=t.tb_result)==null?void 0:u.value):"N/A"}),e.push({label:"CM",value:(h=t.crag_result)!=null&&h.value?"Serum CrAg ".concat((o=t.crag_result)==null?void 0:o.value):"N/A"}),e.push({label:"KS",value:t.ks_symptoms.every(d=>d.value==="No")?"No symptoms":"".concat(t.ks_symptoms.filter(d=>d.value==="Yes").length," symptom(s) recorded")}),e}}},getFields(){return[this.labInvestigationsField(),this.availableResultsField(),this.tbTestLocationField(),...this.tbTestDateField(),this.tbTestTypeField(),...this.tbTestResultDateField(),this.tbTestResultField(),this.getTbClassification(),this.getTbTreatmentStatus(),...this.getTbTreatmentStartDate(),this.getTbTreatmentPeriod(),this.cragTestLocationField(),...this.cragTestDateField(),this.cragResultField(),this.ksSymptomsField(),this.ksLabInvestigationField(),this.ksDiagnosisField(),this.ksStagingField(),this.summary()]}}});function O(t,e,s,l,u,h){const o=F("his-standard-form");return E(),B(o,{skipSummary:!0,fields:t.fields,onFinishAction:t.onFinish,cancelDestinationPath:t.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])}const q=S(D,[["render",O]]);export{q as default};
