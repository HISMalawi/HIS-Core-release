System.register(["./EncounterMixin.vue_vue_type_script_lang-legacy-qUwf12Yn.js","./index-legacy-CA6M7ipO.js","./anc_current_pregnancy-legacy-W9yvtvOX.js","./encounter_guidelines-legacy-Bcz_Mw7r.js","./GuidelineEngine-legacy-KsvQuFdF.js","./HisStandardForm-legacy-a9YJRGaH.js"],(function(e,t){"use strict";var i,n,s,o,a,r,l,u,c,d,h,p,v,m,T,g,b;return{setters:[e=>{i=e._},e=>{n=e.bQ,s=e.d,o=e.I,a=e.bx,r=e.ad,l=e.ae,u=e.aN,c=e.aj,d=e.dO,h=e.aa,p=e.af,v=e.a,m=e.c,T=e.w,g=e.b},e=>{b=e.A},null,null,null],execute:function(){const t={12:14,13:15,14:16,15:17,16:18,17:19,18:20,19:22,20:23,21:24,22:25,23:26,24:27,24.5:28,25:29,26:30,27:31,28:32,29:33,30:34,31:35,31.5:36,32:37,33:38,34:39,35:40,36:42};class f extends n{gestationWeeks;visitNumber;constructor(e,t){super(e,98,t),this.gestationWeeks=0,this.visitNumber=0}isFirstVisit(){return 1===this.visitNumber}expectedFundalHeightForGestationWeeks(){return this.getEquivalentFundalHeight(this.gestationWeeks)}async loadPregnancyStatus(){const e=await n.getJson(`programs/${this.programID}/patients/${this.patientID}`);if(e){const t=e.date_of_lnmp;if(t){const i=new b(this.patientID,this.providerID);this.gestationWeeks=i.calculateWeekOfFirstVisit(t),this.visitNumber=e.anc_visits??0}}}getEquivalentFundalWeeks(e){return e<12?t[12]:e>37?t[37]:t[e]}getEquivalentFundalHeight(e){for(const i in t)if(e<=t[i])return parseInt(i);return e>42?37:e<13?12:0}}const O=s({components:{IonPage:o},mixins:[i],data:()=>({service:{},statusService:{},deliveryObs:void 0}),watch:{ready:{async handler(e){e&&(this.service=new f(this.patientID,this.providerID),await this.service.loadPregnancyStatus(),this.fields=this.getFields())},immediate:!0}},methods:{async onFinish(e,t){await this.service.createEncounter(),await this.service.saveObservationList(await this.resolveObs(t)),this.deliveryObs?.length&&(await this.statusService.createEncounter(),await this.statusService.saveObservationList(await Promise.all(this.deliveryObs))),this.nextTask()},diagnosisOptions(e){return[...a.getConceptsByCategory("anc_diagnosis"),{name:"None"}].map((t=>e({...this.toOption(t.name),isChecked:!1})))},getFields(){return[{id:"ultrasound",helpText:"Ultrasound scan results available",type:r.TT_SELECT,validation:e=>l.required(e),computedValue:e=>this.service.buildValueCoded("Ultrasound",e.value),options:()=>this.yesNoOptions()},{id:"multiple_gestation",helpText:"Number of fetuses",type:r.TT_SELECT,validation:e=>l.required(e),computedValue:e=>this.service.buildValueText("Multiple gestation",e.value),condition:e=>"Yes"===e.ultrasound.value,options:()=>[{label:"One",value:1},{label:"Two",value:2},{label:"Three",value:3},{label:"Four",value:4},{label:"Unknown",value:"Unknown"}]},{id:"liquor",helpText:"Liquor",type:r.TT_SELECT,validation:e=>l.required(e),computedValue:e=>this.service.buildValueText("LIQUOR",e.value),condition:e=>"Yes"===e.ultrasound.value,options:()=>this.mapStrToOptions(["Adequate","Not adequate","Unknown"])},{id:"lie",helpText:"Lie",type:r.TT_SELECT,validation:e=>l.required(e),computedValue:e=>this.service.buildValueText("Lie",e.value),condition:e=>"Yes"===e.ultrasound.value,options:()=>this.mapStrToOptions(["Longitudinal","Transverse","Unknown"])},{id:"fetal_heart_movement_seen",helpText:"Fetal heart movement seen",type:r.TT_SELECT,validation:e=>l.required(e),computedValue:e=>this.service.buildValueCoded("Fetal heart movement seen",e.value),condition:e=>"Yes"===e.ultrasound.value,options:()=>this.yesNoOptions()},{id:"presentation",helpText:"Presentation",type:r.TT_GROUP_SELECTOR,validation:e=>this.validateSeries([()=>l.required(e),()=>e&&!e.value?["Presentation cannot be Empty!"]:null,()=>e&&e?.other?.subGroupOptions&&u.isEmpty(e?.other?.subGroupOptionValue)?[`${e?.other?.subgroupTitle||"Subgroup"} has no value selected`]:null,()=>!e||u.isEmpty(e?.other?.subGroupOptionValue)||u.isEmpty(e?.other?.subGroupOptionValue?.other?.options)||e?.other?.subGroupOptionValue?.value?null:[`${e?.other?.subGroupOptionValue?.label}'s value isnt selected`]]),computedValue:e=>{const t=[this.service.buildValueText("Presentation",e.label)];return e?.other?.subGroupOptionValue?.value&&t.push(this.service.buildValueText("Position",e?.other?.subGroupOptionValue?.value)),t},options:e=>{const t=(e,t="",i={})=>({label:e,value:t,other:i}),i=[t("Vertex","",{options:this.mapStrToOptions(["Left Occipito Anterior","Left Occipito Transverse","Left Occipito Posterior","Right Occipito Anterior","Right Occipito Transverse","Right Occipito Posterior","Unknown"])}),this.toOption("Oblique"),this.toOption("Transverse"),this.toOption("Breech",{options:this.mapStrToOptions(["Left Sacro Anterior","Left Sacro Transverse","Left Sacro Posterior","Right Sacro Anterior","Right Sacro Transverse","Right Sacro Posterior","Unknown"])}),t("Face","",{concept:"Position",options:this.mapStrToOptions(["Left Mento Anterior","Left Mento Transverse","Left Mento Posterior","Right Mento Anterior","Right Mento Transverse","Right Mento Posterior","Unknown"])}),t("Shoulder","",{options:this.mapStrToOptions(["Left Acromion Dorsal Anterior","Left Acromion Dorsal Transverse","Left Acromion Dorsal Posterior","Right Acromion Dorsal Anterior","Right Acromion Dorsal Transverse","Right Acromion Dorsal Posterior","Unknown"])})];return e.presentation?e.presentation:[t("Cephalic","",{subGroupOptions:i,subgroupTitle:"Cephalic Position",options:this.mapStrToOptions(["Right Occipito Anterior","Left Occipito Anterior","Unknown"])}),t("Breech","",{subGroupOptions:i,subgroupTitle:"Breech Position",options:this.mapStrToOptions(["Right Sacro Anterior","Left Sacro Anterior","Unknown"])}),this.toOption("Ball"),this.toOption("Nil palpable")]}},{id:"enter_fundal_height",helpText:"Fundal height (cm)",type:r.TT_NUMBER,condition:()=>this.service.gestationWeeks>=12,dynamicHelpText:()=>{const e="Fundal height (cm)";return this.service.gestationWeeks?`${e} (${this.service.gestationWeeks}wks/${this.service.getEquivalentFundalHeight(this.service.gestationWeeks)} cm)`:e},beforeNext:async(e,t)=>{if(e&&`${e.value}`.match(/unknown/i)&&!["Nil palpable","Ball"].includes(t.presentation.value))return c("Do you want to proceed with Unknown Fundal height?");const i=this.service.expectedFundalHeightForGestationWeeks(),n=parseInt(e.value);if(this.service.gestationWeeks&&(n<i||n>i)){if(!(await c(`\n                        Fundal height is not equal to expected ${i} cm from gestation weeks of ${this.service.gestationWeeks}.\n                        Are you sure about this value?`)))return!1;if(this.service.isFirstVisit()){this.statusService=new b(this.patientID,this.providerID);const e=this.service.getEquivalentFundalWeeks(n),t=this.statusService.estimateLnmpDate(e,this.service.date);this.deliveryObs=this.statusService.buildDelieveryDateObs(t)}}return!0},validation:e=>this.validateSeries([()=>l.required(e),()=>e&&!`${e.value}`.match(/unknown/i)?l.rangeOf(e,10,45):null]),computedValue:e=>"Unknown"!=e.value?this.service.buildValueNumber("Fundus",e.value):this.service.buildObs("Fundus",{value_coded:e.value,value_numeric:0}),config:{keypad:d}},{id:"fetal_heart_beat",helpText:"Fetal heart beat",type:r.TT_SELECT,validation:e=>l.required(e),computedValue:e=>this.service.buildValueText("Fetal Heart Beat",e.value),options:()=>this.mapStrToOptions(["Heard","Not heard"])},{id:"fetal_heart_rate",helpText:"Fetal heart rate",type:r.TT_NUMBER,validation:e=>l.required(e),beforeNext:async e=>{const t=e?parseInt(e.value):-1;return!e||"number"!=typeof t||!(t<120||t>140)||!!(await c("\n                            The value is out of Range of 120 - 140.\n                            Are you sure about this value?"))},condition:e=>"Heard"===e.fetal_heart_beat.value,computedValue:e=>"Unknown"!=e.value?this.service.buildValueNumber("Fetal heart movement seen",e.value):this.service.buildObs("Fetal heart movement seen",{value_numeric:0,value_coded:e.value}),config:{keypad:d}},{id:"enter_fetal_movement",helpText:"Fetal movement heard",type:r.TT_SELECT,validation:e=>l.required(e),computedValue:e=>this.service.buildValueCoded("Fetal movement heard",`${e.value}`),options:()=>this.yesNoOptions()},{id:"fetal_movement_felt",helpText:"Fetal movement felt",type:r.TT_SELECT,validation:e=>l.required(e),condition:e=>!["Ball","Nil palpable"].includes(e.presentation.label),computedValue:e=>this.service.buildValueCoded("Fetal movement felt",`${e.value}`),options:()=>this.yesNoOptions()},{id:"last_fmf",helpText:"Last fetal movement felt (in Weeks)",type:r.TT_NUMBER,validation:e=>l.validateSeries([()=>l.required(e),()=>l.rangeOf(e,0,42)]),condition:e=>"Unknown"!=e.fetal_movement_felt.value,computedValue:e=>"Unknown"!=e.value?this.service.buildValueNumber("Last Fetal movement felt",e.value):this.service.buildObs("Last Fetal movement felt",{value_numeric:0,value_coded:e.value}),options:()=>this.yesNoUnknownOptions()},{id:"diagnosis",helpText:"Diagnosis",type:r.TT_MULTIPLE_SELECT,validation:e=>l.required(e),computedValue:e=>e&&e.map((e=>e.value)).includes("None")?[]:e.map((e=>this.service.buildValueCoded(e.label,"Yes"))),onValueUpdate:(e,t)=>e.map((e=>("None"===t.value&&"None"!=e.value&&(e.isChecked=!1),"None"!=t.value&&t.isChecked&&"None"===e.value&&(e.isChecked=!1),e))),options:()=>this.diagnosisOptions((e=>e)),config:{footerBtns:[{name:"None",slot:"end",onClickComponentEvents:{refreshOptions:()=>this.diagnosisOptions((e=>(e.isChecked="None"===e.label,e)))},onClick:()=>"None"}]}}]}}});e("default",h(O,[["render",function(e,t,i,n,s,o){const a=p("his-standard-form"),r=p("ion-page");return v(),m(r,null,{default:T((()=>[g(a,{fields:e.fields,skipSummary:!0,onFinishAction:e.onFinish,cancelDestinationPath:e.cancelDestination},null,8,["fields","onFinishAction","cancelDestinationPath"])])),_:1})}]]))}}}));
