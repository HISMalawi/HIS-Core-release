import{H as y}from"./HisStandardForm-7DlnDJZP.js";import{bH as H,d as I,r as C,a9 as o,aa as s,bP as d,aL as r,bQ as u,u as L,v as R,w as k,x as O,y as c,a5 as U,O as T}from"./index-ATRrruTT.js";import{u as N}from"./useEncounter-DD-d41Xj.js";import{y as v,m as _,r as q}from"./commons-C_qhrxz8.js";import"./isEmpty-DB6b62pN.js";import"./encounter_guidelines-BqqB3D2c.js";import"./GuidelineEngine-D6V1_Znr.js";class l extends H{constructor(a,n){super(a,39,n)}}const j=I({__name:"HIVStatus",setup(m){let a;const n=C([]),{patientDashboardUrl:p,goToNextTask:f}=N((e,t,i)=>{a=new l(t,e),n.value=[g(),...F(i),x(),A(),E(),...h(i),...S(i),V(),D()]});async function b(e,t){if(!await a.createEncounter())return T("Unable to create encounter");const w=await q({...t});if(!await a.saveObservationList(w))return T("Unable to save observations");f()}function D(){return{id:"advised_to_visit_art",helpText:"Advised to visit ART",type:o.TT_SELECT,options:v,condition:e=>e.received_arvs.value!=="Yes",computedValue:e=>({obs:a.buildValueCoded("Advised to visit ART",e.value)})}}function V(){return{id:"art_clinic_location",helpText:"ART clinic location",type:o.TT_SELECT,computedValue:e=>({obs:a.buildValueText("ART clinic location",e.label)}),validation:e=>s.required(e),condition:e=>/Yes|Defaulter/i.test(e.received_arvs.value),options:(e,t="")=>d(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}}}function h(e){return r({id:"date_started_art",helpText:"Started ART",required:!0,condition:t=>t.received_arvs.value==="Yes",minDate:()=>{var t;return"".concat((t=e==null?void 0:e.getBirthdate())!=null?t:"")},maxDate:()=>a.getDate(),estimation:{allowUnknown:!0,estimationFieldType:u.MONTH_ESTIMATE_FIELD},computeValue:(t,i)=>a.buildDateObs("Date ART started",t,i)})}function S(e){return r({id:"date_defualted_art",helpText:"ART Default",required:!0,condition:t=>t.received_arvs.value==="Defaulter",minDate:()=>{var t;return"".concat((t=e==null?void 0:e.getBirthdate())!=null?t:"")},maxDate:()=>a.getDate(),estimation:{allowUnknown:!0,estimationFieldType:u.MONTH_ESTIMATE_FIELD},computeValue:(t,i)=>a.buildDateObs("ART default date",t,i)})}function A(){return{id:"cpt_started",helpText:"CPT Started",type:o.TT_SELECT,options:v,condition:e=>e.hiv_status.value==="Reactive",computedValue:e=>({obs:a.buildValueCoded("CPT Started",e.value)})}}function E(){return{id:"received_arvs",helpText:"Started ART?",type:o.TT_SELECT,computedValue:({value:e})=>({obs:a.buildValueCoded("ART Started",e)}),validation:e=>s.required(e),options:()=>_(["Yes","No","Defaulter","Unknown"]),condition:e=>e.hiv_status.value==="Reactive"}}function g(){return{id:"hiv_status",helpText:"HIV status",type:o.TT_SELECT,validation:e=>s.required(e),computedValue:e=>({obs:a.buildValueText("HIV status",e.label)}),options:()=>_(["Reactive","Non-reactive","Unknown"])}}function F(e){return r({id:"hiv_test_date",helpText:"HIV Test",required:!0,minDate:()=>{var t;return"".concat((t=e==null?void 0:e.getBirthdate())!=null?t:"")},maxDate:()=>l.getSessionDate(),condition:t=>t.hiv_status.value!=="Unknown",summaryLabel:"HIV test date",estimation:{allowUnknown:!0,estimationFieldType:u.MONTH_ESTIMATE_FIELD},computeValue:(t,i)=>a.buildDateObs("HIV test date",t,i)})}function x(){return{id:"test_location",helpText:"HIV test location",type:o.TT_SELECT,validation:e=>s.required(e),defaultValue:()=>l.getLocationName(),computedValue:({label:e})=>({obs:a.buildValueText("HIV test location",e)}),condition:e=>e.hiv_status.value!=="Unknown",options:(e,t="")=>d(t),config:{showKeyboard:!0,isFilterDataViaApi:!0}}}return(e,t)=>(L(),R(c(U),null,{default:k(()=>[O(y,{cancelDestinationPath:c(p),fields:n.value,onFinishAction:b,skipSummary:""},null,8,["cancelDestinationPath","fields"])]),_:1}))}});export{j as default};
