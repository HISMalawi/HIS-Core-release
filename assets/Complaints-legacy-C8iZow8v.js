System.register(["./HisStandardForm-legacy-CBeq3UhR.js","./EncounterMixin.vue_vue_type_script_lang-legacy-0QXpnyVP.js","./patient_complaints_service-legacy-BhiMpL0L.js","./index-legacy-B837ziyX.js","./patient_radiology_service-legacy-DK3yF2MG.js","./HisRadiologyPicker-legacy-Ba56twfk.js","./encounter_guidelines-legacy-OE9PGsMi.js","./GuidelineEngine-legacy-KsvQuFdF.js","./SelectMixin-legacy-DgIm0qRC.js","./BaseTextInput-legacy-DXqJ_AmX.js","./FieldMixin.vue_vue_type_script_lang-legacy-BNmlZJTR.js"],(function(e,t){"use strict";var i,a,n,s,l,o,r,d,c,h,u,p,m,g,y,b,v,_,S,C,w,O,T,f,E,I,P,x,R,D,F,B,V,k,j;return{setters:[e=>{i=e.H},e=>{a=e._},e=>{n=e.P},e=>{s=e.d,l=e.l,o=e.m,r=e.a5,d=e.a4,c=e.I,h=e.k,u=e.z,p=e.aZ,m=e.bL,g=e.ak,y=e.ap,b=e.h,v=e.b,_=e.e,S=e.w,C=e.j,w=e.a9,O=e.bn,T=e.n,f=e.am,E=e.al,I=e.au,P=e.bV,x=e.bj,R=e.aB,D=e.bk,F=e.H,B=e.s,V=e.a},e=>{k=e.P},e=>{j=e.default},null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent=".his-table tr{height:50px}\n/*$vite$:1*/",document.head.appendChild(t);const A=s({name:"Modal",components:{IonButton:h,IonContent:c,IonHeader:d,IonTitle:r,IonToolbar:o,IonFooter:l,HisRadiologyPicker:j},mixins:[a],data:()=>({radiologyService:{},isPacsEnabled:!1,emitedSelectedOptions:{}}),watch:{ready:{async handler(e){e&&(this.radiologyService=new k(this.patientID,this.providerID),this.isPacsEnabled=await m.isPACsEnabled())},immediate:!0,deep:!0}},methods:{async onValue(e){this.emitedSelectedOptions=e},async getSelected(){return this.emitedSelectedOptions.map((async e=>({...await this.radiologyService.buildValueCoded("Radiology Orders",e.other.parent),child:[await this.radiologyService.buildValueCodedFromConceptId(e.other.parent,e.other.concept_id)]})))},async onSubmit(){if(!p.isEmpty(this.emitedSelectedOptions)){this.closeModal();let t=await this.getSelected();t=await Promise.all(t),await this.radiologyService.createEncounter();const i=await this.radiologyService.obsObj(t),a=await this.radiologyService.saveObservationList(i);if(await this.radiologyService.printOrders(a,this.patient),this.isPacsEnabled)try{await this.radiologyService.submitToPacs(a,this.patient)}catch(e){console.log(e)}}},async closeModal(){await u.dismiss([])}}}),L=g(A,[["render",function(e,t,i,a,n,s){const l=y("ion-title"),o=y("ion-toolbar"),r=y("ion-header"),d=y("his-radiology-picker"),c=y("ion-content"),h=y("ion-button"),u=y("ion-footer");return v(),b(w,null,[_(r,null,{default:S((()=>[_(o,null,{default:S((()=>[_(l,{class:"his-lg-text"},{default:S((()=>[...t[2]||(t[2]=[C("Radiology Examination",-1)])])),_:1})])),_:1})])),_:1}),_(c,{style:{overflow:"hidden",background:"grey",height:"70vh"}},{default:S((()=>[_(d,{onOnValue:e.onValue},null,8,["onOnValue"])])),_:1}),_(u,null,{default:S((()=>[_(o,null,{default:S((()=>[_(h,{onClick:t[0]||(t[0]=t=>e.onSubmit()),size:"large",slot:"end",disabled:0===e.emitedSelectedOptions.length},{default:S((()=>[...t[3]||(t[3]=[C(" Place orders ",-1)])])),_:1},8,["disabled"]),_(h,{onClick:t[1]||(t[1]=t=>e.closeModal()),size:"large",slot:"start",color:"danger"},{default:S((()=>[...t[4]||(t[4]=[C(" Close ",-1)])])),_:1})])),_:1})])),_:1})],64)}]]),M=s({components:{HisStandardForm:i,IonPage:T},mixins:[a],data:()=>({complaintsService:{},todaysDate:O.getSessionDate(),presentingComplaints:"",isPacsEnabled:!1,radiologyBtnName:"Radiology Order",hasTriageComplaints:!1,labOrderFieldContext:{},labOrders:[]}),watch:{ready:{async handler(e){e&&(this.complaintsService=new n(this.patientID,this.providerID),this.isPacsEnabled=await m.isPACsEnabled(),this.hasTriageComplaints=await this.getTriagePresentingComplaints(),this.fields=this.getFields())},immediate:!0,deep:!0}},methods:{async onSubmit(e,t){try{const e=await this.resolveObs(t,"complaints");await this.complaintsService.createEncounter(),await this.complaintsService.saveObservationList(e),this.nextTask()}catch(i){console.error(i),B("An error occurred while saving the complaints")}},async launchRadiologyOrderSelection(){const e=await u.create({component:L,backdropDismiss:!1,cssClass:"large-modal"});e.present(),await e.onDidDismiss()},async getTriagePresentingComplaints(){if(!((await this.complaintsService.fetchLatestTriageEncounter()).length>0))return!1;const e=(await D.getEncounters(this.patientID,this.todaysDate)).filter((function(e){return"TRIAGE PRESENTING COMPLAINTS"==e.type.name&&F.toStandardHisFormat(e.encounter_datetime)==O.getSessionDate()}));return e.length>0&&(this.presentingComplaints=e[0].observations,!0)},buildResults(){let e="",t=this.presentingComplaints.map((t=>{if(null!=t.obs_group_id)return[e,t.value_text];e=t.value_text}));return t=t.filter((e=>null!=e)),this.presentingComplaints=t,[{label:"",value:"",other:{columns:["Group","Presenting complaints"],rows:t}}]},getFields(){return[{id:"triage_complaints",helpText:"Triaging Complaints",condition:()=>this.hasTriageComplaints,type:f.TT_TABLE_VIEWER,options:()=>this.buildResults(),config:{hiddenFooterBtns:["Clear"]}},{id:"complaints",helpText:"Presenting Complaints",type:f.TT_COMPLAINTS_PICKER,validation:e=>E.required(e),computedValue:e=>({tag:"complaints",obs:e.filter((e=>!/other (specify)/i.test(e.label))).map((async e=>({...await this.complaintsService.buildValueCoded("Presenting complaint",e.other.parent),child:[await this.complaintsService.buildValueCodedFromConceptId(e.other.parent,e.other.concept_id)]})))})},{id:"other_complaints",helpText:"Other Complaints",type:f.TT_TEXT,condition:e=>e.complaints.some((e=>"Other (specify)"===e.label&&e.isChecked)),computedValue:async e=>({tag:"complaints",obs:{...await this.complaintsService.buildValueCoded("Presenting complaint","Other"),child:[await this.complaintsService.buildValueText("Other",e.label)]}})},{id:"lab_order",helpText:"Lab Orders",type:f.TT_LAB_ORDERS,onload:e=>this.labOrderFieldContext=e,init:async()=>(this.labOrders=x.formatLabs(await R.get("GET_LAB_ORDERS_WITH_GIVEN_RESULT_STATUS",{patientID:this.patientID})),!0),unload:async()=>{const e=this.labOrders.filter((e=>"No"===e.result_given));if(e.length&&await I("Result(s) Given to Client?")){const t=new P(this.patientID,-1,this.providerID),i=e.reduce(((e,i)=>[...e,...i.resultIds.map((async e=>(t.encounterID=i.encounter_id,t.saveObs(await t.buildObs("Result Given to Client",{value_coded:"Yes",obs_group_id:e})))))]),[]);await Promise.all(i)}},options:()=>[{label:"Lab orders",value:"order trail",other:{values:this.labOrders}}],config:{hiddenFooterBtns:[this.showRadiologyOdersBtn()],footerBtns:[{name:"Order",size:"large",slot:"end",color:"primary",visible:!0,onClick:async()=>{p.isEmpty(this.labOrderFieldContext)||await this.labOrderFieldContext.launchOrderSelection()}},{name:this.radiologyBtnName,size:"large",slot:"end",color:"primary",visible:!0,onClick:async()=>await this.launchRadiologyOrderSelection(),visibleOnStateChange:e=>1===e.index}]}},{id:"all_presenting_complaints",helpText:"Summary",condition:()=>this.presentingComplaints.length>0,type:f.TT_SUMMARY,options:e=>this.buildSummaryResults(e),config:{hiddenFooterBtns:["Clear"]}}]},showRadiologyOdersBtn(){return this.isPacsEnabled?"":this.radiologyBtnName},buildSummaryResults(e){const t=e.complaints.map((e=>({label:"OPD Complaints",value:e.label}))),i=this.presentingComplaints.map((e=>({label:"Triaging Complaints",value:e[1]})));return t.concat(i)}}});e("default",g(M,[["render",function(e,t,i,a,n,s){const l=y("his-standard-form"),o=y("ion-page");return v(),V(o,null,{default:S((()=>[_(l,{cancelDestinationPath:e.cancelDestination,fields:e.fields,onFinishAction:e.onSubmit,skipSummary:!0},null,8,["cancelDestinationPath","fields","onFinishAction"])])),_:1})}]]))}}}));
