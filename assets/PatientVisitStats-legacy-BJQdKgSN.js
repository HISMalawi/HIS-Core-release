System.register(["./index-legacy-D1EyWbyq.js","./ViewPort-legacy-Dt6qML7b.js","./HisStandardForm-legacy-Yzj84zTJ.js","./ReportMixin.vue_vue_type_script_lang-legacy-Dge918Ae.js","./TouchScreenForm-legacy-Cz0UXr2y.js","./dynamic-import-helper-legacy-DYK5bIOV.js","./ToolbarMediumCard-legacy-DG4P2wyL.js","./Transformers-legacy-DhNYVLaS.js","./MultiFieldDateHelper-legacy-CWf2uW0i.js","./KbLayouts-legacy-BKvPSxzZ.js","./HisKbConfigurations-legacy-vrLd9Pgz.js","./BasicReportTemplate-legacy-CCzmEXag.js","./Export-legacy-dCfnaBFd.js","./SIngleTouchField-legacy-25qOOxkK.js","./Pagination-legacy-zx7G8OyX.js"],(function(t,e){"use strict";var a,n,i,s,r,o,l,d,c,h,p,u,g,m,y,P,f,w,b,_,v,x,j,k,S,T,A,D,C,I,V,F,O;return{setters:[t=>{a=t.d,n=t.co,i=t.I,s=t.j,r=t.k,o=t.i,l=t.l,d=t.m,c=t.f,h=t.cp,p=t.aN,u=t.P,g=t.L,m=t.ab,y=t.O,P=t._,f=t.r,w=t.o,b=t.x,_=t.c,v=t.z,x=t.w,j=t.F,k=t.b,S=t.u,T=t.A,A=t.v,D=t.bs,C=t.a3,I=t.a4},t=>{V=t.V},t=>{F=t.H},t=>{O=t._},null,null,null,null,null,null,null,null,null,null,null],execute:function(){var e=document.createElement("style");e.textContent="a[data-v-a93c0f70]{font-weight:700;text-decoration:none}#view-port[data-v-a93c0f70]{height:77vh}\n",document.head.appendChild(e);const N=a({components:{ApexChart:n,IonPage:i,IonHeader:s,IonTitle:r,IonToolbar:o,IonContent:l,IonFooter:d,IonButton:c,ViewPort:V,HisStandardForm:F},mixins:[O],data:()=>({patients:{},reportData:{},chartType:"area",height:"100%",width:"100%",canShowReport:!1,report:{},series:[],patientPresent:{},guardianPresent:{},bothPresent:{},chartOptions:{title:{text:"HIV Reception encounters"},yaxis:{title:{text:"Number of clients"},plotAreaHeight:800},xaxis:{type:"datetime"},markers:{size:8,hover:{sizeOffset:3}}}}),created(){this.fields=this.getDateDurationFields()},computed:{totalAttendance(){let t=[];return Object.keys(this.reportData).forEach((e=>{t=t.concat(Object.keys(this.reportData[e]).map((t=>({patient_id:t,date:e}))))})),t},totalPatientVisits(){return Object.keys(this.patientPresent).reduce(((t,e)=>t.concat(this.patientPresent[e].map((t=>({patient_id:t,date:e}))))),[])},totalGuardianVisits(){return Object.keys(this.guardianPresent).reduce(((t,e)=>t.concat(this.guardianPresent[e].map((t=>({patient_id:t,date:e}))))),[])}},methods:{async onPeriod(t,e){await this.presentLoading(),this.reportData={},this.canShowReport=!0,this.patientPresent={},this.guardianPresent={},this.report=new h,this.report.setStartDate(e.start_date),this.report.setEndDate(e.end_date),this.reportData=await this.report.getPatientVisitTypes(),this.series=this.buildSeries(this.reportData),p.dismiss()},async presentLoading(){(await p.create({message:"Please wait...",backdropDismiss:!1})).present()},async getCachedPatient(t){if(!(t in this.patients)){const e=await u.findByID(t);this.patients[t]=new u(e)}return this.patients[t]},async drillPatients(t,e){const a=[[g.thTxt("ARV Number"),g.thTxt("First name"),g.thTxt("Last name"),g.thTxt("Gender"),g.thTxt("Visit date"),g.thTxt("Action")]];this.drilldownData(t,a,e,(async t=>{const e=t.map((async t=>{const e=await this.getCachedPatient(t.patient_id);try{return[this.tdARV(e.getArvNumber()),g.td(e.getGivenName()),g.td(e.getFamilyName()),g.td(this.formatGender(e.getGender())),g.tdDate(t.date),g.tdBtn("Show",(async()=>{await y.dismiss({}),this.$router.push({path:`/patient/dashboard/${t.patient_id}`})}))]}catch(a){return[g.td("N/A"),g.td("N/A"),g.td("N/A"),g.td("N/A"),g.td("N/A"),g.tdBtn("Show",(async()=>{await y.dismiss({}),this.$router.push({path:`/patient/dashboard/${t.patient_id}`})}))]}}));return Promise.all(e)}))},onPointSelection(t,e,{dataPointIndex:a,seriesIndex:n}){try{const t=n<=0?0:n,e=this.series[t].data[a],i=this.series[t].raw[a],s=Array.from({length:i.length},((t,a)=>({patient_id:i[a],date:new Date(e[0]).toISOString()})));this.drillPatients("Point selection",s)}catch(i){console.log("Error loading point selection data")}},buildSeries(t){const e=m.uniq(Object.keys(t)),a=(e,a,n)=>{e in a||(a[e]=[]);const i=Object.entries(t[e]).filter((([,t])=>n(t.patient_present,t.guardian_present))).map((([t])=>t));return a[e]=[...a[e],...i],a},n=t=>e.map((e=>[new Date(e).getTime(),t[e].length])),i=t=>e.map((e=>t[e]));for(const s in t)a(s,this.patientPresent,((t,e)=>t&&!e)),a(s,this.guardianPresent,((t,e)=>!t&&e)),a(s,this.bothPresent,((t,e)=>t&&e));return[{name:"Patient present",raw:i(this.patientPresent),data:n(this.patientPresent)},{name:"Guardian present",raw:i(this.guardianPresent),data:n(this.guardianPresent)},{name:"Both patient and guardian present",raw:i(this.bothPresent),data:n(this.bothPresent)}]}}}),G=t=>(C("data-v-a93c0f70"),t=t(),I(),t),R=G((()=>T("br",null,null,-1))),H=G((()=>T("br",null,null,-1))),B={class:"view-port-content"};t("default",P(N,[["render",function(t,e,a,n,i,s){const r=f("his-standard-form"),o=f("ion-title"),l=f("ion-toolbar"),d=f("ion-header"),c=f("ApexChart"),h=f("view-port"),p=f("ion-content"),u=f("ion-button"),g=f("ion-footer"),m=f("ion-page");return w(),b(j,null,[t.canShowReport?v("",!0):(w(),_(r,{key:0,onOnFinish:t.onPeriod,skipSummary:!0,fields:t.fields},null,8,["onOnFinish","fields"])),t.canShowReport?(w(),_(m,{key:1},{default:x((()=>[k(d,null,{default:x((()=>[k(l,null,{default:x((()=>[k(o,null,{default:x((()=>[S(" Total Attendance: "),T("a",{href:"#",onClick:e[0]||(e[0]=D((()=>t.drillPatients("Total attendance",t.totalAttendance)),["prevent"]))},A(t.totalAttendance.length),1),R,S(" Patient visit: "),T("a",{href:"#",onClick:e[1]||(e[1]=D((()=>t.drillPatients("Total patient visits",t.totalPatientVisits)),["prevent"]))},A(t.totalPatientVisits.length),1),H,S(" Guardian visit: "),T("a",{href:"#",onClick:e[2]||(e[2]=D((()=>t.drillPatients("Guardian visits",t.totalGuardianVisits)),["prevent"]))},A(t.totalGuardianVisits.length),1)])),_:1})])),_:1})])),_:1}),k(p,null,{default:x((()=>[k(h,null,{default:x((()=>[T("div",B,[k(c,{width:t.width,height:t.height,type:t.chartType,options:t.chartOptions,series:t.series,onMarkerClick:t.onPointSelection},null,8,["width","height","type","options","series","onMarkerClick"])])])),_:1})])),_:1}),k(g,null,{default:x((()=>[k(l,{color:"dark"},{default:x((()=>[k(u,{onClick:e[3]||(e[3]=e=>t.canShowReport=!1),slot:"start",size:"large"},{default:x((()=>[S(" New Date ")])),_:1}),k(u,{slot:"end",size:"large","router-link":"/",color:"success"},{default:x((()=>[S(" Finish ")])),_:1})])),_:1})])),_:1})])),_:1})):v("",!0)],64)}],["__scopeId","data-v-a93c0f70"]]))}}}));
