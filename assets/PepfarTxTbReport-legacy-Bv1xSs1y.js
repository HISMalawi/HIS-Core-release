System.register(["./index-legacy-CNrLGT3P.js","./ReportDateSelectionPrompt-legacy-DN4Nhexe.js","./TableView-legacy-DSuuxKFH.js","./ArtDrilldown-legacy-BX7rPIVx.js","./fuse-legacy-CQoBB3MK.js","./HisKeyboard-legacy-DlfcKdJX.js"],(function(e,t){"use strict";var r,a,n,o,s,c,l,i,u,g,p,d,f,m,_,b,w,R,y,h,v,D;return{setters:[e=>{r=e.bT,a=e.cu,n=e.d,o=e.I,s=e.cm,c=e.K,l=e.N,i=e.af,u=e.O,g=e.n,p=e.t,d=e.ah,f=e.q,m=e._,_=e.r,b=e.o,w=e.c,R=e.w,y=e.b},e=>{h=e.D},e=>{v=e.v},e=>{D=e.A},null,null],execute:function(){class t extends r{constructor(){super()}getTxTbReport(e){return this.getReport("programs/1/reports/tx_tb",{rebuild_outcome:e})}getMaternalStatus(e){const t={start_date:this.startDate,end_date:this.endDate,date:this.date,program_id:this.programID,report_definition:"pepfar"};this.occupation&&(t.occupation=this.occupation);const n=a.parameterizeObjToString(t);return r.postJson(`vl_maternal_status?${n}`,{patient_ids:e})}}const T=n({components:{IonPage:o,IonLoading:s,v2Datatable:v},setup(){const e=c([]),r=c(""),a=c(!1),n=new t,o=(e,t)=>({ref:t,label:e,toValue:e=>e.length,tdClick:async e=>{e.refData.length&&(await u.create({component:D,backdropDismiss:!1,cssClass:"large-modal",componentProps:{subtitle:r,patientIdentifiers:e.refData,title:`${e.data.ageGroup} ${e.data.gender} ${e.column.label}`,onFinish:()=>u.getTop().then((e=>e&&u.dismiss()))}})).present()}}),s=[[{label:"#",ref:"index"},{label:"Age group",ref:"ageGroup"},{label:"Gender",ref:"gender"},o("TX_CURR","tx_curr"),o("Symptom Screen (alone)","symptom_screen_alone"),o("CXR screen","cxr_screen"),o("mWRD screen","mwrd_screen"),o("New on ART/Screen Positive","sceen_pos_new"),o("New on ART/Screen Negative","sceen_neg_new"),o("Already on ART/Screen Positive","sceen_pos_prev"),o("Already on ART/Screen Negative","sceen_neg_prev"),o("TB RX_New on ART","started_tb_new"),o("TB RX_Prev on ART","started_tb_prev")]],m=async(t=!1)=>{if(!n.startDate||!n.endDate)return p("Start date and end date required!");a.value=!0,e.value=[];try{const r=await n.getTxTbReport(t),a={F:"Female",M:"Male"},o=Object.keys(r).reduce(((e,t)=>{if("Unknown"===t)return e;const n=r[t];return Object.keys(n).forEach((r=>{e[r].rows.push({ageGroup:t,gender:a[r],...n[r]}),e[r].aggregate=Object.keys(n[r]).reduce(((e,t)=>Array.isArray(n[r][t])?{...e,[t]:[...e[t]||[],...n[r][t]]}:e),e[r].aggregate)})),e}),{M:{rows:[],aggregate:{}},F:{rows:[],aggregate:{}}});e.value=[...o.F.rows,...o.M.rows,{ageGroup:"All",gender:"Male",...o.M.aggregate}];const s=Object.values(o.F.aggregate).reduce(((e,t)=>e.concat(t)),[]),c=await n.getMaternalStatus(d.uniq(s)),l=c.FBf.concat(c.FP);["FP","FNP","FBf"].forEach((t=>{e.value.push(Object.keys(o.F.aggregate).reduce(((e,r)=>({...e,[r]:o.F.aggregate[r].filter((e=>"FNP"===t?!l.includes(e):c[t].includes(e)))})),{ageGroup:"All",gender:t}))})),e.value=e.value.map(((e,t)=>({index:t+1,...e})))}catch(r){console.error(r),f("Unable to generate report!")}a.value=!1},_=()=>h({onFinish:(e,t,a,o)=>{r.value=`Period: ${a}`,n.startDate=e,n.endDate=t,o&&n.setOccupation(o),m()}});return l((()=>_())),{Img:i,reportData:e,isLoading:a,onRefreshReport:async()=>m(await g("Do you want to rebuild report?")),configure:_,generate:m,columns:s,period:r}}});e("default",m(T,[["render",function(e,t,r,a,n,o){const s=_("ion-loading"),c=_("v2Datatable"),l=_("ion-page");return b(),w(l,null,{default:R((()=>[y(s,{"is-open":e.isLoading,message:"Please wait..."},null,8,["is-open"]),y(c,{title:"Tx TB Report","icon-url":e.Img("login-logos/PEPFAR.png"),subtitle:e.period,columns:e.columns,columnData:e.reportData,rowsPerPage:100,onConfigure:e.configure,onRefresh:e.onRefreshReport,"report-prefix":"Pepfar"},null,8,["icon-url","subtitle","columns","columnData","onConfigure","onRefresh"])])),_:1})}]]))}}}));
