System.register(["./index-legacy-2OuOZQ1w.js"],(function(e,t){"use strict";var i,n,a,s,d,o,l,r,c,u,h,m,p,g,I,f,k,C,D,b,w,y,N,_,A,$,V,E,x,P,z;return{setters:[e=>{i=e.d,n=e.k,a=e.I,s=e.a5,d=e.a4,o=e.l,l=e.a7,r=e.ag,c=e.i,u=e.at,h=e.m,m=e.au,p=e.av,g=e.y,I=e.H,f=e.aw,k=e.ax,C=e.q,D=e.am,b=e.ar,w=e.a,y=e.b,N=e.w,_=e.e,A=e.j,$=e.t,V=e.h,E=e.a9,x=e.aa,P=e.a6,z=e.g}],execute:function(){const t=i({components:{IonPage:h,IonCheckbox:u,IonButton:c,IonList:r,IonItem:l,IonToolbar:o,IonHeader:d,IonTitle:s,IonContent:a,IonFooter:n},data:()=>({dde:{},ddeEnabled:!1,items:[],title:"",npid:""}),watch:{$route:{handler({params:e}){e&&(this.npid=e.npid,this.title=`Duplicates for NPID (${this.npid})`,this.init(this.npid))},deep:!0,immediate:!0}},computed:{itemsChecked(){return this.items.filter((e=>e.isChecked))}},methods:{async onAction(e,t="proceed"){if(await f(`\n                Are you sure you want to ${t}?\n            `))try{await e()}catch(i){C(`${i}`),console.error(i)}},async mergeSelected(){if(!this.itemsChecked.every((e=>e.isComplete)))return C("One or more patients have missing data. Please update them before merging.",5e3);await this.dde.postMerge(this.itemsChecked)&&(await this.dde.printNpid(this.dde.patientID),k(this.dde.patientID,this.$router))},async reassignIdentifier(e){if(!e.isComplete&&this.ddeEnabled){if(await f("Do you want to update missing information?",{header:"Incomplete Demographics"})){let t=`edit_person=${e.patientID}`;t+="&dde_reassign=true",t+=`&doc_id=${e.docID}`,this.$router.push(`/patient/registration?${t}`)}}else this.onAction((async()=>{this.ddeEnabled?await this.dde.reassignNpid(e.docID,e.patientID)&&await this.dde.printNpid(e.patientID):"function"==typeof e.assignLocalNpidAndPrint&&await e.assignLocalNpidAndPrint(),k(e.patientID,this.$router)}),"Reassign")},buildItems:e=>e.map((e=>{try{const t=new p(e);return{isChecked:!1,patientID:t.getID(),name:t.getFullName(),gender:t.getGender(),birthdate:I.toStandardHisDisplayFormat(t.getBirthdate()),curDistrict:t.getCurrentDistrict(),homeVillage:t.getHomeVillage(),docID:t.getPatientIdentifier(27),isComplete:t.patientIsComplete(),assignLocalNpidAndPrint:async()=>{await t.assignNpid(),await t.printNationalID()}}}catch(t){g("An error has occured while building data"),console.error(t)}return{isChecked:!1,patientID:"N/A",name:"N/A",gender:"N/A",birthdate:"N/A",curDistrict:"N/A",homeVillage:"N/A",docID:"N/A",isComplete:!1}})),clear(){this.items=this.items.map((e=>(e.isChecked=!1,e)))},async init(e){try{if(this.dde=new m,await this.dde.loadDDEStatus(),this.ddeEnabled=this.dde.isEnabled(),this.ddeEnabled){const{locals:t,remotes:i}=await this.dde.findNpid(e);this.items=[...this.buildItems(t),...this.buildItems(i)]}else{const t=await p.findByNpid(e);t&&(this.items=this.buildItems(t))}}catch(t){g(`${t}`,5e3)}}}}),H=z("br",null,null,-1);e("default",D(t,[["render",function(e,t,i,n,a,s){const d=b("ion-title"),o=b("ion-toolbar"),l=b("ion-header"),r=b("ion-checkbox"),c=b("ion-label"),u=b("ion-button"),h=b("ion-item"),m=b("ion-list"),p=b("ion-content"),g=b("ion-footer"),I=b("ion-page");return y(),w(I,null,{default:N((()=>[_(l,null,{default:N((()=>[_(o,null,{default:N((()=>[_(d,{class:"his-lg-text"},{default:N((()=>[A($(e.title),1)])),_:1})])),_:1})])),_:1}),_(p,null,{default:N((()=>[_(m,null,{default:N((()=>[(y(!0),V(E,null,x(e.items,((t,i)=>(y(),w(h,{class:"his-md-text",key:i},{default:N((()=>[e.ddeEnabled?(y(),w(r,{key:0,slot:"start",modelValue:t.isChecked,"onUpdate:modelValue":e=>t.isChecked=e},null,8,["modelValue","onUpdate:modelValue"])):P("",!0),_(c,{color:t.isComplete?"":"danger"},{default:N((()=>[A($(t.name)+" ("+$(t.gender)+") "+$(t.birthdate)+" ",1),H,A(" Current District: "),z("b",null,$(t.curDistrict||"Unknown"),1),A(" Home Village: "),z("b",null,$(t.homeVillage||"Unknown"),1)])),_:2},1032,["color"]),_(u,{size:"medium",onClick:()=>e.reassignIdentifier(t)},{default:N((()=>[A(" Re-Assign ")])),_:2},1032,["onClick"]),t.isComplete?P("",!0):(y(),w(u,{key:1,size:"medium",color:"warning","router-link":`/patient/registration?edit_person=${t.patientID}`},{default:N((()=>[A(" Update Missing Data ")])),_:2},1032,["router-link"]))])),_:2},1024)))),128))])),_:1})])),_:1}),_(g,null,{default:N((()=>[_(o,{color:"dark"},{default:N((()=>[_(u,{"router-link":"/",color:"danger",slot:"start",size:"large"},{default:N((()=>[A(" Cancel ")])),_:1}),e.itemsChecked.length>0?(y(),w(u,{key:0,onClick:e.clear,color:"warning",slot:"end",size:"large"},{default:N((()=>[A(" Clear ")])),_:1},8,["onClick"])):P("",!0),e.itemsChecked.length>1?(y(),w(u,{key:1,onClick:t[0]||(t[0]=t=>e.onAction(e.mergeSelected,"merge")),color:"primary",size:"large",slot:"end"},{default:N((()=>[A(" Merge ("+$(e.itemsChecked.length)+") ",1)])),_:1})):P("",!0)])),_:1})])),_:1})])),_:1})}]]))}}}));
